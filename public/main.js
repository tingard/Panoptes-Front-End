(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var React, tasks;

React = require('react');

tasks = require('./tasks');

module.exports = React.createClass({
  displayName: 'ClassificationSummary',
  getDefaultProps: function() {
    return {
      workflow: null,
      classification: null
    };
  },
  render: function() {
    var SummaryComponent, annotation, task;
    return React.createElement("div", {
      "className": "classification-summary"
    }, ((function() {
      var i, len, ref, results;
      if (this.props.classification.annotations.length === 0) {
        return 'No annotations';
      } else {
        ref = this.props.classification.annotations;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          annotation = ref[i];
          annotation._key = Math.random();
          task = this.props.workflow.tasks[annotation.task];
          SummaryComponent = tasks[task.type].Summary;
          results.push(React.createElement("div", {
            "key": annotation._key,
            "className": "classification-task-summary"
          }, React.createElement(SummaryComponent, {
            "task": task,
            "annotation": annotation,
            "onToggle": this.props.onToggle
          })));
        }
        return results;
      }
    }).call(this)));
  }
});


},{"./tasks":36,"react":"react"}],2:[function(require,module,exports){
var DELETE_BUTTON_ANGLE, DeleteButton, DragHandle, Draggable, DrawingToolRoot, EllipseTool, GUIDE_DASH, GUIDE_WIDTH, MINIMUM_RADIUS, React, deleteIfOutOfBounds;

React = require('react');

EllipseTool = require('./ellipse');

DrawingToolRoot = require('./root');

DragHandle = require('./drag-handle');

Draggable = require('../../lib/draggable');

deleteIfOutOfBounds = require('./delete-if-out-of-bounds');

DeleteButton = require('./delete-button');

MINIMUM_RADIUS = 5;

GUIDE_WIDTH = 1;

GUIDE_DASH = [4, 4];

DELETE_BUTTON_ANGLE = 45;

module.exports = React.createClass({
  displayName: 'EllipseTool',
  statics: {
    defaultValues: function(arg) {
      var x, y;
      x = arg.x, y = arg.y;
      return {
        x: x,
        y: y,
        r: 0,
        angle: 0
      };
    },
    initStart: function() {
      return {
        _inProgress: true
      };
    },
    initMove: function(arg, mark) {
      var angle, distance, x, y;
      x = arg.x, y = arg.y;
      distance = this.getDistance(mark.x, mark.y, x, y);
      angle = this.getAngle(mark.x, mark.y, x, y);
      return {
        r: distance,
        angle: angle
      };
    },
    initRelease: function() {
      return {
        _inProgress: false
      };
    },
    initValid: function(mark) {
      return mark.r > MINIMUM_RADIUS;
    },
    getDistance: function(x1, y1, x2, y2) {
      var aSquared, bSquared;
      aSquared = Math.pow(x2 - x1, 2);
      bSquared = Math.pow(y2 - y1, 2);
      return Math.sqrt(aSquared + bSquared);
    },
    getAngle: function(x1, y1, x2, y2) {
      var deltaX, deltaY;
      deltaX = x2 - x1;
      deltaY = y2 - y1;
      return Math.atan2(deltaY, deltaX) * (-180 / Math.PI);
    }
  },
  getDeletePosition: function() {
    var theta;
    theta = (DELETE_BUTTON_ANGLE - this.props.mark.angle) * (Math.PI / 180);
    return {
      x: this.props.mark.r * Math.cos(theta),
      y: -1 * this.props.mark.r * Math.sin(theta)
    };
  },
  render: function() {
    var deletePosition, positionAndRotate;
    positionAndRotate = "translate(" + this.props.mark.x + ", " + this.props.mark.y + ") rotate(" + (-1 * this.props.mark.angle) + ")";
    deletePosition = this.getDeletePosition();
    return React.createElement(DrawingToolRoot, {
      "tool": this,
      "transform": positionAndRotate
    }, (this.props.selected ? React.createElement("line", {
      "x1": "0",
      "y1": "0",
      "x2": this.props.mark.r,
      "y2": "0",
      "strokeWidth": GUIDE_WIDTH / ((this.props.scale.horizontal + this.props.scale.vertical) / 2),
      "strokeDasharray": GUIDE_DASH
    }) : void 0), React.createElement(Draggable, {
      "onDrag": this.handleMainDrag,
      "onEnd": deleteIfOutOfBounds.bind(null, this),
      "disabled": this.props.disabled
    }, React.createElement("ellipse", {
      "rx": this.props.mark.r,
      "ry": this.props.mark.r
    })), (this.props.selected ? React.createElement("g", null, React.createElement(DeleteButton, {
      "tool": this,
      "x": deletePosition.x,
      "y": deletePosition.y,
      "rotate": this.props.mark.angle
    }), React.createElement(DragHandle, {
      "onDrag": this.handleRadiusHandleDrag,
      "x": this.props.mark.r,
      "y": 0.,
      "scale": this.props.scale
    })) : void 0));
  },
  handleMainDrag: function(e, d) {
    this.props.mark.x += d.x / this.props.scale.horizontal;
    this.props.mark.y += d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  },
  handleRadiusHandleDrag: function(e, d) {
    var angle, r, ref, x, y;
    ref = this.props.getEventOffset(e), x = ref.x, y = ref.y;
    r = this.constructor.getDistance(this.props.mark.x, this.props.mark.y, x, y);
    angle = this.constructor.getAngle(this.props.mark.x, this.props.mark.y, x, y);
    this.props.mark.r = r;
    this.props.mark.angle = angle;
    return this.props.onChange(this.props.mark);
  }
});


},{"../../lib/draggable":100,"./delete-button":4,"./delete-if-out-of-bounds":5,"./drag-handle":6,"./ellipse":7,"./root":14,"react":"react"}],3:[function(require,module,exports){
var DEFAULT_WIDTH, DeleteButton, DragHandle, Draggable, DrawingToolRoot, MINIMUM_WIDTH, React, deleteIfOutOfBounds;

React = require('react');

DrawingToolRoot = require('./root');

DragHandle = require('./drag-handle');

Draggable = require('../../lib/draggable');

deleteIfOutOfBounds = require('./delete-if-out-of-bounds');

DeleteButton = require('./delete-button');

DEFAULT_WIDTH = 25;

MINIMUM_WIDTH = 25;

module.exports = React.createClass({
  displayName: 'RectangleTool',
  statics: {
    initCoords: null,
    defaultValues: function(arg) {
      var x;
      x = arg.x;
      return {
        x: x,
        width: DEFAULT_WIDTH
      };
    },
    initStart: function(arg, mark) {
      var x;
      x = arg.x;
      this.initCoords = {
        x: x,
        0: 0
      };
      return {
        x: x,
        0: 0,
        _inProgress: true
      };
    },
    initMove: function(cursor, mark) {
      var width, x;
      if (cursor.x > this.initCoords.x) {
        width = cursor.x - mark.x;
        x = mark.x;
      } else {
        width = this.initCoords.x - cursor.x;
        x = cursor.x;
      }
      return {
        x: x,
        width: width
      };
    },
    initRelease: function() {
      return {
        _inProgress: false
      };
    },
    initValid: function(mark) {
      return mark.width >= MINIMUM_WIDTH;
    }
  },
  initCoords: null,
  render: function() {
    var ref, width, x;
    ref = this.props.mark, x = ref.x, width = ref.width;
    return React.createElement(DrawingToolRoot, {
      "tool": this
    }, React.createElement(Draggable, {
      "onDrag": this.handleMainDrag,
      "onEnd": deleteIfOutOfBounds.bind(null, this),
      "disabled": this.props.disabled
    }, React.createElement("rect", {
      "ref": "rect",
      "x": x,
      "y": 0.,
      "width": width,
      "height": this.props.containerRect.height / this.props.scale.vertical
    })), (this.props.selected ? React.createElement("g", null, React.createElement(DeleteButton, {
      "tool": this,
      "x": x + width + 20,
      "y": 15.
    }), React.createElement(DragHandle, {
      "x": x,
      "y": (this.props.containerRect.height / this.props.scale.vertical) / 2,
      "scale": this.props.scale,
      "onDrag": this.handleLeftDrag
    }), React.createElement(DragHandle, {
      "x": x + width,
      "y": (this.props.containerRect.height / this.props.scale.vertical) / 2,
      "scale": this.props.scale,
      "onDrag": this.handleRightDrag
    })) : void 0));
  },
  handleMainDrag: function(e, d) {
    this.props.mark.x += d.x / this.props.scale.horizontal;
    return this.props.onChange(this.props.mark);
  },
  handleLeftDrag: function(e, d) {
    if (this.props.mark.width - d.x / this.props.scale.horizontal >= MINIMUM_WIDTH) {
      this.props.mark.x += d.x / this.props.scale.horizontal;
      this.props.mark.width -= d.x / this.props.scale.horizontal;
      return this.props.onChange(this.props.mark);
    }
  },
  handleRightDrag: function(e, d) {
    if (this.props.mark.width + d.x / this.props.scale.horizontal >= MINIMUM_WIDTH) {
      this.props.mark.width += d.x / this.props.scale.horizontal;
      return this.props.onChange(this.props.mark);
    }
  }
});


},{"../../lib/draggable":100,"./delete-button":4,"./delete-if-out-of-bounds":5,"./drag-handle":6,"./root":14,"react":"react"}],4:[function(require,module,exports){
var CROSS_PATH, FILL_COLOR, RADIUS, React, STROKE_COLOR, STROKE_WIDTH;

React = require('react');

RADIUS = 8;

STROKE_COLOR = 'white';

FILL_COLOR = 'black';

STROKE_WIDTH = 1.5;

CROSS_PATH = "M " + (-1 * RADIUS * 0.7) + " 0 L " + (RADIUS * 0.7) + " 0 M 0 " + (-1 * RADIUS * 0.7) + " L 0 " + (RADIUS * 0.7);

module.exports = React.createClass({
  displayName: 'DeleteButton',
  getDefaultProps: function() {
    return {
      x: 0,
      y: 0,
      rotate: 0,
      destroyTransitionDuration: 300
    };
  },
  render: function() {
    var transform;
    transform = "translate(" + this.props.x + ", " + this.props.y + ") rotate(" + this.props.rotate + ") scale(" + (1 / this.props.tool.props.scale.horizontal) + ", " + (1 / this.props.tool.props.scale.vertical) + ")";
    return React.createElement("g", {
      "className": "clickable drawing-tool-delete-button",
      "transform": transform,
      "stroke": STROKE_COLOR,
      "strokeWidth": STROKE_WIDTH,
      "onClick": this.destroyTool
    }, React.createElement("circle", {
      "r": RADIUS,
      "fill": FILL_COLOR
    }), React.createElement("path", {
      "d": CROSS_PATH,
      "transform": "rotate(45)"
    }));
  },
  destroyTool: function() {
    return this.props.tool.setState({
      destroying: true
    }, (function(_this) {
      return function() {
        return setTimeout(_this.props.tool.props.onDestroy, _this.props.destroyTransitionDuration);
      };
    })(this));
  }
});


},{"react":"react"}],5:[function(require,module,exports){
var ReactDOM, deleteIfOutOfBounds, isInBounds;

ReactDOM = require('react-dom');

isInBounds = require('../../lib/is-in-bounds');

deleteIfOutOfBounds = function(tool) {
  var boundingBox, domNode, outOfBounds;
  domNode = ReactDOM.findDOMNode(tool);
  boundingBox = (function() {
    var height, left, ref, top, width;
    ref = domNode.getBoundingClientRect(), left = ref.left, top = ref.top, width = ref.width, height = ref.height;
    left += pageXOffset;
    top += pageYOffset;
    return {
      left: left,
      top: top,
      width: width,
      height: height
    };
  })();
  outOfBounds = !isInBounds(boundingBox, tool.props.containerRect);
  if (outOfBounds) {
    return tool.props.onDestroy();
  }
};

module.exports = deleteIfOutOfBounds;


},{"../../lib/is-in-bounds":106,"react-dom":"react-dom"}],6:[function(require,module,exports){
var Draggable, OVERSHOOT, RADIUS, React;

React = require('react');

Draggable = require('../../lib/draggable');

RADIUS = 4;

OVERSHOOT = 4;

module.exports = React.createClass({
  displayName: 'DragHandle',
  render: function() {
    var className, styleProps;
    className = "drag-handle";
    if (this.props.className != null) {
      className += " " + this.props.className;
    }
    styleProps = {
      fill: 'currentColor',
      stroke: 'transparent',
      strokeWidth: OVERSHOOT,
      transform: "translate(" + this.props.x + ", " + this.props.y + ")\nscale(" + (1 / this.props.scale.horizontal) + ", " + (1 / this.props.scale.vertical) + ")"
    };
    return React.createElement(Draggable, {
      "onStart": this.props.onStart,
      "onDrag": this.props.onDrag,
      "onEnd": this.props.onEnd
    }, React.createElement("circle", React.__spread({
      "className": className,
      "r": RADIUS
    }, styleProps, {
      "style": this.props.style
    })));
  }
});


},{"../../lib/draggable":100,"react":"react"}],7:[function(require,module,exports){
var DEFAULT_SQUASH, DELETE_BUTTON_ANGLE, DeleteButton, DragHandle, Draggable, DrawingToolRoot, GUIDE_DASH, GUIDE_WIDTH, MINIMUM_RADIUS, React, deleteIfOutOfBounds;

React = require('react');

DrawingToolRoot = require('./root');

DragHandle = require('./drag-handle');

Draggable = require('../../lib/draggable');

deleteIfOutOfBounds = require('./delete-if-out-of-bounds');

DeleteButton = require('./delete-button');

DEFAULT_SQUASH = 1 / 2;

MINIMUM_RADIUS = 5;

GUIDE_WIDTH = 1;

GUIDE_DASH = [4, 4];

DELETE_BUTTON_ANGLE = 45;

module.exports = React.createClass({
  displayName: 'EllipseTool',
  statics: {
    defaultValues: function(arg) {
      var x, y;
      x = arg.x, y = arg.y;
      return {
        x: x,
        y: y,
        rx: 0,
        ry: 0,
        angle: 0
      };
    },
    initStart: function() {
      return {
        _inProgress: true
      };
    },
    initMove: function(arg, mark) {
      var angle, distance, x, y;
      x = arg.x, y = arg.y;
      distance = this.getDistance(mark.x, mark.y, x, y);
      angle = this.getAngle(mark.x, mark.y, x, y);
      return {
        rx: distance,
        ry: distance * DEFAULT_SQUASH,
        angle: angle
      };
    },
    initRelease: function() {
      return {
        _inProgress: false
      };
    },
    initValid: function(mark) {
      return mark.rx > MINIMUM_RADIUS;
    },
    getDistance: function(x1, y1, x2, y2) {
      var aSquared, bSquared;
      aSquared = Math.pow(x2 - x1, 2);
      bSquared = Math.pow(y2 - y1, 2);
      return Math.sqrt(aSquared + bSquared);
    },
    getAngle: function(x1, y1, x2, y2) {
      var deltaX, deltaY;
      deltaX = x2 - x1;
      deltaY = y2 - y1;
      return Math.atan2(deltaY, deltaX) * (-180 / Math.PI);
    }
  },
  getDeletePosition: function() {
    var theta;
    theta = (DELETE_BUTTON_ANGLE - this.props.mark.angle) * (Math.PI / 180);
    return {
      x: this.props.mark.rx * Math.cos(theta),
      y: -1 * this.props.mark.ry * Math.sin(theta)
    };
  },
  render: function() {
    var deletePosition, guideWidth, positionAndRotate;
    positionAndRotate = "translate(" + this.props.mark.x + ", " + this.props.mark.y + ") rotate(" + (-1 * this.props.mark.angle) + ")";
    deletePosition = this.getDeletePosition();
    return React.createElement(DrawingToolRoot, {
      "tool": this,
      "transform": positionAndRotate
    }, (this.props.selected ? (guideWidth = GUIDE_WIDTH / ((this.props.scale.horizontal + this.props.scale.vertical) / 2), React.createElement("g", null, React.createElement("line", {
      "x1": "0",
      "y1": "0",
      "x2": this.props.mark.rx,
      "y2": "0",
      "strokeWidth": guideWidth,
      "strokeDasharray": GUIDE_DASH
    }), React.createElement("line", {
      "x1": "0",
      "y1": "0",
      "x2": "0",
      "y2": -1 * this.props.mark.ry,
      "strokeWidth": guideWidth,
      "strokeDasharray": GUIDE_DASH
    }))) : void 0), React.createElement(Draggable, {
      "onDrag": this.handleMainDrag,
      "onEnd": deleteIfOutOfBounds.bind(null, this),
      "disabled": this.props.disabled
    }, React.createElement("ellipse", {
      "rx": this.props.mark.rx,
      "ry": this.props.mark.ry
    })), (this.props.selected ? React.createElement("g", null, React.createElement(DeleteButton, {
      "tool": this,
      "x": deletePosition.x,
      "y": deletePosition.y,
      "rotate": this.props.mark.angle
    }), React.createElement(DragHandle, {
      "onDrag": this.handleRadiusHandleDrag.bind(this, 'x'),
      "x": this.props.mark.rx,
      "y": 0.,
      "scale": this.props.scale
    }), React.createElement(DragHandle, {
      "onDrag": this.handleRadiusHandleDrag.bind(this, 'y'),
      "x": 0.,
      "y": -1 * this.props.mark.ry,
      "scale": this.props.scale
    })) : void 0));
  },
  handleMainDrag: function(e, d) {
    this.props.mark.x += d.x / this.props.scale.horizontal;
    this.props.mark.y += d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  },
  handleRadiusHandleDrag: function(coord, e, d) {
    var angle, r, ref, x, y;
    ref = this.props.getEventOffset(e), x = ref.x, y = ref.y;
    r = this.constructor.getDistance(this.props.mark.x, this.props.mark.y, x, y);
    angle = this.constructor.getAngle(this.props.mark.x, this.props.mark.y, x, y);
    this.props.mark["r" + coord] = r;
    this.props.mark.angle = angle;
    if (coord === 'y') {
      this.props.mark.angle -= 90;
    }
    return this.props.onChange(this.props.mark);
  }
});


},{"../../lib/draggable":100,"./delete-button":4,"./delete-if-out-of-bounds":5,"./drag-handle":6,"./root":14,"react":"react"}],8:[function(require,module,exports){
module.exports = {
  point: require('./point'),
  line: require('./line'),
  polygon: require('./polygon'),
  rectangle: require('./rectangle'),
  circle: require('./circle'),
  ellipse: require('./ellipse'),
  bezier: require('./poly-curve'),
  column: require('./column-rectangle')
};


},{"./circle":2,"./column-rectangle":3,"./ellipse":7,"./line":9,"./point":10,"./poly-curve":11,"./polygon":12,"./rectangle":13}],9:[function(require,module,exports){
var DeleteButton, DragHandle, Draggable, DrawingToolRoot, GRAB_STROKE_WIDTH, MINIMUM_LENGTH, React, deleteIfOutOfBounds;

React = require('react');

DrawingToolRoot = require('./root');

Draggable = require('../../lib/draggable');

deleteIfOutOfBounds = require('./delete-if-out-of-bounds');

DeleteButton = require('./delete-button');

DragHandle = require('./drag-handle');

MINIMUM_LENGTH = 5;

GRAB_STROKE_WIDTH = 6;

module.exports = React.createClass({
  displayName: 'LineTool',
  statics: {
    defaultValues: function(arg) {
      var x, y;
      x = arg.x, y = arg.y;
      return {
        x1: x,
        y1: y,
        x2: x,
        y2: y
      };
    },
    initStart: function() {
      return {
        _inProgress: true
      };
    },
    initMove: function(arg) {
      var x, y;
      x = arg.x, y = arg.y;
      return {
        x2: x,
        y2: y
      };
    },
    initRelease: function() {
      return {
        _inProgress: false
      };
    },
    initValid: function(mark) {
      var x1, x2, y1, y2;
      x1 = mark.x1, y1 = mark.y1, x2 = mark.x2, y2 = mark.y2;
      return DrawingToolRoot.distance(x1, y1, x2, y2) > MINIMUM_LENGTH;
    }
  },
  render: function() {
    var points, ref, x1, x2, y1, y2;
    ref = this.props.mark, x1 = ref.x1, y1 = ref.y1, x2 = ref.x2, y2 = ref.y2;
    points = {
      x1: x1,
      y1: y1,
      x2: x2,
      y2: y2
    };
    return React.createElement(DrawingToolRoot, {
      "tool": this
    }, React.createElement("line", React.__spread({}, points)), React.createElement(Draggable, {
      "onDrag": this.handleStrokeDrag,
      "onEnd": deleteIfOutOfBounds.bind(null, this),
      "disabled": this.props.disabled
    }, React.createElement("line", React.__spread({}, points, {
      "strokeWidth": GRAB_STROKE_WIDTH / ((this.props.scale.horizontal + this.props.scale.vertical) / 2),
      "strokeOpacity": "0"
    }))), (this.props.selected ? React.createElement("g", null, React.createElement(DeleteButton, {
      "tool": this,
      "x": (x1 + x2) / 2,
      "y": (y1 + y2) / 2
    }), React.createElement(DragHandle, {
      "x": x1,
      "y": y1,
      "scale": this.props.scale,
      "onDrag": this.handleHandleDrag.bind(this, 1)
    }), React.createElement(DragHandle, {
      "x": x2,
      "y": y2,
      "scale": this.props.scale,
      "onDrag": this.handleHandleDrag.bind(this, 2)
    })) : void 0));
  },
  handleStrokeDrag: function(e, d) {
    var i, n;
    for (n = i = 1; i <= 2; n = ++i) {
      this.props.mark["x" + n] += d.x / this.props.scale.horizontal;
      this.props.mark["y" + n] += d.y / this.props.scale.vertical;
    }
    return this.props.onChange(this.props.mark);
  },
  handleHandleDrag: function(n, e, d) {
    this.props.mark["x" + n] += d.x / this.props.scale.horizontal;
    this.props.mark["y" + n] += d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  }
});


},{"../../lib/draggable":100,"./delete-button":4,"./delete-if-out-of-bounds":5,"./drag-handle":6,"./root":14,"react":"react"}],10:[function(require,module,exports){
var CROSSHAIR_SPACE, CROSSHAIR_WIDTH, DELETE_BUTTON_ANGLE, DeleteButton, Draggable, DrawingToolRoot, RADIUS, React, SELECTED_RADIUS, deleteIfOutOfBounds, isInBounds;

React = require('react');

DrawingToolRoot = require('./root');

deleteIfOutOfBounds = require('./delete-if-out-of-bounds');

Draggable = require('../../lib/draggable');

DeleteButton = require('./delete-button');

isInBounds = require('../../lib/is-in-bounds');

RADIUS = 10;

SELECTED_RADIUS = 20;

CROSSHAIR_SPACE = 0.2;

CROSSHAIR_WIDTH = 1;

DELETE_BUTTON_ANGLE = 45;

module.exports = React.createClass({
  displayName: 'PointTool',
  statics: {
    defaultValues: function(arg) {
      var x, y;
      x = arg.x, y = arg.y;
      return {
        x: x,
        y: y
      };
    },
    initStart: function() {
      return {
        _inProgress: true
      };
    },
    initMove: function(arg) {
      var x, y;
      x = arg.x, y = arg.y;
      return {
        x: x,
        y: y
      };
    },
    initValid: function(mark, arg) {
      var containerRect, markRect, scale;
      containerRect = arg.containerRect, scale = arg.scale;
      markRect = {
        left: containerRect.left + (mark.x * scale.vertical),
        top: containerRect.top + (mark.y * scale.horizontal),
        width: 1,
        height: 1
      };
      return isInBounds(markRect, containerRect);
    },
    initRelease: function() {
      return {
        _inProgress: false
      };
    }
  },
  getDeleteButtonPosition: function() {
    var theta;
    theta = DELETE_BUTTON_ANGLE * (Math.PI / 180);
    return {
      x: (SELECTED_RADIUS / this.props.scale.horizontal) * Math.cos(theta),
      y: -1 * (SELECTED_RADIUS / this.props.scale.vertical) * Math.sin(theta)
    };
  },
  render: function() {
    var averageScale, crosshairSpace, crosshairWidth, radius, selectedRadius;
    averageScale = (this.props.scale.horizontal + this.props.scale.vertical) / 2;
    crosshairSpace = CROSSHAIR_SPACE / averageScale;
    crosshairWidth = CROSSHAIR_WIDTH / averageScale;
    selectedRadius = SELECTED_RADIUS / averageScale;
    radius = this.props.selected ? SELECTED_RADIUS / averageScale : RADIUS / averageScale;
    return React.createElement(DrawingToolRoot, {
      "tool": this,
      "transform": "translate(" + this.props.mark.x + ", " + this.props.mark.y + ")"
    }, React.createElement("line", {
      "x1": "0",
      "y1": -1 * crosshairSpace * selectedRadius,
      "x2": "0",
      "y2": -1 * selectedRadius,
      "strokeWidth": crosshairWidth
    }), React.createElement("line", {
      "x1": -1 * crosshairSpace * selectedRadius,
      "y1": "0",
      "x2": -1 * selectedRadius,
      "y2": "0",
      "strokeWidth": crosshairWidth
    }), React.createElement("line", {
      "x1": "0",
      "y1": crosshairSpace * selectedRadius,
      "x2": "0",
      "y2": selectedRadius,
      "strokeWidth": crosshairWidth
    }), React.createElement("line", {
      "x1": crosshairSpace * selectedRadius,
      "y1": "0",
      "x2": selectedRadius,
      "y2": "0",
      "strokeWidth": crosshairWidth
    }), React.createElement(Draggable, {
      "onDrag": this.handleDrag,
      "onEnd": deleteIfOutOfBounds.bind(null, this),
      "disabled": this.props.disabled
    }, React.createElement("circle", {
      "r": radius
    })), (this.props.selected ? React.createElement(DeleteButton, React.__spread({
      "tool": this
    }, this.getDeleteButtonPosition())) : void 0));
  },
  handleDrag: function(e, d) {
    this.props.mark.x += d.x / this.props.scale.horizontal;
    this.props.mark.y += d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  }
});


},{"../../lib/draggable":100,"../../lib/is-in-bounds":106,"./delete-button":4,"./delete-if-out-of-bounds":5,"./root":14,"react":"react"}],11:[function(require,module,exports){
var DEFAULT_CURVE, DELETE_BUTTON_WEIGHT, DeleteButton, DragHandle, Draggable, DrawingToolRoot, FINISHER_RADIUS, GRAB_STROKE_WIDTH, GUIDE_DASH, GUIDE_WIDTH, React, deleteIfOutOfBounds;

React = require('react');

DrawingToolRoot = require('./root');

DragHandle = require('./drag-handle');

Draggable = require('../../lib/draggable');

deleteIfOutOfBounds = require('./delete-if-out-of-bounds');

DeleteButton = require('./delete-button');

FINISHER_RADIUS = 8;

GRAB_STROKE_WIDTH = 6;

GUIDE_WIDTH = 1;

GUIDE_DASH = [4, 4];

DEFAULT_CURVE = {
  x: 0.5,
  y: 0
};

DELETE_BUTTON_WEIGHT = 0.75;

module.exports = React.createClass({
  displayName: 'BezierCurveTool',
  statics: {
    initCoords: null,
    defaultValues: function(arg) {
      var x, y;
      x = arg.x, y = arg.y;
      return {
        points: [],
        closed: false
      };
    },
    initStart: function(newPoint, mark) {
      var controlPoint, lastEnd;
      if (mark.points.length > 0) {
        lastEnd = mark.points.slice(-1)[0];
        controlPoint = this.toImageFrame(lastEnd, newPoint, DEFAULT_CURVE);
        mark.points.push(controlPoint);
      }
      mark.points.push(newPoint);
      return {
        points: mark.points
      };
    },
    initMove: function(arg, mark) {
      var x, y;
      x = arg.x, y = arg.y;
      mark.points[mark.points.length - 1] = {
        x: x,
        y: y
      };
      return {
        points: mark.points
      };
    },
    isComplete: function(mark) {
      return mark.closed;
    },
    forceComplete: function(mark) {
      mark.closed = true;
      return mark.auto_closed = true;
    },
    toLineFrame: function(start, end, control) {
      var con, dcx, dcy, dx, dy;
      dx = end.x - start.x;
      dy = end.y - start.y;
      dcx = control.x - start.x;
      dcy = control.y - start.y;
      con = 1 / ((dx * dx) + (dy * dy));
      return {
        x: ((dx * dcx) + (dy * dcy)) * con,
        y: (-(dy * dcx) + (dx * dcy)) * con
      };
    },
    toImageFrame: function(start, end, control) {
      var dx, dy;
      dx = end.x - start.x;
      dy = end.y - start.y;
      return {
        x: (dx * control.x) - (dy * control.y) + start.x,
        y: (dy * control.x) + (dx * control.y) + start.y
      };
    },
    positionAlongCurve: function(start, end, control, t) {
      if (control != null) {
        return {
          x: (1 - t) * (1 - t) * start.x + 2 * (1 - t) * t * control.x + t * t * end.x,
          y: (1 - t) * (1 - t) * start.y + 2 * (1 - t) * t * control.y + t * t * end.y
        };
      } else {
        return {
          x: (1 - t) * start.x + t * end.x,
          y: (1 - t) * start.y + t * end.y
        };
      }
    }
  },
  componentWillMount: function() {
    return this.setState({
      mouseX: this.props.mark.points[0].x,
      mouseY: this.props.mark.points[0].y,
      mouseWithinViewer: true
    });
  },
  componentDidMount: function() {
    return document.addEventListener('mousemove', this.handleMouseMove);
  },
  componentWillUnmount: function() {
    return document.removeEventListener('mousemove', this.handleMouseMove);
  },
  render: function() {
    var averageScale, className, controlPoint, controlPointPrime, deleteButtonPosition, finisherRadius, firstControlPoint, firstPoint, guideWidth, i, idx, j, lastEnd, lastPoint, newPoint, point, points, ref, secondPoint, svgPath, svgPathGuide, svgPathHelpers;
    points = this.props.mark.points;
    averageScale = (this.props.scale.horizontal + this.props.scale.vertical) / 2;
    finisherRadius = FINISHER_RADIUS / averageScale;
    guideWidth = GUIDE_WIDTH / averageScale;
    firstPoint = points[0];
    firstControlPoint = points[1];
    secondPoint = points[2];
    if (secondPoint == null) {
      secondPoint = {
        x: firstPoint.x + (finisherRadius * 2),
        y: firstPoint.y - (finisherRadius * 2)
      };
    }
    lastPoint = points[points.length - 1];
    deleteButtonPosition = this.constructor.positionAlongCurve(firstPoint, secondPoint, firstControlPoint, DELETE_BUTTON_WEIGHT);
    svgPath = "M" + firstPoint.x + " " + firstPoint.y + " ";
    svgPathHelpers = "M" + firstPoint.x + " " + firstPoint.y + " ";
    if (points.length > 1) {
      for (idx = j = 1, ref = points.length - 1; j <= ref; idx = j += 2) {
        if (points[idx + 1] != null) {
          svgPath += "Q " + points[idx].x + " " + points[idx].y + " " + points[idx + 1].x + " " + points[idx + 1].y + " ";
          svgPathHelpers += "L " + points[idx].x + " " + points[idx].y + " L " + points[idx + 1].x + " " + points[idx + 1].y + " ";
        } else {
          svgPath += "Q " + lastPoint.x + " " + lastPoint.y + " " + firstPoint.x + " " + firstPoint.y;
          svgPathHelpers += "L " + lastPoint.x + " " + lastPoint.y + " L " + firstPoint.x + " " + firstPoint.y;
        }
      }
    }
    if (!this.props.mark.closed && this.state.mouseWithinViewer && points.length) {
      lastEnd = lastPoint;
      controlPointPrime = DEFAULT_CURVE;
      newPoint = {
        x: this.state.mouseX,
        y: this.state.mouseY
      };
      controlPoint = this.constructor.toImageFrame(lastEnd, newPoint, controlPointPrime);
      svgPathGuide = "M" + lastEnd.x + " " + lastEnd.y + " Q " + controlPoint.x + " " + controlPoint.y + " " + newPoint.x + " " + newPoint.y;
    }
    return React.createElement(DrawingToolRoot, {
      "tool": this
    }, React.createElement(Draggable, {
      "onDrag": this.handleMainDrag,
      "onEnd": deleteIfOutOfBounds.bind(null, this),
      "disabled": this.props.disabled
    }, React.createElement("path", {
      "d": svgPath,
      "fill": (!this.props.mark.closed ? 'none' : void 0)
    })), (this.props.selected ? React.createElement("g", null, React.createElement(DeleteButton, {
      "tool": this,
      "x": deleteButtonPosition.x,
      "y": deleteButtonPosition.y
    }), React.createElement("path", {
      "d": svgPathHelpers,
      "strokeWidth": guideWidth,
      "strokeDasharray": GUIDE_DASH,
      "fill": 'none'
    }), (!this.props.mark.closed && points.length && this.state.mouseWithinViewer ? React.createElement("path", {
      "className": "guideline",
      "d": svgPathGuide,
      "fill": 'none'
    }) : void 0), (!this.props.mark.closed && this.props.mark.points.length > 2 ? React.createElement("line", {
      "className": "guideline",
      "x1": lastPoint.x,
      "y1": lastPoint.y,
      "x2": firstPoint.x,
      "y2": firstPoint.y
    }) : void 0), (function() {
      var k, len, results;
      results = [];
      for (i = k = 0, len = points.length; k < len; i = ++k) {
        point = points[i];
        if (i % 2 !== 0) {
          className = "open-drag-handle";
        } else {
          className = void 0;
        }
        results.push(React.createElement(DragHandle, {
          "className": className,
          "key": i,
          "x": point.x,
          "y": point.y,
          "scale": this.props.scale,
          "onDrag": this.handleHandleDrag.bind(this, i)
        }));
      }
      return results;
    }).call(this), (!this.props.mark.closed ? React.createElement("g", null, React.createElement("circle", {
      "className": "clickable",
      "r": finisherRadius,
      "cx": firstPoint.x,
      "cy": firstPoint.y,
      "stroke": "transparent",
      "onClick": this.handleFinishClick
    })) : void 0)) : void 0));
  },
  handleMouseMove: function(e) {
    var mouseWithinViewer, xPos, yPos;
    xPos = e.pageX;
    yPos = e.pageY;
    mouseWithinViewer = xPos < this.props.containerRect.left || xPos > this.props.containerRect.right ? false : yPos < this.props.containerRect.top || yPos > this.props.containerRect.bottom ? false : true;
    return this.setState({
      mouseX: (xPos - this.props.containerRect.left) / this.props.scale.horizontal,
      mouseY: (yPos - this.props.containerRect.top) / this.props.scale.vertical,
      mouseWithinViewer: mouseWithinViewer
    });
  },
  handleFinishClick: function() {
    var controlPoint, controlPointPrime, firstPoint, lastControl, lastEnd, lastStart, ref;
    firstPoint = this.props.mark.points[0];
    ref = this.props.mark.points.slice(-3), lastStart = ref[0], lastControl = ref[1], lastEnd = ref[2];
    controlPointPrime = DEFAULT_CURVE;
    controlPoint = this.constructor.toImageFrame(lastEnd, firstPoint, controlPointPrime);
    this.props.mark.points.push(controlPoint);
    document.removeEventListener('mousemove', this.handleMouseMove);
    this.props.mark.closed = true;
    return this.props.onChange(this.props.mark);
  },
  handleMainDrag: function(e, d) {
    var j, len, point, ref;
    ref = this.props.mark.points;
    for (j = 0, len = ref.length; j < len; j++) {
      point = ref[j];
      point.x += d.x / this.props.scale.horizontal;
      point.y += d.y / this.props.scale.vertical;
    }
    return this.props.onChange(this.props.mark);
  },
  handleHandleDrag: function(index, e, d) {
    this.props.mark.points[index].x += d.x / this.props.scale.horizontal;
    this.props.mark.points[index].y += d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  }
});


},{"../../lib/draggable":100,"./delete-button":4,"./delete-if-out-of-bounds":5,"./drag-handle":6,"./root":14,"react":"react"}],12:[function(require,module,exports){
var DELETE_BUTTON_WEIGHT, DeleteButton, DragHandle, Draggable, DrawingToolRoot, FINISHER_RADIUS, GRAB_STROKE_WIDTH, React, deleteIfOutOfBounds;

React = require('react');

DrawingToolRoot = require('./root');

DragHandle = require('./drag-handle');

Draggable = require('../../lib/draggable');

deleteIfOutOfBounds = require('./delete-if-out-of-bounds');

DeleteButton = require('./delete-button');

FINISHER_RADIUS = 8;

GRAB_STROKE_WIDTH = 6;

DELETE_BUTTON_WEIGHT = 5;

module.exports = React.createClass({
  displayName: 'PolygonTool',
  statics: {
    initCoords: null,
    defaultValues: function(arg) {
      var x, y;
      x = arg.x, y = arg.y;
      return {
        points: [],
        closed: false
      };
    },
    initStart: function(arg, mark) {
      var x, y;
      x = arg.x, y = arg.y;
      mark.points.push({
        x: x,
        y: y
      });
      return {
        points: mark.points,
        _inProgress: true
      };
    },
    initMove: function(arg, mark) {
      var x, y;
      x = arg.x, y = arg.y;
      mark.points[mark.points.length - 1] = {
        x: x,
        y: y
      };
      return {
        points: mark.points
      };
    },
    isComplete: function(mark) {
      return mark.closed;
    },
    forceComplete: function(mark) {
      mark.closed = true;
      return mark.auto_closed = true;
    }
  },
  componentWillMount: function() {
    return this.setState({
      mouseX: this.props.mark.points[0].x,
      mouseY: this.props.mark.points[0].y,
      mouseWithinViewer: true
    });
  },
  componentDidMount: function() {
    return document.addEventListener('mousemove', this.handleMouseMove);
  },
  componentWillUnmount: function() {
    return document.removeEventListener('mousemove', this.handleMouseMove);
  },
  render: function() {
    var averageScale, deleteButtonPosition, finisherRadius, firstPoint, i, lastPoint, point, points, secondPoint, x, y;
    averageScale = (this.props.scale.horizontal + this.props.scale.vertical) / 2;
    finisherRadius = FINISHER_RADIUS / averageScale;
    firstPoint = this.props.mark.points[0];
    secondPoint = this.props.mark.points[1];
    if (secondPoint == null) {
      secondPoint = {
        x: firstPoint.x + (finisherRadius * 2),
        y: firstPoint.y - (finisherRadius * 2)
      };
    }
    lastPoint = this.props.mark.points[this.props.mark.points.length - 1];
    points = (function() {
      var j, len, ref, ref1, results;
      ref = this.props.mark.points;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        ref1 = ref[j], x = ref1.x, y = ref1.y;
        results.push([x, y].join(','));
      }
      return results;
    }).call(this);
    if (this.props.mark.closed) {
      points.push([firstPoint.x, firstPoint.y].join(','));
    }
    points = points.join('\n');
    deleteButtonPosition = {
      x: (firstPoint.x + ((DELETE_BUTTON_WEIGHT - 1) * secondPoint.x)) / DELETE_BUTTON_WEIGHT,
      y: (firstPoint.y + ((DELETE_BUTTON_WEIGHT - 1) * secondPoint.y)) / DELETE_BUTTON_WEIGHT
    };
    return React.createElement(DrawingToolRoot, {
      "tool": this
    }, React.createElement(Draggable, {
      "onDrag": this.handleMainDrag,
      "onEnd": deleteIfOutOfBounds.bind(null, this),
      "disabled": this.props.disabled
    }, React.createElement("polyline", {
      "points": points,
      "fill": (!this.props.mark.closed ? 'none' : void 0)
    })), (this.props.selected ? React.createElement("g", null, React.createElement(DeleteButton, {
      "tool": this,
      "x": deleteButtonPosition.x,
      "y": deleteButtonPosition.y
    }), (!this.props.mark.closed && this.props.mark.points.length && this.state.mouseWithinViewer ? React.createElement("line", {
      "className": "guideline",
      "x1": lastPoint.x,
      "y1": lastPoint.y,
      "x2": this.state.mouseX,
      "y2": this.state.mouseY
    }) : void 0), (!this.props.mark.closed && this.props.mark.points.length > 2 ? React.createElement("line", {
      "className": "guideline",
      "x1": lastPoint.x,
      "y1": lastPoint.y,
      "x2": firstPoint.x,
      "y2": firstPoint.y
    }) : void 0), (function() {
      var j, len, ref, results;
      ref = this.props.mark.points;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        point = ref[i];
        results.push(React.createElement(DragHandle, {
          "key": i,
          "x": point.x,
          "y": point.y,
          "scale": this.props.scale,
          "onDrag": this.handleHandleDrag.bind(this, i)
        }));
      }
      return results;
    }).call(this), (!this.props.mark.closed ? React.createElement("g", null, React.createElement("circle", {
      "className": "clickable",
      "r": finisherRadius,
      "cx": firstPoint.x,
      "cy": firstPoint.y,
      "stroke": "transparent",
      "onClick": this.handleFinishClick
    }), React.createElement("circle", {
      "className": "clickable",
      "r": finisherRadius,
      "cx": lastPoint.x,
      "cy": lastPoint.y,
      "onClick": this.handleFinishClick
    })) : void 0)) : void 0));
  },
  handleMouseMove: function(e) {
    var mouseWithinViewer, xPos, yPos;
    xPos = e.pageX;
    yPos = e.pageY;
    mouseWithinViewer = xPos < this.props.containerRect.left || xPos > this.props.containerRect.right ? false : yPos < this.props.containerRect.top || yPos > this.props.containerRect.bottom ? false : true;
    return this.setState({
      mouseX: (xPos - this.props.containerRect.left) / this.props.scale.horizontal,
      mouseY: (yPos - this.props.containerRect.top) / this.props.scale.vertical,
      mouseWithinViewer: mouseWithinViewer
    });
  },
  handleFinishClick: function() {
    document.removeEventListener('mousemove', this.handleMouseMove);
    this.props.mark.closed = true;
    this.props.mark._inProgress = false;
    return this.props.onChange(this.props.mark);
  },
  handleMainDrag: function(e, d) {
    var j, len, point, ref;
    ref = this.props.mark.points;
    for (j = 0, len = ref.length; j < len; j++) {
      point = ref[j];
      point.x += d.x / this.props.scale.horizontal;
      point.y += d.y / this.props.scale.vertical;
    }
    return this.props.onChange(this.props.mark);
  },
  handleHandleDrag: function(index, e, d) {
    this.props.mark.points[index].x += d.x / this.props.scale.horizontal;
    this.props.mark.points[index].y += d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  }
});


},{"../../lib/draggable":100,"./delete-button":4,"./delete-if-out-of-bounds":5,"./drag-handle":6,"./root":14,"react":"react"}],13:[function(require,module,exports){
var DELETE_BUTTON_DISTANCE, DeleteButton, DragHandle, Draggable, DrawingToolRoot, MINIMUM_SIZE, React, deleteIfOutOfBounds;

React = require('react');

DrawingToolRoot = require('./root');

DragHandle = require('./drag-handle');

Draggable = require('../../lib/draggable');

deleteIfOutOfBounds = require('./delete-if-out-of-bounds');

DeleteButton = require('./delete-button');

MINIMUM_SIZE = 5;

DELETE_BUTTON_DISTANCE = 9 / 10;

module.exports = React.createClass({
  displayName: 'RectangleTool',
  statics: {
    initCoords: null,
    defaultValues: function(arg) {
      var x, y;
      x = arg.x, y = arg.y;
      return {
        x: x,
        y: y,
        width: 0,
        height: 0
      };
    },
    initStart: function(arg, mark) {
      var x, y;
      x = arg.x, y = arg.y;
      this.initCoords = {
        x: x,
        y: y
      };
      return {
        x: x,
        y: y,
        _inProgress: true
      };
    },
    initMove: function(cursor, mark) {
      var height, width, x, y;
      if (cursor.x > this.initCoords.x) {
        width = cursor.x - mark.x;
        x = mark.x;
      } else {
        width = this.initCoords.x - cursor.x;
        x = cursor.x;
      }
      if (cursor.y > this.initCoords.y) {
        height = cursor.y - mark.y;
        y = mark.y;
      } else {
        height = this.initCoords.y - cursor.y;
        y = cursor.y;
      }
      return {
        x: x,
        y: y,
        width: width,
        height: height
      };
    },
    initRelease: function() {
      return {
        _inProgress: false
      };
    },
    initValid: function(mark) {
      return mark.width > MINIMUM_SIZE && mark.height > MINIMUM_SIZE;
    }
  },
  initCoords: null,
  render: function() {
    var height, points, ref, width, x, y;
    ref = this.props.mark, x = ref.x, y = ref.y, width = ref.width, height = ref.height;
    points = [[x, y].join(','), [x + width, y].join(','), [x + width, y + height].join(','), [x, y + height].join(','), [x, y].join(',')].join('\n');
    return React.createElement(DrawingToolRoot, {
      "tool": this
    }, React.createElement(Draggable, {
      "onDrag": this.handleMainDrag,
      "onEnd": deleteIfOutOfBounds.bind(null, this),
      "disabled": this.props.disabled
    }, React.createElement("polyline", {
      "points": points
    })), (this.props.selected ? React.createElement("g", null, React.createElement(DeleteButton, {
      "tool": this,
      "x": x + (width * DELETE_BUTTON_DISTANCE),
      "y": y
    }), React.createElement(DragHandle, {
      "x": x,
      "y": y,
      "scale": this.props.scale,
      "onDrag": this.handleTopLeftDrag,
      "onEnd": this.normalizeMark
    }), React.createElement(DragHandle, {
      "x": x + width,
      "y": y,
      "scale": this.props.scale,
      "onDrag": this.handleTopRightDrag,
      "onEnd": this.normalizeMark
    }), React.createElement(DragHandle, {
      "x": x + width,
      "y": y + height,
      "scale": this.props.scale,
      "onDrag": this.handleBottomRightDrag,
      "onEnd": this.normalizeMark
    }), React.createElement(DragHandle, {
      "x": x,
      "y": y + height,
      "scale": this.props.scale,
      "onDrag": this.handleBottomLeftDrag,
      "onEnd": this.normalizeMark
    })) : void 0));
  },
  handleMainDrag: function(e, d) {
    this.props.mark.x += d.x / this.props.scale.horizontal;
    this.props.mark.y += d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  },
  handleTopLeftDrag: function(e, d) {
    this.props.mark.x += d.x / this.props.scale.horizontal;
    this.props.mark.y += d.y / this.props.scale.vertical;
    this.props.mark.width -= d.x / this.props.scale.horizontal;
    this.props.mark.height -= d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  },
  handleTopRightDrag: function(e, d) {
    this.props.mark.y += d.y / this.props.scale.vertical;
    this.props.mark.width += d.x / this.props.scale.horizontal;
    this.props.mark.height -= d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  },
  handleBottomRightDrag: function(e, d) {
    this.props.mark.width += d.x / this.props.scale.horizontal;
    this.props.mark.height += d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  },
  handleBottomLeftDrag: function(e, d) {
    this.props.mark.x += d.x / this.props.scale.horizontal;
    this.props.mark.width -= d.x / this.props.scale.horizontal;
    this.props.mark.height += d.y / this.props.scale.vertical;
    return this.props.onChange(this.props.mark);
  },
  normalizeMark: function() {
    if (this.props.mark.width < 0) {
      this.props.mark.x += this.props.mark.width;
      this.props.mark.width *= -1;
    }
    if (this.props.mark.height < 0) {
      this.props.mark.y += this.props.mark.height;
      this.props.mark.height *= -1;
    }
    return this.props.onChange(this.props.mark);
  }
});


},{"../../lib/draggable":100,"./delete-button":4,"./delete-if-out-of-bounds":5,"./drag-handle":6,"./root":14,"react":"react"}],14:[function(require,module,exports){
var ChangeListener, React, SELECTED_STROKE_WIDTH, SEMI_MODAL_FORM_STYLE, SEMI_MODAL_UNDERLAY_STYLE, STROKE_WIDTH, StickyModalForm;

React = require('react');

StickyModalForm = require('modal-form/sticky');

ChangeListener = require('../../components/change-listener');

STROKE_WIDTH = 1.5;

SELECTED_STROKE_WIDTH = 2.5;

SEMI_MODAL_FORM_STYLE = {
  pointerEvents: 'all'
};

SEMI_MODAL_UNDERLAY_STYLE = {
  pointerEvents: 'none',
  backgroundColor: 'rgba(0, 0, 0, 0)'
};

module.exports = React.createClass({
  displayName: 'DrawingToolRoot',
  statics: {
    distance: function(x1, y1, x2, y2) {
      return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
    }
  },
  getDefaultProps: function() {
    return {
      tool: null
    };
  },
  getInitialState: function() {
    return {
      destroying: false
    };
  },
  render: function() {
    var TaskComponent, detailTask, detailsAreComplete, i, mainStyle, ref, rootProps, scale, startHandler, tasks, toolProps;
    toolProps = this.props.tool.props;
    rootProps = {
      'data-disabled': toolProps.disabled || null,
      'data-selected': toolProps.selected || null,
      'data-destroying': ((ref = this.props.tool.state) != null ? ref.destroying : void 0) || null,
      style: {
        color: toolProps.color
      }
    };
    scale = (toolProps.scale.horizontal + toolProps.scale.vertical) / 2;
    mainStyle = {
      fill: 'transparent',
      stroke: 'currentColor',
      strokeWidth: toolProps.selected ? SELECTED_STROKE_WIDTH / scale : STROKE_WIDTH / scale
    };
    if (!toolProps.disabled) {
      startHandler = toolProps.onSelect;
    }
    return React.createElement("g", React.__spread({
      "className": "drawing-tool"
    }, rootProps, this.props), React.createElement("g", React.__spread({
      "className": "drawing-tool-main"
    }, mainStyle, {
      "onMouseDown": startHandler,
      "onTouchStart": startHandler
    }), this.props.children), (toolProps.selected && !toolProps.mark._inProgress && (toolProps.details != null) && toolProps.details.length !== 0 ? (tasks = require('../tasks'), detailsAreComplete = toolProps.details.every((function(_this) {
      return function(detailTask, i) {
        var TaskComponent;
        TaskComponent = tasks[detailTask.type];
        if (TaskComponent.isAnnotationComplete != null) {
          return TaskComponent.isAnnotationComplete(detailTask, toolProps.mark.details[i]);
        } else {
          return true;
        }
      };
    })(this)), React.createElement(StickyModalForm, {
      "ref": "detailsForm",
      "style": SEMI_MODAL_FORM_STYLE,
      "underlayStyle": SEMI_MODAL_UNDERLAY_STYLE,
      "onSubmit": this.handleDetailsFormClose,
      "onCancel": this.handleDetailsFormClose
    }, (function() {
      var j, len, ref1, results;
      ref1 = toolProps.details;
      results = [];
      for (i = j = 0, len = ref1.length; j < len; i = ++j) {
        detailTask = ref1[i];
        if (detailTask._key == null) {
          detailTask._key = Math.random();
        }
        TaskComponent = tasks[detailTask.type];
        results.push(React.createElement(TaskComponent, {
          "autoFocus": i === 0,
          "key": detailTask._key,
          "task": detailTask,
          "annotation": toolProps.mark.details[i],
          "onChange": this.handleDetailsChange.bind(this, i)
        }));
      }
      return results;
    }).call(this), React.createElement("hr", null), React.createElement("p", {
      "style": {
        textAlign: 'center'
      }
    }, React.createElement("button", {
      "type": "submit",
      "className": "standard-button",
      "disabled": !detailsAreComplete
    }, "OK")))) : void 0));
  },
  componentDidUpdate: function() {
    var ref;
    return (ref = this.refs.detailsForm) != null ? ref.reposition() : void 0;
  },
  handleDetailsChange: function(detailIndex, annotation) {
    this.props.tool.props.mark.details[detailIndex] = annotation;
    return this.props.tool.props.onChange(this.props.tool.props.mark);
  },
  handleDetailsFormClose: function() {
    var base;
    return typeof (base = this.props.tool.props).onDeselect === "function" ? base.onDeselect() : void 0;
  }
});


},{"../../components/change-listener":63,"../tasks":36,"modal-form/sticky":547,"react":"react"}],15:[function(require,module,exports){
var Draggable, React, SVGImage, SubjectViewer, WarningBanner, drawingTools, getSubjectLocation, seenThisSession, tasks;

React = require('react');

SubjectViewer = require('../components/subject-viewer');

SVGImage = require('../components/svg-image');

Draggable = require('../lib/draggable');

drawingTools = require('./drawing-tools');

tasks = require('./tasks');

seenThisSession = require('../lib/seen-this-session');

getSubjectLocation = require('../lib/get-subject-location');

WarningBanner = require('./warning-banner');

module.exports = React.createClass({
  displayName: 'FrameAnnotator',
  getDefaultProps: function() {
    return {
      user: null,
      project: null,
      subject: null,
      workflow: null,
      classification: null,
      annotation: null,
      onLoad: Function.prototype,
      frame: 0,
      onChange: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      sizeRect: null,
      alreadySeen: false,
      showWarning: false
    };
  },
  componentDidMount: function() {
    addEventListener('resize', this.updateSize);
    this.updateSize();
    return this.setState({
      alreadySeen: this.props.subject.already_seen || seenThisSession.check(this.props.workflow, this.props.subject)
    });
  },
  componentDidUpdate: function(prevProps, prevState) {
    if (this.props.naturalWidth !== prevProps.naturalWidth || this.props.naturalHeight !== prevProps.naturalHeight || this.props.viewBoxDimensions !== prevProps.viewBoxDimensions) {
      return setTimeout((function(_this) {
        return function() {
          return _this.updateSize();
        };
      })(this));
    }
  },
  componentWillUnmount: function() {
    return removeEventListener('resize', this.updateSize);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.annotation !== this.props.annotation) {
      return this.handleAnnotationChange(this.props.annotation, nextProps.annotation);
    }
  },
  handleAnnotationChange: function(oldAnnotation, currentAnnotation) {
    var LastTaskComponent, lastTask;
    if (oldAnnotation != null) {
      lastTask = this.props.workflow.tasks[oldAnnotation.task];
      LastTaskComponent = tasks[lastTask.type];
      if (LastTaskComponent.onLeaveAnnotation != null) {
        LastTaskComponent.onLeaveAnnotation(lastTask, oldAnnotation);
      }
    }
    return setTimeout((function(_this) {
      return function() {
        return _this.updateSize();
      };
    })(this));
  },
  updateSize: function() {
    var bottom, clientRect, height, left, ref, right, top, width;
    clientRect = (ref = this.refs.sizeRect) != null ? ref.getBoundingClientRect() : void 0;
    left = clientRect.left, right = clientRect.right, top = clientRect.top, bottom = clientRect.bottom, width = clientRect.width, height = clientRect.height;
    left += pageXOffset;
    right += pageXOffset;
    top += pageYOffset;
    bottom += pageYOffset;
    return this.setState({
      sizeRect: {
        left: left,
        right: right,
        top: top,
        bottom: bottom,
        width: width,
        height: height
      }
    });
  },
  getScale: function() {
    var horizontal, ref, ref1, vertical;
    horizontal = ((ref = this.state.sizeRect) != null ? ref.width : void 0) / this.props.naturalWidth || 0;
    vertical = ((ref1 = this.state.sizeRect) != null ? ref1.height : void 0) / this.props.naturalHeight || 0;
    return {
      horizontal: horizontal,
      vertical: vertical
    };
  },
  getEventOffset: function(e) {
    var ref, ref1, scale, x, y;
    scale = this.getScale();
    x = (e.pageX - ((ref = this.state.sizeRect) != null ? ref.left : void 0)) / scale.horizontal || 0;
    y = (e.pageY - ((ref1 = this.state.sizeRect) != null ? ref1.top : void 0)) / scale.vertical || 0;
    return {
      x: x,
      y: y
    };
  },
  render: function() {
    var AfterSubject, BeforeSubject, Component, InsideSubject, PersistInsideSubject, TaskComponent, anyTaskName, createdViewBox, format, hookProps, key, ref, ref1, ref2, src, svgProps, svgStyle, task, taskDescription, type, value;
    taskDescription = this.props.workflow.tasks[(ref = this.props.annotation) != null ? ref.task : void 0];
    TaskComponent = tasks[taskDescription != null ? taskDescription.type : void 0];
    ref1 = getSubjectLocation(this.props.subject, this.props.frame), type = ref1.type, format = ref1.format, src = ref1.src;
    createdViewBox = this.props.viewBoxDimensions.x + " " + this.props.viewBoxDimensions.y + " " + this.props.viewBoxDimensions.width + " " + this.props.viewBoxDimensions.height;
    svgStyle = {};
    if (type === 'image' && !this.props.loading) {
      svgStyle.background = 'black';
    }
    svgProps = {};
    if (TaskComponent != null) {
      BeforeSubject = TaskComponent.BeforeSubject, InsideSubject = TaskComponent.InsideSubject, AfterSubject = TaskComponent.AfterSubject;
    }
    hookProps = {
      taskTypes: tasks,
      workflow: this.props.workflow,
      task: taskDescription,
      classification: this.props.classification,
      annotation: this.props.annotation,
      frame: this.props.frame,
      scale: this.getScale(),
      naturalWidth: this.props.naturalWidth,
      naturalHeight: this.props.naturalHeight,
      containerRect: this.state.sizeRect,
      getEventOffset: this.getEventOffset,
      onChange: this.props.onChange
    };
    for (task in tasks) {
      Component = tasks[task];
      if (Component.getSVGProps != null) {
        ref2 = Component.getSVGProps(hookProps);
        for (key in ref2) {
          value = ref2[key];
          svgProps[key] = value;
        }
      }
    }
    return React.createElement("div", {
      "className": "frame-annotator"
    }, React.createElement("div", {
      "className": "subject-area"
    }, (BeforeSubject != null ? React.createElement(BeforeSubject, React.__spread({}, hookProps)) : void 0), React.createElement("svg", React.__spread({
      "className": "subject",
      "style": svgStyle,
      "viewBox": createdViewBox
    }, svgProps), React.createElement("rect", {
      "ref": "sizeRect",
      "width": this.props.naturalWidth,
      "height": this.props.naturalHeight,
      "fill": "rgba(0, 0, 0, 0.01)",
      "fillOpacity": "0.01",
      "stroke": "none"
    }), (type === 'image' ? React.createElement(Draggable, {
      "onDrag": this.props.panByDrag,
      "disabled": this.props.disabled
    }, React.createElement(SVGImage, {
      "className": (this.props.panEnabled ? "pan-active" : void 0),
      "src": src,
      "width": this.props.naturalWidth,
      "height": this.props.naturalHeight
    })) : void 0), ((InsideSubject != null) && !this.props.panEnabled ? React.createElement(InsideSubject, React.__spread({}, hookProps)) : void 0), (function() {
      var results;
      results = [];
      for (anyTaskName in tasks) {
        PersistInsideSubject = tasks[anyTaskName].PersistInsideSubject;
        if (PersistInsideSubject != null) {
          results.push(React.createElement(PersistInsideSubject, React.__spread({
            "key": anyTaskName
          }, hookProps)));
        }
      }
      return results;
    })()), this.props.children, (this.state.alreadySeen ? React.createElement(WarningBanner, {
      "label": "Already seen!"
    }, React.createElement("p", null, "Our records show that youve already seen this image. We might have run out of data for you in this workflow!"), React.createElement("p", null, "Try choosing a different workflow or contributing to a different project.")) : this.props.subject.retired ? React.createElement(WarningBanner, {
      "label": "Finished!"
    }, React.createElement("p", null, "This subject already has enough classifications, so yours wont be used in its analysis!"), React.createElement("p", null, "If youre looking to help, try choosing a different workflow or contributing to a different project.")) : void 0), (AfterSubject != null ? React.createElement(AfterSubject, React.__spread({}, hookProps)) : void 0)));
  }
});


},{"../components/subject-viewer":90,"../components/svg-image":91,"../lib/draggable":100,"../lib/get-subject-location":102,"../lib/seen-this-session":113,"./drawing-tools":8,"./tasks":36,"./warning-banner":50,"react":"react"}],16:[function(require,module,exports){
var ChangeListener, ClassificationSummary, Classifier, FrameAnnotator, Link, PULSAR_HUNTERS_SLUG, PromiseRenderer, React, SubjectViewer, TriggeredModalForm, Tutorial, TutorialButton, WorldWideTelescope, apiClient, getSessionID, isAdmin, preloadSubject, tasks, testClassificationQuality, workflowAllowsFlipbook, workflowAllowsSeparateFrames,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
  slice = [].slice;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

testClassificationQuality = require('../lib/test-classification-quality');

ChangeListener = require('../components/change-listener');

FrameAnnotator = require('./frame-annotator');

SubjectViewer = require('../components/subject-viewer');

ClassificationSummary = require('./classification-summary');

Link = require('react-router').Link;

tasks = require('./tasks');

getSessionID = require('../lib/session').getSessionID;

preloadSubject = require('../lib/preload-subject');

PromiseRenderer = require('../components/promise-renderer');

TriggeredModalForm = require('modal-form/triggered');

TutorialButton = require('./tutorial-button');

isAdmin = require('../lib/is-admin');

Tutorial = require('../lib/tutorial');

workflowAllowsFlipbook = require('../lib/workflow-allows-flipbook');

workflowAllowsSeparateFrames = require('../lib/workflow-allows-separate-frames');

WorldWideTelescope = require('./world_wide_telescope');

PULSAR_HUNTERS_SLUG = 'zooniverse/pulsar-hunters';

Classifier = React.createClass({
  displayName: 'Classifier',
  getDefaultProps: function() {
    return {
      user: null,
      workflow: null,
      subject: null,
      classification: null,
      goodClassificationCutoff: 0.5,
      onLoad: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      subjectLoading: false,
      expertClassification: null,
      classificationQuality: NaN,
      showingExpertClassification: false,
      selectedExpertAnnotation: -1
    };
  },
  componentDidMount: function() {
    this.loadSubject(this.props.subject);
    this.prepareToClassify(this.props.classification);
    return Tutorial.startIfNecessary(this.props.user, this.props.project);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.project !== this.props.project || nextProps.user !== this.props.user) {
      Tutorial.startIfNecessary(nextProps.user, nextProps.project);
    }
    if (nextProps.subject !== this.props.subject) {
      this.loadSubject(subject);
    }
    if (nextProps.classification !== this.props.classification) {
      return this.prepareToClassify(nextProps.classification);
    }
  },
  loadSubject: function(subject) {
    this.setState({
      subjectLoading: true,
      expertClassification: null,
      classificationQuality: NaN,
      showingExpertClassification: false,
      selectedExpertAnnotation: -1
    });
    this.getExpertClassification(this.props.workflow, this.props.subject);
    return preloadSubject(subject).then((function(_this) {
      return function() {
        var base;
        if (_this.props.subject === subject) {
          _this.setState({
            subjectLoading: false
          });
          return typeof (base = _this.props).onLoad === "function" ? base.onLoad() : void 0;
        }
      };
    })(this));
  },
  getExpertClassification: function(workflow, subject) {
    var awaitExpertClassification;
    awaitExpertClassification = Promise.resolve((function(_this) {
      return function() {
        return apiClient.get('/classifications/gold_standard', {
          workflow_id: workflow.id,
          subject_ids: [subject.id]
        })["catch"](function() {
          return [];
        }).then(function(arg) {
          var expertClassification;
          expertClassification = arg[0];
          return expertClassification;
        });
      };
    })(this)());
    return awaitExpertClassification.then((function(_this) {
      return function(expertClassification) {
        var ref;
        if (expertClassification == null) {
          expertClassification = (ref = subject.expert_classification_data) != null ? ref[workflow.id] : void 0;
        }
        if (_this.props.workflow === workflow && _this.props.subject === subject) {
          window.expertClassification = expertClassification;
          return _this.setState({
            expertClassification: expertClassification
          });
        }
      };
    })(this));
  },
  prepareToClassify: function(classification) {
    if (classification.annotations == null) {
      classification.annotations = [];
    }
    if (classification.annotations.length === 0) {
      return this.addAnnotationForTask(classification, this.props.workflow.first_task);
    }
  },
  render: function() {
    return React.createElement(ChangeListener, {
      "target": this.props.classification
    }, ((function(_this) {
      return function() {
        var currentAnnotation, currentClassification, currentTask, ref;
        if (_this.state.showingExpertClassification) {
          currentClassification = _this.state.expertClassification;
        } else {
          currentClassification = _this.props.classification;
          if (!_this.props.classification.completed) {
            currentAnnotation = currentClassification.annotations[currentClassification.annotations.length - 1];
            currentTask = _this.props.workflow.tasks[currentAnnotation != null ? currentAnnotation.task : void 0];
          }
        }
        window.classification = currentClassification;
        return React.createElement("div", {
          "className": "classifier"
        }, React.createElement(SubjectViewer, {
          "user": _this.props.user,
          "project": _this.props.project,
          "subject": _this.props.subject,
          "workflow": _this.props.workflow,
          "classification": currentClassification,
          "annotation": currentAnnotation,
          "onLoad": _this.handleSubjectImageLoad,
          "frameWrapper": FrameAnnotator,
          "allowFlipbook": workflowAllowsFlipbook(_this.props.workflow),
          "allowSeparateFrames": workflowAllowsSeparateFrames(_this.props.workflow),
          "onChange": _this.handleAnnotationChange.bind(_this, currentClassification)
        }), React.createElement("div", {
          "className": "task-area"
        }, (currentTask != null ? _this.renderTask(currentClassification, currentAnnotation, currentTask) : !((ref = _this.props.workflow.configuration) != null ? ref.hide_classification_summaries : void 0) ? _this.renderSummary(currentClassification) : void 0)));
      };
    })(this)));
  },
  renderTask: function(classification, annotation, task) {
    var TaskComponent, currentAnswer, disabledStyle, name, nextTaskKey, onFirstAnnotation, ownerName, persistentHooksAfterTask, persistentHooksBeforeTask, ref, ref1, ref2, taskHookProps, waitingForAnswer;
    TaskComponent = tasks[task.type];
    onFirstAnnotation = classification.annotations.indexOf(annotation) === 0;
    if (TaskComponent.isAnnotationComplete != null) {
      waitingForAnswer = !TaskComponent.isAnnotationComplete(task, annotation, this.props.workflow);
    }
    if (TaskComponent === tasks.single) {
      currentAnswer = (ref = task.answers) != null ? ref[annotation.value] : void 0;
      nextTaskKey = currentAnswer != null ? currentAnswer.next : void 0;
    } else {
      nextTaskKey = task.next;
    }
    if (this.props.workflow.tasks[nextTaskKey] == null) {
      nextTaskKey = '';
    }
    disabledStyle = {
      opacity: 0.5,
      pointerEvents: 'none'
    };
    persistentHooksBeforeTask = [];
    persistentHooksAfterTask = [];
    classification.annotations.forEach((function(_this) {
      return function(annotation) {
        var PersistAfterTask, PersistBeforeTask, taskDescription;
        taskDescription = _this.props.workflow.tasks[annotation.task];
        TaskComponent = tasks[taskDescription.type];
        PersistBeforeTask = TaskComponent.PersistBeforeTask, PersistAfterTask = TaskComponent.PersistAfterTask;
        if ((PersistBeforeTask != null) && indexOf.call(persistentHooksBeforeTask, PersistBeforeTask) < 0) {
          persistentHooksBeforeTask.push(PersistBeforeTask);
        }
        if ((PersistAfterTask != null) && indexOf.call(persistentHooksAfterTask, PersistAfterTask) < 0) {
          return persistentHooksAfterTask.push(PersistAfterTask);
        }
      };
    })(this));
    taskHookProps = {
      taskTypes: tasks,
      workflow: this.props.workflow,
      classification: classification,
      onChange: function() {
        return classification.update();
      }
    };
    return React.createElement("div", {
      "className": "task-container",
      "style": (this.state.subjectLoading ? disabledStyle : void 0)
    }, persistentHooksBeforeTask.map((function(_this) {
      return function(HookComponent) {
        return React.createElement(HookComponent, React.__spread({}, taskHookProps));
      };
    })(this)), React.createElement(TaskComponent, {
      "autoFocus": true,
      "taskTypes": tasks,
      "workflow": this.props.workflow,
      "task": task,
      "annotation": annotation,
      "onChange": this.handleAnnotationChange.bind(this, classification)
    }), persistentHooksAfterTask.map((function(_this) {
      return function(HookComponent) {
        return React.createElement(HookComponent, React.__spread({}, taskHookProps));
      };
    })(this)), React.createElement("hr", null), React.createElement("nav", {
      "className": "task-nav"
    }, (Object.keys(this.props.workflow.tasks).length > 1 ? React.createElement("button", {
      "type": "button",
      "className": "back minor-button",
      "disabled": onFirstAnnotation,
      "onClick": this.destroyCurrentAnnotation
    }, "Back") : void 0), (!nextTaskKey && ((ref1 = this.props.workflow.configuration) != null ? ref1.hide_classification_summaries : void 0) && (this.props.owner != null) && (this.props.project != null) ? ((ref2 = this.props.project.slug.split('/'), ownerName = ref2[0], name = ref2[1], ref2), React.createElement(Link, {
      "onClick": this.completeClassification,
      "to": "/projects/" + ownerName + "/" + name + "/talk/subjects/" + this.props.subject.id,
      "className": "talk standard-button",
      "style": (waitingForAnswer ? disabledStyle : void 0)
    }, "Done \& Talk")) : void 0), (nextTaskKey ? React.createElement("button", {
      "type": "button",
      "className": "continue major-button",
      "disabled": waitingForAnswer,
      "onClick": this.addAnnotationForTask.bind(this, classification, nextTaskKey)
    }, "Next") : React.createElement("button", {
      "type": "button",
      "className": "continue major-button",
      "disabled": waitingForAnswer,
      "onClick": this.completeClassification
    }, (this.props.demoMode ? React.createElement("i", {
      "className": "fa fa-trash fa-fw"
    }) : this.props.classification.gold_standard ? React.createElement("i", {
      "className": "fa fa-star fa-fw"
    }) : void 0), ' ', "Done")), this.renderExpertOptions()), React.createElement("p", null, React.createElement("small", null, React.createElement("strong", null, React.createElement(TutorialButton, {
      "className": "minor-button",
      "user": this.props.user,
      "project": this.props.project,
      "title": "Project tutorial",
      "aria-label": "Show the project tutorial",
      "style": {
        marginTop: '2em'
      }
    }, "Show the project tutorial")))), (this.props.demoMode ? React.createElement("p", {
      "style": {
        textAlign: 'center'
      }
    }, React.createElement("i", {
      "className": "fa fa-trash"
    }), ' ', React.createElement("small", null, React.createElement("strong", null, "Demo mode:"), React.createElement("br", null), "No classifications are being recorded.", ' ', React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "onClick": this.props.onChangeDemoMode.bind(null, false)
    }, React.createElement("u", null, "Disable")))) : this.props.classification.gold_standard ? React.createElement("p", {
      "style": {
        textAlign: 'center'
      }
    }, React.createElement("i", {
      "className": "fa fa-star"
    }), ' ', React.createElement("small", null, React.createElement("strong", null, "Gold standard mode:"), React.createElement("br", null), "Please ensure this classification is completely accurate.", ' ', React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "onClick": this.props.classification.update.bind(this.props.classification, {
        gold_standard: void 0
      })
    }, React.createElement("u", null, "Disable")))) : void 0));
  },
  renderSummary: function(classification) {
    var HelpButton, name, ownerName, qualityString, ref, ref1, ref2, ref3, subjectClass, userFoundPulsar;
    return React.createElement("div", null, "Thanks!\n", (this.props.workflow.configuration.custom_summary && indexOf.call(this.props.workflow.configuration.custom_summary, 'world_wide_telescope') >= 0 ? React.createElement("strong", null, React.createElement(WorldWideTelescope, {
      "annotations": this.props.classification.annotations,
      "subject": this.props.subject,
      "user_name": this.props.user.display_name
    })) : void 0), (((ref = this.props.project) != null ? ref.slug : void 0) === PULSAR_HUNTERS_SLUG || location.href.indexOf('fake-pulsar-feedback') !== -1 ? (subjectClass = (ref1 = this.props.subject.metadata['#Class']) != null ? ref1.toUpperCase() : void 0, subjectClass != null ? (userFoundPulsar = ((ref2 = this.props.classification.annotations[0]) != null ? ref2.value : void 0) === 0, HelpButton = (function(_this) {
      return function(props) {
        return React.createElement("button", {
          "type": "button",
          "onClick": (function() {
            var Markdown, alert;
            alert = require('modal-form/dialog').alert;
            Markdown = require('markdownz').Markdown;
            console.log({
              Markdown: Markdown
            });
            return alert(React.createElement(Markdown, null, _this.props.workflow.tasks[_this.props.workflow.first_task].help));
          })
        }, props.children);
      };
    })(this), React.createElement("div", {
      "className": "pulsar-hunters-feedback",
      "data-is-correct": (subjectClass != null) && userFoundPulsar || null
    }, (subjectClass === 'KNOWN' || subjectClass === 'DISC' ? userFoundPulsar ? React.createElement("p", null, "Congratulations! Youve successfully spotted a known pulsar. Keep going to find one we dont already know about.") : React.createElement("p", null, "This was actually a known pulsar. ", React.createElement(HelpButton, null, "Click here"), " to see some examples of known pulsars.") : subjectClass === 'FAKE' ? userFoundPulsar ? React.createElement("p", null, "Congratulations! Youve successfully spotted a simulated pulsar. Keep going to find a real, undiscovered pulsar.") : React.createElement("p", null, "This was a simulated pulsar. ", React.createElement(HelpButton, null, "Click here"), " to see some examples of known pulsars.") : void 0))) : void 0) : this.state.expertClassification != null ? React.createElement("div", {
      "className": "has-expert-classification"
    }, "Expert classification available.", ' ', (this.state.showingExpertClassification ? React.createElement("button", {
      "type": "button",
      "onClick": this.toggleExpertClassification.bind(this, false)
    }, "Hide") : React.createElement("button", {
      "type": "button",
      "onClick": this.toggleExpertClassification.bind(this, true)
    }, "Show")), (!(true || isNaN(this.state.classificationQuality)) ? (qualityString = (this.state.classificationQuality * 100).toString().split('.')[0] + '%', React.createElement("div", null, "Looks like you matched about ", React.createElement("strong", null, qualityString), ".")) : void 0), (this.state.classificationQuality < this.props.goodClassificationCutoff ? React.createElement("div", null, "Keep at it, all classifications are useful!") : void 0), (this.state.classificationQuality > this.props.goodClassificationCutoff ? React.createElement("div", null, "Keep up the good work!") : void 0)) : void 0), React.createElement("div", null, React.createElement("strong", null, (this.state.showingExpertClassification ? 'Expert classification:' : 'Your classification:')), React.createElement(ClassificationSummary, {
      "workflow": this.props.workflow,
      "classification": classification
    })), React.createElement("hr", null), React.createElement("nav", {
      "className": "task-nav"
    }, ((this.props.owner != null) && (this.props.project != null) ? ((ref3 = this.props.project.slug.split('/'), ownerName = ref3[0], name = ref3[1], ref3), React.createElement(Link, {
      "onClick": this.props.onClickNext,
      "to": "/projects/" + ownerName + "/" + name + "/talk/subjects/" + this.props.subject.id,
      "className": "talk standard-button"
    }, "Talk")) : void 0), React.createElement("button", {
      "type": "button",
      "autoFocus": true,
      "className": "continue major-button",
      "onClick": this.props.onClickNext
    }, "Next"), this.renderExpertOptions()));
  },
  renderExpertOptions: function() {
    if (!this.props.expertClassifier) {
      return;
    }
    return React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("i", {
        "className": "fa fa-cog fa-fw"
      })
    }, (indexOf.call(this.props.userRoles, 'owner') >= 0 || indexOf.call(this.props.userRoles, 'expert') >= 0 ? React.createElement("p", null, React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "checked": this.props.classification.gold_standard,
      "onChange": this.handleGoldStandardChange
    }), ' ', "Gold standard mode"), ' ', React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("i", {
        "className": "fa fa-question-circle"
      })
    }, React.createElement("p", null, "A gold standard classification is one that is known to be completely accurate. Well compare other classifications against it during aggregation."))) : void 0), (isAdmin() || indexOf.call(this.props.userRoles, 'owner') >= 0 || indexOf.call(this.props.userRoles, 'collaborator') >= 0 ? React.createElement("p", null, React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "checked": this.props.demoMode,
      "onChange": this.handleDemoModeChange
    }), ' ', "Demo mode"), ' ', React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("i", {
        "className": "fa fa-question-circle"
      })
    }, React.createElement("p", null, "In demo mode, classifications ", React.createElement("strong", null, "will not be saved"), ". Use this for quick, inaccurate demos of the classification interface."))) : void 0));
  },
  handleSubjectImageLoad: function(e, frameIndex) {
    var changes, clientHeight, clientWidth, naturalHeight, naturalWidth, ref;
    ref = e.target, naturalWidth = ref.naturalWidth, naturalHeight = ref.naturalHeight, clientWidth = ref.clientWidth, clientHeight = ref.clientHeight;
    changes = {};
    changes["metadata.subject_dimensions." + frameIndex] = {
      naturalWidth: naturalWidth,
      naturalHeight: naturalHeight,
      clientWidth: clientWidth,
      clientHeight: clientHeight
    };
    return this.props.classification.update(changes);
  },
  handleAnnotationChange: function(classification, newAnnotation) {
    classification.annotations[classification.annotations.length - 1] = newAnnotation;
    return classification.update('annotations');
  },
  addAnnotationForTask: function(classification, taskKey) {
    var annotation, taskDescription;
    taskDescription = this.props.workflow.tasks[taskKey];
    annotation = tasks[taskDescription.type].getDefaultAnnotation(taskDescription, this.props.workflow, tasks);
    annotation.task = taskKey;
    classification.annotations.push(annotation);
    return classification.update('annotations');
  },
  destroyCurrentAnnotation: function() {
    this.props.classification.annotations.pop();
    return this.props.classification.update('annotations');
  },
  completeClassification: function() {
    var base, classificationQuality;
    this.props.classification.update({
      completed: true,
      'metadata.session': getSessionID(),
      'metadata.finished_at': (new Date).toISOString(),
      'metadata.viewport': {
        width: innerWidth,
        height: innerHeight
      }
    });
    if (this.state.expertClassification != null) {
      classificationQuality = testClassificationQuality(this.props.classification, this.state.expertClassification, this.props.workflow);
      console.log('Classification quality', classificationQuality);
      this.setState({
        classificationQuality: classificationQuality
      });
    }
    return typeof (base = this.props).onComplete === "function" ? base.onComplete() : void 0;
  },
  handleGoldStandardChange: function(e) {
    return this.props.classification.update({
      gold_standard: e.target.checked || void 0
    });
  },
  handleDemoModeChange: function(e) {
    return this.props.onChangeDemoMode(e.target.checked);
  },
  toggleExpertClassification: function(value) {
    return this.setState({
      showingExpertClassification: value
    });
  }
});

module.exports = React.createClass({
  displayName: 'ClassifierWrapper',
  getDefaultProps: function() {
    return {
      user: null,
      classification: {},
      onLoad: Function.prototype,
      onComplete: Function.prototype,
      onClickNext: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      workflow: null,
      subject: null,
      expertClassifier: null,
      userRoles: []
    };
  },
  componentDidMount: function() {
    this.checkExpertClassifier();
    return this.loadClassification(this.props.classification);
  },
  componentWillReceiveProps: function(nextProps) {
    if (this.props.user !== nextProps.user) {
      this.setState({
        expertClassifier: null
      });
      this.checkExpertClassifier(nextProps);
    }
    if (nextProps.classification !== this.props.classification) {
      return this.loadClassification(nextProps.classification);
    }
  },
  loadClassification: function(classification) {
    var ref, ref1;
    this.setState({
      workflow: null,
      subject: null
    });
    Promise.resolve((ref = classification._workflow) != null ? ref : classification.get('workflow')).then((function(_this) {
      return function(workflow) {
        return _this.setState({
          workflow: workflow
        });
      };
    })(this));
    return Promise.resolve((ref1 = classification._subjects) != null ? ref1 : classification.get('subjects')).then((function(_this) {
      return function(arg) {
        var subject;
        subject = arg[0];
        return _this.setState({
          subject: subject
        });
      };
    })(this));
  },
  checkExpertClassifier: function(props) {
    var getUserRoles;
    if (props == null) {
      props = this.props;
    }
    if (props.project && props.user && this.state.expertClassifier === null) {
      getUserRoles = props.project.get('project_roles', {
        user_id: props.user.id
      }).then((function(_this) {
        return function(projectRoles) {
          var getProjectRoleHavers;
          getProjectRoleHavers = Promise.all(projectRoles.map(function(projectRole) {
            return projectRole.get('owner');
          }));
          return getProjectRoleHavers.then(function(projectRoleHavers) {
            var i, j, len, results, user;
            results = [];
            for (i = j = 0, len = projectRoleHavers.length; j < len; i = ++j) {
              user = projectRoleHavers[i];
              if (user === props.user) {
                results.push(projectRoles[i].roles);
              }
            }
            return results;
          }).then(function(setsOfUserRoles) {
            return [[]].concat(slice.call(setsOfUserRoles)).reduce(function(set, next) {
              return set.concat(next);
            });
          });
        };
      })(this));
      return getUserRoles.then((function(_this) {
        return function(userRoles) {
          var expertClassifier;
          expertClassifier = isAdmin() || indexOf.call(userRoles, 'owner') >= 0 || indexOf.call(userRoles, 'collaborator') >= 0 || indexOf.call(userRoles, 'expert') >= 0;
          return _this.setState({
            expertClassifier: expertClassifier,
            userRoles: userRoles
          });
        };
      })(this));
    }
  },
  render: function() {
    if ((this.state.workflow != null) && (this.state.subject != null)) {
      return React.createElement(Classifier, React.__spread({}, this.props, {
        "workflow": this.state.workflow,
        "subject": this.state.subject,
        "expertClassifier": this.state.expertClassifier,
        "userRoles": this.state.userRoles
      }));
    } else {
      return React.createElement("span", null, "Loading classifier...");
    }
  }
});


},{"../components/change-listener":63,"../components/promise-renderer":86,"../components/subject-viewer":90,"../lib/is-admin":105,"../lib/preload-subject":109,"../lib/session":114,"../lib/test-classification-quality":116,"../lib/tutorial":118,"../lib/workflow-allows-flipbook":119,"../lib/workflow-allows-separate-frames":120,"./classification-summary":1,"./frame-annotator":15,"./tasks":36,"./tutorial-button":49,"./world_wide_telescope":51,"markdownz":"markdownz","modal-form/dialog":546,"modal-form/triggered":548,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],17:[function(require,module,exports){
var ComboTaskEditor, DragReorderable, NextTaskSelector, React;

React = require('react');

DragReorderable = require('drag-reorderable');

NextTaskSelector = require('../next-task-selector');

ComboTaskEditor = React.createClass({displayName: "ComboTaskEditor",
  getDefaultProps: function() {
    return {
      workflow: null,
      task: null,
      onChange: function() {}
    };
  },
  removeTask: function(index) {
    this.props.task.tasks.splice(index, 1);
    return this.props.onChange(this.props.task);
  },
  setOrder: function(taskKeys) {
    this.props.task.tasks = taskKeys;
    return this.props.onChange(this.props.task);
  },
  addTask: function(e) {
    var taskKey;
    taskKey = e.target.value;
    this.props.task.tasks.push(taskKey);
    console.log('>>>', this.props.task);
    return this.props.onChange(this.props.task);
  },
  setLooseRequirements: function(e) {
    var value;
    value = JSON.parse(e.target.value);
    this.props.task.loosen_requirements = value;
    return this.props.onChange(this.props.task);
  },
  setNextTask: function(e) {
    this.props.task.next = e.target.value;
    return this.props.onChange(this.props.task);
  },
  renderSubtask: function(taskKey, i) {
    var TaskComponent, taskDescription, tasks;
    tasks = require('..');
    taskDescription = this.props.workflow.tasks[taskKey];
    if (taskDescription._key == null) {
      taskDescription._key = Math.random();
    }
    TaskComponent = tasks[taskDescription.type];
    return React.createElement("li", {
      "key": taskDescription._key
    }, TaskComponent.getTaskText(taskDescription), ' ', React.createElement("button", {
      "type": "button",
      "onClick": this.removeTask.bind(this, i)
    }, "Remove"));
  },
  render: function() {
    var tasks;
    tasks = require('..');
    return React.createElement("div", null, React.createElement("p", null, "Add any number of tasks here and they\'ll be shown in one step."), (this.props.task.tasks.length === 0 ? React.createElement("p", {
      "className": "form-help"
    }, "No tasks in this combo.") : React.createElement(DragReorderable, {
      "tag": "ul",
      "items": this.props.task.tasks,
      "render": this.renderSubtask,
      "onChange": this.setOrder
    })), React.createElement("p", null, React.createElement("label", null, "Add a task:", ' ', React.createElement("select", {
      "value": "stuck",
      "onChange": this.addTask
    }, React.createElement("option", {
      "value": "stuck",
      "disabled": true
    }, "Tasks..."), Object.keys(this.props.workflow.tasks).map((function(_this) {
      return function(taskKey) {
        var TaskComponent, taskDescription;
        taskDescription = _this.props.workflow.tasks[taskKey];
        TaskComponent = tasks[taskDescription.type];
        return React.createElement("option", {
          "key": taskKey,
          "value": taskKey,
          "disabled": taskDescription.type === 'drawing'
        }, TaskComponent.getTaskText(taskDescription));
      };
    })(this))))), React.createElement("p", null, "This tasks requirements are met when", ' ', React.createElement("select", {
      "value": this.props.task.loosen_requirements,
      "onChange": this.setLooseRequirements
    }, React.createElement("option", {
      "value": "false"
    }, "all"), React.createElement("option", {
      "value": "true"
    }, "any")), ' ', "of its sub-tasks requirements are met."), React.createElement("p", null, React.createElement("label", null, "Next task:", ' ', React.createElement(NextTaskSelector, {
      "workflow": this.props.workflow,
      "value": this.props.task.next,
      "onChange": this.setNextTask
    })), React.createElement("br", null), React.createElement("span", {
      "className": "form-help"
    }, "This overrides anything set by a sub-task.")));
  }
});

module.exports = ComboTaskEditor;


},{"..":36,"../next-task-selector":38,"drag-reorderable":"drag-reorderable","react":"react"}],18:[function(require,module,exports){
var ComboTask, React;

React = require('react');

ComboTask = React.createClass({displayName: "ComboTask",
  statics: {
    Editor: require('./editor'),
    Summary: require('./summary'),
    getDefaultTask: function() {
      return {
        type: 'combo',
        tasks: []
      };
    },
    getTaskText: function(task) {
      return task.tasks.length + "-task combo";
    },
    getDefaultAnnotation: function(taskDescription, workflow, taskComponents) {
      return {
        value: taskDescription.tasks.map(function(childTaskKey) {
          var ChildTaskComponent, childTaskDescription, defaultAnnotation;
          childTaskDescription = workflow.tasks[childTaskKey];
          ChildTaskComponent = taskComponents[childTaskDescription.type];
          defaultAnnotation = ChildTaskComponent.getDefaultAnnotation(childTaskDescription, workflow, taskComponents);
          return Object.assign({
            task: childTaskKey
          }, defaultAnnotation);
        })
      };
    },
    isAnnotationComplete: function(taskDescription, annotation, workflow) {
      var method, subTasksComplete, taskTypes;
      taskTypes = require('..');
      method = taskDescription.loosen_requirements ? 'some' : 'every';
      return subTasksComplete = annotation.value[method]((function(_this) {
        return function(subAnnotation, i) {
          var SubTaskComponent, subTaskDescription, subTaskKey;
          subTaskKey = taskDescription.tasks[i];
          subTaskDescription = workflow.tasks[subTaskKey];
          SubTaskComponent = taskTypes[subTaskDescription.type];
          return SubTaskComponent.isAnnotationComplete(subTaskDescription, subAnnotation, workflow);
        };
      })(this));
    },
    testAnnotationQuality: function(unknown, knownGood, workflow) {
      var fauxKnownGoodClassification, fauxUnknownClassification, testClassificationQuality;
      testClassificationQuality = require('../../../lib/test-classification-quality');
      fauxUnknownClassification = {
        annotations: unknown.value
      };
      fauxKnownGoodClassification = {
        annotations: knownGood.value
      };
      return testClassificationQuality(fauxUnknownClassification, fauxKnownGoodClassification, workflow);
    },
    BeforeSubject: function(props) {
      return React.createElement("div", null, props.task.tasks.map(function(childTaskKey, i) {
        var TaskComponent, annotation, childTaskDescription;
        childTaskDescription = props.workflow.tasks[childTaskKey];
        TaskComponent = props.taskTypes[childTaskDescription.type];
        annotation = props.annotation.value[i];
        if (TaskComponent.BeforeSubject != null) {
          return React.createElement(TaskComponent.BeforeSubject, React.__spread({
            "key": i
          }, props, {
            "task": childTaskDescription,
            "annotation": annotation
          }));
        }
      }));
    },
    AfterSubject: function(props) {
      return React.createElement("div", null, props.task.tasks.map(function(childTaskKey, i) {
        var TaskComponent, annotation, childTaskDescription;
        childTaskDescription = props.workflow.tasks[childTaskKey];
        TaskComponent = props.taskTypes[childTaskDescription.type];
        annotation = props.annotation.value[i];
        if (TaskComponent.AfterSubject != null) {
          return React.createElement(TaskComponent.AfterSubject, React.__spread({
            "key": i
          }, props, {
            "task": childTaskDescription,
            "annotation": annotation
          }));
        }
      }));
    },
    InsideSubject: function(props) {
      return React.createElement("g", {
        "className": "combo-task-inside-subject-container"
      }, props.task.tasks.map(function(childTaskKey, i) {
        var TaskComponent, annotation, childTaskDescription;
        childTaskDescription = props.workflow.tasks[childTaskKey];
        TaskComponent = props.taskTypes[childTaskDescription.type];
        annotation = props.annotation.value[i];
        if (TaskComponent.InsideSubject != null) {
          return React.createElement(TaskComponent.InsideSubject, React.__spread({
            "key": i
          }, props, {
            "task": childTaskDescription,
            "annotation": annotation
          }));
        }
      }));
    },
    PersistInsideSubject: function(props) {
      var allComboAnnotations;
      allComboAnnotations = [];
      props.classification.annotations.forEach(function(annotation) {
        var taskDescription;
        taskDescription = props.workflow.tasks[annotation.task];
        if (taskDescription.type === 'combo') {
          return allComboAnnotations.push.apply(allComboAnnotations, annotation.value);
        }
      });
      return React.createElement("g", {
        "className": "combo-task-persist-inside-subject-container"
      }, Object.keys(props.taskTypes).map(function(taskType) {
        var TaskComponent, fauxClassification;
        if (taskType !== 'combo') {
          TaskComponent = props.taskTypes[taskType];
          if (TaskComponent.PersistInsideSubject != null) {
            fauxClassification = {
              annotations: allComboAnnotations
            };
            return React.createElement(TaskComponent.PersistInsideSubject, React.__spread({
              "key": taskType
            }, props, {
              "classification": fauxClassification
            }));
          }
        }
      }));
    }
  },
  getDefaultProps: function() {
    return {
      taskTypes: null,
      workflow: null,
      task: null,
      annotation: null,
      onChange: function() {}
    };
  },
  handleChange: function(index, newSubAnnotation) {
    var newAnnotation, value;
    value = this.props.annotation.value.slice(0);
    value[index] = newSubAnnotation;
    newAnnotation = Object.assign(this.props.annotation, {
      value: value
    });
    return this.props.onChange(newAnnotation);
  },
  render: function() {
    return React.createElement("div", null, this.props.task.tasks.map((function(_this) {
      return function(task, i) {
        var TaskComponent, annotation, taskDescription, unsupported;
        taskDescription = _this.props.workflow.tasks[task];
        TaskComponent = _this.props.taskTypes[taskDescription.type];
        annotation = _this.props.annotation.value[i];
        unsupported = TaskComponent === _this.props.taskTypes.drawing;
        return React.createElement("div", {
          "key": i,
          "style": (unsupported ? {
            outline: '1px solid red'
          } : void 0)
        }, (unsupported ? React.createElement("div", {
          "className": "form-help warning"
        }, React.createElement("small", null, React.createElement("strong", null, "This task might not work as part of a combo at this time."))) : void 0), React.createElement(TaskComponent, React.__spread({}, _this.props, {
          "autoFocus": i === 0,
          "task": taskDescription,
          "annotation": annotation,
          "onChange": _this.handleChange.bind(_this, i)
        })));
      };
    })(this)));
  }
});

module.exports = ComboTask;


},{"..":36,"../../../lib/test-classification-quality":116,"./editor":17,"./summary":19,"react":"react"}],19:[function(require,module,exports){
var ComboTaskSummary, React;

React = require('react');

ComboTaskSummary = React.createClass({displayName: "ComboTaskSummary",
  getDefaultProps: function() {
    return {
      task: null
    };
  },
  render: function() {
    return React.createElement("div", null, "(", this.props.task.tasks.length, "-task combo)");
  }
});

module.exports = ComboTaskSummary;


},{"react":"react"}],20:[function(require,module,exports){
var CropInitializer, GenericEditor, GenericTask, React, Summary;

React = require('react');

CropInitializer = require('./initializer');

GenericTask = require('../generic');

GenericEditor = require('../generic-editor');

Summary = require('./summary');

module.exports = React.createClass({
  displayName: 'CropTask',
  statics: {
    Editor: GenericEditor,
    Summary: Summary,
    getSVGProps: function(arg) {
      var annotation, classification, height, previousCropAnnotation, ref, tasks, width, workflow, x, y;
      workflow = arg.workflow, classification = arg.classification, annotation = arg.annotation;
      tasks = require('../index');
      previousCropAnnotation = classification.annotations.filter((function(_this) {
        return function(anAnnotation) {
          var TaskComponent, taskDescription;
          taskDescription = workflow.tasks[anAnnotation.task];
          TaskComponent = tasks[taskDescription.type];
          return TaskComponent === _this && (anAnnotation.value != null) && anAnnotation !== annotation;
        };
      })(this))[0];
      if (previousCropAnnotation != null) {
        ref = previousCropAnnotation.value, x = ref.x, y = ref.y, width = ref.width, height = ref.height;
        return {
          viewBox: x + " " + y + " " + width + " " + height
        };
      }
    },
    InsideSubject: CropInitializer,
    getDefaultTask: function() {
      return {
        type: 'crop',
        instruction: 'Drag to select the relevant area.',
        help: ''
      };
    },
    getTaskText: function(task) {
      return task.instruction;
    },
    getDefaultAnnotation: function() {
      return {
        value: null
      };
    },
    isAnnotationComplete: function(task, annotation) {
      return (annotation.value != null) || !task.required;
    },
    testAnnotationQuality: function(unknown, knownGood) {
      var intersectArea, intersectX, intersectY, knownGoodArea, knownGoodX2, knownGoodY2, unionArea, unknownArea, unknownX2, unknownY2;
      if (unknown.value === null || knownGood.value === null) {
        if (unknown.value === knownGood.value) {
          return 1;
        } else {
          return 0;
        }
      } else {
        unknownX2 = unknown.value.x + unknown.value.width;
        unknownY2 = unknown.value.y + unknown.value.height;
        knownGoodX2 = knownGood.value.x + knownGood.value.width;
        knownGoodY2 = knownGood.value.y + knownGood.value.height;
        intersectX = Math.max(0, Math.min(unknownX2, knownGoodX2) - Math.max(unknown.value.x, knownGood.value.x));
        intersectY = Math.max(0, Math.min(unknownY2, knownGoodY2) - Math.max(unknown.value.y, knownGood.value.y));
        intersectArea = intersectX * intersectY;
        unknownArea = unknown.value.width * unknown.value.height;
        knownGoodArea = knownGood.value.width * knownGood.value.height;
        unionArea = (unknownArea + knownGoodArea) - intersectArea;
        return intersectArea / unionArea;
      }
    }
  },
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      onChange: Function.prototype
    };
  },
  render: function() {
    return React.createElement(GenericTask, {
      "question": this.props.task.instruction,
      "help": this.props.task.help,
      "required": this.props.task.required
    }, React.createElement("p", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "disabled": this.props.annotation.value == null,
      "onClick": this.handleClear
    }, "Clear current crop")));
  },
  handleClear: function() {
    var newAnnotation;
    newAnnotation = Object.assign({}, this.props.annotation, {
      value: null
    });
    return this.props.onChange(newAnnotation);
  }
});


},{"../generic":35,"../generic-editor":34,"../index":36,"./initializer":21,"./summary":22,"react":"react"}],21:[function(require,module,exports){
var DragHandle, Draggable, React;

React = require('react');

Draggable = require('../../../lib/draggable');

DragHandle = require('../../drawing-tools/drag-handle');

module.exports = React.createClass({
  displayName: 'CropInitializer',
  render: function() {
    var height, ref, width, x, y;
    return React.createElement("g", null, React.createElement(Draggable, {
      "onStart": this.handleInitStart,
      "onDrag": this.handleInitDrag
    }, React.createElement("rect", {
      "x": "0",
      "y": "0",
      "width": "100%",
      "height": "100%",
      "fill": "rgba(0, 0, 0, 0.001)",
      "style": {
        cursor: 'crosshair'
      }
    })), (this.props.annotation.value != null ? ((ref = this.props.annotation.value, x = ref.x, y = ref.y, width = ref.width, height = ref.height, ref), React.createElement("g", null, React.createElement("g", {
      "fill": "rgba(0, 0, 0, 0.5)",
      "stroke": "none",
      "style": {
        pointerEvents: 'none'
      }
    }, React.createElement("rect", {
      "x": "0",
      "y": "0",
      "width": x,
      "height": "100%"
    }), React.createElement("rect", {
      "x": x + width,
      "y": "0",
      "width": (this.props.containerRect.width / this.props.scale.horizontal) - (x + width),
      "height": "100%"
    }), React.createElement("rect", {
      "x": x,
      "y": "0",
      "width": width,
      "height": y
    }), React.createElement("rect", {
      "x": x,
      "y": y + height,
      "width": width,
      "height": (this.props.containerRect.height / this.props.scale.vertical) - (y + height)
    })), React.createElement("rect", {
      "x": x,
      "y": "-10",
      "width": width,
      "height": "110%",
      "fill": "none",
      "stroke": "rgba(127, 127, 127, 0.5)",
      "strokeWidth": 1 / this.props.scale.horizontal
    }), React.createElement("rect", {
      "x": "-10",
      "y": y,
      "width": "110%",
      "height": height,
      "fill": "none",
      "stroke": "rgba(127, 127, 127, 0.5)",
      "strokeWidth": 1 / this.props.scale.vertical
    }), React.createElement(Draggable, {
      "onDrag": this.handleBoxDrag
    }, React.createElement("rect", {
      "x": x,
      "y": y,
      "width": width,
      "height": height,
      "fill": "rgba(255, 255, 255, 0.001)",
      "stroke": "black",
      "strokeWidth": 1 / this.props.scale.horizontal,
      "style": {
        cursor: 'move'
      }
    })), React.createElement("g", {
      "style": {
        color: 'white'
      }
    }, React.createElement(DragHandle, {
      "x": x,
      "y": y + (height / 2),
      "scale": this.props.scale,
      "onStart": this.handleStartHandle,
      "onDrag": this.handleDragNear.bind(this, 'x'),
      "style": {
        cursor: 'ew-resize'
      }
    }), React.createElement(DragHandle, {
      "x": x + width,
      "y": y + (height / 2),
      "scale": this.props.scale,
      "onStart": this.handleStartHandle,
      "onDrag": this.handleDragFar.bind(this, 'x'),
      "style": {
        cursor: 'ew-resize'
      }
    }), React.createElement(DragHandle, {
      "x": x + (width / 2),
      "y": y,
      "scale": this.props.scale,
      "onStart": this.handleStartHandle,
      "onDrag": this.handleDragNear.bind(this, 'y'),
      "style": {
        cursor: 'ns-resize'
      }
    }), React.createElement(DragHandle, {
      "x": x + (width / 2),
      "y": y + height,
      "scale": this.props.scale,
      "onStart": this.handleStartHandle,
      "onDrag": this.handleDragFar.bind(this, 'y'),
      "style": {
        cursor: 'ns-resize'
      }
    })))) : void 0));
  },
  handleInitStart: function(e) {
    var _start, ref, x, y;
    ref = this.props.getEventOffset(e), x = ref.x, y = ref.y;
    _start = {
      x: x,
      y: y
    };
    this.props.annotation.value = {
      x: x,
      y: y,
      width: 0,
      height: 0,
      _start: _start
    };
    return this.props.classification.update('annotation');
  },
  handleInitDrag: function(e) {
    var _start, ref, x, y;
    ref = this.props.getEventOffset(e), x = ref.x, y = ref.y;
    x = Math.max(0, Math.min(x, this.props.containerRect.width / this.props.scale.horizontal));
    y = Math.max(0, Math.min(y, this.props.containerRect.height / this.props.scale.vertical));
    _start = this.props.annotation.value._start;
    this.props.annotation.value.x = Math.min(_start.x, x);
    this.props.annotation.value.y = Math.min(_start.y, y);
    this.props.annotation.value.width = Math.abs(_start.x - x);
    this.props.annotation.value.height = Math.abs(_start.y - y);
    return this.props.classification.update('annotation');
  },
  handleBoxDrag: function(e, d) {
    var maxX, maxY;
    maxX = (this.props.containerRect.width / this.props.scale.horizontal) - this.props.annotation.value.width;
    maxY = (this.props.containerRect.height / this.props.scale.vertical) - this.props.annotation.value.height;
    this.props.annotation.value.x = Math.max(0, Math.min(maxX, this.props.annotation.value.x + d.x));
    this.props.annotation.value.y = Math.max(0, Math.min(maxY, this.props.annotation.value.y + d.y));
    return this.props.classification.update('annotations');
  },
  handleStartHandle: function(e) {
    var height, mouse, rect, ref, width, x, y;
    mouse = this.props.getEventOffset(e);
    ref = this.props.annotation.value, x = ref.x, y = ref.y, width = ref.width, height = ref.height;
    rect = {
      x: x,
      y: y,
      width: width,
      height: height
    };
    return this.props.annotation.value._start = {
      mouse: mouse,
      rect: rect
    };
  },
  handleDragNear: function(coord, e) {
    var _start, diff, dimension, direction, mouse;
    dimension = {
      x: 'width',
      y: 'height'
    }[coord];
    direction = {
      x: 'horizontal',
      y: 'vertical'
    }[coord];
    mouse = this.props.getEventOffset(e);
    mouse[coord] = Math.max(0, Math.min(mouse[coord], this.props.containerRect[dimension] / this.props.scale[direction]));
    _start = this.props.annotation.value._start;
    diff = _start.mouse[coord] - mouse[coord];
    this.props.annotation.value[coord] = Math.min(_start.mouse[coord] + _start.rect[dimension], mouse[coord]);
    this.props.annotation.value[dimension] = Math.abs(_start.rect[dimension] + diff);
    return this.props.classification.update('annotation');
  },
  handleDragFar: function(coord, e) {
    var _start, diff, dimension, direction, mouse;
    dimension = {
      x: 'width',
      y: 'height'
    }[coord];
    direction = {
      x: 'horizontal',
      y: 'vertical'
    }[coord];
    mouse = this.props.getEventOffset(e);
    mouse[coord] = Math.max(0, Math.min(mouse[coord], this.props.containerRect[dimension] / this.props.scale[direction]));
    _start = this.props.annotation.value._start;
    diff = _start.mouse[coord] - mouse[coord];
    this.props.annotation.value[coord] = Math.min(_start.rect[coord], mouse[coord]);
    this.props.annotation.value[dimension] = Math.abs(_start.rect[dimension] - diff);
    return this.props.classification.update('annotation');
  }
});


},{"../../../lib/draggable":100,"../../drawing-tools/drag-handle":6,"react":"react"}],22:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'CropSummary',
  render: function() {
    var height, ref, summaryContent, width, x, y;
    summaryContent = this.props.annotation.value != null ? ((ref = this.props.annotation.value, x = ref.x, y = ref.y, width = ref.width, height = ref.height, ref), React.createElement("span", null, Math.round(width), "  ", Math.round(height), " at ", Math.round(x), ", ", Math.round(y))) : React.createElement("small", null, "No area cropped");
    return React.createElement("div", null, React.createElement("div", {
      "className": "question"
    }, this.props.task.instruction), React.createElement("div", {
      "className": "answer"
    }, summaryContent));
  }
});


},{"react":"react"}],23:[function(require,module,exports){
var AutoSave, React, TriggeredModalForm,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
  slice = [].slice;

React = require('react');

AutoSave = require('../../components/auto-save');

TriggeredModalForm = require('modal-form/triggered');

module.exports = React.createClass({
  displayName: 'DrawingTaskDetailsEditor',
  getDefaultProps: function() {
    return {
      workflow: null,
      task: null,
      details: null,
      toolIndex: NaN,
      toolPath: '',
      onClose: null
    };
  },
  render: function() {
    var GenericTaskEditor, i, subtask;
    GenericTaskEditor = require('./generic-editor');
    return React.createElement("div", {
      "className": "drawing-task-details-editor"
    }, React.createElement("div", {
      "className": "sub-tasks"
    }, ((function() {
      var j, len, ref, results;
      if (this.props.details.length === 0) {
        return React.createElement("span", {
          "className": "form-help"
        }, "No sub-tasks defined for this tool");
      } else {
        ref = this.props.details;
        results = [];
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          subtask = ref[i];
          if (subtask._key == null) {
            subtask._key = Math.random();
          }
          results.push(React.createElement("div", {
            "key": subtask._key,
            "className": "drawing-task-details-editor-subtask-wrapper"
          }, React.createElement(GenericTaskEditor, {
            "workflow": this.props.workflow,
            "task": subtask,
            "taskPrefix": this.props.toolPath + ".details." + i,
            "isSubtask": true,
            "onChange": this.handleSubtaskChange.bind(this, i),
            "onDelete": this.handleSubtaskDelete.bind(this, i)
          }), React.createElement(AutoSave, {
            "resource": this.props.workflow
          }, React.createElement("button", {
            "type": "button",
            "className": "subtask-delete",
            "aria-label": "Remove subtask",
            "title": "Remove subtask",
            "onClick": this.handleSubtaskDelete.bind(this, i)
          }, ""))));
        }
        return results;
      }
    }).call(this))), React.createElement("div", {
      "className": "commands columns-container"
    }, React.createElement("p", null, React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("span", {
        "className": "standard-button"
      }, React.createElement("i", {
        "className": "fa fa-plus-circle"
      }), ' ', "Add a task")
    }, React.createElement("button", {
      "type": "submit",
      "className": "minor-button",
      "onClick": this.handleAddTask.bind(this, 'single'),
      "title": "Question tasks: the volunteer chooses from among a list of answers but does not mark or draw on the image(s)."
    }, React.createElement("i", {
      "className": "fa fa-question-circle fa-2x"
    }), React.createElement("br", null), React.createElement("small", null, React.createElement("strong", null, "Question"))), ' ', (this.canUseTask("text") ? React.createElement("button", {
      "type": "submit",
      "className": "minor-button",
      "onClick": this.handleAddTask.bind(this, 'text'),
      "title": "Text tasks: the volunteer writes free-form text into a dialog box."
    }, React.createElement("i", {
      "className": "fa fa-file-text-o fa-2x"
    }), React.createElement("br", null), React.createElement("small", null, React.createElement("strong", null, "Text"))) : void 0)))));
  },
  canUseTask: function(task) {
    return indexOf.call(this.props.project.experimental_tools, task) >= 0;
  },
  handleAddTask: function(task) {
    var TaskChoice;
    switch (task) {
      case 'single':
        TaskChoice = require('./single');
        break;
      case 'text':
        TaskChoice = require('./text');
    }
    this.props.task.tools[this.props.toolIndex].details.push(TaskChoice.getDefaultTask());
    this.props.workflow.update('tasks');
    return this.props.workflow.save();
  },
  handleSubtaskChange: function(subtaskIndex, path, value) {
    var changes, description, key, taskKey;
    if (typeof console !== "undefined" && console !== null) {
      console.log.apply(console, ['Handling subtask change'].concat(slice.call(arguments)));
    }
    taskKey = ((function() {
      var ref, results;
      ref = this.props.workflow.tasks;
      results = [];
      for (key in ref) {
        description = ref[key];
        if (description === this.props.task) {
          results.push(key);
        }
      }
      return results;
    }).call(this))[0];
    changes = {};
    changes[this.props.toolPath + ".details." + subtaskIndex + "." + path] = value;
    this.props.workflow.update(changes).save();
    return typeof console !== "undefined" && console !== null ? console.log(changes, this.props.workflow) : void 0;
  },
  handleSubtaskDelete: function(subtaskIndex) {
    this.props.task.tools[this.props.toolIndex].details.splice(subtaskIndex, 1);
    return this.props.workflow.update('tasks').save();
  }
});


},{"../../components/auto-save":62,"./generic-editor":34,"./single":39,"./text":48,"modal-form/triggered":548,"react":"react"}],24:[function(require,module,exports){
var HidePreviousMarksToggle, React;

React = require('react');

HidePreviousMarksToggle = React.createClass({displayName: "HidePreviousMarksToggle",
  getDefaultProps: function() {
    return {
      taskTypes: null,
      workflow: null,
      classification: null,
      onChange: function() {}
    };
  },
  componentDidMount: function() {
    return this._lastKnownAnnotationCount = this.props.classification.annotations.length;
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.classification.annotations.length !== this._lastKnownAnnotationCount) {
      return this.setPreviousMarks(0);
    }
  },
  setPreviousMarks: function(count) {
    this._lastKnownAnnotationCount = this.props.classification.annotations.length;
    this.props.classification._hideMarksBefore = count;
    return this.props.onChange(this.props.classification);
  },
  render: function() {
    var DrawingTaskComponent, annotations, checkedStyle, currentAnnotation, currentlyHidingMarks, marksCount, nextValueToSet;
    annotations = this.props.classification.annotations;
    currentAnnotation = annotations[annotations.length - 1];
    if (!this.props.workflow.tasks[currentAnnotation.task].enableHidePrevMarks) {
      return null;
    }
    DrawingTaskComponent = require('.');
    currentlyHidingMarks = this.props.classification._hideMarksBefore > 0;
    marksCount = 0;
    annotations.forEach((function(_this) {
      return function(annotation) {
        var TaskComponent, taskDescription;
        taskDescription = _this.props.workflow.tasks[annotation.task];
        TaskComponent = _this.props.taskTypes[taskDescription.type];
        if (TaskComponent === DrawingTaskComponent) {
          return marksCount += annotation.value.length;
        }
      };
    })(this));
    nextValueToSet = currentlyHidingMarks ? 0 : marksCount;
    checkedStyle = {
      background: 'rgba(255, 0, 0, 0.7)',
      color: 'white'
    };
    return React.createElement("div", null, React.createElement("label", {
      "style": (currentlyHidingMarks ? checkedStyle : void 0)
    }, React.createElement("input", {
      "type": "checkbox",
      "checked": currentlyHidingMarks,
      "disabled": marksCount === 0,
      "onChange": this.setPreviousMarks.bind(this, nextValueToSet)
    }), ' ', "Hide previous marks ", (marksCount > 0 ? '(' + marksCount + ')' : void 0)));
  }
});

module.exports = HidePreviousMarksToggle;


},{".":26,"react":"react"}],25:[function(require,module,exports){
var React;

React = require('react');

module.exports = {
  point: React.createElement("svg", {
    "viewBox": "0 0 100 100"
  }, React.createElement("circle", {
    "className": "shape",
    "r": "30",
    "cx": "50",
    "cy": "50"
  }), React.createElement("line", {
    "className": "shape",
    "x1": "50",
    "y1": "5",
    "x2": "50",
    "y2": "40"
  }), React.createElement("line", {
    "className": "shape",
    "x1": "95",
    "y1": "50",
    "x2": "60",
    "y2": "50"
  }), React.createElement("line", {
    "className": "shape",
    "x1": "50",
    "y1": "95",
    "x2": "50",
    "y2": "60"
  }), React.createElement("line", {
    "className": "shape",
    "x1": "5",
    "y1": "50",
    "x2": "40",
    "y2": "50"
  })),
  line: React.createElement("svg", {
    "viewBox": "0 0 100 100"
  }, React.createElement("line", {
    "className": "shape",
    "x1": "25",
    "y1": "90",
    "x2": "75",
    "y2": "10"
  })),
  rectangle: React.createElement("svg", {
    "viewBox": "0 0 100 100"
  }, React.createElement("rect", {
    "className": "shape",
    "x": "10",
    "y": "30",
    "width": "80",
    "height": "40"
  })),
  polygon: React.createElement("svg", {
    "viewBox": "0 0 100 100"
  }, React.createElement("polyline", {
    "className": "shape",
    "points": "50, 5 90, 90 50, 70 5, 90 50, 5"
  })),
  circle: React.createElement("svg", {
    "viewBox": "0 0 100 100"
  }, React.createElement("ellipse", {
    "className": "shape",
    "rx": "33",
    "ry": "33",
    "cx": "50",
    "cy": "50"
  })),
  ellipse: React.createElement("svg", {
    "viewBox": "0 0 100 100"
  }, React.createElement("ellipse", {
    "className": "shape",
    "rx": "45",
    "ry": "25",
    "cx": "50",
    "cy": "50",
    "transform": "rotate(-30, 50, 50)"
  })),
  bezier: React.createElement("svg", {
    "viewBox": "0 0 100 100"
  }, React.createElement("path", {
    "d": "M90 90 Q 10 50 90 10",
    "fill": 'none'
  }), React.createElement("path", {
    "d": "M90 90 L 10 50 L 90 10",
    "strokeDasharray": [10, 10],
    "fill": 'none'
  })),
  column: React.createElement("svg", {
    "viewBox": "0 0 100 100"
  }, React.createElement("rect", {
    "className": "shape",
    "x": "10",
    "y": "0",
    "width": "25",
    "height": "100%"
  }))
};


},{"react":"react"}],26:[function(require,module,exports){
var GenericTask, GenericTaskEditor, HidePreviousMarksToggle, Markdown, MarkingInitializer, MarkingsRenderer, React, Summary, drawingTools, icons, testShapeCloseness;

React = require('react');

GenericTaskEditor = require('../generic-editor');

Summary = require('./summary');

MarkingInitializer = require('./marking-initializer');

MarkingsRenderer = require('./markings-renderer');

HidePreviousMarksToggle = require('./hide-previous-marks-toggle');

GenericTask = require('../generic');

testShapeCloseness = require('test-shape-closeness');

Markdown = require('markdownz').Markdown;

icons = require('./icons');

drawingTools = require('../../drawing-tools');

module.exports = React.createClass({
  displayName: 'DrawingTask',
  statics: {
    Editor: GenericTaskEditor,
    Summary: Summary,
    InsideSubject: MarkingInitializer,
    PersistInsideSubject: MarkingsRenderer,
    PersistAfterTask: HidePreviousMarksToggle,
    getDefaultTask: function() {
      return {
        type: 'drawing',
        instruction: 'Explain what to draw.',
        help: '',
        tools: []
      };
    },
    getTaskText: function(task) {
      return task.instruction;
    },
    getDefaultAnnotation: function() {
      return {
        _toolIndex: 0,
        value: []
      };
    },
    closeAllMarks: function(task, annotation) {
      var ToolComponent, j, len, mark, ref, results, toolDescription;
      ref = annotation.value;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        mark = ref[j];
        toolDescription = task.tools[mark.tool];
        ToolComponent = drawingTools[toolDescription.type];
        if ((ToolComponent.isComplete != null) && (ToolComponent.forceComplete != null)) {
          if (!ToolComponent.isComplete(mark)) {
            results.push(ToolComponent.forceComplete(mark));
          } else {
            results.push(void 0);
          }
        } else {
          results.push(void 0);
        }
      }
      return results;
    },
    onLeaveAnnotation: function(task, annotation) {
      return this.closeAllMarks(task, annotation);
    },
    areThereEnoughMarks: function(task, annotation) {
      var marksByTool;
      marksByTool = {};
      annotation.value.forEach(function(mark) {
        var name;
        if (marksByTool[name = mark.tool] == null) {
          marksByTool[name] = 0;
        }
        return marksByTool[mark.tool] += 1;
      });
      return task.tools.every(function(toolDescription, i) {
        var ref, ref1;
        return ((ref = marksByTool[i]) != null ? ref : 0) >= ((ref1 = toolDescription.min) != null ? ref1 : 0);
      });
    },
    areMarksComplete: function(task, annotation) {
      var DetailTaskComponent, detail, i, j, k, len, len1, mark, ref, ref1, ref2, subAnnotation, tasks, toolDescription;
      tasks = require('..');
      ref = annotation.value;
      for (j = 0, len = ref.length; j < len; j++) {
        mark = ref[j];
        toolDescription = task.tools[mark.tool];
        ref2 = (ref1 = toolDescription.details) != null ? ref1 : [];
        for (i = k = 0, len1 = ref2.length; k < len1; i = ++k) {
          detail = ref2[i];
          if (!detail.required) {
            continue;
          }
          subAnnotation = mark.details[i];
          DetailTaskComponent = tasks[detail.type];
          if (DetailTaskComponent.isAnnotationComplete != null) {
            if (!DetailTaskComponent.isAnnotationComplete(detail, subAnnotation)) {
              return false;
            }
          }
        }
      }
      return true;
    },
    isAnnotationComplete: function(task, annotation) {
      var ref;
      return this.areMarksComplete(task, annotation) && this.areThereEnoughMarks(task, annotation) && annotation.value.length >= ((ref = task.required) != null ? ref : 0);
    },
    testAnnotationQuality: function(unknown, knownGood, workflow) {
      var knownGoodShapes, knownGoodTaskDescription, unknownShapes, unknownTaskDescription;
      unknownTaskDescription = workflow.tasks[unknown.task];
      unknownShapes = unknown.value.map(function(annotationShape) {
        var toolDescription;
        toolDescription = unknownTaskDescription.tools[annotationShape.tool];
        return Object.assign({}, annotationShape, {
          type: toolDescription.type
        });
      });
      knownGoodTaskDescription = workflow.tasks[knownGood.task];
      knownGoodShapes = knownGood.value.map(function(annotationShape) {
        var toolDescription;
        toolDescription = knownGoodTaskDescription.tools[annotationShape.tool];
        return Object.assign({}, annotationShape, {
          type: toolDescription.type
        });
      });
      return testShapeCloseness(unknownShapes.concat(knownGoodShapes));
    }
  },
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      onChange: Function.prototype
    };
  },
  render: function() {
    var count, i, mark, tool, tools;
    tools = (function() {
      var j, len, ref, ref1, ref2, results;
      ref = this.props.task.tools;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        tool = ref[i];
        if (tool._key == null) {
          tool._key = Math.random();
        }
        count = ((function() {
          var k, len1, ref1, results1;
          ref1 = this.props.annotation.value;
          results1 = [];
          for (k = 0, len1 = ref1.length; k < len1; k++) {
            mark = ref1[k];
            if (mark.tool === i) {
              results1.push(true);
            }
          }
          return results1;
        }).call(this)).length;
        results.push(React.createElement("label", {
          "key": tool._key
        }, React.createElement("input", {
          "name": i,
          "autoFocus": this.props.autoFocus && i === 0,
          "type": "radio",
          "className": "drawing-tool-button-input",
          "checked": i === ((ref1 = this.props.annotation._toolIndex) != null ? ref1 : 0),
          "onChange": this.handleChange.bind(this, i)
        }), React.createElement("div", {
          "className": "minor-button answer-button " + (i === ((ref2 = this.props.annotation._toolIndex) != null ? ref2 : 0) ? 'active' : '')
        }, React.createElement("div", {
          "className": "answer-button-icon-container"
        }, React.createElement("span", {
          "className": "drawing-tool-button-icon",
          "style": {
            color: tool.color
          }
        }, icons[tool.type])), React.createElement("div", {
          "className": "answer-button-label-container"
        }, React.createElement(Markdown, {
          "className": "answer-button-label"
        }, tool.label), React.createElement("div", {
          "className": "answer-button-status"
        }, count + ' ', ((tool.min != null) || (tool.max != null) ? 'of ' : void 0), (tool.min != null ? React.createElement("span", {
          "style": (count < tool.min ? {
            color: 'red'
          } : void 0)
        }, tool.min, " required") : void 0), ((tool.min != null) && (tool.max != null) ? ', ' : void 0), (tool.max != null ? React.createElement("span", {
          "style": (count === tool.max ? {
            color: 'orange'
          } : void 0)
        }, tool.max, " maximum") : void 0), ' ', "drawn")))));
      }
      return results;
    }).call(this);
    return React.createElement(GenericTask, {
      "question": this.props.task.instruction,
      "help": this.props.task.help,
      "answers": tools,
      "required": this.props.task.required
    });
  },
  handleChange: function(toolIndex, e) {
    var newAnnotation;
    this.constructor.closeAllMarks(this.props.task, this.props.annotation);
    if (e.target.checked) {
      newAnnotation = Object.assign({}, this.props.annotation, {
        _toolIndex: toolIndex
      });
      return this.props.onChange(newAnnotation);
    }
  }
});


},{"..":36,"../../drawing-tools":8,"../generic":35,"../generic-editor":34,"./hide-previous-marks-toggle":24,"./icons":25,"./marking-initializer":27,"./markings-renderer":28,"./summary":29,"markdownz":"markdownz","react":"react","test-shape-closeness":"test-shape-closeness"}],27:[function(require,module,exports){
var Draggable, React, drawingTools;

React = require('react');

Draggable = require('../../../lib/draggable');

drawingTools = require('../../drawing-tools');

module.exports = React.createClass({
  displayName: 'MarkingInitializer',
  getDefaultProps: function() {
    return {
      annotation: null,
      workflow: null,
      frame: 0,
      getEventOffset: null
    };
  },
  render: function() {
    var canMakeMarks, marksFromCurrentTool, ref, toolDescription;
    toolDescription = this.props.task.tools[this.props.annotation._toolIndex];
    marksFromCurrentTool = this.props.annotation.value.filter((function(_this) {
      return function(mark) {
        return mark.tool === _this.props.annotation._toolIndex;
      };
    })(this));
    canMakeMarks = marksFromCurrentTool.length < ((ref = toolDescription.max) != null ? ref : Infinity);
    return React.createElement(Draggable, {
      "onStart": this.handleInitStart,
      "onDrag": this.handleInitDrag,
      "onEnd": this.handleInitRelease,
      "disabled": !canMakeMarks
    }, React.createElement("rect", {
      "className": "marking-initializer",
      "width": this.props.naturalWidth,
      "height": this.props.naturalHeight,
      "fill": "transparent",
      "stroke": "none"
    }));
  },
  handleInitStart: function(e) {
    var MarkComponent, defaultValues, detailTaskDescription, initValues, key, mark, markIsComplete, mouseCoords, taskDescription, tasks, toolDescription, value;
    tasks = require('..');
    taskDescription = this.props.workflow.tasks[this.props.annotation.task];
    mark = this.props.annotation.value[this.props.annotation.value.length - 1];
    markIsComplete = true;
    if (mark != null) {
      toolDescription = taskDescription.tools[mark.tool];
      MarkComponent = drawingTools[toolDescription.type];
      if (MarkComponent.isComplete != null) {
        markIsComplete = MarkComponent.isComplete(mark);
      }
    }
    mouseCoords = this.props.getEventOffset(e);
    if (markIsComplete) {
      toolDescription = taskDescription.tools[this.props.annotation._toolIndex];
      mark = {
        tool: this.props.annotation._toolIndex,
        frame: this.props.frame
      };
      if (toolDescription.details != null) {
        mark.details = (function() {
          var i, len, ref, results;
          ref = toolDescription.details;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            detailTaskDescription = ref[i];
            results.push(tasks[detailTaskDescription.type].getDefaultAnnotation(detailTaskDescription, this.props.workflow, tasks));
          }
          return results;
        }).call(this);
      }
      this.props.annotation.value.push(mark);
      MarkComponent = drawingTools[toolDescription.type];
      if (MarkComponent.defaultValues != null) {
        defaultValues = MarkComponent.defaultValues(mouseCoords);
        for (key in defaultValues) {
          value = defaultValues[key];
          mark[key] = value;
        }
      }
    }
    if (MarkComponent.initStart != null) {
      initValues = MarkComponent.initStart(mouseCoords, mark, e);
      for (key in initValues) {
        value = initValues[key];
        mark[key] = value;
      }
    }
    return this.props.classification.update('annotations');
  },
  handleInitDrag: function(e) {
    var MarkComponent, initMoveValues, key, mark, mouseCoords, taskDescription, value;
    taskDescription = this.props.workflow.tasks[this.props.annotation.task];
    mark = this.props.annotation.value[this.props.annotation.value.length - 1];
    MarkComponent = drawingTools[taskDescription.tools[mark.tool].type];
    if (MarkComponent.initMove != null) {
      mouseCoords = this.props.getEventOffset(e);
      initMoveValues = MarkComponent.initMove(mouseCoords, mark, e);
      for (key in initMoveValues) {
        value = initMoveValues[key];
        mark[key] = value;
      }
    }
    return this.props.classification.update('annotations');
  },
  handleInitRelease: function(e) {
    var MarkComponent, initReleaseValues, key, mark, mouseCoords, taskDescription, value;
    taskDescription = this.props.workflow.tasks[this.props.annotation.task];
    mark = this.props.annotation.value[this.props.annotation.value.length - 1];
    MarkComponent = drawingTools[taskDescription.tools[mark.tool].type];
    if (MarkComponent.initRelease != null) {
      mouseCoords = this.props.getEventOffset(e);
      initReleaseValues = MarkComponent.initRelease(mouseCoords, mark, e);
      for (key in initReleaseValues) {
        value = initReleaseValues[key];
        mark[key] = value;
      }
    }
    this.props.classification.update('annotations');
    if (MarkComponent.initValid != null) {
      if (!MarkComponent.initValid(mark, this.props)) {
        return this.destroyMark(this.props.annotation, mark);
      }
    }
  },
  destroyMark: function(annotation, mark) {
    var markIndex, ref;
    if (mark === ((ref = this.state) != null ? ref.selectedMark : void 0)) {
      this.setState({
        selectedMark: null
      });
    }
    markIndex = annotation.value.indexOf(mark);
    annotation.value.splice(markIndex, 1);
    return this.props.classification.update('annotations');
  }
});


},{"..":36,"../../../lib/draggable":100,"../../drawing-tools":8,"react":"react"}],28:[function(require,module,exports){
var React, drawingTools,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

drawingTools = require('../../drawing-tools');

module.exports = React.createClass({
  displayName: 'MarkingsRenderer',
  getDefaultProps: function() {
    return {
      classification: null,
      annotation: null,
      workflow: null,
      scale: null
    };
  },
  getInitialState: function() {
    return {
      selection: null,
      oldSetOfMarks: []
    };
  },
  componentWillReceiveProps: function(nextProps) {
    var annotation, annotations, j, len, mark, newSetOfMarks, ref, ref1, ref2, ref3, taskDescription;
    newSetOfMarks = [];
    annotations = (ref = (ref1 = nextProps.classification) != null ? ref1.annotations : void 0) != null ? ref : [];
    annotation = annotations[annotations.length - 1];
    if (annotation != null) {
      taskDescription = (ref2 = this.props.workflow) != null ? ref2.tasks[annotation.task] : void 0;
    }
    if ((taskDescription != null ? taskDescription.type : void 0) === 'drawing' && Array.isArray(annotation.value)) {
      ref3 = annotation.value;
      for (j = 0, len = ref3.length; j < len; j++) {
        mark = ref3[j];
        newSetOfMarks.push(mark);
        if (nextProps.annotation === this.props.annotation && indexOf.call(this.state.oldSetOfMarks, mark) < 0) {
          this.setState({
            selection: mark
          });
        }
      }
    } else {
      this.setState({
        selection: null
      });
    }
    return this.setState({
      oldSetOfMarks: newSetOfMarks
    });
  },
  render: function() {
    var ToolComponent, annotation, i, isPriorAnnotation, mark, skippedMarks, taskDescription, toolDescription, toolEnv, toolMethods, toolProps;
    skippedMarks = 0;
    return React.createElement("g", null, (function() {
      var j, len, ref, ref1, ref2, results;
      ref2 = (ref = (ref1 = this.props.classification) != null ? ref1.annotations : void 0) != null ? ref : [];
      results = [];
      for (j = 0, len = ref2.length; j < len; j++) {
        annotation = ref2[j];
        if (annotation._key == null) {
          annotation._key = Math.random();
        }
        isPriorAnnotation = annotation !== this.props.annotation;
        taskDescription = this.props.workflow.tasks[annotation.task];
        if (taskDescription.type === 'drawing') {
          results.push(React.createElement("g", {
            "key": annotation._key,
            "className": "marks-for-annotation",
            "data-disabled": isPriorAnnotation || null
          }, (function() {
            var k, len1, ref3, results1;
            ref3 = annotation.value;
            results1 = [];
            for (i = k = 0, len1 = ref3.length; k < len1; i = ++k) {
              mark = ref3[i];
              if (!(parseInt(mark.frame) === parseInt(this.props.frame))) {
                continue;
              }
              if (mark._key == null) {
                mark._key = Math.random();
              }
              if (skippedMarks < this.props.classification._hideMarksBefore && !this.props.classification.completed) {
                skippedMarks += 1;
                continue;
              }
              toolDescription = taskDescription.tools[mark.tool];
              toolEnv = {
                containerRect: this.props.containerRect,
                scale: this.props.scale,
                disabled: isPriorAnnotation,
                selected: mark === this.state.selection && !isPriorAnnotation,
                getEventOffset: this.props.getEventOffset
              };
              toolProps = {
                classification: this.props.classification,
                mark: mark,
                details: toolDescription.details,
                color: toolDescription.color
              };
              toolMethods = {
                onChange: this.handleChange.bind(this, i),
                onSelect: this.handleSelect.bind(this, annotation, mark),
                onDeselect: this.handleDeselect,
                onDestroy: this.handleDestroy.bind(this, annotation, mark)
              };
              ToolComponent = drawingTools[toolDescription.type];
              results1.push(React.createElement(ToolComponent, React.__spread({
                "key": mark._key
              }, toolProps, toolEnv, toolMethods)));
            }
            return results1;
          }).call(this)));
        } else {
          results.push(void 0);
        }
      }
      return results;
    }).call(this));
  },
  handleChange: function(markIndex, mark) {
    this.props.annotation.value[markIndex] = mark;
    return this.props.onChange(this.props.annotation);
  },
  handleSelect: function(annotation, mark) {
    var markIndex;
    this.setState({
      selection: mark
    });
    markIndex = annotation.value.indexOf(mark);
    annotation.value.splice(markIndex, 1);
    annotation.value.push(mark);
    return this.props.classification.update('annotations');
  },
  handleDeselect: function() {
    return this.setState({
      selection: null
    });
  },
  handleDestroy: function(annotation, mark) {
    var markIndex;
    if (mark === this.state.selection) {
      this.setState({
        selection: null
      });
    }
    markIndex = annotation.value.indexOf(mark);
    annotation.value.splice(markIndex, 1);
    return this.props.classification.update('annotations');
  }
});


},{"../../drawing-tools":8,"react":"react"}],29:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'DrawingSummary',
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      expanded: false
    };
  },
  getInitialState: function() {
    return {
      expanded: this.props.expanded
    };
  },
  render: function() {
    var i, key, mark, tool, toolMarks, value;
    return React.createElement("div", null, React.createElement("div", {
      "className": "question"
    }, this.props.task.instruction, (this.state.expanded ? React.createElement("button", {
      "type": "button",
      "className": "toggle-more",
      "onClick": this.setState.bind(this, {
        expanded: false
      }, null)
    }, "Less") : React.createElement("button", {
      "type": "button",
      "className": "toggle-more",
      "onClick": this.setState.bind(this, {
        expanded: true
      }, null)
    }, "More")), (this.props.onToggle != null ? this.props.inactive ? React.createElement("button", {
      "type": "button"
    }, React.createElement("i", {
      "className": "fa fa-eye fa-fw"
    })) : React.createElement("button", {
      "type": "button"
    }, React.createElement("i", {
      "className": "fa fa-eye-slash fa-fw"
    })) : void 0)), (function() {
      var j, len, ref, results;
      ref = this.props.task.tools;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        tool = ref[i];
        if (tool._key == null) {
          tool._key = Math.random();
        }
        toolMarks = (function() {
          var k, len1, ref1, results1;
          ref1 = this.props.annotation.value;
          results1 = [];
          for (k = 0, len1 = ref1.length; k < len1; k++) {
            mark = ref1[k];
            if (mark.tool === i) {
              results1.push(mark);
            }
          }
          return results1;
        }).call(this);
        if (this.state.expanded || toolMarks.length !== 0) {
          results.push(React.createElement("div", {
            "key": tool._key,
            "className": "answer"
          }, tool.type, " ", React.createElement("strong", null, tool.label), " (", [].concat(toolMarks.length), ")", ((function() {
            var k, len1, results1;
            if (this.state.expanded) {
              results1 = [];
              for (i = k = 0, len1 = toolMarks.length; k < len1; i = ++k) {
                mark = toolMarks[i];
                if (mark._key == null) {
                  mark._key = Math.random();
                }
                results1.push(React.createElement("div", {
                  "key": mark._key
                }, i + 1, ")", ' ', (function() {
                  var results2;
                  results2 = [];
                  for (key in mark) {
                    value = mark[key];
                    if ((key !== 'tool' && key !== 'sources') && key.charAt(0) !== '_') {
                      results2.push(React.createElement("code", {
                        "key": key
                      }, React.createElement("strong", null, key), ": ", JSON.stringify(value), ""));
                    }
                  }
                  return results2;
                })()));
              }
              return results1;
            }
          }).call(this))));
        } else {
          results.push(void 0);
        }
      }
      return results;
    }).call(this));
  }
});


},{"react":"react"}],30:[function(require,module,exports){
var DragReorderable, DropdownDialog, React, ReactDOM;

React = require('react');

ReactDOM = require('react-dom');

DragReorderable = require('drag-reorderable');

DropdownDialog = React.createClass({displayName: "DropdownDialog",
  getDefaultProps: function() {
    return {
      selects: [],
      initialSelect: {},
      related: [],
      onCancel: function() {},
      onSave: function() {}
    };
  },
  getInitialState: function() {
    return {
      editSelect: JSON.parse(JSON.stringify(this.props.initialSelect)),
      optionsKeys: {},
      conditionalSelects: [],
      deletedValues: []
    };
  },
  componentDidMount: function() {
    var conditionalSelect, conditionalSelects;
    if (this.props.initialSelect.condition != null) {
      conditionalSelect = this.props.selects.filter((function(_this) {
        return function(select) {
          return select.id === _this.props.initialSelect.condition;
        };
      })(this));
      conditionalSelects = [];
      while (conditionalSelect[0] != null) {
        conditionalSelects.push(conditionalSelect[0]);
        conditionalSelect = this.props.selects.filter((function(_this) {
          return function(select) {
            return select.id === conditionalSelect[0].condition;
          };
        })(this));
      }
      conditionalSelects.reverse();
      return this.setState({
        conditionalSelects: conditionalSelects
      });
    }
  },
  handleOptionsKeys: function(select, value) {
    var optionsKeys;
    optionsKeys = this.state.optionsKeys;
    if (select.condition == null) {
      optionsKeys[select.id] = value;
    } else if (value === null || value === '') {
      optionsKeys[select.id] = null;
    } else {
      optionsKeys[select.id] = optionsKeys[select.condition] + ";" + value;
    }
    return this.setState({
      optionsKeys: optionsKeys
    });
  },
  getOptionsKey: function(select) {
    if (select.condition == null) {
      return '*';
    } else {
      return this.state.optionsKeys[select.condition];
    }
  },
  getOptionsByProp: function(prop) {
    var optionsByProp, ref;
    optionsByProp = (ref = this.state.editSelect.options[this.getOptionsKey(this.state.editSelect)]) != null ? ref.map((function(_this) {
      return function(option) {
        return option[prop];
      };
    })(this)) : void 0;
    return optionsByProp || [];
  },
  editSelect: function() {
    var select;
    select = this.state.editSelect;
    select.title = this.refs.title.value;
    select.required = this.refs.required.checked;
    select.allowCreate = this.refs.allowCreate.checked;
    return this.setState({
      editSelect: select
    });
  },
  onChangeConditionalAnswer: function(select, e) {
    var i, len, ref, results;
    this.handleOptionsKeys(select, e.target.value);
    ref = this.props.related;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      select = ref[i];
      results.push(this.handleOptionsKeys(select, null));
    }
    return results;
  },
  addOption: function(optionLabel) {
    var optionsKey, ref, select;
    if (!optionLabel) {
      return window.alert('Please provide an option');
    }
    if (((ref = this.getOptionsByProp("label")) != null ? ref.indexOf(optionLabel) : void 0) !== -1) {
      return window.alert('Options must be unique within each dropdown');
    }
    select = this.state.editSelect;
    if ((select.condition != null) && !this.state.optionsKeys[select.condition]) {
      return window.alert('Please select an answer to the related conditional dropdown(s) to associate the new option to');
    }
    optionsKey = this.getOptionsKey(select);
    if (select.options[optionsKey] != null) {
      select.options[optionsKey].push({
        value: "" + (Math.random().toString(16).split('.')[1]),
        label: "" + optionLabel
      });
    } else {
      select.options["" + optionsKey] = [
        {
          value: "" + (Math.random().toString(16).split('.')[1]),
          label: "" + optionLabel
        }
      ];
    }
    return this.setState({
      editSelect: select
    });
  },
  onClickAddOption: function() {
    this.addOption(this.refs.optionInput.value);
    return this.refs.optionInput.value = '';
  },
  onReorder: function(newOptions) {
    var select;
    select = this.state.editSelect;
    select.options[this.getOptionsKey(select)] = newOptions;
    return this.setState({
      editSelect: select
    });
  },
  onClickDeleteOption: function(value) {
    var deletedValues, newOptions, select;
    select = this.state.editSelect;
    newOptions = select.options[this.getOptionsKey(select)].filter((function(_this) {
      return function(option) {
        return option.value !== value;
      };
    })(this));
    select.options[this.getOptionsKey(select)] = newOptions;
    this.setState({
      editSelect: select
    });
    if (this.props.related.length) {
      deletedValues = this.state.deletedValues;
      deletedValues.push(value);
      return this.setState({
        deletedValues: deletedValues
      });
    }
  },
  save: function(e) {
    var newData, selectTitles;
    if (!this.state.editSelect.title) {
      return window.alert('Dropdowns must have a Title.');
    }
    selectTitles = this.props.selects.filter((function(_this) {
      return function(select) {
        return select !== _this.props.initialSelect;
      };
    })(this)).map(function(select) {
      return select.title;
    });
    if (selectTitles.indexOf(this.state.editSelect.title) !== -1) {
      return window.alert('Dropdowns must have a unique Title.');
    }
    newData = {
      editSelect: this.state.editSelect,
      deletedValues: this.state.deletedValues
    };
    return this.props.onSave(newData);
  },
  cancel: function() {
    return this.props.onCancel();
  },
  renderOption: function(option) {
    return React.createElement("li", {
      "key": option.value
    }, React.createElement("span", null, React.createElement("i", {
      "className": "fa fa-bars"
    }), ' '), option.label, ' ', React.createElement("button", {
      "onClick": this.onClickDeleteOption.bind(this, option.value),
      "title": "Delete"
    }, React.createElement("i", {
      "className": "fa fa-close"
    })));
  },
  render: function() {
    var ref, select;
    select = this.state.editSelect;
    return React.createElement("div", {
      "className": "dropdown-editor"
    }, React.createElement("p", null, React.createElement("label", null, React.createElement("span", {
      "className": "form-label"
    }, "Title"), React.createElement("br", null), React.createElement("input", {
      "className": "standard-input full",
      "type": "text",
      "ref": "title",
      "defaultValue": select.title,
      "onChange": this.editSelect,
      "autoFocus": true
    })), (select.condition != null ? React.createElement("span", null, "Dependent on ", ((ref = this.state.conditionalSelects[this.state.conditionalSelects.length - 1]) != null ? ref.title : void 0)) : void 0)), React.createElement("label", {
      "className": "pill-button"
    }, "Required ", React.createElement("input", {
      "type": "checkbox",
      "ref": "required",
      "checked": select.required,
      "onChange": this.editSelect
    })), ' ', React.createElement("label", {
      "className": "pill-button"
    }, "Allow Create ", React.createElement("input", {
      "type": "checkbox",
      "ref": "allowCreate",
      "checked": select.allowCreate,
      "onChange": this.editSelect
    })), React.createElement("br", null), (select.condition != null ? React.createElement("div", null, React.createElement("br", null), React.createElement("h2", {
      "className": "form-label"
    }, "Options For"), this.state.conditionalSelects.map((function(_this) {
      return function(condition) {
        var ref1;
        return React.createElement("div", {
          "key": condition.id
        }, React.createElement("select", {
          "onChange": _this.onChangeConditionalAnswer.bind(_this, condition)
        }, React.createElement("option", {
          "value": ""
        }, "none selected"), (ref1 = condition.options[_this.getOptionsKey(condition)]) != null ? ref1.map(function(option) {
          return React.createElement("option", {
            "key": option.value,
            "value": option.value,
            "label": option.label
          });
        }) : void 0));
      };
    })(this)), React.createElement("br", null)) : React.createElement("div", null, React.createElement("br", null), React.createElement("h2", {
      "className": "form-label"
    }, "Options"))), React.createElement("div", null, React.createElement(DragReorderable, {
      "tag": "ul",
      "className": "dropdown-options-list",
      "items": select.options[this.getOptionsKey(select)],
      "render": this.renderOption,
      "onChange": this.onReorder
    }), React.createElement("input", {
      "ref": "optionInput"
    }), ' ', React.createElement("button", {
      "type": "button",
      "onClick": this.onClickAddOption
    }, React.createElement("i", {
      "className": "fa fa-plus"
    }), " Add Option")), React.createElement("br", null), React.createElement("p", null, React.createElement("label", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.cancel
    }, "Cancel")), ' ', React.createElement("label", null, React.createElement("button", {
      "type": "button",
      "className": "major-button",
      "onClick": this.save
    }, "Save")), ' '));
  }
});

module.exports = DropdownDialog;


},{"drag-reorderable":"drag-reorderable","react":"react","react-dom":"react-dom"}],31:[function(require,module,exports){
var DragReorderable, DropdownList, React;

React = require('react');

DragReorderable = require('drag-reorderable');

DropdownList = React.createClass({displayName: "DropdownList",
  getDefaultProps: function() {
    return {
      selects: [],
      onReorder: function() {},
      editDropdown: function() {},
      deleteDropdown: function() {}
    };
  },
  edit: function(index) {
    return this.props.editDropdown(index);
  },
  "delete": function(index) {
    if (window.confirm('Are you sure that you would like to delete this dropdown AND all dropdowns conditional to it?')) {
      return this.props.deleteDropdown(index);
    }
  },
  getDependent: function(select) {
    var condition, conditionTitle;
    if (select.condition == null) {
      return "";
    }
    condition = this.props.selects.filter((function(_this) {
      return function(dropdown) {
        return dropdown.id === select.condition;
      };
    })(this));
    conditionTitle = condition[0].title;
    return "(dep. on " + conditionTitle + ")";
  },
  renderDropdown: function(select, i) {
    return React.createElement("li", {
      "key": select.id,
      "className": "dropdown-task-list-item-container"
    }, React.createElement("span", {
      "className": "dropdown-task-list-item-title"
    }, select.title), React.createElement("span", {
      "className": "dropdown-task-list-item-dependency"
    }, this.getDependent(select)), React.createElement("button", {
      "type": "button",
      "className": "dropdown-task-list-item-edit-button",
      "onClick": this.edit.bind(this, i)
    }, React.createElement("i", {
      "className": "fa fa-pencil fa-fw"
    })), (i !== 0 ? React.createElement("button", {
      "type": "button",
      "className": "dropdown-task-list-item-reset-button",
      "onClick": this["delete"].bind(this, i)
    }, React.createElement("i", {
      "className": "fa fa-trash-o fa-fw"
    })) : void 0));
  },
  render: function() {
    return React.createElement(DragReorderable, {
      "tag": "ul",
      "className": "dropdown-task-list",
      "items": this.props.selects,
      "render": this.renderDropdown,
      "onChange": this.props.onReorder
    });
  }
});

module.exports = DropdownList;


},{"drag-reorderable":"drag-reorderable","react":"react"}],32:[function(require,module,exports){
var AutoSave, Dialog, DropdownDialog, DropdownList, MarkdownEditor, MarkdownHelp, NextTaskSelector, React, TriggeredModalForm, alert, handleInputChange;

React = require('react');

alert = require('../../../lib/alert');

TriggeredModalForm = require('modal-form/triggered');

Dialog = require('modal-form/dialog');

AutoSave = require('../../../components/auto-save');

handleInputChange = require('../../../lib/handle-input-change');

NextTaskSelector = require('../next-task-selector');

MarkdownEditor = require('markdownz').MarkdownEditor;

MarkdownHelp = require('../../../partials/markdown-help');

DropdownList = require('./dropdown-list');

DropdownDialog = require('./dropdown-dialog');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'DropdownEditor',
    getDefaultProps: function() {
      return {
        workflow: {},
        task: {}
      };
    },
    getInitialState: function() {
      return {
        editing: null
      };
    },
    updateTasks: function() {
      this.props.workflow.update('tasks');
      return this.props.workflow.save();
    },
    getRelated: function(select, related) {
      var j, len, relatedSelects;
      if (related == null) {
        related = [];
      }
      relatedSelects = this.props.task.selects.filter((function(_this) {
        return function(relatedSelect) {
          return relatedSelect.condition === select.id;
        };
      })(this));
      for (j = 0, len = relatedSelects.length; j < len; j++) {
        select = relatedSelects[j];
        related.push(select);
        this.getRelated(select, related);
      }
      return related;
    },
    createDropdown: function() {
      var conditionIndex, selects;
      conditionIndex = parseInt(this.refs.condition.value, 10);
      selects = this.props.task.selects;
      selects.splice(conditionIndex + 1, 0, {
        id: Math.random().toString(16).split('.')[1],
        title: 'new dropdown title',
        condition: this.props.task.selects[conditionIndex].id,
        options: {},
        required: false,
        allowCreate: true
      });
      return this.editDropdown(conditionIndex + 1);
    },
    onReorder: function(newSelects) {
      this.props.task.selects = newSelects;
      return this.updateTasks();
    },
    editDropdown: function(index) {
      return this.setState({
        editing: index
      });
    },
    handleDeletedValues: function(deletedValues) {
      var arrayOfValues, deleteKey, deleteKeys, j, k, l, len, len1, len2, optionsKey, optionsKeys, ref, results, select, value;
      ref = this.props.task.selects;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        select = ref[j];
        deleteKeys = [];
        optionsKeys = Object.keys(select.options);
        for (k = 0, len1 = optionsKeys.length; k < len1; k++) {
          optionsKey = optionsKeys[k];
          arrayOfValues = optionsKey.split(";");
          for (l = 0, len2 = deletedValues.length; l < len2; l++) {
            value = deletedValues[l];
            if (arrayOfValues.indexOf(value) !== -1) {
              deleteKeys.push(optionsKey);
            }
          }
        }
        results.push((function() {
          var len3, m, results1;
          results1 = [];
          for (m = 0, len3 = deleteKeys.length; m < len3; m++) {
            deleteKey = deleteKeys[m];
            results1.push(delete select.options[deleteKey]);
          }
          return results1;
        })());
      }
      return results;
    },
    handleSave: function(newData) {
      var deletedValues, editSelect;
      editSelect = newData.editSelect, deletedValues = newData.deletedValues;
      this.props.task.selects[this.state.editing] = editSelect;
      if (deletedValues.length) {
        this.handleDeletedValues(deletedValues);
      }
      this.editDropdown(null);
      return this.updateTasks();
    },
    deleteDropdown: function(index) {
      var filteredSelects, related, select;
      select = this.props.task.selects[index];
      related = this.getRelated(select);
      related.push(select);
      filteredSelects = this.props.task.selects.filter((function(_this) {
        return function(filteredSelect) {
          return related.indexOf(filteredSelect) === -1;
        };
      })(this));
      this.props.task.selects = filteredSelects;
      return this.updateTasks();
    },
    render: function() {
      var handleChange, ref, ref1, select, selects;
      handleChange = handleInputChange.bind(this.props.workflow);
      selects = this.props.task.selects;
      return React.createElement("div", {
        "className": "dropdown-editor"
      }, React.createElement("div", {
        "className": "dropdown"
      }, React.createElement("section", null, React.createElement("div", null, React.createElement(AutoSave, {
        "resource": this.props.workflow
      }, React.createElement("span", {
        "className": "form-label"
      }, "Main text"), React.createElement("br", null), React.createElement("textarea", {
        "name": this.props.taskPrefix + ".instruction",
        "value": this.props.task.instruction,
        "className": "standard-input full",
        "onChange": handleChange
      })), React.createElement("small", {
        "className": "form-help"
      }, "Describe the task, or ask the question, in a way that is clear to a non-expert. You can use markdown to format this text."), React.createElement("br", null)), React.createElement("br", null), React.createElement("div", null, React.createElement(AutoSave, {
        "resource": this.props.workflow
      }, React.createElement("span", {
        "className": "form-label"
      }, "Help text"), React.createElement("br", null), React.createElement(MarkdownEditor, {
        "name": this.props.taskPrefix + ".help",
        "value": (ref = this.props.task.help) != null ? ref : "",
        "rows": "4",
        "className": "full",
        "onChange": handleChange,
        "onHelp": (function() {
          return alert(React.createElement(MarkdownHelp, null));
        })
      })), React.createElement("small", {
        "className": "form-help"
      }, "Add text and images for a help window.")), React.createElement("hr", null)), React.createElement("section", null, React.createElement("h2", {
        "className": "form-label"
      }, "Dropdowns"), React.createElement(DropdownList, {
        "selects": selects,
        "onReorder": this.onReorder,
        "editDropdown": this.editDropdown,
        "deleteDropdown": this.deleteDropdown
      }), React.createElement("p", null, React.createElement("button", {
        "type": "button",
        "className": "minor-button",
        "onClick": this.createDropdown
      }, React.createElement("i", {
        "className": "fa fa-plus"
      }), " Add a Dropdown"), React.createElement("label", null, React.createElement("span", null, " Dependent On "), React.createElement("select", {
        "key": this.state.editing,
        "ref": "condition",
        "defaultValue": "" + (selects.length - 1)
      }, selects.map(function(select, i) {
        return React.createElement("option", {
          "key": select.id,
          "value": i
        }, select.title);
      }))), React.createElement("br", null))), (this.state.editing != null ? (select = selects[this.state.editing], React.createElement(Dialog, {
        "required": true
      }, React.createElement(DropdownDialog, {
        "selects": selects,
        "initialSelect": select,
        "related": this.getRelated(select),
        "onSave": this.handleSave,
        "onCancel": this.editDropdown.bind(this, null)
      }))) : void 0), React.createElement("hr", null)), React.createElement(AutoSave, {
        "resource": this.props.workflow
      }, React.createElement("span", {
        "className": "form-label"
      }, "Next task"), React.createElement("br", null), React.createElement(NextTaskSelector, {
        "workflow": this.props.workflow,
        "name": this.props.taskPrefix + ".next",
        "value": (ref1 = this.props.task.next) != null ? ref1 : '',
        "onChange": handleInputChange.bind(this.props.workflow)
      })));
    }
  });
}


},{"../../../components/auto-save":62,"../../../lib/alert":98,"../../../lib/handle-input-change":103,"../../../partials/markdown-help":222,"../next-task-selector":38,"./dropdown-dialog":30,"./dropdown-list":31,"markdownz":"markdownz","modal-form/dialog":546,"modal-form/triggered":548,"react":"react"}],33:[function(require,module,exports){
var DropdownEditor, GenericTask, React, Select, Summary;

React = require('react');

GenericTask = require('../generic');

DropdownEditor = require('./editor');

Select = require('react-select');

Summary = React.createClass({
  displayName: 'DropdownSummary',
  getDefaultProps: function() {
    return {
      task: {},
      annotation: {}
    };
  },
  getOptionsKeys: function() {
    var answer, condition, i, id, j, len, optionsKeys, ref, ref1;
    optionsKeys = {};
    ref = this.props.annotation.value;
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      answer = ref[i];
      ref1 = this.props.task.selects[i], id = ref1.id, condition = ref1.condition;
      if (i === 0 || i === '0') {
        optionsKeys[id] = answer.value;
      } else if (answer.value === null) {
        optionsKeys[id] = null;
      } else {
        optionsKeys[id] = optionsKeys[condition] + ";" + answer.value;
      }
    }
    return optionsKeys;
  },
  getAnswer: function(value, i) {
    var option, options, optionsKey, optionsKeys, select;
    select = this.props.task.selects[i];
    optionsKeys = this.getOptionsKeys();
    optionsKey = select.condition == null ? '*' : optionsKeys[select.condition];
    options = select.options[optionsKey];
    option = options.filter((function(_this) {
      return function(option) {
        return option.value === value;
      };
    })(this));
    return option[0].label;
  },
  render: function() {
    var answer, i;
    return React.createElement("div", {
      "className": "classification-task-summary"
    }, React.createElement("div", {
      "className": "question"
    }, this.props.task.instruction), React.createElement("div", {
      "className": "answers"
    }, (function() {
      var j, len, ref, results;
      ref = this.props.annotation.value;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        answer = ref[i];
        if (answer.option) {
          answer = this.getAnswer(answer.value, i);
        } else {
          answer = answer.value;
        }
        results.push(React.createElement("div", {
          "key": i,
          "className": "answer"
        }, React.createElement("i", {
          "className": "fa fa-arrow-circle-o-right"
        }), " ", this.props.task.selects[i].title, " - ", answer));
      }
      return results;
    }).call(this)));
  }
});

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'DropdownTask',
    statics: {
      Editor: DropdownEditor,
      Summary: Summary,
      getDefaultTask: function() {
        return {
          type: 'dropdown',
          instruction: 'Select or type an option',
          help: '',
          selects: [
            {
              id: Math.random().toString(16).split('.')[1],
              title: 'Main Dropdown',
              required: true,
              allowCreate: false,
              options: {
                '*': []
              }
            }
          ]
        };
      },
      getTaskText: function(task) {
        return task.instruction;
      },
      getDefaultAnnotation: function() {
        return {
          value: []
        };
      },
      isAnnotationComplete: function(task, annotation) {
        return task.selects.every(function(select, i) {
          var ref;
          return !select.required || (((ref = annotation.value[i]) != null ? ref.value : void 0) != null);
        });
      },
      testAnnotationQuality: function(unknown, knownGood) {
        var distance, length;
        distance = levenshtein.get(unknown.value.toLowerCase(), knownGood.value.toLowerCase());
        length = Math.max(unknown.value.length, knownGood.value.length);
        return (length - distance) / length;
      }
    },
    getInitialState: function() {
      return {
        optionsKeys: {}
      };
    },
    componentDidMount: function() {
      var annotationValues, answer, i, j, len;
      annotationValues = this.props.annotation.value;
      if (annotationValues.length) {
        for (i = j = 0, len = annotationValues.length; j < len; i = ++j) {
          answer = annotationValues[i];
          this.handleOptionsKeys(i, answer.value);
        }
      } else {
        this.props.annotation.value = this.props.task.selects.map(function() {
          return {
            value: null,
            option: false
          };
        });
      }
      if (this.props.autoFocus === true) {
        return this.refs['select-0'].getInputNode().focus();
      }
    },
    handleOptionsKeys: function(i, value) {
      var condition, id, optionsKeys, ref;
      ref = this.props.task.selects[i], id = ref.id, condition = ref.condition;
      optionsKeys = this.state.optionsKeys;
      if (i === 0 || i === '0') {
        optionsKeys[id] = value;
      } else if (value === null) {
        optionsKeys[id] = null;
      } else {
        optionsKeys[id] = optionsKeys[condition] + ";" + value;
      }
      return this.setState({
        optionsKeys: optionsKeys
      });
    },
    getOptions: function(i) {
      var optionsKey, select;
      select = this.props.task.selects[i];
      optionsKey = select.condition == null ? '*' : this.state.optionsKeys[select.condition];
      return select.options[optionsKey];
    },
    getDisabledAttribute: function(i) {
      var optionsKeys, ref, select;
      select = this.props.task.selects[i];
      optionsKeys = this.state.optionsKeys;
      if ((select.condition != null) && !optionsKeys[select.condition]) {
        return true;
      }
      if ((select.condition != null) && select.allowCreate === false && !((ref = select.options[optionsKeys[select.condition]]) != null ? ref.length : void 0)) {
        return true;
      }
      return false;
    },
    clearRelated: function(i) {
      var id, j, key, len, relatedSelects, results, selects;
      selects = this.props.task.selects;
      id = selects[i].id;
      relatedSelects = Object.keys(selects).filter((function(_this) {
        return function(key) {
          return selects[key].condition === id;
        };
      })(this));
      results = [];
      for (j = 0, len = relatedSelects.length; j < len; j++) {
        key = relatedSelects[j];
        results.push(this.onChangeSelect(key, null));
      }
      return results;
    },
    render: function() {
      var selectKeys, selects;
      selects = this.props.task.selects;
      selectKeys = Object.keys(selects);
      return React.createElement(GenericTask, {
        "question": this.props.task.instruction,
        "help": this.props.task.help,
        "required": this.props.task.required
      }, React.createElement("div", null, selectKeys.map((function(_this) {
        return function(i) {
          var options, ref;
          options = _this.getOptions(i);
          return React.createElement("div", {
            "key": Math.random()
          }, React.createElement("div", null, selects[i].title), React.createElement(Select, {
            "options": options,
            "onChange": _this.onChangeSelect.bind(_this, i),
            "value": ((ref = _this.props.annotation.value[i]) != null ? ref.value : void 0),
            "disabled": _this.getDisabledAttribute(i),
            "allowCreate": selects[i].allowCreate,
            "noResultsText": (!(options != null ? options.length : void 0) ? null : void 0),
            "addLabelText": "Press enter for {label}...",
            "matchProp": "label",
            "ref": "select-" + i
          }));
        };
      })(this))));
    },
    onChangeSelect: function(i, newValue) {
      var newAnnotation, newIndex, optionsValues, ref, value;
      value = this.props.annotation.value;
      optionsValues = (ref = this.getOptions(i)) != null ? ref.map(function(option) {
        return option.value;
      }) : void 0;
      newIndex = optionsValues != null ? optionsValues.indexOf(newValue) : void 0;
      if (newIndex === -1 || newIndex === void 0) {
        value[i] = {
          value: newValue,
          option: false
        };
        this.handleOptionsKeys(i, null);
      } else {
        value[i] = {
          value: newValue,
          option: true
        };
        this.handleOptionsKeys(i, newValue);
      }
      this.clearRelated(i);
      newAnnotation = Object.assign(this.props.annotation, {
        value: value
      });
      return this.props.onChange(newAnnotation);
    }
  });
}


},{"../generic":35,"./editor":32,"react":"react","react-select":"react-select"}],34:[function(require,module,exports){
var AutoSave, ChangeListener, DrawingTaskDetailsEditor, MarkdownEditor, MarkdownHelp, NextTaskSelector, React, alert, drawingTools, handleInputChange,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

ChangeListener = require('../../components/change-listener');

AutoSave = require('../../components/auto-save');

handleInputChange = require('../../lib/handle-input-change');

drawingTools = require('../drawing-tools');

alert = require('../../lib/alert');

DrawingTaskDetailsEditor = require('./drawing-task-details-editor');

NextTaskSelector = require('./next-task-selector');

MarkdownEditor = require('markdownz').MarkdownEditor;

MarkdownHelp = require('../../partials/markdown-help');

module.exports = React.createClass({
  displayName: 'GenericTaskEditor',
  getDefaultProps: function() {
    return {
      workflow: null,
      task: null,
      taskPrefix: ''
    };
  },
  render: function() {
    var canBeRequired, choice, choicesKey, handleChange, index, isAQuestion, mainTextKey, multipleHelp, ref, ref1, ref2, ref3, ref4, ref5, ref6, requiredHelp, toolKey;
    handleChange = handleInputChange.bind(this.props.workflow);
    ref = (function() {
      switch (this.props.task.type) {
        case 'single':
        case 'multiple':
          return ['question', 'answers'];
        case 'drawing':
          return ['instruction', 'tools'];
        case 'crop':
          return ['instruction'];
        case 'text':
          return ['instruction'];
      }
    }).call(this), mainTextKey = ref[0], choicesKey = ref[1];
    isAQuestion = (ref1 = this.props.task.type) === 'single' || ref1 === 'multiple';
    canBeRequired = (ref2 = this.props.task.type) === 'single' || ref2 === 'multiple' || ref2 === 'text';
    return React.createElement("div", {
      "className": "workflow-task-editor " + this.props.task.type
    }, React.createElement("div", null, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("span", {
      "className": "form-label"
    }, "Main text"), React.createElement("br", null), React.createElement("textarea", {
      "name": this.props.taskPrefix + "." + mainTextKey,
      "value": this.props.task[mainTextKey],
      "className": "standard-input full",
      "onChange": handleChange
    })), React.createElement("small", {
      "className": "form-help"
    }, "Describe the task, or ask the question, in a way that is clear to a non-expert. You can use markdown to format this text."), React.createElement("br", null)), React.createElement("br", null), (!this.props.isSubtask ? React.createElement("div", null, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("span", {
      "className": "form-label"
    }, "Help text"), React.createElement("br", null), React.createElement(MarkdownEditor, {
      "name": this.props.taskPrefix + ".help",
      "onHelp": (function() {
        return alert(React.createElement(MarkdownHelp, null));
      }),
      "value": (ref3 = this.props.task.help) != null ? ref3 : "",
      "rows": "7",
      "className": "full",
      "onChange": handleChange
    })), React.createElement("small", {
      "className": "form-help"
    }, "Add text and images for a window that pops up when volunteers click Need some help? You can use markdown to format this text and add images. The help text can be as long as you need, but you should try to keep it simple and avoid jargon.")) : void 0), (choicesKey != null ? React.createElement("div", null, React.createElement("hr", null), React.createElement("span", {
      "className": "form-label"
    }, "Choices")) : void 0), ' ', (this.props.project && indexOf.call(this.props.project.experimental_tools, 'hide previous marks') >= 0 ? React.createElement("label", {
      "className": "pill-button"
    }, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("input", {
      "type": "checkbox",
      "checked": this.props.task.enableHidePrevMarks,
      "onChange": this.toggleHidePrevMarksEnabled
    }), ' ', "Allow hiding marks")) : void 0), (isAQuestion ? (multipleHelp = 'Multiple Choice: Check this box if more than one answer can be selected.', React.createElement("span", null, React.createElement("label", {
      "className": "pill-button"
    }, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("input", {
      "type": "checkbox",
      "checked": this.props.task.type === 'multiple',
      "onChange": this.toggleMultipleChoice
    }), ' ', "Allow multiple")), ' ')) : void 0), (canBeRequired ? (requiredHelp = 'Check this box if this question has to be answered before proceeding. If a marking task is Required, the volunteer will not be able to move on until they have made at least 1 mark.', React.createElement("span", null, React.createElement("label", {
      "className": "pill-button",
      "title": requiredHelp
    }, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("input", {
      "type": "checkbox",
      "name": this.props.taskPrefix + ".required",
      "checked": this.props.task.required,
      "onChange": handleChange
    }), ' ', "Required")), ' ')) : void 0), React.createElement("br", null), (choicesKey != null ? React.createElement("div", {
      "className": "workflow-task-editor-choices"
    }, (((ref4 = (ref5 = this.props.task[choicesKey]) != null ? ref5.length : void 0) != null ? ref4 : 0) === 0 ? React.createElement("span", {
      "className": "form-help"
    }, "No ", React.createElement("code", null, choicesKey), " defined for this task.") : void 0), (function() {
      var i, len, ref6, ref7, results;
      ref7 = (ref6 = this.props.task[choicesKey]) != null ? ref6 : [];
      results = [];
      for (index = i = 0, len = ref7.length; i < len; index = ++i) {
        choice = ref7[index];
        if (choice._key == null) {
          choice._key = Math.random();
        }
        results.push(React.createElement("div", {
          "key": choice._key,
          "className": "workflow-choice-editor"
        }, React.createElement(AutoSave, {
          "resource": this.props.workflow
        }, React.createElement("textarea", {
          "name": this.props.taskPrefix + "." + choicesKey + "." + index + ".label",
          "value": choice.label,
          "onChange": handleChange
        })), React.createElement("div", {
          "className": "workflow-choice-settings"
        }, ((function() {
          var ref10, ref8, ref9;
          switch (this.props.task.type) {
            case 'single':
              if (!this.props.isSubtask) {
                return React.createElement("div", {
                  "className": "workflow-choice-setting"
                }, React.createElement(AutoSave, {
                  "resource": this.props.workflow
                }, "Next task", ' ', React.createElement(NextTaskSelector, {
                  "workflow": this.props.workflow,
                  "name": this.props.taskPrefix + "." + choicesKey + "." + index + ".next",
                  "value": (ref8 = choice.next) != null ? ref8 : '',
                  "onChange": handleChange
                })));
              }
              break;
            case 'drawing':
              return [
                React.createElement("div", {
                  "key": "type",
                  "className": "workflow-choice-setting"
                }, React.createElement(AutoSave, {
                  "resource": this.props.workflow
                }, "Type", ' ', React.createElement("select", {
                  "name": this.props.taskPrefix + "." + choicesKey + "." + index + ".type",
                  "value": choice.type,
                  "onChange": handleChange
                }, ((function() {
                  var results1, results2;
                  if (this.canUse("column")) {
                    results1 = [];
                    for (toolKey in drawingTools) {
                      results1.push(React.createElement("option", {
                        "key": toolKey,
                        "value": toolKey
                      }, toolKey));
                    }
                    return results1;
                  } else {
                    results2 = [];
                    for (toolKey in drawingTools) {
                      if (toolKey !== "column") {
                        results2.push(React.createElement("option", {
                          "key": toolKey,
                          "value": toolKey
                        }, toolKey));
                      } else {
                        results2.push(void 0);
                      }
                    }
                    return results2;
                  }
                }).call(this))))), React.createElement("div", {
                  "key": "color",
                  "className": "workflow-choice-setting"
                }, React.createElement(AutoSave, {
                  "resource": this.props.workflow
                }, "Color", ' ', React.createElement("select", {
                  "name": this.props.taskPrefix + "." + choicesKey + "." + index + ".color",
                  "value": choice.color,
                  "onChange": handleChange
                }, React.createElement("option", {
                  "value": "#ff0000"
                }, "Red"), React.createElement("option", {
                  "value": "#ffff00"
                }, "Yellow"), React.createElement("option", {
                  "value": "#00ff00"
                }, "Green"), React.createElement("option", {
                  "value": "#00ffff"
                }, "Cyan"), React.createElement("option", {
                  "value": "#0000ff"
                }, "Blue"), React.createElement("option", {
                  "value": "#ff00ff"
                }, "Magenta"), React.createElement("option", {
                  "value": "#000000"
                }, "Black"), React.createElement("option", {
                  "value": "#ffffff"
                }, "White")))), React.createElement("div", {
                  "key": "min-max",
                  "className": "min-max-editor workflow-choice-setting"
                }, React.createElement(AutoSave, {
                  "resource": this.props.workflow
                }, "Min", ' ', React.createElement("input", {
                  "type": "number",
                  "name": this.props.taskPrefix + "." + choicesKey + "." + index + ".min",
                  "value": choice.min,
                  "placeholder": "0",
                  "style": {
                    width: '3ch'
                  },
                  "onBlur": handleChange,
                  "data-json-value": true
                })), React.createElement(AutoSave, {
                  "resource": this.props.workflow
                }, "Max", ' ', React.createElement("input", {
                  "type": "number",
                  "name": this.props.taskPrefix + "." + choicesKey + "." + index + ".max",
                  "value": choice.max,
                  "placeholder": "",
                  "style": {
                    width: '3ch'
                  },
                  "onBlur": handleChange,
                  "data-json-value": true
                }))), React.createElement("div", {
                  "key": "details",
                  "className": "workflow-choice-setting"
                }, React.createElement("button", {
                  "type": "button",
                  "onClick": this.editToolDetails.bind(this, this.props.task, index)
                }, "Sub-tasks (", (ref9 = (ref10 = choice.details) != null ? ref10.length : void 0) != null ? ref9 : 0, ")"), ' ', React.createElement("small", {
                  "className": "form-help"
                }, "Ask users a question about what theyve just drawn."))
              ];
          }
        }).call(this))), React.createElement(AutoSave, {
          "resource": this.props.workflow
        }, React.createElement("button", {
          "type": "button",
          "className": "workflow-choice-remove-button",
          "title": "Remove choice",
          "onClick": this.removeChoice.bind(this, choicesKey, index)
        }, ""))));
      }
      return results;
    }).call(this), React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "button",
      "className": "workflow-choice-add-button",
      "title": "Add choice",
      "onClick": this.addChoice.bind(this, choicesKey)
    }, "+")), React.createElement("br", null), ((function() {
      switch (choicesKey) {
        case 'answers':
          return React.createElement("div", null, React.createElement("small", {
            "className": "form-help"
          }, "The answers will be displayed next to each checkbox, so this text is as important as the main text and help text for guiding the volunteers. Keep your answers as minimal as possible -- any more than 5 answers can discourage new users."), React.createElement("br", null), React.createElement("small", {
            "className": "form-help"
          }, "The Next task selection describes what task you want the volunteer to perform next after they give a particular answer. You can choose from among the tasks youve already defined. If you want to link a task to another you havent built yet, you can come back and do it later (dont forget to save your changes)."));
        case 'tools':
          return React.createElement("div", null, React.createElement("small", {
            "className": "form-help"
          }, "Select which marks you want for this task, and what to call each of them. The tool name will be displayed on the classification page next to each marking option. Use the simplest tool that will give you the results you need for your research."), React.createElement("br", null), React.createElement("small", {
            "className": "form-help"
          }, "*point:* X marks the spot."), React.createElement("br", null), React.createElement("small", {
            "className": "form-help"
          }, "*line:* a straight line at any angle."), React.createElement("br", null), React.createElement("small", {
            "className": "form-help"
          }, "*polygon:* an arbitrary shape made of point-to-point lines."), React.createElement("br", null), React.createElement("small", {
            "className": "form-help"
          }, "*rectangle:* a box of any size and length-width ratio; this tool *cannot* be rotated."), React.createElement("br", null), React.createElement("small", {
            "className": "form-help"
          }, "*circle:* a point and a radius."), React.createElement("br", null), React.createElement("small", {
            "className": "form-help"
          }, "*ellipse:* an oval of any size and axis ratio; this tool *can* be rotated."), React.createElement("br", null), (this.canUse("column") ? React.createElement("small", {
            "className": "form-help"
          }, "*column rectangle:* a box with full height but variable width; this tool *cannot* be rotated.") : void 0));
      }
    }).call(this))) : void 0), (!(this.props.task.type === 'single' || this.props.isSubtask) ? React.createElement("div", null, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, "Next task", ' ', React.createElement(NextTaskSelector, {
      "workflow": this.props.workflow,
      "name": this.props.taskPrefix + ".next",
      "value": (ref6 = this.props.task.next) != null ? ref6 : '',
      "onChange": handleChange
    }))) : void 0));
  },
  canUse: function(tool) {
    return indexOf.call(this.props.project.experimental_tools, tool) >= 0;
  },
  toggleHidePrevMarksEnabled: function(e) {
    var enableHidePrevMarks;
    enableHidePrevMarks = e.target.checked;
    this.props.task.enableHidePrevMarks = enableHidePrevMarks;
    return this.props.workflow.update('tasks');
  },
  toggleMultipleChoice: function(e) {
    var newType;
    newType = e.target.checked ? 'multiple' : 'single';
    this.props.task.type = newType;
    return this.props.workflow.update('tasks');
  },
  addChoice: function(type) {
    switch (type) {
      case 'answers':
        return this.addAnswer();
      case 'tools':
        return this.addTool();
    }
  },
  addAnswer: function() {
    this.props.task.answers.push({
      label: 'Enter an answer'
    });
    return this.props.workflow.update('tasks');
  },
  addTool: function() {
    this.props.task.tools.push({
      type: 'point',
      label: 'Tool name',
      color: '#00ff00',
      details: []
    });
    return this.props.workflow.update('tasks');
  },
  editToolDetails: function(task, toolIndex) {
    var base;
    if ((base = this.props.task.tools[toolIndex]).details == null) {
      base.details = [];
    }
    return alert((function(_this) {
      return function(resolve) {
        return React.createElement(ChangeListener, {
          "target": _this.props.workflow
        }, (function() {
          return React.createElement(DrawingTaskDetailsEditor, {
            "project": _this.props.project,
            "workflow": _this.props.workflow,
            "task": _this.props.task,
            "toolIndex": toolIndex,
            "details": _this.props.task.tools[toolIndex].details,
            "toolPath": _this.props.taskPrefix + ".tools." + toolIndex,
            "onClose": resolve
          });
        }));
      };
    })(this));
  },
  removeChoice: function(choicesName, index) {
    this.props.task[choicesName].splice(index, 1);
    return this.props.workflow.update('tasks');
  }
});


},{"../../components/auto-save":62,"../../components/change-listener":63,"../../lib/alert":98,"../../lib/handle-input-change":103,"../../partials/markdown-help":222,"../drawing-tools":8,"./drawing-task-details-editor":23,"./next-task-selector":38,"markdownz":"markdownz","react":"react"}],35:[function(require,module,exports){
var Markdown, React, alert;

React = require('react');

alert = require('../../lib/alert');

Markdown = require('markdownz').Markdown;

module.exports = React.createClass({
  displayName: 'GenericTask',
  getDefaultProps: function() {
    return {
      question: '',
      help: '',
      required: false,
      answers: []
    };
  },
  getInitialState: function() {
    return {
      helping: false
    };
  },
  render: function() {
    return React.createElement("div", {
      "className": "workflow-task"
    }, React.createElement(Markdown, {
      "className": "question"
    }, this.props.question), this.props.children, React.createElement("div", {
      "className": "answers"
    }, React.Children.map(this.props.answers, function(answer) {
      return React.cloneElement(answer, {
        className: "answer " + answer.props.className
      });
    })), (this.props.required ? React.createElement("div", {
      "className": "required-task-warning"
    }, React.createElement("p", null, React.createElement("small", null, React.createElement("strong", null, "This step is required."), React.createElement("br", null), "If youre not allowed to continue, make sure its complete."))) : void 0), (this.props.help ? React.createElement("div", null, React.createElement("hr", null), React.createElement("p", null, React.createElement("small", null, React.createElement("strong", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.showHelp
    }, "Need some help with this task?"))))) : void 0));
  },
  showHelp: function() {
    return alert(React.createElement("div", {
      "className": "content-container"
    }, React.createElement(Markdown, {
      "className": "classification-task-help"
    }, this.props.help)));
  }
});


},{"../../lib/alert":98,"markdownz":"markdownz","react":"react"}],36:[function(require,module,exports){
module.exports = {
  combo: require('./combo'),
  single: require('./single'),
  multiple: require('./multiple'),
  drawing: require('./drawing'),
  survey: require('./survey'),
  flexibleSurvey: require('./survey'),
  crop: require('./crop'),
  text: require('./text'),
  dropdown: require('./dropdown')
};

if (typeof window !== "undefined" && window !== null) {
  window._tasks = module.exports;
}


},{"./combo":18,"./crop":20,"./drawing":26,"./dropdown":33,"./multiple":37,"./single":39,"./survey":45,"./text":48}],37:[function(require,module,exports){
var GenericTask, GenericTaskEditor, Markdown, NOOP, React, Summary,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

GenericTask = require('./generic');

Markdown = require('markdownz').Markdown;

GenericTaskEditor = require('./generic-editor');

NOOP = Function.prototype;

Summary = React.createClass({
  displayName: 'MultipleChoiceSummary',
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      expanded: false
    };
  },
  getInitialState: function() {
    return {
      expanded: this.props.expanded
    };
  },
  render: function() {
    var answer, i, index;
    return React.createElement("div", null, React.createElement("div", {
      "className": "question"
    }, this.props.task.question, (this.state.expanded ? React.createElement("button", {
      "type": "button",
      "className": "toggle-more",
      "onClick": this.setState.bind(this, {
        expanded: false
      }, null)
    }, "Less") : React.createElement("button", {
      "type": "button",
      "className": "toggle-more",
      "onClick": this.setState.bind(this, {
        expanded: true
      }, null)
    }, "More"))), React.createElement("div", {
      "className": "answers"
    }, ((function() {
      var j, k, len, len1, ref, ref1, results, results1;
      if (this.state.expanded) {
        ref = this.props.task.answers;
        results = [];
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          answer = ref[i];
          if (answer._key == null) {
            answer._key = Math.random();
          }
          results.push(React.createElement("div", {
            "key": answer._key,
            "className": "answer"
          }, (indexOf.call(this.props.annotation.value, i) >= 0 ? React.createElement("i", {
            "className": "fa fa-check-square-o fa-fw"
          }) : React.createElement("i", {
            "className": "fa fa-square-o fa-fw"
          })), answer.label));
        }
        return results;
      } else {
        if (this.props.annotation.value.length === 0) {
          return React.createElement("div", {
            "className": "answer"
          }, "\'No answer\'");
        } else {
          ref1 = this.props.annotation.value;
          results1 = [];
          for (k = 0, len1 = ref1.length; k < len1; k++) {
            index = ref1[k];
            results1.push(React.createElement("div", {
              "key": index,
              "className": "answer"
            }, React.createElement("i", {
              "className": "fa fa-check-square-o fa-fw"
            }), this.props.task.answers[index].label));
          }
          return results1;
        }
      }
    }).call(this))));
  }
});

module.exports = React.createClass({
  displayName: 'MultipleChoiceTask',
  statics: {
    Editor: GenericTaskEditor,
    Summary: Summary,
    getDefaultTask: function() {
      return {
        type: 'multiple',
        question: 'Enter a question.',
        help: '',
        answers: []
      };
    },
    getTaskText: function(task) {
      return task.question;
    },
    getDefaultAnnotation: function() {
      return {
        value: []
      };
    },
    isAnnotationComplete: function(task, annotation) {
      var ref;
      return annotation.value.length >= ((ref = task.required) != null ? ref : 0);
    },
    testAnnotationQuality: function(unknown, knownGood) {
      var matches, total;
      total = 0;
      matches = 0;
      unknown.value.forEach(function(value) {
        total += 1;
        if (indexOf.call(knownGood.value, value) >= 0) {
          return matches += 1;
        }
      });
      knownGood.value.forEach(function(value) {
        total += 1;
        if (indexOf.call(unknown.value, value) >= 0) {
          return matches += 1;
        }
      });
      if (total === 0) {
        return 1;
      } else {
        return matches / total;
      }
    }
  },
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      onChange: NOOP
    };
  },
  render: function() {
    var answer, answers, i;
    answers = (function() {
      var j, len, ref, results;
      ref = this.props.task.answers;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        answer = ref[i];
        if (answer._key == null) {
          answer._key = Math.random();
        }
        results.push(React.createElement("label", {
          "key": answer._key,
          "className": "minor-button answer-button " + (indexOf.call(this.props.annotation.value, i) >= 0 ? 'active' : '')
        }, React.createElement("div", {
          "className": "answer-button-icon-container"
        }, React.createElement("input", {
          "autoFocus": this.props.autoFocus && i === 0,
          "type": "checkbox",
          "checked": (indexOf.call(this.props.annotation.value, i) >= 0),
          "onChange": this.handleChange.bind(this, i)
        })), React.createElement("div", {
          "className": "answer-button-label-container"
        }, React.createElement(Markdown, {
          "className": "answer-button-label"
        }, answer.label))));
      }
      return results;
    }).call(this);
    return React.createElement(GenericTask, {
      "question": this.props.task.question,
      "help": this.props.task.help,
      "answers": answers,
      "required": this.props.task.required
    });
  },
  handleChange: function(index, e) {
    var indexInValue, newAnnotation, value;
    value = this.props.annotation.value.slice(0);
    if (e.target.checked) {
      if (indexOf.call(value, index) < 0) {
        value.push(index);
      }
    } else {
      if (indexOf.call(value, index) >= 0) {
        indexInValue = value.indexOf(index);
        value.splice(indexInValue, 1);
      }
    }
    newAnnotation = Object.assign({}, this.props.annotation, {
      value: value
    });
    return this.props.onChange(newAnnotation);
  }
});


},{"./generic":35,"./generic-editor":34,"markdownz":"markdownz","react":"react"}],38:[function(require,module,exports){
var MAX_TEXT_LENGTH_IN_MENU, NOOP, React;

React = require('react');

NOOP = Function.prototype;

MAX_TEXT_LENGTH_IN_MENU = 100;

module.exports = React.createClass({
  displayName: 'NextTaskSelector',
  getDefaultProps: function() {
    return {
      workflow: null,
      name: '',
      value: '',
      isSubtask: false,
      onChange: NOOP
    };
  },
  render: function() {
    var definition, key, tasks, text;
    tasks = require('.');
    return React.createElement("select", {
      "name": this.props.name,
      "value": this.props.value,
      "onChange": this.props.onChange
    }, React.createElement("option", {
      "value": ""
    }, "(End of classification!)"), (function() {
      var ref, results;
      ref = this.props.workflow.tasks;
      results = [];
      for (key in ref) {
        definition = ref[key];
        text = tasks[definition.type].getTaskText(definition);
        if (text.length > MAX_TEXT_LENGTH_IN_MENU) {
          text = text.slice(0, MAX_TEXT_LENGTH_IN_MENU) + '...';
        }
        results.push(React.createElement("option", {
          "key": key,
          "value": key
        }, text));
      }
      return results;
    }).call(this));
  }
});


},{".":36,"react":"react"}],39:[function(require,module,exports){
var GenericTask, GenericTaskEditor, Markdown, NOOP, React, Summary;

React = require('react');

Markdown = require('markdownz').Markdown;

GenericTask = require('./generic');

GenericTaskEditor = require('./generic-editor');

NOOP = Function.prototype;

Summary = React.createClass({
  displayName: 'SingleChoiceSummary',
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      expanded: false
    };
  },
  getInitialState: function() {
    return {
      expanded: this.props.expanded
    };
  },
  render: function() {
    var answer, i;
    return React.createElement("div", null, React.createElement("div", {
      "className": "question"
    }, this.props.task.question, (this.state.expanded ? React.createElement("button", {
      "type": "button",
      "className": "toggle-more",
      "onClick": this.setState.bind(this, {
        expanded: false
      }, null)
    }, "Less") : React.createElement("button", {
      "type": "button",
      "className": "toggle-more",
      "onClick": this.setState.bind(this, {
        expanded: true
      }, null)
    }, "More"))), React.createElement("div", {
      "className": "answers"
    }, ((function() {
      var j, len, ref, results;
      if (this.state.expanded) {
        ref = this.props.task.answers;
        results = [];
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          answer = ref[i];
          if (answer._key == null) {
            answer._key = Math.random();
          }
          results.push(React.createElement("div", {
            "key": answer._key,
            "className": "answer"
          }, (i === this.props.annotation.value ? React.createElement("i", {
            "className": "fa fa-check-circle-o fa-fw"
          }) : React.createElement("i", {
            "className": "fa fa-circle-o fa-fw"
          })), React.createElement(Markdown, {
            "tag": "span",
            "inline": true
          }, this.props.task.answers[i].label)));
        }
        return results;
      } else if (this.props.annotation.value != null) {
        return React.createElement("div", {
          "className": "answer"
        }, React.createElement("i", {
          "className": "fa fa-check-circle-o fa-fw"
        }), React.createElement(Markdown, {
          "tag": "span",
          "inline": true
        }, this.props.task.answers[this.props.annotation.value].label));
      } else {
        return React.createElement("div", {
          "className": "answer"
        }, "No answer");
      }
    }).call(this))));
  }
});

module.exports = React.createClass({
  displayName: 'SingleChoiceTask',
  statics: {
    Editor: GenericTaskEditor,
    Summary: Summary,
    getDefaultTask: function() {
      return {
        type: 'single',
        question: 'Enter a question.',
        help: '',
        answers: []
      };
    },
    getTaskText: function(task) {
      return task.question;
    },
    getDefaultAnnotation: function() {
      return {
        value: null
      };
    },
    isAnnotationComplete: function(task, annotation) {
      return (annotation.value != null) || !task.required;
    },
    testAnnotationQuality: function(unknown, knownGood) {
      if (unknown.value === knownGood.value) {
        return 1;
      } else {
        return 0;
      }
    }
  },
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      onChange: NOOP
    };
  },
  render: function() {
    var answer, answers, i;
    console.log("");
    answers = (function() {
      var j, len, ref, results;
      ref = this.props.task.answers;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        answer = ref[i];
        if (answer._key == null) {
          answer._key = Math.random();
        }
        results.push(React.createElement("label", {
          "key": answer._key,
          "className": "minor-button answer-button " + (i === this.props.annotation.value ? 'active' : '')
        }, React.createElement("div", {
          "className": "answer-button-icon-container"
        }, React.createElement("input", {
          "type": "radio",
          "autoFocus": this.props.autoFocus && i === 0,
          "checked": i === this.props.annotation.value,
          "onChange": this.handleChange.bind(this, i)
        })), React.createElement("div", {
          "className": "answer-button-label-container"
        }, React.createElement(Markdown, {
          "className": "answer-button-label"
        }, answer.label))));
      }
      return results;
    }).call(this);
    return React.createElement(GenericTask, {
      "question": this.props.task.question,
      "help": this.props.task.help,
      "answers": answers,
      "required": this.props.task.required
    });
  },
  handleChange: function(index, e) {
    var newAnnotation;
    if (e.target.checked) {
      newAnnotation = Object.assign({}, this.props.annotation, {
        value: index
      });
      return this.props.onChange(newAnnotation);
    }
  }
});


},{"./generic":35,"./generic-editor":34,"markdownz":"markdownz","react":"react"}],40:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'SurveyAnnotationView',
  getDefaultProperties: function() {
    return {
      task: null,
      classification: null,
      annotation: null
    };
  },
  render: function() {
    var answersByQuestion, answersList, i, identification;
    return React.createElement("div", null, (function() {
      var j, len, ref, results;
      ref = this.props.annotation.value;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        identification = ref[i];
        if (identification._key == null) {
          identification._key = Math.random();
        }
        answersByQuestion = this.props.task.questionsOrder.map((function(_this) {
          return function(questionID) {
            var answerLabels;
            if (questionID in identification.answers) {
              answerLabels = [].concat(identification.answers[questionID]).map(function(answerID) {
                return _this.props.task.questions[questionID].answers[answerID].label;
              });
              return answerLabels.join(', ');
            }
          };
        })(this));
        answersList = answersByQuestion.filter(Boolean).join('; ');
        results.push(React.createElement("span", {
          "key": identification._key
        }, React.createElement("span", {
          "className": "survey-identification-proxy",
          "title": answersList
        }, this.props.task.choices[identification.choice].label, ' ', React.createElement("button", {
          "type": "button",
          "className": "survey-identification-remove",
          "title": "Remove",
          "onClick": this.handleRemove.bind(this, i)
        }, "")), ' '));
      }
      return results;
    }).call(this));
  },
  handleRemove: function(index) {
    this.props.annotation.value.splice(index, 1);
    return this.props.classification.update('annotations');
  }
});


},{"react":"react"}],41:[function(require,module,exports){
var ImageFlipper, Markdown, React, TriggeredModalForm, Utility,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

TriggeredModalForm = require('modal-form/triggered');

Markdown = require('markdownz').Markdown;

Utility = require('./utility');

ImageFlipper = React.createClass({
  displayName: 'ImageFlipper',
  getDefaultProps: function() {
    return {
      images: []
    };
  },
  getInitialState: function() {
    return {
      frame: 0
    };
  },
  PRELOAD_STYLE: {
    height: 0,
    overflow: 'hidden',
    position: 'fixed',
    right: 0,
    width: 0
  },
  render: function() {
    var index;
    return React.createElement("span", {
      "className": "survey-task-image-flipper"
    }, this.renderPreload(), React.createElement("img", {
      "src": this.props.images[this.state.frame],
      "className": "survey-task-image-flipper-image"
    }), React.createElement("span", {
      "className": "survey-task-image-flipper-pips"
    }, ((function() {
      var i, ref, results;
      if (this.props.images.length !== 1) {
        results = [];
        for (index = i = 0, ref = this.props.images.length; 0 <= ref ? i < ref : i > ref; index = 0 <= ref ? ++i : --i) {
          results.push(React.createElement("span", {
            "key": this.props.images[index]
          }, React.createElement("button", {
            "type": "button",
            "className": "survey-task-image-flipper-pip",
            "disabled": index === this.state.frame,
            "onClick": this.handleFrameChange.bind(this, index)
          }, index + 1), ' '));
        }
        return results;
      }
    }).call(this))));
  },
  renderPreload: function() {
    var image;
    return React.createElement("div", {
      "style": this.PRELOAD_STYLE
    }, (function() {
      var i, len, ref, results;
      ref = this.props.images;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        image = ref[i];
        results.push(React.createElement("img", {
          "src": image,
          "key": image
        }));
      }
      return results;
    }).call(this));
  },
  handleFrameChange: function(frame) {
    return this.setState({
      frame: frame
    });
  }
});

module.exports = React.createClass({
  displayName: 'Choice',
  getDefaultProps: function() {
    return {
      task: null,
      choiceID: '',
      onSwitch: Function.prototype,
      onConfirm: Function.prototype,
      onCancel: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      answers: {}
    };
  },
  allFilledIn: function() {
    var answer, i, len, question, questionID, ref;
    ref = Utility.getQuestionIDs(this.props.task, this.props.choiceID);
    for (i = 0, len = ref.length; i < len; i++) {
      questionID = ref[i];
      question = this.props.task.questions[questionID];
      if (question.required) {
        answer = this.state.answers[questionID];
        if ((answer == null) || (question.multiple && answer.length === 0)) {
          return false;
        }
      }
    }
    return true;
  },
  anyFilledIn: function() {
    var answer, i, len, question, questionID, ref;
    if (!Utility.getQuestionIDs(this.props.task, this.props.choiceID).length) {
      return true;
    }
    ref = Utility.getQuestionIDs(this.props.task, this.props.choiceID);
    for (i = 0, len = ref.length; i < len; i++) {
      questionID = ref[i];
      question = this.props.task.questions[questionID];
      answer = this.state.answers[questionID];
      if ((answer != null)) {
        return true;
      }
    }
    return false;
  },
  render: function() {
    var answer, answerID, choice, filename, inputType, isChecked, otherChoice, otherChoiceID, question, questionID;
    choice = this.props.task.choices[this.props.choiceID];
    return React.createElement("div", {
      "className": "survey-task-choice"
    }, (choice.images.length !== 0 ? React.createElement(ImageFlipper, {
      "images": (function() {
        var i, len, ref, results;
        ref = choice.images;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          filename = ref[i];
          results.push(this.props.task.images[filename]);
        }
        return results;
      }).call(this)
    }) : void 0), React.createElement("div", {
      "className": "survey-task-choice-content"
    }, React.createElement("div", {
      "className": "survey-task-choice-label"
    }, choice.label), React.createElement("div", {
      "className": "survey-task-choice-description"
    }, choice.description), (choice.confusionsOrder.length !== 0 ? React.createElement("div", {
      "className": "survey-task-choice-confusions"
    }, "Often confused with", ' ', (function() {
      var i, len, ref, results;
      ref = choice.confusionsOrder;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        otherChoiceID = ref[i];
        otherChoice = this.props.task.choices[otherChoiceID];
        results.push(React.createElement("span", {
          "key": otherChoiceID
        }, React.createElement(TriggeredModalForm, {
          "className": "survey-task-confusions-modal",
          "trigger": React.createElement("span", {
            "className": "survey-task-choice-confusion"
          }, otherChoice.label),
          "style": {
            maxWidth: '60ch'
          }
        }, React.createElement(ImageFlipper, {
          "images": (function() {
            var j, len1, ref1, results1;
            ref1 = otherChoice.images;
            results1 = [];
            for (j = 0, len1 = ref1.length; j < len1; j++) {
              filename = ref1[j];
              results1.push(this.props.task.images[filename]);
            }
            return results1;
          }).call(this)
        }), React.createElement(Markdown, {
          "content": choice.confusions[otherChoiceID]
        }), React.createElement("div", {
          "className": "survey-task-choice-confusion-buttons",
          "style": {
            textAlign: 'center'
          }
        }, React.createElement("button", {
          "type": "submit",
          "className": "major-button identfiy"
        }, "Dismiss"), ' ', React.createElement("button", {
          "type": "button",
          "className": "standard-button cancel",
          "onClick": this.props.onSwitch.bind(null, otherChoiceID)
        }, "I think its this"))), ' '));
      }
      return results;
    }).call(this)) : void 0), React.createElement("hr", null), ((function() {
      var i, len, ref, results;
      if (!choice.noQuestions) {
        ref = Utility.getQuestionIDs(this.props.task, this.props.choiceID);
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          questionID = ref[i];
          question = this.props.task.questions[questionID];
          inputType = question.multiple ? 'checkbox' : 'radio';
          results.push(React.createElement("div", {
            "key": questionID,
            "className": "survey-task-choice-question",
            "data-multiple": question.multiple || null
          }, React.createElement("div", {
            "className": "survey-task-choice-question-label"
          }, question.label), (function() {
            var j, len1, ref1, ref2, results1;
            ref1 = question.answersOrder;
            results1 = [];
            for (j = 0, len1 = ref1.length; j < len1; j++) {
              answerID = ref1[j];
              answer = question.answers[answerID];
              isChecked = question.multiple ? indexOf.call((ref2 = this.state.answers[questionID]) != null ? ref2 : [], answerID) >= 0 : answerID === this.state.answers[questionID];
              results1.push(React.createElement("span", {
                "key": answerID
              }, React.createElement("label", {
                "className": "survey-task-choice-answer",
                "data-checked": isChecked || null
              }, React.createElement("input", {
                "name": questionID,
                "type": inputType,
                "checked": isChecked,
                "onChange": this.handleAnswer.bind(this, questionID, answerID)
              }), answer.label), ' '));
            }
            return results1;
          }).call(this)));
        }
        return results;
      }
    }).call(this)), (!(choice.noQuestions || Utility.getQuestionIDs(this.props.task, this.props.choiceID).length === 0) ? React.createElement("hr", null) : void 0)), React.createElement("div", {
      "style": {
        textAlign: 'center'
      }
    }, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.props.onCancel
    }, "Cancel"), ' ', React.createElement("button", {
      "type": "button",
      "className": "standard-button",
      "disabled": !this.allFilledIn() || !this.anyFilledIn(),
      "onClick": this.handleIdentification
    }, React.createElement("strong", null, "Identify"))));
  },
  handleAnswer: function(questionID, answerID, e) {
    var base;
    if (this.props.task.questions[questionID].multiple) {
      if ((base = this.state.answers)[questionID] == null) {
        base[questionID] = [];
      }
      if (e.target.checked) {
        this.state.answers[questionID].push(answerID);
      } else {
        this.state.answers[questionID].splice(this.state.answers[questionID].indexOf(answerID), 1);
      }
    } else {
      this.state.answers[questionID] = e.target.checked ? answerID : null;
    }
    return this.setState({
      answers: this.state.answers
    });
  },
  handleIdentification: function() {
    return this.props.onConfirm(this.props.choiceID, this.state.answers);
  }
});


},{"./utility":47,"markdownz":"markdownz","modal-form/triggered":548,"react":"react"}],42:[function(require,module,exports){
var React, TriggeredModalForm, sortIntoColumns,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

TriggeredModalForm = require('modal-form/triggered');

sortIntoColumns = require('sort-into-columns');

module.exports = React.createClass({
  displayName: 'Chooser',
  getDefaultProps: function() {
    return {
      task: null,
      filters: {},
      onFilter: Function.prototype,
      onChoose: Function.prototype
    };
  },
  getFilteredChoices: function() {
    var characteristicID, choice, choiceID, j, len, ref, ref1, rejected, results, valueID;
    ref = this.props.task.choicesOrder;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      choiceID = ref[j];
      choice = this.props.task.choices[choiceID];
      rejected = false;
      ref1 = this.props.filters;
      for (characteristicID in ref1) {
        valueID = ref1[characteristicID];
        if (indexOf.call(choice.characteristics[characteristicID], valueID) < 0) {
          rejected = true;
          break;
        }
      }
      if (rejected) {
        continue;
      } else {
        results.push(choiceID);
      }
    }
    return results;
  },
  whatSizeThumbnails: function(arg) {
    var length;
    length = arg.length;
    if (length <= 5) {
      return 'large';
    } else if (length <= 10) {
      return 'medium';
    } else if (length <= 20) {
      return 'small';
    } else {
      return 'none';
    }
  },
  howManyColumns: function(arg) {
    var length;
    length = arg.length;
    if (length <= 5) {
      return 1;
    } else if (length <= 20) {
      return 2;
    } else {
      return 3;
    }
  },
  render: function() {
    var autoFocus, characteristic, characteristicID, choice, choiceID, columnsCount, disabled, filteredChoices, hasBeenAutoFocused, i, label, selected, selectedValue, sortedFilteredChoices, thumbnailSize, thumbnailSrc, value, valueID;
    filteredChoices = this.getFilteredChoices();
    thumbnailSize = this.whatSizeThumbnails(filteredChoices);
    columnsCount = this.howManyColumns(filteredChoices);
    sortedFilteredChoices = sortIntoColumns(filteredChoices, columnsCount);
    return React.createElement("div", {
      "className": "survey-task-chooser"
    }, React.createElement("div", {
      "className": "survey-task-chooser-characteristics"
    }, (function() {
      var j, len, ref, ref1, results;
      ref = this.props.task.characteristicsOrder;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        characteristicID = ref[j];
        characteristic = this.props.task.characteristics[characteristicID];
        selectedValue = characteristic.values[this.props.filters[characteristicID]];
        hasBeenAutoFocused = false;
        results.push(React.createElement(TriggeredModalForm, {
          "key": characteristicID,
          "ref": characteristicID + "-dropdown",
          "className": "survey-task-chooser-characteristic-menu",
          "trigger": React.createElement("span", {
            "className": "survey-task-chooser-characteristic",
            "data-is-active": (selectedValue != null) || null
          }, React.createElement("span", {
            "className": "survey-task-chooser-characteristic-label"
          }, (ref1 = selectedValue != null ? selectedValue.label : void 0) != null ? ref1 : characteristic.label))
        }, React.createElement("div", {
          "className": "survey-task-chooser-characteristic-menu-container"
        }, (function() {
          var k, len1, ref2, results1;
          ref2 = characteristic.valuesOrder;
          results1 = [];
          for (k = 0, len1 = ref2.length; k < len1; k++) {
            valueID = ref2[k];
            value = characteristic.values[valueID];
            disabled = valueID === this.props.filters[characteristicID];
            autoFocus = !disabled && !hasBeenAutoFocused;
            selected = valueID === this.props.filters[characteristicID];
            if (autoFocus) {
              hasBeenAutoFocused = true;
            }
            results1.push(React.createElement("button", {
              "key": valueID,
              "type": "submit",
              "title": value.label,
              "className": "survey-task-chooser-characteristic-value",
              "disabled": disabled,
              "data-selected": selected,
              "autoFocus": autoFocus,
              "onClick": this.handleFilter.bind(this, characteristicID, valueID)
            }, (value.image != null ? React.createElement("img", {
              "src": this.props.task.images[value.image],
              "alt": value.label,
              "className": "survey-task-chooser-characteristic-value-icon"
            }) : void 0)));
          }
          return results1;
        }).call(this), React.createElement("button", {
          "type": "submit",
          "className": "survey-task-chooser-characteristic-clear-button",
          "disabled": !(characteristicID in this.props.filters),
          "autoFocus": !hasBeenAutoFocused,
          "onClick": this.handleFilter.bind(this, characteristicID, void 0)
        }, "Clear")), React.createElement("div", {
          "className": "survey-task-chooser-characteristic-value-label"
        }, ((function() {
          var k, len1, ref2;
          label = "";
          ref2 = characteristic.valuesOrder;
          for (k = 0, len1 = ref2.length; k < len1; k++) {
            valueID = ref2[k];
            value = characteristic.values[valueID];
            if (valueID === this.props.filters[characteristicID]) {
              label = value.label;
            }
          }
          if (label) {
            return label;
          } else {
            return "Make a selection";
          }
        }).call(this)))));
      }
      return results;
    }).call(this)), React.createElement("div", {
      "className": "survey-task-chooser-choices",
      "data-thumbnail-size": thumbnailSize,
      "data-columns": columnsCount
    }, ((function() {
      var j, len, ref, results;
      if (sortedFilteredChoices.length === 0) {
        return React.createElement("div", null, React.createElement("em", null, "No matches."));
      } else {
        results = [];
        for (i = j = 0, len = sortedFilteredChoices.length; j < len; i = ++j) {
          choiceID = sortedFilteredChoices[i];
          choice = this.props.task.choices[choiceID];
          results.push(React.createElement("button", {
            "key": choiceID + i,
            "type": "button",
            "className": "survey-task-chooser-choice-button",
            "onClick": this.props.onChoose.bind(null, choiceID)
          }, React.createElement("div", {
            "className": "survey-task-chooser-choice"
          }, (((ref = choice.images) != null ? ref.length : void 0) > 0 ? (thumbnailSrc = this.props.task.images[choice.images[0]], React.createElement("span", {
            "className": "survey-task-chooser-choice-thumbnail",
            "role": "presentation",
            "style": {
              backgroundImage: "url('" + thumbnailSrc + "')"
            }
          })) : void 0), React.createElement("span", {
            "className": "survey-task-chooser-choice-label"
          }, choice.label))));
        }
        return results;
      }
    }).call(this))), React.createElement("div", {
      "style": {
        textAlign: 'center'
      }
    }, "Showing ", sortedFilteredChoices.length, " of ", this.props.task.choicesOrder.length, ".\n        ", React.createElement("button", {
      "type": "button",
      "className": "survey-task-chooser-characteristic-clear-button",
      "disabled": Object.keys(this.props.filters).length === 0,
      "onClick": this.handleClearFilters
    }, React.createElement("i", {
      "className": "fa fa-ban"
    }), " Clear filters")));
  },
  handleFilter: function(characteristicID, valueID) {
    return this.props.onFilter(characteristicID, valueID);
  },
  handleClearFilters: function() {
    var characteristicID, j, len, ref, results;
    ref = this.props.task.characteristicsOrder;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      characteristicID = ref[j];
      results.push(this.props.onFilter(characteristicID, void 0));
    }
    return results;
  }
});


},{"modal-form/triggered":548,"react":"react","sort-into-columns":"sort-into-columns"}],43:[function(require,module,exports){
var React;

React = require('react');

module.exports = {
  choices: React.createElement("div", {
    "className": "content-container"
  }, React.createElement("p", null, "User-identifiable ", React.createElement("strong", null, "choices"), ", with these headers:"), React.createElement("table", {
    "className": "standard-table"
  }, React.createElement("tbody", null, React.createElement("tr", null, React.createElement("th", null, "Name"), React.createElement("th", null, "Description"), React.createElement("th", null, "Images"), React.createElement("th", null, "No questions")), React.createElement("tr", {
    "className": "form-label"
  }, React.createElement("td", null, "The label for the choice"), React.createElement("td", null, "A short description of the choice"), React.createElement("td", null, "Representative images of the choice, ", React.createElement("code", null, ";"), "-separated"), React.createElement("td", null, "Y or N for whether you want \"sub-questions\" to appear")), React.createElement("tr", null, React.createElement("td", null, "Shark"), React.createElement("td", null, "A shark is a big gray ocean monster with fins and teeth."), React.createElement("td", null, "shark.jpg"), React.createElement("td", null, "Y")), React.createElement("tr", null, React.createElement("td", null, "Dolphin"), React.createElement("td", null, "Dolphins are intelligent marine mammals who solve crimes."), React.createElement("td", null, "dolphin.jpg; flipper.jpg"), React.createElement("td", null, "N"))))),
  images: React.createElement("div", {
    "className": "content-container"
  }, "Pick some ", React.createElement("strong", null, "images"), ". Make sure they have the exact same names as the ones in your other files."),
  characteristics: React.createElement("div", {
    "className": "content-container"
  }, React.createElement("p", null, React.createElement("strong", null, "Characteristics"), " of those choices that the user can filter through. Note that the values in Name have to match the values in choices.csv exactly. Format like this:"), React.createElement("table", {
    "className": "standard-table"
  }, React.createElement("tbody", null, React.createElement("tr", null, React.createElement("th", null, "Name"), React.createElement("th", null, "Color=Orange; orange.png"), React.createElement("th", null, "Color=Gray; gray.png"), React.createElement("th", null, "Teeth=Dull; dull.png"), React.createElement("th", null, "Teeth=Pointy; pointy.png")), React.createElement("tr", {
    "className": "form-label"
  }, React.createElement("td", null, "Choice name"), React.createElement("td", {
    "colSpan": "4"
  }, React.createElement("code", null, "Characteristic"), "=", React.createElement("code", null, "value"), "; ", React.createElement("code", null, "icon filename"), ", with each row marked ", React.createElement("code", null, "Y"), " or ", React.createElement("code", null, "N"), " for that choice")), React.createElement("tr", null, React.createElement("td", null, "Shark"), React.createElement("td", null, "N"), React.createElement("td", null, "Y"), React.createElement("td", null, "N"), React.createElement("td", null, "Y")), React.createElement("tr", null, React.createElement("td", null, "Dolphin"), React.createElement("td", null, "Y"), React.createElement("td", null, "Y"), React.createElement("td", null, "Y"), React.createElement("td", null, "N"))))),
  confusions: React.createElement("div", {
    "className": "content-container"
  }, React.createElement("p", null, "Commonly ", React.createElement("strong", null, "confused pairs"), " of choices:"), React.createElement("table", {
    "className": "standard-table"
  }, React.createElement("tbody", null, React.createElement("tr", null, React.createElement("th", null, "Name"), React.createElement("th", null, "Twin"), React.createElement("th", null, "Details")), React.createElement("tr", {
    "className": "form-label"
  }, React.createElement("td", null, "The name of the choice to show this pairing for"), React.createElement("td", null, "The name of the similar choice"), React.createElement("td", null, "A short explanation of how to tell the difference")), React.createElement("tr", null, React.createElement("td", null, "Shark"), React.createElement("td", null, "Dolphin"), React.createElement("td", null, "A dolphin is shaped like a shark, but its tail is horizontal and its less terrifying."))))),
  questions: React.createElement("div", {
    "className": "content-container"
  }, React.createElement("p", null, React.createElement("strong", null, "Questions"), " to ask about each identification:"), React.createElement("table", {
    "className": "standard-table"
  }, React.createElement("tbody", null, React.createElement("tr", null, React.createElement("th", null, "Question"), React.createElement("th", null, "Multiple"), React.createElement("th", null, "Required"), React.createElement("th", null, "Answers"), React.createElement("th", null, "Include"), React.createElement("th", null, "Exclude")), React.createElement("tr", {
    "className": "form-label"
  }, React.createElement("td", null, "The question to ask"), React.createElement("td", null, "Can the user select multiple answers? ", React.createElement("code", null, "Y"), " or ", React.createElement("code", null, "N")), React.createElement("td", null, "Is an answer required? ", React.createElement("code", null, "Y"), " or ", React.createElement("code", null, "N")), React.createElement("td", null, "The answers, ", React.createElement("code", null, ","), "-separated"), React.createElement("td", null, "Choices to ask this question for (leave blank for all by default)."), React.createElement("td", null, "Choices to not ask this question for.")), React.createElement("tr", null, React.createElement("td", null, "Is this an example question?"), React.createElement("td", null, "Y"), React.createElement("td", null, "N"), React.createElement("td", null, "Yes, No, Maybe"), React.createElement("td", null, " "), React.createElement("td", null, "Dolphin")))))
};


},{"react":"react"}],44:[function(require,module,exports){
var AutoSave, Details, FileButton, Markdown, MediaArea, NextTaskSelector, Papa, PromiseRenderer, React, TriggeredModalForm, Utility, alert, apiClient, handleInputChange, surveyEditorHelp,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

FileButton = require('../../../components/file-button');

alert = require('../../../lib/alert');

Details = require('../../../components/details');

TriggeredModalForm = require('modal-form/triggered');

surveyEditorHelp = require('./editor-help');

AutoSave = require('../../../components/auto-save');

handleInputChange = require('../../../lib/handle-input-change');

NextTaskSelector = require('../next-task-selector');

MediaArea = require('../../../components/media-area');

PromiseRenderer = require('../../../components/promise-renderer');

Markdown = require('markdownz').Markdown;

Papa = require('papaparse');

apiClient = require('panoptes-client/lib/api-client');

Utility = require('./utility');

module.exports = React.createClass({
  displayName: 'SurveyTaskEditor',
  getInitialState: function() {
    return {
      importErrors: [],
      resettingMedia: false
    };
  },
  getDefaultProps: function() {
    return {
      workflow: null,
      task: null,
      taskPrefix: ''
    };
  },
  render: function() {
    var answerID, characteristic, characteristicID, choice, choiceID, error, file, i, question, questionID, ref, ref1, row, twin, twinID, twinLabels, value, valueID, valueLabels;
    window.editingSurveyTask = this.props.task;
    return React.createElement("div", {
      "className": "workflow-task-editor"
    }, React.createElement("p", null, React.createElement("span", {
      "className": "form-label"
    }, "Import task data. See ", React.createElement("a", {
      "href": "https://www.zooniverse.org/projects/aliburchard/cameratraptest/faq"
    }, "here for help"), ".")), React.createElement("div", {
      "className": "columns-container",
      "style": {
        marginBottom: '0.2em'
      }
    }, React.createElement(FileButton, {
      "className": "major-button column",
      "accept": ".csv, .tsv",
      "multiple": true,
      "onSelect": this.handleFiles.bind(this, this.addChoice, null)
    }, "Add choices CSV"), React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("span", {
        "className": "secret-button"
      }, React.createElement("i", {
        "className": "fa fa-question-circle"
      }))
    }, surveyEditorHelp.choices)), React.createElement("div", {
      "className": "columns-container",
      "style": {
        marginBottom: '0.2em'
      }
    }, React.createElement(FileButton, {
      "className": "major-button column",
      "accept": ".csv, .tsv",
      "multiple": true,
      "onSelect": this.handleFiles.bind(this, this.addCharacteristics, null)
    }, "Add characteristics CSV"), React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("span", {
        "className": "secret-button"
      }, React.createElement("i", {
        "className": "fa fa-question-circle"
      }))
    }, surveyEditorHelp.characteristics)), React.createElement("div", {
      "className": "columns-container",
      "style": {
        marginBottom: '0.2em'
      }
    }, React.createElement(FileButton, {
      "className": "major-button column",
      "accept": ".csv, .tsv",
      "multiple": true,
      "onSelect": this.handleFiles.bind(this, this.addConfusion, null)
    }, "Add confused pairs CSV"), React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("span", {
        "className": "secret-button"
      }, React.createElement("i", {
        "className": "fa fa-question-circle"
      }))
    }, surveyEditorHelp.confusions)), React.createElement("div", {
      "className": "columns-container",
      "style": {
        marginBottom: '0.2em'
      }
    }, React.createElement(FileButton, {
      "className": "major-button column",
      "multiple": true,
      "onSelect": this.handleFiles.bind(this, this.addQuestion, this.cleanQuestions)
    }, "Add questions CSV"), React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("span", {
        "className": "secret-button"
      }, React.createElement("i", {
        "className": "fa fa-question-circle"
      }))
    }, surveyEditorHelp.questions)), React.createElement("hr", null), (this.state.importErrors.length !== 0 ? React.createElement("div", null, React.createElement("p", {
      "className": "form-label"
    }, "Import errors"), (function() {
      var j, len, ref, ref1, results;
      ref = this.state.importErrors;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        ref1 = ref[i], error = ref1.error, file = ref1.file, row = ref1.row;
        results.push(React.createElement("p", {
          "key": i
        }, React.createElement("strong", null, error.message), React.createElement("br", null), React.createElement("span", {
          "className": "form-help"
        }, (file != null ? React.createElement("span", null, (file != null ? file.name : void 0), " ") : void 0), ((row != null) || (error.row != null) ? React.createElement("span", null, "Row ", (row != null ? row : error.row) + 1, " ") : void 0))));
      }
      return results;
    }).call(this), React.createElement("hr", null)) : void 0), React.createElement("div", null, React.createElement("span", {
      "className": "form-label"
    }, "Survey images"), ' ', React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "button",
      "disabled": this.state.resettingMedia,
      "onClick": this.resetMedia
    }, "Delete all"), (this.state.resettingMedia ? React.createElement("i", {
      "className": "fa fa-spinner fa-spin"
    }) : void 0))), React.createElement(MediaArea, {
      "resource": this.props.workflow,
      "metadata": {
        prefix: this.props.taskPrefix
      },
      "style": {
        maxHeight: '90vh'
      },
      "onAdd": this.handleImageAdd,
      "onDelete": this.handleImageDelete
    }), React.createElement("hr", null), React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("span", {
      "className": "form-label"
    }, "Next task"), React.createElement("br", null), React.createElement(NextTaskSelector, {
      "workflow": this.props.workflow,
      "name": this.props.taskPrefix + ".next",
      "value": (ref = this.props.task.next) != null ? ref : '',
      "onChange": handleInputChange.bind(this.props.workflow)
    }))), React.createElement("hr", null), React.createElement("div", null, React.createElement("span", {
      "className": "form-label"
    }, "Survey data"), ' ', React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "button",
      "onClick": this.resetTask
    }, "Delete all"))), (function() {
      var j, len, ref1, results;
      ref1 = this.props.task.choicesOrder;
      results = [];
      for (j = 0, len = ref1.length; j < len; j++) {
        choiceID = ref1[j];
        choice = this.props.task.choices[choiceID];
        results.push(React.createElement(Details, {
          "key": choiceID,
          "className": "survey-task-editor-choice",
          "summary": React.createElement("strong", null, choice.label)
        }, React.createElement(Markdown, {
          "content": choice.description
        }), React.createElement("div", null, (function() {
          var k, len1, ref2, ref3, results1;
          ref2 = this.props.task.characteristicsOrder;
          results1 = [];
          for (k = 0, len1 = ref2.length; k < len1; k++) {
            characteristicID = ref2[k];
            if (!(((ref3 = choice.characteristics[characteristicID]) != null ? ref3.length : void 0) !== 0)) {
              continue;
            }
            characteristic = this.props.task.characteristics[characteristicID];
            results1.push(React.createElement("div", {
              "key": characteristicID
            }, React.createElement("small", null, characteristic.label, ":", ' ', (valueLabels = (function() {
              var l, len2, ref4, results2;
              ref4 = characteristic.valuesOrder;
              results2 = [];
              for (l = 0, len2 = ref4.length; l < len2; l++) {
                valueID = ref4[l];
                if (!(indexOf.call(choice.characteristics[characteristicID], valueID) >= 0)) {
                  continue;
                }
                value = characteristic.values[valueID];
                results2.push(value.label);
              }
              return results2;
            })(), valueLabels.join(', ')))));
          }
          return results1;
        }).call(this), (choice.confusionsOrder.length !== 0 ? React.createElement("div", null, React.createElement("small", null, "Confused with:", ' ', (twinLabels = (function() {
          var k, len1, ref2, ref3, results1;
          ref2 = choice.confusionsOrder;
          results1 = [];
          for (k = 0, len1 = ref2.length; k < len1; k++) {
            twinID = ref2[k];
            twin = this.props.task.choices[twinID];
            results1.push((ref3 = twin != null ? twin.label : void 0) != null ? ref3 : '(Unknown choice)');
          }
          return results1;
        }).call(this), twinLabels.join(', ')))) : void 0))));
      }
      return results;
    }).call(this), React.createElement("hr", null), (((ref1 = this.props.task.questionsOrder) != null ? ref1.length : void 0) ? React.createElement("div", null, React.createElement(Details, {
      "summary": "Questions"
    }, (function() {
      var j, len, ref2, results;
      ref2 = this.props.task.questionsOrder;
      results = [];
      for (j = 0, len = ref2.length; j < len; j++) {
        questionID = ref2[j];
        question = this.props.task.questions[questionID];
        results.push(React.createElement("p", null, React.createElement("strong", null, question.label), ":", ' ', (question.multiple ? 'Any of' : 'One of'), ' ', ((function() {
          var k, len1, ref3, results1;
          ref3 = question.answersOrder;
          results1 = [];
          for (k = 0, len1 = ref3.length; k < len1; k++) {
            answerID = ref3[k];
            results1.push(question.answers[answerID].label);
          }
          return results1;
        })()).join(', '), ' ', (question.required ? '(Required)' : void 0)));
      }
      return results;
    }).call(this)), React.createElement("hr", null)) : void 0), React.createElement(Details, {
      "summary": React.createElement("small", null, "Raw task data")
    }, React.createElement("pre", {
      "style": {
        fontSize: '10px',
        whiteSpace: 'pre-wrap'
      }
    }, JSON.stringify(this.props.task, null, 2))), React.createElement("hr", null), React.createElement("label", null, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("input", {
      "type": "checkbox",
      "name": this.props.taskPrefix + ".required",
      "checked": this.props.task.required,
      "onChange": handleInputChange.bind(this.props.workflow)
    }), ' ', "Require at least one identification")));
  },
  handleFiles: function(forEachRow, afterFileHook, e) {
    this.setState({
      importErrors: []
    });
    return Array.prototype.slice.call(e.target.files).forEach((function(_this) {
      return function(file) {
        return _this.readFile(file).then(_this.parseFileContent).then(function(rows) {
          return Promise.all(rows.map(function(row, i) {
            var error, error1;
            try {
              return forEachRow(row);
            } catch (error1) {
              error = error1;
              return _this.handleImportError(error, file, i);
            }
          }));
        })["catch"](function(error) {
          throw error;
          return _this.handleImportError(error, file);
        }).then(function() {
          if (typeof afterFileHook === "function") {
            afterFileHook();
          }
          return _this.props.workflow.update('tasks').save();
        });
      };
    })(this));
  },
  readFile: function(file) {
    return new Promise(function(resolve) {
      var reader;
      reader = new FileReader;
      reader.onload = (function(_this) {
        return function(e) {
          return resolve(e.target.result);
        };
      })(this);
      reader.onerror = (function(_this) {
        return function(error) {
          return _this.handleImportError(error, file);
        };
      })(this);
      return reader.readAsText(file);
    });
  },
  parseFileContent: function(content) {
    var clean, cleanKey, cleanRows, cleanValue, data, error, errors, j, key, len, ref, row, value;
    ref = Papa != null ? Papa.parse(content.trim(), {
      header: true
    }) : void 0, errors = ref.errors, data = ref.data;
    cleanRows = (function() {
      var j, len, results;
      results = [];
      for (j = 0, len = data.length; j < len; j++) {
        row = data[j];
        clean = {};
        for (key in row) {
          value = row[key];
          cleanKey = key.trim();
          cleanValue = typeof value.trim === "function" ? value.trim() : void 0;
          if (key.indexOf('=') === -1) {
            cleanKey = cleanKey.toLowerCase().replace(/\s+/g, '_');
          } else {
            cleanValue = this.determineBoolean(cleanValue);
          }
          clean[cleanKey] = cleanValue;
        }
        results.push(clean);
      }
      return results;
    }).call(this);
    for (j = 0, len = errors.length; j < len; j++) {
      error = errors[j];
      this.handleImportError(error);
    }
    return cleanRows;
  },
  determineBoolean: function(value) {
    var ref;
    return (ref = value != null ? value.charAt(0).toUpperCase() : void 0) === 'T' || ref === 'X' || ref === 'Y' || ref === '1';
  },
  makeID: function(string) {
    return string.replace(/[aeiouy\W]/gi, '').toUpperCase();
  },
  ensureChoice: function(name) {
    var base, choiceID;
    choiceID = this.makeID(name);
    if (indexOf.call(this.props.task.choicesOrder, choiceID) < 0) {
      this.props.task.choicesOrder.push(choiceID);
    }
    if ((base = this.props.task.choices)[choiceID] == null) {
      base[choiceID] = {
        label: name,
        description: '',
        noQuestions: false,
        images: [],
        characteristics: {},
        confusionsOrder: [],
        confusions: {}
      };
    }
    return this.props.task.choices[choiceID];
  },
  addChoice: function(arg) {
    var __parsedExtra, choice, description, images, name, no_questions;
    name = arg.name, description = arg.description, no_questions = arg.no_questions, images = arg.images, __parsedExtra = arg.__parsedExtra;
    if (name == null) {
      throw new Error('Choices require a "name" column.');
    }
    choice = this.ensureChoice(name);
    choice.label = name;
    if (description != null) {
      choice.description = description;
    }
    if (no_questions != null) {
      choice.noQuestions = this.determineBoolean(no_questions);
    }
    if (images != null) {
      images = images.split(/s*;\s*/).concat(__parsedExtra != null ? __parsedExtra : []).filter(Boolean);
      return choice.images = images;
    }
  },
  addCharacteristics: function(row) {
    var base, charKeyVal, characteristicID, characteristicLabel, choice, choiceID, isSet, ref, ref1, ref2, ref3, results, valueID, valueIcon, valueLabel, valueLabelAndIcon;
    if (row.name == null) {
      throw new Error('Characteristics require a "name" column.');
    }
    this.ensureChoice(row.name);
    results = [];
    for (charKeyVal in row) {
      isSet = row[charKeyVal];
      if (!(charKeyVal !== 'name')) {
        continue;
      }
      ref = charKeyVal.replace('=', '__SPLIT_ONCE__').split(/\s*__SPLIT_ONCE__\s*/), characteristicLabel = ref[0], valueLabelAndIcon = ref[1];
      ref1 = valueLabelAndIcon.split(/\s*;\s*/), valueLabel = ref1[0], valueIcon = ref1[1];
      if (characteristicLabel === '' || valueLabel === '') {
        throw new Error('Characteristics column headers should be formatted like "Color=Blue","Color=Red".');
      }
      characteristicID = this.makeID(characteristicLabel);
      valueID = this.makeID(valueLabel);
      if (indexOf.call(this.props.task.characteristicsOrder, characteristicID) < 0) {
        this.props.task.characteristicsOrder.push(characteristicID);
        this.props.task.characteristics[characteristicID] = {
          label: '',
          valuesOrder: [],
          values: {}
        };
      }
      this.props.task.characteristics[characteristicID].label = characteristicLabel;
      if (indexOf.call(this.props.task.characteristics[characteristicID].valuesOrder, valueID) < 0) {
        this.props.task.characteristics[characteristicID].valuesOrder.push(valueID);
        this.props.task.characteristics[characteristicID].values[valueID] = {
          label: valueLabel
        };
      }
      this.props.task.characteristics[characteristicID].values[valueID].image = valueIcon;
      ref2 = this.props.task.choices;
      for (choiceID in ref2) {
        choice = ref2[choiceID];
        if ((base = choice.characteristics)[characteristicID] == null) {
          base[characteristicID] = [];
        }
      }
      if (isSet) {
        choiceID = this.makeID(row.name);
        results.push((ref3 = this.props.task.choices[choiceID]) != null ? ref3.characteristics[characteristicID].push(valueID) : void 0);
      } else {
        results.push(void 0);
      }
    }
    return results;
  },
  addConfusion: function(arg) {
    var choiceID, confusionID, details, name, ref, ref1, twin;
    name = arg.name, twin = arg.twin, details = arg.details;
    if (name == null) {
      throw new Error('Confused pairs require a "name" column.');
    }
    if (twin == null) {
      throw new Error('Confused pairs require a "twin" column.');
    }
    this.ensureChoice(name);
    choiceID = this.makeID(name);
    confusionID = this.makeID(twin);
    if ((ref = this.props.task.choices[choiceID]) != null) {
      ref.confusionsOrder.push(confusionID);
    }
    return (ref1 = this.props.task.choices[choiceID]) != null ? ref1.confusions[confusionID] = details : void 0;
  },
  addQuestion: function(arg) {
    var __parsedExtra, answer, answerID, answers, choice, choiceID, exclude, excludeChoices, include, includeChoices, j, k, l, len, len1, len2, multiple, qOrder, question, questionID, ref, required, results;
    question = arg.question, multiple = arg.multiple, required = arg.required, answers = arg.answers, include = arg.include, exclude = arg.exclude, __parsedExtra = arg.__parsedExtra;
    if (!question) {
      throw new Error('Questions require a "question" column');
    }
    if (!answers) {
      throw new Error('Questions require a "answers" column');
    }
    if (!!include) {
      includeChoices = include.split(/\s*;\s*/);
    }
    if (!!exclude) {
      excludeChoices = exclude.split(/\s*;\s*/);
    }
    questionID = this.makeID(question);
    if (!(!!includeChoices || !questionID || (indexOf.call(this.props.task.questionsOrder, questionID) >= 0))) {
      qOrder = this.maybeProp(this.props.task, 'questionsOrder', []);
      qOrder.push(questionID);
    }
    if (includeChoices != null) {
      for (j = 0, len = includeChoices.length; j < len; j++) {
        choice = includeChoices[j];
        choiceID = this.makeID(choice);
        if (!choiceID) {
          continue;
        }
        (this.maybeProp(this.props.task, 'inclusions', [])).push([choiceID, questionID]);
      }
    }
    if (excludeChoices != null) {
      for (k = 0, len1 = excludeChoices.length; k < len1; k++) {
        choice = excludeChoices[k];
        choiceID = this.makeID(choice);
        if (!choiceID) {
          continue;
        }
        (this.maybeProp(this.props.task, 'exclusions', [])).push([choiceID, questionID]);
      }
    }
    this.props.task.questions[questionID] = {
      label: question,
      multiple: this.determineBoolean(multiple),
      required: this.determineBoolean(required),
      answersOrder: [],
      answers: {}
    };
    ref = ((answers.split(/;/)).concat(__parsedExtra != null ? __parsedExtra : [])).filter(Boolean);
    results = [];
    for (l = 0, len2 = ref.length; l < len2; l++) {
      answer = ref[l];
      answerID = this.makeID(answer);
      this.props.task.questions[questionID].answersOrder.push(answerID);
      results.push(this.props.task.questions[questionID].answers[answerID] = {
        label: answer
      });
    }
    return results;
  },
  maybeProp: function(owner, prop, defVal) {
    if (owner[prop] == null) {
      owner[prop] = defVal;
    }
    return owner[prop];
  },
  cleanQuestions: function() {
    var choiceID, excludeTuple, includeTuple, index, j, k, l, len, len1, len2, len3, m, qMap, qSet, questionID, ref, ref1, ref2, ref3;
    if (this.props.task.questionsOrder != null) {
      ref = this.props.task.questionsOrder;
      for (j = 0, len = ref.length; j < len; j++) {
        questionID = ref[j];
        ref1 = this.props.task.choicesOrder;
        for (k = 0, len1 = ref1.length; k < len1; k++) {
          choiceID = ref1[k];
          if (this.props.task.choices[choiceID].noQuestions) {
            continue;
          }
          qMap = this.maybeProp(this.props.task, 'questionsMap', {});
          qSet = this.maybeProp(qMap, choiceID, []);
          qSet.push(questionID);
        }
      }
    }
    if (this.props.task.inclusions != null) {
      ref2 = this.props.task.inclusions;
      for (l = 0, len2 = ref2.length; l < len2; l++) {
        includeTuple = ref2[l];
        qMap = this.maybeProp(this.props.task, 'questionsMap', {});
        qSet = this.maybeProp(qMap, includeTuple[0], []);
        qSet.push(includeTuple[1]);
      }
    }
    if (this.props.task.exclusions != null) {
      ref3 = this.props.task.exclusions;
      for (m = 0, len3 = ref3.length; m < len3; m++) {
        excludeTuple = ref3[m];
        qMap = this.maybeProp(this.props.task, 'questionsMap', {});
        qSet = this.maybeProp(qMap, excludeTuple[0], []);
        index = qSet.indexOf(excludeTuple[1]);
        qSet.splice(index, 1);
      }
    }
    delete this.props.task.inclusions;
    return delete this.props.task.exclusions;
  },
  handleImageAdd: function(media) {
    this.props.task.images[media.metadata.filename] = media.src;
    return this.props.workflow.update('tasks').save();
  },
  handleImageDelete: function(media) {
    delete this.props.task.images[media.metadata.filename];
    return this.props.workflow.update('tasks').save();
  },
  resetTask: function(e) {
    if (e.shiftKey || confirm('Really delete all the data from this task?')) {
      Object.assign(this.props.task, {
        characteristicsOrder: [],
        characteristics: {},
        choicesOrder: [],
        choices: {},
        questionsOrder: [],
        questions: {},
        inclusions: [],
        exclusions: [],
        questionsMap: {}
      });
      return this.props.workflow.update('tasks');
    }
  },
  resetMedia: function(e) {
    var errors, massDelete;
    if (e.shiftKey || confirm('Really delete all the images from this task? This might take a while...')) {
      this.setState({
        resettingMedia: true
      });
      errors = 0;
      massDelete = this.props.workflow.get('attached_images', {
        page_size: 200
      }).then((function(_this) {
        return function(workflowImages) {
          var taskImages;
          taskImages = workflowImages.filter(function(image) {
            return image.metadata.prefix === _this.props.taskPrefix;
          });
          return Promise.all(taskImages.map(function(image) {
            return image["delete"]()["catch"](function() {
              return errors += 1;
            });
          }));
        };
      })(this));
      return massDelete.then((function(_this) {
        return function() {
          _this.setState({
            resettingMedia: false
          });
          if (errors !== 0) {
            return alert("There were " + errors + " errors deleting all those resources. Try again to get the rest.");
          }
        };
      })(this));
    }
  },
  handleImportError: function(error, file, row) {
    this.state.importErrors.push({
      error: error,
      file: file,
      row: row
    });
    return this.setState({
      importErrors: this.state.importErrors
    });
  }
});


},{"../../../components/auto-save":62,"../../../components/details":68,"../../../components/file-button":72,"../../../components/media-area":79,"../../../components/promise-renderer":86,"../../../lib/alert":98,"../../../lib/handle-input-change":103,"../next-task-selector":38,"./editor-help":43,"./utility":47,"markdownz":"markdownz","modal-form/triggered":548,"panoptes-client/lib/api-client":549,"papaparse":"papaparse","react":"react"}],45:[function(require,module,exports){
var AnnotationView, Choice, Chooser, Editor, React, Summary,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

Editor = require('./editor');

Summary = require('./summary');

Chooser = require('./chooser');

Choice = require('./choice');

AnnotationView = require('./annotation-view');

module.exports = React.createClass({
  displayName: 'SurveyTask',
  statics: {
    Editor: Editor,
    Summary: Summary,
    AfterSubject: AnnotationView,
    getDefaultTask: function() {
      return {
        type: 'survey',
        characteristicsOrder: [],
        characteristics: {},
        choicesOrder: [],
        choices: {},
        questionsOrder: [],
        questions: {},
        images: {}
      };
    },
    getTaskText: function(task) {
      return "Survey of " + task.choicesOrder.length + " choices";
    },
    getDefaultAnnotation: function() {
      return {
        value: []
      };
    },
    isAnnotationComplete: function(task, annotation) {
      var ref;
      return annotation.value.length >= ((ref = task.required) != null ? ref : 0) && !annotation._choiceInProgress;
    },
    testAnnotationQuality: function(unknown, knownGood) {
      var knownGoodChoices, matches, total, unknownChoices;
      unknownChoices = unknown.value.map(function(arg) {
        var choice;
        choice = arg.choice;
        return choice;
      });
      knownGoodChoices = knownGood.value.map(function(arg) {
        var choice;
        choice = arg.choice;
        return choice;
      });
      total = 0;
      matches = 0;
      unknownChoices.forEach(function(choice) {
        total += 1;
        if (indexOf.call(knownGoodChoices, choice) >= 0) {
          return matches += 1;
        }
      });
      knownGoodChoices.forEach(function(choice) {
        total += 1;
        if (indexOf.call(unknownChoices, choice) >= 0) {
          return matches += 1;
        }
      });
      if (total === 0) {
        return 1;
      } else {
        return matches / total;
      }
    }
  },
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      onChange: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      filters: {},
      selectedChoiceID: ''
    };
  },
  render: function() {
    return React.createElement("div", {
      "className": "survey-task"
    }, (this.state.selectedChoiceID === '' ? React.createElement(Chooser, {
      "task": this.props.task,
      "filters": this.state.filters,
      "onFilter": this.handleFilter,
      "onChoose": this.handleChoice
    }) : React.createElement(Choice, {
      "task": this.props.task,
      "choiceID": this.state.selectedChoiceID,
      "onSwitch": this.handleChoice,
      "onCancel": this.clearSelection,
      "onConfirm": this.handleAnnotation
    })));
  },
  handleFilter: function(characteristicID, valueID) {
    return setTimeout((function(_this) {
      return function() {
        if (valueID != null) {
          _this.state.filters[characteristicID] = valueID;
        } else {
          delete _this.state.filters[characteristicID];
        }
        return _this.setState({
          filters: _this.state.filters
        });
      };
    })(this));
  },
  handleChoice: function(choiceID) {
    var newAnnotation;
    this.setState({
      selectedChoiceID: choiceID
    });
    newAnnotation = Object.assign({}, this.props.annotation, {
      _choiceInProgress: true
    });
    return this.props.onChange(newAnnotation);
  },
  clearFilters: function() {
    return this.setState({
      filters: {}
    });
  },
  clearSelection: function() {
    var newAnnotation;
    this.setState({
      selectedChoiceID: ''
    });
    newAnnotation = Object.assign({}, this.props.annotation, {
      _choiceInProgress: false
    });
    return this.props.onChange(newAnnotation);
  },
  handleAnnotation: function(choice, answers, e) {
    var filters, ref, ref1, value;
    filters = JSON.parse(JSON.stringify(this.state.filters));
    value = (ref = (ref1 = this.props.annotation.value) != null ? typeof ref1.slice === "function" ? ref1.slice(0) : void 0 : void 0) != null ? ref : [];
    value.push({
      choice: choice,
      answers: answers,
      filters: filters
    });
    this.clearFilters();
    this.clearSelection();
    return setTimeout((function(_this) {
      return function() {
        var newAnnotation;
        newAnnotation = Object.assign({}, _this.props.annotation, {
          value: value
        });
        return _this.props.onChange(newAnnotation);
      };
    })(this));
  }
});


},{"./annotation-view":40,"./choice":41,"./chooser":42,"./editor":44,"./summary":46,"react":"react"}],46:[function(require,module,exports){
var React, Utility;

React = require('react');

Utility = require('./utility');

module.exports = React.createClass({
  displayName: 'SurveySummary',
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      expanded: false
    };
  },
  getInitialState: function() {
    return {
      expanded: this.props.expanded
    };
  },
  render: function() {
    var allAnswers, answerID, answerLabels, choice, choiceSummaries, choiceSummary, i, identification, questionID;
    return React.createElement("div", null, React.createElement("div", {
      "className": "question"
    }, "Survey of ", this.props.task.choicesOrder.length, (this.state.expanded ? React.createElement("button", {
      "type": "button",
      "className": "toggle-more",
      "onClick": this.setState.bind(this, {
        expanded: false
      }, null)
    }, "Less") : React.createElement("button", {
      "type": "button",
      "className": "toggle-more",
      "onClick": this.setState.bind(this, {
        expanded: true
      }, null)
    }, "More"))), React.createElement("div", {
      "className": "answers"
    }, React.createElement("div", {
      "className": "answer"
    }, this.props.annotation.value.length, " identifications"), ((function() {
      var j, len, results;
      if (this.state.expanded) {
        choiceSummaries = (function() {
          var j, len, ref, results;
          ref = this.props.annotation.value;
          results = [];
          for (j = 0, len = ref.length; j < len; j++) {
            identification = ref[j];
            choice = this.props.task.choices[identification.choice];
            allAnswers = (function() {
              var k, len1, ref1, results1;
              ref1 = Utility.getQuestionIDs(this.props.task, identification.choice);
              results1 = [];
              for (k = 0, len1 = ref1.length; k < len1; k++) {
                questionID = ref1[k];
                if (!(questionID in identification.answers)) {
                  continue;
                }
                answerLabels = (function() {
                  var l, len2, ref2, results2;
                  ref2 = [].concat(identification.answers[questionID]);
                  results2 = [];
                  for (l = 0, len2 = ref2.length; l < len2; l++) {
                    answerID = ref2[l];
                    results2.push(this.props.task.questions[questionID].answers[answerID].label);
                  }
                  return results2;
                }).call(this);
                results1.push(answerLabels.join(', '));
              }
              return results1;
            }).call(this);
            results.push(choice.label + ": " + (allAnswers.join('; ')));
          }
          return results;
        }).call(this);
        results = [];
        for (i = j = 0, len = choiceSummaries.length; j < len; i = ++j) {
          choiceSummary = choiceSummaries[i];
          results.push(React.createElement("div", {
            "key": i,
            "className": "answer"
          }, choiceSummary));
        }
        return results;
      }
    }).call(this))));
  }
});


},{"./utility":47,"react":"react"}],47:[function(require,module,exports){
module.exports = {
  getQuestionIDs: function(task, choiceID) {
    if (task.choices[choiceID].noQuestions) {
      return [];
    }
    if (!((task.questionsMap != null) && choiceID in task.questionsMap)) {
      return task.questionsOrder;
    }
    return task.questionsMap[choiceID];
  },
  getQuestions: function(task, choiceID) {
    return this.getQuestionIDs(task, choiceID).map(function(idx) {
      return task.questions[idx];
    });
  }
};


},{}],48:[function(require,module,exports){
var GenericTask, GenericTaskEditor, Markdown, NOOP, React, Summary, levenshtein;

React = require('react');

Markdown = require('markdownz').Markdown;

GenericTask = require('../generic');

GenericTaskEditor = require('../generic-editor');

levenshtein = require('fast-levenshtein');

NOOP = Function.prototype;

Summary = React.createClass({
  displayName: 'TextSummary',
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      expanded: false
    };
  },
  render: function() {
    return React.createElement("div", null, React.createElement("div", {
      "className": "question"
    }, this.props.task.instruction), React.createElement("div", {
      "className": "answers"
    }, (this.props.annotation.value != null ? React.createElement("div", {
      "className": "answer"
    }, "", React.createElement("code", null, this.props.annotation.value), "") : void 0)));
  }
});

module.exports = React.createClass({
  displayName: 'TextTask',
  statics: {
    Editor: GenericTaskEditor,
    Summary: Summary,
    getDefaultTask: function() {
      return {
        type: 'text',
        instruction: 'Enter an instruction.',
        help: ''
      };
    },
    getTaskText: function(task) {
      return task.instruction;
    },
    getDefaultAnnotation: function() {
      return {
        value: ''
      };
    },
    isAnnotationComplete: function(task, annotation) {
      return annotation.value !== '' || !task.required;
    },
    testAnnotationQuality: function(unknown, knownGood) {
      var distance, length;
      distance = levenshtein.get(unknown.value.toLowerCase(), knownGood.value.toLowerCase());
      length = Math.max(unknown.value.length, knownGood.value.length);
      return (length - distance) / length;
    }
  },
  getDefaultProps: function() {
    return {
      task: null,
      annotation: null,
      onChange: NOOP
    };
  },
  render: function() {
    return React.createElement(GenericTask, {
      "question": this.props.task.instruction,
      "help": this.props.task.help,
      "required": this.props.task.required
    }, React.createElement("label", {
      "className": "answer"
    }, React.createElement("textarea", {
      "autoFocus": this.props.autoFocus,
      "className": "standard-input full",
      "rows": "5",
      "ref": "textInput",
      "value": this.props.annotation.value,
      "onChange": this.handleChange
    })));
  },
  handleChange: function() {
    var newAnnotation, value;
    value = React.findDOMNode(this.refs.textInput).value;
    newAnnotation = Object.assign(this.props.annotation, {
      value: value
    });
    return this.props.onChange(newAnnotation);
  }
});


},{"../generic":35,"../generic-editor":34,"fast-levenshtein":"fast-levenshtein","markdownz":"markdownz","react":"react"}],49:[function(require,module,exports){
var React, Tutorial, apiClient;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

Tutorial = require('../lib/tutorial');

module.exports = React.createClass({displayName: "exports",
  getDefaultProps: function() {
    return {
      user: null,
      project: null
    };
  },
  getInitialState: function() {
    return {
      tutorial: null
    };
  },
  componentDidMount: function() {
    return this.fetchTutorialFor(this.props.project);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.project !== this.props.project) {
      return this.fetchTutorialFor(nextProps.project);
    }
  },
  fetchTutorialFor: function(project) {
    return apiClient.type('tutorials').get({
      project_id: project.id
    }).then((function(_this) {
      return function(arg) {
        var tutorial;
        tutorial = arg[0];
        return _this.setState({
          tutorial: tutorial
        });
      };
    })(this));
  },
  render: function() {
    if ((this.state.tutorial != null) && this.state.tutorial.steps.length !== 0) {
      return React.createElement("button", React.__spread({
        "type": "button"
      }, this.props, {
        "onClick": Tutorial.start.bind(Tutorial, this.props.user, this.props.project)
      }), this.props.children);
    } else {
      return null;
    }
  }
});


},{"../lib/tutorial":118,"panoptes-client/lib/api-client":549,"react":"react"}],50:[function(require,module,exports){
var React, TriggeredModalForm;

React = require('react');

TriggeredModalForm = require('modal-form/triggered');

module.exports = function(props) {
  return React.createElement(TriggeredModalForm, {
    "trigger": props.label,
    "triggerProps": {
      className: 'warning-banner'
    }
  }, props.children);
};


},{"modal-form/triggered":548,"react":"react"}],51:[function(require,module,exports){
var Axis, AxisLabel, AxisPoint, Plate, React, ReactDOM, SimplePoint, StarChart, StarCoord, crypto;

React = require('react');

ReactDOM = require('react-dom');

crypto = require('crypto');

SimplePoint = (function() {
  function SimplePoint(x, y) {
    this.x = x;
    this.y = y;
  }

  return SimplePoint;

})();

AxisLabel = (function() {
  function AxisLabel(annotation) {
    this.x = annotation.x, this.y = annotation.y;
    this.value = annotation.details[0].value;
  }

  return AxisLabel;

})();

AxisPoint = (function() {
  function AxisPoint(annotation) {
    this.x = annotation.x, this.y = annotation.y;
    this.value = annotation.details[0].value;
  }

  return AxisPoint;

})();

Axis = (function() {
  Axis.RA = 0;

  Axis.DEC = 1;

  Axis.GLAT = 2;

  Axis.GLON = 3;

  function Axis(range, unit) {
    this.range = range;
    this.unit = unit;
  }

  return Axis;

})();

StarChart = (function() {
  StarChart.GALACTIC = 0;

  StarChart.EQUATORIAL = 1;

  StarChart.OTHER = 2;

  function StarChart(annotation) {
    var pt;
    this.width = annotation.width, this.height = annotation.height, this.x = annotation.x, this.y = annotation.y;
    this.corners = (function() {
      var j, len, ref, results;
      ref = [[this.x, this.y], [this.x, this.y + this.height], [this.x + this.width, this.y], [this.x + this.width, this.y + this.height]];
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        pt = ref[j];
        results.push(new SimplePoint(pt[0], pt[1]));
      }
      return results;
    }).call(this);
    this.axisPoints = [];
    this.axisLabels = [];
    this.valid = false;
  }

  StarChart.prototype.bounds = function() {
    return {
      x: [this.x, this.x + this.width],
      y: [this.y, this.y + this.height]
    };
  };

  StarChart.prototype.calculateDistance = function(p1, p2) {
    return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
  };

  StarChart.prototype.closestCornerDistance = function(p) {
    var corner;
    return {
      chart: this,
      distance: Math.min.apply(null, (function() {
        var j, len, ref, results;
        ref = this.corners;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          corner = ref[j];
          results.push(this.calculateDistance(p, corner));
        }
        return results;
      }).call(this))
    };
  };

  StarChart.prototype.calculateMidpoints = function() {
    var j, len, p1, p2, ref, results;
    this.midpoints = [];
    ref = this.axisPoints;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      p1 = ref[j];
      results.push((function() {
        var k, len1, ref1, results1;
        ref1 = this.axisPoints;
        results1 = [];
        for (k = 0, len1 = ref1.length; k < len1; k++) {
          p2 = ref1[k];
          if (p1 !== p2) {
            results1.push(this.midpoints.push({
              x: (p1.x + p2.x) / 2,
              y: (p1.y + p2.y) / 2
            }));
          } else {
            results1.push(void 0);
          }
        }
        return results1;
      }).call(this));
    }
    return results;
  };

  StarChart.prototype.closestMidpointDistance = function(p) {
    var midpoint, result;
    if (this.midpoints == null) {
      this.calculateMidpoints();
    }
    return result = {
      chart: this,
      distance: Math.min.apply(null, (function() {
        var j, len, ref, results;
        ref = this.midpoints;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          midpoint = ref[j];
          results.push(this.calculateDistance(p, midpoint));
        }
        return results;
      }).call(this))
    };
  };

  StarChart.prototype.addAxisPoint = function(axisPoint) {
    return this.axisPoints.push(axisPoint);
  };

  StarChart.prototype.addAxisLabel = function(axisLabel) {
    return this.axisLabels.push(axisLabel);
  };

  StarChart.prototype.filterBounds = function(items, prop, bounds) {
    var i, j, len, results;
    results = [];
    for (j = 0, len = items.length; j < len; j++) {
      i = items[j];
      if (i[prop] < bounds[prop][0] || i[prop] > bounds[prop][1]) {
        results.push(i);
      }
    }
    return results;
  };

  StarChart.prototype.buildAxes = function() {
    var bounds, xLabel, xRange, yLabel, yRange;
    if (this.axisPoints.length >= 3 && this.axisLabels.length >= 2) {
      this.valid = true;
      bounds = this.bounds();
      xLabel = (this.filterBounds(this.axisLabels, 'y', bounds))[0];
      yLabel = (this.filterBounds(this.axisLabels, 'x', bounds))[0];
      xRange = (this.filterBounds(this.axisPoints, 'y', bounds)).sort(function(a, b) {
        return a.x > b.x;
      }).slice(0, 2);
      yRange = (this.filterBounds(this.axisPoints, 'x', bounds)).sort(function(a, b) {
        return a.y > b.y;
      }).slice(0, 2);
      if (!xRange[1]) {
        xRange[1] = xRange[0];
      }
      if (!yRange[1]) {
        yRange[1] = yRange[0];
      }
      this.xAxis = new Axis(xRange, xLabel.value);
      return this.yAxis = new Axis(yRange, yLabel.value);
    }
  };

  StarChart.prototype.coordinateSystem = function() {
    var coords;
    coords = StarChart.OTHER;
    if ((this.xAxis.unit === Axis.RA && this.yAxis.unit === Axis.DEC) || (this.xAxis.unit === Axis.DEC && this.yAxis.unit === Axis.RA)) {
      coords = StarChart.EQUATORIAL;
    }
    if ((this.xAxis.unit === Axis.GLAT && this.yAxis.unit === Axis.GLON) || (this.xAxis.unit === Axis.GLON && this.yAxis.unit === Axis.GLAT)) {
      coords = StarChart.GALACTIC;
    }
    return coords;
  };

  return StarChart;

})();

Plate = (function() {
  function Plate(starChart, url1, user_name) {
    var makeStarCoord, ref, xAxisDec, xRange, yRange;
    this.starChart = starChart;
    this.url = url1;
    this.user_name = user_name;
    this.imageBounds = this.starChart.bounds();
    ref = [this.starChart.xAxis.range, this.starChart.yAxis.range], xRange = ref[0], yRange = ref[1];
    this.xyCorners = [new SimplePoint(xRange[0].x, yRange[0].y), new SimplePoint(xRange[1].x, yRange[0].y), new SimplePoint(xRange[1].x, yRange[1].y), new SimplePoint(xRange[0].x, yRange[1].y)];
    makeStarCoord = this.starChart.coordinateSystem() === StarChart.EQUATORIAL ? StarCoord.fromRaDec : StarCoord.fromGlatGlon;
    xAxisDec = this.starChart.xAxis.unit === Axis.DEC || this.starChart.xAxis.unit === Axis.GLAT ? true : false;
    this.coordCorners = [makeStarCoord(xRange[0].value, yRange[0].value, xAxisDec), makeStarCoord(xRange[1].value, yRange[0].value, xAxisDec), makeStarCoord(xRange[1].value, yRange[1].value, xAxisDec), makeStarCoord(xRange[0].value, yRange[1].value, xAxisDec)];
  }

  Plate.prototype.scale = function() {
    var angularSep, averageDec, deltaDec, deltaRA, pixelSep, ref, ref1, star1, star2, xy1, xy2;
    ref = [this.coordCorners[0], this.coordCorners[2]], star1 = ref[0], star2 = ref[1];
    ref1 = [this.xyCorners[0], this.xyCorners[2]], xy1 = ref1[0], xy2 = ref1[1];
    averageDec = (star1.dec + star2.dec) / 2;
    deltaRA = ((star2.ra - star1.ra) * Math.cos(averageDec * Math.PI / 180)) * 3600;
    deltaDec = (star2.dec - star1.dec) * 3600;
    angularSep = Math.sqrt(Math.pow(deltaRA, 2) + Math.pow(deltaDec, 2));
    pixelSep = Math.sqrt(Math.pow(xy1.x - xy2.x, 2) + Math.pow(xy1.y - xy2.y, 2));
    return angularSep / pixelSep;
  };

  Plate.prototype.centerCoords = function() {
    var center;
    center = {
      x: this.starChart.width / 2,
      y: this.starChart.height / 2,
      ra: (this.coordCorners[0].ra + this.coordCorners[2].ra) / 2,
      dec: (this.coordCorners[0].dec + this.coordCorners[2].dec) / 2
    };
    return center;
  };

  Plate.prototype.getCropUrl = function() {
    var url;
    url = this.url.replace(/^https?\:\/\//i, "");
    return "http://imgproc.zooniverse.org/crop/" + this.starChart.width + "/" + this.starChart.height + "/" + this.starChart.x + "/" + this.starChart.y + "?u=" + url;
  };

  Plate.prototype.computeRotation = function() {
    if (this.starChart.xAxis.unit === Axis.RA || this.starChart.xAxis.unit === Axis.GLAT) {
      return 180;
    } else {
      return 90;
    }
  };

  Plate.prototype.computeName = function() {
    var hashTime;
    hashTime = crypto.createHash('md5').update(new Date().toString()).digest('hex').slice(0, 10);
    return this.user_name + hashTime;
  };

  Plate.prototype.getWwtUrl = function() {
    var base, center, name, rotation;
    base = "http://www.worldwidetelescope.org/wwtweb/ShowImage.aspx";
    rotation = this.computeRotation();
    name = this.computeName();
    center = this.centerCoords();
    return base + "?name=" + name + "&ra=" + center.ra + "&dec=" + center.dec + "&x=" + center.x + "&y=" + center.y + "&scale=" + (this.scale()) + "&rotation=" + rotation + "&imageurl=" + (this.getCropUrl());
  };

  return Plate;

})();

StarCoord = (function() {
  var s;

  function StarCoord(ra1, dec1) {
    this.ra = ra1;
    this.dec = dec1;
  }

  s = StarCoord;

  StarCoord.fromRaDec = function(xAxis, yAxis, xAxisDec) {
    var dec, ra;
    if (xAxisDec === true) {
      ra = yAxis;
      dec = xAxis;
    } else {
      ra = xAxis;
      dec = yAxis;
    }
    ra = StarCoord._parseDegrees(ra, false);
    dec = StarCoord._parseDegrees(dec, true);
    return new StarCoord(ra, dec);
  };

  StarCoord.fromGlatGlon = function(xAxis, yAxis, xAxisGlat) {
    var b, dec, glat, glon, l, pole_dec, pole_ra, posangle, ra, ref;
    if (xAxisGlat === true) {
      glat = xAxis;
      glon = yAxis;
    } else {
      glon = xAxis;
      glat = yAxis;
    }
    glat = glat.replace(/[^\d.-]/g, '');
    glon = glon.replace(/[^\d.-]/g, '');
    ref = [s._toRadians(glat), s._toRadians(glon), s._toRadians(192.859508), s._toRadians(27.128336), s._toRadians(122.932 - 90.0)], b = ref[0], l = ref[1], pole_ra = ref[2], pole_dec = ref[3], posangle = ref[4];
    ra = s._toDegrees(Math.atan2(Math.cos(b) * Math.cos(l - posangle), Math.sin(b) * Math.cos(pole_dec) - Math.cos(b) * Math.sin(pole_dec) * Math.sin(l - posangle)) + pole_ra);
    dec = s._toDegrees(Math.asin(Math.cos(b) * Math.cos(pole_dec) * Math.sin(l - posangle) + Math.sin(b) * Math.sin(pole_dec)));
    return new StarCoord(ra, dec);
  };

  StarCoord._toRadians = function(degrees) {
    return degrees * Math.PI / 180.0;
  };

  StarCoord._toDegrees = function(radians) {
    return radians * 180.0 / Math.PI;
  };

  StarCoord._parseDegrees = function(str, dec) {
    var isNeg, match, reg;
    if (!isNaN(str)) {
      return parseFloat(str);
    }
    isNeg = false;
    reg = /(?:(-)?(\d+(?:\.\d+)?))(?:\D+(\d+(?:\.\d+)?))?(?:\D+(\d+(?:\.\d+)?))?/;
    match = reg.exec(str);
    isNeg = match[1] === '-';
    match.shift();
    if (dec === true) {
      return s._decConvert(match, isNeg);
    } else {
      return s._raConvert(match, isNeg);
    }
  };

  StarCoord._raConvert = function(match, isNeg) {
    return (parseInt(match[1], 10) * 15 + (parseInt(match[2], 10) / 4 || 0) + (parseInt(match[3]) / 240 || 0)) * (isNeg ? -1 : 1);
  };

  StarCoord._decConvert = function(match, isNeg) {
    return (parseInt(match[1], 10) + (parseInt(match[2], 10) / 60 || 0) + (parseInt(match[3]) / 3600 || 0)) * (isNeg ? -1 : 1);
  };

  return StarCoord;

})();

module.exports = React.createClass({
  displayName: 'WorldWideTelescope',
  parseClassification: function() {
    var annotation, chart, closest, distances, j, k, label, len, len1, len2, m, point, ref, ref1, ref2, results;
    this.charts = (function() {
      var j, len, ref, results;
      ref = this.props.annotations[1].value;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        annotation = ref[j];
        results.push(new StarChart(annotation));
      }
      return results;
    }).call(this);
    ref = this.props.annotations[2].value;
    for (j = 0, len = ref.length; j < len; j++) {
      annotation = ref[j];
      point = new AxisPoint(annotation);
      distances = (function() {
        var k, len1, ref1, results;
        ref1 = this.charts;
        results = [];
        for (k = 0, len1 = ref1.length; k < len1; k++) {
          chart = ref1[k];
          results.push(chart.closestCornerDistance(point));
        }
        return results;
      }).call(this);
      closest = distances.sort(function(a, b) {
        return a.distance > b.distance;
      })[0].chart;
      closest.addAxisPoint(point);
    }
    ref1 = this.props.annotations[3].value;
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      annotation = ref1[k];
      label = new AxisLabel(annotation);
      distances = (function() {
        var len2, m, ref2, results;
        ref2 = this.charts;
        results = [];
        for (m = 0, len2 = ref2.length; m < len2; m++) {
          chart = ref2[m];
          results.push(chart.closestMidpointDistance(label));
        }
        return results;
      }).call(this);
      closest = distances.sort(function(a, b) {
        return a.distance > b.distance;
      })[0].chart;
      closest.addAxisLabel(label);
    }
    ref2 = this.charts;
    results = [];
    for (m = 0, len2 = ref2.length; m < len2; m++) {
      chart = ref2[m];
      results.push(chart.buildAxes());
    }
    return results;
  },
  render: function() {
    var chart, j, len, plates, ref, subjImage;
    if (!this.props.annotations[1]) {
      return React.createElement("div", null);
    }
    subjImage = this.props.subject.locations[0]["image/jpeg"];
    this.parseClassification();
    plates = [];
    ref = this.charts;
    for (j = 0, len = ref.length; j < len; j++) {
      chart = ref[j];
      if (chart.valid) {
        plates.push(new Plate(chart, subjImage, this.props.user_name));
      }
    }
    return React.createElement("div", null, plates.map(function(plate, idx) {
      return React.createElement("div", {
        "key": idx
      }, React.createElement("p", null, "View Your Classification in the WorldWide Telescope!"), React.createElement("img", {
        "className": "chart-image",
        "src": "" + (plate.getCropUrl())
      }), React.createElement("a", {
        "target": "_blank",
        "href": plate.getWwtUrl(),
        "className": 'telescope-button standard-button'
      }, "World Wide Telescope"));
    }));
  }
});


},{"crypto":307,"react":"react","react-dom":"react-dom"}],52:[function(require,module,exports){
var CollectionRole, ID_PREFIX, POSSIBLE_ROLES, PromiseRenderer, ROLES_INFO, React, ReactDOM, RoleCreator, RoleRow, Translate, UserSearch, apiClient, counterpart,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

ReactDOM = require('react-dom');

counterpart = require('counterpart');

UserSearch = require('../components/user-search');

apiClient = require('panoptes-client/lib/api-client');

counterpart = require('counterpart');

CollectionRole = require('../lib/collection-role');

PromiseRenderer = require('../components/promise-renderer');

Translate = require('react-translate-component').Translate;

ID_PREFIX = 'COLLECTION_COLLABORATORS_PAGE_';

POSSIBLE_ROLES = ["owner", "collaborator", "viewer"];

ROLES_INFO = {
  owner: {
    label: "Owner",
    description: "The collection creator. There can only be one."
  },
  collaborator: {
    label: "Collaborator",
    description: "Collaborators have full access to add and remove subjects from the collection."
  },
  viewer: {
    label: "Viewer",
    description: "Viewers can see this collection even if it's private."
  }
};

RoleCreator = React.createClass({
  displayName: "RoleCreator",
  getDefaultProps: function() {
    return {
      collection: null
    };
  },
  getInitialState: function() {
    return {
      error: null,
      creating: null
    };
  },
  render: function() {
    var errorMessage, rawErrorMessage, role, style;
    style = this.state.creating ? {
      opacity: 0.5,
      pointerEvents: 'none'
    } : void 0;
    return React.createElement("div", null, (this.state.error != null ? (rawErrorMessage = this.state.error.toString(), errorMessage = (function() {
      switch (false) {
        case !rawErrorMessage.indexOf('No User with id'):
          return 'That user doesn\'t exist!';
        default:
          return 'Error adding user.';
      }
    })(), React.createElement("p", {
      "className": "form-help error"
    }, errorMessage)) : void 0), React.createElement("form", {
      "style": style
    }, React.createElement("div", null, React.createElement(UserSearch, null)), React.createElement("table", {
      "className": "standard-table"
    }, React.createElement("tbody", null, (function() {
      var i, len, results;
      results = [];
      for (i = 0, len = POSSIBLE_ROLES.length; i < len; i++) {
        role = POSSIBLE_ROLES[i];
        results.push(React.createElement("tr", {
          "key": role
        }, React.createElement("td", null, React.createElement("input", {
          "id": ID_PREFIX + role,
          "type": "checkbox",
          "name": "role",
          "value": role,
          "disabled": role === 'owner'
        })), React.createElement("td", null, React.createElement("strong", null, React.createElement("label", {
          "htmlFor": ID_PREFIX + role
        }, ROLES_INFO[role].label))), React.createElement("td", null, ROLES_INFO[role].description)));
      }
      return results;
    })())), React.createElement("p", null, React.createElement("button", {
      "type": "submit",
      "className": "major-button",
      "onClick": this.handleSubmit
    }, "Add user role"))));
  },
  handleSubmit: function(e) {
    var checkbox, checkboxes, id, newRoleSet, node, roleSet, roleSets, roles, userids, users;
    e.preventDefault();
    node = ReactDOM.findDOMNode(this);
    checkboxes = node.querySelectorAll('[name="role"]');
    userids = node.querySelector('[name="userids"]');
    users = userids.value.split(',').map(function(id) {
      return parseInt(id);
    });
    roles = (function() {
      var i, len, results;
      results = [];
      for (i = 0, len = checkboxes.length; i < len; i++) {
        checkbox = checkboxes[i];
        if (checkbox.checked) {
          results.push(checkbox.value);
        }
      }
      return results;
    })();
    this.setState({
      error: null,
      creating: true
    });
    roleSets = (function() {
      var i, len, results;
      results = [];
      for (i = 0, len = users.length; i < len; i++) {
        id = users[i];
        results.push(newRoleSet = apiClient.type('collection_roles').create({
          roles: roles,
          links: {
            collection: this.props.collection.id,
            user: id
          }
        }));
      }
      return results;
    }).call(this);
    return Promise.all((function() {
      var i, len, results;
      results = [];
      for (i = 0, len = roleSets.length; i < len; i++) {
        roleSet = roleSets[i];
        results.push(roleSet.save());
      }
      return results;
    })()).then((function(_this) {
      return function() {
        var base, i, len;
        userids.value = '';
        for (i = 0, len = checkboxes.length; i < len; i++) {
          checkbox = checkboxes[i];
          checkbox.checked = false;
        }
        return typeof (base = _this.props).onAdd === "function" ? base.onAdd.apply(base, arguments) : void 0;
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          creating: false
        });
      };
    })(this));
  }
});

RoleRow = React.createClass({
  displayName: "RoleRow",
  getDefaultProps: function() {
    return {
      roleSet: null,
      onRemove: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      saving: null,
      owner: null
    };
  },
  componentDidMount: function() {
    return this.props.roleSet.get('owner').then((function(_this) {
      return function(owner) {
        return _this.setState({
          owner: owner
        });
      };
    })(this));
  },
  removeRoles: function() {
    return this.updateRoles([], this.props.onRemove);
  },
  toggleRole: function(role) {
    var currentRoles, index;
    currentRoles = this.props.roleSet.roles;
    if (indexOf.call(currentRoles, role) >= 0) {
      index = currentRoles.indexOf(role);
      currentRoles.splice(index, 1);
    } else {
      currentRoles.push(role);
    }
    if (currentRoles.length) {
      return this.updateRoles(currentRoles);
    } else {
      return this.removeRoles();
    }
  },
  updateRoles: function(newRoles, callback) {
    var promise;
    if (newRoles == null) {
      newRoles = [];
    }
    if (callback == null) {
      callback = function() {};
    }
    this.setState({
      saving: true
    });
    promise = newRoles.length > 0 ? this.props.roleSet.update({
      roles: newRoles
    }).save() : this.props.roleSet["delete"]();
    return promise["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return callback(function() {
          return _this.setState({
            saving: false
          });
        });
      };
    })(this));
  },
  render: function() {
    var owner, role;
    owner = this.state.owner;
    return React.createElement("p", null, (owner ? React.createElement("strong", null, owner.login) : void 0), React.createElement("button", {
      "type": "button",
      "className": "pill-button",
      "onClick": this.removeRoles
    }, "Remove"), React.createElement("br", null), React.createElement("span", {
      "className": "columns-container inline"
    }, (function() {
      var i, len, results;
      results = [];
      for (i = 0, len = POSSIBLE_ROLES.length; i < len; i++) {
        role = POSSIBLE_ROLES[i];
        results.push(React.createElement("label", {
          "key": role
        }, React.createElement("input", {
          "type": "checkbox",
          "name": role,
          "checked": (indexOf.call(this.props.roleSet.roles, role) >= 0),
          "disabled": role === 'owner' || this.state.saving,
          "onChange": this.toggleRole.bind(this, role)
        }), ' ', ROLES_INFO[role].label));
      }
      return results;
    }).call(this)));
  }
});

module.exports = React.createClass({
  displayName: "CollectionCollaborators",
  mixins: [CollectionRole],
  getDefaultProps: function() {
    return {
      collection: null
    };
  },
  getInitialState: function() {
    return {
      error: null,
      owner: null,
      roleSets: []
    };
  },
  componentDidMount: function() {
    return this.update();
  },
  update: function(callback) {
    var promise;
    if (callback == null) {
      callback = function() {};
    }
    promise = Promise.all([
      apiClient.type('collection_roles').get({
        collection_id: this.props.collection.id
      }), this.props.collection.get('owner')
    ]);
    return promise.then((function(_this) {
      return function(arg) {
        var owner, roleSets;
        roleSets = arg[0], owner = arg[1];
        return _this.setState({
          roleSets: roleSets,
          owner: owner
        }, callback);
      };
    })(this));
  },
  handleCollaboratorChange: function() {
    this.props.collection.uncacheLink('collection_roles');
    return this.update();
  },
  render: function() {
    return React.createElement(PromiseRenderer, {
      "promise": this.hasSettingsRole()
    }, ((function(_this) {
      return function(hasSettingsRole) {
        var owner, ref, roleSet, roleSets;
        if (hasSettingsRole) {
          ref = _this.state, roleSets = ref.roleSets, owner = ref.owner;
          return React.createElement("div", {
            "className": "collection-settings-tab"
          }, (_this.state.error != null ? React.createElement("p", {
            "className": "form-help error"
          }, _this.state.error.toString()) : void 0), (roleSets.length === 1 ? React.createElement("div", {
            "className": "helpful-tip"
          }, "None yet, add some with the form below.") : void 0), (owner && roleSets.length > 1 ? React.createElement("div", null, (function() {
            var i, len, results;
            results = [];
            for (i = 0, len = roleSets.length; i < len; i++) {
              roleSet = roleSets[i];
              if (owner.id === roleSet.links.owner.id) {
                continue;
              }
              results.push(React.createElement(RoleRow, {
                "key": roleSet.id,
                "roleSet": roleSet,
                "onRemove": this.handleCollaboratorChange
              }));
            }
            return results;
          }).call(_this)) : void 0), React.createElement("br", null), React.createElement("hr", null), React.createElement("br", null), React.createElement("div", {
            "className": "form-label"
          }, "Add a collaborator"), React.createElement(RoleCreator, {
            "collection": _this.props.collection,
            "onAdd": _this.handleCollaboratorChange
          }));
        } else {
          return React.createElement("div", {
            "className": "collection-settings-tab"
          }, React.createElement("p", null, "Not allowed to edit this collection"));
        }
      };
    })(this)));
  }
});


},{"../components/promise-renderer":86,"../components/user-search":95,"../lib/collection-role":99,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react","react-dom":"react-dom","react-translate-component":"react-translate-component"}],53:[function(require,module,exports){
var React, Translate, apiClient, counterpart;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

counterpart = require('counterpart');

Translate = require('react-translate-component');

counterpart.registerTranslations('en', {
  collectionCreateForm: {
    "private": 'Private',
    submit: "Add Collection"
  }
});

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CollectionsCreateForm',
    getInitialState: function() {
      return {
        error: null,
        collectionNameLength: 0
      };
    },
    onSubmit: function(e) {
      var collection, displayName, links, notPublic;
      e.preventDefault();
      displayName = this.refs.name.value;
      notPublic = this.refs["private"].checked;
      links = {};
      if (this.props.project != null) {
        links.project = +this.props.project;
      }
      if (this.props.subject != null) {
        links.subjects = [+this.props.subject];
      }
      collection = {
        display_name: displayName,
        "private": notPublic,
        links: links
      };
      return apiClient.type('collections').create(collection).save()["catch"]((function(_this) {
        return function(e) {
          return _this.setState({
            error: e
          });
        };
      })(this)).then((function(_this) {
        return function(collection) {
          _this.refs.name.value = '';
          _this.refs["private"].value = true;
          return _this.props.onSubmit(collection);
        };
      })(this));
    },
    handleNameInputChange: function() {
      return this.setState({
        collectionNameLength: this.refs.name.value.length
      });
    },
    render: function() {
      var apiError, errorMessage;
      return React.createElement("div", null, React.createElement("form", {
        "onSubmit": this.onSubmit,
        "className": "collections-create-form"
      }, (this.state.error != null ? (apiError = this.state.error.toString(), errorMessage = (function() {
        switch (false) {
          case !apiError.indexOf('Must be unique'):
            return 'You can\'t name two collections the same thing!';
          default:
            return 'There was a problem creating your collection.';
        }
      })(), React.createElement("div", {
        "className": "form-help error"
      }, errorMessage)) : void 0), React.createElement("input", {
        "className": "collection-name-input",
        "ref": "name",
        "onChange": this.handleNameInputChange,
        "placeholder": "Collection Name"
      }), React.createElement("div", {
        "className": "collection-create-form-actions"
      }, React.createElement("label", null, React.createElement("input", {
        "ref": "private",
        "type": "checkbox",
        "defaultChecked": false
      }), React.createElement(Translate, {
        "content": "collectionCreateForm.private"
      })), React.createElement("div", {
        "className": "submit-button-container"
      }, (this.state.collectionNameLength === 0 ? React.createElement("button", {
        "type": "submit",
        "disabled": true
      }, React.createElement(Translate, {
        "content": "collectionCreateForm.submit"
      })) : React.createElement("button", {
        "type": "submit"
      }, React.createElement(Translate, {
        "content": "collectionCreateForm.submit"
      })))))));
    }
  });
}


},{"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react","react-translate-component":"react-translate-component"}],54:[function(require,module,exports){
var PromiseRenderer, React, SignInPrompt, alert, apiClient, getFavoritesName;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

getFavoritesName = require('./get-favorites-name');

alert = require('../lib/alert');

SignInPrompt = require('../partials/sign-in-prompt');

PromiseRenderer = require('../components/promise-renderer');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CollectionFavoritesButton',
    propTypes: {
      subject: React.PropTypes.object,
      project: React.PropTypes.object,
      user: React.PropTypes.object
    },
    getDefaultProps: function() {
      return {
        subject: null,
        project: null,
        user: null
      };
    },
    getInitialState: function() {
      return {
        favoritesPromise: null,
        favoritedPromise: null,
        favorites: {},
        favorited: false
      };
    },
    promptToSignIn: function() {
      return alert(function(resolve) {
        return React.createElement(SignInPrompt, {
          "onChoose": resolve
        }, React.createElement("p", null, "You must be signed in to save your favorites."));
      });
    },
    findFavoriteCollection: function() {
      var ref;
      return apiClient.type('collections').get({
        project_ids: (ref = this.props.project) != null ? ref.id : void 0,
        favorite: true,
        owner: this.props.user.login
      }).then(function(arg) {
        var favorites;
        favorites = arg[0];
        if (favorites != null) {
          return favorites;
        } else {
          return null;
        }
      });
    },
    findSubjectInCollection: function(favorites) {
      if (favorites != null) {
        return favorites.get('subjects', {
          id: this.props.subject.id
        }).then(function(arg) {
          var subject;
          subject = arg[0];
          return subject != null;
        });
      } else {
        return Promise.resolve(false);
      }
    },
    componentWillMount: function() {
      var favoritedPromise, favoritesPromise;
      favoritesPromise = this.findFavoriteCollection();
      favoritedPromise = favoritesPromise.then((function(_this) {
        return function(favs) {
          return _this.findSubjectInCollection(favs);
        };
      })(this));
      return this.setState({
        favoritesPromise: favoritesPromise,
        favoritedPromise: favoritedPromise
      });
    },
    addSubjectTo: function(collection) {
      return collection.addLink('subjects', [this.props.subject.id.toString()]).then((function(_this) {
        return function(collection) {
          return _this.setState({
            favoritedPromise: Promise.resolve(true)
          });
        };
      })(this));
    },
    removeSubjectFrom: function(collection) {
      return collection.removeLink('subjects', [this.props.subject.id.toString()]).then((function(_this) {
        return function(collection) {
          return _this.setState({
            favoritedPromise: Promise.resolve(false)
          });
        };
      })(this));
    },
    createFavorites: function() {
      var collection, display_name, favorite, links, project, ref, subjects;
      display_name = getFavoritesName(this.props.project);
      project = (ref = this.props.project) != null ? ref.id : void 0;
      subjects = [this.props.subject.id];
      favorite = true;
      links = {
        subjects: subjects
      };
      if (project != null) {
        links.projects = [project];
      }
      collection = {
        favorite: favorite,
        display_name: display_name,
        links: links
      };
      return apiClient.type('collections').create(collection).save().then((function(_this) {
        return function() {
          return _this.setState({
            favoritedPromise: Promise.resolve(true)
          });
        };
      })(this));
    },
    toggleFavorite: function() {
      if (this.props.user != null) {
        return Promise.all([this.state.favoritesPromise, this.state.favoritedPromise]).then((function(_this) {
          return function(arg) {
            var favorited, favorites;
            favorites = arg[0], favorited = arg[1];
            if (favorites == null) {
              return _this.createFavorites();
            } else if (favorited) {
              return _this.removeSubjectFrom(favorites);
            } else {
              return _this.addSubjectTo(favorites);
            }
          };
        })(this));
      } else {
        return this.promptToSignIn();
      }
    },
    render: function() {
      return React.createElement(PromiseRenderer, {
        "promise": this.state.favoritedPromise
      }, ((function(_this) {
        return function(favorited) {
          return React.createElement("button", {
            "className": "favorites-button",
            "type": "button",
            "title": (favorited ? 'Unfavorite' : 'Favorite'),
            "onClick": _this.toggleFavorite
          }, React.createElement("i", {
            "className": "fa fa-heart" + (favorited ? '' : '-o') + " " + (favorited ? 'favorited' : '')
          }));
        };
      })(this)));
    }
  });
}


},{"../components/promise-renderer":86,"../lib/alert":98,"../partials/sign-in-prompt":228,"./get-favorites-name":55,"panoptes-client/lib/api-client":549,"react":"react"}],55:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = function(project) {
    var name;
    name = "Favorites";
    if (project != null) {
      name += " (" + project.slug + ")";
    }
    return name;
  };
}


},{}],56:[function(require,module,exports){
var CollectionsManager, Dialog, React;

React = require('react');

CollectionsManager = require('./manager');

Dialog = require('modal-form/dialog');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CollectionsManagerIcon',
    propTypes: {
      subject: React.PropTypes.object,
      user: React.PropTypes.object
    },
    getInitialState: function() {
      return {
        open: false
      };
    },
    open: function() {
      return this.setState({
        open: true
      });
    },
    close: function() {
      return this.setState({
        open: false
      });
    },
    render: function() {
      return React.createElement("button", {
        "className": "collections-manager-icon",
        "title": "Collect",
        "onClick": this.open
      }, React.createElement("i", {
        "className": "fa fa-list"
      }), (this.state.open ? React.createElement(Dialog, {
        "tag": "div",
        "closeButton": true,
        "onCancel": this.close
      }, React.createElement(CollectionsManager, {
        "user": this.props.user,
        "project": this.props.project,
        "subject": this.props.subject,
        "onSuccess": this.close
      })) : void 0));
    }
  });
}


},{"./manager":57,"modal-form/dialog":546,"react":"react"}],57:[function(require,module,exports){
var CollectionSearch, CollectionsCreateForm, React, apiClient;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

CollectionsCreateForm = require('./create-form');

CollectionSearch = require('../components/collection-search');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CollectionsManager',
    getInitialState: function() {
      return {
        error: null,
        collections: []
      };
    },
    getDefaultProps: function() {
      return {
        project: null
      };
    },
    propTypes: {
      subject: React.PropTypes.object,
      project: React.PropTypes.object
    },
    addToCollections: function() {
      var collection, collections, promises;
      collections = this.refs.search.getSelected();
      if (!(collections.length > 0)) {
        return;
      }
      promises = (function() {
        var i, len, results;
        results = [];
        for (i = 0, len = collections.length; i < len; i++) {
          collection = collections[i].collection;
          results.push(collection.addLink('subjects', [this.props.subject.id]));
        }
        return results;
      }).call(this);
      return Promise.all(promises).then((function(_this) {
        return function() {
          return _this.props.onSuccess();
        };
      })(this))["catch"]((function(_this) {
        return function(error) {
          return _this.setState({
            error: error
          });
        };
      })(this));
    },
    render: function() {
      var ref;
      return React.createElement("div", {
        "className": "collections-manager"
      }, React.createElement("h1", null, "Add Subject to Collection"), React.createElement("div", null, (this.state.error != null ? React.createElement("div", {
        "className": "form-help error"
      }, this.state.error.toString()) : void 0), React.createElement(CollectionSearch, {
        "ref": "search",
        "multi": true,
        "project": this.props.project,
        "onChange": this.handleChange
      }), React.createElement("button", {
        "type": "button",
        "className": "standard-button search-button",
        "disabled": (this.state.hasCollectionSelected ? true : false),
        "onClick": this.addToCollections
      }, "Add")), React.createElement("hr", null), React.createElement("div", {
        "className": "form-help"
      }, "Or Create a new Collection"), React.createElement(CollectionsCreateForm, {
        "project": ((ref = this.props.project) != null ? ref.id : void 0),
        "subject": this.props.subject.id,
        "onSubmit": this.props.onSuccess
      }));
    }
  });
}


},{"../components/collection-search":66,"./create-form":53,"panoptes-client/lib/api-client":549,"react":"react"}],58:[function(require,module,exports){
var Avatar, Link, Loading, React, Thumbnail, apiClient, getSubjectLocation;

React = require('react');

Link = require('react-router').Link;

apiClient = require('panoptes-client/lib/api-client');

Loading = require('../components/loading-indicator');

Thumbnail = require('../components/thumbnail');

Avatar = require('../partials/avatar');

getSubjectLocation = require('../lib/get-subject-location');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CollectionPreview',
    componentWillMount: function() {
      return this.getCollections();
    },
    getInitialState: function() {
      return {
        subjects: null,
        owner: null
      };
    },
    getCollections: function() {
      var query;
      query = {
        collection_id: this.props.collection.id,
        page_size: 3
      };
      this.props.collection.get('owner').then((function(_this) {
        return function(owner) {
          return _this.setState({
            owner: owner
          });
        };
      })(this));
      return apiClient.type('subjects').get(query).then((function(_this) {
        return function(subjects) {
          return _this.setState({
            subjects: subjects
          });
        };
      })(this));
    },
    render: function() {
      var name, owner, ref, subject;
      ref = this.props.collection.slug.split('/'), owner = ref[0], name = ref[1];
      return React.createElement("div", {
        "className": "collection-preview"
      }, React.createElement("div", {
        "className": "collection"
      }, React.createElement("p", {
        "className": "title"
      }, React.createElement(Link, {
        "to": "/collections/" + owner + "/" + name
      }, this.props.collection.display_name), ' ', "by", ' ', (this.state.owner ? React.createElement(Link, {
        "className": "user-profile-link",
        "to": "/users/" + this.state.owner.login
      }, React.createElement(Avatar, {
        "user": this.state.owner
      }), ' ', this.state.owner.display_name) : void 0)), React.createElement("div", {
        "className": "subject-previews"
      }, (this.state.subjects ? React.createElement("div", null, (function() {
        var i, len, ref1, results;
        ref1 = this.state.subjects;
        results = [];
        for (i = 0, len = ref1.length; i < len; i++) {
          subject = ref1[i];
          results.push(React.createElement(Thumbnail, {
            "key": "collection-preview-" + this.props.collection.id + "-" + subject.id,
            "src": (getSubjectLocation(subject).src),
            "width": 100.
          }));
        }
        return results;
      }).call(this)) : React.createElement(Loading, null)))));
    }
  });
}


},{"../components/loading-indicator":77,"../components/thumbnail":93,"../lib/get-subject-location":102,"../partials/avatar":212,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],59:[function(require,module,exports){
var ChangeListener, CollectionDeleteDialog, CollectionRole, DisplayNameSlugEditor, History, PromiseRenderer, React, SetToggle, alert, apiClient;

React = require('react');

History = require('react-router').History;

DisplayNameSlugEditor = require('../partials/display-name-slug-editor');

apiClient = require('panoptes-client/lib/api-client');

alert = require('../lib/alert');

SetToggle = require('../lib/set-toggle');

CollectionRole = require('../lib/collection-role');

ChangeListener = require('../components/change-listener');

PromiseRenderer = require('../components/promise-renderer');

CollectionDeleteDialog = React.createClass({
  displayName: 'CollectionDeleteDialog',
  getDefaultProps: function() {
    return {
      collection: null,
      onComplete: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      isDeleting: false
    };
  },
  deleteCollection: function() {
    this.setState({
      isDeleting: true
    });
    return this.props.collection["delete"]().then((function(_this) {
      return function() {
        return _this.props.onComplete();
      };
    })(this));
  },
  render: function() {
    return React.createElement("div", null, React.createElement("p", null, "Are you sure you want to delete this collection? This action is irreversible!"), (this.state.isDeleting ? React.createElement("div", null, React.createElement("button", {
      "className": "major-button",
      "disabled": true
    }, React.createElement("i", {
      "className": "fa fa-spinner"
    })), ' ') : void 0), (!this.state.isDeleting ? React.createElement("div", null, React.createElement("button", {
      "className": "major-button",
      "onClick": this.deleteCollection
    }, "Yes, delete it!"), ' ', React.createElement("button", {
      "className": "minor-button",
      "onClick": this.props.onComplete
    }, "No, don\'t delete it.")) : void 0));
  }
});

module.exports = React.createClass({
  displayName: "CollectionSettings",
  mixins: [History, SetToggle, CollectionRole],
  setterProperty: 'collection',
  getDefaultProps: function() {
    return {
      collection: null
    };
  },
  getInitialState: function() {
    return {
      error: null,
      setting: {
        "private": false
      }
    };
  },
  componentDidMount: function() {
    return this.props.collection.listen('delete', this.redirect);
  },
  componentDidUnMount: function() {
    return this.props.collection.stopListening('delete');
  },
  redirect: function() {
    return this.history.pushState(null, "/collections");
  },
  confirmDelete: function() {
    return alert((function(_this) {
      return function(resolve) {
        return React.createElement("div", {
          "className": "confirm-delete-dialog content-container"
        }, React.createElement(CollectionDeleteDialog, React.__spread({}, _this.props, {
          "onComplete": resolve
        })));
      };
    })(this));
  },
  publicCollection: function() {
    if (this.props.collection["private"] != null) {
      return !this.props.collection["private"];
    } else {
      return this.props.collection["private"];
    }
  },
  render: function() {
    return React.createElement(PromiseRenderer, {
      "promise": this.hasSettingsRole()
    }, ((function(_this) {
      return function(hasSettingsRole) {
        if (hasSettingsRole) {
          return React.createElement("div", {
            "className": "collection-settings-tab"
          }, React.createElement(ChangeListener, {
            "target": _this.props.collection
          }, (function() {
            return React.createElement(DisplayNameSlugEditor, {
              "resource": _this.props.collection,
              "resourceType": "collection"
            });
          })), React.createElement("hr", null), React.createElement("span", {
            "className": "form-label"
          }, "Visibility"), React.createElement("p", null, React.createElement("label", {
            "style": {
              whiteSpace: 'nowrap'
            }
          }, React.createElement("input", {
            "type": "radio",
            "name": "private",
            "value": true,
            "data-json-value": true,
            "checked": _this.props.collection["private"],
            "onChange": _this.set.bind(_this, 'private', true)
          }), "Private"), "            ", React.createElement("label", {
            "style": {
              whiteSpace: 'nowrap'
            }
          }, React.createElement("input", {
            "type": "radio",
            "name": "private",
            "value": false,
            "data-json-value": true,
            "checked": _this.publicCollection(),
            "onChange": _this.set.bind(_this, 'private', false)
          }), "Public")), React.createElement("p", {
            "className": "form-help"
          }, "Only the assigned ", React.createElement("strong", null, "collaborators"), " can view a private project. Anyone with the URL can access a public project."), React.createElement("hr", null), React.createElement("div", {
            "className": "form-label"
          }, "Delete this Collection"), React.createElement("div", {
            "className": "delete-container"
          }, React.createElement("button", {
            "className": "error major-button",
            "type": "button",
            "onClick": _this.confirmDelete
          }, "Delete")));
        } else {
          return React.createElement("div", {
            "className": "collection-settings-tab"
          }, React.createElement("p", null, "Not allowed to edit this collection"));
        }
      };
    })(this)));
  }
});


},{"../components/change-listener":63,"../components/promise-renderer":86,"../lib/alert":98,"../lib/collection-role":99,"../lib/set-toggle":115,"../partials/display-name-slug-editor":214,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],60:[function(require,module,exports){
var History, Link, Loading, Paginator, PromiseRenderer, React, SubjectViewer, Translate, VALID_COLLECTION_MEMBER_SUBJECTS_PARAMS, apiClient, counterpart, intersection, pick, ref;

React = require('react');

intersection = require('lodash.intersection');

pick = require('lodash.pick');

Translate = require('react-translate-component');

counterpart = require('counterpart');

apiClient = require('panoptes-client/lib/api-client');

Paginator = require('../talk/lib/paginator');

PromiseRenderer = require('../components/promise-renderer');

SubjectViewer = require('../components/subject-viewer');

Loading = require('../components/loading-indicator');

ref = require('react-router'), Link = ref.Link, History = ref.History;

VALID_COLLECTION_MEMBER_SUBJECTS_PARAMS = ['page', 'page_size'];

counterpart.registerTranslations('en', {
  collectionSubjectListPage: {
    error: 'There was an error listing this collection.',
    noSubjects: 'No subjects in this collection.'
  }
});

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CollectionShowList',
    mixins: [History],
    componentDidMount: function() {
      return this.fetchCollectionSubjects(pick(this.props.location.query, VALID_COLLECTION_MEMBER_SUBJECTS_PARAMS));
    },
    componentWillReceiveProps: function(nextProps) {
      return this.fetchCollectionSubjects(pick(nextProps.location.query, VALID_COLLECTION_MEMBER_SUBJECTS_PARAMS));
    },
    fetchCollectionSubjects: function(query) {
      var defaultQuery;
      if (query == null) {
        query = null;
      }
      if (query == null) {
        query = this.props.location.query;
      }
      defaultQuery = {
        page: 1,
        page_size: 12
      };
      query = Object.assign({}, defaultQuery, query);
      return this.props.collection.get('subjects', query);
    },
    onPageChange: function(page) {
      var currentPath, nextQuery;
      nextQuery = Object.assign({}, this.props.location.query, {
        page: page
      });
      currentPath = this.props.location.pathname;
      return this.history.pushState(null, this.history.createHref(currentPath, nextQuery));
    },
    handleDeleteSubject: function(subject) {
      return this.props.collection.removeLink('subjects', [subject.id.toString()]).then((function(_this) {
        return function() {
          _this.props.collection.uncacheLink('subjects');
          return _this.forceUpdate();
        };
      })(this));
    },
    isOwnerOrCollaborator: function() {
      var collaboratorOrOwnerRoles, hasPermission;
      collaboratorOrOwnerRoles = this.props.roles.filter(function(collectionRoles) {
        return intersection(['owner', 'collaborator'], collectionRoles.roles).length;
      });
      hasPermission = false;
      collaboratorOrOwnerRoles.forEach((function(_this) {
        return function(roleSet) {
          var ref1;
          if (roleSet.links.owner.id === ((ref1 = _this.props.user) != null ? ref1.id : void 0)) {
            return hasPermission = true;
          }
        };
      })(this));
      return hasPermission;
    },
    fetchProjectOwner: function(subject) {
      var projectRequest;
      projectRequest = this.props.collection.links.project != null ? this.props.collection.get('project') : subject.get('project');
      return projectRequest.then(function(project) {
        var name, owner, ref1;
        ref1 = project.slug.split('/'), owner = ref1[0], name = ref1[1];
        return {
          owner: owner,
          name: name,
          id: subject.id
        };
      });
    },
    render: function() {
      var catchFunc, pendingFunc, subjectNode, thenFunc;
      subjectNode = (function(_this) {
        return function(subject) {
          return React.createElement("div", {
            "className": "collection-subject-viewer",
            "key": subject.id
          }, React.createElement(SubjectViewer, {
            "defaultStyle": false,
            "subject": subject,
            "user": _this.props.user
          }, (_this.isOwnerOrCollaborator() ? React.createElement("button", {
            "type": "button",
            "className": "collection-subject-viewer-delete-button",
            "onClick": _this.handleDeleteSubject.bind(_this, subject)
          }, React.createElement("i", {
            "className": "fa fa-close"
          })) : void 0), React.createElement(PromiseRenderer, {
            "promise": _this.fetchProjectOwner(subject)
          }, (function(params) {
            return React.createElement(Link, {
              "className": "subject-link",
              "to": "/projects/" + params.owner + "/" + params.name + "/talk/subjects/" + subject.id
            }, React.createElement("span", null));
          }))));
        };
      })(this);
      pendingFunc = function() {
        return React.createElement(Loading, null);
      };
      catchFunc = function(e) {
        return React.createElement(Translate, {
          "component": "p",
          "className": "form-help error",
          "content": "collectionSubjectListPage.error"
        });
      };
      thenFunc = (function(_this) {
        return function(subjects) {
          var meta;
          return React.createElement("div", {
            "className": "collections-show"
          }, (subjects.length === 0 ? React.createElement(Translate, {
            "component": "p",
            "content": "collectionSubjectListPage.noSubjects"
          }) : void 0), (subjects.length > 0 ? (meta = subjects[0].getMeta(), React.createElement("div", null, React.createElement("div", {
            "className": "collection-subjects-list"
          }, subjects.map(subjectNode)), React.createElement(Paginator, {
            "page": meta.page,
            "onPageChange": _this.onPageChange,
            "pageCount": meta.page_count
          }))) : void 0));
        };
      })(this);
      return React.createElement(PromiseRenderer, {
        "promise": this.fetchCollectionSubjects(),
        "pending": pendingFunc,
        "catch": catchFunc,
        "then": thenFunc
      });
    }
  });
}


},{"../components/loading-indicator":77,"../components/promise-renderer":86,"../components/subject-viewer":90,"../talk/lib/paginator":273,"counterpart":"counterpart","lodash.intersection":"lodash.intersection","lodash.pick":"lodash.pick","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],61:[function(require,module,exports){
var Avatar, CollectionPage, HandlePropChanges, IndexLink, Link, Loading, Paginator, PromiseRenderer, React, SubjectViewer, TitleMixin, Translate, apiClient, counterpart, ref, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

apiClient = require('panoptes-client/lib/api-client');

Paginator = require('../talk/lib/paginator');

SubjectViewer = require('../components/subject-viewer');

PromiseRenderer = require('../components/promise-renderer');

ref = require('react-router'), IndexLink = ref.IndexLink, Link = ref.Link;

Translate = require('react-translate-component');

counterpart = require('counterpart');

Avatar = require('../partials/avatar');

Loading = require('../components/loading-indicator');

HandlePropChanges = require('../lib/handle-prop-changes');

TitleMixin = require('../lib/title-mixin');

counterpart.registerTranslations('en', {
  collectionPage: {
    settings: 'Settings',
    collaborators: 'Collaborators'
  },
  collectionsPageWrapper: {
    error: 'There was an error retrieving this collection.'
  }
});

CollectionPage = React.createClass({
  displayName: 'CollectionPage',
  getDefaultProps: function() {
    return {
      collection: null
    };
  },
  componentDidMount: function() {
    return document.documentElement.classList.add('on-collection-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-collection-page');
  },
  render: function() {
    return React.createElement(PromiseRenderer, {
      "promise": this.props.collection.get('owner')
    }, ((function(_this) {
      return function(owner) {
        var isOwner, name, ownerName, params, ref1, ref2;
        ref1 = _this.props.collection.slug.split('/'), ownerName = ref1[0], name = ref1[1];
        params = {
          owner: ownerName,
          name: name
        };
        isOwner = ((ref2 = _this.props.user) != null ? ref2.id : void 0) === owner.id;
        return React.createElement("div", {
          "className": "collections-page"
        }, React.createElement("nav", {
          "className": "collection-nav tabbed-content-tabs"
        }, React.createElement(IndexLink, {
          "to": "/collections/" + ownerName + "/" + name,
          "activeClassName": "active",
          "className": "tabbed-content-tab"
        }, React.createElement(Avatar, {
          "user": owner
        }), _this.props.collection.display_name), (isOwner ? React.createElement(Link, {
          "to": "/collections/" + ownerName + "/" + name + "/settings",
          "activeClassName": "active",
          "className": "tabbed-content-tab"
        }, React.createElement(Translate, {
          "content": "collectionPage.settings"
        })) : void 0), (isOwner ? React.createElement(Link, {
          "to": "/collections/" + ownerName + "/" + name + "/collaborators",
          "activeClassName": "active",
          "className": "tabbed-content-tab"
        }, React.createElement(Translate, {
          "content": "collectionPage.collaborators"
        })) : void 0)), React.createElement("div", {
          "className": "collection-container talk"
        }, React.cloneElement(_this.props.children, {
          user: _this.props.user,
          collection: _this.props.collection,
          roles: _this.props.roles
        })));
      };
    })(this)));
  }
});

module.exports = React.createClass({
  displayName: 'CollectionPageWrapper',
  mixins: [TitleMixin, HandlePropChanges],
  title: function() {
    var ref1, ref2;
    return (ref1 = (ref2 = this.state.collection) != null ? ref2.display_name : void 0) != null ? ref1 : '(Loading)';
  },
  getDefaultProps: function() {
    return {
      params: null
    };
  },
  getInitialState: function() {
    return {
      collection: null,
      roles: null,
      error: false,
      loading: false
    };
  },
  propChangeHandlers: {
    'params.owner': 'fetchCollection',
    'params.name': 'fetchCollection',
    'user': 'fetchCollection'
  },
  fetchCollection: function() {
    this.setState({
      error: false,
      loading: true
    });
    return apiClient.type('collections').get({
      slug: this.props.params.owner + '/' + this.props.params.name,
      include: 'owner'
    }).then((function(_this) {
      return function(arg) {
        var collection;
        collection = arg[0];
        if (!collection) {
          _this.setState({
            error: true
          });
        }
        return apiClient.type('collection_roles').get({
          collection_id: collection.id
        }).then(function(roles) {
          return _this.setState({
            collection: collection,
            roles: roles
          });
        });
      };
    })(this))["catch"]((function(_this) {
      return function() {
        return _this.setState({
          error: true,
          collection: null
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          loading: false
        });
      };
    })(this));
  },
  render: function() {
    return React.createElement("div", {
      "className": "content-container"
    }, (this.state.collection ? React.createElement(CollectionPage, React.__spread({}, this.props, {
      "collection": this.state.collection,
      "roles": this.state.roles
    })) : void 0), (this.state.error ? React.createElement(Translate, {
      "compontent": "p",
      "content": "collectionsPageWrapper.error"
    }) : void 0), (this.state.loading ? React.createElement(Loading, null) : void 0));
  }
});


},{"../components/loading-indicator":77,"../components/promise-renderer":86,"../components/subject-viewer":90,"../lib/handle-prop-changes":104,"../lib/title-mixin":117,"../partials/avatar":212,"../talk/lib/paginator":273,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],62:[function(require,module,exports){
var React, requestCounter;

React = require('react');

requestCounter = 0;

module.exports = React.createClass({
  displayName: 'AutoSave',
  getDefaultProps: function() {
    return {
      tag: 'span',
      className: 'auto-save',
      resource: null,
      keyboardDelay: 10 * 1000,
      immediateDelay: 0,
      resetDelay: 2 * 1000
    };
  },
  getInitialState: function() {
    return {
      timeout: NaN,
      request: NaN,
      saving: null,
      success: null,
      error: null
    };
  },
  render: function() {
    var ref;
    return React.createElement(this.props.tag, {
      className: this.props.className,
      'data-waiting': !isNaN(this.state.timeout) || null,
      'data-busy': (this.state.saving != null) || null,
      'data-success': (this.state.success != null) || null,
      'data-error': (this.state.error != null) || null,
      title: (ref = this.state.error) != null ? ref.toString() : void 0,
      onChange: this.handleChange,
      onClick: this.handleClick,
      onBlur: this.handleBlur
    }, this.props.children);
  },
  isTextInput: function(el) {
    var ref, ref1;
    return ((ref = el.tagName) === 'INPUT' || ref === 'TEXTAREA') && ((ref1 = el.type) !== 'radio' && ref1 !== 'checkbox');
  },
  handleChange: function(e) {
    var delay;
    e.persist();
    delay = this.isTextInput(e.target) ? this.props.keyboardDelay : this.props.immediateDelay;
    return this.saveResourceAfter(delay);
  },
  handleClick: function(e) {
    if (e.target.tagName === 'BUTTON') {
      e.persist();
      return this.saveResourceAfter(this.props.immediateDelay);
    }
  },
  handleBlur: function(e) {
    var delay;
    if (this.isTextInput(e.target)) {
      e.persist();
      delay = this.state.saving != null ? this.props.keyboardDelay : this.props.immediateDelay;
      return this.saveResourceAfter(delay);
    }
  },
  saveResourceAfter: function(delay) {
    var saveCall, timeout;
    if (!isNaN(this.state.timeout)) {
      clearTimeout(this.state.timeout);
    }
    saveCall = (function(_this) {
      return function() {
        var thisRequest;
        _this.setState({
          timeout: NaN
        });
        if (_this.props.resource.hasUnsavedChanges()) {
          requestCounter += 1;
          thisRequest = requestCounter;
          return _this.setState({
            request: thisRequest,
            saving: _this.props.resource.save().then(function(success) {
              var resetSuccess;
              _this.setState({
                success: success
              });
              resetSuccess = function() {
                if (_this.state.request === thisRequest) {
                  return _this.setState({
                    success: null
                  });
                }
              };
              return setTimeout(resetSuccess, _this.props.resetDelay);
            })["catch"](function(error) {
              return _this.setState({
                error: error
              });
            }).then(function() {
              return _this.setState({
                saving: null
              });
            })
          });
        }
      };
    })(this);
    timeout = setTimeout(saveCall, delay);
    return this.setState({
      timeout: timeout,
      success: null,
      error: null
    });
  }
});


},{"react":"react"}],63:[function(require,module,exports){
var React,
  slice = [].slice;

React = require('react');

module.exports = React.createClass({
  displayName: 'ChangeListener',
  getDefaultProps: function() {
    return {
      target: null,
      eventName: 'change',
      on: 'listen',
      off: 'stopListening',
      handler: null
    };
  },
  getInitialState: function() {
    return {
      payload: []
    };
  },
  componentDidMount: function() {
    return this.startListeningTo(this.props.target);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.target !== this.props.target) {
      this.stopListeningTo(this.props.target);
      return this.startListeningTo(nextProps.target);
    }
  },
  componentWillUnmount: function() {
    return this.stopListeningTo(this.props.target);
  },
  startListeningTo: function(target) {
    return target[this.props.on](this.props.eventName, this.handleTargetChange);
  },
  stopListeningTo: function(target) {
    return target[this.props.off](this.props.eventName, this.handleTargetChange);
  },
  handleTargetChange: function() {
    var payload;
    payload = 1 <= arguments.length ? slice.call(arguments, 0) : [];
    if (this.isMounted()) {
      return this.setState({
        payload: payload
      });
    }
  },
  render: function() {
    var ref, ref1;
    if (typeof this.props.children === 'function') {
      return (ref = this.props).children.apply(ref, this.state.payload);
    } else if (this.props.handler != null) {
      return (ref1 = this.props).handler.apply(ref1, this.state.payload);
    } else {
      throw new Error('ChangeListener needs a child function or handler');
    }
  }
});


},{"react":"react"}],64:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({displayName: "exports",
  getDefaultProps: function() {
    return {
      limit: 0,
      string: ''
    };
  },
  render: function() {
    var remaining;
    remaining = this.props.limit - this.props.string.length;
    return React.createElement("span", null, remaining, " of ", this.props.limit, " characters remaining.");
  }
});


},{"react":"react"}],65:[function(require,module,exports){
var ClassificationsRibbon, React,
  slice = [].slice;

React = require('react');

ClassificationsRibbon = React.createClass({
  displayName: 'ClassificationsRibbon',
  getDefaultProps: function() {
    var i;
    return {
      projects: (function() {
        var j, results;
        results = [];
        for (i = j = 0; j < 20; i = ++j) {
          results.push({
            project: "Project " + i,
            classifications: Math.floor(Math.random() * 100)
          });
        }
        return results;
      })(),
      cutoff: 1 / 50,
      width: '100%',
      height: '1em'
    };
  },
  getProjectColor: function(name) {
    var characters, hue, saturation;
    characters = name.split('');
    hue = [0].concat(slice.call(characters)).reduce(function(code, character) {
      return code + Math.pow(character.charCodeAt(0), 2);
    });
    saturation = 50 + (hue % 50);
    hue %= 360;
    return "hsl(" + hue + ", " + saturation + "%, 50%)";
  },
  render: function() {
    var band, classifications, i, j, lastX, len, others, othersWidth, project, ref, totalClassifications, width;
    if (this.props.projects.length === 0) {
      return React.createElement("span", {
        "className": "classifications-ribbon-empty",
        "style": {
          display: 'block',
          width: this.props.width,
          height: this.props.height
        }
      }, React.createElement("span", {
        "className": "empty"
      }, "No classifications yet"));
    } else {
      totalClassifications = 0;
      ref = this.props.projects;
      for (j = 0, len = ref.length; j < len; j++) {
        classifications = ref[j].classifications;
        totalClassifications += classifications != null ? classifications : 1;
      }
      others = [];
      lastX = 0;
      return React.createElement("svg", {
        "className": "classifications-ribbon",
        "width": this.props.width,
        "height": this.props.height,
        "viewBox": "0 0 1 1",
        "preserveAspectRatio": "none",
        "style": {
          display: 'block'
        }
      }, (function() {
        var k, len1, ref1, ref2, results;
        ref1 = this.props.projects;
        results = [];
        for (i = k = 0, len1 = ref1.length; k < len1; i = ++k) {
          ref2 = ref1[i], project = ref2.project, classifications = ref2.classifications;
          width = (classifications != null ? classifications : 1) / totalClassifications;
          if (width < this.props.cutoff) {
            others.push({
              project: project,
              classifications: classifications
            });
            continue;
          } else {
            band = React.createElement("rect", {
              "key": project,
              "fill": this.getProjectColor(project),
              "stroke": "none",
              "x": lastX,
              "y": "0",
              "width": width,
              "height": "1"
            }, React.createElement("title", null, project, ": ", classifications != null ? classifications : '?'));
            lastX += width;
            results.push(band);
          }
        }
        return results;
      }).call(this), (others.length !== 0 ? (othersWidth = 1 - lastX, React.createElement("rect", {
        "fill": "gray",
        "fillOpacity": "0.5",
        "stroke": "none",
        "x": lastX,
        "y": "0",
        "width": othersWidth,
        "height": "1"
      }, React.createElement("title", null, ((function() {
        var k, len1, ref1, results;
        results = [];
        for (k = 0, len1 = others.length; k < len1; k++) {
          ref1 = others[k], project = ref1.project, classifications = ref1.classifications;
          results.push(project + ": " + (classifications != null ? classifications : '?'));
        }
        return results;
      })()).join('\n')))) : void 0));
    }
  }
});

module.exports = React.createClass({
  displayName: 'ClassificationsRibbonWrapper',
  getDefaultProps: function() {
    return {
      user: null
    };
  },
  getInitialState: function() {
    return {
      loading: false,
      projects: []
    };
  },
  componentDidMount: function() {
    if (this.props.user === null && location.hash.indexOf('/dev/' !== -1)) {
      return zooAPI.type('users').get('3').then((function(_this) {
        return function(user) {
          return _this.getClassificationCounts(user);
        };
      })(this));
    } else {
      return this.getClassificationCounts(this.props.user);
    }
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.user !== this.props.user) {
      return this.getClassificationCounts(this.props.user);
    }
  },
  getClassificationCounts: function(user) {
    this.setState({
      loading: true
    });
    return this.getAllProjectPreferences(user).then((function(_this) {
      return function(preferences) {
        var preference, projects;
        projects = (function() {
          var j, len, results;
          results = [];
          for (j = 0, len = preferences.length; j < len; j++) {
            preference = preferences[j];
            results.push(preference.get('project')["catch"]((function(_this) {
              return function() {
                return null;
              };
            })(this)));
          }
          return results;
        }).call(_this);
        return Promise.all(projects).then(function(projects) {
          var counts, i;
          counts = (function() {
            var j, ref, results;
            results = [];
            for (i = j = 0, ref = preferences.length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
              if (projects[i] != null) {
                results.push({
                  project: projects[i].display_name,
                  classifications: preferences[i].activity_count
                });
              }
            }
            return results;
          })();
          return _this.setState({
            loading: false,
            projects: counts
          });
        });
      };
    })(this));
  },
  getAllProjectPreferences: function(user, _page, _collection) {
    if (_page == null) {
      _page = 1;
    }
    if (_collection == null) {
      _collection = [];
    }
    return user.get('project_preferences', {
      page: _page
    }).then((function(_this) {
      return function(projectPreferences) {
        var meta;
        if (projectPreferences.length === 0) {
          return projectPreferences;
        } else {
          _collection.push.apply(_collection, projectPreferences);
          meta = projectPreferences[0].getMeta();
          if (meta.page === meta.page_count) {
            return _collection;
          } else {
            return _this.getAllProjectPreferences(user, meta.page + 1, _collection);
          }
        }
      };
    })(this));
  },
  render: function() {
    if (this.state.loading) {
      return React.createElement("span", null, "Loading ribbon...");
    } else {
      return React.createElement(ClassificationsRibbon, React.__spread({}, this.props, {
        "projects": this.state.projects
      }));
    }
  }
});


},{"react":"react"}],66:[function(require,module,exports){
var React, Select, apiClient, debounce;

React = require('react');

Select = require('react-select');

apiClient = require('panoptes-client/lib/api-client');

debounce = require('debounce');

module.exports = React.createClass({
  displayName: 'CollectionSearch',
  getDefaultProps: function() {
    return {
      multi: false,
      project: null
    };
  },
  searchCollections: function(value, callback) {
    var query;
    query = {
      page_size: 20,
      favorite: false,
      current_user_roles: 'owner,collaborator'
    };
    if (value !== '') {
      query.search = "" + value;
    }
    return apiClient.type('collections').get(query).then(function(collections) {
      var opts;
      opts = collections.map(function(collection) {
        return {
          value: collection.id,
          label: collection.display_name,
          collection: collection
        };
      });
      return callback(null, {
        options: opts
      });
    });
  },
  getSelected: function() {
    return this.refs.collectionSelect.state.values;
  },
  render: function() {
    return React.createElement(Select, {
      "ref": "collectionSelect",
      "multi": this.props.multi,
      "name": "collids",
      "placeholder": "Collection Name",
      "searchPromptText": "Type to search Collections",
      "className": "collection-search",
      "closeAfterClick": true,
      "asyncOptions": debounce(this.searchCollections, 200)
    });
  }
});


},{"debounce":"debounce","panoptes-client/lib/api-client":549,"react":"react","react-select":"react-select"}],67:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({displayName: "exports",
  XLINK_NS: 'http://www.w3.org/1999/xlink',
  getDefaultProps: function() {
    return {
      src: '',
      aspectRatio: NaN
    };
  },
  getInitialState: function() {
    return {
      naturalWidth: 0,
      naturalHeight: 0
    };
  },
  componentDidMount: function() {
    return this.loadImage(this.props.src);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.src !== this.props.src) {
      return this.loadImage(nextProps.src);
    }
  },
  loadImage: function(src) {
    var img;
    img = new Image;
    img.onload = (function(_this) {
      return function() {
        var naturalHeight, naturalWidth;
        naturalWidth = img.naturalWidth, naturalHeight = img.naturalHeight;
        return _this.setState({
          naturalWidth: naturalWidth,
          naturalHeight: naturalHeight
        });
      };
    })(this);
    return img.src = src;
  },
  render: function() {
    var height, min, width, x, y;
    min = Math.min(this.state.naturalWidth, this.state.naturalHeight);
    width = min;
    height = min;
    if (this.props.aspectRatio < 1) {
      width = this.props.aspectRatio * height;
    } else if (this.props.aspectRatio > 1) {
      height = this.props.aspectRatio * width;
    }
    x = (this.state.naturalWidth - width) / 2;
    y = (this.state.naturalHeight - height) / 2;
    return React.createElement("svg", React.__spread({
      "viewBox": x + " " + y + " " + width + " " + height
    }, this.props), React.createElement("image", {
      "ref": "image",
      "x": "0",
      "y": "0"
    }));
  },
  componentDidUpdate: function() {
    var image;
    image = React.findDOMNode(this.refs.image);
    image.setAttribute('width', this.state.naturalWidth);
    image.setAttribute('height', this.state.naturalHeight);
    return image.setAttributeNS(this.XLINK_NS, 'href', this.props.src);
  }
});


},{"react":"react"}],68:[function(require,module,exports){
var ENTER_KEY, React, SELECTOR_TO_IGNORE, SPACE_KEY, tag, tagsToIgnore;

React = require('react');

tagsToIgnore = ['a', 'button', 'input', 'label'];

SELECTOR_TO_IGNORE = ((function() {
  var i, len, results;
  results = [];
  for (i = 0, len = tagsToIgnore.length; i < len; i++) {
    tag = tagsToIgnore[i];
    results.push([tag, tag + " *"].join(','));
  }
  return results;
})()).join(',');

ENTER_KEY = 13;

SPACE_KEY = 32;

module.exports = React.createClass({
  displayName: 'Details',
  getDefaultProps: function() {
    return {
      summary: '',
      defaultOpen: false
    };
  },
  getInitialState: function() {
    return {
      open: this.props.defaultOpen
    };
  },
  render: function() {
    return React.createElement("div", React.__spread({}, this.props, {
      "className": "details-container " + this.props.classname,
      "data-is-open": this.state.open || null
    }), React.createElement("div", {
      "ref": "summary",
      "className": "details-summary",
      "tabIndex": "0",
      "onClick": this.handleSummaryClick,
      "onKeyPress": this.handleSummaryKeyPress
    }, this.props.summary), (this.state.open ? this.props.children : void 0));
  },
  handleSummaryClick: function(e) {
    if (!e.target.matches(SELECTOR_TO_IGNORE)) {
      return this.toggle();
    }
  },
  handleSummaryKeyPress: function(e) {
    var ref;
    if (document.activeElement === this.refs.summary) {
      if ((ref = e.which) === ENTER_KEY || ref === SPACE_KEY) {
        e.preventDefault();
        return this.toggle();
      }
    }
  },
  toggle: function() {
    return this.setState({
      open: !this.state.open
    });
  }
});


},{"react":"react"}],69:[function(require,module,exports){
var ESC_KEY, FOCUSABLES, React, ReactDOM, TAB_KEY;

React = require('react');

ReactDOM = require('react-dom');

FOCUSABLES = "a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]";

ESC_KEY = 27;

TAB_KEY = 9;

module.exports = React.createClass({
  displayName: 'Dialog',
  render: function() {
    return React.createElement("div", {
      "className": "dialog-underlay",
      "onKeyDown": this.handleKeyDown
    }, React.createElement("div", {
      "aria-role": 'dialog',
      "className": "dialog"
    }, React.createElement("div", {
      "className": "dialog-controls"
    }, React.createElement("div", {
      "className": "wrapper"
    }, this.props.controls)), React.createElement("div", {
      "className": "dialog-content"
    }, React.createElement("div", {
      "className": "wrapper"
    }, this.props.children))));
  },
  handleKeyDown: function(e) {
    var base, focusables, ref, ref1, shiftKey;
    switch (e.keyCode) {
      case ESC_KEY:
        return typeof (base = this.props).onEscape === "function" ? base.onEscape(e) : void 0;
      case TAB_KEY:
        shiftKey = e.shiftKey;
        focusables = ReactDOM.findDOMNode(this).querySelectorAll(FOCUSABLES);
        if (shiftKey && document.activeElement === focusables[0]) {
          if ((ref = focusables[focusables.length - 1]) != null) {
            ref.focus();
          }
          return e.preventDefault();
        } else if (!shiftKey && document.activeElement === focusables[focusables.length - 1]) {
          if ((ref1 = focusables[0]) != null) {
            ref1.focus();
          }
          return e.preventDefault();
        }
    }
  }
});


},{"react":"react","react-dom":"react-dom"}],70:[function(require,module,exports){
module.exports = {
  DISCIPLINES: [
    {
      value: 'arts',
      label: 'Arts'
    }, {
      value: 'biology',
      label: 'Biology'
    }, {
      value: 'climate',
      label: 'Climate'
    }, {
      value: 'history',
      label: 'History'
    }, {
      value: 'language',
      label: 'Language'
    }, {
      value: 'literature',
      label: 'Literature'
    }, {
      value: 'medicine',
      label: 'Medicine'
    }, {
      value: 'nature',
      label: 'Nature'
    }, {
      value: 'physics',
      label: 'Physics'
    }, {
      value: 'social science',
      label: 'Social Science'
    }, {
      value: 'astronomy',
      label: 'Space'
    }
  ]
};


},{}],71:[function(require,module,exports){
var CroppedImage, Markdown, React,
  slice = [].slice;

React = require('react');

Markdown = require('markdownz').Markdown;

CroppedImage = require('./cropped-image');

module.exports = React.createClass({displayName: "exports",
  getDefaultProps: function() {
    return {
      title: null,
      content: null,
      items: [],
      icons: {},
      defaultSelection: [],
      breadcrumbs: false,
      onClickClose: function() {}
    };
  },
  getInitialState: function() {
    return {
      selection: this.props.defaultSelection
    };
  },
  cutSelection: function(index) {
    return this.setState({
      selection: this.state.selection.slice(0, index)
    });
  },
  pushSelection: function(index) {
    return this.setState({
      selection: [].concat(this.state.selection, index)
    });
  },
  renderItem: function(arg) {
    var content, icon, items, title;
    icon = arg.icon, title = arg.title, content = arg.content, items = arg.items;
    return React.createElement("div", {
      "className": "field-guide-item"
    }, React.createElement("header", null, (this.props.icons[icon] != null ? React.createElement("div", {
      "className": "field-guide-item-icon-container"
    }, React.createElement(CroppedImage, {
      "className": "field-guide-item-icon",
      "src": this.props.icons[icon].src,
      "aspectRatio": 1.,
      "width": "6em",
      "height": "6em"
    })) : void 0), (title != null ? React.createElement("div", {
      "className": "field-guide-item-title-container"
    }, React.createElement(Markdown, {
      "content": title,
      "inline": true
    })) : void 0)), (content != null ? React.createElement("div", {
      "className": "field-guide-item-content-container"
    }, React.createElement(Markdown, {
      "content": content
    })) : void 0), ((items != null ? items.length : void 0) > 0 ? React.createElement("ul", {
      "className": "field-guide-menu"
    }, items.map((function(_this) {
      return function(item, i) {
        var goTo, ref;
        goTo = _this.pushSelection.bind(_this, i);
        return React.createElement("li", {
          "key": i
        }, React.createElement("button", {
          "type": "button",
          "className": "field-guide-menu-item",
          "onClick": goTo
        }, React.createElement(CroppedImage, {
          "className": "field-guide-menu-item-icon",
          "src": ((ref = _this.props.icons[item.icon]) != null ? ref.src : void 0),
          "aspectRatio": 1.,
          "width": "4em",
          "height": "4em"
        }), React.createElement("span", {
          "className": "field-guide-menu-item-title"
        }, item.title)));
      };
    })(this))) : void 0));
  },
  render: function() {
    var atRoot, content, icon, implicitRootItem, items, levelUp, ref, ref1, ref2, selectedItem, selectionTrail, title;
    ref = this.props, icon = ref.icon, title = ref.title, content = ref.content, items = ref.items;
    implicitRootItem = {
      icon: icon,
      title: title,
      content: content,
      items: items
    };
    if (((ref1 = implicitRootItem.items) != null ? ref1.length : void 0) === 1) {
      implicitRootItem = implicitRootItem.items[0];
    }
    selectionTrail = [[]].concat(slice.call(this.state.selection)).reduce((function(_this) {
      return function(trail, index) {
        var ref2;
        items = ((ref2 = trail[trail.length - 1]) != null ? ref2 : implicitRootItem).items;
        return [].concat(trail, items[index]);
      };
    })(this));
    selectedItem = (ref2 = selectionTrail[selectionTrail.length - 1]) != null ? ref2 : implicitRootItem;
    levelUp = this.cutSelection.bind(this, selectionTrail.length - 1);
    atRoot = this.state.selection.length === 0;
    return React.createElement("div", {
      "className": "field-guide"
    }, React.createElement("header", null, React.createElement("button", {
      "type": "button",
      "className": "field-guide-header-button",
      "disabled": atRoot,
      "onClick": levelUp
    }, React.createElement("i", {
      "className": "fa fa-chevron-left fa-fw"
    })), React.createElement("strong", null, "Field Guide"), React.createElement("button", {
      "type": "button",
      "className": "field-guide-header-button",
      "onClick": this.props.onClickClose
    }, React.createElement("i", {
      "className": "fa fa-times fa-fw"
    }))), this.renderItem(selectedItem));
  }
});


},{"./cropped-image":67,"markdownz":"markdownz","react":"react"}],72:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'FileButton',
  getDefaultProps: function() {
    return {
      tag: 'label',
      className: '',
      accept: '*/*',
      multiple: false,
      disabled: false,
      onSelect: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      resetting: false
    };
  },
  rootStyle: {
    position: 'relative'
  },
  containerStyle: {
    height: '100%',
    left: 0,
    opacity: 0.01,
    overflow: 'hidden',
    position: 'absolute',
    top: 0,
    width: '100%'
  },
  inputStyle: {
    cursor: 'pointer',
    height: '300%',
    left: '-100%',
    opacity: 0.01,
    position: 'absolute',
    top: '-100%',
    width: '300%'
  },
  render: function() {
    var accept, disabled, input, multiple, passedProps, ref;
    input = this.state.resetting ? null : ((ref = this.props, accept = ref.accept, multiple = ref.multiple, disabled = ref.disabled, ref), passedProps = {
      accept: accept,
      multiple: multiple,
      disabled: disabled
    }, React.createElement("input", React.__spread({
      "type": "file"
    }, passedProps, {
      "style": this.inputStyle,
      "onChange": this.handleChange
    })));
    return React.createElement(this.props.tag, {
      className: ("file-button " + this.props.className).trim(),
      style: Object.assign({}, this.rootStyle, this.props.style),
      'data-accept': this.props.accept,
      'data-disabled': this.props.disabled || null,
      'data-multiple': this.props.multiple || null
    }, React.createElement("span", {
      "style": this.containerStyle
    }, input), this.props.children);
  },
  handleChange: function() {
    var ref;
    (ref = this.props).onSelect.apply(ref, arguments);
    return this.setState({
      resetting: true
    });
  },
  componentDidUpdate: function() {
    if (this.state.resetting) {
      return this.setState({
        resetting: false
      });
    }
  }
});


},{"react":"react"}],73:[function(require,module,exports){
var DISCIPLINES, Link, Navigation, React, State, ref;

React = require('react');

ref = require('react-router'), Link = ref.Link, State = ref.State, Navigation = ref.Navigation;

DISCIPLINES = require('./disciplines').DISCIPLINES;

module.exports = React.createClass({
  displayName: 'Filmstrip',
  propTypes: {
    increment: React.PropTypes.number.isRequired,
    onChange: React.PropTypes.func.isRequired
  },
  getDefaultProps: function() {
    return {
      filterCards: DISCIPLINES
    };
  },
  scrollLeft: function() {
    return this.adjustPos(-this.props.increment);
  },
  scrollRight: function() {
    return this.adjustPos(this.props.increment);
  },
  mangleFilterName: function(filterName) {
    return filterName.replace(/\s+/g, '-');
  },
  selectFilter: function(filterName) {
    return this.props.onChange(filterName);
  },
  calculateClasses: function(filterName) {
    var list, mangledFilterName;
    mangledFilterName = this.mangleFilterName(filterName);
    list = ['filmstrip--disciplines__discipline-card'];
    list.push("filmstrip--disciplines__discipline-card--discipline-" + mangledFilterName);
    if (this.props.value === filterName) {
      list.push('filmstrip--disciplines__discipline-card--active');
    }
    if ((this.props.value == null) && filterName === 'all') {
      list.push('filmstrip--disciplines__discipline-card--active');
    }
    if (this.props.value === '' && filterName === 'all') {
      list.push('filmstrip--disciplines__discipline-card--active');
    }
    return list.join(' ');
  },
  adjustPos: function(increment) {
    var i, newPos, oldPos, scroll;
    oldPos = this.refs.viewport.scrollLeft;
    newPos = oldPos + increment;
    if (increment < 0) {
      newPos = Math.max(newPos, 0);
    }
    if (increment > 0) {
      newPos = Math.min(newPos, this.refs.strip.clientWidth);
    }
    increment = (newPos - oldPos) / 10;
    i = 0;
    scroll = (function(_this) {
      return function() {
        _this.refs.viewport.scrollLeft += increment;
        i++;
        if (i < 10) {
          return setTimeout(scroll, 20);
        }
      };
    })(this);
    return scroll();
  },
  componentDidMount: function() {
    var strip, viewport;
    strip = this.refs.strip;
    viewport = this.refs.viewport;
    this.refs.filmstrip.style.height = strip.clientHeight + 'px';
    return this.refs.viewport.style.paddingBottom = viewport.offsetHeight - viewport.clientHeight + 'px';
  },
  render: function() {
    var filter, filterName, i;
    return React.createElement("div", {
      "className": 'filmstrip filmstrip--disciplines',
      "ref": 'filmstrip'
    }, React.createElement("button", {
      "className": 'filmstrip__nav-btn',
      "onClick": this.scrollLeft,
      "role": "presentation",
      "aria-hidden": "true",
      "aria-label": "Scroll Left"
    }, React.createElement("i", {
      "className": "fa fa-chevron-left"
    })), React.createElement("div", {
      "className": 'filmstrip__viewport',
      "ref": 'viewport'
    }, React.createElement("div", {
      "className": 'filmstrip__strip',
      "ref": 'strip'
    }, React.createElement("ul", null, React.createElement("li", null, React.createElement("button", {
      "className": this.calculateClasses('all'),
      "onClick": this.selectFilter.bind(this, '')
    }, React.createElement("p", null, "All", React.createElement("br", null), "Disciplines"))), (function() {
      var j, len, ref1, results;
      ref1 = this.props.filterCards;
      results = [];
      for (i = j = 0, len = ref1.length; j < len; i = ++j) {
        filter = ref1[i];
        filterName = filter.value.replace(' ', '-');
        results.push(React.createElement("li", {
          "key": i
        }, React.createElement("button", {
          "key": i,
          "className": this.calculateClasses(filter.value),
          "onClick": this.selectFilter.bind(this, filter.value)
        }, React.createElement("span", {
          "key": i,
          "className": "filmstrip--disciplines__discipline-card__icon filmstrip--disciplines__discipline-card__icon-" + filterName
        }), React.createElement("p", null, filter.label))));
      }
      return results;
    }).call(this)))), React.createElement("button", {
      "className": 'filmstrip__nav-btn',
      "onClick": this.scrollRight,
      "role": "presentation",
      "aria-hidden": "true",
      "aria-label": "Scroll Right"
    }, React.createElement("i", {
      "className": "fa fa-chevron-right"
    })));
  }
});


},{"./disciplines":70,"react":"react","react-router":"react-router"}],74:[function(require,module,exports){
var React;

React = require('react');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'FlagSubjectButton',
    toggleFlag: function() {
      var changes, subject_flagged;
      if (this.props.classification.completed) {
        return;
      }
      subject_flagged = this.props.classification.metadata.subject_flagged;
      changes = {};
      if (subject_flagged) {
        changes["metadata.subject_flagged"] = !subject_flagged;
      } else {
        subject_flagged = window.prompt('What is your reason for flagging this subject?');
        if (subject_flagged === null) {
          return;
        }
        changes["metadata.subject_flagged"] = subject_flagged;
      }
      console.log('SUBJECT FLAGGED = ', subject_flagged);
      return this.props.classification.update(changes);
    },
    render: function() {
      var subject_flagged;
      subject_flagged = this.props.classification.metadata.subject_flagged;
      return React.createElement("button", {
        "disabled": this.props.classification.completed,
        "className": "flag-subject-button",
        "type": "button",
        "title": (subject_flagged ? 'Unflag' : 'Flag') + " Subject as Inappropriate",
        "onClick": this.toggleFlag
      }, React.createElement("i", {
        "className": "" + (subject_flagged ? 'fa fa-flag' : 'fa fa-flag-o')
      }));
    }
  });
}


},{"react":"react"}],75:[function(require,module,exports){
var LoadingIndicator, NOOP, React, SUBJECT_STYLE, VideoPlayer, getSubjectLocation,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

LoadingIndicator = require('../components/loading-indicator');

getSubjectLocation = require('../lib/get-subject-location');

VideoPlayer = require('./video-player');

SUBJECT_STYLE = {
  display: 'block'
};

NOOP = Function.prototype;

module.exports = React.createClass({
  displayName: 'FrameViewer',
  getDefaultProps: function() {
    return {
      subject: null,
      frame: 0,
      onLoad: NOOP,
      classification: null,
      workflow: null,
      frameWrapper: null,
      onChange: function() {}
    };
  },
  getInitialState: function() {
    return {
      loading: true,
      frameDimensions: {},
      viewBoxDimensions: {
        x: 0,
        y: 0,
        width: 0,
        height: 0
      },
      panEnabled: false,
      zooming: false,
      zoomingTimeoutId: null
    };
  },
  componentDidMount: function() {
    var ref;
    if ((this.props.project != null) && indexOf.call((ref = this.props.project) != null ? ref.experimental_tools : void 0, 'pan and zoom') >= 0) {
      addEventListener("keydown", this.frameKeyPan);
      return addEventListener("mousewheel", this.frameKeyPan);
    }
  },
  componentWillUnmount: function() {
    var ref;
    if ((this.props.project != null) && indexOf.call((ref = this.props.project) != null ? ref.experimental_tools : void 0, 'pan and zoom') >= 0) {
      removeEventListener("keydown", this.frameKeyPan);
      return removeEventListener("mousewheel", this.frameKeyPan);
    }
  },
  render: function() {
    var FrameWrapper, format, frame, frameDisplay, ref, ref1, ref2, ref3, src, subject, type;
    subject = this.props.subject;
    frame = this.props.frame;
    ref = getSubjectLocation(this.props.subject, this.props.frame), type = ref.type, format = ref.format, src = ref.src;
    FrameWrapper = this.props.frameWrapper;
    frameDisplay = (function() {
      switch (type) {
        case 'image':
          return React.createElement("div", {
            "className": "subject-image-frame"
          }, React.createElement("img", {
            "ref": "subjectImage",
            "className": "subject pan-active",
            "src": src,
            "style": SUBJECT_STYLE,
            "onLoad": this.handleLoad,
            "tabIndex": 0.,
            "onFocus": this.togglePanOn,
            "onBlur": this.togglePanOff
          }), (this.state.loading ? React.createElement("div", {
            "className": "loading-cover",
            "style": this.constructor.overlayStyle
          }, React.createElement(LoadingIndicator, null)) : void 0));
        case 'video':
          return React.createElement(VideoPlayer, {
            "src": src,
            "type": type,
            "format": format,
            "frame": this.props.frame,
            "onLoad": this.handleLoad
          }, (this.state.loading ? React.createElement("div", {
            "className": "loading-cover",
            "style": this.constructor.overlayStyle
          }, React.createElement(LoadingIndicator, null)) : void 0));
      }
    }).call(this);
    if (FrameWrapper) {
      return React.createElement("div", null, React.createElement(FrameWrapper, {
        "frame": frame,
        "naturalWidth": ((ref1 = this.state.frameDimensions) != null ? ref1.width : void 0) || 0,
        "naturalHeight": ((ref2 = this.state.frameDimensions) != null ? ref2.height : void 0) || 0,
        "panByDrag": this.panByDrag,
        "viewBoxDimensions": this.state.viewBoxDimensions || "0 0 0 0",
        "workflow": this.props.workflow,
        "subject": this.props.subject,
        "classification": this.props.classification,
        "annotation": this.props.annotation,
        "loading": this.state.loading,
        "onChange": this.props.onChange,
        "panEnabled": this.state.panEnabled
      }, frameDisplay), ((this.props.project != null) && indexOf.call((ref3 = this.props.project) != null ? ref3.experimental_tools : void 0, 'pan and zoom') >= 0 ? React.createElement("div", {
        "className": "pan-zoom-controls"
      }, React.createElement("div", {
        "className": "draw-pan-toggle"
      }, React.createElement("div", {
        "className": (this.state.panEnabled ? "" : "active")
      }, React.createElement("button", {
        "title": "draw",
        "className": "fa fa-mouse-pointer",
        "title": "annotate",
        "onClick": this.togglePanOff
      })), React.createElement("div", {
        "className": (this.state.panEnabled ? "active" : "")
      }, React.createElement("button", {
        "title": "pan",
        "className": "fa fa-arrows",
        "title": "pan",
        "onClick": this.togglePanOn
      }))), React.createElement("div", null, React.createElement("button", {
        "title": "zoom out",
        "className": "zoom-out fa fa-minus" + (this.cannotZoomOut() ? " disabled" : ""),
        "onMouseDown": this.continuousZoom.bind(this, 1.1),
        "onMouseUp": this.stopZoom,
        "onKeyDown": this.keyDownZoomButton.bind(this, 1.1),
        "onKeyUp": this.stopZoom
      })), React.createElement("div", null, React.createElement("button", {
        "title": "zoom in",
        "className": "zoom-in fa fa-plus",
        "onMouseDown": this.continuousZoom.bind(this, .9),
        "onMouseUp": this.stopZoom,
        "onKeyDown": this.keyDownZoomButton.bind(this, .9),
        "onKeyUp": this.stopZoom
      })), React.createElement("div", null, React.createElement("button", {
        "title": "reset zoom levels",
        "className": "reset fa fa-refresh" + (this.cannotZoomOut() ? " disabled" : ""),
        "onClick": this.zoomReset
      }))) : void 0));
    } else {
      return frameDisplay;
    }
  },
  handleLoad: function(e) {
    var base, height, ref, ref1, width;
    width = (ref = e.target.videoWidth) != null ? ref : e.target.naturalWidth;
    height = (ref1 = e.target.videoHeight) != null ? ref1 : e.target.naturalHeight;
    this.setState({
      loading: false,
      frameDimensions: {
        width: width != null ? width : 0,
        height: height != null ? height : 0
      },
      viewBoxDimensions: {
        width: width != null ? width : 0,
        height: height != null ? height : 0,
        x: 0,
        y: 0
      }
    });
    return typeof (base = this.props).onLoad === "function" ? base.onLoad(e, this.props.frame) : void 0;
  },
  cannotZoomOut: function() {
    return this.state.frameDimensions.width === this.state.viewBoxDimensions.width && this.state.frameDimensions.height === this.state.viewBoxDimensions.height;
  },
  continuousZoom: function(change) {
    this.clearZoomingTimeout();
    if (change === 0) {
      return;
    }
    return this.setState({
      zooming: true
    }, (function(_this) {
      return function() {
        var zoomNow;
        zoomNow = function() {
          if (!_this.state.zooming) {
            return;
          }
          _this.zoom(change);
          _this.clearZoomingTimeout();
          return _this.setState({
            zoomingTimeoutId: setTimeout(zoomNow, 200)
          });
        };
        return zoomNow();
      };
    })(this));
  },
  clearZoomingTimeout: function() {
    if (this.state.zoomingTimeoutId) {
      return clearTimeout(this.state.zoomingTimeoutId);
    }
  },
  zoom: function(change) {
    var newNaturalHeight, newNaturalWidth, newNaturalX, newNaturalY;
    this.clearZoomingTimeout();
    if (!this.state.zooming) {
      return;
    }
    newNaturalWidth = this.state.viewBoxDimensions.width * change;
    newNaturalHeight = this.state.viewBoxDimensions.height * change;
    newNaturalX = this.state.viewBoxDimensions.x - (newNaturalWidth - this.state.viewBoxDimensions.width) / 2;
    newNaturalY = this.state.viewBoxDimensions.y - (newNaturalHeight - this.state.viewBoxDimensions.height) / 2;
    if ((newNaturalWidth > this.state.frameDimensions.width) || (newNaturalHeight * change > this.state.frameDimensions.height)) {
      return this.zoomReset();
    } else {
      return this.setState({
        viewBoxDimensions: {
          width: newNaturalWidth,
          height: newNaturalHeight,
          x: newNaturalX,
          y: newNaturalY
        }
      });
    }
  },
  keyDownZoomButton: function(change, e) {
    if (e.which === 13) {
      return this.setState({
        zooming: true
      }, (function(_this) {
        return function() {
          return _this.zoom(change);
        };
      })(this));
    }
  },
  stopZoom: function(e) {
    e.stopPropagation();
    this.setState({
      zooming: false
    });
    return this.continuousZoom(0);
  },
  zoomReset: function() {
    return this.setState({
      viewBoxDimensions: {
        width: this.state.frameDimensions.width,
        height: this.state.frameDimensions.height,
        x: 0,
        y: 0
      }
    });
  },
  togglePanOn: function() {
    if (!this.state.panEnabled) {
      return this.setState({
        panEnabled: true
      }, (function(_this) {
        return function() {
          return _this.refs.subjectImage.focus();
        };
      })(this));
    }
  },
  togglePanOff: function() {
    return this.setState({
      panEnabled: false
    });
  },
  toggleKeyPanZoom: function() {
    return this.setState({
      keyPanZoomEnabled: !this.state.keyPanZoomEnabled
    }, (function(_this) {
      return function() {
        if (_this.state.panEnabled) {
          return _this.refs.subjectImage.focus();
        }
      };
    })(this));
  },
  panByDrag: function(e, d) {
    var changedX, changedY, maximumX, maximumY, minimumY, minumumX;
    if (!this.state.panEnabled) {
      return;
    }
    maximumX = (this.state.frameDimensions.width - this.state.viewBoxDimensions.width) + 20;
    minumumX = -20;
    changedX = this.state.viewBoxDimensions.x -= d.x;
    maximumY = (this.state.frameDimensions.height - this.state.viewBoxDimensions.height) + 20;
    minimumY = -20;
    changedY = this.state.viewBoxDimensions.y -= d.y;
    return this.setState({
      viewBoxDimensions: {
        x: Math.max(minumumX, Math.min(changedX, maximumX)),
        y: Math.max(minimumY, Math.min(changedY, maximumY)),
        width: this.state.viewBoxDimensions.width,
        height: this.state.viewBoxDimensions.height
      }
    });
  },
  frameKeyPan: function(e) {
    var keypress;
    if (!this.state.panEnabled) {
      return;
    }
    keypress = e.which;
    switch (keypress) {
      case 37:
        e.preventDefault();
        return this.panHorizontal(-20);
      case 38:
        e.preventDefault();
        return this.panVertical(-20);
      case 39:
        e.preventDefault();
        return this.panHorizontal(20);
      case 40:
        e.preventDefault();
        return this.panVertical(20);
      case 187:
        e.preventDefault();
        this.setState({
          zooming: true
        });
        return this.zoom(.9);
      case 189:
        e.preventDefault();
        this.setState({
          zooming: true
        });
        return this.zoom(1.1);
      case 1:
        e.preventDefault();
        if (e.deltaY > 0) {
          return this.zoom(.9);
        } else {
          return this.zoom(1.1);
        }
    }
  },
  panHorizontal: function(direction) {
    var changedX, maximumX, minumumX;
    maximumX = (this.state.frameDimensions.width - this.state.viewBoxDimensions.width) + 20;
    minumumX = -20;
    changedX = this.state.viewBoxDimensions.x + direction;
    return this.setState({
      viewBoxDimensions: {
        x: Math.max(minumumX, Math.min(changedX, maximumX)),
        y: this.state.viewBoxDimensions.y,
        width: this.state.viewBoxDimensions.width,
        height: this.state.viewBoxDimensions.height
      }
    });
  },
  panVertical: function(direction) {
    var changedY, maximumY, minimumY;
    maximumY = (this.state.frameDimensions.height - this.state.viewBoxDimensions.height) + 20;
    minimumY = -20;
    changedY = this.state.viewBoxDimensions.y + direction;
    return this.setState({
      viewBoxDimensions: {
        x: this.state.viewBoxDimensions.x,
        y: Math.max(minimumY, Math.min(changedY, maximumY)),
        width: this.state.viewBoxDimensions.width,
        height: this.state.viewBoxDimensions.height
      }
    });
  }
});


},{"../components/loading-indicator":77,"../lib/get-subject-location":102,"./video-player":96,"react":"react"}],76:[function(require,module,exports){
var BASE_64_EXPANSION, LoadingIndicator, React, ReactDOM, toBlob;

React = require('react');

ReactDOM = require('react-dom');

LoadingIndicator = require('./loading-indicator');

if (window.navigator != null) {
  toBlob = require('data-uri-to-blob');
}

BASE_64_EXPANSION = 3 / 4;

module.exports = React.createClass({
  displayName: 'ImageSelector',
  getDefaultProps: function() {
    return {
      accept: 'image/*',
      maxSize: Infinity,
      ratio: NaN,
      src: '',
      placeholder: '',
      minArea: 300,
      reductionPerPass: 0.05,
      onChange: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      working: false,
      rootWidth: NaN
    };
  },
  componentDidMount: function() {
    addEventListener('resize', this.updateWidth);
    return this.updateWidth();
  },
  componentWillUnmount: function() {
    return removeEventListener('resize', this.updateWidth);
  },
  render: function() {
    return React.createElement("div", {
      "className": "image-selector",
      "style": {
        width: this.state.rootWidth || 'auto',
        position: 'relative'
      }
    }, (this.props.src ? React.createElement("img", {
      "className": "image-selector-preview",
      "src": this.props.src,
      "style": {
        display: 'block',
        maxWidth: '100%'
      }
    }) : this.props.placeholder), React.createElement("input", {
      "type": "file",
      "accept": this.props.accept,
      "disabled": this.state.working,
      "style": {
        cursor: 'pointer',
        height: '100%',
        left: 0,
        position: 'absolute',
        opacity: 0,
        top: 0,
        width: '100%'
      },
      "onChange": this.handleChange
    }), (this.state.working ? React.createElement("span", {
      "style": {
        fontSize: '2em',
        left: '50%',
        position: 'absolute',
        top: '50%',
        transform: 'translate(-50%, -50%)'
      }
    }, React.createElement(LoadingIndicator, null)) : void 0));
  },
  updateWidth: function() {
    var i, imageSelectorPreviews, img, len;
    imageSelectorPreviews = document.getElementsByClassName('image-selector-preview');
    for (i = 0, len = imageSelectorPreviews.length; i < len; i++) {
      img = imageSelectorPreviews[i];
      img.dataset.displayWas = img.style.display;
      img.style.display = 'none';
    }
    return this.setState({
      rootWidth: NaN
    }, (function(_this) {
      return function() {
        var j, len1, results;
        _this.setState({
          rootWidth: ReactDOM.findDOMNode(_this).clientWidth
        });
        results = [];
        for (j = 0, len1 = imageSelectorPreviews.length; j < len1; j++) {
          img = imageSelectorPreviews[j];
          img.style.display = img.dataset.displayWas;
          results.push(delete img.dataset.displayWas);
        }
        return results;
      };
    })(this));
  },
  handleChange: function(e) {
    var file, reader;
    if (e.target.files.length !== 0) {
      file = e.target.files[0];
      this.setState({
        working: true
      });
      reader = new FileReader;
      reader.onload = (function(_this) {
        return function(e) {
          var img;
          img = new Image;
          img.onload = function() {
            return _this.cropImage(img, file);
          };
          return img.src = e.target.result;
        };
      })(this);
      return reader.readAsDataURL(file);
    }
  },
  cropImage: function(srcImg, srcFile) {
    var canvas, croppedImg, ctx, naturalRatio;
    canvas = document.createElement('canvas');
    canvas.width = srcImg.naturalWidth;
    canvas.height = srcImg.naturalHeight;
    if (!isNaN(this.props.ratio)) {
      naturalRatio = srcImg.naturalWidth / srcImg.naturalHeight;
      if (naturalRatio - this.props.ratio < 0) {
        canvas.height = canvas.width / this.props.ratio;
      } else {
        canvas.width = canvas.height * this.props.ratio;
      }
    }
    ctx = canvas.getContext('2d');
    ctx.drawImage(srcImg, (srcImg.naturalWidth - canvas.width) / -2, (srcImg.naturalHeight - canvas.height) / -2);
    croppedImg = new Image;
    croppedImg.onload = (function(_this) {
      return function() {
        return _this.reduceImage(croppedImg, srcFile);
      };
    })(this);
    return croppedImg.src = canvas.toDataURL();
  },
  reduceImage: function(img, srcFile, _scale) {
    var canvas, ctx, dataURL, error, size;
    if (_scale == null) {
      _scale = 1;
    }
    canvas = document.createElement('canvas');
    canvas.width = img.naturalWidth * _scale;
    canvas.height = img.naturalHeight * _scale;
    ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight, 0, 0, canvas.width, canvas.height);
    dataURL = canvas.toDataURL(srcFile.type);
    try {
      size = dataURL.split(';base64,')[1].length * BASE_64_EXPANSION;
      if (size > this.props.maxSize && canvas.width * canvas.height > this.props.minArea) {
        return this.reduceImage(img, srcFile, _scale - this.props.reductionPerPass);
      } else {
        this.setState({
          working: false
        });
        img.title = srcFile.name;
        return this.props.onChange(toBlob(dataURL), img);
      }
    } catch (error) {
      this.setState({
        working: false
      });
      return alert('Error reducing image. Try a smaller one.');
    }
  }
});


},{"./loading-indicator":77,"data-uri-to-blob":"data-uri-to-blob","react":"react","react-dom":"react-dom"}],77:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'LoadingIndicator',
  getDefaultProps: function() {
    return {
      off: false
    };
  },
  render: function() {
    var visibility;
    visibility = this.props.off ? 'hidden' : '';
    return React.createElement("span", {
      "className": "loading-indicator",
      "style": {
        visibility: visibility
      }
    }, React.createElement("span", {
      "className": "loading-indicator-icon"
    }), ' ', this.props.children);
  }
});


},{"react":"react"}],78:[function(require,module,exports){
var NOOP, React, separateSubjects,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

NOOP = Function.prototype;

separateSubjects = function(subjects, files, tooBig) {
  var allLocationsHaveFiles, incomplete, j, k, len, len1, location, missingFiles, ready, ref, subject, tooBigFiles;
  ready = [];
  incomplete = [];
  missingFiles = [];
  tooBigFiles = [];
  for (j = 0, len = subjects.length; j < len; j++) {
    subject = subjects[j];
    allLocationsHaveFiles = true;
    ref = subject.locations;
    for (k = 0, len1 = ref.length; k < len1; k++) {
      location = ref[k];
      if (!(location in files)) {
        missingFiles.push(location);
        allLocationsHaveFiles = false;
      }
      if (location in tooBig) {
        tooBigFiles.push(location);
      }
    }
    if (allLocationsHaveFiles) {
      ready.push(subject);
    } else {
      incomplete.push(subject);
    }
  }
  return {
    ready: ready,
    incomplete: incomplete,
    missingFiles: missingFiles,
    tooBigFiles: tooBigFiles
  };
};

module.exports = React.createClass({
  displayName: 'ManifestView',
  statics: {
    separateSubjects: separateSubjects
  },
  getDefaultProps: function() {
    return {
      name: '',
      errors: [],
      subjects: [],
      files: {},
      tooBigFiles: {},
      onRemove: NOOP
    };
  },
  getInitialState: function() {
    return {
      showingErrors: false,
      showingMissing: false,
      showingReady: false
    };
  },
  render: function() {
    var file, i, incomplete, key, location, locations, message, metadata, missingFiles, ready, ref, row, tooBigFiles, value;
    ref = separateSubjects(this.props.subjects, this.props.files, this.props.tooBigFiles), ready = ref.ready, incomplete = ref.incomplete, missingFiles = ref.missingFiles, tooBigFiles = ref.tooBigFiles;
    return React.createElement("div", {
      "className": "manifest-view"
    }, React.createElement("div", null, React.createElement("strong", null, this.props.name), ' ', "(", this.props.subjects.length, " subjects)", ' ', React.createElement("button", {
      "type": "button",
      "onClick": this.props.onRemove
    }, "")), (this.props.errors.length !== 0 ? React.createElement("div", null, React.createElement("i", {
      "className": "fa fa-exclamation-triangle fa-fw",
      "style": {
        color: 'orange'
      }
    }), this.props.errors.length, " parse errors", ' ', React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "onClick": this.toggleState.bind(this, 'showingErrors')
    }, React.createElement("i", {
      "className": "fa fa-eye fa-fw"
    })), React.createElement("br", null), (this.state.showingErrors ? React.createElement("ul", null, (function() {
      var j, len, ref1, ref2, results;
      ref1 = this.props.errors;
      results = [];
      for (j = 0, len = ref1.length; j < len; j++) {
        ref2 = ref1[j], row = ref2.row, message = ref2.message;
        results.push(React.createElement("li", {
          "key": row + message
        }, "Row ", row, ": ", message));
      }
      return results;
    }).call(this)) : void 0)) : void 0), (missingFiles.length !== 0 ? React.createElement("div", null, React.createElement("i", {
      "className": "fa fa-exclamation-circle fa-fw",
      "style": {
        color: 'red'
      }
    }), missingFiles.length, " missing files from ", incomplete.length, " subjects", ' ', React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "onClick": this.toggleState.bind(this, 'showingMissing')
    }, React.createElement("i", {
      "className": "fa fa-eye fa-fw"
    })), React.createElement("br", null), (this.state.showingMissing ? React.createElement("ul", null, (function() {
      var j, len, results;
      results = [];
      for (i = j = 0, len = missingFiles.length; j < len; i = ++j) {
        file = missingFiles[i];
        results.push(React.createElement("li", {
          "key": i
        }, file, (indexOf.call(tooBigFiles, file) >= 0 ? ' is too large' : void 0)));
      }
      return results;
    })()) : void 0)) : void 0), React.createElement("div", null, React.createElement("i", {
      "className": "fa fa-thumbs-up fa-fw",
      "style": {
        color: 'green'
      }
    }), ready.length, " subjects ready to load", ' ', React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "onClick": this.toggleState.bind(this, 'showingReady')
    }, React.createElement("i", {
      "className": "fa fa-eye fa-fw"
    })), (this.state.showingReady ? React.createElement("ul", null, (function() {
      var j, len, ref1, results;
      results = [];
      for (i = j = 0, len = ready.length; j < len; i = ++j) {
        ref1 = ready[i], locations = ref1.locations, metadata = ref1.metadata;
        results.push(React.createElement("li", {
          "key": i
        }, (function() {
          var k, len1, results1;
          results1 = [];
          for (k = 0, len1 = locations.length; k < len1; k++) {
            location = locations[k];
            results1.push(React.createElement("div", {
              "key": location
            }, location));
          }
          return results1;
        })(), React.createElement("table", {
          "className": "standard-table"
        }, (function() {
          var results1;
          results1 = [];
          for (key in metadata) {
            value = metadata[key];
            results1.push(React.createElement("tr", {
              "key": key
            }, React.createElement("th", null, key), React.createElement("td", {
              "key": key
            }, value)));
          }
          return results1;
        })())));
      }
      return results;
    })()) : void 0)));
  },
  toggleState: function(key) {
    var newState;
    newState = {};
    newState[key] = !this.state[key];
    return this.setState(newState);
  }
});


},{"react":"react"}],79:[function(require,module,exports){
var FileButton, FileDropTarget, MediaIcon, PromiseRenderer, React, Thumbnail, TriggeredModalForm, apiClient, putFile,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

Thumbnail = require('./thumbnail');

PromiseRenderer = require('./promise-renderer');

TriggeredModalForm = require('modal-form/triggered');

FileButton = require('./file-button');

apiClient = require('panoptes-client/lib/api-client');

putFile = require('../lib/put-file');

FileDropTarget = React.createClass({
  displayName: 'DragAndDropTarget',
  getDefaultProps: function() {
    return {
      className: '',
      filterFiles: null,
      onDrop: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      canDrop: false
    };
  },
  eventsToMakeDropWork: function() {
    return {
      onDragEnter: this.handleDragEnter,
      onDragOver: this.handleDragOver,
      onDragLeave: this.handleDragLeave,
      onDrop: this.handleDrop
    };
  },
  render: function() {
    var className;
    className = ("file-drop-target " + this.props.className).trim();
    return React.createElement("div", React.__spread({}, this.props, {
      "className": className,
      "data-can-drop": this.state.canDrop || null
    }, this.eventsToMakeDropWork()), this.props.children);
  },
  handleDragEnter: function(e) {
    var files, ref;
    e.preventDefault();
    files = Array.prototype.filter.call(e.dataTransfer.files, (ref = this.props.filterFiles) != null ? ref : Boolean);
    return this.setState({
      canDrop: files.length === e.dataTransfer.files.length
    });
  },
  handleDragOver: function(e) {
    return e.preventDefault();
  },
  handleDragLeave: function(e) {
    e.preventDefault();
    return this.setState({
      canDrop: false
    });
  },
  handleDrop: function(e) {
    var ref;
    e.preventDefault();
    if (this.state.canDrop) {
      (ref = this.props).onDrop.apply(ref, arguments);
      return this.setState({
        canDrop: false
      });
    }
  }
});

MediaIcon = React.createClass({
  displayName: 'MediaIcon',
  getDefaultProps: function() {
    return {
      resource: null,
      height: 80,
      onDelete: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      deleting: false
    };
  },
  getMarkdown: function(resource) {
    return "![" + resource.metadata.filename + "](" + resource.src + ")";
  },
  render: function() {
    return React.createElement("div", {
      "className": "media-icon",
      "style": (this.state.deleting ? {
        opacity: 0.5
      } : void 0)
    }, React.createElement("div", {
      "className": "media-icon-thumbnail-container"
    }, React.createElement(TriggeredModalForm, {
      "trigger": React.createElement(Thumbnail, {
        "className": "media-icon-thumbnail",
        "src": this.props.resource.src,
        "height": this.props.height,
        "style": {
          position: 'relative'
        }
      })
    }, React.createElement("div", {
      "className": "content-container"
    }, React.createElement("img", {
      "src": this.props.resource.src,
      "style": {
        maxHeight: '80vh',
        maxWidth: '60vw'
      }
    }))), React.createElement("button", {
      "type": "button",
      "className": "media-icon-delete-button",
      "disabled": this.state.deleting,
      "onClick": this.handleDelete
    }, "")), React.createElement("div", {
      "className": "media-icon-label",
      "style": {
        position: 'relative'
      }
    }, this.props.resource.metadata.filename), React.createElement("textarea", {
      "className": "media-icon-markdown",
      "value": this.getMarkdown(this.props.resource),
      "readOnly": true,
      "style": {
        position: 'relative'
      },
      "onFocus": this.handleMarkdownFocus
    }));
  },
  handleDelete: function() {
    console.log("Deleting media resource " + this.props.resource.id);
    this.setState({
      deleting: true
    });
    return this.props.resource["delete"]().then((function(_this) {
      return function() {
        _this.setState({
          deleting: false
        });
        return _this.props.onDelete(_this.props.resource);
      };
    })(this));
  },
  handleMarkdownFocus: function(e) {
    return e.target.setSelectionRange(0, e.target.value.length);
  }
});

module.exports = React.createClass({
  displayName: 'MediaArea',
  getDefaultProps: function() {
    return {
      resource: null,
      link: 'attached_images',
      pageSize: 200,
      metadata: {},
      onAdd: Function.prototype,
      onDelete: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      pendingFiles: [],
      pendingMedia: [],
      errors: []
    };
  },
  addButtonStyle: {
    height: '80px',
    lineHeight: '100px',
    width: '100px'
  },
  filterOnMetadata: function(resource) {
    var key, passes, ref, value;
    passes = true;
    ref = this.props.metadata;
    for (key in ref) {
      value = ref[key];
      if (resource.metadata[key] !== value) {
        passes = false;
        break;
      }
    }
    return passes;
  },
  render: function() {
    window.lastRenderedMediaArea = this;
    this.cachedMediaRequest = this.props.resource.get(this.props.link, {
      page_size: this.props.pageSize
    })["catch"](function() {
      return [];
    });
    return React.createElement(PromiseRenderer, {
      "promise": this.cachedMediaRequest
    }, ((function(_this) {
      return function(media) {
        media = [].concat(media).filter(_this.filterOnMetadata);
        return React.createElement("div", {
          "className": ("media-area " + _this.props.className).trim(),
          "style": Object.assign({
            position: 'relative'
          }, _this.props.style)
        }, React.createElement(FileDropTarget, {
          "style": {
            bottom: '3px',
            left: '3px',
            position: 'absolute',
            right: '3px',
            top: '3px'
          },
          "onDrop": _this.handleDrop
        }), (media.length === 0 ? React.createElement("small", null, React.createElement("em", null, "No media")) : void 0), React.createElement("ul", {
          "className": "media-area-list"
        }, media.map(function(resource) {
          if (indexOf.call(_this.state.pendingMedia, resource) >= 0) {
            return null;
          } else {
            return React.createElement("li", {
              "key": resource.id,
              "className": "media-area-item"
            }, React.createElement(MediaIcon, {
              "resource": resource,
              "onDelete": _this.handleDelete
            }));
          }
        }), React.createElement("li", {
          "className": "media-area-item",
          "style": {
            alignSelf: 'stretch'
          }
        }, React.createElement("div", {
          "className": "media-icon"
        }, React.createElement(FileButton, {
          "className": "media-area-add-button",
          "accept": "image/*",
          "multiple": true,
          "style": _this.addButtonStyle,
          "onSelect": _this.handleFileSelection
        }, React.createElement("i", {
          "className": "fa fa-plus fa-3x"
        })), React.createElement("div", {
          "className": "media-icon-label"
        }, "Select files")))), (_this.props.children != null ? React.createElement("hr", null) : void 0), _this.props.children, (_this.state.pendingFiles.length !== 0 ? React.createElement("hr", null) : void 0), _this.state.pendingFiles.map(function(file) {
          return React.createElement("div", {
            "key": file.name
          }, React.createElement("small", null, React.createElement("i", {
            "className": "fa fa-spinner fa-spin"
          }), ' ', React.createElement("strong", null, file.name)));
        }), (_this.state.errors.length !== 0 ? React.createElement("hr", null) : void 0), _this.state.errors.map(function(arg) {
          var error, file;
          file = arg.file, error = arg.error;
          return React.createElement("div", {
            "key": file.name
          }, error.toString(), " (", file.name, ")");
        }));
      };
    })(this)));
  },
  handleDrop: function(e) {
    return this.addFiles(Array.prototype.slice.call(e.dataTransfer.files));
  },
  handleDelete: function() {
    var ref;
    this.refresh();
    return (ref = this.props).onDelete.apply(ref, arguments);
  },
  refresh: function() {
    console.log('Refreshing media area');
    this.cachedMediaRequest = null;
    return this.forceUpdate();
  },
  handleFileSelection: function(e) {
    console.log("Handling " + e.target.files.length + " selected files");
    return this.addFiles(Array.prototype.slice.call(e.target.files));
  },
  addFiles: function(files) {
    console.log("Adding " + files.length + " files");
    return files.forEach(this.addFile);
  },
  addFile: function(file) {
    console.log("Adding media " + file.name);
    this.state.pendingFiles.push(file);
    this.setState({
      pendingFiles: this.state.pendingFiles
    });
    return this.createLinkedResource(file).then(this.uploadMedia.bind(this, file)).then(this.handleSuccess)["catch"](this.handleError.bind(this, file)).then(this.removeFromPending.bind(this, file));
  },
  createLinkedResource: function(file) {
    var payload;
    console.log("Creating resource for " + file.name + ", " + file.type);
    payload = {
      media: {
        content_type: file.type,
        metadata: {
          filename: file.name
        }
      }
    };
    Object.assign(payload.media.metadata, this.props.metadata);
    return apiClient.post(this.props.resource._getURL(this.props.link), payload).then((function(_this) {
      return function(media) {
        media = [].concat(media)[0];
        _this.state.pendingMedia.push(media);
        return media;
      };
    })(this));
  },
  uploadMedia: function(file, media) {
    console.log("Uploading " + file.name + " => " + media.src);
    return putFile(media.src, file, {
      'Content-Type': file.type
    }).then((function(_this) {
      return function() {
        return media.refresh().then(function(media) {
          return [].concat(media)[0];
        });
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return media["delete"]().then(function() {
          throw error;
        });
      };
    })(this));
  },
  handleSuccess: function(media) {
    var pendingMediaIndex;
    console.log("Success! " + media.metadata.filename);
    pendingMediaIndex = this.state.pendingMedia.indexOf(media);
    this.state.pendingMedia.splice(pendingMediaIndex, 1);
    this.setState({
      pendingMedia: this.state.pendingMedia
    });
    this.props.onAdd(media);
    return media;
  },
  handleError: function(file, error) {
    console.log("Got error " + error.message + " for " + file.name);
    this.state.errors.push({
      file: file,
      error: error
    });
    return this.setState({
      errors: this.state.errors
    });
  },
  removeFromPending: function(file) {
    var pendingFileIndex;
    console.log("No longer pendingFiles: " + file.name);
    pendingFileIndex = this.state.pendingFiles.indexOf(file);
    this.state.pendingFiles.splice(pendingFileIndex, 1);
    return this.setState({
      pendingFiles: this.state.pendingFiles
    });
  }
});


},{"../lib/put-file":112,"./file-button":72,"./promise-renderer":86,"./thumbnail":93,"modal-form/triggered":548,"panoptes-client/lib/api-client":549,"react":"react"}],80:[function(require,module,exports){
var IMAGE_EXTENSIONS, React, VIDEO_EXTENSIONS,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

IMAGE_EXTENSIONS = ['gif', 'jpeg', 'jpg', 'png', 'svg'];

VIDEO_EXTENSIONS = ['mp4'];

module.exports = React.createClass({displayName: "exports",
  getDefaultProps: function() {
    return {
      src: ''
    };
  },
  render: function() {
    var srcExtension;
    srcExtension = this.props.src.split('.').pop().toLowerCase();
    return React.createElement("div", React.__spread({}, this.props, {
      "className": ("media-card " + this.props.className).trim()
    }), (this.props.src ? React.createElement("div", {
      "className": "media-card-header"
    }, (indexOf.call(IMAGE_EXTENSIONS, srcExtension) >= 0 ? React.createElement("img", {
      "className": "media-card-media",
      "src": this.props.src
    }) : indexOf.call(VIDEO_EXTENSIONS, srcExtension) >= 0 ? React.createElement("video", {
      "className": "media-card-media",
      "src": this.props.src
    }, React.createElement("p", null, "Your browser does not support this video format.")) : (console.warn("Not sure how to render " + this.props.src), null))) : void 0), (this.props.children ? React.createElement("div", {
      "className": "media-card-content"
    }, this.props.children) : void 0));
  }
});


},{"react":"react"}],81:[function(require,module,exports){
var ChangeListener, React, ReactDOM;

React = require('react');

ReactDOM = require('react-dom');

ChangeListener = require('./change-listener');

module.exports = React.createClass({
  displayName: 'MultiImageSubjectLayoutEditor',
  getDefaultProps: function() {
    return {
      workflow: null
    };
  },
  getInitialState: function() {
    return {
      saveError: null,
      saveInProgress: false
    };
  },
  defaultLayout: 'row',
  defaultMode: 'flipbook_and_separate',
  componentDidMount: function() {
    return this.updateRadios();
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.workflow) {
      return this.updateRadios();
    }
  },
  updateRadios: function() {
    var layout, ref, ref1;
    layout = ((ref = this.props.workflow.configuration) != null ? ref.multi_image_layout : void 0) || this.defaultLayout;
    return (ref1 = ReactDOM.findDOMNode(this).querySelector('input[type="radio"][value="' + layout + '"]')) != null ? ref1.defaultChecked = true : void 0;
  },
  render: function() {
    var mode, ref;
    mode = ((ref = this.props.workflow.configuration) != null ? ref.multi_image_mode : void 0) || this.defaultMode;
    return React.createElement(ChangeListener, {
      "target": this.props.workflow
    }, ((function(_this) {
      return function() {
        var ref1, ref2;
        return React.createElement("div", {
          "className": "multi-image-subject-layout-editor"
        }, React.createElement("div", null, React.createElement("select", {
          "id": "multi_image_mode",
          "onChange": _this.handleSelectMode,
          "defaultValue": mode
        }, React.createElement("option", {
          "value": "flipbook"
        }, "Show flipbook"), React.createElement("option", {
          "value": "separate"
        }, "Show separate frames"), React.createElement("option", {
          "value": "flipbook_and_separate"
        }, "Allow users to choose flipbook or separate frames"))), (((ref1 = _this.props.workflow.configuration) != null ? ref1.multi_image_mode : void 0) === 'separate' || ((ref2 = _this.props.workflow.configuration) != null ? ref2.multi_image_mode : void 0) === 'flipbook_and_separate' ? React.createElement("div", null, React.createElement("label", null, "Show separate frames as"), React.createElement("br", null), React.createElement("input", {
          "type": "radio",
          "id": "multi_image_row",
          "name": "multi_image_layout",
          "value": "row",
          "onChange": _this.handleSelectLayout
        }), React.createElement("label", {
          "htmlFor": "multi_image_row"
        }, "Single row (side by side)"), React.createElement("input", {
          "type": "radio",
          "id": "multi_image_grid2",
          "name": "multi_image_layout",
          "value": "grid2",
          "onChange": _this.handleSelectLayout
        }), React.createElement("label", {
          "htmlFor": "multi_image_grid2"
        }, "Grid (2col)"), React.createElement("input", {
          "type": "radio",
          "id": "multi_image_grid3",
          "name": "multi_image_layout",
          "value": "grid3",
          "onChange": _this.handleSelectLayout
        }), React.createElement("label", {
          "htmlFor": "multi_image_grid3"
        }, "Grid (3col)")) : void 0));
      };
    })(this)));
  },
  handleSelectMode: function(e) {
    var mode;
    mode = e.target.value;
    return this.props.workflow.update({
      'configuration.multi_image_mode': mode
    });
  },
  handleSelectLayout: function(e) {
    var layout;
    layout = e.target.value;
    return this.props.workflow.update({
      'configuration.multi_image_layout': layout
    });
  }
});


},{"./change-listener":63,"react":"react","react-dom":"react-dom"}],82:[function(require,module,exports){
var Link, OwnedCard, PromiseRenderer, React, TitleMixin, Translate, apiClient, counterpart;

counterpart = require('counterpart');

React = require('react');

TitleMixin = require('../lib/title-mixin');

Translate = require('react-translate-component');

apiClient = require('panoptes-client/lib/api-client');

PromiseRenderer = require('../components/promise-renderer');

OwnedCard = require('../partials/owned-card');

Link = require('react-router').Link;

module.exports = React.createClass({
  displayName: 'OwnedCardList',
  propTypes: {
    imagePromise: React.PropTypes.func.isRequired,
    listPromise: React.PropTypes.object.isRequired,
    cardLink: React.PropTypes.func.isRequired,
    translationObjectName: React.PropTypes.string.isRequired,
    ownerName: React.PropTypes.string,
    heroClass: React.PropTypes.string,
    heroNav: React.PropTypes.node,
    skipOwner: React.PropTypes.bool
  },
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  userForTitle: function() {
    if (this.props.ownerName) {
      return this.props.ownerName + "'s";
    } else {
      return 'All';
    }
  },
  render: function() {
    var location;
    location = this.props.location;
    return React.createElement("div", {
      "className": "secondary-page all-resources-page"
    }, React.createElement("section", {
      "className": "hero " + this.props.heroClass
    }, React.createElement("div", {
      "className": "hero-container"
    }, React.createElement(Translate, {
      "component": "h1",
      "user": this.userForTitle(),
      "content": this.props.translationObjectName + ".title"
    }), (this.props.heroNav != null ? this.props.heroNav : void 0))), React.createElement("section", {
      "className": "resources-container"
    }, React.createElement(PromiseRenderer, {
      "promise": this.props.listPromise
    }, ((function(_this) {
      return function(ownedResources) {
        var active, count, meta, page, pageEnd, pageStart, resource;
        if ((ownedResources != null ? ownedResources.length : void 0) > 0) {
          meta = ownedResources[0].getMeta();
          return React.createElement("div", null, React.createElement("div", {
            "className": "resource-results-counter"
          }, (meta ? (pageStart = meta.page * meta.page_size - meta.page_size + 1, pageEnd = Math.min(meta.page * meta.page_size, meta.count), count = meta.count, React.createElement(Translate, {
            "pageStart": pageStart,
            "pageEnd": pageEnd,
            "count": count,
            "content": _this.props.translationObjectName + ".countMessage",
            "component": "p"
          })) : void 0)), React.createElement("div", {
            "className": "card-list"
          }, (function() {
            var i, len, results;
            results = [];
            for (i = 0, len = ownedResources.length; i < len; i++) {
              resource = ownedResources[i];
              results.push(React.createElement(OwnedCard, {
                "key": resource.id,
                "resource": resource,
                "imagePromise": this.props.imagePromise(resource),
                "linkTo": this.props.cardLink(resource),
                "translationObjectName": this.props.translationObjectName,
                "skipOwner": this.props.skipOwner
              }));
            }
            return results;
          }).call(_this)), React.createElement("nav", null, (meta ? React.createElement("nav", {
            "className": "pagination"
          }, (function() {
            var i, ref, results;
            results = [];
            for (page = i = 1, ref = meta.page_count; 1 <= ref ? i <= ref : i >= ref; page = 1 <= ref ? ++i : --i) {
              active = (page === +location.query.page) || (page === 1 && !location.search);
              results.push(React.createElement(Link, {
                "key": page,
                "to": this.props.linkTo + "?page=" + page,
                "activeClassName": "active",
                "className": "pill-button",
                "style": (active ? {
                  border: "2px solid"
                } : void 0)
              }, page));
            }
            return results;
          }).call(_this)) : void 0)));
        } else if ((ownedResources != null ? ownedResources.length : void 0) === 0) {
          return React.createElement(Translate, {
            "content": _this.props.translationObjectName + ".notFoundMessage",
            "component": "div"
          });
        } else {
          return React.createElement(Translate, {
            "content": _this.props.translationObjectName + ".loadMessage",
            "component": "div"
          });
        }
      };
    })(this)))));
  }
});


},{"../components/promise-renderer":86,"../lib/title-mixin":117,"../partials/owned-card":223,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],83:[function(require,module,exports){
var History, React;

React = require('react');

History = require('react-router').History;

module.exports = React.createClass({displayName: "exports",
  mixins: [History],
  childContextTypes: {
    history: React.PropTypes.oneOfType([React.PropTypes.array, React.PropTypes.object])
  },
  getChildContext: function() {
    return this.props.context;
  },
  render: function() {
    return this.props.children;
  }
});


},{"react":"react","react-router":"react-router"}],84:[function(require,module,exports){
var DisciplineSelector, Filmstrip, FlexibleLink, History, Link, PROJECT_SORTS, PageSelector, ProjectCard, ProjectCardList, ProjectFilteringInterface, PromiseRenderer, React, Router, SearchSelector, Select, SortSelector, Translate, apiClient, debounce, ref;

React = require('react');

PromiseRenderer = require('../components/promise-renderer');

apiClient = require('panoptes-client/lib/api-client');

Select = require('react-select');

ref = require('react-router'), Link = ref.Link, Router = ref.Router, History = ref.History;

Translate = require('react-translate-component');

debounce = require('debounce');

Filmstrip = require('../components/filmstrip');

PROJECT_SORTS = (require('../lib/project-sorts')).PROJECT_SORTS;

FlexibleLink = React.createClass({
  displayName: 'FlexibleLink',
  propTypes: {
    to: React.PropTypes.string.isRequired,
    skipOwner: React.PropTypes.bool
  },
  isExternal: function() {
    return this.props.to.indexOf('http') > -1;
  },
  render: function() {
    if (this.isExternal()) {
      return React.createElement("a", {
        "href": this.props.to
      }, this.props.children);
    } else {
      return React.createElement(Link, React.__spread({}, this.props), this.props.children);
    }
  }
});

ProjectCard = React.createClass({
  displayName: 'ProjectCard',
  propTypes: {
    project: React.PropTypes.object.isRequired
  },
  getDefaultProps: function() {
    return {
      avatar: '',
      name: '',
      slug: ''
    };
  },
  componentDidMount: function() {
    var card;
    card = this.refs.ownedCard;
    Promise.resolve((this.props.project.avatar_src ? "//" + this.props.project.avatar_src : './assets/simple-avatar.jpg')).then((function(_this) {
      return function(src) {
        card.style.backgroundImage = "url('" + src + "')";
        return card.style.backgroundSize = "contain";
      };
    })(this))["catch"]((function(_this) {
      return function() {
        return card.style.background = "url('./assets/simple-pattern.jpg') center center repeat";
      };
    })(this));
    return card.classList.add('project-card');
  },
  render: function() {
    var avatarSrcWithProtocol, linkProps, project;
    project = this.props.project;
    avatarSrcWithProtocol = !!project.avatar_src ? 'https://' + project.avatar_src : void 0;
    linkProps = {
      to: project.redirect ? project.redirect : '/projects/' + project.slug
    };
    return React.createElement(FlexibleLink, React.__spread({}, linkProps), React.createElement("div", {
      "className": "card",
      "ref": "ownedCard"
    }, React.createElement("svg", {
      "className": "card-space-maker",
      "viewBox": "0 0 2 1",
      "width": "100%"
    }), React.createElement("div", {
      "className": "details"
    }, React.createElement("div", {
      "className": "name"
    }, React.createElement("span", null, project.display_name)), (project.description != null ? React.createElement("div", {
      "className": "description"
    }, project.description) : void 0), React.createElement("button", {
      "type": "button",
      "tabIndex": "-1",
      "className": "standard-button card-button"
    }, React.createElement(Translate, {
      "content": "projectsPage.button"
    })))));
  }
});

ProjectCardList = React.createClass({
  displayName: 'ProjectCardList',
  getDefaultProps: function() {
    return {
      projects: []
    };
  },
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement("div", {
      "className": "card-list"
    }, this.props.projects.map((function(_this) {
      return function(project) {
        return React.createElement("div", {
          "key": project.id
        }, React.createElement(ProjectCard, {
          "project": project
        }));
      };
    })(this)));
  }
});

DisciplineSelector = React.createClass({
  displayName: 'DisciplineSelector',
  render: function() {
    return React.createElement(Filmstrip, {
      "increment": 350.,
      "value": this.props.value,
      "onChange": this.props.onChange
    });
  }
});

SearchSelector = React.createClass({
  displayName: 'SearchSelector',
  mixins: [History],
  getDefaultProps: function() {
    return {
      onChange: function() {},
      query: function() {},
      navigate: function() {}
    };
  },
  navigateToProject: function(projectID) {
    return apiClient.type('projects').get(projectID).then(function(project) {
      if ((project.redirect != null) && project.redirect.length !== 0) {
        return window.location.href = project.redirect;
      } else {
        return window.location.href = ['/projects', project.slug].join('/');
      }
    });
  },
  searchByName: function(value, callback) {
    var query;
    query = {
      search: "%" + value + "%",
      launch_approved: !apiClient.params.admin ? true : void 0
    };
    if ((value != null ? value.trim().length : void 0) > 3) {
      apiClient.type('projects').get(query, {
        page_size: 10
      }).then(function(projects) {
        var opts;
        opts = projects.map(function(project) {
          return {
            value: project.id,
            label: project.display_name,
            project: project
          };
        });
        return callback(null, {
          options: opts || []
        });
      });
    }
    return callback(null, {
      options: []
    });
  },
  handleChange: function(e) {
    return this.props.onChange(e.value);
  },
  render: function() {
    return React.createElement(Select, {
      "multi": false,
      "name": "resourcesid",
      "placeholder": "Name:",
      "value": "",
      "searchPromptText": "Search by name",
      "closeAfterClick": true,
      "asyncOptions": debounce(this.searchByName, 2000),
      "onChange": this.navigateToProject,
      "className": "search card-search standard-input"
    });
  }
});

SortSelector = React.createClass({
  displayName: 'SortSelector',
  getDefaultProps: function() {
    return {
      value: 'default',
      sortMethods: PROJECT_SORTS,
      onChange: function() {}
    };
  },
  handleChange: function(e) {
    return this.props.onChange(e.target.value);
  },
  render: function() {
    return React.createElement(Select, {
      "multi": false,
      "name": "sort_order",
      "value": this.props.value,
      "placeholder": "Sort by",
      "searchPromptText": "Select a sort order",
      "closeAfterClick": true,
      "className": "standard-input search card-sort",
      "options": this.props.sortMethods,
      "onChange": this.props.onChange
    });
  }
});

PageSelector = React.createClass({
  displayName: 'PageSelector',
  getDefaultProps: function() {
    return {
      current: 1,
      total: 0
    };
  },
  handleChange: function(page) {
    return this.props.onChange(page);
  },
  render: function() {
    var active, page;
    return React.createElement("nav", {
      "className": "pagination"
    }, ((function() {
      var i, ref1, results;
      if (this.props.total > 1) {
        results = [];
        for (page = i = 1, ref1 = this.props.total; 1 <= ref1 ? i <= ref1 : i >= ref1; page = 1 <= ref1 ? ++i : --i) {
          active = page === +this.props.current;
          results.push(React.createElement("button", {
            "onClick": this.handleChange.bind(this, page),
            "key": page,
            "className": "pill-button",
            "style": (active ? {
              border: "2px solid"
            } : void 0)
          }, page));
        }
        return results;
      }
    }).call(this)));
  }
});

ProjectFilteringInterface = React.createClass({displayName: "ProjectFilteringInterface",
  getDefaultProps: function() {
    return {
      discipline: '',
      page: 1,
      sort: '-launch_date',
      SORT_QUERY_VALUES: {
        'active': '-last_modified',
        'inactive': 'last_modified'
      }
    };
  },
  getInitialState: function() {
    return {
      projects: [],
      pages: 0,
      project_count: 0,
      loading: false,
      error: null,
      query: {}
    };
  },
  componentDidMount: function() {
    var discipline, page, ref1, sort;
    ref1 = this.props, discipline = ref1.discipline, page = ref1.page, sort = ref1.sort;
    return this.loadProjects({
      discipline: discipline,
      page: page,
      sort: sort
    });
  },
  componentWillReceiveProps: function(nextProps) {
    var discipline, page, sort;
    discipline = nextProps.discipline, page = nextProps.page, sort = nextProps.sort;
    if (discipline !== this.props.discipline || page !== this.props.page || sort !== this.props.sort) {
      return this.loadProjects({
        discipline: discipline,
        page: page,
        sort: sort
      });
    }
  },
  loadProjects: function(arg) {
    var discipline, page, query, sort;
    discipline = arg.discipline, page = arg.page, sort = arg.sort;
    this.setState({
      loading: true,
      error: null
    });
    query = {
      tags: discipline || void 0,
      page: page,
      sort: sort != null ? sort : this.constructor.defaultProps.sort,
      launch_approved: !apiClient.params.admin ? true : void 0,
      cards: true,
      include: ['avatar']
    };
    if (!query.tags) {
      delete query.tags;
    }
    return apiClient.type('projects').get(query).then((function(_this) {
      return function(projects) {
        var pages, project_count, ref1, ref2, ref3, ref4;
        pages = (ref1 = projects[0]) != null ? (ref2 = ref1.getMeta()) != null ? ref2.page_count : void 0 : void 0;
        if (pages == null) {
          pages = 0;
        }
        project_count = (ref3 = projects[0]) != null ? (ref4 = ref3.getMeta()) != null ? ref4.count : void 0 : void 0;
        if (project_count == null) {
          project_count = 0;
        }
        return _this.setState({
          projects: projects,
          pages: pages,
          project_count: project_count
        });
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          loading: false
        });
      };
    })(this));
  },
  handleDisciplineChange: function(discipline) {
    var page;
    page = 1;
    return this.props.onChangeQuery({
      discipline: discipline,
      page: page
    });
  },
  handleSortChange: function(sort) {
    var page;
    page = 1;
    return this.props.onChangeQuery({
      sort: sort,
      page: page
    });
  },
  handlePageChange: function(page) {
    return this.props.onChangeQuery({
      page: page
    });
  },
  setFilter: function(e) {},
  render: function() {
    var pageEnd, pageStart, showingMessage;
    return React.createElement("div", {
      "className": "secondary-page all-resources-page"
    }, React.createElement("section", {
      "className": "hero projects-hero"
    }, React.createElement("div", {
      "className": "hero-container"
    }, React.createElement(Translate, {
      "component": "h1",
      "content": "projectsPage.title"
    }))), React.createElement("section", {
      "className": "resources-container"
    }, React.createElement(DisciplineSelector, {
      "value": this.props.discipline,
      "onChange": this.handleDisciplineChange
    }), React.createElement("div", {
      "className": "resource-results-counter"
    }, React.createElement(SearchSelector, null), React.createElement(SortSelector, {
      "value": this.props.sort,
      "onChange": this.handleSortChange
    })), (this.state.project_count > 0 ? (pageStart = this.props.page * 20 - 20 + 1, pageEnd = Math.min(this.props.page * 20, this.state.project_count), showingMessage = "projectsPage.countMessage") : showingMessage = "projectsPage.notFoundMessage", React.createElement("p", {
      "className": "showing-with-link-para"
    }, React.createElement(Translate, {
      "pageStart": pageStart,
      "pageEnd": pageEnd,
      "count": this.state.project_count,
      "content": showingMessage
    }))), (this.state.pages > 1 ? React.createElement(PageSelector, {
      "current": this.props.page,
      "total": this.state.pages,
      "onChange": this.handlePageChange
    }) : void 0), React.createElement(ProjectCardList, {
      "projects": this.state.projects
    }), (this.state.pages > 1 ? React.createElement(PageSelector, {
      "current": this.props.page,
      "total": this.state.pages,
      "onChange": this.handlePageChange
    }) : void 0)));
  }
});

module.exports = {
  ProjectCard: ProjectCard,
  ProjectCardList: ProjectCardList,
  ProjectFilteringInterface: ProjectFilteringInterface
};


},{"../components/filmstrip":73,"../components/promise-renderer":86,"../lib/project-sorts":110,"debounce":"debounce","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router","react-select":"react-select","react-translate-component":"react-translate-component"}],85:[function(require,module,exports){
var Link, React;

React = require('react');

Link = require('react-router').Link;

module.exports = React.createClass({
  displayName: 'ProjectIcon',
  getDefaultProps: function() {
    return {
      project: null,
      badge: '',
      defaultAvatarSrc: './assets/simple-avatar.jpg',
      onClick: null,
      linkTo: true
    };
  },
  getInitialState: function() {
    return {
      href: '',
      avatar: null
    };
  },
  componentDidMount: function() {
    return this.getDetails(this.props.project);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.project !== this.props.project) {
      return this.getDetails(nextProps.project);
    }
  },
  getDetails: function(project) {
    project.get('owner').then((function(_this) {
      return function(owner) {
        return _this.setState({
          owner: owner
        });
      };
    })(this));
    return project.get('avatar')["catch"]((function(_this) {
      return function() {
        return null;
      };
    })(this)).then((function(_this) {
      return function(avatar) {
        return _this.setState({
          avatar: avatar
        });
      };
    })(this));
  },
  render: function() {
    var content, name, owner, ref, ref1, ref2, ref3;
    content = [
      React.createElement("img", {
        "key": "image",
        "src": (ref = (ref1 = this.state.avatar) != null ? ref1.src : void 0) != null ? ref : this.props.defaultAvatarSrc
      }), React.createElement("div", {
        "key": "label",
        "className": "label"
      }, React.createElement("span", {
        "className": "owner"
      }, ((ref2 = this.state.owner) != null ? ref2.display_name : void 0)), React.createElement("br", null), React.createElement("span", {
        "className": "display-name"
      }, React.createElement("strong", null, this.props.project.display_name))), this.props.badge ? React.createElement("div", {
        "key": "badge",
        "className": "badge"
      }, this.props.badge) : void 0
    ];
    if (this.props.linkTo) {
      if (!!this.props.project.redirect) {
        return React.createElement("a", {
          "href": this.props.project.redirect,
          "className": "stats-project-icon"
        }, content);
      } else {
        ref3 = this.props.project.slug.split('/'), owner = ref3[0], name = ref3[1];
        return React.createElement(Link, {
          "to": "/projects/" + owner + "/" + name,
          "className": "stats-project-icon"
        }, content);
      }
    } else {
      return React.createElement("span", {
        "className": "stats-project-icon"
      }, content);
    }
  }
});


},{"react":"react","react-router":"react-router"}],86:[function(require,module,exports){
var HandlePropChanges, React;

React = require('react');

HandlePropChanges = require('../lib/handle-prop-changes');

module.exports = React.createClass({
  displayName: 'PromiseRenderer',
  mixins: [HandlePropChanges],
  getDefaultProps: function() {
    return {
      promise: null,
      tag: 'div',
      pending: this.prototype.defaultPending,
      then: this.prototype.defaultThen,
      "catch": this.prototype.defaultCatch
    };
  },
  getInitialState: function() {
    return {
      state: 'pending',
      value: null,
      error: null
    };
  },
  propChangeHandlers: {
    promise: 'attachTo'
  },
  attachTo: function(promise) {
    this.setState({
      state: 'pending'
    });
    promise.then((function(_this) {
      return function(value) {
        return _this.safelySetState(promise, {
          state: 'resolved',
          value: value,
          error: null
        });
      };
    })(this));
    return promise["catch"]((function(_this) {
      return function(error) {
        return _this.safelySetState(promise, {
          state: 'rejected',
          value: null,
          error: error
        });
      };
    })(this));
  },
  safelySetState: function(promise, state) {
    if (this.isMounted() && promise === this.props.promise) {
      return this.setState(state);
    }
  },
  render: function() {
    var error, result;
    result = (function() {
      var error1;
      try {
        switch (this.state.state) {
          case 'pending':
            return this.renderPending();
          case 'resolved':
            return this.renderResolved(this.state.value);
          case 'rejected':
            return this.renderRejected(this.state.error);
        }
      } catch (error1) {
        error = error1;
        return this.renderRejected(error);
      }
    }).call(this);
    return result != null ? result : null;
  },
  renderPending: function() {
    if (this.state.value != null) {
      return this.renderResolved(this.state.value);
    } else {
      if (typeof this.props.pending === 'string') {
        return this.defaultPending(this.props.pending);
      } else if (this.props.pending != null) {
        return this.props.pending.call(this);
      }
    }
  },
  renderResolved: function(value) {
    var ref;
    if (typeof this.props.children === 'function') {
      return (ref = this.props.children(value)) != null ? ref : null;
    } else if (this.props.then != null) {
      if (typeof this.props.then === 'string') {
        return this.renderSimpleLookup(value, this.props.then);
      } else {
        return this.props.then.call(this, value);
      }
    }
  },
  renderSimpleLookup: function(value, path) {
    path = path.split('.');
    while (path.length !== 0) {
      value = value[path.shift()];
    }
    return React.createElement(this.props.tag, this.props, value);
  },
  renderRejected: function(error) {
    var error1, secondError;
    if (this.props["catch"]) {
      try {
        return this.props["catch"].call(this, error);
      } catch (error1) {
        secondError = error1;
        return this.defaultCatch(secondError);
      }
    }
  },
  defaultPending: function(message) {
    return React.createElement(this.props.tag, this.props, message != null ? message : null);
  },
  defaultThen: function(value) {
    return React.createElement(this.props.tag, this.props, value);
  },
  defaultCatch: function(error) {
    return React.createElement(this.props.tag, this.props, error.toString());
  }
});


},{"../lib/handle-prop-changes":104,"react":"react"}],87:[function(require,module,exports){
var ChangeListener, React;

React = require('react');

ChangeListener = require('./change-listener');

module.exports = React.createClass({
  displayName: 'RetirementRulesEditor',
  getDefaultProps: function() {
    return {
      workflow: null
    };
  },
  getInitialState: function() {
    return {
      saveError: null,
      saveInProgress: false
    };
  },
  defaultCriteria: 'classification_count',
  defaultOptions: {
    classification_count: {
      count: 15
    }
  },
  render: function() {
    return React.createElement(ChangeListener, {
      "target": this.props.workflow
    }, ((function(_this) {
      return function() {
        var criteria, options, ref, ref1, ref2, ref3;
        criteria = (ref = (ref1 = _this.props.workflow.retirement) != null ? ref1.criteria : void 0) != null ? ref : _this.defaultCriteria;
        options = (ref2 = (ref3 = _this.props.workflow.retirement) != null ? ref3.options : void 0) != null ? ref2 : _this.defaultOptions[criteria];
        return React.createElement("span", {
          "className": "retirement-rules-editor"
        }, React.createElement("select", {
          "ref": "criteriaSelect",
          "value": criteria,
          "disabled": true,
          "onChange": _this.handleChangeCriteria
        }, React.createElement("option", {
          "value": "classification_count"
        }, "Classification count")), ' ', ((function() {
          switch (criteria) {
            case 'classification_count':
              return React.createElement("input", {
                "type": "number",
                "name": "count",
                "value": options.count,
                "min": "1",
                "max": "100",
                "step": "1",
                "onChange": this.handleChangeOption
              });
          }
        }).call(_this)));
      };
    })(this)));
  },
  handleChangeCriteria: function(e) {
    return this.props.workflow.update({
      'retirement.criteria': e.target.value,
      'retirement.options': this.defaultOptions[e.target.value]
    });
  },
  handleChangeOption: function(e) {
    var newOptionsData, ref, ref1, ref2, updateKey;
    this.props.workflow.update({
      'retirement.criteria': (ref = (ref1 = this.props.workflow.retirement) != null ? ref1.criteria : void 0) != null ? ref : this.defaultCriteria
    });
    this.props.workflow.update({
      'retirement.options': (ref2 = this.props.workflow.retirement.options) != null ? ref2 : this.defaultOptions[this.props.workflow.retirement.criteria]
    });
    updateKey = "retirement.options." + e.target.name;
    newOptionsData = {};
    newOptionsData[updateKey] = e.target.type === 'number' ? parseFloat(e.target.value) : e.target.value;
    return this.props.workflow.update(newOptionsData);
  }
});


},{"./change-listener":63,"react":"react"}],88:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'SingleSubmitButton',
  getDefaultProps: function() {
    return {
      className: '',
      disabled: false,
      type: 'button',
      onClick: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      disabled: this.props.disabled
    };
  },
  onClick: function(e) {
    var promise;
    this.setState({
      disabled: true
    });
    promise = this.props.onClick(e);
    if (promise) {
      return promise.then((function(_this) {
        return function() {
          return _this.setState({
            disabled: false
          });
        };
      })(this));
    } else {
      return this.setState({
        disabled: false
      });
    }
  },
  render: function() {
    return React.createElement("button", {
      "type": this.props.type,
      "disabled": (this.state.disabled ? 'disabled' : void 0),
      "className": "single-submit-button " + this.props.className,
      "onClick": this.onClick
    }, this.props.children);
  }
});


},{"react":"react"}],89:[function(require,module,exports){
var React, ReactSwipe,
  modulo = function(a, b) { return (+a % (b = +b) + b) % b; };

React = require('react');

ReactSwipe = require('react-swipe');

module.exports = React.createClass({displayName: "exports",
  propTypes: {
    defaultStep: React.PropTypes.number
  },
  getDefaultProps: function() {
    return {
      defaultStep: 0
    };
  },
  getInitialState: function() {
    return {
      render: false,
      step: this.props.defaultStep
    };
  },
  componentDidMount: function() {
    return this.refs.swiper.swipe.setup();
  },
  render: function() {
    var childrenCount, i;
    childrenCount = React.Children.count(this.props.children);
    return React.createElement("div", React.__spread({
      "className": "step-through"
    }, this.props), React.createElement(ReactSwipe, {
      "ref": "swiper",
      "className": "step-through-content",
      "startSlide": this.state.step,
      "continuous": false,
      "callback": this.handleStep.bind(this, childrenCount)
    }, this.props.children), (childrenCount !== 1 ? React.createElement("div", {
      "className": "step-through-controls",
      "style": {
        position: 'relative'
      }
    }, React.createElement("button", {
      "type": "button",
      "className": "step-through-direction step-through-previous",
      "aria-label": "Previous step",
      "title": "Previous",
      "disabled": this.state.step === 0,
      "onClick": this.goPrevious
    }, ""), React.createElement("span", {
      "className": "step-through-pips"
    }, (function() {
      var j, ref, results;
      results = [];
      for (i = j = 0, ref = childrenCount - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
        results.push(React.createElement("label", {
          "key": i,
          "className": "step-through-pip",
          "title": "Step " + (i + 1)
        }, React.createElement("input", {
          "type": "radio",
          "className": "step-through-pip-input",
          "aria-label": "Step " + (i + 1) + " of " + childrenCount,
          "checked": i === this.state.step,
          "autoFocus": i === this.state.step,
          "onChange": this.goTo.bind(this, i)
        }), React.createElement("span", {
          "className": "step-through-pip-number"
        }, i + 1)));
      }
      return results;
    }).call(this)), React.createElement("button", {
      "type": "button",
      "className": "step-through-direction step-through-next",
      "aria-label": "Next step",
      "title": "Next",
      "disabled": this.state.step === childrenCount - 1,
      "onClick": this.goNext
    }, "")) : void 0));
  },
  goPrevious: function() {
    return this.refs.swiper.swipe.prev();
  },
  goNext: function() {
    return this.refs.swiper.swipe.next();
  },
  goTo: function(index) {
    return this.refs.swiper.swipe.slide(index);
  },
  handleStep: function(total, index) {
    return this.setState({
      step: modulo(index, total)
    });
  }
});


},{"react":"react","react-swipe":"react-swipe"}],90:[function(require,module,exports){
var CONTAINER_STYLE, CollectionsManagerIcon, FavoritesButton, FlagSubjectButton, FrameViewer, Markdown, NOOP, React, alert, classnames, getSubjectLocation, subjectHasMixedLocationTypes,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
  modulo = function(a, b) { return (+a % (b = +b) + b) % b; };

React = require('react');

FavoritesButton = require('../collections/favorites-button');

alert = require('../lib/alert');

Markdown = require('markdownz').Markdown;

getSubjectLocation = require('../lib/get-subject-location');

CollectionsManagerIcon = require('../collections/manager-icon');

FrameViewer = require('./frame-viewer');

classnames = require('classnames');

FlagSubjectButton = require('./flag-subject-button');

NOOP = Function.prototype;

subjectHasMixedLocationTypes = function(subject) {
  var allTypes, ref;
  allTypes = [];
  ((ref = subject != null ? subject.locations : void 0) != null ? ref : []).forEach(function(location) {
    return Object.keys(location).forEach(function(typeAndFormat) {
      var type;
      type = typeAndFormat.split('/')[0];
      if (indexOf.call(allTypes, type) < 0) {
        return allTypes.push(type);
      }
    });
  });
  return allTypes.length > 1;
};

CONTAINER_STYLE = {
  display: 'flex',
  flexWrap: 'wrap',
  position: 'relative'
};

module.exports = React.createClass({
  displayName: 'SubjectViewer',
  getDefaultProps: function() {
    return {
      subject: null,
      user: null,
      playFrameDuration: 667,
      playIterations: 3,
      onFrameChange: NOOP,
      onLoad: NOOP,
      defaultStyle: true,
      project: null,
      linkToFullImage: false,
      frameWrapper: null,
      allowFlipbook: true,
      allowSeparateFrames: false
    };
  },
  getInitialState: function() {
    var ref;
    return {
      loading: true,
      playing: false,
      frame: (ref = this.props.frame) != null ? ref : 0,
      frameDimensions: {},
      inFlipbookMode: this.props.allowFlipbook
    };
  },
  willReceiveProps: function(nextProps) {
    if (typeof nextProps.allowFlipbook === 'boolean') {
      return this.setState({
        inFlipbookMode: allowFlipbook
      });
    }
  },
  render: function() {
    var format, frame, i, mainDisplay, obj, ref, ref1, ref10, ref2, ref3, ref4, ref5, ref6, ref7, ref8, ref9, rootClasses, rootStyle, src, tools, type;
    rootClasses = classnames('subject-viewer', (
      obj = {
        'default-root-style': this.props.defaultStyle,
        'subject-viewer--flipbook': this.state.inFlipbookMode
      },
      obj["subject-viewer--layout-" + ((ref2 = this.props.workflow) != null ? (ref3 = ref2.configuration) != null ? ref3.multi_image_layout : void 0 : void 0)] = (ref = this.props.workflow) != null ? (ref1 = ref.configuration) != null ? ref1.multi_image_layout : void 0 : void 0,
      obj
    ));
    if (indexOf.call(window, "ActiveXObject") >= 0 || window.ActiveXObject !== void 0) {
      rootStyle = {
        flex: "1 1 auto"
      };
    }
    mainDisplay = '';
    ref4 = getSubjectLocation(this.props.subject, this.state.frame), type = ref4.type, format = ref4.format, src = ref4.src;
    if (this.state.inFlipbookMode) {
      mainDisplay = this.renderFrame(this.state.frame);
    } else {
      mainDisplay = (function() {
        var results;
        results = [];
        for (frame in this.props.subject.locations) {
          results.push(this.renderFrame(frame, {
            key: "frame-" + frame
          }));
        }
        return results;
      }).call(this);
    }
    tools = (function() {
      var ref5, ref6;
      switch (type) {
        case 'image':
          if (!this.state.inFlipbookMode || ((ref5 = this.props.subject) != null ? ref5.locations.length : void 0) < 2 || subjectHasMixedLocationTypes(this.props.subject)) {
            if (this.props.allowFlipbook && this.props.allowSeparateFrames) {
              return React.createElement("button", {
                "aria-label": "Toggle flipbook mode",
                "title": "Toggle flipbook mode",
                "className": "flipbook-toggle",
                "onClick": this.toggleInFlipbookMode
              }, React.createElement("i", {
                "className": "fa fa-fw " + (this.state.inFlipbookMode ? "fa-th-large" : "fa-film")
              }));
            }
          } else {
            return React.createElement("span", {
              "className": "tools"
            }, (this.props.allowFlipbook && this.props.allowSeparateFrames ? React.createElement("button", {
              "aria-label": "Toggle flipbook mode",
              "title": "Toggle flipbook mode",
              "className": "flipbook-toggle",
              "onClick": this.toggleInFlipbookMode
            }, React.createElement("i", {
              "className": "fa fa-fw " + (this.state.inFlipbookMode ? "fa-th-large" : "fa-film")
            })) : void 0), (!this.state.inFlipbookMode || ((ref6 = this.props.subject) != null ? ref6.locations.length : void 0) < 2 || subjectHasMixedLocationTypes(this.props.subject) ? null : React.createElement("span", {
              "className": "subject-frame-play-controls"
            }, (this.state.playing ? React.createElement("button", {
              "aria-label": "Pause",
              "title": "Pause",
              "type": "button",
              "className": "secret-button",
              "onClick": this.setPlaying.bind(this, false)
            }, React.createElement("i", {
              "className": "fa fa-pause fa-fw"
            })) : React.createElement("button", {
              "aria-label": "Play",
              "title": "Play",
              "type": "button",
              "className": "secret-button",
              "onClick": this.setPlaying.bind(this, true)
            }, React.createElement("i", {
              "className": "fa fa-play fa-fw"
            }))))));
          }
      }
    }).call(this);
    return React.createElement("div", {
      "className": rootClasses,
      "style": rootStyle
    }, (type === 'image' ? this.hiddenPreloadedImages() : void 0), React.createElement("div", {
      "className": "subject-container",
      "style": CONTAINER_STYLE
    }, mainDisplay, this.props.children), React.createElement("div", {
      "className": "subject-tools"
    }, React.createElement("span", null, tools), (((ref5 = this.props.subject) != null ? ref5.locations.length : void 0) >= 2 && this.state.inFlipbookMode ? React.createElement("span", null, React.createElement("span", {
      "className": "subject-frame-pips"
    }, (function() {
      var j, ref6, ref7, ref8, results;
      results = [];
      for (i = j = 0, ref6 = (ref7 = (ref8 = this.props.subject) != null ? ref8.locations.length : void 0) != null ? ref7 : 0; 0 <= ref6 ? j < ref6 : j > ref6; i = 0 <= ref6 ? ++j : --j) {
        results.push(React.createElement("button", {
          "type": "button",
          "key": i,
          "className": "subject-frame-pip " + (i === this.state.frame ? 'active' : ''),
          "value": i,
          "onClick": this.handleFrameChange.bind(this, i)
        }, i + 1));
      }
      return results;
    }).call(this))) : void 0), React.createElement("span", null, (((ref6 = this.props.workflow) != null ? (ref7 = ref6.configuration) != null ? ref7.enable_subject_flags : void 0 : void 0) ? React.createElement(FlagSubjectButton, {
      "classification": this.props.classification
    }) : void 0), (((ref8 = this.props.subject) != null ? ref8.metadata : void 0) != null ? React.createElement("button", {
      "type": "button",
      "aria-label": "Metadata",
      "title": "Metadata",
      "className": "metadata-toggle",
      "onClick": this.showMetadata
    }, React.createElement("i", {
      "className": "fa fa-info-circle fa-fw"
    })) : void 0), ((this.props.subject != null) && (this.props.user != null) && (this.props.project != null) ? React.createElement("span", null, (!((ref9 = this.props.workflow) != null ? (ref10 = ref9.configuration) != null ? ref10.disable_favorites : void 0 : void 0) ? React.createElement(FavoritesButton, {
      "project": this.props.project,
      "subject": this.props.subject,
      "user": this.props.user
    }) : void 0), React.createElement(CollectionsManagerIcon, {
      "project": this.props.project,
      "subject": this.props.subject,
      "user": this.props.user
    })) : void 0), (type === 'image' && this.props.linkToFullImage ? React.createElement("a", {
      "className": "button",
      "href": src,
      "aria-label": "Subject Image",
      "title": "Subject Image",
      "target": "zooImage"
    }, React.createElement("i", {
      "className": "fa fa-photo"
    })) : void 0))));
  },
  renderFrame: function(frame, props) {
    if (props == null) {
      props = {};
    }
    return React.createElement(FrameViewer, React.__spread({}, this.props, props, {
      "frame": frame
    }));
  },
  hiddenPreloadedImages: function() {
    var i, src;
    return React.createElement("div", {
      "style": {
        bottom: 0,
        height: 1,
        opacity: 0.1,
        overflow: 'hidden',
        position: 'fixed',
        right: 0,
        width: 1
      }
    }, (function() {
      var j, ref, results;
      results = [];
      for (i = j = 0, ref = this.props.subject.locations.length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
        src = getSubjectLocation(this.props.subject, i).src;
        results.push(React.createElement("img", {
          "key": i,
          "src": src
        }));
      }
      return results;
    }).call(this));
  },
  toggleInFlipbookMode: function() {
    return this.setInFlipbookMode(!this.state.inFlipbookMode);
  },
  setInFlipbookMode: function(inFlipbookMode) {
    return this.setState({
      inFlipbookMode: inFlipbookMode
    });
  },
  setPlaying: function(playing) {
    var autoStopDelay;
    this.setState({
      playing: playing
    });
    if (playing) {
      this.nextFrame();
      this._playingInterval = setInterval(this.nextFrame, this.props.playFrameDuration);
      autoStopDelay = this.props.subject.locations.length * this.props.playFrameDuration * this.props.playIterations;
      return this._autoStop = setTimeout(this.setPlaying.bind(this, false), autoStopDelay);
    } else {
      clearInterval(this._playingInterval);
      return clearTimeout(this._autoStop);
    }
  },
  nextFrame: function() {
    return this.handleFrameChange(modulo(this.state.frame + 1, this.props.subject.locations.length));
  },
  handleFrameChange: function(frame) {
    this.setState({
      frame: frame
    });
    return this.props.onFrameChange(frame);
  },
  showMetadata: function() {
    var key, value;
    return alert(React.createElement("div", {
      "className": "content-container"
    }, React.createElement("header", {
      "className": "form-label",
      "style": {
        textAlign: 'center'
      }
    }, "Subject metadata"), React.createElement("hr", null), React.createElement("table", {
      "className": "standard-table"
    }, React.createElement("tbody", null, (function() {
      var ref, ref1, results;
      ref1 = (ref = this.props.subject) != null ? ref.metadata : void 0;
      results = [];
      for (key in ref1) {
        value = ref1[key];
        if (key.charAt(0) !== '#' && key.slice(0, 2) !== '//') {
          results.push(React.createElement("tr", {
            "key": key
          }, React.createElement("th", null, key), React.createElement(Markdown, {
            "tag": "td",
            "content": value,
            "inline": true
          })));
        }
      }
      return results;
    }).call(this)))));
  }
});


},{"../collections/favorites-button":54,"../collections/manager-icon":56,"../lib/alert":98,"../lib/get-subject-location":102,"./flag-subject-button":74,"./frame-viewer":75,"classnames":"classnames","markdownz":"markdownz","react":"react"}],91:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'SVGImage',
  componentDidMount: function() {
    this.setHref();
    return this.fixWeirdSize();
  },
  render: function() {
    return React.createElement("image", React.__spread({
      "ref": "image"
    }, this.props));
  },
  componentDidUpdate: function() {
    this.setHref();
    return this.fixWeirdSize();
  },
  fixWeirdSize: function() {
    var image;
    image = this.refs.image;
    if ((this.props.width != null) && image.width !== this.props.width) {
      image.setAttribute('width', this.props.width);
    }
    if ((this.props.height != null) && image.height !== this.props.height) {
      return image.setAttribute('height', this.props.height);
    }
  },
  setHref: function() {
    var image;
    image = this.refs.image;
    return image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', this.props.src);
  }
});


},{"react":"react"}],92:[function(require,module,exports){
var React, Select, apiClient, debounce;

React = require('react');

Select = require('react-select');

apiClient = require('panoptes-client/lib/api-client');

debounce = require('debounce');

module.exports = React.createClass({
  displayName: 'TagSearch',
  getDefaultProps: function() {
    return {
      multi: true
    };
  },
  searchTags: function(value, callback) {
    if (value === '') {
      return callback(null, {});
    } else {
      return apiClient.type('tags').get({
        search: "" + value,
        page_size: 10
      }).then((function(_this) {
        return function(tags) {
          var opts, tag;
          opts = (function() {
            var i, len, results;
            results = [];
            for (i = 0, len = tags.length; i < len; i++) {
              tag = tags[i];
              results.push({
                value: tag.name,
                label: tag.name
              });
            }
            return results;
          })();
          return {
            options: opts
          };
        };
      })(this));
    }
  },
  saveCurrent: function(arg) {
    var target, value;
    target = arg.target;
    value = target.value;
    if (value !== '') {
      return this.refs.tagSearch.addValue(value);
    }
  },
  handleInputChange: function(value) {
    if (value.slice("-1") === ",") {
      return this.refs.tagSearch.addValue(value.slice(0, -1));
    }
  },
  render: function() {
    var value;
    value = this.props.value.join(',');
    return React.createElement(Select, {
      "ref": "tagSearch",
      "multi": this.props.multi,
      "name": this.props.name,
      "value": value,
      "placeholder": "Tags:",
      "className": "search standard-input",
      "closeAfterClick": false,
      "onBlur": this.saveCurrent,
      "onChange": this.props.onChange,
      "onInputChange": this.handleInputChange,
      "asyncOptions": debounce(this.searchTags, 200)
    });
  }
});


},{"debounce":"debounce","panoptes-client/lib/api-client":549,"react":"react","react-select":"react-select"}],93:[function(require,module,exports){
var MAX_THUMBNAIL_DIMENSION, React;

React = require('react');

MAX_THUMBNAIL_DIMENSION = 999;

module.exports = React.createClass({
  displayName: 'Thumbnail',
  getDefaultProps: function() {
    return {
      src: '',
      width: MAX_THUMBNAIL_DIMENSION,
      height: MAX_THUMBNAIL_DIMENSION,
      origin: 'https://thumbnails.zooniverse.org'
    };
  },
  getInitialState: function() {
    return {
      failed: false
    };
  },
  getThumbnailSrc: function(arg) {
    var height, origin, src, srcPath, width;
    origin = arg.origin, width = arg.width, height = arg.height, src = arg.src;
    srcPath = src.split('//').pop();
    return origin + "/" + width + "x" + height + "/" + srcPath;
  },
  render: function() {
    var dimensions, src, style;
    src = this.state.failed ? this.props.src : this.getThumbnailSrc(this.props);
    dimensions = {
      width: null,
      height: null
    };
    style = {
      maxWidth: this.props.width,
      maxHeight: this.props.height
    };
    return React.createElement("img", React.__spread({}, this.props, {
      "src": src
    }, dimensions, {
      "style": style,
      "onError": this.handleError
    }));
  },
  handleError: function() {
    if (!this.state.failed) {
      return this.setState({
        failed: true
      });
    }
  }
});


},{"react":"react"}],94:[function(require,module,exports){
var HIDDEN_INPUT_STYLE, NOOP, React;

React = require('react');

NOOP = Function.prototype;

HIDDEN_INPUT_STYLE = {
  height: 0,
  opacity: 0,
  position: 'absolute',
  width: 0
};

module.exports = React.createClass({
  displayName: 'UploadDropTarget',
  getDefaultProps: function() {
    return {
      accept: 'text/plain',
      multiple: false,
      onSelect: NOOP
    };
  },
  getInitialState: function() {
    return {
      active: false
    };
  },
  eventsToMakeDropWork: function() {
    return {
      onDragEnter: this.handleDrag.bind(this, true),
      onDragExit: this.handleDrag.bind(this, false),
      onDragOver: this.handleDrag.bind(this, null)
    };
  },
  render: function() {
    var ref;
    return React.createElement("label", React.__spread({
      "className": "upload-drop-target",
      "data-active": (ref = this.state.active) != null ? ref : null,
      "style": {
        position: 'relative'
      }
    }, this.eventsToMakeDropWork(), {
      "onDrop": this.handleDrop
    }), React.createElement("input", {
      "type": "file",
      "accept": this.props.accept,
      "multiple": this.props.multiple,
      "onChange": this.handleFileSelection,
      "style": HIDDEN_INPUT_STYLE
    }), this.props.children);
  },
  handleDrag: function(enter, e) {
    e.stopPropagation();
    e.preventDefault();
    if (enter != null) {
      return this.setState({
        active: enter
      });
    }
  },
  handleDrop: function(e) {
    e.stopPropagation();
    e.preventDefault();
    this.props.onSelect(e.dataTransfer.files);
    return this.setState({
      active: false
    });
  },
  handleFileSelection: function(e) {
    return this.props.onSelect(e.target.files);
  }
});


},{"react":"react"}],95:[function(require,module,exports){
var React, Select, apiClient, delayBy;

React = require('react');

Select = require('react-select');

apiClient = require('panoptes-client/lib/api-client');

delayBy = function(timeout, fn) {
  return setTimeout(fn, timeout);
};

module.exports = React.createClass({
  displayName: 'UserSearch',
  getDefaultProps: function() {
    return {
      multi: true,
      debounce: 200
    };
  },
  queryTimeout: NaN,
  searchUsers: function(value) {
    clearTimeout(this.queryTimeout);
    if (value === '') {
      return Promise.resolve({
        options: []
      });
    } else {
      return new Promise((function(_this) {
        return function(resolve) {
          return _this.queryTimeout = delayBy(_this.props.debounce, function() {
            return apiClient.type('users').get({
              search: value,
              page_size: 10
            }).then(function(users) {
              var i, len, results, user;
              results = [];
              for (i = 0, len = users.length; i < len; i++) {
                user = users[i];
                results.push({
                  value: user.id,
                  label: "@" + user.login + ": " + user.display_name
                });
              }
              return results;
            }).then(function(options) {
              return resolve({
                options: options
              });
            });
          });
        };
      })(this));
    }
  },
  render: function() {
    return React.createElement(Select, {
      "multi": this.props.multi,
      "name": "userids",
      "placeholder": "Username:",
      "searchPromptText": "Type to search Users",
      "className": "search standard-input",
      "closeAfterClick": true,
      "matchProp": 'label',
      "asyncOptions": this.searchUsers
    });
  }
});


},{"panoptes-client/lib/api-client":549,"react":"react","react-select":"react-select"}],96:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: "VideoPlayer",
  getInitialState: function() {
    return {
      playing: false,
      playbackRate: 1
    };
  },
  componentDidMount: function() {
    var ref;
    return (ref = this.refs.videoScrubber) != null ? ref.value = 0 : void 0;
  },
  componentDidUpdate: function() {
    var ref;
    return (ref = this.refs.videoPlayer) != null ? ref.playbackRate = this.state.playbackRate : void 0;
  },
  playVideo: function(playing) {
    var player;
    player = this.refs.videoPlayer;
    if (player == null) {
      return;
    }
    this.setState({
      playing: playing
    });
    if (playing) {
      return player.play();
    } else {
      return player.pause();
    }
  },
  setPlayRate: function(e) {
    return this.setState({
      playbackRate: parseFloat(e.target.value)
    });
  },
  seekVideo: function() {
    var player, scrubber, time;
    player = this.refs.videoPlayer;
    scrubber = this.refs.videoScrubber;
    time = scrubber.value;
    return player.currentTime = time;
  },
  endVideo: function() {
    return this.setState({
      playing: false
    });
  },
  updateScrubber: function() {
    var player, scrubber;
    player = this.refs.videoPlayer;
    scrubber = this.refs.videoScrubber;
    if (!scrubber.getAttribute('max')) {
      scrubber.setAttribute('max', player.duration);
    }
    return scrubber.value = player.currentTime;
  },
  render: function() {
    var i, rate;
    return React.createElement("div", {
      "className": "subject-video-frame"
    }, React.createElement("video", {
      "className": "subject",
      "ref": "videoPlayer",
      "src": this.props.src,
      "type": this.props.type + "/" + this.props.format,
      "preload": "auto",
      "onCanPlay": this.props.onLoad,
      "onEnded": this.endVideo,
      "onTimeUpdate": this.updateScrubber
    }, "Your browser does not support the video format. Please upgrade your browser."), React.createElement("span", {
      "className": "subject-video-controls"
    }, React.createElement("span", {
      "className": "subject-frame-play-controls"
    }, (this.state.playing ? React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "aria-label": "Pause",
      "onClick": this.playVideo.bind(this, false)
    }, React.createElement("i", {
      "className": "fa fa-pause fa-fw"
    })) : React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "aria-label": "Play",
      "onClick": this.playVideo.bind(this, true)
    }, React.createElement("i", {
      "className": "fa fa-play fa-fw"
    })))), React.createElement("input", {
      "type": "range",
      "className": "video-scrubber",
      "ref": "videoScrubber",
      "min": "0",
      "step": "any",
      "onChange": this.seekVideo
    }), React.createElement("span", {
      "className": "video-speed"
    }, "Speed:", (function() {
      var j, len, ref, results;
      ref = [0.25, 0.5, 1];
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        rate = ref[i];
        results.push(React.createElement("label", {
          "key": "rate-" + i,
          "className": "secret-button"
        }, React.createElement("input", {
          "type": "radio",
          "name": "playRate" + this.props.frame,
          "value": rate,
          "checked": rate === this.state.playbackRate,
          "onChange": this.setPlayRate
        }), React.createElement("span", null, rate, "")));
      }
      return results;
    }).call(this))), this.props.children);
  }
});


},{"react":"react"}],97:[function(require,module,exports){
var AnswerEditor, ChangeListener, DrawingTaskEditor, QuestionTaskEditor, React, TaskEditor, ToolEditor, handleInputChange;

React = require('react');

ChangeListener = require('./change-listener');

handleInputChange = require('../lib/handle-input-change');

AnswerEditor = React.createClass({
  displayName: 'AnswerEditor',
  render: function() {
    var key, nextValue, ref, ref1, task;
    return React.createElement("div", {
      "className": "answer"
    }, React.createElement("div", {
      "className": "controls"
    }, React.createElement("button", {
      "type": "button",
      "className": "delete-answer",
      "onClick": this.props.remove
    }, "")), React.createElement("label", null, React.createElement("span", {
      "className": "field-label"
    }, "Label"), React.createElement("br", null), React.createElement("textarea", {
      "name": "tasks." + this.props.taskKey + ".answers." + this.props.answerIndex + ".label",
      "value": this.props.answer.label,
      "onChange": handleInputChange.bind(this.props.workflow),
      "rows": "1",
      "style": {
        width: '100%'
      }
    })), React.createElement("br", null), React.createElement("div", {
      "className": "answer-properties"
    }, (this.props.task.type === 'single' ? React.createElement("span", null, React.createElement("label", null, (nextValue = (ref = (ref1 = this.props.answer.next) != null ? ref1 : JSON.stringify(this.props.answer.next)) != null ? ref : 'undefined', null), "Next task ", React.createElement("select", {
      "name": "tasks." + this.props.taskKey + ".answers." + this.props.answerIndex + ".next",
      "value": nextValue,
      "onChange": handleInputChange.bind(this.props.workflow)
    }, React.createElement("option", {
      "value": "undefined",
      "data-delete-value": true
    }, "(Next in line)"), (function() {
      var ref2, ref3, results;
      ref2 = this.props.workflow.tasks;
      results = [];
      for (key in ref2) {
        task = ref2[key];
        results.push(React.createElement("option", {
          "key": key,
          "value": key
        }, (((ref3 = task.question) != null ? ref3 : task.instruction) || '  ') + " (" + key + ")"));
      }
      return results;
    }).call(this), React.createElement("option", {
      "value": "null",
      "data-json-value": true
    }, "(End classification)")))) : void 0)));
  }
});

QuestionTaskEditor = React.createClass({
  displayName: 'QuestionTaskEditor',
  render: function() {
    var answer, i;
    return React.createElement("div", null, React.createElement("label", null, React.createElement("span", {
      "className": "field-label"
    }, "Question"), React.createElement("br", null), React.createElement("textarea", {
      "name": "tasks." + this.props.taskKey + ".question",
      "value": this.props.task.question,
      "onChange": handleInputChange.bind(this.props.workflow),
      "rows": "2",
      "style": {
        width: '100%'
      }
    })), React.createElement("br", null), React.createElement("span", {
      "className": "field-label"
    }, "Answers"), React.createElement("label", {
      "className": "inline-input"
    }, React.createElement("input", {
      "type": "checkbox",
      "checked": this.props.task.type === 'multiple' || null,
      "onChange": this.handleChangeMultiple
    }), "Allow multiple"), React.createElement("br", null), React.createElement("div", {
      "className": "answers-list"
    }, (function() {
      var j, len, ref, ref1, results;
      ref1 = (ref = this.props.task.answers) != null ? ref : [];
      results = [];
      for (i = j = 0, len = ref1.length; j < len; i = ++j) {
        answer = ref1[i];
        results.push(React.createElement(AnswerEditor, React.__spread({
          "key": i
        }, this.props, {
          "answerIndex": i,
          "answer": answer,
          "remove": this.removeAnswer.bind(this, i)
        })));
      }
      return results;
    }).call(this), React.createElement("div", {
      "className": "adder-container"
    }, React.createElement("button", {
      "type": "button",
      "className": "adder",
      "onClick": this.addAnswer
    }, "Add a new answer"))));
  },
  handleChangeMultiple: function(e) {
    this.props.task.type = e.target.checked ? 'multiple' : 'single';
    return this.props.workflow.update('tasks');
  },
  addAnswer: function() {
    var base;
    if ((base = this.props.task).answers == null) {
      base.answers = [];
    }
    this.props.task.answers.push({
      label: '',
      next: null
    });
    return this.props.workflow.update('tasks');
  },
  removeAnswer: function(index) {
    this.props.task.answers.splice(index, 1);
    return this.props.workflow.update('tasks');
  }
});

ToolEditor = React.createClass({
  displayName: 'ToolEditor',
  render: function() {
    return React.createElement("div", {
      "className": "answer"
    }, React.createElement("div", {
      "className": "controls"
    }, React.createElement("button", {
      "type": "button",
      "className": "delete-answer",
      "onClick": this.props.remove
    }, "")), React.createElement("label", null, React.createElement("span", {
      "className": "field-label"
    }, "Label"), React.createElement("br", null), React.createElement("textarea", {
      "name": "tasks." + this.props.taskKey + ".tools." + this.props.toolIndex + ".label",
      "value": this.props.tool.label,
      "onChange": handleInputChange.bind(this.props.workflow),
      "rows": "1",
      "style": {
        width: '100%'
      }
    })), React.createElement("br", null), React.createElement("div", {
      "className": "answer-properties"
    }, React.createElement("span", null, React.createElement("label", null, "Shape ", React.createElement("select", {
      "name": "tasks." + this.props.taskKey + ".tools." + this.props.toolIndex + ".shape",
      "value": this.props.tool.shape,
      "onChange": handleInputChange.bind(this.props.workflow)
    }, React.createElement("option", {
      "value": "point"
    }, "Point"), React.createElement("option", {
      "value": "ellipse"
    }, "Ellipse")))), React.createElement("span", null, React.createElement("label", null, "Color ", React.createElement("select", {
      "name": "tasks." + this.props.taskKey + ".tools." + this.props.toolIndex + ".color",
      "value": this.props.tool.color,
      "onChange": handleInputChange.bind(this.props.workflow)
    }, React.createElement("option", {
      "value": ""
    }, "(Default)"), React.createElement("option", {
      "value": "#f00"
    }, "Red"), React.createElement("option", {
      "value": "#ff0"
    }, "Yellow"), React.createElement("option", {
      "value": "#0f0"
    }, "Green"), React.createElement("option", {
      "value": "#0ff"
    }, "Cyan"), React.createElement("option", {
      "value": "#00f"
    }, "Blue"), React.createElement("option", {
      "value": "#f0f"
    }, "Magenta"))))));
  }
});

DrawingTaskEditor = React.createClass({
  displayName: 'DrawingTaskEditor',
  render: function() {
    var i, tool;
    return React.createElement("div", null, React.createElement("label", null, React.createElement("span", {
      "className": "field-label"
    }, "Instruction"), React.createElement("br", null), React.createElement("textarea", {
      "name": "tasks." + this.props.taskKey + ".instruction",
      "value": this.props.task.instruction,
      "onChange": handleInputChange.bind(this.props.workflow),
      "rows": "2",
      "style": {
        width: '100%'
      }
    })), React.createElement("br", null), React.createElement("span", {
      "className": "field-label"
    }, "Features to mark"), React.createElement("br", null), React.createElement("div", {
      "className": "answers-list"
    }, (function() {
      var j, len, ref, ref1, results;
      ref1 = (ref = this.props.task.tools) != null ? ref : [];
      results = [];
      for (i = j = 0, len = ref1.length; j < len; i = ++j) {
        tool = ref1[i];
        results.push(React.createElement(ToolEditor, React.__spread({
          "key": i
        }, this.props, {
          "toolIndex": i,
          "tool": tool,
          "remove": this.removeTool.bind(this, i)
        })));
      }
      return results;
    }).call(this), React.createElement("div", {
      "className": "adder-container"
    }, React.createElement("button", {
      "type": "button",
      "className": "adder",
      "onClick": this.addTool
    }, "Add a new tool"))));
  },
  addTool: function() {
    var base;
    if ((base = this.props.task).tools == null) {
      base.tools = [];
    }
    this.props.task.tools.push({
      label: '',
      shape: 'point',
      color: null
    });
    return this.props.workflow.update('tasks');
  },
  removeTool: function(index) {
    this.props.task.tools.splice(index, 1);
    return this.props.workflow.update('tasks');
  }
});

TaskEditor = React.createClass({
  displayName: 'TaskEditor',
  render: function() {
    var TaskComponent, task;
    task = this.props.workflow.tasks[this.props.taskKey];
    TaskComponent = (function() {
      switch (task.type) {
        case 'single':
        case 'multiple':
          return QuestionTaskEditor;
        case 'drawing':
          return DrawingTaskEditor;
      }
    })();
    return React.createElement("div", {
      "className": "task"
    }, React.createElement("div", {
      "className": "controls"
    }, this.props.taskKey, " ", React.createElement("button", {
      "type": "button",
      "onClick": this.props.remove
    }, "")), React.createElement(TaskComponent, React.__spread({}, this.props, {
      "task": task
    })));
  }
});

module.exports = React.createClass({
  displayName: 'WorkflowEditor',
  statics: {
    willTransitionFrom: function(transition, component) {
      if (component.props.workflow.hasUnsavedChanges()) {
        transition.abort();
        if (confirm('You have unsaved changes that will be lost forever. Do you really want to leave the workflow editor?')) {
          return transition.retry();
        }
      }
    }
  },
  getDefaultProps: function() {
    var apiClient;
    apiClient = require('panoptes-client/lib/api-client');
    return {
      workflow: apiClient.type('workflows-for-dev-only').create({
        display_name: 'Test workflow',
        tasks: {
          cool: {
            type: 'single',
            question: 'Cool?',
            answers: [
              {
                label: 'Yep'
              }
            ]
          }
        },
        first_task: 'cool'
      })
    };
  },
  getInitialState: function() {
    return {
      view: 'editor'
    };
  },
  render: function() {
    return React.createElement(ChangeListener, {
      "target": this.props.workflow,
      "eventName": "change",
      "handler": this.renderWorkflow
    });
  },
  renderWorkflow: function() {
    var view;
    window.workflow = this.props.workflow;
    view = (function() {
      switch (this.state.view) {
        case 'editor':
          return this.renderEditor;
        case 'code':
          return this.renderCode;
      }
    }).call(this);
    return React.createElement("div", {
      "className": "workflow-editor-container"
    }, React.createElement("div", {
      "className": "controls"
    }, React.createElement("button", {
      "onClick": this.setState.bind(this, {
        view: 'editor'
      }, null)
    }, React.createElement("i", {
      "className": "fa fa-pencil fa-fw"
    })), React.createElement("button", {
      "onClick": this.setState.bind(this, {
        view: 'code'
      }, null)
    }, React.createElement("i", {
      "className": "fa fa-code fa-fw"
    }))), React.createElement("br", null), view());
  },
  renderEditor: function() {
    var taskKey;
    return React.createElement("div", {
      "className": "workflow-editor"
    }, React.createElement("div", {
      "className": "task-list"
    }, (function() {
      var j, len, ref, results;
      ref = this.getTaskKeysInOrder();
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        taskKey = ref[j];
        results.push(React.createElement(TaskEditor, {
          "key": taskKey,
          "taskKey": taskKey,
          "workflow": this.props.workflow,
          "remove": this.removeTask.bind(this, taskKey)
        }));
      }
      return results;
    }).call(this)), React.createElement("span", {
      "className": "field-label"
    }, "Add a new task"), React.createElement("br", null), React.createElement("div", {
      "className": "adder-container"
    }, React.createElement("button", {
      "type": "button",
      "className": "adder",
      "onClick": this.addNewTask.bind(this, 'single')
    }, "Question"), React.createElement("button", {
      "type": "button",
      "className": "adder",
      "onClick": this.addNewTask.bind(this, 'drawing')
    }, "Marking"), React.createElement("button", {
      "type": "button",
      "className": "adder",
      "onClick": this.addNewTask.bind(this, 'survey'),
      "disabled": true
    }, "Image survey"), React.createElement("button", {
      "type": "button",
      "className": "adder",
      "onClick": this.addNewTask.bind(this, 'flexibleSurvey'),
      "disabled": true
    }, "Flexible Image Survey")));
  },
  renderCode: function() {
    return React.createElement("div", {
      "className": "workflow-editor-code-view"
    }, React.createElement("pre", null, JSON.stringify(this.props.workflow.tasks, null, 2)));
  },
  getTaskKeysInOrder: function() {
    var key, order;
    order = [];
    key = this.props.workflow.first_task;
    while (key != null) {
      order.push(key);
      key = this.props.workflow.tasks[key].next;
    }
    return order;
  },
  addNewTask: function(type) {
    var base, lastTaskKey, newTaskKey;
    lastTaskKey = this.getTaskKeysInOrder().pop();
    newTaskKey = Math.random().toString(16).split('.')[1];
    if ((base = this.props.workflow).tasks == null) {
      base.tasks = {};
    }
    this.props.workflow.tasks[newTaskKey] = {
      type: type
    };
    if (lastTaskKey != null) {
      this.props.workflow.tasks[lastTaskKey].next = newTaskKey;
    } else {
      this.props.workflow.first_task = newTaskKey;
    }
    return this.props.workflow.update('tasks');
  },
  removeTask: function(taskKey) {
    var answer, j, key, len, ref, ref1, ref2, task;
    ref = this.props.workflow.tasks;
    for (key in ref) {
      task = ref[key];
      if (task.next === taskKey) {
        delete task.next;
      }
      if (task.answers != null) {
        ref1 = task.answers;
        for (j = 0, len = ref1.length; j < len; j++) {
          answer = ref1[j];
          if (answer.next === taskKey) {
            delete answer.next;
          }
        }
      }
    }
    if (taskKey === this.props.workflow.first_task) {
      this.props.workflow.update({
        first_task: (ref2 = this.props.workflow.tasks[taskKey].next) != null ? ref2 : Object.keys(this.props.workflow.tasks)[0]
      });
    }
    delete this.props.workflow.tasks[taskKey];
    return this.props.workflow.update('tasks');
  }
});


},{"../lib/handle-input-change":103,"./change-listener":63,"panoptes-client/lib/api-client":549,"react":"react"}],98:[function(require,module,exports){
var Dialog, React, ReactDOM;

React = require('react');

ReactDOM = require('react-dom');

Dialog = require('../components/dialog');

module.exports = function(message) {
  var closeButton, container, defer, previousActiveElement, promise, unmount;
  defer = {
    resolve: null,
    reject: null
  };
  promise = new Promise(function(resolve, reject) {
    defer.resolve = resolve;
    return defer.reject = reject;
  });
  if (typeof message === 'function') {
    message = message(defer.resolve, defer.reject);
  }
  container = document.createElement('div');
  container.classList.add('dialog-container');
  document.body.appendChild(container);
  previousActiveElement = document.activeElement;
  closeButton = React.createElement("button", {
    "aria-label": 'Close',
    "onClick": defer.resolve
  }, "");
  ReactDOM.render(React.createElement(Dialog, {
    "className": "alert",
    "controls": closeButton,
    "onEscape": defer.resolve
  }, message), container);
  unmount = function() {
    ReactDOM.unmountComponentAtNode(container);
    container.parentNode.removeChild(container);
    return previousActiveElement != null ? previousActiveElement.focus() : void 0;
  };
  promise.then(unmount, unmount);
  return promise;
};


},{"../components/dialog":69,"react":"react","react-dom":"react-dom"}],99:[function(require,module,exports){
var apiClient;

apiClient = require('panoptes-client/lib/api-client');

module.exports = {
  hasSettingsRole: function() {
    if (this.props.user != null) {
      return apiClient.type('collection_roles').get({
        collection_id: this.props.collection.id,
        user_id: this.props.user.id
      }).then(function(arg) {
        var userRoles;
        userRoles = arg[0];
        return userRoles.roles.some(function(role) {
          return role.match(/owner|collaborator/i);
        });
      })["catch"](function() {
        return false;
      });
    } else {
      return false;
    }
  }
};


},{"panoptes-client/lib/api-client":549}],100:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'Draggable',
  _previousEventCoords: null,
  propTypes: {
    onStart: React.PropTypes.oneOfType([React.PropTypes.func, React.PropTypes.bool]),
    onDrag: React.PropTypes.func,
    onEnd: React.PropTypes.func,
    disabled: React.PropTypes.bool
  },
  render: function() {
    var childProps;
    childProps = {
      className: [this.props.children.props.className, 'draggable'].filter(Boolean).join(' ')
    };
    if (this.props.disabled) {
      Object.assign(childProps, {
        'data-disabled': true
      });
    } else {
      Object.assign(childProps, {
        onMouseDown: this.handleStart,
        onTouchStart: this.handleStart
      });
    }
    return React.cloneElement(this.props.children, childProps);
  },
  _rememberCoords: function(e) {
    return this._previousEventCoords = {
      x: e.pageX,
      y: e.pageY
    };
  },
  handleStart: function(e) {
    var endEvent, moveEvent, ref, ref1, ref2, ref3, startHandler;
    e.preventDefault();
    ref = (function() {
      switch (e.type) {
        case 'mousedown':
          return ['mousemove', 'mouseup'];
        case 'touchstart':
          return ['touchmove', 'touchend'];
      }
    })(), moveEvent = ref[0], endEvent = ref[1];
    e = (ref1 = (ref2 = e.touches) != null ? ref2[0] : void 0) != null ? ref1 : e;
    this._rememberCoords(e);
    document.body.classList.add('dragging');
    addEventListener(moveEvent, this.handleDrag);
    addEventListener(endEvent, this.handleEnd);
    startHandler = (ref3 = this.props.onStart) != null ? ref3 : this.handleDrag;
    if (startHandler) {
      return startHandler(e);
    }
  },
  handleDrag: function(e) {
    var base, d, ref, ref1;
    e = (ref = (ref1 = e.touches) != null ? ref1[0] : void 0) != null ? ref : e;
    d = {
      x: e.pageX - this._previousEventCoords.x,
      y: e.pageY - this._previousEventCoords.y
    };
    if (typeof (base = this.props).onDrag === "function") {
      base.onDrag(e, d);
    }
    return this._rememberCoords(e);
  },
  handleEnd: function(e) {
    var base, endEvent, moveEvent, ref, ref1, ref2;
    ref = (function() {
      switch (e.type) {
        case 'mouseup':
          return ['mousemove', 'mouseup'];
        case 'touchend':
          return ['touchmove', 'touchend'];
      }
    })(), moveEvent = ref[0], endEvent = ref[1];
    e = (ref1 = (ref2 = e.touches) != null ? ref2[0] : void 0) != null ? ref1 : e;
    removeEventListener(moveEvent, this.handleDrag);
    removeEventListener(endEvent, this.handleEnd);
    if (typeof (base = this.props).onEnd === "function") {
      base.onEnd(e);
    }
    this._previousEventCoords = null;
    return document.body.classList.remove('dragging');
  }
});


},{"react":"react"}],101:[function(require,module,exports){
(function (process){
module.exports = process.env.NODE_ENV === 'production' ? ['11', '6', '3', '17'] : ['231', '405', '272', '76'];


}).call(this,require('_process'))
},{"_process":503}],102:[function(require,module,exports){
var READABLE_FORMATS,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

READABLE_FORMATS = {
  image: ['jpeg', 'png', 'svg+xml', 'gif'],
  video: ['mp4']
};

module.exports = function(subject, frame) {
  var format, mimeType, ref, ref1, src, type;
  if (frame == null) {
    frame = 0;
  }
  ref = subject.locations[frame];
  for (mimeType in ref) {
    src = ref[mimeType];
    ref1 = mimeType.split('/'), type = ref1[0], format = ref1[1];
    if (type in READABLE_FORMATS && indexOf.call(READABLE_FORMATS[type], format) >= 0) {
      break;
    }
  }
  return {
    type: type,
    format: format,
    src: src
  };
};


},{}],103:[function(require,module,exports){
module.exports = function(e) {
  var changes, value, valueProperty;
  if (!(typeof this.update === 'function' && typeof this.emit === 'function')) {
    throw new Error('Bind the handleInputChange function to a json-api-client Model instance');
  }
  valueProperty = (function() {
    switch (e.target.type) {
      case 'checkbox':
        return 'checked';
      case 'file':
        return 'files';
      default:
        return 'value';
    }
  })();
  value = e.target[valueProperty];
  if (e.target.dataset.jsonValue) {
    value = JSON.parse(value);
  }
  changes = {};
  changes[e.target.name] = value;
  return this.update(changes);
};


},{}],104:[function(require,module,exports){

/*
  React doesn't fire componentWillReceiveProps for a component's initial props.
  Usually I wish it would.

  React.createClass
    mixins: [HandlePropChanges]

    propChangeHandlers:
      foo: (foo, props) ->
        'This component was mounted with prop foo, or its prop foo changed.'

      'foo.bar.whatever': (whatever, props) ->
        "You can also watch for nested props."

      andAlso: 'givenString'

      givenString: (propValue, props) ->
        'You can assign a prop to a method name to call that method.'
 */
var lookUp;

lookUp = function(path, base) {
  path = path.split('.');
  while (path.length !== 0) {
    base = base[path.shift()];
  }
  return base;
};

module.exports = {
  componentDidMount: function() {
    var error, handler, lookupFailed, path, propValue, ref, results;
    ref = this.propChangeHandlers;
    results = [];
    for (path in ref) {
      handler = ref[path];
      try {
        propValue = lookUp(path, this.props);
      } catch (error) {
        lookupFailed = true;
      }
      if (!lookupFailed) {
        if (typeof handler === 'string') {
          handler = this[handler];
        }
        results.push(handler.call(this, propValue, this.props));
      } else {
        results.push(void 0);
      }
    }
    return results;
  },
  componentWillReceiveProps: function(nextProps) {
    var currentPropValue, error, handler, lookupFailed, nextPropValue, path, ref, results;
    ref = this.propChangeHandlers;
    results = [];
    for (path in ref) {
      handler = ref[path];
      try {
        currentPropValue = lookUp(path, this.props);
        nextPropValue = lookUp(path, nextProps);
      } catch (error) {
        lookupFailed = true;
      }
      if (!(lookupFailed || nextPropValue === currentPropValue)) {
        if (typeof handler === 'string') {
          handler = this[handler];
        }
        results.push(handler.call(this, nextPropValue, nextProps));
      } else {
        results.push(void 0);
      }
    }
    return results;
  }
};


},{}],105:[function(require,module,exports){
var apiClient;

apiClient = require('panoptes-client/lib/api-client');

module.exports = function() {
  return !!apiClient.params.admin;
};


},{"panoptes-client/lib/api-client":549}],106:[function(require,module,exports){
var isInBounds;

isInBounds = function(object, bounds) {
  var notBeyondBottom, notBeyondLeft, notBeyondRight, notBeyondTop;
  notBeyondLeft = object.left + object.width > bounds.left;
  notBeyondRight = object.left < bounds.left + bounds.width;
  notBeyondTop = object.top + object.height > bounds.top;
  notBeyondBottom = object.top < bounds.top + bounds.height;
  return notBeyondLeft && notBeyondRight && notBeyondTop && notBeyondBottom;
};

module.exports = isInBounds;


},{}],107:[function(require,module,exports){
module.exports = function(src) {
  return new Promise(function(resolve, reject) {
    var img;
    img = typeof document !== "undefined" && document !== null ? document.createElement('img') : void 0;
    img.onload = resolve.bind(null, img);
    img.onerror = reject.bind(null, img);
    return img.src = src;
  });
};


},{}],108:[function(require,module,exports){
var config;

config = require('panoptes-client/lib/config');

module.exports = function() {
  var commits, deployed;
  if (typeof fetch === "undefined" || fetch === null) {
    return;
  }
  commits = fetch('https://api.github.com/repos/zooniverse/Panoptes/commits').then(function(response) {
    return response.json();
  }).then(function(commits) {
    var i, len, results, sha;
    results = [];
    for (i = 0, len = commits.length; i < len; i++) {
      sha = commits[i].sha;
      results.push(sha);
    }
    return results;
  });
  deployed = fetch(config.host + "/commit_id.txt").then(function(response) {
    return response.text();
  }).then(function(commitID) {
    return commitID.trim();
  });
  return Promise.all([commits, deployed]).then(function(arg) {
    var commits, deployed, index;
    commits = arg[0], deployed = arg[1];
    index = commits.indexOf(deployed);
    switch (index) {
      case -1:
        return typeof console !== "undefined" && console !== null ? console.warn('Weird: couldnt find deployed commit in master.') : void 0;
      case 0:
        return typeof console !== "undefined" && console !== null ? console.log('Deployed back end is up to date.') : void 0;
      default:
        return typeof console !== "undefined" && console !== null ? console.warn("Deployed back end is " + index + " commits behind master.") : void 0;
    }
  });
};


},{"panoptes-client/lib/config":551}],109:[function(require,module,exports){
var getSubjectLocation, loadImage;

getSubjectLocation = require('./get-subject-location');

loadImage = require('./load-image');

module.exports = function(subject) {
  return Promise.all(subject.locations.map(function(location, i) {
    var ref, src, type;
    ref = getSubjectLocation(subject, i), type = ref.type, src = ref.src;
    switch (type) {
      case 'image':
        return loadImage(src)["catch"](function(error) {
          return console.error(error);
        });
      default:
        return console.warn("Not sure how to load subject " + subject.id + "'s location of type " + type + " (" + src + ")");
    }
  }));
};


},{"./get-subject-location":102,"./load-image":107}],110:[function(require,module,exports){
module.exports = {
  PROJECT_SORTS: [
    {
      value: 'display_name',
      label: 'Project Name'
    }, {
      value: '-activity',
      label: 'Most Active'
    }, {
      value: 'completeness',
      label: 'Most Help Needed'
    }, {
      value: '-classifiers_count',
      label: 'Most Popular'
    }, {
      value: '-launch_date',
      label: 'Most Recently Launched'
    }, {
      value: '-updated_at',
      label: 'Most Recently Updated'
    }
  ]
};


},{}],111:[function(require,module,exports){

/*
  This is for when you want to set state after a promise has resolved.
  It handles pending state and errors automatically.

  React.createClass
    mixins: [PromiseToSetState]

    componentDidMount: ->
      @promiseToSetState foo: makeSomeRequest()

    render: ->
      if @state.foo?
        <span>Foo is {@state.foo}.</span>
      else if @state.rejected.foo?
        <span>{@state.rejected.foo.toString()}</span>
      else
        <span>Waiting for foo...</span>
 */
module.exports = {
  getInitialState: function() {
    return {
      pending: {},
      rejected: {}
    };
  },
  componentWillMount: function() {
    return this._promiseStateKeys = {};
  },
  promiseToSetState: function(keysAndPromises, callback) {
    var handledPromise, key, pending, promise, promiseHandler, ref, rejected;
    ref = this.state, pending = ref.pending, rejected = ref.rejected;
    for (key in keysAndPromises) {
      promise = keysAndPromises[key];
      this._promiseStateKeys[key] = promise;
      promiseHandler = this._handlePromisedState.bind(this, key, promise);
      handledPromise = promise.then(promiseHandler.bind(this, false))["catch"](promiseHandler.bind(this, true));
      pending[key] = handledPromise;
      delete rejected[key];
    }
    return this.setState({
      pending: pending,
      rejected: rejected
    }, callback);
  },
  _handlePromisedState: function(key, promise, caught, value) {
    var isLatestPromise, newState, pending, ref, rejected;
    isLatestPromise = promise === this._promiseStateKeys[key];
    if (this.isMounted() && isLatestPromise) {
      ref = this.state, pending = ref.pending, rejected = ref.rejected;
      newState = {
        pending: pending,
        rejected: rejected
      };
      delete pending[key];
      if (caught) {
        newState[key] = null;
        rejected[key] = value;
      } else {
        newState[key] = value;
        delete rejected[key];
      }
      this.setState(newState);
      return null;
    }
  }
};


},{}],112:[function(require,module,exports){
module.exports = function(location, file, headers) {
  if (headers == null) {
    headers = {};
  }
  return new Promise((function(_this) {
    return function(resolve, reject) {
      var header, value, xhr;
      xhr = new XMLHttpRequest;
      xhr.onreadystatechange = function(e) {
        var ref;
        if (e.target.readyState === e.target.DONE) {
          if ((200 <= (ref = e.target.status) && ref < 300)) {
            return resolve(e.target);
          } else {
            return reject(e.target);
          }
        }
      };
      xhr.open('PUT', location);
      for (header in headers) {
        value = headers[header];
        xhr.setRequestHeader(header, value);
      }
      return xhr.send(file);
    };
  })(this));
};


},{}],113:[function(require,module,exports){
var auth, subjectsSeenThisSession,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

auth = require('panoptes-client/lib/auth');

subjectsSeenThisSession = [];

auth.listen('change', function() {
  return subjectsSeenThisSession.splice(0);
});

module.exports = {
  add: function(workflow, subjects) {
    var i, len, results, subject;
    results = [];
    for (i = 0, len = subjects.length; i < len; i++) {
      subject = subjects[i];
      results.push(subjectsSeenThisSession.push(workflow.id + "/" + subject.id));
    }
    return results;
  },
  check: function(workflow, subject) {
    var ref;
    return ref = workflow.id + "/" + subject.id, indexOf.call(subjectsSeenThisSession, ref) >= 0;
  }
};

if (typeof window !== "undefined" && window !== null) {
  window.subjectsSeenThisSession = subjectsSeenThisSession;
}


},{"panoptes-client/lib/auth":550}],114:[function(require,module,exports){
var fiveMinutesFromNow, generateSessionID, getSessionID, stored;

stored = typeof sessionStorage !== "undefined" && sessionStorage !== null ? sessionStorage.getItem('session_id') : void 0;

generateSessionID = function() {
  var id, sha2, ttl;
  sha2 = require('crypto').createHash('sha256');
  id = sha2.update("" + (Math.random() * 10000) + (Date.now()) + (Math.random() * 1000)).digest('hex');
  ttl = fiveMinutesFromNow();
  stored = {
    id: id,
    ttl: ttl
  };
  try {
    sessionStorage.setItem('session_id', JSON.stringify(stored));
  } catch (undefined) {}
  return stored;
};

getSessionID = function() {
  var id, ref, ref1, ttl;
  ref1 = (ref = JSON.parse(sessionStorage.getItem('session_id'))) != null ? ref : stored, id = ref1.id, ttl = ref1.ttl;
  if (ttl < Date.now()) {
    id = generateSessionID().id;
  } else {
    ttl = fiveMinutesFromNow();
    try {
      sessionStorage.setItem('session_id', JSON.stringify({
        id: id,
        ttl: ttl
      }));
    } catch (undefined) {}
  }
  return id;
};

fiveMinutesFromNow = function() {
  var d;
  d = new Date();
  d.setMinutes(d.getMinutes() + 5);
  return d;
};

module.exports = {
  generateSessionID: generateSessionID,
  getSessionID: getSessionID
};


},{"crypto":307}],115:[function(require,module,exports){
module.exports = {
  set: function(property, value) {
    var changes;
    this.state.error = null;
    this.state.setting[property] = true;
    this.forceUpdate();
    changes = {};
    changes[property] = value;
    return this.props[this.setterProperty].update(changes).save()["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        _this.state.setting[property] = false;
        return _this.forceUpdate();
      };
    })(this));
  }
};


},{}],116:[function(require,module,exports){
var tasks;

tasks = require('../classifier/tasks');

module.exports = function(unknown, knownGood, workflow) {
  var differentTree, potential, quality;
  quality = 0;
  differentTree = false;
  unknown.annotations.forEach(function(annotation, i) {
    var TaskComponent, correspondingKnownGoodAnnotation, taskDescription;
    if (!differentTree) {
      correspondingKnownGoodAnnotation = knownGood.annotations[i];
      if (annotation.task === (correspondingKnownGoodAnnotation != null ? correspondingKnownGoodAnnotation.task : void 0)) {
        taskDescription = workflow.tasks[annotation.task];
        TaskComponent = tasks[taskDescription.type];
        return quality += TaskComponent.testAnnotationQuality(annotation, correspondingKnownGoodAnnotation, workflow);
      } else {
        return differentTree = true;
      }
    }
  });
  potential = Math.max(unknown.annotations.length, knownGood.annotations.length);
  return quality / potential;
};


},{"../classifier/tasks":36}],117:[function(require,module,exports){
var MAIN_SEPARATOR, SUFFIX, SUFFIX_SEPARATOR, titleSegments;

MAIN_SEPARATOR = '  ';

SUFFIX_SEPARATOR = ' \u2014 ';

SUFFIX = typeof document !== "undefined" && document !== null ? document.title : void 0;

titleSegments = [];

module.exports = {
  _titleSegmentIndex: NaN,
  componentDidMount: function() {
    this._titleSegmentIndex = titleSegments.length;
    return this.updateTitle();
  },
  componentWillUnmount: function() {
    titleSegments.splice(this._titleSegmentIndex);
    this._titleSegmentIndex = NaN;
    return this.updateTitle();
  },
  componentDidUpdate: function() {
    return this.updateTitle();
  },
  updateTitle: function() {
    var mainTitle;
    titleSegments[this._titleSegmentIndex] = typeof this.title === 'function' ? this.title() : this.title;
    mainTitle = titleSegments.filter(Boolean).join(MAIN_SEPARATOR);
    return typeof document !== "undefined" && document !== null ? document.title = [mainTitle, SUFFIX].filter(Boolean).join(SUFFIX_SEPARATOR) : void 0;
  }
};


},{}],118:[function(require,module,exports){
var Dialog, Markdown, MediaCard, React, StepThrough, apiClient, completedThisSession;

React = require('react');

Dialog = require('modal-form/dialog');

StepThrough = require('../components/step-through');

MediaCard = require('../components/media-card');

Markdown = require('markdownz').Markdown;

apiClient = require('panoptes-client/lib/api-client');

completedThisSession = {};

if (typeof window !== "undefined" && window !== null) {
  window.tutorialsCompletedThisSession = completedThisSession;
}

module.exports = React.createClass({
  displayName: 'Tutorial',
  statics: {
    checkIfCompleted: function(user, project) {
      var getCompletedAt;
      getCompletedAt = completedThisSession[project.id] != null ? Promise.resolve(new Date(completedThisSession[project.id])) : user != null ? user.get('project_preferences', {
        project_id: project.id
      })["catch"]((function(_this) {
        return function() {
          return [];
        };
      })(this)).then((function(_this) {
        return function(arg) {
          var projectPreferences, ref;
          projectPreferences = arg[0];
          return new Date(projectPreferences != null ? (ref = projectPreferences.preferences) != null ? ref.tutorial_completed_at : void 0 : void 0);
        };
      })(this)) : Promise.resolve(null);
      return getCompletedAt.then((function(_this) {
        return function(completedAt) {
          if (isNaN(completedAt != null ? completedAt.valueOf() : void 0)) {
            return false;
          } else {
            return true;
          }
        };
      })(this));
    },
    start: function(user, project) {
      return apiClient.type('tutorials').get({
        project_id: project.id
      }).then((function(_this) {
        return function(arg) {
          var tutorial;
          tutorial = arg[0];
          if ((tutorial != null) && tutorial.steps.length !== 0) {
            return tutorial.get('attached_images')["catch"](function() {
              return [];
            }).then(function(mediaResources) {
              var TutorialComponent, j, len, mediaByID, mediaResource;
              mediaByID = {};
              for (j = 0, len = mediaResources.length; j < len; j++) {
                mediaResource = mediaResources[j];
                mediaByID[mediaResource.id] = mediaResource;
              }
              TutorialComponent = _this;
              return Dialog.alert(React.createElement(TutorialComponent, {
                "steps": tutorial.steps,
                "media": mediaByID
              }), {
                className: 'tutorial-dialog',
                required: true,
                closeButton: true
              })["catch"](function() {
                return null;
              }).then(function() {
                var now;
                now = new Date().toISOString();
                completedThisSession[project.id] = now;
                if (user != null) {
                  return user.get('project_preferences', {
                    project_id: project.id
                  }).then(function(arg1) {
                    var projectPreferences;
                    projectPreferences = arg1[0];
                    if (projectPreferences == null) {
                      projectPreferences = apiClient.type('project_preferences').create({
                        links: {
                          project: project.id
                        },
                        preferences: {}
                      });
                    }
                    projectPreferences.update({
                      'preferences.tutorial_completed_at': now
                    });
                    return projectPreferences.save();
                  });
                }
              });
            });
          }
        };
      })(this));
    },
    startIfNecessary: function(user, project) {
      return this.checkIfCompleted(user, project).then((function(_this) {
        return function(completed) {
          if (completed === false) {
            return _this.start(user, project);
          }
        };
      })(this));
    }
  },
  propTypes: {
    steps: React.PropTypes.arrayOf(React.PropTypes.shape({
      media: React.PropTypes.string,
      content: React.PropTypes.string
    }))
  },
  getDefaultProps: function() {
    return {
      steps: [],
      media: {}
    };
  },
  render: function() {
    var i, step;
    return React.createElement(StepThrough, {
      "ref": "stepThrough",
      "className": "tutorial-steps"
    }, (function() {
      var j, len, ref, ref1, results;
      ref = this.props.steps;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        step = ref[i];
        if (step._key == null) {
          step._key = Math.random();
        }
        results.push(React.createElement(MediaCard, {
          "key": step._key,
          "className": "tutorial-step",
          "src": ((ref1 = this.props.media[step.media]) != null ? ref1.src : void 0)
        }, React.createElement(Markdown, null, step.content), React.createElement("hr", null), React.createElement("p", {
          "style": {
            textAlign: 'center'
          }
        }, (i === this.props.steps.length - 1 ? React.createElement("button", {
          "type": "submit",
          "className": "major-button"
        }, "Lets go!") : React.createElement("button", {
          "type": "button",
          "className": "standard-button",
          "onClick": this.handleNextClick
        }, "Continue")))));
      }
      return results;
    }).call(this));
  },
  handleNextClick: function() {
    return this.refs.stepThrough.goNext();
  }
});


},{"../components/media-card":80,"../components/step-through":89,"markdownz":"markdownz","modal-form/dialog":546,"panoptes-client/lib/api-client":549,"react":"react"}],119:[function(require,module,exports){
module.exports = function(workflow) {
  var ref, ref1, ref2;
  if ((ref = workflow.configuration) != null ? ref.multi_image_mode : void 0) {
    return ((ref1 = workflow.configuration) != null ? ref1.multi_image_mode : void 0) === 'flipbook' || ((ref2 = workflow.configuration) != null ? ref2.multi_image_mode : void 0) === 'flipbook_and_separate';
  } else {
    return true;
  }
};


},{}],120:[function(require,module,exports){
module.exports = function(workflow) {
  var ref, ref1, ref2;
  if ((ref = workflow.configuration) != null ? ref.multi_image_mode : void 0) {
    return ((ref1 = workflow.configuration) != null ? ref1.multi_image_mode : void 0) === 'separate' || ((ref2 = workflow.configuration) != null ? ref2.multi_image_mode : void 0) === 'flipbook_and_separate';
  } else {
    return false;
  }
};


},{}],121:[function(require,module,exports){
var Link, React, ReactDOM, Route, Router, apiClient, basename, createBrowserHistory, history, logDeployedCommit, ref, ref1, ref2, render, routes, useBasename;

React = require('react');

ReactDOM = (ref = require('react-dom'), render = ref.render, ref);

ref1 = require('react-router'), Router = ref1.Router, Route = ref1.Route, Link = ref1.Link;

useBasename = require('history').useBasename;

createBrowserHistory = require('history/lib/createBrowserHistory');

routes = require('./router');

apiClient = require('panoptes-client/lib/api-client');

if (location.origin == null) {
  location.origin = location.protocol + "//" + location.hostname + (location.port ? ':' + location.port : '');
}

if (document.baseURI == null) {
  document.baseURI = location.origin + document.querySelector('base').getAttribute('href');
}

if ((typeof location !== "undefined" && location !== null ? (ref2 = location.hash) != null ? ref2.indexOf('/') : void 0 : void 0) === 1) {
  location.replace(location.hash.slice(1));
}

basename = document.baseURI.slice(location.origin.length);

history = useBasename(createBrowserHistory)({
  basename: basename
});

history.listen(function() {
  return window.dispatchEvent(new CustomEvent('locationchange'));
});

render(React.createElement(Router, {
  "history": history
}, routes), document.getElementById('panoptes-main-container'));

logDeployedCommit = require('./lib/log-deployed-commit');

logDeployedCommit();

if (typeof window !== "undefined" && window !== null) {
  window.zooAPI = apiClient;
}


},{"./lib/log-deployed-commit":108,"./router":232,"history":"history","history/lib/createBrowserHistory":531,"panoptes-client/lib/api-client":549,"react":"react","react-dom":"react-dom","react-router":"react-router"}],122:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  aboutHome: {
    pageContent: '## What is the Zooniverse?\n\nThe Zooniverse is the worlds largest and most popular platform for people-powered research. This research is made possible by volunteershundreds of thousands of people around the world who come together to assist professional researchers. Our goal is to enable research that would not be possible, or practical, otherwise. Zooniverse research results in new discoveries, datasets useful to the wider research community, and [many publications](/about/publications).\n\n### At the Zooniverse, anyone can be a researcher\n\nYou dont need any specialised background, training, or expertise to participate in any Zooniverse projects. We make it easy for anyone to contribute to real academic research, on their own computer, at their own convenience.\n\nYoull be able to study authentic objects of interest gathered by researchers, like images of faraway galaxies, historical records and diaries, or videos of animals in their natural habitats. By answering simple questions about them, youll help contribute to our understanding of our world, our history, our Universe, and more.\n\nWith our wide-ranging and ever-expanding suite of projects, covering many disciplines and topics across the sciences and humanities, there\'s a place for anyone and everyone to explore, learn and have fun in the Zooniverse.\n\n### We accelerate important research by working together\n\nThe major challenge of 21st century research is dealing with the flood of information we can now collect about the world around us. Computers can help, but in many fields the human ability for pattern recognitionand our ability to be surprisedmakes us superior. With the help of Zooniverse volunteers, researchers can analyze their information more quickly and accurately than would otherwise be possible, saving time and resources, advancing the ability of computers to do the same tasks, and leading to faster progress and understanding of the world, getting to exciting results more quickly.\n\nOur projects combine contributions from many individual volunteers, relying on a version of the wisdom of crowds to produce reliable and accurate data. By having many people look at the data we often can also estimate how likely we are to make an error. The product of a Zooniverse projects is often exactly whats needed to make progress in many fields of research.\n\n### Volunteers and professionals make real discoveries together\n\nZooniverse projects are constructed with the aim of converting volunteers\' efforts into\nmeasurable results. These projects have produced a large number of [published research papers](/about/publications),\nas well as several open-source sets of analyzed data. In some cases, Zooniverse volunteers have even made completely unexpected and scientifically significant discoveries.\n\nA significant amount of this research takes place on the Zooniverse discussion boards, where volunteers can work together with each other and with the research teams. These boards are integrated with each project to allow for everything from quick hashtagging to in-depth collaborative analysis. There is also a central Zooniverse board for general chat and discussion about Zooniverse-wide matters.\n\nMany of the most interesting discoveries from Zooniverse projects have come from discussion between volunteers and researchers. We encourage all users to join the conversation on the discussion boards for more in-depth participation.'
  }
});

module.exports = React.createClass({
  displayName: 'AboutHome',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement(Markdown, null, counterpart("aboutHome.pageContent"));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],123:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  contactPage: {
    content: '## Contact & Social Media\n\nMost of the time, the best way to reach the Zooniverse team, or any project teams, especially about any project-specific issues, is through the discussion boards.\n\nIf you need to contact the Zooniverse team about a general matter, you can also send an email to the team at [contact@zooniverse.org](mailto:contact@zooniverse.org). Please understand that the Zooniverse team is relatively small and very busy, so unfortunately we cannot reply to all of the emails we receive.\n\nIf you are interested in collaborating with the Zooniverse, for instance on a custom-built project, please email [collab@zooniverse.org](mailto:collab@zooniverse.org). (Note that our [Project Builder](/lab) offers an effective way to set up a new project without needing to contact the team!)\n\nFor press inquires, please contact the Zooniverse directors Chris Lintott at [chris@zooniverse.org](mailto:chris@zooniverse.org) or +44 (0) 7808 167288 or Laura Trouille at [trouille@zooniverse.org](mailto:trouille@zooniverse.org) or +1 312 322 0820.\n\nIf you want to keep up to date with what\'s going on across the Zooniverse and our latest results, check out the [Daily Zooniverse](http://daily.zooniverse.org/) or the main [Zooniverse blog](http://blog.zooniverse.org/). You can also follow the Zooniverse on [Twitter](http://twitter.com/the_zooniverse), [Facebook](http://facebook.com/therealzooniverse), and [Google+](https://plus.google.com/+ZooniverseOrgReal).'
  }
});

module.exports = React.createClass({
  displayName: 'ContactPage',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement(Markdown, null, counterpart("contactPage.content"));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],124:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  educationPage: {
    content: '## Education in the Zooniverse\n\nAs a volunteer on these websites, both you and your students can become citizen scientists and citizen researchers, participating in real science and other research. If you or your students think you have make a mistake, dont worry; even the researchers make mistakes. These projects are set up to have more than one volunteer analyzing each piece of data, thereby eliminating the vast majority of human error. Mistakes are a part of the process, and can even help us evaluate the difficulty of the data. As long as everyone does their best, they are helping!\n\n### Resources for educators using Zooniverse\n- [ZooTeach](http://www.zooteach.org/) is a repository of lessons and resources for teachers. At ZooTeach, you will find a variety of resources for education, including: guides to projects for students and teachers, teacher-created presentations designed to introduce students to a particular project, and lessons developed to connect your students to projects and research within the context of things they already know.\n- Many Zooniverse projects have their own education pages with additional resources for teachers. Resources may include a video tutorial of how to use the project, other helpful documents and videos about the classification process, and education resources related to the research behind the project.\n\n### Take part in the conversation\n\nKeep up with the latest Zooniverse educational efforts on the [Zooniverse Blog](http://blog.zooniverse.org/) or by following [&#64;zooteach](https://twitter.com/ZooTeach) on Twitter. You can also talk with other Zooniverse educators and peers interested in using people-powered research in all sorts of learning environments on the [Zooniverse Education Talk board](http://zooniverse.org/talk/16).\n\n### How are educators are using Zooniverse?\n\nLooking for a little inspiration? Here are some ways educators have used Zooniverse projects and educational resources:\n- [Floating Forests: Teaching Young Children About Kelp](http://blog.zooniverse.org/2015/04/29/floating-forests-teaching-young-children-about-kelp/)\n- [Cosmic Curves: Investigating Gravitational Lensing at the Adler Planetarium](http://blog.zooniverse.org/2014/03/18/cosmic-curves-investigating-gravitational-lensing-at-the-adler-planetarium/)\n- [Snapshot Serengeti Brings Authentic Research Into Undergraduate Courses](http://blog.zooniverse.org/2014/02/19/snapshot-serengeti-brings-authentic-research-into-undergraduate-courses/)\n\nWed love to hear about how youve used Zooniverse with youth or adult learners! Please contact [education@zooniverse.org](mailto:education@zooniverse.org) if you have any interesting stories to share.'
  }
});

module.exports = React.createClass({
  displayName: 'EducationPage',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement(Markdown, null, counterpart("educationPage.content"));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],125:[function(require,module,exports){
var IndexLink, Link, Markdown, React, Translate, counterpart, ref;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

ref = require('react-router'), Link = ref.Link, IndexLink = ref.IndexLink;

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  about: {
    title: 'About Us',
    nav: {
      about: 'About',
      publications: 'Publications',
      ourTeam: 'Our Team',
      education: 'Education',
      careers: 'Careers',
      contact: 'Contact Us'
    }
  }
});

module.exports = React.createClass({
  displayName: 'AboutPage',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement("div", {
      "className": "secondary-page about-page"
    }, React.createElement("section", {
      "className": "hero about-hero"
    }, React.createElement("div", {
      "className": "hero-container"
    }, React.createElement(Translate, {
      "content": "about.title",
      "component": "h1"
    }), React.createElement("nav", {
      "className": "hero-nav"
    }, React.createElement(IndexLink, {
      "to": "/about",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "about.nav.about"
    })), React.createElement(Link, {
      "to": "/about/publications",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "about.nav.publications"
    })), React.createElement(Link, {
      "to": "/about/team",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "about.nav.ourTeam"
    })), React.createElement(Link, {
      "to": "/about/education",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "about.nav.education"
    })), React.createElement(Link, {
      "to": "/about/contact",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "about.nav.contact"
    }))))), React.createElement("section", {
      "className": "about-page-content content-container"
    }, this.props.children));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],126:[function(require,module,exports){
var Loading, React, Translate, apiClient, counterpart, publicationCategories;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

apiClient = require('panoptes-client/lib/api-client');

Loading = require('../../components/loading-indicator');

counterpart.registerTranslations('en', {
  publications: {
    nav: {
      showAll: 'Show All',
      space: 'Space',
      climate: 'Climate',
      humanities: 'Humanities',
      nature: 'Nature',
      medicine: 'Medicine',
      meta: 'Meta'
    },
    content: {
      header: {
        showAll: 'All Publications'
      }
    }
  }
});

publicationCategories = {
  space: [
    {
      slug: "zooniverse/galaxy-zoo",
      publications: [
        {
          citation: "Galaxy Zoo: the effect of bar-driven fueling on the presence of an active galactic nucleus in disc galaxies, Galloway+ 2015.",
          href: "http://arxiv.org/abs/1502.01033"
        }, {
          citation: "Galaxy Zoo: Evidence for Diverse Star Formation Histories through the Green Valley, Smethurst+ 2015.",
          href: "http://mnras.oxfordjournals.org/content/450/1/435.full.pdf+html"
        }, {
          citation: "Galaxy Zoo: the dependence of the star formation-stellar mass relation on spiral disc morphology, Willett+ 2015.",
          href: "http://mnras.oxfordjournals.org/cgi/content/full/stv307?ijkey=n2t0XjSn37YTbrU&keytype=ref"
        }, {
          citation: "Galaxy Zoo: Are Bars Responsible for the Feeding of Active Galactic Nuclei at 0.2 < z < 1.0?, Cheung+ 2014.",
          href: "http://adsabs.harvard.edu/abs/2014arXiv1409.5434C"
        }, {
          citation: "Galaxy Zoo: The Ultraviolet Attenuation Law in Backlit Spiral Galaxies, Keel+ 2014.",
          href: "http://arxiv.org/abs/1401.0773"
        }, {
          citation: "HST Imaging of Fading AGN Candidates I: Host-Galaxy Properties and Origin of the Extended Gas, Keel+ 2014.",
          href: "http://arxiv.org/abs/1408.5159"
        }, {
          citation: "Galaxy Zoo: an independent look at the evolution of the bar fraction over the last eight billion years from HST-COSMOS, Melvin+ 2014.",
          href: "http://mnras.oxfordjournals.org/content/438/4/2882"
        }, {
          citation: "The green valley is a red herring: Galaxy Zoo reveals two evolutionary pathways towards quenching of star formation in early- and late-type galaxies, Schawinski+ 2014.",
          href: "http://arxiv.org/abs/1402.4814"
        }, {
          citation: "Galaxy Zoo: CANDELS barred discs and bar fractions, Simmons+ 2014.",
          href: "http://mnras.oxfordjournals.org/content/445/4/3466"
        }, {
          citation: "Galaxy Zoo: quantifying morphological indicators of galaxy interaction, Casteels+ 2013.",
          href: "http://adsabs.harvard.edu/abs/2013MNRAS.429.1051C"
        }, {
          citation: "Galaxy Zoo: Observing Secular Evolution Through Bars, Cheung+ 2013.",
          href: "http://arxiv.org/abs/1310.2941"
        }, {
          citation: "Galaxy Zoo: A Catalog of Overlapping Galaxy Pairs for Dust Studies, Keel+ 2013.",
          href: "http://adsabs.harvard.edu/abs/2013PASP..125....2K"
        }, {
          citation: "The different star-formation histories of blue and red spiral and elliptical galaxies, Tojeiro+ 2013.",
          href: "http://adsabs.harvard.edu/abs/2013arXiv1303.3551T"
        }, {
          citation: "Galaxy Zoo 2: detailed morphological classifications for 304,122 galaxies from the Sloan Digital Sky Survey, Willett+ 2013.",
          href: "http://arxiv.org/abs/1308.3496"
        }, {
          citation: "Galaxy Zoo: building the low-mass end of the red sequence with local post-starburst galaxies, Wong+ 2013.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.420.1684W"
        }, {
          citation: "Spheroidal post-mergers in the local Universe, Carpineti+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.420.2139C"
        }, {
          citation: "Polar ring galaxies in the Galaxy Zoo, Finkelman+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.422.2386F"
        }, {
          citation: "The fraction of early-type galaxies in low-redshift groups and clusters of galaxies, Hoyle+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.423.3478H"
        }, {
          citation: "Galaxy Zoo: dust and molecular gas in early-type galaxies with prominent dust lanes, Kaviraj+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.423...49K"
        }, {
          citation: "The Galaxy Zoo survey for giant AGN-ionized clouds: past and present black hole accretion events, Keel+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.420..878K"
        }, {
          citation: "Galaxy Zoo and ALFALFA: atomic gas and the regulation of star formation in barred disc galaxies, Masters+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.424.2180M"
        }, {
          citation: "Galaxy Zoo: dust lane early-type galaxies are tracers of recent gas-rich minor mergers, Shabala+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.423...59S"
        }, {
          citation: "Galaxy Zoo: Bulgeless Galaxies With Growing Black Holes, Simmons+ 2012.",
          href: "http://adsabs.harvard.edu/cgi-bin/bib_query?arXiv:1207.4190"
        }, {
          citation: "Galaxy Zoo: the environmental dependence of bars and bulges in disc galaxies, Skibba+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.423.1485S"
        }, {
          citation: "Chandra Observations of Galaxy Zoo Mergers: Frequency of Binary Active Nuclei in Massive Mergers, Teng+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012ApJ...753..165T"
        }, {
          citation: "Galaxy Zoo Volunteers Share Pain and Glory of Research, Clery 2011.",
          href: "http://adsabs.harvard.edu/abs/2011Sci...333..173C"
        }, {
          citation: "Galaxy Zoo: multimergers and the Millennium Simulation, Darg+ 2011.",
          href: "http://adsabs.harvard.edu/abs/2011MNRAS.416.1745D"
        }, {
          citation: "Galaxy Zoo: bar lengths in local disc galaxies, Hoyle+ 2011.",
          href: "http://adsabs.harvard.edu/abs/2011MNRAS.415.3627H"
        }, {
          citation: "Tidal dwarf galaxies in the nearby Universe, Kaviraj+ 2011.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.419...70K"
        }, {
          citation: "Galaxy Zoo 1: data release of morphological classifications for nearly 900 000 galaxies, Lintott+ 2011.",
          href: "http://adsabs.harvard.edu/abs/2011MNRAS.410..166L"
        }, {
          citation: "Galaxy Zoo: bars in disc galaxies, Masters+ 2011.",
          href: "http://adsabs.harvard.edu/abs/2011MNRAS.411.2026M"
        }, {
          citation: "Galaxy Zoo Supernovae, Smith+ 2011.",
          href: "http://adsabs.harvard.edu/abs/2011MNRAS.412.1309S"
        }, {
          citation: "Galaxy Zoo Morphology and Photometric Redshifts in the Sloan Digital Sky Survey, Way 2011.",
          href: "http://adsabs.harvard.edu/abs/2011ApJ...734L...9W"
        }, {
          citation: "Galaxy Zoo: reproducing galaxy morphologies via machine learning, Banerji+ 2010.",
          href: "http://adsabs.harvard.edu/abs/2010MNRAS.406..342B"
        }, {
          citation: "Galaxy Zoo: the properties of merging galaxies in the nearby Universe - local environments colours masses star formation rates and AGN activity, Darg+ 2010.",
          href: "http://adsabs.harvard.edu/abs/2010MNRAS.401.1552D"
        }, {
          citation: "Galaxy Zoo: the fraction of merging galaxies in the SDSS and their morphologies, Darg+ 2010.",
          href: "http://adsabs.harvard.edu/abs/2010MNRAS.401.1043D"
        }, {
          citation: "Galaxy Zoo: a correlation between the coherence of galaxy spin chirality and star formation efficiency, Jimenez+ 2010.",
          href: "http://adsabs.harvard.edu/abs/2010MNRAS.404..975J"
        }, {
          citation: "Galaxy Zoo: passive red spirals, Masters+ 2010.",
          href: "http://adsabs.harvard.edu/abs/2010MNRAS.405..783M"
        }, {
          citation: "Galaxy Zoo: dust in spiral galaxies, Masters+ 2010.",
          href: "http://adsabs.harvard.edu/abs/2010MNRAS.404..792M"
        }, {
          citation: "Galaxy Zoo: The Fundamentally Different Co-Evolution of Supermassive Black Holes and Their Early- and Late-Type Host Galaxies, Schawinski+ 2010.",
          href: "http://adsabs.harvard.edu/abs/2010ApJ...711..284S"
        }, {
          citation: "Galaxy Zoo: the dependence of morphology and colour on environment, Bamford+ 2009.",
          href: "http://adsabs.harvard.edu/abs/2009MNRAS.393.1324B"
        }, {
          citation: "Galaxy Zoo Green Peas: discovery of a class of compact extremely star-forming galaxies, Cardamone+ 2009.",
          href: "http://adsabs.harvard.edu/abs/2009MNRAS.399.1191C"
        }, {
          citation: "Galaxy Zoo: `Hanny's Voorwerp' a quasar light echo?, Lintott+ 2009.",
          href: "http://adsabs.harvard.edu/abs/2009MNRAS.399..129L"
        }, {
          citation: "Galaxy Zoo: a sample of blue early-type galaxies at low redshift, Schawinski+ 2009.",
          href: "http://adsabs.harvard.edu/abs/2009MNRAS.396..818S"
        }, {
          citation: "Galaxy Zoo: disentangling the environmental dependence of morphology and colour, Skibba+ 2009.",
          href: "http://adsabs.harvard.edu/abs/2009MNRAS.399..966S"
        }, {
          citation: "Galaxy Zoo: chiral correlation function of galaxy spins, Slosar+ 2009.",
          href: "http://adsabs.harvard.edu/abs/2009MNRAS.392.1225S"
        }, {
          citation: "Galaxy Zoo: the large-scale spin statistics of spiral galaxies in the Sloan Digital Sky Survey, Land+ 2008.",
          href: "http://adsabs.harvard.edu/abs/2008MNRAS.388.1686L"
        }, {
          citation: "Galaxy Zoo: morphologies derived from visual inspection of galaxies from the Sloan Digital Sky Survey, Lintott+ 2008.",
          href: "http://adsabs.harvard.edu/abs/2008MNRAS.389.1179L"
        }
      ]
    }, {
      slug: "zooniverse/solar-stormwatch",
      publications: [
        {
          citation: "Differences between the CME fronts tracked by an expert, an automated algorithm, and the Solar Stormwatch project, Barnard+ 2015.",
          href: "http://onlinelibrary.wiley.com/doi/10.1002/2015SW001280/full"
        }, {
          citation: "Observational Tracking of the 2D Structure of Coronal Mass Ejections Between the Sun and 1 AU, Savani+ 2015.",
          href: "http://arxiv.org/abs/1503.08774"
        }, {
          citation: "Validation of a priori CME arrival predictions made using real-time heliospheric imager observations, Tucker-Hood+ 2015.",
          href: "http://onlinelibrary.wiley.com/doi/10.1002/2014SW001106/abstract"
        }, {
          citation: "The Solar Stormwatch CME catalogue: Results from the first space weather citizen science project, Barnard+ 2014.",
          href: "http://onlinelibrary.wiley.com/doi/10.1002/2014SW001119/abstract"
        }, {
          citation: "The distribution of interplanetary dust between 0.96 and 1.04 au as inferred from impacts on the STEREO spacecraft observed by the heliospheric imagers, Davis+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.420.1355D"
        }
      ]
    }, {
      slug: "zooniverse/galaxy-zoo-supernova",
      publications: [
        {
          citation: "Five New Outbursting AM CVn Systems Discovered by the Palomar Transient Factory, Levitan+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012arXiv1212.5312L"
        }, {
          citation: "Hubble Space Telescope studies of low-redshift Type Ia supernovae: evolution with redshift and ultraviolet spectral trends, Maguire+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.426.2359M"
        }, {
          citation: "Dynamic Bayesian Combination of Multiple Imperfect Classifiers, Simpson+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012arXiv1206.1831S"
        }, {
          citation: "PTF10ops - a subluminous, normal-width light curve Type Ia supernova in the middle of nowhere, Maguire+ 2011.",
          href: "http://adsabs.harvard.edu/abs/2011MNRAS.418..747M"
        }, {
          citation: "Galaxy Zoo: Supernovae, Smith+ 2011.",
          href: "http://adsabs.harvard.edu/abs/2011MNRAS.412.1309S"
        }
      ]
    }, {
      slug: "zooniverse/planet-hunters",
      publications: [
        {
          citation: "Planet Hunters X: Searching for Nearby Neighbors of 75 Planet and Eclipsing Binary Candidates from the K2 Kepler extended mission, Schmitt+ 2016.",
          href: "http://arxiv.org/pdf/1603.06945v1.pdf"
        }, {
          citation: "Planet Hunters. VIII. Characterization of 41 Long-Period Exoplanet Candidates from Kepler Archival Data, Wang+ 2015.",
          href: "http://arxiv.org/pdf/1512.02559v2.pdf"
        }, {
          citation: "Planet Hunters. IX. KIC 8462852  Wheres the flux?, Boyajian+ 2015.",
          href: "http://mnras.oxfordjournals.org/content/457/4/3988.full.pdf"
        }, {
          citation: "GALEX J194419.33+491257.0: An unusually active SU UMa-type dwarf nova with a very short orbital period in the Kepler data, Kato & Osaki 2014.",
          href: "http://adsabs.harvard.edu/doi/10.1093/pasj/psu025"
        }, {
          citation: "Planet Hunters. VI. An Independent Characterization of KOI-351 and Several Long Period Planet Candidates from the Kepler Archival Data, Schmitt+ 2014.",
          href: "http://adsabs.harvard.edu/abs/2013arXiv1310.5912S"
        }, {
          citation: "Planet Hunters. VII. Discovery of a New Low-mass, Low-density Planet (PH3 C) Orbiting Kepler-289 with Mass Measurements of Two Additional Planets (PH3 B and D), Schmitt+ 2014.",
          href: "http://adsabs.harvard.edu/cgi-bin/bib_query?arXiv:1410.8114"
        }, {
          citation: "Planet Hunters: KIC 9406652: An Unusual Cataclysmic Variable in the Kepler Field of View, Gies+ 2013.",
          href: "http://arxiv.org/abs/1308.0369"
        }, {
          citation: "Planet Hunters: New Kepler planet candidates from analysis of quarter 2, Lintott+ 2013.",
          href: "http://iopscience.iop.org/1538-3881/145/6/151/"
        }, {
          citation: "Planet Hunters: A Transiting Circumbinary Planet in a Quadruple Star System, Schwamb+ 2013.",
          href: "http://adsabs.harvard.edu/cgi-bin/bib_query?arXiv:1210.3612"
        }, {
          citation: "Planet Hunters V. A Confirmed Jupiter-Size Planet in the Habitable Zone and 42 Planet Candidates from the Kepler Archive Data, Wang+ 2013.",
          href: "http://arxiv.org/abs/1301.0644"
        }, {
          citation: "Planet Hunters: the first two planet candidates identified by the public using the Kepler public archive data, Fischer+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012MNRAS.419.2900F"
        }, {
          citation: "Planet Hunters: Assessing the Kepler Inventory of Short-period Planets, Schwamb+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012ApJ...754..129S"
        }
      ]
    }, {
      slug: "zooniverse/milky-way-project",
      publications: [
        {
          citation: "The Milky Way Project and ATLASGAL: The distribution and physical properties of cold clumps near infrared bubbles, Kendrew+ 2016.",
          href: "http://arxiv.org/abs/1602.06982"
        }, {
          citation: "The Milky Way Project: What are Yellowballs?, Kerton+ 2015.",
          href: "http://arxiv.org/abs/1502.01388v1"
        }, {
          citation: "The Milky Way Project: Leveraging Citizen Science and Machine Learning to Detect Interstellar Bubbles, Beaumont+ 2014.",
          href: "http://arxiv.org/abs/1406.2692"
        }, {
          citation: "The Milky Way Project: A Statistical Study of Massive Star Formation Associated with Infrared Bubbles, Kendrew+ 2012.",
          href: "http://adsabs.harvard.edu/abs/2012ApJ...755...71K"
        }, {
          citation: "The Milky Way Project First Data Release: a bubblier Galactic disc, Simpson+ 2012.",
          href: "http://mnras.oxfordjournals.org/content/424/4/2442.abstract?sid=4a445f2b-71d6-4865-9e64-3aba88192f61"
        }
      ]
    }, {
      slug: "zooniverse/ice-hunters",
      publications: [
        {
          citation: "2011 HM102: Discovery of a High-Inclination L5 Neptune Trojan in the Search for a post-Pluto New Horizons Target, Parker+ 2012.",
          href: "http://arxiv.org/abs/1210.4549"
        }
      ]
    }, {
      slug: "zooniverse/andromeda-project",
      publications: [
        {
          citation: "PHAT Stellar Cluster Survey. II. Andromeda Project Cluster Catalog, Johnson+ 2015.",
          href: "http://arxiv.org/abs/1501.04966"
        }
      ]
    }, {
      slug: "zooniverse/space-warps",
      publications: [
        {
          citation: "Space Warps - II. New gravitational lens candidates from the CFHTLS discovered through citizen science, Marshall+ 2016.",
          href: "http://mnras.oxfordjournals.org/content/455/2/1191.full.pdf"
        }, {
          citation: "Space Warps - I. Crowdsourcing the discovery of gravitational lenses, Marshall+ 2016.",
          href: "http://mnras.oxfordjournals.org/content/455/2/1171.full.pdf"
        }, {
          citation: "The Red Radio Ring: a gravitationally lensed hyperluminous infrared radio galaxy at z=2.553 discovered through citizen science, Geach+ 2015.",
          href: "http://arxiv.org/pdf/1503.05824v1.pdf"
        }, {
          citation: "Gravitational lens modelling in a citizen science context, Kng+ 2015.",
          href: "http://arxiv.org/pdf/1502.00008v1.pdf"
        }
      ]
    }, {
      slug: "zooniverse/snapshot-supernova",
      publications: [
        {
          citation: "ATel #7254: PESSTO spectroscopic classification of optical transients, Campbell+ 2015.",
          href: "http://www.astronomerstelegram.org/?read=7254"
        }, {
          citation: "ATel #7261: PESSTO spectroscopic classification of optical transients, Cartier+ 2015.",
          href: "http://www.astronomerstelegram.org/?read=7261"
        }
      ]
    }, {
      slug: "zooniverse/radio-galaxy-zoo",
      publications: [
        {
          citation: "Radio Galaxy Zoo: host galaxies and radio morphologies derived from visual inspection, Banfield+ 2015.",
          href: "http://arXiv.org/abs/1507.07272"
        }
      ]
    }, {
      slug: "zooniverse/moon-zoo",
      publications: [
        {
          citation: "The Moon Zoo citizen science project: Preliminary results for the Apollo 17 landing site, Bugiolacchi+ 2016.",
          href: "http://arxiv.org/pdf/1602.01664v1.pdf"
        }
      ]
    }
  ],
  climate: [
    {
      slug: "zooniverse/cyclone-center",
      publications: [
        {
          citation: "Cyclone Center: Can Citizen Scientists Improve Tropical Cyclone Intensity Records?, Hennon+ 2014.",
          href: "http://journals.ametsoc.org/doi/abs/10.1175/BAMS-D-13-00152.1"
        }
      ]
    }
  ],
  humanities: [
    {
      slug: "zooniverse/ancient-lives",
      publications: [
        {
          citation: "A computational pipeline for crowdsourced transcriptions of Ancient Greek papyrus fragments, Williams+ 2014.",
          href: "http://ieeexplore.ieee.org/xpl/articleDetails.jsp?reload=true&tp=&arnumber=7004460&queryText%3Dwilliam+alex+pridemore"
        }, {
          citation: "P.Oxy 5156, Plutarch Moralia 660C, 661B-C (Quaestiones Convivales IV PR., 1.2), in The Oxyrhynchus Papyri Vol. 78, Brusuelas 2013."
        }
      ]
    }, {
      slug: "zooniverse/operation-war-diary",
      publications: [
        {
          citation: "A Life in the Trenches? The Use of Operation War Diary and Crowdsourcing Methods to Provide an Understanding of the British Armys Day-to-Day Life on the Western Front, Grayson+ 2016.",
          href: "http://bjmh.org.uk/index.php/bjmh/article/view/96"
        }
      ]
    }
  ],
  nature: [
    {
      slug: "zooniverse/whale-fm",
      publications: [
        {
          citation: "Classification of large acoustic datasets using machine learning and crowdsourcing: Application to whale calls, Shamir+ 2014.",
          href: "http://scitation.aip.org/content/asa/journal/jasa/135/2/10.1121/1.4861348"
        }, {
          citation: "Repeated call types in short-finned pilot whales, Globicephala macrorhynchus, Sayigh+ 2012.",
          href: "http://onlinelibrary.wiley.com/doi/10.1111/j.1748-7692.2012.00577.x/abstract"
        }
      ]
    }, {
      slug: "zooniverse/snapshot-serengeti",
      publications: [
        {
          citation: "Applying a random encounter model to estimate lion density from camera traps in Serengeti National Park, Tanzania, Cusack+ 2015.",
          href: "http://onlinelibrary.wiley.com/doi/10.1002/jwmg.902/full"
        }, {
          citation: "Snapshot Serengeti, high-frequency annotated camera trap images of 40 mammalian species in an African savanna, Swanson+ 2015.",
          href: "http://www.nature.com/articles/sdata201526"
        }
      ]
    }
  ],
  medicine: [
    {
      slug: "zooniverse/cell-slider",
      publications: [
        {
          citation: "Crowdsourcing the General Public for Large Scale Molecular Pathology Studies in Cancer, Candido dos Reis+ 2015.",
          href: "http://www.ebiomedicine.com/article/S2352-3964(15)30016-5/pdf"
        }
      ]
    }
  ],
  meta: [
    {
      name: "Meta Studies",
      publications: [
        {
          citation: "Science Learning via Participation in Online Citizen Science, Masters+ 2016.",
          href: "http://arxiv.org/pdf/1601.05973v1.pdf"
        }, {
          citation: "Defining and Measuring Success in Online Citizen Science: A Case Study of Zooniverse Projects, Cox+ 2015.",
          href: "http://eprints.whiterose.ac.uk/86535/"
        }, {
          citation: "Designing for Dabblers and Deterring Drop-Outs in Citizen Science, Eveleigh+ 2014.",
          href: "http://discovery.ucl.ac.uk/1418573/1/p2985-eveleigh.pdf"
        }, {
          citation: "Playing with science: gamised aspects of gamification found on the Online Citizen Science Project - Zooniverse, Greenhill+ 2014.",
          href: "http://eprints.port.ac.uk/15648/"
        }, {
          citation: "Why Wont Aliens Talk to Us: Content and Community Dynamics in Online Citizen Science, Luczak-Roesch+ 2014.",
          href: "http://www.aaai.org/ocs/index.php/ICWSM/ICWSM14/paper/view/8092"
        }, {
          citation: "Volunteers Engagement in Human Computation Astronomy Projects, Ponciano+ 2014.",
          href: "http://ieeexplore.ieee.org/xpl/articleDetails.jsp?reload=true&arnumber=6728933"
        }, {
          citation: "Zooniverse: Observing the Worlds Largest Citizen Science Platform, Simpson+ 2014.",
          href: "http://dl.acm.org/citation.cfm?id=2579215"
        }, {
          citation: 'I want to be a Captain! I want to be a Captain!": Gamification in the Old Weather citizen science project., Eveleigh+ 2013.',
          href: "http://discovery.ucl.ac.uk/1412171/"
        }, {
          citation: "Creativity in citizen cyberscience: All for one and one for all, Jennett+ 2013.",
          href: "http://ac.aup.fr/~croda/tclab/creativity&attention2013Material/CharleneJennett.pdf"
        }, {
          citation: "Learning by volunteer computing, thinking and gaming: What and how are volunteers learning by participating in Virtual Citizen Science?, Kloetzer+ 2013.",
          href: "http://ebwb.hu-berlin.de/aktuelles/esrea/conference-programme/esrea-book-of-abstracts"
        }, {
          citation: "Measuring the Conceptual Understandings of Citizen Scientists Participating in Zooniverse Projects: A First Approach, Prather+ 2013.",
          href: "http://www.portico.org/Portico/#!journalAUSimpleView/tab=PDF?cs=ISSN_15391515?ct=E-Journal%20Content?auId=ark:/27927/pgg3ztfcwj0"
        }, {
          citation: "Galaxy Zoo: Motivations of Citizen Scientists, Raddick+ 2013.",
          href: "http://arxiv.org/abs/1303.6886"
        }, {
          citation: "Galaxy Zoo: Morphological Classification and Citizen Science, Fortson+ 2012.",
          href: "http://labs.adsabs.harvard.edu/adsabs/abs/2012amld.book..213F/"
        }, {
          citation: "Galaxy Zoo: Exploring the Motivations of Citizen Science Volunteers, Raddick+ 2010.",
          href: "http://adsabs.harvard.edu/abs/2010AEdRv...9a0103R"
        }
      ]
    }
  ]
};

module.exports = React.createClass({
  displayName: 'PublicationsPage',
  getInitialState: function() {
    return {
      currentSort: 'showAll'
    };
  },
  componentDidMount: function() {
    this.loadProjects();
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  projectSlugs: function() {
    var category, list, project, slugs;
    slugs = [];
    for (category in publicationCategories) {
      list = publicationCategories[category];
      slugs = slugs.concat((function() {
        var j, len, results;
        results = [];
        for (j = 0, len = list.length; j < len; j++) {
          project = list[j];
          if (project.slug) {
            results.push(project.slug);
          }
        }
        return results;
      })());
    }
    return slugs;
  },
  loadProjects: function() {
    return apiClient.type('projects').get({
      slug: this.projectSlugs(),
      cards: true
    }).then((function(_this) {
      return function(projects) {
        var j, len, project, projectMap;
        projectMap = {};
        for (j = 0, len = projects.length; j < len; j++) {
          project = projects[j];
          projectMap[project.slug] = project;
        }
        return _this.setState({
          projects: projectMap
        });
      };
    })(this));
  },
  render: function() {
    var category, navItem, project, projectListing, projects, sideBarNav;
    sideBarNav = counterpart("publications.nav");
    return React.createElement("div", {
      "className": "publications-page secondary-page-copy"
    }, React.createElement("aside", {
      "className": "secondary-page-side-bar"
    }, React.createElement("nav", {
      "ref": "sideBarNav"
    }, (function() {
      var results;
      results = [];
      for (navItem in sideBarNav) {
        results.push(React.createElement("button", {
          "key": navItem,
          "ref": navItem,
          "className": "secret-button side-bar-button",
          "style": (this.state.currentSort === navItem ? {
            fontWeight: 700
          } : void 0),
          "onClick": this.showPublicationsList.bind(null, navItem)
        }, React.createElement(Translate, {
          "content": "publications.nav." + navItem
        })));
      }
      return results;
    }).call(this))), React.createElement("section", {
      "className": "publications-content"
    }, React.createElement("h2", null, (this.state.currentSort === 'showAll' ? React.createElement(Translate, {
      "content": "publications.content.header.showAll"
    }) : this.state.currentSort)), ((function() {
      var results;
      if (this.state.projects) {
        results = [];
        for (category in publicationCategories) {
          projects = publicationCategories[category];
          if ((this.state.currentSort === category) || (this.state.currentSort === 'showAll')) {
            results.push(React.createElement("ul", {
              "key": category,
              "className": "publications-list"
            }, (function() {
              var j, len, results1;
              results1 = [];
              for (j = 0, len = projects.length; j < len; j++) {
                projectListing = projects[j];
                project = this.state.projects[projectListing.slug];
                results1.push(React.createElement("div", {
                  "key": projectListing.name || project.slug
                }, React.createElement("div", null, React.createElement("h3", {
                  "className": "project-name"
                }, (project ? project.display_name : projectListing.name)), React.createElement("span", {
                  "className": "publication-count"
                }, ' ', "(", projectListing.publications.length, ")")), projectListing.publications.map((function(_this) {
                  return function(publication) {
                    var i;
                    i = Math.random();
                    return React.createElement("li", {
                      "key": "publication-" + i,
                      "className": "publication-item"
                    }, _this.avatarFor(project), React.createElement("div", {
                      "className": "citation"
                    }, React.createElement("p", null, React.createElement("cite", null, publication.citation), React.createElement("br", null), (publication.href != null ? React.createElement("a", {
                      "href": publication.href,
                      "target": "_blank"
                    }, "Available here.") : void 0))));
                  };
                })(this))));
              }
              return results1;
            }).call(this)));
          } else {
            results.push(void 0);
          }
        }
        return results;
      } else {
        return React.createElement(Loading, null);
      }
    }).call(this))));
  },
  showPublicationsList: function(navItem) {
    return this.setState({
      currentSort: navItem
    });
  },
  avatarFor: function(project) {
    var src;
    src = (project != null ? project.avatar_src : void 0) ? "//" + project.avatar_src : './assets/simple-avatar.jpg';
    return React.createElement("img", {
      "src": src,
      "alt": "Project Avatar"
    });
  }
});


},{"../../components/loading-indicator":77,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react","react-translate-component":"react-translate-component"}],127:[function(require,module,exports){
var React, Translate, counterpart, teamMembers;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

counterpart.registerTranslations('en', {
  team: {
    nav: {
      showAll: 'Show All',
      oxford: 'Oxford',
      chicago: 'Chicago',
      minnesota: 'Minnesota',
      portsmouth: 'Portsmouth',
      taipei: 'Taipei'
    },
    content: {
      header: {
        showAll: 'Zooniverse Team'
      },
      adamMcMaster: {
        title: 'Infrastructure Engineer',
        bio: 'Adam is responsible for managing the Zooniverse\'s web hosting infrastructure.\nHe has a computer science degree and has worked in web hosting and development for many years.\nHe\'s also working on a degree in astronomy with the OU.'
      },
      alexBowyer: {
        title: 'Web Science Architect',
        bio: 'Alex works remotely for Zooniverse from his home in Northumberland.\nHe\'s a software architect designing and running Zooniverse experiments. He has a computer science degree,\nand has developed software & websites at large enterprises and startups.'
      },
      aliSwanson: {
        title: 'Researcher',
        bio: 'Ali spent most of her PhD chasing lions around the Serengeti. She finished\nher PhD in Ecology, Evolution, and Behavior at the University of Minnesota in 2014,\nand has since joined the Zooniverse as a Postdoc in Ecology and Citizen Science.'
      },
      andreaSimenstad: {
        title: 'Developer',
        bio: 'Andrea joined Zooniverse as a developer at the University of Minnesota in 2015. When she is not captivated by code, she can be found enjoying snow on skis and exploring lakes by kayak. She graduated from Carleton College with a degree in Cognitive Science.'
      },
      brianCarstensen: {
        title: 'UX Developer',
        bio: 'Brian Carstensen recently moved from Chicago to Oxford. Brian has a degree\nin graphic design from Columbia College in Chicago, and worked in that field for a\nnumber of years before finding a niche in web development.'
      },
      brookeSimmons: {
        title: 'Researcher',
        bio: 'Brooke is an astrophysicist studying black holes, galaxies, and how citizen science can be applied to other non-traditional problems.'
      },
      camAllen: {
        title: 'Developer',
        bio: 'Responsible for building the Zooniverse\'s API infrastructure.\nCam considers himself a music and fine wine connoisseur - others do not.\nIn his spare time he enjoys playing an obscure form of rugby.'
      },
      chrisLintott: {
        title: 'Zooniverse PI',
        bio: 'Astronomer and founder of both Galaxy Zoo and the Zooniverse that grew from it,\nChris is interested in how galaxies form and evolve, how citizen science can change the\nworld, and whether the Chicago Fire can get their act together.'
      },
      christopherDoogue: {
        title: 'Project Assistant',
        bio: 'Chris has been happily supporting the Zooniverse Oxford team since Sep. 2014. He has been with the Department of Astrophysics for over 2 years administratively supporting various projects. A former trained actor, he has the ability to look like he\'s smiling in the face of adversity!'
      },
      colemanKrawczyk: {
        title: 'Data Scientist',
        bio: 'Coleman is helping to create new data analysis and visualization tools for existing Zooniverse\nprojects as well as identifying new projects within the University of Portsmouth. He received\nhis PhD in astrophysics from Drexel University.'
      },
      grantMiller: {
        title: 'Communications Lead',
        bio: 'A former exoplanetary scientist, Grant is now responsible for communicating with our volunteers and researchers. He is also behind the Zooniverse\'s presence on\nsocial media and publishes the Daily Zooniverse blog.'
      },
      gregHines: {
        title: 'Data Scientist',
        bio: 'Greg uses machine learning and statistics to help projects analyse the volunteer\nclassifications. He has a PhD in Computer Science from the University of Waterloo, Canada.\nIn his spare time, Greg loves to eat pancakes with real maple syrup and run ultramarathons.'
      },
      jimODonnell: {
        title: 'UX Developer',
        bio: 'Professional cynic but his heart\'s not in it. Web developer for the Zooniverse,\nWeb Standards organiser, Amnesty UK activist.'
      },
      jenGupta: {
        title: 'Educator',
        bio: 'Jen works on Galaxy Zoo education in her role as the SEPnet/Ogden Outreach Officer\nfor the Institute of Cosmology and Gravitation, and has a PhD in astrophysics. Active\ngalactic nuclei were her first love.'
      },
      jordanMartin: {
        title: 'Visual Designer',
        bio: 'Jordan joined the Zooniverse team at the Adler Planetarium as the Visual Designer starting in 2015. She spends her time at the Zooniverse making user interfaces beautiful, engaging, and a rewarding experience for volunteers. She spends her time at home with her two cats and many houseplants.'
      },
      julieFeldt: {
        title: 'Educator',
        bio: 'Julie has a background in space physics and museum studies. She works on educational\nexperiences, and Skype in the Classroom lessons for the Zooniverse. She loves to run, mostly\nto compensate for her love of cupcakes and chocolate.'
      },
      karenMasters: {
        title: 'Researcher',
        bio: 'Karen is an astronomer and the Project Scientist of Galaxy Zoo, which she\'s been\ninvolved in as a researcher since 2008. She\'s particularly interested in the evolution of\nspiral galaxies.'
      },
      kellyBorden: {
        title: 'Educator',
        bio: 'With a background in museum education, Kelly joined the Zooniverse in 2011 to bring\nan educator\'s perspective and spread the word amongst teachers and students. She\'s fond of\nseveral C\'s: chocolate, cats, coffee, and more chocolate.'
      },
      kyleWillett: {
        title: 'Researcher',
        bio: 'Kyle is an astronomer who studies galaxies, masers, and black holes (although he\'s\nbeen getting more into data science). He works on both Galaxy Zoo and Radio Galaxy Zoo,\nas well as developing advanced tools for the volunteers.'
      },
      lauraTrouille: {
        title: 'Adler Planetarium Zooniverse Director',
        bio: 'In July 2015, Laura became Director of Citizen Science at the Adler Planetarium and co-lead of the Zooniverse. While earning her Ph.D. in astronomy in 2010 studying galaxy evolution, she embodied cosmic collisions as a roller derby queen aptly named The Big Bang.'
      },
      lucyFortson: {
        title: 'University of Minnesota Zooniverse Director',
        bio: 'Associate Professor of Physics and Astronomy at the University of Minnesota. One of the Zooniverse\nco-founders, she helps with project wrangling (aka management) and strategic planning while trying\nto squeeze a bit of galaxy evolution science in.'
      },
      martenVeldthuis: {
        title: 'Developer',
        bio: 'Marten joined the development team at the Zooniverse in 2015. He has a degree in\ncomputer science and enjoys crafting maintainable software. Marten learned about orbital\nmechanics from Kerbal Space Program, and feels like he\'s therefore basically an astrophysicist.'
      },
      megSchwamb: {
        title: 'Researcher',
        bio: 'Meg is a planetary scientist and astronomer involved in the Zooniverse\'s Planet\nFour and Planet Hunters projects. She studies small bodies in the Solar System, exoplanets,\nand Mars. Meg has a fondness for baking, soccer, and champagne.'
      },
      michaelParrish: {
        title: 'Rails/Backend Developer',
        bio: 'Software developer at the Zooniverse. Dog, fishing, snakes, and bourbon.'
      },
      rebeccaSmethurst: {
        title: 'Researcher',
        bio: 'Becky is an astrophysicist working towards her doctorate in Oxford. She is\ninterested in how galaxies change over time and how we can track this evolution.\nHappy-go-lucky about outreach, the Zooniverse and everything.'
      },
      rogerHutchings: {
        title: 'Developer',
        bio: 'Roger builds front end interfaces for the Zooniverse, and enjoys coding, music and rebuilding motorbikes in his spare time.'
      },
      sandorKruk: {
        title: 'Researcher',
        bio: 'Sandor is a graduate student working on his PhD in Astrophysics at Oxford.\nHe is looking at how galaxies evolve using data from Galaxy Zoo and enjoys stargazing,\nusing telescopes, and dancing in his free time.'
      },
      sarahAllen: {
        title: 'Developer',
        bio: 'Sarah Allen is a front-end web developer for the Zooniverse team at the Adler\nPlanetarium starting in September 2014. She also has a degree in music and enjoys cooking\nand live concerts in her free time.'
      },
      saschaIshikawa: {
        title: 'Developer',
        bio: 'Sascha joined the Zooniverse team in November 2013 as a front-end developer.\nA former researcher and software developer at NASA Ames, he received degrees in both\ncomputer science and mechanical engineering.'
      },
      simoneDuca: {
        title: 'Web Developer',
        bio: 'Simone is a front end web developer at the Zooniverse. He has a Phd in logic and philosophy from Bristol and loves cooking.'
      },
      veronicaMaidel: {
        title: 'Data Scientist',
        bio: 'Veronica is a Data Scientist who works on discovering patterns in Zooniverse data, by manipulating it and using it to create machine learning models. She received a PhD in Information Science and Technology from Syracuse University.'
      },
      victoriaVanHyning: {
        title: 'Researcher',
        bio: 'Victoria is a British Academy postdoctoral fellow in English at Oxford, and is the humanities PI at Zooniverse. She works on Science Gossip, Annotate, and Shakespeare\'s World and more. Coffee is her lifeblood.'
      }
    }
  }
});

teamMembers = {
  adamMcMaster: {
    name: "Adam McMaster",
    twitter: "astopy",
    title: counterpart("team.content.adamMcMaster.title"),
    bio: counterpart("team.content.adamMcMaster.bio"),
    image: "./assets/team/adam.jpg",
    location: "oxford"
  },
  alexBowyer: {
    name: "Alex Bowyer",
    twitter: "alexbfree",
    title: counterpart("team.content.alexBowyer.title"),
    bio: counterpart("team.content.alexBowyer.bio"),
    image: "./assets/team/alex_bowyer.jpg",
    location: "oxford"
  },
  aliSwanson: {
    name: "Ali Swanson",
    twitter: "alicatzoo",
    title: counterpart("team.content.aliSwanson.title"),
    bio: counterpart("team.content.aliSwanson.bio"),
    image: "./assets/team/ali.jpg",
    location: "oxford"
  },
  andreaSimenstad: {
    name: "Andrea Simenstad",
    title: counterpart("team.content.andreaSimenstad.title"),
    bio: counterpart("team.content.andreaSimenstad.bio"),
    image: "./assets/team/andrea.jpg",
    location: "minnesota"
  },
  brianCarstensen: {
    name: "Brian Carstensen",
    twitter: "__brian_c__",
    title: counterpart("team.content.brianCarstensen.title"),
    bio: counterpart("team.content.brianCarstensen.bio"),
    image: "./assets/team/brian.jpg",
    location: "oxford"
  },
  brookeSimmons: {
    name: "Brooke Simmons",
    twitter: "vrooje",
    title: counterpart("team.content.brookeSimmons.title"),
    bio: counterpart("team.content.brookeSimmons.bio"),
    image: "./assets/team/brooke.jpg",
    location: "oxford"
  },
  camAllen: {
    name: "Campbell Allen",
    title: counterpart("team.content.camAllen.title"),
    bio: counterpart("team.content.camAllen.bio"),
    image: "./assets/team/cam.jpg",
    location: "oxford"
  },
  chrisLintott: {
    name: "Chris Lintott",
    twitter: "chrislintott",
    title: counterpart("team.content.chrisLintott.title"),
    bio: counterpart("team.content.chrisLintott.bio"),
    image: "./assets/team/chris-l.png",
    location: "oxford"
  },
  christopherDoogue: {
    name: "Christopher Doogue",
    title: counterpart("team.content.christopherDoogue.title"),
    bio: counterpart("team.content.christopherDoogue.bio"),
    image: "./assets/team/chris-d.jpg",
    location: "oxford"
  },
  colemanKrawczyk: {
    name: "Coleman Krawczyk",
    twitter: "ColemanKrawczyk",
    title: counterpart("team.content.colemanKrawczyk.title"),
    bio: counterpart("team.content.colemanKrawczyk.bio"),
    image: "./assets/team/coleman.jpg",
    location: "portsmouth"
  },
  grantMiller: {
    name: "Grant Robert MacKinnon Miller",
    twitter: "mrniaboc",
    title: counterpart("team.content.grantMiller.title"),
    bio: counterpart("team.content.grantMiller.bio"),
    image: "./assets/team/grant.jpg",
    location: "oxford"
  },
  gregHines: {
    name: "Greg Hines",
    title: counterpart("team.content.gregHines.title"),
    bio: counterpart("team.content.gregHines.bio"),
    image: "./assets/team/greg.jpg",
    location: "oxford"
  },
  jenGupta: {
    name: "Jen Gupta",
    twitter: "jen_gupta",
    title: counterpart("team.content.jenGupta.title"),
    bio: counterpart("team.content.jenGupta.bio"),
    image: "./assets/team/jen_gupta.jpg",
    location: "portsmouth"
  },
  jimODonnell: {
    name: "Jim O'Donnell",
    twitter: "pekingspring",
    title: counterpart("team.content.jimODonnell.title"),
    bio: counterpart("team.content.jimODonnell.bio"),
    image: "./assets/team/jim.jpg",
    location: "oxford"
  },
  jordanMartin: {
    name: "Jordan Martin",
    twitter: "jordanIn312",
    title: counterpart("team.content.jordanMartin.title"),
    bio: counterpart("team.content.jordanMartin.bio"),
    image: "./assets/team/jordan.jpg",
    location: "chicago"
  },
  julieFeldt: {
    name: "Julie Feldt",
    twitter: "JulieAFeldt",
    title: counterpart("team.content.julieFeldt.title"),
    bio: counterpart("team.content.julieFeldt.bio"),
    image: "./assets/team/julie.png",
    location: "chicago"
  },
  karenMasters: {
    name: "Karen Masters",
    twitter: "karenlmasters",
    title: counterpart("team.content.karenMasters.title"),
    bio: counterpart("team.content.karenMasters.bio"),
    image: "./assets/team/karen.jpg",
    location: "portsmouth"
  },
  kellyBorden: {
    name: "Kelly Borden",
    twitter: "BordenKelly",
    title: counterpart("team.content.kellyBorden.title"),
    bio: counterpart("team.content.kellyBorden.bio"),
    image: "./assets/team/kelly.jpg",
    location: "chicago"
  },
  kyleWillett: {
    name: "Kyle Willett",
    twitter: "kwwillett",
    title: counterpart("team.content.kyleWillett.title"),
    bio: counterpart("team.content.kyleWillett.bio"),
    image: "./assets/team/kyle.jpg",
    location: "minnesota"
  },
  lauraTrouille: {
    name: "Laura Trouille",
    twitter: "windycityastro",
    title: counterpart("team.content.lauraTrouille.title"),
    bio: counterpart("team.content.lauraTrouille.bio"),
    image: "./assets/team/laura.jpg",
    location: "chicago"
  },
  lucyFortson: {
    name: "Lucy Fortson",
    twitter: "lucyfortson",
    title: counterpart("team.content.lucyFortson.title"),
    bio: counterpart("team.content.lucyFortson.bio"),
    image: "./assets/team/lucy.jpg",
    location: "minnesota"
  },
  martenVeldthuis: {
    name: "Marten Veldthuis",
    twitter: "mveldth",
    title: counterpart("team.content.martenVeldthuis.title"),
    bio: counterpart("team.content.martenVeldthuis.bio"),
    image: "./assets/team/marten.jpg",
    location: "oxford"
  },
  megSchwamb: {
    name: "Meg Schwamb",
    twitter: "megschwamb",
    title: counterpart("team.content.megSchwamb.title"),
    bio: counterpart("team.content.megSchwamb.bio"),
    image: "./assets/team/meg.jpg",
    location: "taipei"
  },
  michaelParrish: {
    name: "Michael Parrish",
    twitter: "michael_parrish",
    title: counterpart("team.content.michaelParrish.title"),
    bio: counterpart("team.content.michaelParrish.bio"),
    image: "./assets/team/michael.png",
    location: "chicago"
  },
  rebeccaSmethurst: {
    name: "Rebecca Smethurst",
    twitter: "becky1505",
    title: counterpart("team.content.rebeccaSmethurst.title"),
    bio: counterpart("team.content.rebeccaSmethurst.bio"),
    image: "./assets/team/becky.jpg",
    location: "oxford"
  },
  rogerHutchings: {
    name: "Roger Hutchings",
    title: counterpart("team.content.rogerHutchings.title"),
    bio: counterpart("team.content.rogerHutchings.bio"),
    image: "./assets/team/roger.jpg",
    location: "oxford"
  },
  sandorKruk: {
    name: "Sandor Kruk",
    twitter: "kruksandor",
    title: counterpart("team.content.sandorKruk.title"),
    bio: counterpart("team.content.sandorKruk.bio"),
    image: "./assets/team/sandor.jpg",
    location: "oxford"
  },
  sarahAllen: {
    name: "Sarah Allen",
    title: counterpart("team.content.sarahAllen.title"),
    bio: counterpart("team.content.sarahAllen.bio"),
    image: "./assets/team/sarah.jpg",
    location: "chicago"
  },
  saschaIshikawa: {
    name: "Sascha Ishikawa",
    twitter: "sascha_ishikawa",
    title: counterpart("team.content.saschaIshikawa.title"),
    bio: counterpart("team.content.saschaIshikawa.bio"),
    image: "./assets/team/sascha.png",
    location: "chicago"
  },
  simoneDuca: {
    name: "Simone Duca",
    title: counterpart("team.content.simoneDuca.title"),
    bio: counterpart("team.content.simoneDuca.bio"),
    image: "./assets/team/simone.jpg",
    location: "oxford"
  },
  veronicaMaidel: {
    name: "Veronica Maidel",
    title: counterpart("team.content.veronicaMaidel.title"),
    bio: counterpart("team.content.veronicaMaidel.bio"),
    image: "./assets/team/veronica.jpg",
    location: "chicago"
  },
  victoriaVanHyning: {
    name: "Victoria van Hyning",
    twitter: "VanHyningV",
    title: counterpart("team.content.victoriaVanHyning.title"),
    bio: counterpart("team.content.victoriaVanHyning.bio"),
    image: "./assets/team/victoria.JPG",
    location: "oxford"
  }
};

module.exports = React.createClass({
  displayName: 'TeamPage',
  getInitialState: function() {
    return {
      currentSort: 'showAll'
    };
  },
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    var details, imageSrc, navItem, sideBarNav, teamMember;
    sideBarNav = counterpart("team.nav");
    return React.createElement("div", {
      "className": "team-page secondary-page-copy"
    }, React.createElement("aside", {
      "className": "secondary-page-side-bar"
    }, React.createElement("nav", {
      "ref": "sideBarNav"
    }, (function() {
      var results;
      results = [];
      for (navItem in sideBarNav) {
        results.push(React.createElement("button", {
          "key": navItem,
          "ref": navItem,
          "className": "secret-button side-bar-button",
          "style": (this.state.currentSort === navItem ? {
            fontWeight: 700
          } : void 0),
          "onClick": this.showPeopleList.bind(null, navItem)
        }, React.createElement(Translate, {
          "content": "team.nav." + navItem
        })));
      }
      return results;
    }).call(this))), React.createElement("section", {
      "className": "team-member-list"
    }, React.createElement("h2", null, (this.state.currentSort === 'showAll' ? React.createElement(Translate, {
      "content": "team.content.header.showAll"
    }) : this.state.currentSort)), (function() {
      var results;
      results = [];
      for (teamMember in teamMembers) {
        details = teamMembers[teamMember];
        if ((this.state.currentSort === details.location) || (this.state.currentSort === 'showAll')) {
          imageSrc = details.image;
          results.push(React.createElement("div", {
            "key": teamMember,
            "className": "team-member"
          }, React.createElement("img", {
            "src": imageSrc,
            "alt": "" + details.name
          }), React.createElement("div", {
            "className": "team-member-details"
          }, React.createElement("h3", null, details.name, ", ", details.title, " ", (details.twitter ? React.createElement("a", {
            "href": "http://twitter.com/" + details.twitter,
            "target": "_blank"
          }, React.createElement("i", {
            "className": "fa fa-twitter"
          })) : void 0)), React.createElement("p", null, details.bio))));
        } else {
          results.push(void 0);
        }
      }
      return results;
    }).call(this)));
  },
  showPeopleList: function(navItem) {
    return this.setState({
      currentSort: navItem
    });
  }
});


},{"counterpart":"counterpart","react":"react","react-translate-component":"react-translate-component"}],128:[function(require,module,exports){
var AdminPage, ChangeListener, IndexLink, Link, React, Translate, counterpart, ref;

React = require('react');

counterpart = require('counterpart');

Translate = require('react-translate-component');

ChangeListener = require('../components/change-listener');

ref = require('react-router'), IndexLink = ref.IndexLink, Link = ref.Link;

counterpart.registerTranslations('en', {
  userAdminPage: {
    header: "Admin",
    nav: {
      createAdmin: "Manage Users",
      projectStatus: "Set Project Status"
    }
  }
});

AdminPage = React.createClass({
  displayName: 'AdminPage',
  render: function() {
    return React.createElement("section", {
      "className": "admin-page-content"
    }, React.createElement("div", {
      "className": "secondary-page admin-page"
    }, React.createElement("h2", null, React.createElement(Translate, {
      "content": "userAdminPage.header"
    })), React.createElement("div", {
      "className": "admin-content"
    }, React.createElement("aside", {
      "className": "secondary-page-side-bar admin-side-bar"
    }, React.createElement("nav", null, React.createElement(IndexLink, {
      "to": "/admin",
      "type": "button",
      "className": "secret-button admin-button",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "userAdminPage.nav.createAdmin"
    })), React.createElement(Link, {
      "to": "/admin/project_status",
      "type": "button",
      "className": "secret-button admin-button",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "userAdminPage.nav.projectStatus"
    })))), React.createElement("section", {
      "className": "admin-tab-content"
    }, React.cloneElement(this.props.children, this.props)))));
  }
});

module.exports = React.createClass({
  displayName: 'AdminPageWrapper',
  render: function() {
    return React.createElement("div", null, React.createElement(ChangeListener, {
      "target": this.props.user
    }, ((function(_this) {
      return function() {
        if (_this.props.user != null) {
          if (_this.props.user.admin) {
            return React.createElement(AdminPage, React.__spread({}, _this.props));
          } else {
            return React.createElement("div", {
              "className": "content-container"
            }, React.createElement("p", null, "You are not an administrator"));
          }
        } else {
          return React.createElement("div", {
            "className": "content-container"
          }, React.createElement("p", null, "Youre not signed in."));
        }
      };
    })(this))));
  }
});


},{"../components/change-listener":63,"counterpart":"counterpart","react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],129:[function(require,module,exports){
var History, Link, Paginator, ProjectIcon, PromiseRenderer, React, apiClient, ref;

React = require('react');

PromiseRenderer = require('../../components/promise-renderer');

apiClient = require('panoptes-client/lib/api-client');

Paginator = require('../../talk/lib/paginator');

ProjectIcon = require('../../components/project-icon');

ref = require('react-router'), History = ref.History, Link = ref.Link;

module.exports = React.createClass({
  displayName: "ProjectStatusPage",
  mixins: [History],
  getProjects: function() {
    var query;
    query = {
      page_size: 24,
      sort: '-updated_at',
      include: 'avatar'
    };
    Object.assign(query, this.props.location.query);
    delete query.filterBy;
    if (query.slug == null) {
      query[this.props.location.query.filterBy] = true;
    }
    return apiClient.type('projects').get(query);
  },
  render: function() {
    return React.createElement("div", {
      "className": "project-status-page"
    }, React.createElement("nav", {
      "className": "project-status-filters"
    }, React.createElement(Link, {
      "to": "/admin/project_status"
    }, "All"), React.createElement(Link, {
      "to": "/admin/project_status?filterBy=launch_approved"
    }, "Launch Approved"), React.createElement(Link, {
      "to": "/admin/project_status?filterBy=launch_requested"
    }, "Launch Requested"), React.createElement(Link, {
      "to": "/admin/project_status?filterBy=beta_approved"
    }, "Beta Approved"), React.createElement(Link, {
      "to": "/admin/project_status?filterBy=beta_requested"
    }, "Beta Requested")), React.createElement(PromiseRenderer, {
      "promise": this.getProjects()
    }, ((function(_this) {
      return function(projects) {
        var projectsMeta, ref1;
        projectsMeta = (ref1 = projects[0]) != null ? ref1.getMeta() : void 0;
        if (projects.length === 0) {
          return React.createElement("div", {
            "className": "project-status-list"
          }, "No projects found for this filter");
        } else {
          return React.createElement("div", null, React.createElement("div", {
            "className": "project-status-list"
          }, projects.map(function(project) {
            var name, owner, ref2;
            ref2 = project.slug.split('/'), owner = ref2[0], name = ref2[1];
            return React.createElement("div", {
              "key": project.id
            }, React.createElement(Link, {
              "to": "/admin/project_status/" + owner + "/" + name
            }, React.createElement(ProjectIcon, {
              "linkTo": false,
              "project": project
            })));
          })), React.createElement(Paginator, {
            "page": (projectsMeta != null ? projectsMeta.page : void 0),
            "pageCount": (projectsMeta != null ? projectsMeta.page_count : void 0)
          }));
        }
      };
    })(this))));
  }
});


},{"../../components/project-icon":85,"../../components/promise-renderer":86,"../../talk/lib/paginator":273,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],130:[function(require,module,exports){
var AutoSave, ChangeListener, EXPERIMENTAL_FEATURES, Link, ProjectExperimentalFeatures, ProjectIcon, ProjectRedirectToggle, ProjectStatus, ProjectToggle, PromiseRenderer, React, SetToggle, VersionList, WorkflowToggle, apiClient, handleInputChange, moment,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

PromiseRenderer = require('../../components/promise-renderer');

apiClient = require('panoptes-client/lib/api-client');

SetToggle = require('../../lib/set-toggle');

Link = require('react-router').Link;

moment = require('moment');

ChangeListener = require('../../components/change-listener');

ProjectIcon = require('../../components/project-icon');

AutoSave = require('../../components/auto-save');

handleInputChange = require('../../lib/handle-input-change');

EXPERIMENTAL_FEATURES = ['survey', 'crop', 'text', 'combo', 'dropdown', 'tutorial', 'field guide', 'mini-course', 'hide classification summaries', 'pan and zoom', 'worldwide telescope', 'hide previous marks', 'column'];

ProjectToggle = React.createClass({
  displayName: "ProjectToggle",
  mixins: [SetToggle],
  getDefaultProps: function() {
    return {
      project: null,
      field: null,
      trueLabel: "True",
      falseLabel: "False"
    };
  },
  getInitialState: function() {
    return {
      error: null,
      setting: {}
    };
  },
  setterProperty: 'project',
  render: function() {
    var setting;
    setting = this.props.project[this.props.field];
    return React.createElement("span", null, React.createElement("label", {
      "style": {
        whiteSpace: 'nowrap'
      }
    }, React.createElement("input", {
      "type": "radio",
      "name": this.props.field,
      "value": true,
      "data-json-value": true,
      "checked": setting,
      "disabled": this.state.setting["private"],
      "onChange": this.set.bind(this, this.props.field, true)
    }), this.props.trueLabel), "      ", React.createElement("label", {
      "style": {
        whiteSpace: 'nowrap'
      }
    }, React.createElement("input", {
      "type": "radio",
      "name": this.props.field,
      "value": false,
      "data-json-value": true,
      "checked": !setting,
      "disabled": this.state.setting["private"],
      "onChange": this.set.bind(this, this.props.field, false)
    }), this.props.falseLabel));
  }
});

WorkflowToggle = React.createClass({
  displayName: "WorkflowToggle",
  mixins: [SetToggle],
  getDefaultProps: function() {
    return {
      workflow: null,
      project: null,
      field: null
    };
  },
  getInitialState: function() {
    return {
      error: null,
      setting: {}
    };
  },
  setterProperty: 'workflow',
  render: function() {
    var setting, workflow;
    workflow = this.props.workflow;
    setting = workflow[this.props.field];
    return React.createElement("span", null, workflow.id, " - ", workflow.display_name, ":", React.createElement("label", {
      "style": {
        whiteSpace: 'nowrap'
      }
    }, React.createElement("input", {
      "type": "checkbox",
      "name": this.props.field,
      "value": setting,
      "checked": setting,
      "onChange": this.set.bind(this, this.props.field, !setting)
    }), "Active"));
  }
});

ProjectExperimentalFeatures = React.createClass({
  displayName: "ProjectExperimentalFeatures",
  getDefaultProps: function() {
    return {
      project: null
    };
  },
  setting: function(task) {
    var ref;
    return indexOf.call(((ref = this.props.project) != null ? ref.experimental_tools : void 0) || [], task) >= 0;
  },
  updateTasks: function(task) {
    var tools;
    tools = this.props.project.experimental_tools || [];
    if (indexOf.call(tools, task) >= 0) {
      tools.splice(tools.indexOf(task), 1);
    } else {
      tools = tools.concat([task]);
    }
    return this.props.project.update({
      experimental_tools: tools
    });
  },
  render: function() {
    return React.createElement("div", {
      "className": "project-status__section"
    }, React.createElement("h4", null, "Experimental Features"), React.createElement(AutoSave, {
      "resource": this.props.project
    }, React.createElement("div", {
      "className": "project-status__section-table"
    }, EXPERIMENTAL_FEATURES.map((function(_this) {
      return function(task) {
        return React.createElement("label", {
          "key": task,
          "className": "project-status__section-table-row"
        }, React.createElement("input", {
          "type": "checkbox",
          "name": task,
          "checked": _this.setting(task),
          "onChange": _this.updateTasks.bind(_this, task)
        }), task.charAt(0).toUpperCase() + task.slice(1));
      };
    })(this)))));
  }
});

ProjectRedirectToggle = React.createClass({
  displayName: "ProjectRedirectToggle",
  mixins: [SetToggle],
  getDefaultProps: function() {
    return {
      project: null,
      validUrlRegex: /https?:\/\/[\w-]+(\.[\w-]*)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/,
      invalidUrl: "invalidUrl"
    };
  },
  getInitialState: function() {
    return {
      error: null
    };
  },
  updateRedirect: function(e) {
    var _redirectUrl;
    _redirectUrl = this.refs.redirectUrl.value;
    if ((_redirectUrl != null ? _redirectUrl.match(this.props.validUrlRegex) : void 0) || _redirectUrl === "") {
      return handleInputChange.call(this.props.project, e);
    } else {
      return this.setState({
        error: this.props.invalidUrl
      });
    }
  },
  validUrlMessage: function() {
    if (this.state.error === this.props.invalidUrl) {
      return "Invalid URL - must be in https?://format";
    }
  },
  render: function() {
    return React.createElement("div", {
      "className": "project-status__section"
    }, React.createElement("h4", null, "Project Redirect"), React.createElement(AutoSave, {
      "resource": this.props.project
    }, React.createElement("input", {
      "type": "text",
      "name": "redirect",
      "ref": "redirectUrl",
      "value": this.props.project.redirect,
      "placeholder": "External redirect",
      "onBlur": this.updateRedirect,
      "onChange": handleInputChange.bind(this.props.project)
    }), React.createElement("span", null, this.validUrlMessage())));
  }
});

VersionList = React.createClass({
  displayName: "VersionList",
  getDefaultProps: function() {
    return {
      project: null
    };
  },
  render: function() {
    return React.createElement(PromiseRenderer, {
      "promise": this.props.project.get('versions')
    }, ((function(_this) {
      return function(versions) {
        var vs;
        vs = versions.sort();
        React.createElement("h4", null, "Recent Status Changes");
        return React.createElement("ul", {
          "className": "project-status__section-list"
        }, vs.map(function(version) {
          var from, key, m, to;
          key = Object.keys(version.changeset)[0];
          from = version.changeset[key][0].toString();
          to = version.changeset[key][1].toString();
          m = moment(version.created_at);
          return React.createElement(PromiseRenderer, {
            "key": version.id,
            "promise": apiClient.type('users').get(version.whodunnit)
          }, (function(user) {
            return React.createElement("li", null, user.display_name, " changed ", key, " from ", from, " to ", to, " ", m.fromNow());
          }));
        }));
      };
    })(this)));
  }
});

ProjectStatus = React.createClass({
  displayName: "ProjectStatus",
  getDefaultProps: function() {
    return {
      project: null
    };
  },
  render: function() {
    return React.createElement(ChangeListener, {
      "target": this.props.project
    }, ((function(_this) {
      return function() {
        return React.createElement("div", {
          "className": "project-status"
        }, React.createElement(ProjectIcon, {
          "project": _this.props.project
        }), React.createElement("div", {
          "className": "project-status__section"
        }, React.createElement("h4", null, "Visibility Settings"), React.createElement("ul", {
          "className": "project-status__section-list"
        }, React.createElement("li", null, "Private: ", React.createElement(ProjectToggle, {
          "project": _this.props.project,
          "field": "private",
          "trueLabel": "Private",
          "falseLabel": "Public"
        })), React.createElement("li", null, "Live: ", React.createElement(ProjectToggle, {
          "project": _this.props.project,
          "field": "live",
          "trueLabel": "Live",
          "falseLabel": "Development"
        })), React.createElement("li", null, "Beta Requested: ", React.createElement(ProjectToggle, {
          "project": _this.props.project,
          "field": "beta_requested"
        })), React.createElement("li", null, "Beta Approved: ", React.createElement(ProjectToggle, {
          "project": _this.props.project,
          "field": "beta_approved"
        })), React.createElement("li", null, "Launch Requested: ", React.createElement(ProjectToggle, {
          "project": _this.props.project,
          "field": "launch_requested"
        })), React.createElement("li", null, "Launch Approved: ", React.createElement(ProjectToggle, {
          "project": _this.props.project,
          "field": "launch_approved"
        })))), React.createElement(ProjectRedirectToggle, {
          "project": _this.props.project
        }), React.createElement(ProjectExperimentalFeatures, {
          "project": _this.props.project
        }), React.createElement("div", {
          "className": "project-status__section"
        }, React.createElement("h4", null, "Workflow Settings"), React.createElement(PromiseRenderer, {
          "promise": _this.props.project.get('workflows')
        }, (function(workflows) {
          if (workflows.length === 0) {
            return React.createElement("div", {
              "className": "workflow-status-list"
            }, "No workflows found");
          } else {
            return React.createElement("div", {
              "className": "workflow-status-list"
            }, React.createElement("ul", {
              "className": "project-status__section-list"
            }, workflows.map(function(workflow) {
              return React.createElement("li", {
                "key": workflow.id
              }, React.createElement(WorkflowToggle, {
                "workflow": workflow,
                "project": _this.props.project,
                "field": "active"
              }));
            })));
          }
        }))), React.createElement("hr", null), React.createElement("div", {
          "className": "project-status__section"
        }, React.createElement(VersionList, {
          "project": _this.props.project
        })));
      };
    })(this)));
  }
});

module.exports = React.createClass({
  displayName: "ProjectStatusPage",
  getProject: function() {
    var name, owner, ref, slug;
    ref = this.props.params, owner = ref.owner, name = ref.name;
    slug = owner + "/" + name;
    return apiClient.type('projects').get({
      slug: slug
    });
  },
  render: function() {
    return React.createElement(PromiseRenderer, {
      "promise": this.getProject()
    }, ((function(_this) {
      return function(arg) {
        var project;
        project = arg[0];
        return React.createElement(ProjectStatus, {
          "project": project
        });
      };
    })(this)));
  }
});


},{"../../components/auto-save":62,"../../components/change-listener":63,"../../components/project-icon":85,"../../components/promise-renderer":86,"../../lib/handle-input-change":103,"../../lib/set-toggle":115,"moment":"moment","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],131:[function(require,module,exports){
var AutoSave, PromiseRenderer, React, ReactDOM, UserLimitToggle, UserSearch, UserSettings, apiClient, handleInputChange;

React = require('react');

ReactDOM = require('react-dom');

UserSearch = require('../../components/user-search');

PromiseRenderer = require('../../components/promise-renderer');

apiClient = require('panoptes-client/lib/api-client');

AutoSave = require('../../components/auto-save');

handleInputChange = require('../../lib/handle-input-change');

UserSettings = React.createClass({
  displayName: "User Settings",
  getDefaultProps: function() {
    return {
      editUser: null
    };
  },
  componentDidMount: function() {
    var ref;
    if (this._boundForceUpdate == null) {
      this._boundForceUpdate = this.forceUpdate.bind(this);
    }
    return (ref = this.props.editUser) != null ? ref.listen('change', this._boundForceUpdate) : void 0;
  },
  componentWillReceiveProps: function(nextProps) {
    var ref;
    if ((ref = this.props.editUser) != null) {
      ref.stopListening('change', this._boundForceUpdate);
    }
    return nextProps.editUser.listen('change', this._boundForceUpdate);
  },
  render: function() {
    var handleChange;
    if (this.props.editUser != null) {
      handleChange = handleInputChange.bind(this.props.editUser);
      return React.createElement("div", {
        "className": "project-status"
      }, React.createElement("h4", null, "Settings for ", this.props.editUser.login), React.createElement("ul", null, React.createElement("li", null, React.createElement(AutoSave, {
        "resource": this.props.editUser
      }, React.createElement("input", {
        "type": "checkbox",
        "name": "admin",
        "checked": this.props.editUser.admin,
        "disabled": true,
        "onChange": handleChange
      }), ' ', "Admin")), React.createElement("li", null, React.createElement(AutoSave, {
        "resource": this.props.editUser
      }, React.createElement("input", {
        "type": "checkbox",
        "name": "login_prompt",
        "checked": this.props.editUser.login_prompt,
        "disabled": true,
        "onChange": handleChange
      }), ' ', "Login prompt")), React.createElement("li", null, React.createElement(AutoSave, {
        "resource": this.props.editUser
      }, React.createElement("input", {
        "type": "checkbox",
        "name": "private_profile",
        "checked": this.props.editUser.private_profile,
        "disabled": true,
        "onChange": handleChange
      }), ' ', "Private profile")), React.createElement("li", null, React.createElement(AutoSave, {
        "resource": this.props.editUser
      }, React.createElement("input", {
        "type": "checkbox",
        "name": "upload_whitelist",
        "checked": this.props.editUser.upload_whitelist,
        "onChange": handleChange
      }), ' ', "Whitelist subject uploads"))), React.createElement("ul", null, React.createElement("li", null, "Uploaded subjects: ", this.props.editUser.uploaded_subjects_count), React.createElement("li", null, React.createElement(UserLimitToggle, {
        "editUser": this.props.editUser
      }))));
    } else {
      return React.createElement("div", null, "No user found");
    }
  }
});

UserLimitToggle = React.createClass({
  displayName: "User limit toggle",
  getDefaultProps: function() {
    return {
      editUser: null,
      invalidLimit: "invalidLimit"
    };
  },
  getInitialState: function() {
    return {
      error: null
    };
  },
  validLimit: function(limit) {
    var n;
    if (limit === "") {
      return false;
    } else {
      n = ~~Number(limit);
      return String(n) === limit && n >= 0;
    }
  },
  updateLimit: function(e) {
    var _subject_limit;
    _subject_limit = this.refs.subjectLimit.value;
    if (this.validLimit(_subject_limit)) {
      return handleInputChange.call(this.props.editUser, e);
    } else {
      return this.setState({
        error: this.props.invalidLimit
      });
    }
  },
  errorMessage: function() {
    if (this.state.error === this.props.invalidLimit) {
      return "Must be a positive integer";
    } else if (this.state.error === this.props.invalidLimit) {
      return "kasjdhkdjshf";
    }
  },
  render: function() {
    return React.createElement("div", null, React.createElement(AutoSave, {
      "resource": this.props.editUser
    }, "Subject Limit:", ' ', React.createElement("input", {
      "type": "number",
      "name": "subject_limit",
      "min": "1",
      "ref": "subjectLimit",
      "value": this.props.editUser.max_subjects,
      "onBlur": this.updateLimit,
      "onChange": handleInputChange.bind(this.props.editUser)
    }), React.createElement("span", null, this.errorMessage())));
  }
});

module.exports = React.createClass({
  displayName: "User Settings List",
  getInitialState: function() {
    return {
      userId: null,
      editUser: null
    };
  },
  listUsers: function(e) {
    var userId, userSelect;
    e.preventDefault();
    userSelect = ReactDOM.findDOMNode(this).querySelector('[name="userids"]');
    userId = userSelect.value;
    if (userId != null) {
      this.setState({
        userId: userId
      });
      return this.forceUpdate();
    }
  },
  render: function() {
    return React.createElement("div", null, React.createElement("div", {
      "className": "columns-container"
    }, React.createElement("div", {
      "className": "column"
    }, React.createElement(UserSearch, {
      "multi": false
    })), React.createElement("button", {
      "type": "button",
      "onClick": this.listUsers
    }, "Find user")), (this.state.userId != null ? React.createElement(PromiseRenderer, {
      "promise": apiClient.type('users').get(this.state.userId)
    }, ((function(_this) {
      return function(editUser) {
        if (editUser === _this.props.user) {
          return React.createElement("p", null, "Can\'t edit your own account");
        } else if (editUser != null) {
          return React.createElement(UserSettings, {
            "editUser": editUser
          });
        }
      };
    })(this))) : void 0));
  }
});


},{"../../components/auto-save":62,"../../components/promise-renderer":86,"../../components/user-search":95,"../../lib/handle-input-change":103,"panoptes-client/lib/api-client":549,"react":"react","react-dom":"react-dom"}],132:[function(require,module,exports){
var CollectionsList, CollectionsNav, FavoritesList, IndexLink, Link, List, OwnedCardList, React, TitleMixin, Translate, apiClient, counterpart, ref;

counterpart = require('counterpart');

React = require('react');

TitleMixin = require('../lib/title-mixin');

apiClient = require('panoptes-client/lib/api-client');

OwnedCardList = require('../components/owned-card-list');

Translate = require('react-translate-component');

ref = require('react-router'), Link = ref.Link, IndexLink = ref.IndexLink;

counterpart.registerTranslations('en', {
  collectionsPage: {
    title: '%(user)s Collections',
    countMessage: 'Showing %(count)s found',
    button: 'View Collection',
    loadMessage: 'Loading Collections',
    notFoundMessage: 'No Collections Found',
    myCollections: 'My Collections',
    favorites: 'My Favorites',
    all: 'All'
  }
});

CollectionsNav = React.createClass({
  displayName: 'CollectionsNav',
  render: function() {
    return React.createElement("nav", {
      "className": "hero-nav"
    }, React.createElement(IndexLink, {
      "to": "/collections",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "collectionsPage.all"
    })), (this.props.user != null ? React.createElement(Link, {
      "to": "/collections/" + this.props.user.login,
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "collectionsPage.myCollections"
    })) : void 0), (this.props.user != null ? React.createElement(Link, {
      "to": "/favorites/" + this.props.user.login,
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "collectionsPage.favorites"
    })) : void 0));
  }
});

List = React.createClass({
  displayName: 'List',
  imagePromise: function(collection) {
    return apiClient.type('subjects').get({
      collection_id: collection.id,
      page_size: 1
    }).then(function(arg) {
      var firstKey, subject;
      subject = arg[0];
      if (subject != null) {
        firstKey = Object.keys(subject.locations[0])[0];
        return subject.locations[0][firstKey];
      } else {
        return '/simple-avatar.jpg';
      }
    });
  },
  cardLink: function(collection) {
    var name, owner, ref1;
    ref1 = collection.slug.split('/'), owner = ref1[0], name = ref1[1];
    return "/collections/" + owner + "/" + name;
  },
  listCollections: function() {
    var query, ref1;
    query = {};
    if (((ref1 = this.props.params) != null ? ref1.owner : void 0) != null) {
      query.owner = this.props.params.owner;
      query.include = 'owner';
    }
    query.favorite = this.props.favorite;
    Object.assign(query, this.props.location.query);
    return apiClient.type('collections').get(query);
  },
  render: function() {
    var ref1, ref2;
    return React.createElement(OwnedCardList, React.__spread({}, this.props, {
      "translationObjectName": "collectionsPage",
      "listPromise": this.listCollections(),
      "linkTo": "collections",
      "heroNav": React.createElement(CollectionsNav, {
        "user": this.props.user
      }),
      "heroClass": "collections-hero",
      "ownerName": ((ref1 = this.props.params) != null ? ref1.owner : void 0),
      "skipOwner": !((ref2 = this.props.params) != null ? ref2.owner : void 0),
      "imagePromise": this.imagePromise,
      "cardLink": this.cardLink
    }));
  }
});

FavoritesList = React.createClass({
  displayName: 'FavoritesPage',
  mixins: [TitleMixin],
  title: 'Favorites',
  render: function() {
    var props;
    props = Object.assign({}, this.props, {
      favorite: true
    });
    return React.createElement(List, React.__spread({}, props));
  }
});

CollectionsList = React.createClass({
  displayName: 'CollectionsPage',
  mixins: [TitleMixin],
  title: 'Collections',
  render: function() {
    var props;
    props = Object.assign({}, this.props, {
      favorite: false
    });
    return React.createElement(List, React.__spread({}, props));
  }
});

module.exports = {
  FavoritesList: FavoritesList,
  CollectionsList: CollectionsList
};


},{"../components/owned-card-list":82,"../lib/title-mixin":117,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],133:[function(require,module,exports){
var ClassificationViewer, Classifier, DevClassifierPage, React, mockData, tasks;

React = require('react');

Classifier = require('../../classifier');

mockData = require('./mock-data');

tasks = require('../../classifier/tasks');

ClassificationViewer = React.createClass({displayName: "ClassificationViewer",
  getDefaultProps: function() {
    return {
      classification: null
    };
  },
  getInitialState: function() {
    return {
      showOnlyLast: false,
      showThrowaways: false
    };
  },
  componentDidMount: function() {
    this._boundForceUpdate = this.forceUpdate.bind(this);
    return mockData.classification.listen(this._boundForceUpdate);
  },
  componentWillUnmount: function() {
    mockData.classification.stopListening(this._boundForceUpdate);
    return this._boundForceUpdate = null;
  },
  ignoreUnderscoredProperties: function(key, value) {
    if (key.charAt(0) !== '_') {
      return value;
    }
  },
  render: function() {
    var replacer, showing;
    showing = this.state.showOnlyLast ? this.props.classification.annotations[this.props.classification.annotations.length - 1] : this.props.classification.annotations;
    replacer = this.state.showThrowaways ? null : this.ignoreUnderscoredProperties;
    return React.createElement("div", null, React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "checked": this.state.showOnlyLast,
      "onChange": ((function(_this) {
        return function(e) {
          return _this.setState({
            showOnlyLast: e.target.checked
          });
        };
      })(this))
    }), ' ', "Show only the last annotation"), "      ", React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "checked": this.state.showThrowaways,
      "onChange": ((function(_this) {
        return function(e) {
          return _this.setState({
            showThrowaways: e.target.checked
          });
        };
      })(this))
    }), ' ', "Show throwaway properties"), React.createElement("br", null), React.createElement("pre", null, JSON.stringify(showing, replacer, 2)));
  }
});

DevClassifierPage = React.createClass({displayName: "DevClassifierPage",
  getDefaultProps: function() {
    return {
      classification: mockData.classification,
      project: mockData.project
    };
  },
  componentDidMount: function() {
    document.body.style.backgroundColor = '#444';
    return document.body.style.color = 'white';
  },
  componentWillUnmount: function() {
    document.body.style.backgroundColor = '';
    return document.body.style.color = '';
  },
  reload: function() {
    var FirstTaskComponent, firstAnnotation, firstTask, workflow;
    workflow = this.props.classification._workflow;
    firstTask = workflow.tasks[workflow.first_task];
    FirstTaskComponent = tasks[firstTask.type];
    firstAnnotation = Object.assign({
      task: workflow.first_task
    }, FirstTaskComponent.getDefaultAnnotation());
    return this.props.classification.update({
      completed: false,
      annotations: [firstAnnotation]
    });
  },
  render: function() {
    return React.createElement("div", {
      "className": "content-container"
    }, React.createElement(Classifier, {
      "project": this.props.project,
      "classification": this.props.classification,
      "onClickNext": this.reload
    }), React.createElement("hr", null), React.createElement(ClassificationViewer, {
      "classification": this.props.classification
    }));
  }
});

module.exports = DevClassifierPage;


},{"../../classifier":16,"../../classifier/tasks":36,"./mock-data":134,"react":"react"}],134:[function(require,module,exports){
var BLANK_IMAGE, MISC_DRAWING_DETAILS, apiClient, classification, project, subject, workflow;

apiClient = require('panoptes-client/lib/api-client');

BLANK_IMAGE = ['data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAHgAQMAAAA', 'PH06nAAAABlBMVEXMzMyWlpYU2uzLAAAAPUlEQVR4nO3BAQ0AAADCoPdPbQ43oAAAAAAAAAAAAA', 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgzwCX4AAB9Dl2RwAAAABJRU5ErkJggg=='].join('');

MISC_DRAWING_DETAILS = [
  {
    type: 'single',
    question: 'Cool?',
    answers: [
      {
        label: 'Yeah'
      }, {
        label: 'Nah'
      }
    ]
  }, {
    type: 'multiple',
    question: 'Cool stuff?',
    answers: [
      {
        label: 'Ice'
      }, {
        label: 'Snow'
      }
    ]
  }, {
    type: 'text',
    instruction: 'Any additional comments?'
  }
];

workflow = apiClient.type('workflows').create({
  id: 'MOCK_WORKFLOW_FOR_CLASSIFIER',
  configuration: {
    enable_subject_flags: true,
    multi_image_mode: 'flipbook_and_separate'
  },
  first_task: 'init',
  tasks: {
    init: {
      type: 'single',
      question: 'Where shall we start?',
      help: 'You dont need help with this.',
      answers: [
        {
          label: 'Everything all at once! :skull:',
          next: 'combo'
        }, {
          label: 'Crop the image',
          next: 'crop'
        }, {
          label: 'Enter some text',
          next: 'write'
        }, {
          label: 'Single-answer question',
          next: 'ask'
        }, {
          label: 'Multi-answer question',
          next: 'features'
        }, {
          label: 'Draw stuff',
          next: 'draw'
        }, {
          label: 'Survey the image',
          next: 'survey'
        }, {
          label: 'Maybe select something',
          next: 'dropdown'
        }, {
          label: 'Were done here.',
          next: null
        }
      ]
    },
    combo: {
      type: 'combo',
      loosen_requirements: true,
      tasks: ['crop', 'write', 'ask', 'features', 'draw', 'survey'],
      next: 'init'
    },
    crop: {
      type: 'crop',
      instruction: 'Drag out a box around the smaller rhino.',
      help: 'Thats the adorable one.',
      next: 'write'
    },
    write: {
      type: 'text',
      required: true,
      instruction: 'Whats the name of this animal? Is it a rhino?',
      help: '**Example**: If you see a bee, then type "Bee"',
      next: 'ask'
    },
    ask: {
      type: 'single',
      question: 'Rhino starts with...',
      answers: [
        {
          label: 'Are',
          next: 'features'
        }, {
          label: 'Aitch',
          next: 'features'
        }, {
          label: 'Eye',
          next: 'features'
        }, {
          label: 'En',
          next: 'features'
        }, {
          label: 'Oh',
          next: 'features'
        }
      ]
    },
    features: {
      type: 'multiple',
      question: 'What **cool** features are present? The first two?',
      answers: [
        {
          label: 'Cold water'
        }, {
          label: 'Snow'
        }, {
          label: 'Ice'
        }, {
          label: 'Sunglasses'
        }
      ],
      next: 'draw'
    },
    draw: {
      type: 'drawing',
      required: true,
      instruction: 'Drop a point on the rhino eyeball.',
      help: 'Do this:\n* Pick a tool\n* Draw something',
      tools: [
        {
          type: 'point',
          label: 'Point',
          color: 'red',
          min: 1,
          max: 2
        }, {
          type: 'line',
          label: 'Line',
          color: 'yellow',
          min: 0
        }, {
          type: 'rectangle',
          label: 'Rectangle',
          color: 'lime',
          max: 2
        }, {
          type: 'polygon',
          label: 'Polygon',
          color: 'cyan',
          details: MISC_DRAWING_DETAILS
        }, {
          type: 'circle',
          label: 'Circle',
          color: 'blue',
          details: MISC_DRAWING_DETAILS
        }, {
          type: 'ellipse',
          label: 'Ellipse '.repeat(25),
          color: 'magenta',
          details: MISC_DRAWING_DETAILS
        }, {
          type: 'bezier',
          label: 'Bezier',
          color: 'orange',
          details: MISC_DRAWING_DETAILS
        }, {
          type: 'column',
          label: 'Column Rectangle',
          color: 'darkgreen'
        }
      ],
      next: 'survey'
    },
    survey: {
      type: 'survey',
      images: {
        aa1: '//placehold.it/64x32.png?text=AA1_WIDE',
        aa2: '//placehold.it/64.png?text=AA2',
        ar1: '//placehold.it/64x32.png?text=AR1_WIDE',
        ar2: '//placehold.it/64.png?text=AR2',
        to1: '//placehold.it/64x32.png?text=TO1_WIDE',
        to2: '//placehold.it/64.png?text=TO2',
        so: '//placehold.it/48.png?text=so',
        sp: '//placehold.it/48.png?text=sp',
        st: '//placehold.it/48.png?text=st',
        ba: '//placehold.it/48.png?text=ba',
        wh: '//placehold.it/48.png?text=wh',
        ta: '//placehold.it/48.png?text=ta',
        re: '//placehold.it/48.png?text=re',
        br: '//placehold.it/48.png?text=br',
        bl: '//placehold.it/48.png?text=bl',
        gr: '//placehold.it/48.png?text=gr'
      },
      characteristicsOrder: ['pa', 'co'],
      characteristics: {
        pa: {
          label: 'Pattern',
          valuesOrder: ['so', 'sp', 'st', 'ba'],
          values: {
            so: {
              label: 'Solid',
              image: 'so'
            },
            sp: {
              label: 'Spots',
              image: 'sp'
            },
            st: {
              label: 'Stripes',
              image: 'st'
            },
            ba: {
              label: 'Bands',
              image: 'ba'
            }
          }
        },
        co: {
          label: 'Color',
          valuesOrder: ['wh', 'ta', 're', 'br', 'bl', 'gr'],
          values: {
            wh: {
              label: 'White',
              image: 'wh'
            },
            ta: {
              label: 'Tan',
              image: 'ta'
            },
            re: {
              label: 'Red',
              image: 're'
            },
            br: {
              label: 'Brown',
              image: 'br'
            },
            bl: {
              label: 'Black',
              image: 'bl'
            },
            gr: {
              label: 'Green',
              image: 'gr'
            }
          }
        }
      },
      choicesOrder: ['aa', 'ar', 'to'],
      choices: {
        aa: {
          label: 'Aardvark',
          description: 'Basically a long-nose rabbit',
          images: ['aa1', 'aa2'],
          characteristics: {
            pa: ['so'],
            co: ['ta', 'br']
          },
          confusionsOrder: ['ar'],
          confusions: {
            ar: 'They both start with A, so _some_ **dummies** get these two mixed up.'
          }
        },
        ar: {
          label: 'Armadillo',
          description: 'A little rolly dude',
          images: ['ar1', 'ar2'],
          characteristics: {
            pa: ['so', 'st'],
            co: ['ta', 'br']
          },
          confusionsOrder: [],
          confusions: {}
        },
        to: {
          label: 'Tortoise',
          description: 'Little green house with legs',
          images: ['to1', 'to2'],
          characteristics: {
            pa: ['so'],
            co: ['gr']
          },
          confusionsOrder: [],
          confusions: {}
        }
      },
      questionsMap: {
        ar: ['ho', 'be'],
        to: ['ho', 'be', 'in', 'bt']
      },
      questionsOrder: ['ho', 'be', 'in', 'hr'],
      questions: {
        ho: {
          required: true,
          multiple: false,
          label: 'How many?',
          answersOrder: ['one', 'two', 'many'],
          answers: {
            one: {
              label: '1'
            },
            two: {
              label: '2'
            },
            many: {
              label: '3+'
            }
          }
        },
        be: {
          required: true,
          multiple: true,
          label: 'Any activity?',
          answersOrder: ['mo', 'ea', 'in'],
          answers: {
            mo: {
              label: 'Moving'
            },
            ea: {
              label: 'Eating'
            },
            "in": {
              label: 'Interacting'
            }
          }
        },
        "in": {
          required: false,
          label: 'Any injuries?',
          answersOrder: ['y', 'n'],
          answers: {
            y: {
              label: 'Yep'
            },
            n: {
              label: 'Nope'
            }
          }
        },
        hr: {
          required: false,
          multiple: true,
          label: 'Horns (toggle)',
          answersOrder: ['y'],
          answers: {
            y: {
              label: 'Present'
            }
          }
        },
        bt: {
          required: true,
          multiple: false,
          label: 'Are tortoises awesome?',
          answersOrder: ['y', 'Y'],
          answers: {
            y: {
              label: 'yes'
            },
            Y: {
              label: 'HECK YES'
            }
          }
        }
      },
      next: 'init'
    },
    dropdown: {
      next: 'write',
      type: 'dropdown',
      instruction: "Select something, or if it's not an option - write it!",
      selects: [
        {
          id: "cd1c7a8a13726",
          title: "Country",
          required: true,
          options: {
            '*': [
              {
                value: "USA",
                label: "United States of America"
              }, {
                value: "Canada",
                label: "Canada"
              }, {
                value: "Mypos",
                label: "Mypos"
              }
            ]
          }
        }, {
          id: "26971f135cb4b",
          title: "State/Province",
          required: true,
          allowCreate: false,
          condition: "cd1c7a8a13726",
          options: {
            'USA': [
              {
                value: "HI",
                label: "Hawaii"
              }, {
                value: "IL",
                label: "Illinois"
              }, {
                value: "WI",
                label: "Wisconsin"
              }
            ],
            'Canada': [
              {
                value: "AB",
                label: "Alberta"
              }, {
                value: "ON",
                label: "Ontario"
              }, {
                value: "QC",
                label: "Quebec"
              }
            ],
            'Mypos': [
              {
                value: "Gondor",
                label: "Gondor"
              }, {
                value: "Rohan",
                label: "Rohan"
              }, {
                value: "Shire",
                label: "Shire"
              }
            ]
          }
        }, {
          id: "8f7afd193da42",
          title: "County",
          allowCreate: false,
          condition: "26971f135cb4b",
          options: {
            'USA;HI': [
              {
                value: "Honolulu",
                label: "Honolulu"
              }, {
                value: "Maui",
                label: "Maui"
              }
            ],
            'USA;IL': [
              {
                value: "Cook",
                label: "Cook"
              }, {
                value: "Lake",
                label: "Lake"
              }
            ],
            'Canada;AB': [
              {
                value: "Rocky View",
                label: "Rocky View"
              }, {
                value: "Parkland",
                label: "Parkland"
              }
            ],
            'Canada;QC': [
              {
                value: "Montreal",
                label: "Montreal"
              }, {
                value: "Capitale-Nationale",
                label: "Capitale-Nationale"
              }
            ],
            'Mypos;Rohan': [
              {
                value: "Gotham County",
                label: "Gotham County"
              }, {
                value: "Metropolis County",
                label: "Metropolis County"
              }
            ],
            'Mypos;Shire': [
              {
                value: "Municipality of Bikini Bottom",
                label: "Municipality of Bikini Bottom"
              }, {
                value: "Elbonia",
                label: "Elbonia"
              }
            ]
          }
        }, {
          id: "fdd12d9f1ad52",
          title: "City",
          allowCreate: false,
          condition: "8f7afd193da42",
          options: {
            'USA;HI;Honolulu': [
              {
                value: "Honolulu",
                label: "Honolulu city"
              }
            ],
            'USA;IL;Cook': [
              {
                value: "Chicago",
                label: "Chicago"
              }, {
                value: "Evanston",
                label: "Evanston"
              }
            ],
            'USA;IL;Lake': [
              {
                value: "Waukegan",
                label: "Waukegan"
              }, {
                value: "Wheeling",
                label: "Wheeling"
              }
            ],
            'Canada;AB;Rocky View': [
              {
                value: "Airdrie",
                label: "Airdrie"
              }, {
                value: "Chestermere",
                label: "Chestermere"
              }
            ],
            'Canada;QC;Capitale-Nationale': [
              {
                value: "Quebec City",
                label: "Quebec City"
              }, {
                value: "Saint-Raymond",
                label: "Saint-Raymond"
              }
            ],
            'Mypos;Rohan;Gotham County': [
              {
                value: "Gotham",
                label: "Gotham"
              }
            ],
            'Mypos;Rohan;Metropolis County': [
              {
                value: "Metropolis",
                label: "Metropolis"
              }
            ],
            'Mypos;Shire;Municipality of Bikini Bottom': [
              {
                value: "Bikini Bottom",
                label: "Bikini Bottom"
              }
            ],
            'Mypos;Shire;Elbonia': [
              {
                value: "Townbert",
                label: "Townbert"
              }
            ]
          }
        }, {
          id: "e45fdf113f07e",
          title: "Best State Sports Team",
          allowCreate: true,
          condition: "26971f135cb4b",
          options: {
            'USA;HI': [
              {
                value: "59d8b49f6a0bc",
                label: "Sharks"
              }, {
                value: "1df102313d355",
                label: "Rainbow Warriors"
              }
            ],
            'USA;IL': [
              {
                value: "b085abfe3c4d9",
                label: "Bears"
              }, {
                value: "964419c0f3ade",
                label: "Bulls"
              }, {
                value: "e4430cd2c0be",
                label: "Blackhawks"
              }
            ],
            'Canada;AB': [
              {
                value: "6df716c19bf73",
                label: "Oilers"
              }, {
                value: "23843c7b8ca3a",
                label: "Flames"
              }
            ],
            'Canada;QC': [
              {
                value: "105ee8e45828c",
                label: "Canadiens"
              }, {
                value: "ade89b3bed25c",
                label: "Expos"
              }
            ],
            'Mypos;Shire': [
              {
                value: "084f28a8999be",
                label: "Mighty Ducks"
              }, {
                value: "b52ad46b3818e",
                label: "Little Giants"
              }
            ],
            'Mypos;Rohan': [
              {
                value: "df7cb03611f08",
                label: "Shelbyville Shelbyvillians"
              }, {
                value: "fac0841caac4e",
                label: "Springfield Isotopes"
              }
            ]
          }
        }
      ]
    }
  }
});

'abcdefghijlkmnopqrstuvwxyz1234'.split('').forEach(function(x, i) {
  var xi;
  xi = x + i;
  workflow.tasks.survey.choicesOrder.push(xi);
  return workflow.tasks.survey.choices[xi] = {
    label: xi,
    description: xi,
    images: [Object.keys(workflow.tasks.survey.images)[Math.floor(Math.random() * Object.keys(workflow.tasks.survey.images).length)]],
    characteristics: (function() {
      var out;
      out = {};
      workflow.tasks.survey.characteristicsOrder.forEach(function(charID) {
        return out[charID] = workflow.tasks.survey.characteristics[charID].valuesOrder.filter(function() {
          return Math.random() < 0.5;
        });
      });
      return out;
    })(),
    confusionsOrder: [],
    confusions: {}
  };
});

subject = apiClient.type('subjects').create({
  id: 'MOCK_SUBJECT_FOR_CLASSIFIER',
  locations: [
    {
      'image/jpeg': (typeof navigator !== "undefined" && navigator !== null ? navigator.onLine : void 0) ? '//lorempixel.com/320/240/animals/1' : BLANK_IMAGE
    }, {
      'image/jpeg': (typeof navigator !== "undefined" && navigator !== null ? navigator.onLine : void 0) ? '//lorempixel.com/320/240/animals/2' : BLANK_IMAGE
    }, {
      'image/jpeg': (typeof navigator !== "undefined" && navigator !== null ? navigator.onLine : void 0) ? '//lorempixel.com/320/240/animals/3' : BLANK_IMAGE
    }
  ],
  metadata: {
    'Capture date': '5 Feb, 2015',
    'Region': 'Chicago, IL'
  },
  expert_classification_data: {
    MOCK_WORKFLOW_FOR_CLASSIFIER: apiClient.type('classifications').create({
      annotations: [
        {
          task: 'init',
          value: 0
        }, {
          task: 'crop',
          value: {
            x: 20,
            y: 57,
            width: 224,
            height: 142
          }
        }, {
          task: 'write',
          value: 'Rhino'
        }, {
          task: 'ask',
          value: 0
        }, {
          task: 'features',
          value: [0, 1]
        }, {
          task: 'draw',
          value: [
            {
              tool: 0,
              frame: 0,
              x: 207,
              y: 134,
              details: [
                {
                  value: 0
                }, {
                  value: []
                }, {
                  value: ''
                }
              ]
            }
          ]
        }, {
          task: 'survey',
          value: []
        }, {
          task: 'init',
          value: 6
        }
      ]
    })
  }
});

project = apiClient.type('project').create({
  id: 'MOCK_PROJECT_FOR_CLASSIFIER',
  title: "The Dev Classifier",
  experimental_tools: ['pan and zoom']
});

classification = apiClient.type('classifications').create({
  annotations: [],
  metadata: {},
  links: {
    project: project.id,
    workflow: workflow.id,
    subjects: [subject.id]
  },
  _workflow: workflow,
  _subjects: [subject]
});

module.exports = {
  workflow: workflow,
  subject: subject,
  classification: classification,
  project: project
};

if (typeof window !== "undefined" && window !== null) {
  window.mockClassifierData = module.exports;
}


},{"panoptes-client/lib/api-client":549}],135:[function(require,module,exports){
var FEATURED_PRODUCT_IDS, FeaturedProjects, Link, Markdown, OwnedCard, ProjectIcon, PromiseRenderer, React, Translate, ZooniverseLogoType, apiClient, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Link = require('react-router').Link;

apiClient = require('panoptes-client/lib/api-client');

PromiseRenderer = require('../components/promise-renderer');

ZooniverseLogoType = require('../partials/zooniverse-logotype');

OwnedCard = require('../partials/owned-card');

FEATURED_PRODUCT_IDS = require('../lib/featured-projects');

Markdown = require('markdownz').Markdown;

ProjectIcon = require('../components/project-icon');

counterpart.registerTranslations('en', {
  home: {
    hero: {
      title: 'People-Powered Research',
      tagline: 'The Zooniverse provides opportunities for people around the world to contribute to real discoveries in fields ranging from astronomy to zoology. Welcome to the largest online platform for collaborative volunteer research.',
      button: 'Get involved now!'
    },
    about: {
      contribute: {
        title: 'Contribute to new research',
        content: 'The Zooniverse lets everyone take part in real, cutting-edge research in many fields across the sciences, humanities, and more. Theres no previous experience required; just pick a project and [get started right away](/projects).'
      },
      explore: {
        title: 'Explore incredible worlds',
        content: 'Astronomical marvels, exotic wildlife in their natural habitats, original historical documents: just a few of the fascinating things youll get to experience in the Zooniverse. In many cases, youll literally be seeing things no one has seen before.'
      },
      collaborate: {
        title: 'Collaborate with researchers',
        content: 'Professional researchers and volunteers share our [discussion boards](/talk), using them to explore and analyse project data. Much of the most exciting research produced by the Zooniverse originates from these partnerships.'
      },
      discover: {
        title: 'Discover, teach, and learn',
        content: 'Our platform offers many opportunities for education, from using projects in classrooms to sharing information between volunteers. You can even use the [Zooniverse Project Builder](/lab) to create your very own project!'
      }
    },
    featuredProjects: {
      title: 'Get started on a project right now!',
      loggedTitle: 'Get started on a new project right now!',
      button: 'See all projects'
    },
    recentProjects: {
      title: "Welcome back! Jump into one of your recent projects...",
      altTitle: "Welcome! Jump into a new project...",
      button: 'See all your projects',
      altButton: 'See all our projects'
    }
  }
});

FeaturedProjects = React.createClass({
  displayName: "FeaturedProjects",
  imagePromise: function(project) {
    var src;
    src = project.avatar_src ? "//" + project.avatar_src : './assets/simple-avatar.jpg';
    return Promise.resolve(src);
  },
  render: function() {
    return React.createElement("div", {
      "className": "featured-projects"
    }, React.createElement(PromiseRenderer, {
      "promise": apiClient.type('projects').get({
        id: FEATURED_PRODUCT_IDS,
        cards: true
      })
    }, ((function(_this) {
      return function(projects) {
        var name, owner, project;
        if (projects != null) {
          return React.createElement("div", {
            "className": "featured-projects-list"
          }, (function() {
            var i, len, ref, results;
            results = [];
            for (i = 0, len = projects.length; i < len; i++) {
              project = projects[i];
              ref = project.slug.split('/'), owner = ref[0], name = ref[1];
              results.push(React.createElement(OwnedCard, {
                "key": project.id,
                "resource": project,
                "linkTo": "/projects/" + owner + "/" + name,
                "translationObjectName": "projectsPage",
                "imagePromise": this.imagePromise(project),
                "skipOwner": true
              }));
            }
            return results;
          }).call(_this));
        }
      };
    })(this))), React.createElement(Link, {
      "to": "/projects",
      "className": "call-to-action standard-button x-large"
    }, React.createElement(Translate, {
      "content": "home.featuredProjects.button"
    })));
  }
});

module.exports = React.createClass({
  displayName: 'HomePage',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-home-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-home-page');
  },
  lastFourProjects: function() {
    return this.props.user.get("project_preferences", {
      page_size: 4,
      sort: '-updated_at'
    });
  },
  render: function() {
    var aboutItems, item;
    aboutItems = ['contribute', 'explore', 'collaborate', 'discover'];
    return React.createElement("div", {
      "className": "home-page"
    }, React.createElement("section", {
      "className": "hero on-dark"
    }, React.createElement(ZooniverseLogoType, null), (this.props.user ? React.createElement(PromiseRenderer, {
      "promise": this.lastFourProjects()
    }, ((function(_this) {
      return function(projectPreferences) {
        if (projectPreferences.length > 0) {
          return React.createElement("div", {
            "className": "recent-projects"
          }, React.createElement(Translate, {
            "component": "h5",
            "content": "home.recentProjects.title"
          }), React.createElement("div", {
            "className": "recent-projects-list"
          }, projectPreferences.map(function(projectPreference) {
            return React.createElement(PromiseRenderer, {
              "key": projectPreference.id,
              "promise": projectPreference.get('project'),
              "catch": null,
              "then": (function(project) {
                if (project != null) {
                  return React.createElement("div", null, React.createElement(ProjectIcon, {
                    "project": project,
                    "badge": projectPreference.activity_count
                  }), "                          ");
                } else {
                  return null;
                }
              })
            });
          })), React.createElement(Link, {
            "to": "/users/" + _this.props.user.login + "/stats",
            "className": "call-to-action standard-button x-large"
          }, React.createElement(Translate, {
            "content": "home.recentProjects.button"
          })));
        } else {
          return React.createElement("div", {
            "className": "recent-projects"
          }, React.createElement(Translate, {
            "component": "h5",
            "content": "home.recentProjects.altTitle"
          }), React.createElement(PromiseRenderer, {
            "promise": apiClient.type('projects').get({
              launch_approved: true,
              page_size: 4,
              cards: true
            })
          }, (function(projects) {
            return React.createElement("div", {
              "className": "recent-projects-list"
            }, projects.map(function(project) {
              return React.createElement("div", null, React.createElement(ProjectIcon, {
                "key": project.id,
                "project": project
              }), "                        ");
            }));
          })), React.createElement(Link, {
            "to": "/projects",
            "className": "call-to-action standard-button hero-button x-large"
          }, React.createElement(Translate, {
            "content": "home.recentProjects.altButton"
          })));
        }
      };
    })(this))) : React.createElement("div", null, React.createElement("h3", {
      "className": "hero-title"
    }, React.createElement(Translate, {
      "content": "home.hero.title"
    })), React.createElement("p", {
      "className": "hero-tagline"
    }, React.createElement(Translate, {
      "content": "home.hero.tagline"
    })), React.createElement(Link, {
      "to": "/projects",
      "className": "call-to-action standard-button hero-button x-large"
    }, React.createElement(Translate, {
      "content": "home.hero.button"
    }))))), (this.props.user == null ? React.createElement("section", {
      "className": "about-zooniverse"
    }, React.createElement("div", {
      "className": "about-items-list"
    }, (function() {
      var i, len, results;
      results = [];
      for (i = 0, len = aboutItems.length; i < len; i++) {
        item = aboutItems[i];
        results.push(React.createElement("div", {
          "key": item,
          "className": "about-item"
        }, React.createElement("div", {
          "className": "about-item-wrapper"
        }, React.createElement("img", {
          "className": "about-image",
          "src": "./assets/home-" + item + ".gif",
          "alt": ""
        }), React.createElement("div", {
          "className": "about-item-content"
        }, React.createElement(Translate, {
          "component": "h5",
          "content": "home.about." + item + ".title"
        }), React.createElement(Markdown, null, counterpart("home.about." + item + ".content"))))));
      }
      return results;
    })())) : void 0), React.createElement("section", {
      "className": "featured-projects content-container"
    }, (this.props.user != null ? React.createElement(Translate, {
      "component": "h5",
      "content": "home.featuredProjects.loggedTitle"
    }) : React.createElement(Translate, {
      "component": "h5",
      "content": "home.featuredProjects.title"
    })), React.createElement(FeaturedProjects, null)));
  },
  showLoginDialog: function(which) {
    return alert(function(resolve) {
      return React.createElement(LoginDialog, {
        "which": which,
        "onSuccess": resolve
      });
    });
  }
});


},{"../components/project-icon":85,"../components/promise-renderer":86,"../lib/featured-projects":101,"../partials/owned-card":223,"../partials/zooniverse-logotype":231,"counterpart":"counterpart","markdownz":"markdownz","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],136:[function(require,module,exports){
var apiClient = require('panoptes-client/lib/api-client');
var counterpart = require('counterpart');

var projects = apiClient.type('projects');

var projectActions = {
  createProject: function(projectData) {
    var allProjectData = Object.assign({
      primary_language: counterpart.getLocale(),
      private: true
    }, projectData);

    return projects.create(allProjectData).save();
  }
}

module.exports = projectActions;

},{"counterpart":"counterpart","panoptes-client/lib/api-client":549}],137:[function(require,module,exports){
var apiClient = require('panoptes-client/lib/api-client');

var workflows = apiClient.type('workflows');

var workflowActions = {
  createWorkflowForProject: function(projectID, workflowData) {
    var allWorkflowData = Object.assign({
      links: {project: projectID}
    }, workflowData);

    return workflows.create(allWorkflowData).save();
  }
}

module.exports = workflowActions;

},{"panoptes-client/lib/api-client":549}],138:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  bestPracticesGreatProjectsPage: {
    content: '# Part I: Building a Great Project\n\n----------\n\n__Know that you are making a commitment!__ Building, launching, and (especially) maintaining an engaging project takes time and sustained effort. Before you even start, your project team should be prepared to remain personally involved with your project for its entire lifespan. Reduce your individual workloads by delegating responsibilities to each member of your team.\n\n__Understand your goals and expectations from the start.__ The end goal of a Zooniverse project generally should be to produce new research from volunteers efforts. Be sure that your project design and messaging reflect the tangible goal that you are working towards.\n\n__Consider reaching out to Zooniverse volunteers early on.__ Some of our most successful projects in terms of engagement have been those built in cooperation with volunteers. You might find volunteers interested in helping with your build on Zooniverse Talks [Project Building board](/talk/18).\n\n__Keep everything short and simple.__ Your volunteers are smart, but most will not be experts. Avoid jargon and complex questions. Make the tasks fairly basic, and consolidate them when possible. Ideally, a 10- or 12-year-old child should be able to understand and do your project.\n\n__Help text should help volunteers answer the question.__ When volunteers click "Need Some Help?" they are seeking help in answering that question. There are other areas in the project to describe your research; the help text is for visual examples and question-specific guidance. You can (and should) discuss your research goals in depth on your projects Research page.\n\n__Use images as examples wherever possible.__ Visual examples of what you are asking volunteers to look for are extremely important to have in addition to text descriptions. Consider offering a variety of examples of "correctly" classified data to educate volunteers.\n\n__Create informative content and a solid name and tagline.__ The title of your project should be short and punchy; your tagline should try to "hook" volunteers. Use your static pages (Research, FAQs, etc.) to explain your project clearly and resolve the most common questions about it.\n\n__Be prepared to test and make changes.__ However good your projects "first draft" is, volunteer testing (including the formal Zooniverse "project review" stage) will reveal things to alter. You should first test your project with contacts, friends, or family who are trying it for the first timeand watch them as they do it! Study your feedback and raw data, and make adjustments. \n\n__Make your project visually clean and interesting.__ Choose imagery that fits your projects aesthetic and that you have permission to use. Make sure that text is readable over your background. Also be sure to do a review to make sure that all of your text is displaying properly.'
  }
});

module.exports = React.createClass({
  displayName: 'LabBestPracticesGreatProjectsPage',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement(Markdown, null, counterpart("bestPracticesGreatProjectsPage.content"));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],139:[function(require,module,exports){
var IndexLink, Link, React, Translate, counterpart, ref;

React = require('react');

counterpart = require('counterpart');

Translate = require('react-translate-component');

ref = require('react-router'), Link = ref.Link, IndexLink = ref.IndexLink;

counterpart.registerTranslations('en', {
  bestPractices: {
    title: 'Best Practices',
    nav: {
      introduction: 'Introduction',
      greatProject: 'Building a Great Project',
      launchRush: 'The Launch Rush',
      theLongHaul: 'In For the Long Haul',
      resources: 'Resources and Examples'
    }
  }
});

module.exports = React.createClass({
  displayName: 'LabBestPracticesNav',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement("div", {
      "className": "best-practices-page secondary-page"
    }, React.createElement("section", {
      "className": "hero"
    }, React.createElement("div", {
      "className": "hero-container"
    }, React.createElement(Translate, {
      "content": "bestPractices.title",
      "component": "h1"
    }), React.createElement("nav", {
      "className": "hero-nav"
    }, React.createElement(IndexLink, {
      "to": "/lab-best-practices/introduction",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "bestPractices.nav.introduction"
    })), React.createElement(Link, {
      "to": "/lab-best-practices/great-project",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "bestPractices.nav.greatProject"
    })), React.createElement(Link, {
      "to": "/lab-best-practices/launch-rush",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "bestPractices.nav.launchRush"
    })), React.createElement(Link, {
      "to": "/lab-best-practices/the-long-haul",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "bestPractices.nav.theLongHaul"
    })), React.createElement(Link, {
      "to": "/lab-best-practices/resources",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "bestPractices.nav.resources"
    }))))), React.createElement("section", {
      "className": "centered-grid content-container"
    }, this.props.children));
  }
});


},{"counterpart":"counterpart","react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],140:[function(require,module,exports){
var Link, Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Link = require('react-router').Link;

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  bestPracticesIntroductionPage: {
    content: '# Building, Launching, and Running Your Zooniverse Project:\n# Best Practices for Engagement & Success\n\n## Introduction: "Best Practices," What and Why?\n\n----------\n\nWelcome! If you are reading this, you are probably interested in starting a Zooniverse project using the Project Builder. Perhaps your images/subjects are prepared, you have a compelling research case, and you know what information you are looking for... all that you need now is to process those images and turn them into data, so that you can make the breakthrough of the century in your field. We say, greatyouve come to the right place!\n\nFirst, however, take a moment to consider the Zooniverse slogan: __People-Powered Research__.\n\nWhy is that so important? Well, because its true. Simply put, __volunteers are the lifeblood of a Zooniverse project__, and only with their efforts can your project accomplish its research goals. Your projects amateur researchers are not a data-processing machine: they are people with many options for how to spend their free time, who (may) freely choose to help you. Thus, it is critical to the success of your project that you __engage__ your participants as much as possible.\n\nVolunteer engagement takes many forms, and may differ from project to project. To get you started, this document contains a set of basic "best practices" for engagement that new research teams should consider as they create and manage a project. These best practices were identified by experienced volunteers, researchers, and Zooniverse staff at a Sept. 2015 workshop, funded by the Alfred P. Sloan Foundation, at Chicagos Adler Planetarium. They are organized into three categories:\n\nBuilding your project to be appealing and volunteer-friendly.\nLaunching your project and recruiting volunteers.\nManaging your project from post-launch to completion.\n\nAlthough these best practices are for the most part __non-mandatory suggestions__, they are drawn from significant experience, and __we strongly recommend reading through this entire article before you start building your project!__ It may be useful to refer back to it later on as well.\n\nPlease read on for how to [Build a Great Project](/lab-best-practices/great-project), and best of luck with your project!\n\n&mdash; *The Zooniverse Team*'
  }
});

module.exports = React.createClass({
  displayName: 'LabBestPracticesIntroductionPage',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement(Markdown, null, counterpart("bestPracticesIntroductionPage.content"));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],141:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  bestPracticesLaunchRushPage: {
    content: '# Part II: The Launch Rush\n\n----------\n\n__Understand the importance of the launch period!__ The first few days following the launch of your project are critical. Thousands of volunteers will be trying the project and deciding if they want to become regular classifiers. Your classifications per day will likely spike, then fall and level out; your level of long-term engagement depends largely on what you do during launch.\n\n__Write an amazing newsletter.__ For new Zooniverse projects, a newsletter will announce the project to over a million volunteers; it can bring huge traffic. Your newsletter should be short and personal, clearly describing the project and its goals. Include links to the project and associated sites (blog, social media, etc.). Dont use styling or imagesplain-text newsletters do best.\n\n__Have a promotion plan in place.__ The most successful projects will recruit new volunteers from outside the Zooniverse volunteer pool. Coordinate with your organizations communications department. Try to promote to any existing networks or known interest groups; seek out press attention. Also see if you can leverage connections with related organizations for promotion.\n\n__"Talk" to your volunteers!__ One appealing element of the Zooniverse is that volunteers can engage directly with professional researchers on the Talk discussion boards. Your presence in these first few days is especially important. By answering questions, youre helping volunteers feel more comfortable and laying the foundation for those volunteers to teach future newcomers.\n\n__Prepare your blog, social media, and Talk, and be active.__ These are critical for developing deeper engagement, especially during your launch. Make sure that several boards are set up on Talk and that research team members are prepared to quickly respond to volunteers. During launch, consider daily blog posts and up to five posts per day on social-media accounts.\n\n__Have a plan to identify and appoint moderators.__ [Moderators](https://docs.google.com/document/d/1L8LwYy_uUxwX1NqE5sXi0fnrjZKG1DZu1fWLath9BOE) have additional authority on Talk and are a resource for new volunteers. They are appointed by youtypically after asking them personally. Choose mods wisely. You might start with a volunteer who is a mod on another project, then add first-timers later. Be sure that your moderators understand your expectations.\n\n__Expect things to go wrong, and be ready to fix them.__ In the attention that your project receives shortly after launch, you may discover additional issues that you will need to address immediately. Broken projects, or ones with messaging issues, do not engage and retain volunteers well. Update your FAQ with questions that you find yourself frequently responding to.\n\n__Plan your transition from launch to operating your project.__ After about a week, the launch frenzy will subside and less of your time will be required. However, you will still need to continue to engage with your volunteers and oversee your project. This is discussed further in Part III.'
  }
});

module.exports = React.createClass({
  displayName: 'LabBestPracticesLaunchRushPage',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement(Markdown, null, counterpart("bestPracticesLaunchRushPage.content"));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],142:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  bestPracticesAppendixPage: {
    content: '# Appendix: Resources and Examples\n\n----------\n\n### Useful Links, Blog Posts, and Documents:\n\n- [Project Builder Policies](/lab-policies) &mdash; Official Zooniverse policy about user-built projects.\n- [Examples of Strong Newsletters](https://docs.google.com/document/d/1xB0nNPzwwzNgCwm0_ZufIy-0I6HX3OG2YHkVZ-oBQCo/edit?usp=sharing) &mdash; Samples of newsletters we have used. \n- [What Are Moderators For?](https://docs.google.com/document/d/1L8LwYy_uUxwX1NqE5sXi0fnrjZKG1DZu1fWLath9BOE) &mdash; Learn what moderators are and why you want them.\n- [Measuring Success in Citizen Science Projects: Part 1](http://blog.zooniverse.org/2015/08/24/measuring-success-in-citizen-science-projects-part-1-methods/) and [Part 2](http://blog.zooniverse.org/2015/08/24/measuring-success-in-citizen-science-projects-part-2-results/) &mdash; An analysis of past (and current) Zooniverse projects, demonstrating the importance of engagement.\n- [Who Are The Zooniverse Community? We Asked Them&hellip;](http://blog.zooniverse.org/2015/03/05/who-are-the-zooniverse-community-we-asked-them/) &mdash; A summary of results from a survey of Zooniverse volunteers conducted as part of a masters thesis in 2014-2015.\n- [Zooniverse GitHub](https://github.com/zooniverse) &mdash; Zooniverses code base. You can submit issues and pull requests.\n- [Zooniverse Researchers & Moderators](https://www.facebook.com/groups/123295911357282/) &mdash; Private Facebook group that you may join.\n- [Zooniverse Backchannel Blog](https://zoobackchannel.wordpress.com/) &mdash; Private blog you may request to join. Posts are relatively rare and often concerned with technical details of handling Zooniverse data.\n- [17 Tools for Social Media](https://www.quicksprout.com/2015/08/14/17-tools-thatll-take-your-social-media-marketing-results-to-the-next-level/) &mdash; Social media is important, but can also be time-consuming. These tools can help you pre-schedule, analyze, and get the most out of your posts.\n- [The Power of a Challenge](http://blog.zooniverse.org/2015/08/31/sunspotter-citizen-science-challenge-update-zooniverse-volunteers-are-overachievers/) &mdash; A challenge that got 650,000 classifications in a weekend.\n- [Zooniverse "Meta" Publications](/about/publications) &mdash; for those wishing to know a lot more about research into the practice of citizen science. (Click the "Meta" link on the left side of the page.)\n- [Why We Dont Have an I Dont Know Button](http://blog.snapshotserengeti.org/2012/12/14/we-need-an-i-dont-know-button/) &mdash; Volunteers often ask for some way to express uncertainty. Using Snapshot Serengeti, this explains why we want a best guess.\n- [Federal Crowdsourcing and Citizen Science Toolkit](https://crowdsourcing-toolkit.sites.usa.gov/) &mdash; Running a citizen science project from within the federal government comes with added constraints. This kit can help.\n\n### Examples of Project Builder Projects:\n\n- [Fossil Finder](/projects/adrianevans/fossil-finder) &mdash; Good example of content: name, tagline, help text/images, info pages.\n- [Whales as Individuals](/projects/tedcheese/whales-as-individuals) &mdash; Good example of tasks/questions with multiple workflows.\n- [Planet Four: Terrains](/projects/mschwamb/planet-four-terrains) &mdash; Has a strong focus on researcher/volunteer interaction on Talk.\n- ["Kitteh Zoo"](/projects/vrooje/kitteh-zoo) &mdash; Lighthearted sample project illustrating many of the Builders capabilities.\n\n### Examples of Gamized Behavior:\n\n- [Chimp & See Talk](http://talk.chimpandsee.org/) &mdash; This popular Talk is also used for the "Chimp ID" process: a good example of non-competitive gamized behavior that also serves a research purpose.\n- [My Galaxies](http://writing.galaxyzoo.org/) &mdash; Write text using galaxies as letters; built with volunteer help.\n- Cookie recipes for [Seafloor Explorer](http://blog.seafloorexplorer.org/2013/12/13/crunchy-buttery-sea-stars/), [Worm Watch Lab](http://blog.wormwatchlab.org/2013/12/17/green-eggs-and-worms/) and [Notes From Nature](blog.notesfromnature.org/2013/12/21/cookies-from-nature/).\n- [Snapshot Serengeti Meme Generator](http://blog.snapshotserengeti.org/2013/07/31/save-the-memes/) &mdash; allowed users to caption photos (now defunct).\n- Zooniverse project cocktails for Advent, [part one](http://blog.zooniverse.org/2013/12/22/zooniverse-cocktails/) and [part two](http://blog.zooniverse.org/2011/12/20/zooniverse-cocktail-hour/).\n- [Just for Fun](http://blog.zooniverse.org/category/fun/) &mdash; Various "fun" posts on the Zooniverse blog, many about gamizing.'
  }
});

module.exports = React.createClass({
  displayName: 'LabBestPracticesAppendixPage',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement(Markdown, null, counterpart("bestPracticesAppendixPage.content"));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],143:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  bestPracticesTheLongHaulPage: {
    content: '# Part III: In For the Long Haul\n\n----------\n\n__Even after launch, running your project demands a time investment.__ You should dedicate time each week to volunteer engagement. Set up a plan in advance for who on your team will do what, and how often. Commit to your plan, and hold each other to it!\n\n__Send occasional reminder emails to your volunteers.__ Sometimes volunteers do forget about projects. The Zooniverse Communications team can help you send newsletters to your volunteers. Newsletters are proven to bring people back to projects and boost classifications.\n\n__Give people a reason to join your community.__ Volunteers who discuss your project on Talk, social media, etc. often remain more devoted. You may be able to entice more people to do this if, in addition to your posting regularly, you give them a specific purpose. For instance, volunteers could collect examples of rare objects, or find the same animal in multiple images.\n\n__Make it fun to be a part of your project.__ Your research may be serious, but that doesnt mean taking part cant be fun! Instead of competitive gamification (a turnoff for some), try \'gamizing\' instead, with wry commentary, puns, captions, or other whimsical non-competitive amusement.\n\n__Dont be afraid of volunteers!__ Just as your volunteers are better at classifying than they think, you are better at communicating to them than you think. As a professional researcher, you will command an automatic degree of respect to volunteers; use it to educate and engage.\n\n__Report back to volunteers on what theyve accomplished.__ In a survey, over 90&#37; of Zoo volunteers said they classify to help advance research. Use blogs and social media posts to illustrate how their work is having a tangible effect and helping make discoveries. Encouraging new volunteers is especially important. Updates dont have to be detailed; brief reports are fine!\n\n__Pay close attention to your project metrics.__ Your metrics are a valuable tool in evaluating the success of your engagement initiatives. Use them to inform decisions. Currently, a classification counter is available, and you can obtain additional information by querying your database.\n\n__Consider giving volunteers more ways to contribute.__ Some Zooniverse volunteers have conducted in-depth data analyses, written sorting algorithms, and become co-authors with researchers on peer-reviewed papers. Volunteers can also help with blogs and social media.\n\n__End your project and do right by your volunteers.__ When your project has been completed, thank your volunteers and explain what happens next. We expect researchers to use the results of the project in peer-reviewed research, and to share results with the community. Classification data should also be made open after a proprietary period. More information can be found [here](/lab-policies).'
  }
});

module.exports = React.createClass({
  displayName: 'LabBestPracticesTheLongHaulPage',
  componentDidMount: function() {
    return document.documentElement.classList.add('on-secondary-page');
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  render: function() {
    return React.createElement(Markdown, null, counterpart("bestPracticesTheLongHaulPage.content"));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],144:[function(require,module,exports){
var CollaboratorCreator, ID_PREFIX, POSSIBLE_ROLES, PromiseRenderer, ROLES_INFO, React, ReactDOM, UserSearch, apiClient, projectSection, talkClient,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

ReactDOM = require('react-dom');

PromiseRenderer = require('../../components/promise-renderer');

UserSearch = require('../../components/user-search');

apiClient = require('panoptes-client/lib/api-client');

talkClient = require('panoptes-client/lib/talk-client');

projectSection = require('../../talk/lib/project-section');

ID_PREFIX = 'LAB_COLLABORATORS_PAGE_';

POSSIBLE_ROLES = {
  collaborator: 'admin',
  expert: 'team',
  scientist: 'scientist',
  moderator: 'moderator',
  tester: 'team'
};

ROLES_INFO = {
  collaborator: {
    label: 'Collaborator',
    description: 'Collaborators have full access to edit workflows and project content, including deleting some or all of the project.'
  },
  expert: {
    label: 'Expert',
    description: 'Experts can enter "gold mode" to make authoritative gold standard classifications that will be used to validate data quality.'
  },
  scientist: {
    label: 'Researcher',
    description: 'Members of the research team will be marked as researchers on "Talk"'
  },
  moderator: {
    label: 'Moderator',
    description: 'Moderators have extra privileges in the community discussion area to moderate discussions. They will also be marked as moderators on "Talk".'
  },
  tester: {
    label: 'Tester',
    description: 'Testers can view and classify on your project to give feedback while its still private. They cannot access the project builder.'
  },
  translator: {
    label: 'Translator',
    description: 'Translators will have access to the translation site.'
  }
};

CollaboratorCreator = React.createClass({
  displayName: 'CollaboratorCreator',
  getDefaultProps: function() {
    return {
      project: null
    };
  },
  getInitialState: function() {
    return {
      error: null,
      creating: false
    };
  },
  render: function() {
    var label, role, style;
    style = this.state.creating ? {
      opacity: 0.5,
      pointerEvents: 'none'
    } : void 0;
    return React.createElement("div", null, (this.state.error != null ? React.createElement("p", {
      "className": "form-help error"
    }, this.state.error.toString()) : void 0), React.createElement("form", {
      "style": style
    }, React.createElement("div", null, React.createElement(UserSearch, null)), React.createElement("table", {
      "className": "standard-table"
    }, React.createElement("tbody", null, (function() {
      var results;
      results = [];
      for (role in POSSIBLE_ROLES) {
        label = POSSIBLE_ROLES[role];
        results.push(React.createElement("tr", {
          "key": role + '-' + label
        }, React.createElement("td", null, React.createElement("input", {
          "id": ID_PREFIX + role,
          "type": "checkbox",
          "name": "role",
          "value": role,
          "disabled": role === 'owner'
        })), React.createElement("td", null, React.createElement("strong", null, React.createElement("label", {
          "htmlFor": ID_PREFIX + role
        }, ROLES_INFO[role].label))), React.createElement("td", null, ROLES_INFO[role].description)));
      }
      return results;
    })())), React.createElement("p", null, React.createElement("button", {
      "type": "submit",
      "className": "major-button",
      "onClick": this.handleSubmit
    }, "Add user role"))));
  },
  handleSubmit: function(e) {
    var checkbox, checkboxes, newRoles, node, role, roleSet, roles, talkRole, talkRoles, userids, users;
    e.preventDefault();
    node = ReactDOM.findDOMNode(this);
    checkboxes = node.querySelectorAll('[name="role"]');
    userids = node.querySelector('[name="userids"]');
    users = userids.value.split(',').map(function(id) {
      return parseInt(id);
    });
    roles = (function() {
      var i, len, results;
      results = [];
      for (i = 0, len = checkboxes.length; i < len; i++) {
        checkbox = checkboxes[i];
        if (checkbox.checked) {
          results.push(checkbox.value);
        }
      }
      return results;
    })();
    talkRoles = (function() {
      var results;
      results = [];
      for (role in POSSIBLE_ROLES) {
        talkRole = POSSIBLE_ROLES[role];
        if (indexOf.call(roles, role) >= 0) {
          results.push(talkRole);
        }
      }
      return results;
    })();
    talkRoles = talkRoles.reduce((function(memo, role) {
      if (indexOf.call(memo, role) < 0) {
        memo.push(role);
      }
      return memo;
    }), []);
    this.setState({
      error: null,
      creating: true
    });
    newRoles = users.reduce(((function(_this) {
      return function(memo, id) {
        var newRoleSet, newTalkRoleSets;
        newRoleSet = apiClient.type('project_roles').create({
          roles: roles,
          links: {
            project: _this.props.project.id,
            user: id
          }
        });
        newTalkRoleSets = (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = talkRoles.length; i < len; i++) {
            role = talkRoles[i];
            results.push(talkClient.type('roles').create({
              name: role,
              section: projectSection(this.props.project),
              user_id: id
            }));
          }
          return results;
        }).call(_this);
        return memo.concat([newRoleSet]).concat(newTalkRoleSets);
      };
    })(this)), []);
    return Promise.all((function() {
      var i, len, results;
      results = [];
      for (i = 0, len = newRoles.length; i < len; i++) {
        roleSet = newRoles[i];
        results.push(roleSet.save());
      }
      return results;
    })()).then((function(_this) {
      return function() {
        var base, i, len;
        userids.value = '';
        for (i = 0, len = checkboxes.length; i < len; i++) {
          checkbox = checkboxes[i];
          checkbox.checked = false;
        }
        return typeof (base = _this.props).onAdd === "function" ? base.onAdd.apply(base, arguments) : void 0;
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        if (error.message.match(/not allowed to create this role/i)) {
          error.message = 'Your account status on this project is still being setup. Please try again later.';
        }
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          creating: false
        });
      };
    })(this));
  }
});

module.exports = React.createClass({
  displayName: 'EditProjectCollaborators',
  getDefaultProps: function() {
    return {
      project: null
    };
  },
  getInitialState: function() {
    return {
      error: null,
      saving: []
    };
  },
  fetchAllRoles: function() {
    return Promise.all([
      this.props.project.get('project_roles'), talkClient.type('roles').get({
        section: this.talkSection(),
        page_size: 100
      })
    ]).then(function(arg) {
      var i, len, panoptesRoles, results, roleSet, talkRoles;
      panoptesRoles = arg[0], talkRoles = arg[1];
      results = [];
      for (i = 0, len = panoptesRoles.length; i < len; i++) {
        roleSet = panoptesRoles[i];
        if (!(roleSet.links.owner.type === 'users')) {
          continue;
        }
        roleSet['talk_roles'] = talkRoles.filter(function(role) {
          return role.links.user === roleSet.links.owner.id;
        });
        results.push(roleSet);
      }
      return results;
    });
  },
  render: function() {
    return React.createElement("div", null, React.createElement("div", {
      "className": "form-label"
    }, "Project Owner"), React.createElement(PromiseRenderer, {
      "promise": this.props.project.get('owner'),
      "then": ((function(_this) {
        return function(projectOwner) {
          var projectOwnerMessage;
          projectOwnerMessage = _this.props.user.id === projectOwner.id ? 'You are the project owner.' : projectOwner.display_name + ' is the project owner.';
          return React.createElement("p", null, projectOwnerMessage);
        };
      })(this))
    }), React.createElement("br", null), React.createElement("div", {
      "className": "form-label"
    }, "Collaborators"), React.createElement("hr", null), (this.state.error != null ? React.createElement("p", {
      "className": "form-help error"
    }, this.state.error.toString()) : void 0), React.createElement(PromiseRenderer, {
      "promise": this.fetchAllRoles(),
      "then": ((function(_this) {
        return function(projectRoleSets) {
          var projectRoleSet;
          return React.createElement("div", null, ((function() {
            var i, len, results;
            if (projectRoleSets.length > 1) {
              results = [];
              for (i = 0, len = projectRoleSets.length; i < len; i++) {
                projectRoleSet = projectRoleSets[i];
                if (indexOf.call(projectRoleSet.roles, 'owner') < 0) {
                  results.push(React.createElement(PromiseRenderer, {
                    "key": projectRoleSet.id,
                    "promise": projectRoleSet.get('owner'),
                    "then": this.renderUserRow.bind(this, projectRoleSet)
                  }));
                }
              }
              return results;
            } else {
              return React.createElement("em", {
                "className": "form-help"
              }, "None yet");
            }
          }).call(_this)));
        };
      })(this))
    }), React.createElement("hr", null), React.createElement("div", {
      "className": "form-label"
    }, "Add another"), React.createElement(CollaboratorCreator, {
      "project": this.props.project,
      "onAdd": this.handleCollaboratorAddition
    }));
  },
  renderUserRow: function(projectRoleSet, user) {
    var _, role, toggleThisRole;
    return React.createElement("p", null, React.createElement("strong", null, user.display_name), ' ', React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "onClick": this.removeRoleSet.bind(this, projectRoleSet)
    }, ""), React.createElement("br", null), React.createElement("span", {
      "className": "columns-container inline"
    }, (function() {
      var ref, results;
      results = [];
      for (role in POSSIBLE_ROLES) {
        _ = POSSIBLE_ROLES[role];
        toggleThisRole = this.toggleRole.bind(this, projectRoleSet, role);
        results.push(React.createElement("label", {
          "key": role
        }, React.createElement("input", {
          "type": "checkbox",
          "name": role,
          "checked": (indexOf.call(projectRoleSet.roles, role) >= 0),
          "disabled": role === 'owner' || (ref = projectRoleSet.id, indexOf.call(this.state.saving, ref) >= 0),
          "onChange": toggleThisRole
        }), ' ', ROLES_INFO[role].label));
      }
      return results;
    }).call(this)));
  },
  toggleRole: function(projectRoleSet, role) {
    var filteredRoles, index, ref, talkRoleAction;
    index = projectRoleSet.roles.indexOf(role);
    this.state.saving.push(projectRoleSet.id);
    this.setState({
      error: null,
      saving: this.state.saving
    });
    talkRoleAction = index === -1 ? (projectRoleSet.roles.push(role), talkClient.type('roles').create({
      user_id: parseInt(projectRoleSet.links.owner.id),
      section: this.talkSection(),
      name: POSSIBLE_ROLES[role]
    }).save()) : (projectRoleSet.roles.splice(index, 1), filteredRoles = projectRoleSet.talk_roles.filter(function(talkRole) {
      return talkRole.name === POSSIBLE_ROLES[role];
    }), (ref = filteredRoles[0]) != null ? ref["delete"]() : void 0);
    return Promise.all([projectRoleSet.update('roles').save(), talkRoleAction])["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        var savingIndex;
        savingIndex = _this.state.saving.indexOf(projectRoleSet.id);
        _this.state.saving.splice(savingIndex, 1);
        return _this.setState({
          saving: _this.state.saving
        });
      };
    })(this));
  },
  removeRoleSet: function(projectRoleSet) {
    var talkRole;
    this.state.saving.push(projectRoleSet.id);
    this.setState({
      error: null,
      saving: this.state.saving
    });
    return Promise.all([
      projectRoleSet["delete"](), (function() {
        var i, len, ref, results;
        ref = projectRoleSet.talk_roles;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          talkRole = ref[i];
          results.push(talkRole["delete"]());
        }
        return results;
      })()
    ])["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        var savingIndex;
        _this.props.project.uncacheLink('project_roles');
        savingIndex = _this.state.saving.indexOf(projectRoleSet.id);
        _this.state.saving.splice(savingIndex, 1);
        return _this.setState({
          saving: _this.state.saving
        });
      };
    })(this));
  },
  talkSection: function() {
    return projectSection(this.props.project);
  },
  handleCollaboratorAddition: function() {
    this.props.project.uncacheLink('project_roles');
    return this.forceUpdate();
  }
});


},{"../../components/promise-renderer":86,"../../components/user-search":95,"../../talk/lib/project-section":276,"panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-dom":"react-dom"}],145:[function(require,module,exports){
var DataExportButton, PromiseRenderer, React, TalkDataExportButton, apiClient, counterpart, handleInputChange, isAdmin;

React = require('react');

handleInputChange = require('../../lib/handle-input-change');

PromiseRenderer = require('../../components/promise-renderer');

apiClient = require('panoptes-client/lib/api-client');

counterpart = require('counterpart');

DataExportButton = require('../../partials/data-export-button');

TalkDataExportButton = require('../../talk/data-export-button');

isAdmin = require('../../lib/is-admin');

counterpart.registerTranslations('en', {
  projectDetails: {
    classificationExport: "Request new classification export",
    aggregationExport: "Experimental - Request new aggregation export",
    subjectExport: "Request new subject export",
    workflowExport: "Request new workflow export",
    workflowContentsExport: "Request new workflow contents export",
    commentsExport: "Request new talk comments export",
    tagsExport: "Request new talk tags export"
  }
});

module.exports = React.createClass({
  displayName: 'GetDataExports',
  getDefaultProps: function() {
    return {
      project: {}
    };
  },
  getInitialState: function() {
    return {
      avatarError: null,
      backgroundError: null
    };
  },
  render: function() {
    return React.createElement("div", {
      "className": "data-exports"
    }, React.createElement("p", {
      "className": "form-label"
    }, "Project data exports"), React.createElement("p", {
      "className": "form-help"
    }, "Please note that the Zooniverse will process at most 1 of each export within a 24 hour period and some exports may take a long time to process. We will email you when they are ready."), React.createElement("div", {
      "className": "columns-container"
    }, React.createElement("div", null, "Project Data", React.createElement("br", null), React.createElement("div", {
      "className": "row"
    }, React.createElement(DataExportButton, {
      "project": this.props.project,
      "buttonKey": "projectDetails.classificationExport",
      "exportType": "classifications_export"
    })), React.createElement("div", {
      "className": "row"
    }, React.createElement(DataExportButton, {
      "project": this.props.project,
      "buttonKey": "projectDetails.subjectExport",
      "exportType": "subjects_export"
    })), React.createElement("div", {
      "className": "row"
    }, React.createElement(DataExportButton, {
      "project": this.props.project,
      "buttonKey": "projectDetails.workflowExport",
      "exportType": "workflows_export"
    })), React.createElement("div", {
      "className": "row"
    }, React.createElement(DataExportButton, {
      "project": this.props.project,
      "buttonKey": "projectDetails.workflowContentsExport",
      "exportType": "workflow_contents_export"
    })), React.createElement("div", {
      "className": "row"
    }, React.createElement(DataExportButton, {
      "project": this.props.project,
      "buttonKey": "projectDetails.aggregationExport",
      "contentType": "application/x-gzip",
      "exportType": "aggregations_export",
      "newFeature": true
    })), React.createElement("hr", null), "\nTalk Data", React.createElement("br", null), React.createElement("div", {
      "className": "row"
    }, React.createElement(TalkDataExportButton, {
      "project": this.props.project,
      "exportType": "comments",
      "label": "Request new Talk comments export"
    })), React.createElement("div", {
      "className": "row"
    }, React.createElement(TalkDataExportButton, {
      "project": this.props.project,
      "exportType": "tags",
      "label": "Request new Talk tags export"
    })))));
  }
});


},{"../../components/promise-renderer":86,"../../lib/handle-input-change":103,"../../lib/is-admin":105,"../../partials/data-export-button":213,"../../talk/data-export-button":250,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react"}],146:[function(require,module,exports){
var ProjectPageEditor, React;

React = require('react');

ProjectPageEditor = require('../../partials/project-page-editor');

module.exports = React.createClass({
  displayName: 'EditProjectEducation',
  getDefaultProps: function() {
    return {
      project: {}
    };
  },
  render: function() {
    return React.createElement("div", null, React.createElement(ProjectPageEditor, {
      "project": this.props.project,
      "page": "education",
      "pageTitle": "Education"
    }));
  }
});


},{"../../partials/project-page-editor":225,"react":"react"}],147:[function(require,module,exports){
var ProjectPageEditor, React;

React = require('react');

ProjectPageEditor = require('../../partials/project-page-editor');

module.exports = React.createClass({
  displayName: 'EditProjectFAQ',
  getDefaultProps: function() {
    return {
      project: {}
    };
  },
  render: function() {
    return React.createElement("div", null, React.createElement(ProjectPageEditor, {
      "project": this.props.project,
      "page": "faq",
      "pageTitle": "FAQ"
    }));
  }
});


},{"../../partials/project-page-editor":225,"react":"react"}],148:[function(require,module,exports){
var apiClient = require('panoptes-client/lib/api-client');
var putFile = require('../../../lib/put-file');

var projects = apiClient.type('projects');
var guides = apiClient.type('field_guides');

var DEFAULT_ITEM = {
  title: 'An example',
  content: 'Heres everything you need to know about the great **Example**...'
};

var actions = {
  createGuide: function(projectID) {
    var defaultItem = Object.assign({}, DEFAULT_ITEM);
    var newGuide = {
      items: [defaultItem],
      language: 'en',
      links: {project: projectID}
    };
    return guides.create(newGuide).save();
  },

  deleteGuide: function(guideID) {
    return guides.get(guideID).then(function(guide) {
      return guide.delete();
    });
  },

  replaceItems: function(guideID, items) {
    return guides.get(guideID).then(function(guide) {
      guide.update({
        _busy: true,
        items: items
      });
      return guide.save();
    }).then(function(guide) {
      guide.update({
        _busy: false
      });
    });
  },

  updateItem: function(guideID, itemIndex, changes) {
    return guides.get(guideID).then(function(guide) {
      Object.assign(guide.items[itemIndex], changes);
      guide.update({
        _busy: true,
        items: guide.items
      });
      return guide.save();
    }).then(function(guide) {
      guide.update({
        _busy: false
      });
      return guide;
    });
  },

  removeItemIcon: function(guideID, itemIndex) {
    return guides.get(guideID).then(function(guide) {
      guide.update({
        _busy: true
      });

      guide.get('attached_images').then(function(images) {
        var matchedImage = images.filter(function(image) {
          return image.id === guide.items[itemIndex].icon;
        })[0];

        var changes = {};
        changes['items.' + itemIndex + '.icon'] = ''
        guide.update(changes);

        return Promise.all([
          matchedImage.delete(),
          guide.save()
        ]).then(function() {
          guide.update({
            _busy: false
          });
        });
      });
    });
  },

  setItemIcon: function(guideID, itemIndex, iconFile) {
    return guides.get(guideID).then(function(guide) {
      guide.update({
        _busy: true
      });

      var awaitPossibleRemoval;
      if (guide.items[itemIndex].icon) {
        awaitPossibleRemoval = actions.removeItemIcon(guideID, itemIndex);
      } else {
        awaitPossibleRemoval = Promise.resolve();
      }

      var attachedImagesURL = guide._getURL('attached_images');

      var payload = {
        media: {
          content_type: iconFile.type,
          metadata: {
            filename: iconFile.name
          }
        }
      };

      return awaitPossibleRemoval.then(function() {
        apiClient.post(attachedImagesURL, payload).then(function(media) {
          media = [].concat(media)[0];
          return putFile(media.src, iconFile, {'Content-Type': iconFile.type}).then(function() {
            var changes = {}
            changes['items.' + itemIndex + '.icon'] = media.id;
            guide.update(changes);

            return guide.save().then(function() {
              guide.update({
                _busy: false
              });
              return guide;
            });
          });
        });
      });
    });
  },

  appendItem: function(guideID) {
    var newItem = Object.assign({}, DEFAULT_ITEM);
    return guides.get(guideID).then(function(guide) {
      guide.items.push(newItem);
      guide.update({
        _busy: true,
        items: guide.items
      });
      return guide.save();
    }).then(function(guide) {
      guide.update({
        _busy: false
      });
      return guide;
    });
  },

  removeItem: function(guideID, itemIndex) {
    return guides.get(guideID).then(function(guide) {
      guide.items.splice(itemIndex, 1);
      guide.update({
        _busy: true,
        items: guide.items
      });
      return guide.save();
    }).then(function(guide) {
      guide.update({
        _busy: false
      });
      return guide;
    });
  }
};

module.exports = actions;

},{"../../../lib/put-file":112,"panoptes-client/lib/api-client":549}],149:[function(require,module,exports){
var ArticleEditor, FileButton, MarkdownEditor, React, ReactDOM,
  slice = [].slice;

React = require('react');

ReactDOM = require('react-dom');

FileButton = require('../../../components/file-button');

MarkdownEditor = require('markdownz').MarkdownEditor;

ArticleEditor = React.createClass({displayName: "ArticleEditor",
  statics: {
    SHOULD_REMOVE_ICON: {}
  },
  getDefaultProps: function() {
    return {
      icon: '',
      title: '',
      content: '',
      working: false
    };
  },
  getInitialState: function() {
    return {
      newIconFile: null,
      newIconDataURL: '',
      content: this.props.content
    };
  },
  chooseIcon: function(e) {
    var newIconFile, ref, ref1;
    newIconFile = e != null ? (ref = e.target) != null ? (ref1 = ref.files) != null ? ref1[0] : void 0 : void 0 : void 0;
    if (newIconFile != null) {
      return this.loadImageAsDataURL(newIconFile).then((function(_this) {
        return function(newIconDataURL) {
          return _this.setState({
            newIconFile: newIconFile,
            newIconDataURL: newIconDataURL
          });
        };
      })(this));
    } else {
      return this.resetIcon();
    }
  },
  loadImageAsDataURL: function(file) {
    return new Promise(function(resolve) {
      var reader;
      reader = new FileReader;
      reader.onload = (function(_this) {
        return function(e) {
          return resolve(e.target.result);
        };
      })(this);
      return reader.readAsDataURL(file);
    });
  },
  resetIcon: function() {
    return this.setState({
      newIconFile: null,
      newIconDataURL: ''
    });
  },
  removeIcon: function() {
    this.resetIcon();
    return this.setState({
      newIconFile: this.constructor.SHOULD_REMOVE_ICON
    });
  },
  getData: function() {
    return {
      icon: this.state.newIconFile,
      title: ReactDOM.findDOMNode(this.refs.titleInput).value,
      content: this.state.content
    };
  },
  cancel: function() {
    var base;
    return typeof (base = this.props).onCancel === "function" ? base.onCancel.apply(base, arguments) : void 0;
  },
  save: function(e) {
    var base, data;
    e.preventDefault();
    e.stopPropagation();
    data = this.getData();
    return typeof (base = this.props).onSave === "function" ? base.onSave.apply(base, [data].concat(slice.call(arguments))) : void 0;
  },
  render: function() {
    var iconSrc;
    return React.createElement("div", null, React.createElement("p", null, React.createElement("span", {
      "className": "form-label"
    }, "Icon"), React.createElement("br", null), React.createElement(FileButton, {
      "accept": "image/*",
      "onSelect": this.chooseIcon
    }, (this.state.newIconDataURL ? iconSrc = this.state.newIconDataURL : this.props.icon && this.state.newIconFile !== this.constructor.SHOULD_REMOVE_ICON ? iconSrc = this.props.icon : void 0, iconSrc != null ? React.createElement("img", {
      "src": iconSrc,
      "style": {
        maxHeight: '3em',
        maxWidth: '3em',
        verticalAlign: 'middle'
      }
    }) : React.createElement("small", {
      "className": "standard-button"
    }, "Choose an icon"))), ' ', React.createElement("small", null, (this.state.newIconFile != null ? React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.resetIcon
    }, "Reset") : this.props.icon ? React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.removeIcon
    }, "Clear") : void 0))), React.createElement("p", null, React.createElement("label", null, React.createElement("span", {
      "className": "form-label"
    }, "Title"), React.createElement("br", null), React.createElement("input", {
      "type": "text",
      "ref": "titleInput",
      "className": "standard-input full",
      "defaultValue": this.props.title,
      "disabled": this.props.working,
      "autoFocus": true
    }))), React.createElement("span", {
      "className": "form-label"
    }, "Content"), React.createElement("br", null), React.createElement(MarkdownEditor, {
      "ref": "contentInput",
      "value": this.state.content,
      "disabled": this.props.working,
      "rows": "10",
      "cols": "100",
      "onChange": this.handleContentChange
    }), React.createElement("br", null), React.createElement("p", null, React.createElement("label", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "disabled": this.props.working,
      "onClick": this.cancel
    }, "Cancel")), ' ', React.createElement("label", null, React.createElement("button", {
      "type": "button",
      "className": "major-button",
      "disabled": this.props.working,
      "onClick": this.save
    }, "Done")), ' ', (this.props.working ? React.createElement("strong", null, "  ") : void 0)));
  },
  handleContentChange: function(e) {
    return this.setState({
      content: e.target.value
    });
  }
});

module.exports = ArticleEditor;


},{"../../../components/file-button":72,"markdownz":"markdownz","react":"react","react-dom":"react-dom"}],150:[function(require,module,exports){
var ArticleListItem, CroppedImage, React, ReactDOM;

React = require('react');

ReactDOM = require('react-dom');

CroppedImage = require('../../../components/cropped-image');

ArticleListItem = React.createClass({displayName: "ArticleListItem",
  getDefaultProps: function() {
    return {
      icon: null,
      title: '',
      onClick: function() {}
    };
  },
  render: function() {
    return React.createElement("button", {
      "type": "button",
      "className": "field-guide-editor-article-button",
      "onClick": this.props.onClick
    }, React.createElement(CroppedImage, {
      "className": "field-guide-editor-article-button-icon",
      "src": this.props.icon,
      "aspectRatio": 1.,
      "width": "3em",
      "height": "3em",
      "style": {
        borderRadius: '50%',
        verticalAlign: 'middle'
      }
    }), ' ', React.createElement("span", {
      "className": "field-guide-editor-article-button-title"
    }, this.props.title));
  }
});

module.exports = ArticleListItem;


},{"../../../components/cropped-image":67,"react":"react","react-dom":"react-dom"}],151:[function(require,module,exports){
var ArticleList, ArticleListItem, DragReorderable, React;

React = require('react');

ArticleListItem = require('./article-list-item');

DragReorderable = require('drag-reorderable');

ArticleList = React.createClass({displayName: "ArticleList",
  getDefaultProps: function() {
    return {
      articles: [],
      icons: {},
      onReorder: function() {},
      onSelectArticle: function() {},
      onRemoveArticle: function() {}
    };
  },
  renderArticle: function(article, i) {
    var ref;
    if (article._key == null) {
      article._key = Math.random();
    }
    return React.createElement("li", {
      "key": article._key,
      "className": "field-guide-editor-article-list-item-container"
    }, React.createElement(ArticleListItem, {
      "icon": ((ref = this.props.icons[article.icon]) != null ? ref.src : void 0),
      "title": article.title,
      "onClick": this.props.onSelectArticle.bind(null, i)
    }), React.createElement("button", {
      "type": "button",
      "className": "field-guide-editor-article-list-item-remove-button",
      "title": "Remove this entry",
      "onClick": this.props.onRemoveArticle.bind(null, i)
    }, React.createElement("i", {
      "className": "fa fa-trash-o fa-fw"
    })));
  },
  render: function() {
    return React.createElement(DragReorderable, {
      "tag": "ul",
      "className": "field-guide-editor-article-list",
      "items": this.props.articles,
      "render": this.renderArticle,
      "onChange": this.props.onReorder
    });
  }
});

module.exports = ArticleList;


},{"./article-list-item":150,"drag-reorderable":"drag-reorderable","react":"react"}],152:[function(require,module,exports){
(function (process){
var ArticleEditor, ArticleList, DEV_GUIDE, Dialog, FieldGuideEditor, React, actions, apiClient;

apiClient = require('panoptes-client/lib/api-client');

React = require('react');

ArticleList = require('./article-list');

Dialog = require('modal-form/dialog');

ArticleEditor = require('./article-editor');

actions = require('./actions');

if (process.env.NODE_ENV !== 'production') {
  DEV_GUIDE = apiClient.type('field_guides').create({
    id: 'DEV_GUIDE',
    items: [
      {
        title: 'Hey',
        content: 'Spot this.'
      }
    ]
  });
}

FieldGuideEditor = React.createClass({displayName: "FieldGuideEditor",
  getDefaultProps: function() {
    return {
      project: null,
      actions: actions
    };
  },
  getInitialState: function() {
    return {
      loading: false,
      guide: null,
      icons: {},
      editing: null
    };
  },
  componentDidMount: function() {
    return this.loadGuide(this.props.project);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.project !== this.props.project) {
      return this.loadGuide(nextProps.project);
    }
  },
  loadGuide: function(project) {
    this.setState({
      loading: true
    });
    return apiClient.type('field_guides').get({
      project_id: project.id
    }).then((function(_this) {
      return function(arg) {
        var guide;
        guide = arg[0];
        _this.listenTo(guide);
        _this.setState({
          loading: false,
          guide: guide
        });
        if (guide != null) {
          return _this.fetchIcons(guide);
        }
      };
    })(this));
  },
  listenTo: function(guide) {
    var ref;
    if (this._forceUpdate == null) {
      this._forceUpdate = this.forceUpdate.bind(this);
    }
    if ((ref = this._currentGuide) != null) {
      ref.stopListening(this._forceUpdate);
    }
    if (guide != null) {
      guide.listen(this._forceUpdate);
    }
    return this._currentGuide = guide;
  },
  fetchIcons: function(guide) {
    guide.uncacheLink('attached_images');
    return guide.get('attached_images').then((function(_this) {
      return function(images) {
        var icons;
        icons = {};
        images.forEach(function(image) {
          return icons[image.id] = image;
        });
        return _this.setState({
          icons: icons
        });
      };
    })(this));
  },
  createGuide: function() {
    return this.props.actions.createGuide(this.props.project.id).then((function(_this) {
      return function() {
        return _this.loadGuide(_this.props.project);
      };
    })(this));
  },
  deleteGuide: function(guide) {
    if (guide.items.length === 0 || confirm("Really delete this field guide and its " + guide.items.length + " items?")) {
      return this.props.actions.deleteGuide(guide.id).then((function(_this) {
        return function() {
          return _this.loadGuide(_this.props.project);
        };
      })(this));
    }
  },
  createArticle: function() {
    return this.props.actions.appendItem(this.state.guide.id).then((function(_this) {
      return function() {
        return _this.editArticle(_this.state.guide.items.length - 1);
      };
    })(this));
  },
  editArticle: function(index) {
    return this.setState({
      editing: index
    });
  },
  handleArticleSave: function(newData) {
    var awaitIconAction, content, icon, title;
    icon = newData.icon, title = newData.title, content = newData.content;
    awaitIconAction = icon != null ? icon === ArticleEditor.SHOULD_REMOVE_ICON ? this.props.actions.removeItemIcon(this.state.guide.id, this.state.editing) : this.props.actions.setItemIcon(this.state.guide.id, this.state.editing, icon) : Promise.resolve();
    return awaitIconAction.then((function(_this) {
      return function() {
        return _this.props.actions.updateItem(_this.state.guide.id, _this.state.editing, {
          title: title,
          content: content
        }).then(function() {
          if (icon != null) {
            _this.fetchIcons(_this.state.guide);
          }
          return _this.editArticle(null);
        });
      };
    })(this));
  },
  render: function() {
    return React.createElement("div", null, React.createElement("header", null, React.createElement("strong", null, "Field guide")), (this.state.guide != null ? this.renderEditor() : this.state.loading ? React.createElement("p", {
      "className": "form-help"
    }, "Loading field guide...") : React.createElement("p", null, "This project doesnt have a field guide yet.", ' ', React.createElement("button", {
      "type": "button",
      "onClick": this.createGuide
    }, "Create one!"))));
  },
  renderEmpty: function() {
    return React.createElement("p", {
      "className": "form-help"
    }, "Nothing in this guide.", ' ', React.createElement("small", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.deleteGuide.bind(this, this.state.guide)
    }, "Delete it")));
  },
  renderEditor: function() {
    var article, ref;
    window.editingGuide = this.state.guide;
    return React.createElement("div", {
      "className": "field-guide-editor columns-container"
    }, React.createElement("div", null, (this.state.guide.items.length === 0 ? this.renderEmpty() : React.createElement(ArticleList, {
      "articles": this.state.guide.items,
      "icons": this.state.icons,
      "onReorder": this.props.actions.replaceItems.bind(null, this.state.guide.id),
      "onRemoveArticle": this.props.actions.removeItem.bind(null, this.state.guide.id),
      "onSelectArticle": this.editArticle
    })), React.createElement("p", {
      "style": {
        textAlign: 'center'
      }
    }, React.createElement("button", {
      "type": "button",
      "className": "standard-button",
      "onClick": this.createArticle
    }, "Add an entry"))), React.createElement("div", {
      "className": "form-help"
    }, React.createElement("p", null, "A field guide is a place to store general project-specific information that volunteers will need to understand in order to complete classifications and talk about what they\'re seeing. It\'s available anywhere in your project."), React.createElement("p", null, "Information can be grouped into different sections, and each section should have a title and an icon. Content for each section is rendered with Markdown, so you can include any media you\'ve uploaded for your project there.")), (this.state.editing != null ? (article = this.state.guide.items[this.state.editing], React.createElement(Dialog, {
      "required": true
    }, React.createElement(ArticleEditor, {
      "icon": ((ref = this.state.icons[article.icon]) != null ? ref.src : void 0),
      "title": article.title,
      "content": article.content,
      "working": this.state.guide._busy,
      "onCancel": this.editArticle.bind(this, null),
      "onSave": this.handleArticleSave
    }))) : void 0));
  }
});

module.exports = FieldGuideEditor;


}).call(this,require('_process'))
},{"./actions":148,"./article-editor":149,"./article-list":151,"_process":503,"modal-form/dialog":546,"panoptes-client/lib/api-client":549,"react":"react"}],153:[function(require,module,exports){
var React, apiClient, counterpart;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

counterpart = require('counterpart');

module.exports = React.createClass({displayName: "exports",
  IN_PROGRESS: 'IN_PROGRESS',
  SUCCESSFUL: 'SUCCESSFUL',
  getDefaultProps: function() {
    return {
      project: null,
      workflow: null,
      files: [],
      onClose: function() {}
    };
  },
  getInitialState: function() {
    return {
      classificationsByFile: {},
      errorsByFile: {},
      progress: {}
    };
  },
  componentDidMount: function() {
    return this.parseFiles(this.props.files);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.files !== this.props.files) {
      return this.parseFiles(nextProps.files);
    }
  },
  parseFiles: function(files) {
    this.setState({
      classificationsByFile: {},
      errorsByFile: {},
      progress: null
    });
    return Array.prototype.forEach.call(files, (function(_this) {
      return function(file) {
        var reader;
        reader = new FileReader;
        reader.onload = _this.handleFileRead.bind(_this, file);
        return reader.readAsText(file);
      };
    })(this));
  },
  handleFileRead: function(file, e) {
    var error, parseError;
    try {
      this.state.classificationsByFile[file.name] = [].concat(JSON.parse(e.target.result));
      return this.setState({
        classificationsByFile: this.state.classificationsByFile
      });
    } catch (error) {
      parseError = error;
      this.state.errorsByFile[file.name] = parseError;
      return this.setState({
        errorsByFile: this.state.errorsByFile
      });
    }
  },
  startImport: function() {
    this.setState({
      progress: {}
    });
    return Object.keys(this.state.classificationsByFile).forEach((function(_this) {
      return function(fileName) {
        var classifications;
        classifications = _this.state.classificationsByFile[fileName];
        return classifications.reduce((function(awaitPreviousSave, classification, i) {
          var stateKey;
          stateKey = fileName + i;
          return awaitPreviousSave.then(function() {
            return _this.importClassification(classification, stateKey);
          });
        }), Promise.resolve());
      };
    })(this));
  },
  importClassification: function(classification, stateKey) {
    var data;
    this.state.progress[stateKey] = this.IN_PROGRESS;
    this.setState({
      progress: this.state.progress
    });
    data = JSON.parse(JSON.stringify(classification));
    Object.assign(data, {
      gold_standard: true,
      links: Object.assign(data.links, {
        project: this.props.project.id,
        workflow: this.props.workflow.id
      }),
      metadata: Object.assign({}, data.metadata, {
        user_agent: 'Importer',
        workflow_version: this.props.workflow.version,
        user_language: counterpart.getLocale(),
        started_at: new Date().toISOString(),
        finished_at: new Date().toISOString()
      })
    });
    return apiClient.type('classifications').create(data).save().then((function(_this) {
      return function() {
        return _this.state.progress[stateKey] = _this.SUCCESSFUL;
      };
    })(this))["catch"]((function(_this) {
      return function(creationError) {
        return _this.state.progress[stateKey] = creationError;
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          progress: _this.state.progress
        });
      };
    })(this));
  },
  render: function() {
    var classifications, classificationsCount, fileName, ref;
    classificationsCount = 0;
    ref = this.state.classificationsByFile;
    for (fileName in ref) {
      classifications = ref[fileName];
      classificationsCount += classifications.length;
    }
    return React.createElement("div", null, React.createElement("header", null, "Import gold standard classifications"), React.createElement("ul", null, Array.prototype.map.call(this.props.files, (function(_this) {
      return function(file) {
        var ref1;
        return React.createElement("li", {
          "key": file.name
        }, React.createElement("header", null, file.name), (_this.state.errorsByFile[file.name] != null ? React.createElement("strong", null, React.createElement("i", {
          "className": "fa fa-exclamation-triangle"
        }), ' ', _this.state.errorsByFile[file.name].toString()) : ((ref1 = _this.state.classificationsByFile[file.name]) != null ? ref1.length : void 0) > 0 ? React.createElement("ul", null, _this.state.classificationsByFile[file.name].map(function(classification, i) {
          var progress, ref2, stateKey;
          stateKey = file.name + i;
          progress = (ref2 = _this.state.progress) != null ? ref2[stateKey] : void 0;
          return React.createElement("li", {
            "key": stateKey
          }, classification.links.subjects.join(', '), ' ', ((function() {
            if (progress != null) {
              switch (progress) {
                case this.IN_PROGRESS:
                  return React.createElement("i", {
                    "className": "fa fa-spinner fa-spin"
                  });
                case this.SUCCESSFUL:
                  return React.createElement("i", {
                    "className": "fa fa-check-circle"
                  });
                default:
                  return React.createElement("span", null, React.createElement("i", {
                    "className": "fa fa-exclamation-circle"
                  }), ' ', "progress.toString()");
              }
            }
          }).call(_this)));
        })) : void 0));
      };
    })(this))), React.createElement("p", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.props.onClose
    }, "Close"), ' ', React.createElement("button", {
      "type": "button",
      "className": "major-button",
      "disabled": classificationsCount === 0 || (this.state.progress != null),
      "onClick": this.startImport
    }, "Import ", classificationsCount)));
  }
});


},{"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react"}],154:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

React = require('react');

counterpart = require('counterpart');

Translate = require('react-translate-component');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  howToPage: {
    content: '# How to Build a Project\n\n**So you want to build a project using the Zooniverse Project Builder?**\nThis tutorial will help walk you through the process, using Kitteh Zoo as an example.\nYou can [explore the actual project](https://www.zooniverse.org/projects/vrooje/kitteh-zoo).\n\n[![Kitteh Zoo screenshot](./assets/how-to-lab/how-to-1.jpg)](./assets/how-to-lab/how-to-1.jpg)\n\n### Getting Started\n\nTo get started building, go to [the Project Builder home page](/lab) and log in to your Zooniverse account, then click the "Build a Project" button in the top right. Here you can see all of the projects you own and collaborate on. Click on "Create a project" to start building.\n\n[![Project Builder screenshot](./assets/how-to-lab/how-to-2.jpg)](./assets/how-to-lab/how-to-2.jpg)\n\n**Start building:** Now you\'re in the Project Builder itself. This is where the magic happens. On the left-hand side, you\'ve got your main menus: Project, Workflow, and Subjects. These are terms you\'ll see a lot, and they have specific meanings in the Zooniverse.  Project is pretty self-explanatory; Galaxy Zoo, Penguin Watch, and of course, Kitteh Zoo, are all examples of Zooniverse projects that you could build using the project builder. A workflow is the sequence of tasks that you ask volunteers to do, and subjects are the things (usually images) that volunteers do those tasks on.\n\n[![Project details editor screenshot](./assets/how-to-lab/how-to-3.jpg)](./assets/how-to-lab/how-to-3.jpg)\n\n### Define your project.\n\nThe first thing you\'ll want to do is fill in some basic information about your project on the Project Details page. Just click and type in the relevant boxes. We\'ve added a short description that will be formatted using the markdown language. The avatar and background image for Kitteh Zoo are in this folder. Download these images to your computer. Now add these images by dragging and dropping or by clicking on the relevant boxes (like in the image above). You can come back and add more details at any time while building your project.\n\n### Building a workflow\n\nThis is where you build the tasks that volunteers actually do. When you first get to this page, you\'ll see there is a sample task (specifically a question) already in place.\n\n[![Project workflow editor screenshot](./assets/how-to-lab/how-to-4.jpg)](./assets/how-to-lab/how-to-4.jpg)\n\nWe want to create this:\n\n[![Project workflow example](./assets/how-to-lab/how-to-5.jpg)](./assets/how-to-lab/how-to-5.jpg)\n\nWe\'ll start by replacing the sample text with our question, which asks people how many cats are in the image. We add more answers using the "+" button under the "Yes" answer. Use the screenshot below to fill in the workflow details (you may need to zoom in!)\n\n[![Project workflow editing screenshot](./assets/how-to-lab/how-to-6.jpg)](./assets/how-to-lab/how-to-6.jpg)\n\nWe added both text and images into the _Help Text_ box using the markdown language ([learn more about markdown](http://markdownlivepreview.com)).\n\nHere is the markdown for the help text:\n\n    Tell us **how many cats** you see. You should include:\n\n      - Actual cats (not drawn or simulated)\n      - Cats of any species\n\n    We will ask many people the same question about this image, so don\'t worry if you aren\'t absolutely sure. *Just give us your best guess.*\n\n    Here are some examples of cats:\n\n    ![Sink Cats Relax](http://zooniverse-resources.s3.amazonaws.com/bigblogfiles/cat_demo/cat_bloonet.jpg)\n    ![Only 1 of these cats counts.](http://zooniverse-resources.s3.amazonaws.com/bigblogfiles/cat_demo/cat_valentina_a.jpg)\n    ![Wet kitteh iz not amused](http://zooniverse-resources.s3.amazonaws.com/bigblogfiles/cat_demo/cat_joeltelling.jpg)\n\n    And here are some examples of not-cats (you can ignore these):\n\n    ![A sample of things that are not cats.](http://zooniverse-resources.s3.amazonaws.com/bigblogfiles/cat_demo/notcats.png)\n\nWe can set subsequent tasks to depend on the answer to this question. Right now we haven\'t made any other tasks, so the only option is "End of Classification." Once we create more tasks, we\'ll go back through and link them. Note that this question is _required_ (people can\'t move on until they\'ve answered it) and only one answer is allowed.\n\nNow we want to draw circles around the cat\'s faces and mark a point on their tails. Why? Because we can. (For your own project you\'d obviously want to think carefully about the reasons for adding tasks to a workflow, and what you want to get from the answers/marks.)\n\n[![Project workflow task editing screenshot](./assets/how-to-lab/how-to-7.jpg)](./assets/how-to-lab/how-to-7.jpg)\n\nSo under the _Task_ list, we\'ll click on **drawing**. We\'re asking folks to draw (with ellipses) around the cats\' faces, as well as mark their tail tips with a point. We\'ve changed the color on the Cattail points so they stand out more too. As usual, the main text gives people basic instructions on what we want, and the help text provides some more explanation on how to do the task.\n\nIn addition to marking all the cat faces, we want to know just how cute they are. So every time someone marks a cat-face, we\'ve added a pop-up question to ask just that. Add this question by clicking on the _sub-tasks_ button below the _Type_ and _Color_ task specifications.\n\n[![Project workflow task details editing screenshot](./assets/how-to-lab/how-to-8.jpg)](./assets/how-to-lab/how-to-8.jpg)\n\nWhen building your own project, you can combine any number of tasks in any order. You can start with a drawing task instead of a question. You can add sub-tasks for any drawing tool you make.\n\nIn general, keep in mind that people are more likely to complete more classifications if the workflow is short and simple. Try to keep the workflow as simple as possible to achieve your research goals, and definitely try to only request tasks that cannot be accurately accomplished by automated methods.\n\n### Linking the workflow together\n\nNow that all the tasks have been created, we\'ve got to string them together by specifying what happens _next_. Right now, this means you kind of need to work backwards. The drawing task is the last task in this workflow, so we\'ll leave the "Next Task" button as the default "end of classification." But we\'ll have to go back to our first question.\n\nThe first question, "How many cats are in this image?" only allows one answer, so you can specify the next task depending on the answer.  If folks say "None" for the number of cats, the classification ends. But if they say there\'s at least one cat, then they go on to the next question.\n\n[![Project workflow task editing screenshot](./assets/how-to-lab/how-to-9.jpg)](./assets/how-to-lab/how-to-9.jpg)\n\n### Upload subjects\n\nTo really get started building a project, you need images to work with. Normally you would add your own images by clicking on the "New Subject Set" button on the left hand side of the screen. This is one of the trickier steps in project creation -- for the purposes of this tutorial you can simply copy the Kitteh Zoo subject set, but check out the next section "Uploading subjects -- the nitty gritty" if you want to practice the full approach. To do this go to the workflow you created and under the _associated subject_ set section click on _add an example subject set_. You should now see the \'kittehs\' subject set selected.\n\n[![Project workflow task editing screenshot](./assets/how-to-lab/how-to-10.jpg)](./assets/how-to-lab/how-to-10.jpg)\n\n**CONGRATULATIONS!**\n\nYou should have successfully created Kitteh Zoo! To view it, got back to the _Build a Project_ page (by clicking the button in the top right of the page) and then click on the view button next to the new project you have just made.\n\n[![Project list screenshot](./assets/how-to-lab/how-to-11.jpg)](./assets/how-to-lab/how-to-11.jpg)\n\n### Uploading subjects - the Nitty Gritty\n\nWhen you actually build your own project, there won\'t be an example set of images already loaded for you. Get started uploading a set of subjects for your project by clicking on the "New Subject Set" button on the left hand side of the screen. That will bring you to the _Subject Uploader_.\n\nIt\'s easiest if you have all of your images in a single folder along with a manifest file, and you will upload both at the same time. The manifest file lists all the images we want to upload and links each  image to additional information, also called metadata, such as date, time, and photographer. There is more information about the manifest in the "Details" section below, but for now you can see an example manifest file in the ["Kitteh" zip file](https://data.zooniverse.org/tutorial/kitteh_zoo.zip).\n\nClick on the "Upload Subjects" box and navigate to the "Kitteh" folder you downloaded. The easiest thing to do is simply hit _cmd + a_ (on Mac, or _ctrl + a_ on Windows) to select everything in that folder. Note that the subject uploader ignores the excel file and the other folders. Click "open" to select those images and the manifest file for upload. The project uploader now indicates that the "Cat project manifest.csv" has 29 subjects for upload.\n\nClick "Upload" to start the process. It might take a little while, but when everything is uploaded, you\'ll see a list of all of the subjects. The numbers to the left are unique identifiers for each subject, and the icons to the right let you preview or delete each subject.\n\nSubject sets can be pretty powerful, and sometimes complex. You can have a single subject set that you add to over time, or have multiple subject sets, say, from different years or places. You can have different subject sets for different workflows, but you don\'t have to. You can even have multiple images in a given subject. For more details and advice on creating and structuring subject sets and associated manifests, check out the details section below.\n\n### PROJECT BUILDER\'S MANUAL  THE DETAILS\n\n- **Project**: This holds all your project level details. The project name, the people involved, and all the extra content (e.g. text and pictures) you want to share, are all here.\n  - **Project Details**: This is your project\'s "behind the scenes" home page. Start off by naming and describing your project, add a logo and background image.\n  - **Research Case, FAQ, Results, and Education**: You can add a lot of information in these pages to help volunteers better understand the motivation for your project, the best approaches for classifying, and the outcomes of your project.\n  - **Collaborators**: Add people to your team and specify what their roles are so that they have the right access to the tools they need (including access to the project before it\'s public).\n  - **Workflows**: A workflow is the sequence of tasks that you\'re asking volunteers to perform. For example, you might want to ask volunteers to answer questions about your images, or to mark features in your data, or both. The workflow is where you define those tasks and set out the order in which the volunteers will do them. Your project might have multiple workflows (if you want to set different tasks for different image sets).\n- **Subjects**: A subject is a unit of data to be analyzed. A subject can include one or more images that will be analyzed at the same time by volunteers. A subject set consists of a list of subjects (the "manifest") defining their properties, and the images themselves. Feel free to group subjects into sets in the way that is most useful for your research. Many projects will find it\'s best to just have all their subjects in 1 set, but not all.\n\n### DETAILS - Workflows\n\nNote that a workflow with fewer tasks will be easier for volunteers to complete. We know from surveys of our volunteers that many people classify in their limited spare time, and sometimes they only have a few minutes. Longer, more complex workflows mean each classification takes longer, so if your workflow is very long you may lose volunteers.\n\n_Workflow Name_: Give your workflow a short, but descriptive name. If you have multiple workflows and give volunteers the option of choosing which they want to work on, this name will appear on a button instead of "Get started!"\n\n_Version_: Version indicates which version of the workflow you are on. Every time you save changes to a workflow, you create a new version. Big changes, like adding or deleting questions, will change the version by a whole number: 1.0 to 2.0, etc. Smaller changes, like modifying the help text, will change the version by a decimal, e.g. 2.0 to 2.1. The version is tracked with each classification in case you need it when analyzing your data.\n\n_Tasks_: There are two main types of tasks: questions and drawing. For question tasks, the volunteer chooses from a list of answers but does not mark or draw on the image. In drawing tasks, the volunteer marks or draws directly on the image using tools that you specify. They can also give sub-classifications for each mark. Note that you can set the first task from the drop-down menu.\n\n_Main Text_: Describe the task, or ask the question, in a way that is clear to a non-expert.\n\nThe wording here is very important, because you will in general get what you ask for. Solicit opinions from team members and testers before you make the project public: it often takes a few tries to reach the combination of simplicity and clarity that will guide your volunteers to give you the inputs you need.\n\nYou can use markdown in the main text.\n\n_Help Text_: Add text and images for a pop-up help window. This is shown next to the main text of the task in the main classification interface, when the volunteer clicks a button asking for help. You can use markdown in this text, and link to other images to help illustrate your description. The help text can be as long as you need, but you should try to keep it simple and avoid jargon. One thing that is useful in the help text is a concise description of why you are asking for this particular information.\n\n### DETAILS - Project Details:\n\n_Name_: The project name is the first thing people will see and it will show up in the project URL. Try to keep it short and sweet.\n\n_Avatar_: Pick an avatar image for your project. This will represent your project on the Zooniverse home page. It can also be used as your project\'s brand. It\'s best if it\'s recognizable even as a small icon. To add an image, either drag and drop or click to open your file viewer. For best results, use a square image of not more than 50KB, but at minimum 100x100 pixels.\n\n_Background_: This image will be the background for all of your project pages, including your project\'s front page, which newcomers will see first. It should be relatively high resolution and you should be able to read text written across it. To add an image, either drag and drop or click to open your file viewer. For best results, use images of at least 1 megapixel, no larger than 256 KB. Most people\'s screens are not much bigger than 1300 pixels across and 750 pixels high, so if your image is a lot bigger than this you may find it doesn\'t look the way you expect. Feel free to experiment with different sizes on a "typical" desktop, laptop or mobile screen.\n\n_Description_: This should be a one-line call to action for your project. This will display on your landing page and, if approved, on the Zooniverse home page. Some volunteers will decide whether to try your project based on reading this, so try to write short text that will make people actively want to join your project.\n\n_Introduction_: Add a brief introduction to get people interested in your project. This will display on your project\'s front page. Note this field (renders markdown)[http://markdownlivepreview.com/], so you can format the text. You can make this longer than the Description, but it\'s still probably best to save much longer text for areas like the Research Case or FAQ tabs.\n\n_Checkbox: Volunteers choose workflow_: A workflow is a set of tasks a volunteer completes to create a classification. Your project might have multiple workflows (if you want to set different tasks for different image sets). Check this to let volunteers select which workflow they want to work on; otherwise, they\'ll be served workflow-subject pairs randomly.\n\n_Checkbox: Private project_:\nOn "private" projects, only users with specified project roles can see or classify on the project. We strongly recommend you keep your project private while you\'re still working out its details. Share it with your team to get feedback by adding them in the Collaborators area (linked at the left). Team members you add can see your project even if it\'s private. Once your project is public, anyone with the link can view and classify on it.\n\n### DETAILS - Additional Content\n\n_Research Case, FAQ, Results, and Education_: These pages are where you really get to share all the cool things about your project. All of these pages use Markdown (see link above) to format text and display images.\n\n[![Project additional content editor screenshot](./assets/how-to-lab/how-to-12.jpg)](./assets/how-to-lab/how-to-12.jpg)\n\n_Research case_: Explain your research to your audience here in as much detail as you\'d like. This page displays no matter what, since explaining your motivation to volunteers is critical for the success of your project!\n\n_Results_: Once your project has hit its stride, share the results of your project with your volunteers here. This page will only display if you add content to it.\n\n_FAQ_: Add details here about your research, how to classify, and what you plan to do with the classifications. This page can evolve as your project does so that your active community members have a resource to point new users to. This page will only display if you add content to it.\n\n_Education_: If you are a researcher open to collaborating with educators you can state that here, include educational content, and describe how you\'d like to help educators use your project. Also, if your project is primarily for educational purposes you can describe that here. This page will only display if you add content to it.\n\n### DETAILS - Media\n\nYou can upload your own media to your project (such as example images for your help pages) so  you can link to it without an external host. To start uploading, drop an image into the box (or click it to bring up your file browser and select a file).\n\nOnce the image has uploaded, it will appear above the "Add an image" box. You can then copy the markdown text beneath the image into your project, or add another image.\n\n### DETAILS - Visibility\n\nThis page is where you decide whether your project is public and whether it\'s ready to go live. For more information on the different project stages, see our [project builder policies](/lab-policies).\n\n### DETAILS - Collaborators\n\nAdd people to your team and specify what their roles are so that they have the right access to the tools they need (including access to the project before it\'s public).\n\n[![Project collaborator editor screenshot](./assets/how-to-lab/how-to-13.jpg)](./assets/how-to-lab/how-to-13.jpg)\n\n_Owner_: The owner is the original project creator. There can be only one.\n\n_Collaborator_: Collaborators have full access to edit workflows and project content, including deleting some or all of the project.\n\n_Expert_: Experts can enter gold mode to make authoritative gold standard classifications that will be used to validate data quality.\n\n_Researcher_: Members of the research team will be marked as researchers on Talk"\n\n_Moderator_: Moderators have extra privileges in the community discussion area to moderate discussions. They will also be marked as moderators on Talk".\n\n_Tester_: Testers can view and classify on your project to give feedback while its still private. They cannot access the project builder.\n\n_Translator_: Translators will have access to the project builder as well as the translation site, so they can translate all of your project text into a different language.\n\n### DETAILS - Subject sets and manifest details, a.k.a. "What is a manifest?"\n\n*The condensed answer:*\n\nA manifest is a file that tells our software how to combine the images you have into units of data (subjects) to be classified. The manifest also allows you to link your classifications back to the rest of your data. A manifest is formatted as a CSV file with 1 line per subject, with a unique identifier and the names of images to be associated with a subject on each row (with additional information often included in other fields as well). There is an example in the ["Kitteh" zip file](https://data.zooniverse.org/tutorial/kitteh_zoo.zip).\n\n*The full answer:*\n\nWhat we call a "manifest" is really just a plain text file with a specific format to each line.\n\nTo understand the format, let\'s start with the first few lines from the Kitteh Zoo manifest:\n\n    subject_id,image_name_1,origin,link,attribution,license,#secret_description\n    1,6672150457_420d61007d_b.jpg,Flickr,https://www.flickr.com/photos/aigle_dore/6672150457,Moyan Brenn,Creative Commons - share adapt attribute,sleepy striped kitteh is unsuspecting of paparazzi\n    2,8300920648_d4a21bba59_z,Flickr,https://www.flickr.com/photos/aigle_dore/8300920648,Moyan Brenn,Creative Commons - share adapt attribute,grandfather kitteh has ear hair. a lot of it\n    3,6713782851_82fc8c73e5_z.jpg,Flickr,https://www.flickr.com/photos/hellie55/6713782851,hehaden,Creative Commons - share adapt attribute,juvenile kittehs practice break-in at the catnip factory\n\nThe first line of the file is a header line that specifies the name of each of the manifest fields. In this case, our manifest has 7 fields (or columns), called "subject\_id", "image\_name", "origin", "link", "attribution", "license" and #secret\_description. They are separated by commas: this is what\'s known as a "comma separated values" file, or CSV file.\n\nAfter the first line, each row of the file contains information about 1 subject. The first field, corresponding with the "subject\_id" header, is a unique number that identifies the subject. The second field, which aligns with the "image\_name" header, contains the name of the image that\'s associated with that subject. These 2 fields are critically important: the image name is obviously important, and a unique identifier is important for matching your classifications to the rest of your data.\n\nAll the other fields are optional, but in general having more information in the manifest is better. Most projects include additional information in the manifest that helps them match the classifications and subjects to the other data they need for their research. The additional information in the manifest can also be made available to volunteers as they classify (some very keen volunteers find this extremely useful). Any fields with names that begin with # or // will *not* be shown to volunteers, such as the #secret\_description field in Kitteh Zoo. These hidden fields will still be returned to you in the classification file, so you can use these to include information helpful to your research without worrying about whether it might affect the classifications themselves. Information in fields that *dont* begin with either # or // will be accessible to volunteers.\n\nFor now, lets assume youre just including the bare minimum of information, like:\n\n    id,image\n    1,kitteh_in_box.jpg\n    2,kitteh_stalking.jpg\n    3,kitteh_losing_balance.jpg\n\nNote the field names have changed from the previous example. That\'s because, aside from marking whether a field is hidden or not, it doesn\'t actually matter to the Zooniverse what the fields are called (or what order theyre in), so you can name and order them according to whatever works best for your project.\n\nUsing a manifest CSV file also makes it very easy to create subjects with multiple images:\n\n    id,image1,image2\n    1,kitteh_in_box.jpg,kitteh_eating_box.jpg\n    2,kitteh_stalking.jpg,kitteh_pounced.jpg\n    3,kitteh_losing_balance.jpg,kitteh_falling_off_sofa.jpg\n\nIf you upload this manifest plus the 6 images named in it, the Zooniverse software will create 3 subjects with 2 images each. When these subjects come up in the classification interface, volunteers will be able to flash between the images or switch between them manually.\n\nYou can create a manifest file in a simple text editor (such as TextEdit or Notepad), although this method is prone to errors like missed or extra commas. People often find it easiest to create manifest files using spreadsheet software such as Google Sheets, iWork Numbers or Microsoft Excel. Creating and maintaining a manifest using a spreadsheet makes the manifest easy to read, and you can export it to CSV format when you\'re ready to upload your subjects. You can also open existing CSV files in spreadsheet software.\n\n*Note:* if you have a large subject set it may be cumbersome to manually create a manifest. We suggest using a command-line or other tool to copy-paste a directory list of files into a spreadsheet to help you get started.'
  }
});

module.exports = React.createClass({
  displayName: 'HowToPage',
  render: function() {
    return React.createElement("div", {
      "className": "secondary-page centered-grid"
    }, React.createElement(Markdown, null, counterpart("howToPage.content")));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],155:[function(require,module,exports){
var LandingPage, Link, ModalFormDialog, ProjectCreationForm, ProjectLink, ProjectList, React, apiClient, projectActions;

React = require('react');

Link = require('react-router').Link;

apiClient = require('panoptes-client/lib/api-client');

ModalFormDialog = require('modal-form/dialog');

projectActions = require('./actions/project');

LandingPage = require('./landing-page');

ProjectLink = React.createClass({displayName: "ProjectLink",
  getDefaultProps: function() {
    return {
      project: {},
      avatar: null,
      owner: null
    };
  },
  render: function() {
    return React.createElement("div", {
      "className": "lab-index-project-row"
    }, React.createElement(Link, {
      "to": "/lab/" + this.props.project.id,
      "className": "lab-index-project-row__link lab-index-project-row__group lab-index-project-row__action"
    }, (this.props.avatar != null ? React.createElement("img", {
      "className": "lab-index-project-row__avatar",
      "src": this.props.avatar.src
    }) : void 0), React.createElement("div", {
      "className": "lab-index-project-row__description"
    }, React.createElement("strong", {
      "className": "lab-index-project-row__name"
    }, this.props.project.display_name), ' ', (this.props.owner != null ? React.createElement("small", null, "by ", this.props.owner.display_name) : void 0)), React.createElement("span", {
      "className": "lab-index-project-row__icon-button"
    }, React.createElement("i", {
      "className": "fa fa-pencil fa-fw"
    }), ' ', React.createElement("small", null, "Edit"))), React.createElement(Link, {
      "to": "/projects/" + this.props.project.slug,
      "className": "lab-index-project-row__link lab-index-project-row__icon-button lab-index-project-row__action"
    }, React.createElement("i", {
      "className": "fa fa-hand-o-right fa-fw"
    }), ' ', React.createElement("small", null, "View")));
  }
});

ProjectList = React.createClass({displayName: "ProjectList",
  getDefaultProps: function() {
    return {
      title: '',
      page: 1,
      roles: [],
      withAvatars: false,
      withOwners: false,
      onChangePage: function() {}
    };
  },
  getInitialState: function() {
    return {
      loading: false,
      pages: 0,
      projects: [],
      avatars: {},
      owners: {},
      error: null
    };
  },
  componentDidMount: function() {
    return this.loadData(this.props.roles, this.props.page, this.props.withAvatars, this.props.withOwners);
  },
  componentWillReceiveProps: function(nextProps) {
    var anyChanged;
    anyChanged = Object.keys(nextProps).some((function(_this) {
      return function(key) {
        return JSON.stringify(nextProps[key]) !== JSON.stringify(_this.props[key]);
      };
    })(this));
    if (anyChanged) {
      return this.loadData(nextProps.roles, nextProps.page, nextProps.withAvatars, nextProps.withOwners);
    }
  },
  loadData: function(roles, page, withAvatars, withOwners) {
    var awaitProjects, include, query;
    this.setState({
      avatars: {},
      owners: {},
      error: null,
      loading: true
    });
    include = [];
    if (this.props.withAvatars) {
      include.push('avatar');
    }
    if (this.props.withOwners) {
      include.push('owners');
    }
    query = {
      current_user_roles: roles,
      page: page,
      include: include,
      sort: 'display_name'
    };
    return awaitProjects = apiClient.type('projects').get(query).then((function(_this) {
      return function(projects) {
        return _this.setState({
          projects: projects
        });
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          loading: false
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.state.projects.forEach(function(project) {
          if (_this.props.withAvatars) {
            project.get('avatar')["catch"](function() {
              return {};
            }).then(function(avatar) {
              _this.state.avatars[project.id] = avatar;
              return _this.forceUpdate();
            });
          }
          if (_this.props.withOwners) {
            return project.get('owner')["catch"](function() {
              return null;
            }).then(function(owner) {
              _this.state.owners[project.id] = owner;
              return _this.forceUpdate();
            });
          }
        });
      };
    })(this));
  },
  handlePageChange: function(e) {
    return this.props.onChangePage(parseFloat(e.target.value));
  },
  render: function() {
    var i, pages, ref, ref1, ref2, results;
    pages = Math.max((ref = (ref1 = this.state.projects[0]) != null ? (ref2 = ref1.getMeta()) != null ? ref2.page_count : void 0 : void 0) != null ? ref : 1, this.props.page);
    return React.createElement("div", {
      "className": "content-container"
    }, React.createElement("header", null, React.createElement("p", null, React.createElement("strong", {
      "className": "form-label"
    }, this.props.title), ' ', (!((this.state.error != null) || pages === 1) ? React.createElement("small", {
      "className": "form-help"
    }, "Page", ' ', React.createElement("select", {
      "value": this.props.page,
      "disabled": this.state.loading,
      "onChange": this.handlePageChange
    }, (function() {
      results = [];
      for (var i = 1; 1 <= pages ? i <= pages : i >= pages; 1 <= pages ? i++ : i--){ results.push(i); }
      return results;
    }).apply(this).map((function(_this) {
      return function(page) {
        return React.createElement("option", {
          "key": page,
          "value": page
        }, page);
      };
    })(this)))) : void 0))), (this.state.loading ? React.createElement("small", {
      "className": "form-help"
    }, "Loading...") : this.state.error != null ? React.createElement("p", {
      "className": "form-help error"
    }, this.state.error.toString()) : this.state.projects.length === 0 ? React.createElement("p", {
      "className": "form-help"
    }, "No projects") : React.createElement("ul", {
      "className": "lab-index-project-list"
    }, this.state.projects.map((function(_this) {
      return function(project) {
        return React.createElement("li", {
          "key": project.id,
          "className": "lab-index-project-list__item"
        }, React.createElement(ProjectLink, {
          "project": project,
          "avatar": _this.state.avatars[project.id],
          "owner": _this.state.owners[project.id]
        }));
      };
    })(this)))));
  }
});

ProjectCreationForm = React.createClass({displayName: "ProjectCreationForm",
  getDefaultProps: function() {
    return {
      onCancel: function() {},
      onSubmit: function() {},
      onSuccess: function() {}
    };
  },
  getInitialState: function() {
    return {
      busy: false,
      error: null
    };
  },
  handleSubmit: function(e) {
    var awaitSubmission;
    e.preventDefault();
    this.setState({
      busy: true,
      error: null
    });
    awaitSubmission = this.props.onSubmit({
      display_name: this.refs.displayNameInput.value,
      description: this.refs.descriptionInput.value,
      introduction: this.refs.introductionInput.value
    });
    return Promise.resolve(awaitSubmission).then((function(_this) {
      return function(result) {
        return _this.props.onSuccess(result);
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          busy: false
        });
      };
    })(this));
  },
  render: function() {
    return React.createElement("form", {
      "onSubmit": this.handleSubmit,
      "style": {
        maxWidth: '90vw',
        width: '60ch'
      }
    }, React.createElement("p", null, React.createElement("label", null, React.createElement("span", {
      "className": "form-label"
    }, "Project name"), React.createElement("br", null), React.createElement("input", {
      "type": "text",
      "ref": "displayNameInput",
      "className": "standard-input full",
      "defaultValue": "Untitled project (" + (new Date().toLocaleString()) + ")",
      "required": true,
      "disabled": this.state.busy
    }))), React.createElement("p", null, React.createElement("label", null, React.createElement("span", {
      "className": "form-label"
    }, "Short description"), React.createElement("br", null), React.createElement("input", {
      "type": "text",
      "ref": "descriptionInput",
      "className": "standard-input full",
      "defaultValue": "A short description of the project",
      "required": true,
      "disabled": this.state.busy
    }))), React.createElement("p", null, React.createElement("label", null, React.createElement("span", {
      "className": "form-label"
    }, "Introduction"), React.createElement("br", null), React.createElement("textarea", {
      "type": "text",
      "ref": "introductionInput",
      "className": "standard-input full",
      "defaultValue": "A more in-depth introduction to your science...",
      "rows": "5",
      "required": true,
      "disabled": this.state.busy
    }))), (this.state.error != null ? React.createElement("p", {
      "className": "form-help error"
    }, this.state.error.toString()) : void 0), React.createElement("p", {
      "style": {
        textAlign: 'center'
      }
    }, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "disabled": this.state.busy,
      "onClick": this.props.onCancel
    }, "Cancel"), ' ', React.createElement("button", {
      "type": "submit",
      "className": "major-button",
      "disabled": this.state.busy
    }, "Create project")));
  }
});

module.exports = React.createClass({displayName: "exports",
  getDefaultProps: function() {
    return {
      user: null,
      loaction: {
        query: {
          'owned-page': 1,
          'collaborations-page': 1
        }
      },
      actions: projectActions
    };
  },
  getInitialState: function() {
    return {
      creationInProgress: false
    };
  },
  handlePageChange: function(which, page) {
    var newLocation, newQuery, queryUpdate;
    queryUpdate = {};
    queryUpdate[which] = page;
    newQuery = Object.assign({}, this.props.location.query, queryUpdate);
    newLocation = Object.assign({}, this.props.location, {
      query: newQuery
    });
    return this.props.history.replace(newLocation);
  },
  showProjectCreator: function() {
    return this.setState({
      creationInProgress: true
    });
  },
  hideProjectCreator: function() {
    return this.setState({
      creationInProgress: false
    });
  },
  handleProjectCreation: function(project) {
    var newLocation;
    this.hideProjectCreator();
    newLocation = Object.assign({}, this.props.location, {
      pathname: "/lab/" + project.id
    });
    return this.props.history.push(newLocation);
  },
  render: function() {
    if (this.props.user != null) {
      return React.createElement("div", null, React.createElement(ProjectList, {
        "title": "Your projects",
        "page": this.props.location.query['owned-page'],
        "roles": ['owner', 'workaround'],
        "withAvatars": true,
        "onChangePage": this.handlePageChange.bind(this, 'owned-page')
      }), React.createElement("div", {
        "className": "content-container"
      }, React.createElement("p", {
        "style": {
          textAlign: 'center'
        }
      }, React.createElement("button", {
        "type": "button",
        "className": "major-button",
        "onClick": this.showProjectCreator
      }, "Create a new project"), ' ', React.createElement(Link, {
        "to": "/lab-how-to",
        "className": "standard-button"
      }, "How-to"), ' ', React.createElement(Link, {
        "to": "/lab-policies",
        "className": "standard-button"
      }, "Policies"), ' ', React.createElement(Link, {
        "to": "/lab-best-practices/introduction",
        "className": "standard-button"
      }, "Best Practices"), ' ', React.createElement(Link, {
        "to": "/talk/18",
        "className": "standard-button"
      }, "Project Builder Talk"))), (this.state.creationInProgress ? React.createElement(ModalFormDialog, {
        "tag": "div"
      }, React.createElement(ProjectCreationForm, {
        "onSubmit": this.props.actions.createProject,
        "onCancel": this.hideProjectCreator,
        "onSuccess": this.handleProjectCreation
      })) : void 0), React.createElement("hr", null), React.createElement(ProjectList, {
        "title": "Collaborations",
        "page": this.props.location.query['collabarations-page'],
        "roles": ['collaborator'],
        "withOwners": true,
        "style": {
          fontSize: '0.8em'
        },
        "onChangePage": this.handlePageChange.bind(this, 'collabarations-page')
      }));
    } else {
      return React.createElement(LandingPage, null);
    }
  }
});


},{"./actions/project":136,"./landing-page":157,"modal-form/dialog":546,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],156:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  policiesPage: {
    content: '## Zooniverse Project Builder Policies, or So You Want To Launch a Project?\n\nThis page is for those who have used the builder tools to construct a project they\'re happy with, and are now ready to launch it to the wider world. The first thing to understand is that there are three modes which a live project can be in - _Public Projects_, _Review Projects_, and _Zooniverse Projects_:\n\nFirstly, **Public Projects**.\n\nGot your own crowd? Want only members of your collaboration to sort through your data? Then you can simply share the URL with those you want to take part. There is a limit of 10,000 subjects per user - [contact us](/about/contact) if you\'d like to host more. NOTE: This upload limit applies to all users initially.\n\n_If you\'re planning a big public launch, or you think your project might attract significant attention, you should still [let us know](/about/contact) so we can support you properly. Otherwise you can get on with using your project._\n\nFor project teams who want to work with the established, ever-keen Zooniverse community, the first step is to turn your project into a **Review Project**. You can do this from the project builder, under the "Visibility" section. Clicking the "Apply for review" button will allow the Zooniverse team to review your project - this is just a quick check to make sure it complies with our rules (see below). Once your project passes this step, the Zooniverse team will disseminate your project link to volunteers who have opted in to help test new projects and provide feedback.\n\n_During the review phase, you should be checking for suggestions and comments on the project\'s Talk discussion pages in addition to reviewing the formal feedback from the volunteer project testers that will be provided by the Zooniverse team. Technical issues can be reported to us via [the GitHub repository](https://github.com/zooniverse/Panoptes-Front-End), but you will need to consider carefully comments on workflow design. Remember to look at the results produced during this review phase too - are they of sufficient quality for your research? If not, then a redesign or a rethink is in order; go back, make changes to your project and then submit it for review once again._\n\nFollowing a successful review, you should have a final version of the workflow that you\'re confident will produce useful results, and a site containing all the information that volunteers will need. You can then submit your project for launch by clicking the "Apply for full launch" in the "Visibility" section, making it an official **Zooniverse Project** which will appear on the [main Zooniverse projects page](/projects/). A project appearing on the main Zooniverse projects list must have as its goal the production of useful research, and so there will be a further review. This final review may include requesting information from you about your plans for using the results, and looking at the results from the review phase. We may also carry out a peer review of your project.\n\nAt this point, you will likely want to upload more than the small subject set used for development and for the review. Well get in touch to arrange that once your project has passed review.\n\nOnce the project has passed review, it will appear on the [main Zooniverse project list](/projects/), and we will consider it for inclusion in a Zooniverse community newsletter or for other promotion. If you want to increase the chance that your project will be promoted, then note that we will particularly favour projects whose researchers are proactive in engaging with their community, on the Talk discussion forums and elsewhere.\n\n_If you\'d like your project to launch on a particular day, perhaps to coincide with a press release, please [get in touch](/about/contact)._\n\n### Rules and Regulations\n\nBy using the Zooniverse project builder, you\'re making use of our software and hosting, and so we reserve the right to remove content for any reason whatsoever. In particular, we will remove content and projects which are brought to our attention and where:\n\n- The content is not legal.\n- The content is likely to cause offense, or is suitable only for an adult audience.\n- The copyright on material uploaded to the site is not clear; please only use content you have the right to use!\n\nIf in doubt - please [get in touch](/about/contact).\n\nWe\'re keen to find out how people want to use our platform, and at present its free to use. If you want more than the standard 10,000 subjects per user, are likely to want more than 100GB of space for those subjects, or will have more than a few hundred concurrent users, please let us know. Were keen to help.\n\nWe do, however, reserve the right to have the final say on which projects appear on the main project page and which are promoted to the Zooniverse community. In particular, if you have a project that is very close to an existing Zooniverse project, please [get in touch](/about/contact) to discuss the situation; it is in no-one\'s interest to, for example, have seventeen different galaxy classification projects competing for attention.\n\nProjects promoted to the Zooniverse community also need to:\n\n- Have the goal of producing useful research; this means they not only need to be well designed, but that you should have thought about who is going to use the results, and put in the effort to turn them into a formal publication.\n- Make their classification data open after a proprietary period, normally lasting two years from project launch.\n- Communicate results to their communities, via open access publication, a blog or elsewhere.\n- Acknowledge Zooniverse in any publications. Please use the following text:\n\n_This publication uses data generated via the Zooniverse.org platform, development of which was supported by a Global Impact Award from Google, and by the Alfred P. Sloan Foundation._\n\n- Report publications using Zooniverse-produced data to us via this [form](https://docs.google.com/forms/d/18jwLbtV_6M5HCM74xNFtFbiiszWAxpC5IGHaToYjeiw/viewform).'
  }
});

module.exports = React.createClass({
  displayName: 'LabPoliciesPage',
  render: function() {
    return React.createElement("div", {
      "className": "secondary-page centered-grid"
    }, React.createElement(Markdown, null, counterpart("policiesPage.content")));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],157:[function(require,module,exports){
var Link, LoginDialog, Markdown, React, Translate, ZooniverseLogoType, alert, counterpart;

React = require('react');

counterpart = require('counterpart');

Translate = require('react-translate-component');

Link = require('react-router').Link;

ZooniverseLogoType = require('../../partials/zooniverse-logotype');

alert = require('../../lib/alert');

LoginDialog = require('../../partials/login-dialog');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  labLanding: {
    title: "Zooniverse Project Builder",
    content: "Anyone can build a Zooniverse project. Just upload your data and choose the tasks you want the volunteers to do. To find out more, read our [How to Build a Project documentation](/lab-how-to), or click the button below to get started.",
    buttons: {
      getStarted: "Get started!",
      signIn: "Sign in",
      backToProjects: "Back to projects"
    },
    links: {
      heading: 'Quick Links',
      buildHelp: 'Project Builder Help',
      policies: 'Project Builder Policies',
      bestPractices: 'Best Practices Guide',
      buildTalk: 'Project Builder Talk'
    }
  }
});

module.exports = React.createClass({
  displayName: 'ProjectBuilderLandingPage',
  componentDidMount: function() {
    document.documentElement.classList.add('on-secondary-page');
    return document.documentElement.classList.add('on-landing-page');
  },
  componentWillUnmount: function() {
    document.documentElement.classList.remove('on-secondary-page');
    return document.documentElement.classList.remove('on-landing-page');
  },
  render: function() {
    return React.createElement("div", {
      "className": "landing-page"
    }, React.createElement(ZooniverseLogoType, null), React.createElement("h3", {
      "className": "landing-title"
    }, React.createElement(Translate, {
      "content": "labLanding.title"
    })), React.createElement("div", {
      "className": "landing-tagline"
    }, React.createElement(Markdown, null, counterpart("labLanding.content"))), React.createElement("div", {
      "className": "landing-actions"
    }, React.createElement("div", {
      "className": "landing-buttons"
    }, React.createElement("button", {
      "type": "button",
      "className": "call-to-action standard-button landing-button",
      "onClick": this.showLoginDialog.bind(this, 'sign-in')
    }, React.createElement(Translate, {
      "content": "labLanding.buttons.signIn"
    })), React.createElement(Link, {
      "to": "/projects",
      "className": "call-to-action standard-button landing-button"
    }, React.createElement(Translate, {
      "content": "labLanding.buttons.backToProjects"
    }))), React.createElement("div", {
      "className": "landing-links"
    }, React.createElement("p", {
      "className": "heading"
    }, React.createElement(Translate, {
      "content": "labLanding.links.heading"
    })), React.createElement(Link, {
      "to": "/lab-how-to"
    }, React.createElement(Translate, {
      "content": "labLanding.links.buildHelp"
    })), React.createElement(Link, {
      "to": "/lab-policies"
    }, React.createElement(Translate, {
      "content": "labLanding.links.policies"
    })), React.createElement(Link, {
      "to": "/lab-best-practices/introduction"
    }, React.createElement(Translate, {
      "content": "labLanding.links.bestPractices"
    })), React.createElement(Link, {
      "to": "/talk/18"
    }, React.createElement(Translate, {
      "content": "labLanding.links.buildTalk"
    })))));
  },
  showLoginDialog: function(which) {
    return alert(function(resolve) {
      return React.createElement(LoginDialog, {
        "which": which,
        "onSuccess": resolve
      });
    });
  }
});


},{"../../lib/alert":98,"../../partials/login-dialog":219,"../../partials/zooniverse-logotype":231,"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],158:[function(require,module,exports){
var MediaArea, React, VALID_SUBJECT_EXTENSIONS;

React = require('react');

MediaArea = require('../../components/media-area');

VALID_SUBJECT_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.gif', '.svg'];

module.exports = React.createClass({
  displayName: 'EditMediaPage',
  getDefaultProps: function() {
    return {
      project: {}
    };
  },
  render: function() {
    var ext, i;
    return React.createElement("div", {
      "className": "edit-media-page"
    }, React.createElement("div", {
      "className": "content-container"
    }, React.createElement("p", null, React.createElement("strong", null, "You can add images here to use in your projects content."), "  Just copy and paste the images Markdown code: ", React.createElement("code", null, "![title](url)"), ". Images can be any of: ", (function() {
      var j, len, results;
      results = [];
      for (i = j = 0, len = VALID_SUBJECT_EXTENSIONS.length; j < len; i = ++j) {
        ext = VALID_SUBJECT_EXTENSIONS[i];
        results.push(React.createElement("span", {
          "key": ext
        }, React.createElement("code", null, ext), (VALID_SUBJECT_EXTENSIONS[i + 1] != null ? ', ' : void 0)));
      }
      return results;
    })(), ' ', " "), React.createElement(MediaArea, {
      "resource": this.props.project
    })));
  },
  handleChange: function() {
    this.getMedia = null;
    return this.forceUpdate();
  }
});


},{"../../components/media-area":79,"react":"react"}],159:[function(require,module,exports){
var ProjectModalEditor, React;

React = require('react');

ProjectModalEditor = require('../../partials/project-modal-editor');

module.exports = React.createClass({
  displayName: 'EditMiniCourse',
  render: function() {
    return React.createElement("div", null, React.createElement("div", null, React.createElement("p", null, "Heres some text all about the mini-course editor. Lorem ipsum dolor sit amet, etc."), React.createElement("p", null, React.createElement("strong", null, "Work in progress."))), React.createElement("div", null, React.createElement(ProjectModalEditor, {
      "project": this.props.project,
      "type": "minicourses"
    })));
  }
});


},{"../../partials/project-modal-editor":224,"react":"react"}],160:[function(require,module,exports){
var AutoSave, CharLimit, DISCIPLINES, DisplayNameSlugEditor, ExternalLinksEditor, ImageSelector, MAX_AVATAR_SIZE, MAX_BACKGROUND_SIZE, MarkdownEditor, MarkdownHelp, PromiseRenderer, React, Select, TagSearch, alert, apiClient, counterpart, handleInputChange, putFile;

React = require('react');

AutoSave = require('../../components/auto-save');

handleInputChange = require('../../lib/handle-input-change');

PromiseRenderer = require('../../components/promise-renderer');

ImageSelector = require('../../components/image-selector');

apiClient = require('panoptes-client/lib/api-client');

putFile = require('../../lib/put-file');

counterpart = require('counterpart');

DisplayNameSlugEditor = require('../../partials/display-name-slug-editor');

TagSearch = require('../../components/tag-search');

MarkdownEditor = require('markdownz').MarkdownEditor;

MarkdownHelp = require('../../partials/markdown-help');

alert = require('../../lib/alert');

DISCIPLINES = require('../../components/disciplines').DISCIPLINES;

Select = require('react-select');

CharLimit = require('../../components/char-limit');

MAX_AVATAR_SIZE = 64000;

MAX_BACKGROUND_SIZE = 256000;

ExternalLinksEditor = React.createClass({
  displayName: 'ExternalLinksEditor',
  getDefaultProps: function() {
    return {
      project: {}
    };
  },
  render: function() {
    var i, link;
    return React.createElement("div", null, React.createElement("table", null, React.createElement("thead", null, React.createElement("tr", null, React.createElement("th", null, "Label"), React.createElement("th", null, "URL"))), React.createElement("tbody", null, (function() {
      var j, len, ref, results;
      ref = this.props.project.urls;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        link = ref[i];
        if (link._key == null) {
          link._key = Math.random();
        }
        results.push(React.createElement(AutoSave, {
          "key": link._key,
          "tag": "tr",
          "resource": this.props.project
        }, React.createElement("td", null, React.createElement("input", {
          "type": "text",
          "name": "urls." + i + ".label",
          "value": this.props.project.urls[i].label,
          "onChange": handleInputChange.bind(this.props.project)
        })), React.createElement("td", null, React.createElement("input", {
          "type": "text",
          "name": "urls." + i + ".url",
          "value": this.props.project.urls[i].url,
          "onChange": handleInputChange.bind(this.props.project)
        })), React.createElement("td", null, React.createElement("button", {
          "type": "button",
          "onClick": this.handleRemoveLink.bind(this, link)
        }, React.createElement("i", {
          "className": "fa fa-remove"
        })))));
      }
      return results;
    }).call(this))), React.createElement(AutoSave, {
      "resource": this.props.project
    }, React.createElement("button", {
      "type": "button",
      "onClick": this.handleAddLink
    }, "Add a link")));
  },
  handleAddLink: function() {
    var changes;
    changes = {};
    changes["urls." + this.props.project.urls.length] = {
      label: 'Example',
      url: 'https://example.com/'
    };
    return this.props.project.update(changes);
  },
  handleRemoveLink: function(linkToRemove) {
    var changes, link;
    changes = {
      urls: (function() {
        var j, len, ref, results;
        ref = this.props.project.urls;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          link = ref[j];
          if (link !== linkToRemove) {
            results.push(link);
          }
        }
        return results;
      }).call(this)
    };
    return this.props.project.update(changes);
  }
});

module.exports = React.createClass({
  displayName: 'EditProjectDetails',
  getDefaultProps: function() {
    return {
      project: {}
    };
  },
  getInitialState: function() {
    var disciplineTagList, otherTagList, ref;
    ref = this.splitTags(), disciplineTagList = ref.disciplineTagList, otherTagList = ref.otherTagList;
    return {
      avatarError: null,
      backgroundError: null,
      disciplineTagList: disciplineTagList,
      otherTagList: otherTagList
    };
  },
  splitTags: function(kind) {
    var disciplineTagList, j, len, otherTagList, ref, t;
    disciplineTagList = [];
    otherTagList = [];
    ref = this.props.project.tags;
    for (j = 0, len = ref.length; j < len; j++) {
      t = ref[j];
      if (DISCIPLINES.some(function(el) {
        return el.value === t;
      })) {
        disciplineTagList.push(t);
      } else {
        otherTagList.push(t);
      }
    }
    return {
      disciplineTagList: disciplineTagList,
      otherTagList: otherTagList
    };
  },
  render: function() {
    var checked, ref, ref1;
    if (this.avatarGet == null) {
      this.avatarGet = this.props.project.get('avatar')["catch"](function() {
        return null;
      });
    }
    if (this.backgroundGet == null) {
      this.backgroundGet = this.props.project.get('background')["catch"](function() {
        return null;
      });
    }
    return React.createElement("div", null, React.createElement("p", {
      "className": "form-help"
    }, "Input the basic information about your project, and set up its home page."), React.createElement("div", {
      "className": "columns-container"
    }, React.createElement("div", null, "Avatar", React.createElement("br", null), React.createElement(PromiseRenderer, {
      "promise": this.avatarGet,
      "then": ((function(_this) {
        return function(avatar) {
          var placeholder;
          placeholder = React.createElement("div", {
            "className": "form-help content-container"
          }, "Drop an avatar image here");
          return React.createElement(ImageSelector, {
            "maxSize": MAX_AVATAR_SIZE,
            "ratio": 1.,
            "src": (avatar != null ? avatar.src : void 0),
            "placeholder": placeholder,
            "onChange": _this.handleMediaChange.bind(_this, 'avatar')
          });
        };
      })(this))
    }), (this.state.avatarError ? React.createElement("div", {
      "className": "form-help error"
    }, this.state.avatarError.toString()) : void 0), React.createElement("p", null, React.createElement("small", {
      "className": "form-help"
    }, "Pick a logo to represent your project. To add an image, either drag and drop or click to open your file viewer. For best results, use a square image of not more than 50 KB.")), React.createElement("hr", null), "\nBackground image", React.createElement("br", null), React.createElement(PromiseRenderer, {
      "promise": this.backgroundGet,
      "then": ((function(_this) {
        return function(background) {
          var placeholder;
          placeholder = React.createElement("div", {
            "className": "form-help content-container"
          }, "Drop a background image here");
          return React.createElement(ImageSelector, {
            "maxSize": MAX_BACKGROUND_SIZE,
            "src": (background != null ? background.src : void 0),
            "placeholder": placeholder,
            "onChange": _this.handleMediaChange.bind(_this, 'background')
          });
        };
      })(this))
    }), (this.state.backgroundError ? React.createElement("div", {
      "className": "form-help error"
    }, this.state.backgroundError.toString()) : void 0), React.createElement("p", null, React.createElement("small", {
      "className": "form-help"
    }, "This image will be the background for all of your project pages, including your projects front page. To add an image, either drag and drop or left click to open your file viewer. For best results, use good quality images no more than 256 KB.")), React.createElement("hr", null), React.createElement("p", null, React.createElement(AutoSave, {
      "tag": "label",
      "resource": this.props.project
    }, (checked = (ref = this.props.project.configuration) != null ? ref.user_chooses_workflow : void 0), React.createElement("input", {
      "type": "checkbox",
      "name": "configuration.user_chooses_workflow",
      "defaultChecked": checked,
      "defaultValue": checked,
      "onChange": handleInputChange.bind(this.props.project)
    }), ' ', "Volunteers can choose which workflow they work on"), React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "If you have multiple workflows, check this to let volunteers select which workflow they want to to work on; otherwise, theyll be served randomly."))), React.createElement("div", {
      "className": "column"
    }, React.createElement(DisplayNameSlugEditor, {
      "resource": this.props.project,
      "resourceType": "project"
    }), React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.project
    }, React.createElement("span", {
      "className": "form-label"
    }, "Description"), React.createElement("br", null), React.createElement("input", {
      "className": "standard-input full",
      "name": "description",
      "value": this.props.project.description,
      "onChange": handleInputChange.bind(this.props.project)
    })), React.createElement("small", {
      "className": "form-help"
    }, "This should be a one-line call to action for your project that displays on your landing page. Some volunteers will decide whether to try your project based on reading this, so try to write short text that will make people actively want to join your project. ", React.createElement(CharLimit, {
      "limit": 300,
      "string": this.props.project.description
    }))), React.createElement("div", null, React.createElement(AutoSave, {
      "resource": this.props.project
    }, React.createElement("span", {
      "className": "form-label"
    }, "Introduction"), React.createElement("br", null), React.createElement(MarkdownEditor, {
      "className": "full",
      "name": "introduction",
      "rows": "10",
      "value": this.props.project.introduction,
      "project": this.props.project,
      "onChange": handleInputChange.bind(this.props.project),
      "onHelp": (function() {
        return alert(React.createElement(MarkdownHelp, null));
      })
    })), React.createElement("small", {
      "className": "form-help"
    }, "Add a brief introduction to get people interested in your project. This will display on your landing page. ", React.createElement(CharLimit, {
      "limit": 1500,
      "string": this.props.project.introduction
    }))), React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.project
    }, React.createElement("span", {
      "className": "form-label"
    }, "Workflow Description"), React.createElement("br", null), React.createElement("textarea", {
      "className": "standard-input full",
      "name": "workflow_description",
      "value": this.props.project.workflow_description,
      "onChange": handleInputChange.bind(this.props.project)
    })), React.createElement("small", {
      "className": "form-help"
    }, "Add text here when you have multiple workflows and want to help your volunteers decide which one they should do. ", React.createElement(CharLimit, {
      "limit": 500,
      "string": this.props.project.workflow_description
    }))), React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.project
    }, React.createElement("span", {
      "className": "form-label"
    }, "Announcement Banner"), React.createElement("br", null), React.createElement("textarea", {
      "className": "standard-input full",
      "name": "configuration.announcement",
      "value": ((ref1 = this.props.project.configuration) != null ? ref1.announcement : void 0),
      "onChange": handleInputChange.bind(this.props.project)
    })), React.createElement("small", {
      "className": "form-help"
    }, "This text will appear as a banner at the top of all your project\'s pages. Only use this when you\'ve got a big important announcement to make!")), React.createElement("div", null, React.createElement(AutoSave, {
      "resource": this.props.project
    }, React.createElement("span", {
      "className": "form-label"
    }, "Discipline Tag"), React.createElement("br", null), React.createElement(Select, {
      "ref": "disciplineSelect",
      "name": "disciplines",
      "placeholder": "Add Discipline Tag",
      "className": "discipline-tag",
      "value": this.state.disciplineTagList,
      "options": DISCIPLINES,
      "multi": true,
      "onChange": this.handleDisciplineTagChange
    }), React.createElement("small", {
      "className": "form-help"
    }, "Enter or select one or more discipline tags to identify which field(s) of research your project belongs to. These tags will determine the categories your project will appear under on the main Zooniverse projects page, if your project becomes a full Zooniverse project. "), React.createElement("br", null)), React.createElement(AutoSave, {
      "resource": this.props.project
    }, React.createElement("span", {
      "className": "form-label"
    }, "Other Tags"), React.createElement("br", null), React.createElement(TagSearch, {
      "name": "tags",
      "multi": true,
      "value": this.state.otherTagList,
      "onChange": this.handleOtherTagChange
    })), React.createElement("small", {
      "className": "form-help"
    }, "Enter a list of additional tags to describe your project separated by commas to help users find your project.")), React.createElement("div", null, "External links", React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "Adding an external link will make it appear as a new tab alongside the science, classify, and talk tabs."), React.createElement(ExternalLinksEditor, {
      "project": this.props.project
    })))));
  },
  handleDisciplineTagChange: function(value) {
    var allTags, newTags;
    newTags = value === '' ? [] : value.split(',');
    this.setState({
      disciplineTagList: newTags
    });
    allTags = newTags.concat(this.state.otherTagList);
    return this.handleTagChange(allTags);
  },
  handleOtherTagChange: function(value) {
    var allTags, newTags;
    newTags = value === '' ? [] : value.split(',');
    this.setState({
      otherTagList: newTags
    });
    allTags = this.state.disciplineTagList.concat(newTags);
    return this.handleTagChange(allTags);
  },
  handleTagChange: function(value) {
    var event;
    event = {
      target: {
        value: value,
        name: 'tags',
        dataset: {}
      }
    };
    return handleInputChange.call(this.props.project, event);
  },
  handleMediaChange: function(type, file) {
    var errorProp, newState;
    errorProp = type + "Error";
    newState = {};
    newState[errorProp] = null;
    this.setState(newState);
    return apiClient.post(this.props.project._getURL(type), {
      media: {
        content_type: file.type
      }
    }).then((function(_this) {
      return function(arg) {
        var resource;
        resource = arg[0];
        return putFile(resource.src, file, {
          'Content-Type': file.type
        });
      };
    })(this)).then((function(_this) {
      return function() {
        _this.props.project.uncacheLink(type);
        _this[type + "Get"] = null;
        return _this.props.project.refresh();
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.props.project.emit('change');
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        newState = {};
        newState[errorProp] = error;
        return _this.setState(newState);
      };
    })(this));
  }
});


},{"../../components/auto-save":62,"../../components/char-limit":64,"../../components/disciplines":70,"../../components/image-selector":76,"../../components/promise-renderer":86,"../../components/tag-search":92,"../../lib/alert":98,"../../lib/handle-input-change":103,"../../lib/put-file":112,"../../partials/display-name-slug-editor":214,"../../partials/markdown-help":222,"counterpart":"counterpart","markdownz":"markdownz","panoptes-client/lib/api-client":549,"react":"react","react-select":"react-select"}],161:[function(require,module,exports){
var ChangeListener, DEFAULT_SUBJECT_SET_NAME, DELETE_CONFIRMATION_PHRASE, EditProjectPage, HandlePropChanges, History, IndexLink, Link, LoadingIndicator, ModalFormDialog, PromiseRenderer, React, Router, TitleMixin, WorkflowCreateForm, apiClient, ref, workflowActions,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

ref = require('react-router'), History = ref.History, Link = ref.Link, IndexLink = ref.IndexLink;

PromiseRenderer = require('../../components/promise-renderer');

LoadingIndicator = require('../../components/loading-indicator');

TitleMixin = require('../../lib/title-mixin');

HandlePropChanges = require('../../lib/handle-prop-changes');

apiClient = require('panoptes-client/lib/api-client');

ChangeListener = require('../../components/change-listener');

Router = require('react-router');

ModalFormDialog = require('modal-form/dialog');

WorkflowCreateForm = require('./workflow-create-form');

workflowActions = require('./actions/workflow');

DEFAULT_SUBJECT_SET_NAME = 'Untitled subject set';

DELETE_CONFIRMATION_PHRASE = 'I AM DELETING THIS PROJECT';

EditProjectPage = React.createClass({
  displayName: 'EditProjectPage',
  mixins: [TitleMixin, History],
  title: function() {
    return this.props.project.display_name;
  },
  getDefaultProps: function() {
    return {
      project: {
        id: '2'
      },
      workflowActions: workflowActions
    };
  },
  getInitialState: function() {
    return {
      workflowCreationInProgress: false,
      subjectSetCreationError: null,
      subjectSetCreationInProgress: false,
      deletionError: null,
      deletionInProgress: false
    };
  },
  labPath: function(postFix) {
    if (postFix == null) {
      postFix = '';
    }
    return "/lab/" + this.props.project.id + postFix;
  },
  render: function() {
    var linkParams, ref1, ref2, ref3;
    linkParams = {
      projectID: this.props.project.id
    };
    return React.createElement("div", {
      "className": "columns-container content-container"
    }, React.createElement("div", null, React.createElement("ul", {
      "className": "nav-list"
    }, React.createElement("li", null, React.createElement("div", {
      "className": "nav-list-header"
    }, "Project #", this.props.project.id)), React.createElement("li", null, React.createElement(IndexLink, {
      "to": this.labPath(),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Input the basic information about your project, and set up its home page."
    }, "Project details")), React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/research'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Explain your research to your audience here in as much detail as youd like."
    }, "Research")), React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/results'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Once your project has hit its stride, share the results of your project with your volunteers here."
    }, "Results")), React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/faq'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Add details here about your research, how to classify, and what you plan to do with the classifications."
    }, "FAQ")), React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/education'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "If you are a researcher open to collaborating with educators, or if your project is primarily for educational purposes, you can describe that here."
    }, "Education")), React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/collaborators'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Add people to your team and specify what their roles are so that they have the right access to the tools they need (including access to the project while its private)."
    }, "Collaborators")), (indexOf.call((ref1 = this.props.project.experimental_tools) != null ? ref1 : [], 'field guide') >= 0 ? React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/guide'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Create a persistent guide that can be viewed within your project"
    }, "Field guide")) : void 0), (indexOf.call((ref2 = this.props.project.experimental_tools) != null ? ref2 : [], 'tutorial') >= 0 ? React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/tutorial'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Create a pop-up tutorial for your projects classification interface"
    }, "Tutorial")) : void 0), (indexOf.call((ref3 = this.props.project.experimental_tools) != null ? ref3 : [], 'mini-course') >= 0 ? React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/mini-course'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Create a pop-up mini-course for your projects classification interface"
    }, "Mini-course")) : void 0), React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/media'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Add any images youd like to use in this projects introduction, science case, results, FAQ, or education content pages."
    }, "Media")), React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/visibility'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Decide whether your project is public and whether it's ready to go live."
    }, "Visibility")), React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/talk'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Setup project specific discussion boards"
    }, "Talk")), React.createElement("li", null, React.createElement(Link, {
      "to": this.labPath('/data-exports'),
      "activeClassName": 'active',
      "className": "nav-list-item",
      "title": "Get your project's data exports"
    }, "Data Exports")), React.createElement("li", null, React.createElement("br", null), React.createElement("div", {
      "className": "nav-list-header"
    }, "Workflows"), React.createElement(PromiseRenderer, {
      "promise": this.props.project.get('workflows')
    }, ((function(_this) {
      return function(workflows) {
        var renderWorkflowListItem, workflow;
        return React.createElement("ul", {
          "className": "nav-list"
        }, (renderWorkflowListItem = function(workflow) {
          return React.createElement("li", {
            "key": workflow.id
          }, React.createElement(Link, {
            "to": this.labPath("/workflow/" + workflow.id),
            "activeClassName": "active",
            "className": "nav-list-item",
            "title": "A workflow is the sequence of tasks that youre asking volunteers to perform."
          }, workflow.display_name));
        }), (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = workflows.length; i < len; i++) {
            workflow = workflows[i];
            results.push(React.createElement(ChangeListener, {
              "key": workflow.id,
              "target": workflow,
              "eventName": "save",
              "handler": renderWorkflowListItem.bind(this, workflow)
            }));
          }
          return results;
        }).call(_this), React.createElement("li", {
          "className": "nav-list-item"
        }, React.createElement("button", {
          "type": "button",
          "onClick": _this.showCreateWorkflow,
          "disabled": _this.props.project.live || _this.state.workflowCreationInProgress,
          "title": "A workflow is the sequence of tasks that youre asking volunteers to perform."
        }, "New workflow", ' ', React.createElement(LoadingIndicator, {
          "off": !_this.state.workflowCreationInProgress
        }))));
      };
    })(this)))), (this.state.workflowCreationInProgress ? React.createElement(ModalFormDialog, {
      "tag": "div"
    }, React.createElement(WorkflowCreateForm, {
      "onSubmit": this.props.workflowActions.createWorkflowForProject,
      "onCancel": this.hideCreateWorkflow,
      "onSuccess": this.handleWorkflowCreation,
      "projectID": this.props.project.id
    })) : void 0), React.createElement("li", null, React.createElement("br", null), React.createElement("div", {
      "className": "nav-list-header"
    }, "Subject sets"), React.createElement(PromiseRenderer, {
      "promise": this.props.project.get('subject_sets')
    }, ((function(_this) {
      return function(subjectSets) {
        var renderSubjectSetListItem, subjectSet;
        return React.createElement("ul", {
          "className": "nav-list"
        }, (renderSubjectSetListItem = function(subjectSet) {
          var subjectSetListLabel;
          subjectSetListLabel = subjectSet.display_name || React.createElement("i", null, 'Untitled subject set');
          return React.createElement("li", {
            "key": subjectSet.id
          }, React.createElement(Link, {
            "to": this.labPath("/subject-set/" + subjectSet.id),
            "activeClassName": "active",
            "className": "nav-list-item",
            "title": "A subject is an image (or group of images) to be analyzed."
          }, subjectSetListLabel));
        }), (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = subjectSets.length; i < len; i++) {
            subjectSet = subjectSets[i];
            results.push(React.createElement(ChangeListener, {
              "key": subjectSet.id,
              "target": subjectSet,
              "eventName": "save",
              "handler": renderSubjectSetListItem.bind(this, subjectSet)
            }));
          }
          return results;
        }).call(_this), React.createElement("li", {
          "className": "nav-list-item"
        }, React.createElement("button", {
          "type": "button",
          "onClick": _this.createNewSubjectSet,
          "disabled": _this.state.subjectSetCreationInProgress,
          "title": "A subject is an image (or group of images) to be analyzed."
        }, "New subject set", ' ', React.createElement(LoadingIndicator, {
          "off": !_this.state.subjectSetCreationInProgress
        })), ' ', (_this.state.subjectSetCreationError != null ? React.createElement("div", {
          "className": "form-help error"
        }, _this.state.subjectSetCreationError.message) : void 0)));
      };
    })(this)))), React.createElement("li", null, React.createElement("br", null), React.createElement("div", {
      "className": "nav-list-header"
    }, "Need some help?"), React.createElement("ul", {
      "className": "nav-list"
    }, React.createElement("li", null, React.createElement(Link, {
      "className": "nav-list-item",
      "to": "/lab-how-to"
    }, "Read a tutorial")), React.createElement("li", null, React.createElement(Link, {
      "to": "/talk/18",
      "className": "nav-list-item"
    }, "Ask for help on talk"))))), React.createElement("br", null), React.createElement("div", {
      "className": "nav-list-header"
    }, "Other actions"), React.createElement("small", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "disabled": this.state.deletionInProgress,
      "onClick": this.deleteProject
    }, "Delete this project ", React.createElement(LoadingIndicator, {
      "off": !this.state.deletionInProgress
    }))), ' ', (this.state.deletionError != null ? React.createElement("div", {
      "className": "form-help error"
    }, this.state.deletionError.message) : void 0)), React.createElement("hr", null), React.createElement("div", {
      "className": "column"
    }, React.createElement(ChangeListener, {
      "target": this.props.project,
      "handler": ((function(_this) {
        return function() {
          return React.cloneElement(_this.props.children, _this.props);
        };
      })(this))
    })));
  },
  showCreateWorkflow: function() {
    return this.setState({
      workflowCreationInProgress: true
    });
  },
  hideCreateWorkflow: function() {
    return this.setState({
      workflowCreationInProgress: false
    });
  },
  handleWorkflowCreation: function(workflow) {
    var newLocation;
    this.hideCreateWorkflow();
    newLocation = Object.assign({}, this.props.location, {
      pathname: "/lab/" + this.props.project.id + "/workflow/" + workflow.id
    });
    this.props.history.push(newLocation);
    this.props.project.uncacheLink('workflows');
    return this.props.project.uncacheLink('subject_sets');
  },
  createNewSubjectSet: function() {
    var subjectSet;
    subjectSet = apiClient.type('subject_sets').create({
      display_name: DEFAULT_SUBJECT_SET_NAME,
      links: {
        project: this.props.project.id
      }
    });
    this.setState({
      subjectSetCreationError: null,
      subjectSetCreationInProgress: true
    });
    return subjectSet.save().then((function(_this) {
      return function() {
        return _this.history.pushState(null, "/lab/" + _this.props.project.id + "/subject-set/" + subjectSet.id);
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          subjectSetCreationError: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        _this.props.project.uncacheLink('subject_sets');
        if (_this.isMounted()) {
          return _this.setState({
            subjectSetCreationInProgress: false
          });
        }
      };
    })(this));
  },
  deleteProject: function() {
    var confirmed;
    this.setState({
      deletionError: null
    });
    confirmed = prompt("You are about to delete this project and all its data!\nEnter " + DELETE_CONFIRMATION_PHRASE + " to confirm.") === DELETE_CONFIRMATION_PHRASE;
    if (confirmed) {
      this.setState({
        deletionInProgress: true
      });
      return this.props.project["delete"]().then((function(_this) {
        return function() {
          return _this.history.pushState(null, "/lab");
        };
      })(this))["catch"]((function(_this) {
        return function(error) {
          return _this.setState({
            deletionError: error
          });
        };
      })(this)).then((function(_this) {
        return function() {
          if (_this.isMounted()) {
            return _this.setState({
              deletionInProgress: false
            });
          }
        };
      })(this));
    }
  }
});

module.exports = React.createClass({
  displayName: 'EditProjectPageWrapper',
  mixins: [TitleMixin, History],
  title: 'Edit',
  componentDidMount: function() {
    if (!this.props.user) {
      return this.history.pushState(null, "/lab");
    }
  },
  componentWillReceiveProps: function(nextProps) {
    if (!nextProps.user) {
      return this.history.pushState(null, "/lab");
    }
  },
  getDefaultProps: function() {
    return {
      params: {
        projectID: '0'
      }
    };
  },
  render: function() {
    var getOwners, getProject, getProjectAndOwners;
    if (this.props.user != null) {
      getProject = apiClient.type('projects').get(this.props.params.projectID);
      getOwners = getProject.then((function(_this) {
        return function(project) {
          return project.get('project_roles', {
            page_size: 100
          }).then(function(projectRoles) {
            var owners, projectRole;
            owners = (function() {
              var i, len, results;
              results = [];
              for (i = 0, len = projectRoles.length; i < len; i++) {
                projectRole = projectRoles[i];
                if (indexOf.call(projectRole.roles, 'owner') >= 0 || indexOf.call(projectRole.roles, 'collaborator') >= 0) {
                  results.push(projectRole.get('owner'));
                }
              }
              return results;
            })();
            return Promise.all(owners);
          });
        };
      })(this));
      getProjectAndOwners = Promise.all([getProject, getOwners]);
      return React.createElement(PromiseRenderer, {
        "promise": getProjectAndOwners,
        "pending": ((function(_this) {
          return function() {
            return React.createElement("div", {
              "className": "content-container"
            }, React.createElement("p", {
              "className": "form-help"
            }, "Loading project"));
          };
        })(this)),
        "then": ((function(_this) {
          return function(arg) {
            var owners, project, ref1;
            project = arg[0], owners = arg[1];
            if (ref1 = _this.props.user, indexOf.call(owners, ref1) >= 0) {
              return React.createElement(EditProjectPage, React.__spread({}, _this.props, {
                "project": project
              }));
            } else {
              return React.createElement("div", {
                "className": "content-container"
              }, React.createElement("p", null, "You dont have permission to edit this project."));
            }
          };
        })(this)),
        "catch": ((function(_this) {
          return function(error) {
            return React.createElement("div", {
              "className": "content-container"
            }, React.createElement("p", {
              "className": "form-help error"
            }, error.toString()));
          };
        })(this))
      });
    } else {
      return React.createElement("div", {
        "className": "content-container"
      }, React.createElement("p", null, "You need to be signed in to use the lab."));
    }
  }
});


},{"../../components/change-listener":63,"../../components/loading-indicator":77,"../../components/promise-renderer":86,"../../lib/handle-prop-changes":104,"../../lib/title-mixin":117,"./actions/workflow":137,"./workflow-create-form":168,"modal-form/dialog":546,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],162:[function(require,module,exports){
var ProjectPageEditor, React;

React = require('react');

ProjectPageEditor = require('../../partials/project-page-editor');

module.exports = React.createClass({
  displayName: 'EditProjectResearch',
  render: function() {
    return React.createElement("div", null, React.createElement("p", {
      "className": "form-help"
    }, "This page is for you to describe your research motivations and goals to the volunteers. Feel free to add detail, but try to avoid jargon. This page renders markdown, so you can format it and add images via the Media Library and links. The site will show your team members and their roles to the side of the text."), React.createElement(ProjectPageEditor, {
      "project": this.props.project,
      "page": "science_case",
      "pageTitle": "Research"
    }));
  }
});


},{"../../partials/project-page-editor":225,"react":"react"}],163:[function(require,module,exports){
var ProjectPageEditor, React;

React = require('react');

ProjectPageEditor = require('../../partials/project-page-editor');

module.exports = React.createClass({
  displayName: 'EditProjectResults',
  getDefaultProps: function() {
    return {
      project: {}
    };
  },
  render: function() {
    return React.createElement("div", null, React.createElement(ProjectPageEditor, {
      "project": this.props.project,
      "page": "results",
      "pageTitle": "Results"
    }));
  }
});


},{"../../partials/project-page-editor":225,"react":"react"}],164:[function(require,module,exports){
var AutoSave, ChangeListener, EditSubjectSetPage, History, INVALID_FILENAME_CHARS, MAX_FILE_SIZE, ManifestView, NOOP, Papa, PromiseRenderer, React, SubjectSetListing, SubjectSetListingRow, SubjectSetListingTable, SubjectUploader, SubjectViewer, UploadDropTarget, VALID_SUBJECT_EXTENSIONS, alert, announceSetChange, apiClient, handleInputChange, isAdmin;

React = require('react');

AutoSave = require('../../components/auto-save');

handleInputChange = require('../../lib/handle-input-change');

PromiseRenderer = require('../../components/promise-renderer');

apiClient = require('panoptes-client/lib/api-client');

ChangeListener = require('../../components/change-listener');

Papa = require('papaparse');

History = require('react-router').History;

alert = require('../../lib/alert');

SubjectViewer = require('../../components/subject-viewer');

SubjectUploader = require('../../partials/subject-uploader');

UploadDropTarget = require('../../components/upload-drop-target');

ManifestView = require('../../components/manifest-view');

isAdmin = require('../../lib/is-admin');

NOOP = Function.prototype;

VALID_SUBJECT_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.gif', '.svg'];

INVALID_FILENAME_CHARS = ['/', '\\', ':', ','];

MAX_FILE_SIZE = 600 * 1024;

announceSetChange = function() {
  return apiClient.type('subject_sets').emit('add-or-remove');
};

SubjectSetListingRow = React.createClass({
  displayName: 'SubjectSetListingRow',
  getDefaultProps: function() {
    return {
      subject: {},
      onPreview: Function.prototype,
      onRemove: Function.prototype
    };
  },
  getInitialState: function() {
    return {
      beingDeleted: false
    };
  },
  render: function() {
    return React.createElement("tr", {
      "key": this.props.subject.id
    }, React.createElement("td", null, React.createElement("small", {
      "className": "form-help"
    }, this.props.subject.id, (this.props.subject.metadata.Filename != null ? "- " + this.props.subject.metadata.Filename : void 0))), React.createElement("td", null, React.createElement("button", {
      "type": "button",
      "disabled": this.state.beingDeleted,
      "onClick": this.props.onPreview.bind(null, this.props.subject)
    }, React.createElement("i", {
      "className": "fa fa-eye fa-fw"
    })), React.createElement("button", {
      "type": "button",
      "disabled": this.state.beingDeleted,
      "onClick": this.handleRemove
    }, React.createElement("i", {
      "className": "fa fa-trash-o fa-fw"
    }))));
  },
  handleRemove: function() {
    this.setState({
      beingDeleted: true
    });
    return this.props.onRemove(this.props.subject);
  }
});

SubjectSetListingTable = React.createClass({
  displayName: 'SubjectSetListing',
  getDefaultProps: function() {
    return {
      subjects: [],
      onPreview: Function.prototype,
      onRemove: Function.prototype
    };
  },
  render: function() {
    var subject;
    return React.createElement("table", null, React.createElement("tbody", null, (function() {
      var j, len, ref, results;
      ref = this.props.subjects;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        subject = ref[j];
        results.push(React.createElement(SubjectSetListingRow, {
          "key": subject.id,
          "subject": subject,
          "onPreview": this.props.onPreview,
          "onRemove": this.props.onRemove
        }));
      }
      return results;
    }).call(this)));
  }
});

SubjectSetListing = React.createClass({
  displayName: 'SubjectSetListing',
  getDefaultProps: function() {
    return {
      subjectSet: {}
    };
  },
  getInitialState: function() {
    return {
      page: 1,
      pageCount: NaN
    };
  },
  render: function() {
    var gettingSetMemberSubjects, gettingSubjects, p;
    gettingSetMemberSubjects = apiClient.type('set_member_subjects').get({
      subject_set_id: this.props.subjectSet.id,
      page: this.state.page
    });
    gettingSetMemberSubjects.then((function(_this) {
      return function(arg) {
        var newPageCount, setMemberSubject;
        setMemberSubject = arg[0];
        newPageCount = setMemberSubject != null ? setMemberSubject.getMeta().page_count : void 0;
        if (newPageCount !== _this.state.pageCount) {
          return _this.setState({
            pageCount: newPageCount
          });
        }
      };
    })(this));
    gettingSubjects = gettingSetMemberSubjects.get('subject');
    return React.createElement("div", null, React.createElement(PromiseRenderer, {
      "promise": gettingSubjects,
      "then": ((function(_this) {
        return function(subjects) {
          return React.createElement(SubjectSetListingTable, {
            "subjects": subjects,
            "onPreview": _this.previewSubject,
            "onRemove": _this.removeSubject
          });
        };
      })(this))
    }), React.createElement("nav", {
      "className": "pagination"
    }, "Page ", React.createElement("select", {
      "value": this.state.page,
      "disabled": this.state.pageCount < 2 || isNaN(this.state.pageCount),
      "onChange": ((function(_this) {
        return function(e) {
          return _this.setState({
            page: e.target.value
          });
        };
      })(this))
    }, ((function() {
      var j, ref, results;
      if (isNaN(this.state.pageCount)) {
        return React.createElement("option", null, "?");
      } else {
        results = [];
        for (p = j = 1, ref = this.state.pageCount; 1 <= ref ? j <= ref : j >= ref; p = 1 <= ref ? ++j : --j) {
          results.push(React.createElement("option", {
            "key": p,
            "value": p
          }, p));
        }
        return results;
      }
    }).call(this))), " of ", this.state.pageCount || '?'));
  },
  previewSubject: function(subject) {
    return alert(React.createElement("div", {
      "className": "content-container subject-preview"
    }, React.createElement(SubjectViewer, {
      "subject": subject
    })));
  },
  removeSubject: function(subject) {
    return this.props.subjectSet.removeLink('subjects', subject.id).then((function(_this) {
      return function() {
        return announceSetChange();
      };
    })(this));
  }
});

EditSubjectSetPage = React.createClass({
  displayName: 'EditSubjectSetPage',
  mixins: [History],
  getDefaultProps: function() {
    return {
      subjectSet: null
    };
  },
  getInitialState: function() {
    return {
      manifests: {},
      tooBigFiles: {},
      files: {},
      deletionError: null,
      deletionInProgress: false,
      successfulCreates: [],
      successfulUploads: [],
      creationErrors: []
    };
  },
  subjectLimitMessage: function(project_subject_count, user) {
    return "The project has " + project_subject_count + " uploaded subjects. " + "You have uploaded " + user.uploaded_subjects_count + " subjects from an " + "allowance of " + user.max_subjects + ". Your uploaded subject count is the tally of all subjects (including those deleted) that your account has uploaded through the project builder or Zooniverse api.";
  },
  render: function() {
    var char, error, errors, ext, i, name, ready, subjects, subjectsToCreate;
    return React.createElement("div", null, React.createElement("h3", null, this.props.subjectSet.display_name, " #", this.props.subjectSet.id), React.createElement("p", {
      "className": "form-help"
    }, "A subject is a unit of data to be analyzed. A subject can include one or more images that will be analyzed at the same time by volunteers. A subject set consists of a list of subjects (the manifest) defining their properties, and the images themselves."), React.createElement("p", {
      "className": "form-help"
    }, "Feel free to group subjects into sets in the way that is most useful for your research. Many projects will find its best to just have all their subjects in 1 set, but not all."), React.createElement("p", {
      "className": "form-help"
    }, this.subjectLimitMessage(this.props.project.subjects_count, this.props.user), " "), React.createElement("p", {
      "className": "form-help"
    }, React.createElement("strong", null, "We strongly recommend uploading subjects in batches of 500 - 1,000 at a time.")), React.createElement("form", {
      "onSubmit": this.handleSubmit
    }, React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.subjectSet
    }, React.createElement("span", {
      "className": "form-label"
    }, "Name"), React.createElement("br", null), React.createElement("input", {
      "type": "text",
      "name": "display_name",
      "placeholder": "Subject Set Name",
      "value": this.props.subjectSet.display_name,
      "className": "standard-input full",
      "onChange": handleInputChange.bind(this.props.subjectSet)
    })), React.createElement("small", {
      "className": "form-help"
    }, "A subject sets name is only seen by the research team."))), React.createElement("hr", null), "\nThis set contains ", this.props.subjectSet.set_member_subjects_count, " subjects:", React.createElement("br", null), React.createElement(SubjectSetListing, {
      "subjectSet": this.props.subjectSet
    }), React.createElement("hr", null), React.createElement("p", null, React.createElement(UploadDropTarget, {
      "accept": "text/csv, text/tab-separated-values, image/*" + (isAdmin() ? ', video/*' : ''),
      "multiple": true,
      "onSelect": this.handleFileSelection
    }, React.createElement("strong", null, "Drag-and-drop or click to upload manifests and subject images here."), React.createElement("br", null), "Manifests must be ", React.createElement("code", null, ".csv"), " or ", React.createElement("code", null, ".tsv"), ". The first row should define metadata headers. All other rows should include at least one reference to an image filename in the same directory as the manifest.", React.createElement("br", null), "Headers that begin with \"#\" or \"\x2F\x2F\" denote private fields that will not be visible to classifiers in the main classification interface or in the Talk discussion tool.", React.createElement("br", null), "Subject images can be up to ", MAX_FILE_SIZE / 1024, "KB and any of: ", (function() {
      var j, len, results;
      results = [];
      for (i = j = 0, len = VALID_SUBJECT_EXTENSIONS.length; j < len; i = ++j) {
        ext = VALID_SUBJECT_EXTENSIONS[i];
        results.push(React.createElement("span", {
          "key": ext
        }, React.createElement("code", null, ext), (VALID_SUBJECT_EXTENSIONS[i + 1] != null ? ', ' : void 0)));
      }
      return results;
    })(), ' ', "and may not contain ", (function() {
      var j, len, results;
      results = [];
      for (i = j = 0, len = INVALID_FILENAME_CHARS.length; j < len; i = ++j) {
        char = INVALID_FILENAME_CHARS[i];
        results.push(React.createElement("span", {
          "key": char
        }, React.createElement("kbd", null, char), (INVALID_FILENAME_CHARS[i + 1] != null ? ', ' : void 0)));
      }
      return results;
    })(), React.createElement("br", null))), React.createElement("div", {
      "className": "manifests-and-subjects"
    }, React.createElement("ul", null, ((function() {
      var ref, ref1, results;
      subjectsToCreate = 0;
      ref = this.state.manifests;
      results = [];
      for (name in ref) {
        ref1 = ref[name], errors = ref1.errors, subjects = ref1.subjects;
        ready = ManifestView.separateSubjects(subjects, this.state.files, this.state.tooBigFiles).ready;
        subjectsToCreate += ready.length;
        results.push(React.createElement("li", {
          "key": name
        }, React.createElement(ManifestView, {
          "name": name,
          "errors": errors,
          "tooBigFiles": this.state.tooBigFiles,
          "subjects": subjects,
          "files": this.state.files,
          "onRemove": this.handleRemoveManifest.bind(this, name)
        })));
      }
      return results;
    }).call(this))), React.createElement("button", {
      "type": "button",
      "className": "major-button",
      "disabled": subjectsToCreate === 0,
      "onClick": this.createSubjects
    }, "Upload ", subjectsToCreate, " new subjects"), (this.state.successfulCreates.length !== 0 ? React.createElement("div", null, this.state.successfulCreates.length, " subjects created (with ", this.state.successfulUploads.length, " files uploaded).") : void 0), (this.state.creationErrors.length !== 0 ? React.createElement("div", null, "Errors creating subjects:", React.createElement("ul", null, (function() {
      var j, len, ref, results;
      ref = this.state.creationErrors;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        error = ref[j];
        results.push(React.createElement("li", {
          "className": "form-help error"
        }, error.message));
      }
      return results;
    }).call(this))) : void 0)), React.createElement("hr", null), React.createElement("p", null, React.createElement("small", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "disabled": this.state.deletionInProgress,
      "onClick": this.deleteSubjectSet
    }, "Delete this subject set and its ", this.props.subjectSet.set_member_subjects_count, " subjects")), ' ', (this.state.deletionError != null ? React.createElement("span", {
      "className": "form-help error"
    }, this.state.deletionError.message) : void 0)));
  },
  handleSubmit: function(e) {
    e.preventDefault();
    return this.saveResource();
  },
  handleFileSelection: function(files) {
    var _, allowedFileExts, autoManifest, ext, file, gotFile, gotManifest, j, len, name, ref, ref1, ref2;
    this.setState({
      successfulCreates: [],
      successfulUploads: [],
      creationErrors: []
    });
    for (j = 0, len = files.length; j < len; j++) {
      file = files[j];
      if (file.size !== 0) {
        if ((ref = file.type) === 'text/csv' || ref === 'text/tab-separated-values') {
          this._addManifest(file);
          gotManifest = true;
        } else if (file.type.indexOf('image/') === 0 || (isAdmin() && file.type.indexOf('video/') === 0)) {
          if (file.size < MAX_FILE_SIZE || isAdmin()) {
            this.state.files[file.name] = file;
            gotFile = true;
          } else {
            this.state.tooBigFiles[file.name] = file;
            gotFile = true;
          }
        } else if (file.type != null) {
          allowedFileExts = ['csv', 'tsv'];
          ext = file.name.split('.').pop();
          if (allowedFileExts.indexOf(ext) > -1) {
            this._addManifest(file);
            gotManifest = true;
          }
        }
      }
    }
    if (!gotManifest) {
      autoManifest = [];
      ref1 = this.state.files;
      for (name in ref1) {
        _ = ref1[name];
        autoManifest.push({
          Filename: name
        });
      }
      ref2 = this.state.tooBigFiles;
      for (name in ref2) {
        _ = ref2[name];
        autoManifest.push({
          Filename: name
        });
      }
      return this.subjectsFromManifest(autoManifest, [], "AutoGeneratedManifest");
    }
  },
  _addManifest: function(file) {
    var reader;
    reader = new FileReader;
    reader.onload = (function(_this) {
      return function(e) {
        var data, errors, ref;
        ref = Papa != null ? Papa.parse(e.target.result.trim(), {
          header: true
        }) : void 0, data = ref.data, errors = ref.errors;
        return _this.subjectsFromManifest(data, errors, file.name);
      };
    })(this);
    return reader.readAsText(file);
  },
  subjectsFromManifest: function(data, errors, fileName) {
    var cleanData, j, key, len, locations, metadata, metadatas, rawData, subjects, value;
    metadatas = (function() {
      var j, len, ref, results;
      results = [];
      for (j = 0, len = data.length; j < len; j++) {
        rawData = data[j];
        cleanData = {};
        for (key in rawData) {
          value = rawData[key];
          cleanData[key.trim()] = (ref = value != null ? typeof value.trim === "function" ? value.trim() : void 0 : void 0) != null ? ref : value;
        }
        results.push(cleanData);
      }
      return results;
    })();
    subjects = [];
    for (j = 0, len = metadatas.length; j < len; j++) {
      metadata = metadatas[j];
      locations = this._findFilesInMetadata(metadata);
      if (locations.length !== 0) {
        subjects.push({
          locations: locations,
          metadata: metadata
        });
      }
    }
    this.state.manifests[fileName] = {
      errors: errors,
      subjects: subjects
    };
    console.log(this.state.manifests);
    return this.forceUpdate();
  },
  _findFilesInMetadata: function(metadata) {
    var extensions, filesInMetadata, filesInValue, key, value;
    filesInMetadata = [];
    for (key in metadata) {
      value = metadata[key];
      extensions = isAdmin() ? '\\.\\D\\w{2,4}' : "(?:" + (VALID_SUBJECT_EXTENSIONS.join('|')) + ")";
      filesInValue = typeof value.match === "function" ? value.match(RegExp("([^" + (INVALID_FILENAME_CHARS.join('')) + "]+" + extensions + ")", "gi")) : void 0;
      if (filesInValue != null) {
        filesInMetadata.push.apply(filesInMetadata, filesInValue);
      }
    }
    return filesInMetadata;
  },
  handleRemoveManifest: function(name) {
    delete this.state.manifests[name];
    return this.forceUpdate();
  },
  createSubjects: function() {
    var allSubjects, name, ready, ref, startUploading, subjects, uploadAlert;
    allSubjects = [];
    ref = this.state.manifests;
    for (name in ref) {
      subjects = ref[name].subjects;
      ready = ManifestView.separateSubjects(subjects, this.state.files, this.state.tooBigFiles).ready;
      allSubjects.push.apply(allSubjects, ready);
    }
    uploadAlert = (function(_this) {
      return function(resolve) {
        return React.createElement("div", {
          "className": "content-container"
        }, React.createElement(SubjectUploader, {
          "subjects": allSubjects,
          "files": _this.state.files,
          "project": _this.props.project,
          "subjectSet": _this.props.subjectSet,
          "autoStart": true,
          "onComplete": resolve
        }));
      };
    })(this);
    return startUploading = alert(uploadAlert).then((function(_this) {
      return function(arg) {
        var creates, errors, uploads;
        creates = arg.creates, uploads = arg.uploads, errors = arg.errors;
        _this.setState({
          successfulCreates: creates,
          successfulUploads: uploads,
          creationErrors: errors,
          manifests: {},
          files: {}
        });
        return announceSetChange();
      };
    })(this));
  },
  deleteSubjectSet: function() {
    var confirmed;
    this.setState({
      deletionError: null
    });
    confirmed = confirm('Really delete this subject set and all its subjects?');
    if (confirmed) {
      this.setState({
        deletionInProgress: true
      });
      return this.props.subjectSet["delete"]().then((function(_this) {
        return function() {
          announceSetChange();
          _this.props.project.uncacheLink('subject_sets');
          return _this.history.pushState(null, "/lab/" + _this.props.project.id);
        };
      })(this))["catch"]((function(_this) {
        return function(error) {
          return _this.setState({
            deletionError: error
          });
        };
      })(this)).then((function(_this) {
        return function() {
          if (_this.isMounted()) {
            return _this.setState({
              deletionInProgress: false
            });
          }
        };
      })(this));
    }
  }
});

module.exports = React.createClass({
  displayName: 'EditSubjectSetPageWrapper',
  getDefaultProps: function() {
    return {
      params: null
    };
  },
  render: function() {
    return React.createElement(PromiseRenderer, {
      "promise": apiClient.type('subject_sets').get(this.props.params.subjectSetID)
    }, ((function(_this) {
      return function(subjectSet) {
        return React.createElement(ChangeListener, {
          "target": subjectSet
        }, (function() {
          return React.createElement(EditSubjectSetPage, React.__spread({}, _this.props, {
            "subjectSet": subjectSet
          }));
        }));
      };
    })(this)));
  }
});


},{"../../components/auto-save":62,"../../components/change-listener":63,"../../components/manifest-view":78,"../../components/promise-renderer":86,"../../components/subject-viewer":90,"../../components/upload-drop-target":94,"../../lib/alert":98,"../../lib/handle-input-change":103,"../../lib/is-admin":105,"../../partials/subject-uploader":229,"panoptes-client/lib/api-client":549,"papaparse":"papaparse","react":"react","react-router":"react-router"}],165:[function(require,module,exports){
var CreateBoardForm, CreateSubjectDefaultButton, React, projectSection, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

CreateSubjectDefaultButton = require('../../talk/lib/create-subject-default-button');

CreateBoardForm = require('../../talk/lib/create-board-form');

projectSection = require('../../talk/lib/project-section');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'EditProjectTalk',
    getDefaultProps: function() {
      return {
        project: {}
      };
    },
    getInitialState: function() {
      return {
        boards: [],
        editingBoard: null
      };
    },
    section: function() {
      return projectSection(this.props.project);
    },
    componentWillMount: function() {
      return this.setBoards();
    },
    setBoards: function() {
      return talkClient.type('boards').get({
        section: this.section()
      }).then((function(_this) {
        return function(boards) {
          return _this.setState({
            boards: boards
          });
        };
      })(this));
    },
    onClickEditTitle: function(e, board) {
      var description, descriptionTextarea, title, titleInput;
      e.preventDefault();
      titleInput = this.refs["board-title-" + board.id];
      title = titleInput.value;
      descriptionTextarea = this.refs["board-description-" + board.id];
      description = descriptionTextarea.value;
      return talkClient.type('boards').get(board.id).update({
        title: title,
        description: description
      }).save().then((function(_this) {
        return function() {
          return _this.setState({
            editingBoard: null
          }, _this.setBoards);
        };
      })(this));
    },
    onClickDeleteBoard: function(e, board) {
      e.preventDefault();
      if (window.confirm("Are you sure that you want to delete the " + board.title + " board? All of it's content will be lost forever")) {
        return talkClient.type('boards').get(board.id)["delete"]().then(this.setBoards);
      }
    },
    board: function(board, i) {
      return React.createElement("li", {
        "key": board.id
      }, (this.state.editingBoard === board.id ? React.createElement("div", {
        "className": "talk-module talk-form"
      }, React.createElement("span", null, "Title"), React.createElement("input", {
        "ref": "board-title-" + board.id,
        "type": "text",
        "defaultValue": board.title
      }), React.createElement("div", null, "Description"), React.createElement("textarea", {
        "ref": "board-description-" + board.id,
        "defaultValue": board.description
      }), React.createElement("button", {
        "type": "button",
        "onClick": ((function(_this) {
          return function() {
            return _this.setState({
              editingBoard: null
            });
          };
        })(this))
      }, "Cancel"), React.createElement("button", {
        "type": "button",
        "onClick": ((function(_this) {
          return function(e) {
            return _this.onClickEditTitle(e, board);
          };
        })(this))
      }, "Submit")) : React.createElement("span", null, React.createElement("span", null, board.title, (board.subject_default ? ' (Subject Default)' : ''), ' '), React.createElement("i", {
        "className": "fa fa-pencil",
        "title": "Edit Title",
        "onClick": ((function(_this) {
          return function() {
            return _this.setState({
              editingBoard: _this.state.editingBoard ? null : board.id
            });
          };
        })(this))
      }), ' ', React.createElement("i", {
        "className": "fa fa-close",
        "title": "Delete",
        "onClick": ((function(_this) {
          return function(e) {
            return _this.onClickDeleteBoard(e, board);
          };
        })(this))
      }))), React.createElement("ul", null, React.createElement("li", {
        "style": {
          listStyleType: 'none',
          opacity: 0.5
        }
      }, board.description)));
    },
    render: function() {
      return React.createElement("div", {
        "className": "edit-project-talk talk"
      }, React.createElement("p", {
        "className": "form-help"
      }, "Setup your project\'s talk"), React.createElement("p", null, "Talk is the name for the discussion boards attached to your project. On your Talk, volunteers will be able to discuss your project and subjects with each other, as well as with you and your projects researchers. Maintaining a vibrant and active Talk is important for keeping your volunteers engaged with your project. Conversations on Talk also can lead to additional research discoveries."), React.createElement("p", null, "You can use this page to set up the initial Talk boards for your project. We highly recommend first activating the default subject-discussion board, which hosts a single dedicated conversation for each subject. After that, you can add additional boards, where each board will host conversation about a general topic. Example boards might include: Announcements, Project Discussion, Questions for the Research Team, or Technical Support."), React.createElement("p", null, "1. Click this button to create a default board for volunteers to comment on subjects after classifying (strongly recommended)"), React.createElement(CreateSubjectDefaultButton, {
        "section": this.section(),
        "onCreateBoard": ((function(_this) {
          return function() {
            return _this.setBoards();
          };
        })(this))
      }), React.createElement("p", null, "2. Add any additional discussion boards"), React.createElement("div", {
        "className": "talk-module"
      }, React.createElement(CreateBoardForm, {
        "section": this.section(),
        "user": this.props.user,
        "onSubmitBoard": ((function(_this) {
          return function() {
            return _this.setBoards();
          };
        })(this))
      })), React.createElement("p", null, "Your Project\'s Discussion Boards"), React.createElement("div", null, (this.state.boards.length ? React.createElement("ul", null, this.state.boards.map(this.board)) : React.createElement("p", null, "See above to add boards to your project, or look in the moderator controls listed under the talk tab of your project!"))));
    }
  });
}


},{"../../talk/lib/create-board-form":265,"../../talk/lib/create-subject-default-button":266,"../../talk/lib/project-section":276,"panoptes-client/lib/talk-client":553,"react":"react"}],166:[function(require,module,exports){
var ProjectModalEditor, React;

React = require('react');

ProjectModalEditor = require('../../partials/project-modal-editor');

module.exports = React.createClass({
  displayName: 'EditTutorial',
  render: function() {
    return React.createElement("div", null, React.createElement("div", null, React.createElement("p", {
      "className": "form-label"
    }, "Project tutorial"), React.createElement("p", null, "The project tutorial is a step-by-step introduction to the project\'s interface."), React.createElement("p", null, "This is the place to give the volunteers a preview of the data they\'ll be working with and of the steps they\'ll be taking to make classifications. It\'s also a good place to mention any common \"gotchas\" users might face."), React.createElement("p", null, "However, it\'s also important to keep this as short as possible so volunteers can get started classifying as soon as possible!")), React.createElement("div", null, React.createElement(ProjectModalEditor, {
      "project": this.props.project,
      "type": "tutorials"
    })));
  }
});


},{"../../partials/project-modal-editor":224,"react":"react"}],167:[function(require,module,exports){
var React, SetToggle;

React = require('react');

SetToggle = require('../../lib/set-toggle');

module.exports = React.createClass({
  displayName: 'EditProjectVisibility',
  getDefaultProps: function() {
    return {
      project: null
    };
  },
  getInitialState: function() {
    return {
      error: null,
      setting: {
        "private": false,
        beta_requested: false,
        launch_requested: false
      }
    };
  },
  mixins: [SetToggle],
  setterProperty: 'project',
  render: function() {
    var looksDisabled;
    looksDisabled = {
      opacity: 0.7,
      pointerEvents: 'none'
    };
    return React.createElement("div", null, React.createElement("p", {
      "className": "form-label"
    }, "Project state and visibility"), (this.state.error ? React.createElement("p", {
      "className": "form-help error"
    }, this.state.error.toString()) : void 0), React.createElement("p", null, React.createElement("label", {
      "style": {
        whiteSpace: 'nowrap'
      }
    }, React.createElement("input", {
      "type": "radio",
      "name": "private",
      "value": true,
      "data-json-value": true,
      "checked": this.props.project["private"],
      "disabled": this.state.setting["private"],
      "onChange": this.set.bind(this, 'private', true)
    }), "Private"), "        ", React.createElement("label", {
      "style": {
        whiteSpace: 'nowrap'
      }
    }, React.createElement("input", {
      "type": "radio",
      "name": "private",
      "value": false,
      "data-json-value": true,
      "checked": !this.props.project["private"],
      "disabled": this.state.setting["private"],
      "onChange": this.set.bind(this, 'private', false)
    }), "Public")), React.createElement("p", {
      "className": "form-help"
    }, "Only the assigned ", React.createElement("strong", null, "collaborators"), " can view a private project. Anyone with the URL can access a public project."), React.createElement("hr", null), React.createElement("label", {
      "style": {
        whiteSpace: 'nowrap'
      }
    }, React.createElement("input", {
      "type": "radio",
      "name": "live",
      "value": true,
      "data-json-value": true,
      "checked": !this.props.project.live,
      "disabled": this.state.setting.live,
      "onChange": this.set.bind(this, 'live', false)
    }), "Development"), "      ", React.createElement("label", {
      "style": {
        whiteSpace: 'nowrap'
      }
    }, React.createElement("input", {
      "type": "radio",
      "name": "live",
      "value": false,
      "data-json-value": true,
      "checked": this.props.project.live,
      "disabled": this.state.setting.live,
      "onChange": this.set.bind(this, 'live', true)
    }), "Live"), React.createElement("p", {
      "className": "form-help"
    }, "Workflows can be edited during development, and subjects will never retire. In a live project, workflows are locked and can no longer be edited, and classifications count toward subject retirement."), React.createElement("div", {
      "style": (this.props.project["private"] || !this.props.project.live ? looksDisabled : void 0)
    }, React.createElement("hr", null), React.createElement("p", null, React.createElement("button", {
      "type": "button",
      "className": "standard-button",
      "disabled": this.props.project["private"] || !this.props.project.live || this.state.setting.beta_requested || this.props.project.beta_requested || this.props.project.beta_approved,
      "onClick": this.set.bind(this, 'beta_requested', true)
    }, "Apply for review"), ' ', (this.props.project["private"] ? React.createElement("span", null, "Only ", React.createElement("strong", null, "public projects"), " can apply for review.") : !this.props.project.live ? React.createElement("span", null, "Only ", React.createElement("strong", null, "live projects"), " can apply for review.") : this.props.project.beta_requested ? React.createElement("span", null, "Review status has been applied for. ", React.createElement("button", {
      "type": "button",
      "disabled": this.state.setting.beta_requested,
      "onClick": this.set.bind(this, 'beta_requested', false)
    }, "Cancel application")) : void 0)), (!this.props.project.beta_approved ? React.createElement("p", {
      "className": "form-help"
    }, "Pending approval, expose this project to users who have opted in to help test new projects.") : void 0), (this.props.project.beta_approved ? React.createElement("span", null, React.createElement("div", {
      "className": "approval-status"
    }, React.createElement("span", null, "Beta Approval Status: "), React.createElement("span", {
      "className": "color-label green"
    }, "Approved")), React.createElement("p", null, "Review status for this project has been approved. To end the review and make changes, switch back to ", React.createElement("em", null, "development"), " mode.", (!(this.props.project.launch_requested || this.props.project.launch_approved) ? React.createElement("span", null, "If youre ready to launch this project, see the next section.") : void 0))) : this.props.project.beta_requested ? React.createElement("div", {
      "className": "approval-status"
    }, React.createElement("span", null, "Beta Approval Status: "), React.createElement("span", {
      "className": "color-label orange"
    }, "Pending")) : void 0), React.createElement("div", {
      "style": (!this.props.project.beta_approved ? looksDisabled : void 0)
    }, React.createElement("hr", null), React.createElement("p", null, React.createElement("button", {
      "type": "button",
      "className": "standard-button",
      "disabled": !this.props.project.beta_approved || this.state.setting.launch_requested || this.props.project.launch_requested,
      "onClick": this.set.bind(this, 'launch_requested', true)
    }, "Apply for full launch"), ' ', (!this.props.project.beta_approved ? React.createElement("span", null, "Only ", React.createElement("strong", null, "projects in review"), " can apply for a full launch.") : void 0), (this.props.project.launch_approved ? React.createElement("span", null, React.createElement("div", {
      "className": "approval-status"
    }, React.createElement("span", null, "Launch Approval Status: "), React.createElement("span", {
      "className": "color-label green"
    }, "Approved")), "This project is available to the whole Zooniverse!") : this.props.project.launch_requested ? React.createElement("span", null, React.createElement("div", {
      "className": "approval-status"
    }, React.createElement("span", null, "Launch Approval Status: "), React.createElement("span", {
      "className": "color-label orange"
    }, "Pending")), "Launch is awaiting Zooniverse approval. ", React.createElement("button", {
      "type": "button",
      "disabled": this.state.setting.launch_requested,
      "onClick": this.set.bind(this, 'launch_requested', false)
    }, "Cancel application")) : void 0)), (!this.props.project.launch_approved ? React.createElement("p", {
      "className": "form-help"
    }, "Pending approval, expose this project to the entire Zooniverse through the main projects listing.") : void 0))));
  }
});


},{"../../lib/set-toggle":115,"react":"react"}],168:[function(require,module,exports){
var React, ReactDOM, WorkflowCreateForm, counterpart;

React = require('react');

ReactDOM = require('react-dom');

counterpart = require('counterpart');

WorkflowCreateForm = React.createClass({displayName: "WorkflowCreateForm",
  getDefaultProps: function() {
    return {
      onCancel: function() {},
      onSubmit: function() {},
      onSuccess: function() {},
      projectID: '',
      workflowToClone: null
    };
  },
  getInitialState: function() {
    return {
      busy: false,
      error: null
    };
  },
  handleSubmit: function(e) {
    var awaitSubmission, newWorkflow, ref, ref1, ref2, ref3, workflowToClone;
    e.preventDefault();
    this.setState({
      busy: true,
      error: null
    });
    workflowToClone = this.props.workflowToClone;
    newWorkflow = {
      display_name: this.refs.newDisplayName.value,
      primary_language: counterpart.getLocale(),
      tasks: (ref = workflowToClone != null ? workflowToClone.tasks : void 0) != null ? ref : {
        init: {
          type: 'single',
          question: 'Ask your first question here.',
          answers: [
            {
              label: 'Yes'
            }
          ]
        }
      },
      first_task: (ref1 = workflowToClone != null ? workflowToClone.first_task : void 0) != null ? ref1 : 'init',
      configuration: (ref2 = workflowToClone != null ? workflowToClone.configuration : void 0) != null ? ref2 : {},
      retirement: (ref3 = workflowToClone != null ? workflowToClone.retirement : void 0) != null ? ref3 : {}
    };
    awaitSubmission = this.props.onSubmit(this.props.projectID, newWorkflow);
    return Promise.resolve(awaitSubmission).then((function(_this) {
      return function(result) {
        _this.setState({
          busy: false
        });
        return _this.props.onSuccess(result);
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this));
  },
  render: function() {
    return React.createElement("form", {
      "onSubmit": this.handleSubmit,
      "style": {
        maxWidth: '90vw',
        width: '30ch'
      }
    }, React.createElement("label", null, React.createElement("span", {
      "className": "form-label"
    }, "New Workflow Title"), React.createElement("br", null), React.createElement("input", {
      "className": "standard-input full",
      "type": "text",
      "ref": "newDisplayName",
      "defaultValue": "new worfklow title",
      "autoFocus": true,
      "required": true
    })), React.createElement("br", null), (this.state.error != null ? React.createElement("p", {
      "className": "form-help error"
    }, this.state.error.toString()) : void 0), React.createElement("p", {
      "style": {
        textAlign: 'center'
      }
    }, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "disabled": this.state.busy,
      "onClick": this.props.onCancel
    }, "Cancel"), ' ', React.createElement("button", {
      "type": "submit",
      "className": "major-button",
      "disabled": this.state.busy
    }, "Add")));
  }
});

module.exports = WorkflowCreateForm;


},{"counterpart":"counterpart","react":"react","react-dom":"react-dom"}],169:[function(require,module,exports){
var AnswerItem, Markdown, React, icons;

React = require('react');

icons = require('../../../classifier/tasks/drawing/icons');

Markdown = require('markdownz').Markdown;

AnswerItem = React.createClass({
  displayName: 'AnswerItem',
  render: function() {
    var icon;
    icon = void 0;
    if (this.props.inputs.type === 'drawing') {
      icon = React.createElement("span", {
        "className": 'drawing-tool-icon-vis',
        "style": {
          color: this.props.inputs.item.color
        }
      }, icons[this.props.inputs.item.type]);
    } else if (((this.props.inputs.type === 'survey') || (this.props.inputs.type === 'flexibleSurvey')) && (this.props.inputs.item.images.length > 0)) {
      icon = React.createElement("span", {
        "className": "survey-task-chooser-choice-thumbnail-container"
      }, React.createElement("img", {
        "src": this.props.inputs.images[this.props.inputs.item.images[0]],
        "alt": this.props.inputs.item.label,
        "className": "survey-task-chooser-characteristic-value-icon"
      }));
    }
    return React.createElement("li", {
      "className": 'answer-item',
      "id": this.props.inputs.listId
    }, React.createElement("div", {
      "className": 'lab'
    }, icon, React.createElement(Markdown, {
      "className": 'markdown-vis'
    }, this.props.inputs.item.label)));
  }
});

module.exports = React.createClass({
  displayName: 'AnswerList',
  createAnswers: function() {
    var answers, i, idx, inputs, item, items, j, len, len1, order, ref, ref1;
    switch (this.props.task.type) {
      case 'drawing':
        items = this.props.task.tools;
        break;
      case 'survey':
        items = {};
        idx = 0;
        ref = this.props.task.choicesOrder;
        for (i = 0, len = ref.length; i < len; i++) {
          order = ref[i];
          items[idx] = this.props.task.choices[order];
          idx += 1;
        }
        break;
      case 'flexibleSurvey':
        items = {};
        idx = 0;
        ref1 = this.props.task.choicesOrder;
        for (j = 0, len1 = ref1.length; j < len1; j++) {
          order = ref1[j];
          items[idx] = this.props.task.choices[order];
          idx += 1;
        }
        break;
      default:
        items = this.props.task.answers;
    }
    answers = [];
    for (idx in items) {
      item = items[idx];
      inputs = {
        idx: idx,
        item: item,
        listId: this.props.inputs.uuid.get(idx),
        type: this.props.task.type,
        images: this.props.task.images
      };
      answers.push(React.createElement(AnswerItem, {
        "jp": this.props.jp,
        "key": "Al_" + idx,
        "inputs": inputs,
        "eps": this.props.inputs.eps
      }));
    }
    return answers;
  },
  render: function() {
    return React.createElement("ul", {
      "className": 'list-unstyled',
      "id": this.props.plumbId + "_answers"
    }, this.createAnswers());
  }
});


},{"../../../classifier/tasks/drawing/icons":25,"markdownz":"markdownz","react":"react"}],170:[function(require,module,exports){
var ChangeListener, History, Navigation, PromiseRenderer, React, WorkflowNodes, WorkflowVis, apiClient, ref;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

PromiseRenderer = require('../../../components/promise-renderer');

ChangeListener = require('../../../components/change-listener');

WorkflowNodes = require('./workflow');

ref = require('react-router'), History = ref.History, Navigation = ref.Navigation;

WorkflowVis = React.createClass({
  displayName: 'WorkflowVis',
  mixins: [History, Navigation],
  getInitialState: function() {
    return {
      jp: jsPlumb.getInstance()
    };
  },
  onSort: function() {
    return this.refs['workflowNodes'].sortTasks();
  },
  workflowLink: function() {
    var name, owner, ref1, viewQuery;
    ref1 = this.props.project.slug.split('/'), owner = ref1[0], name = ref1[1];
    viewQuery = {
      workflow: this.props.workflow.id,
      reload: 0
    };
    return this.history.createHref("/projects/" + owner + "/" + name + "/classify", viewQuery);
  },
  render: function() {
    return React.createElement("div", null, React.createElement("div", {
      "style": {
        pointerEvents: 'all'
      }
    }, React.createElement("button", {
      "className": 'standard-button',
      "onClick": this.onSort
    }, "Sort Task Nodes")), React.createElement("hr", null), React.createElement(WorkflowNodes, {
      "jp": this.state.jp,
      "workflow": this.props.workflow,
      "ref": 'workflowNodes'
    }), React.createElement("hr", null), React.createElement("div", {
      "style": {
        pointerEvents: 'all'
      }
    }, React.createElement("a", {
      "href": this.workflowLink(),
      "className": "standard-button",
      "target": "from-lab",
      "onClick": this.handleViewClick
    }, "Test this workflow")));
  }
});

module.exports = React.createClass({
  displayName: 'WorkflowVisPageWrapper',
  propTypes: {
    params: React.PropTypes.shape({
      projectId: React.PropTypes.string,
      workflowId: React.PropTypes.string
    })
  },
  render: function() {
    return React.createElement(PromiseRenderer, {
      "promise": apiClient.type('workflows').get(this.props.params.workflowID)
    }, ((function(_this) {
      return function(workflow) {
        return React.createElement(ChangeListener, {
          "target": workflow
        }, (function() {
          return React.createElement(WorkflowVis, React.__spread({}, _this.props, {
            "workflow": workflow,
            "ref": 'workflowVis'
          }));
        }));
      };
    })(this)));
  }
});


},{"../../../components/change-listener":63,"../../../components/promise-renderer":86,"./workflow":174,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],171:[function(require,module,exports){
var commonA, commonAOpen, commonT, commonTDraw, connectorHoverStyle, connectorPaintStyle, connectorPaintStyleDashed, endpointHoverStyle;

connectorHoverStyle = {
  lineWidth: 3,
  strokeStyle: "#888",
  outlineWidth: 1.5,
  outlineColor: "white"
};

endpointHoverStyle = {
  fillStyle: "#888"
};

connectorPaintStyle = {
  lineWidth: 3,
  strokeStyle: "#000",
  joinstyle: "round",
  outlineColor: "white",
  outlineWidth: 1.5,
  dashstyle: "1 0"
};

connectorPaintStyleDashed = {
  lineWidth: 3,
  strokeStyle: "#000",
  joinstyle: "round",
  outlineColor: "white",
  outlineWidth: 1.5,
  dashstyle: "4 2"
};

commonA = {
  connector: [
    "Flowchart", {
      stub: 30,
      cornerRadius: 5,
      alwaysRespectStubs: false,
      midpoint: 0.5
    }
  ],
  anchor: "Right",
  isSource: false,
  endpoint: "Dot",
  connectorStyle: connectorPaintStyle,
  hoverPaintStyle: endpointHoverStyle,
  connectorHoverStyle: connectorHoverStyle,
  scope: 'normal',
  paintStyle: {
    fillStyle: "#000",
    radius: 5
  }
};

commonAOpen = {
  connector: [
    "Flowchart", {
      stub: 30,
      cornerRadius: 5,
      alwaysRespectStubs: false,
      midpoint: 0.5
    }
  ],
  anchor: "Right",
  isSource: false,
  endpoint: "Dot",
  connectorStyle: connectorPaintStyleDashed,
  hoverPaintStyle: endpointHoverStyle,
  connectorHoverStyle: connectorHoverStyle,
  scope: 'sub',
  paintStyle: {
    fillStyle: "transparent",
    strokeStyle: "#000",
    radius: 4,
    lineWidth: 2
  }
};

commonT = {
  anchor: "Left",
  isTarget: false,
  endpoint: "Dot",
  maxConnections: -1,
  hoverPaintStyle: endpointHoverStyle,
  connectorHoverStyle: connectorHoverStyle,
  scope: 'normal sub',
  dropOptions: {
    hoverClass: "hover",
    activeClass: "active"
  },
  paintStyle: {
    fillStyle: "#000",
    radius: 7
  }
};

commonTDraw = {
  anchor: "Left",
  isTarget: false,
  endpoint: "Dot",
  maxConnections: -1,
  hoverPaintStyle: endpointHoverStyle,
  connectorHoverStyle: connectorHoverStyle,
  scope: 'normal',
  dropOptions: {
    hoverClass: "hover",
    activeClass: "active"
  },
  paintStyle: {
    fillStyle: "#000",
    radius: 7
  }
};

module.exports = {
  commonA: commonA,
  commonAOpen: commonAOpen,
  commonT: commonT,
  commonTDraw: commonTDraw
};


},{}],172:[function(require,module,exports){
var HelpButton, Markdown, React, RequireBox, TaskName, TriggeredModalForm, tasks;

React = require('react');

TriggeredModalForm = require('modal-form/triggered');

tasks = require('../../../classifier/tasks');

Markdown = require('markdownz').Markdown;

TaskName = React.createClass({
  displayName: 'TaskName',
  render: function() {
    var style, task, taskText;
    task = this.props.workflow[this.props.taskKey];
    taskText = tasks[task.type].getTaskText(task);
    style = {
      'zindex': 'inherit'
    };
    return React.createElement("div", {
      "className": 'answer-item',
      "id": this.props.plumbId + '_name',
      "style": style
    }, React.createElement(Markdown, {
      "className": 'lab markdown-vis'
    }, taskText));
  }
});

RequireBox = React.createClass({
  displayName: 'RequireBox',
  render: function() {
    var task;
    task = this.props.workflow[this.props.taskKey];
    return React.createElement("span", {
      "className": 'req'
    }, "Required", React.createElement("input", {
      "className": 'reqired-check',
      "type": 'checkbox',
      "checked": task.required,
      "disabled": true
    }));
  }
});

HelpButton = React.createClass({
  displayName: 'HelpButton',
  render: function() {
    var helpText, style, task;
    task = this.props.workflow[this.props.taskKey];
    helpText = task.help;
    style = {
      zIndex: this.props.zIndex
    };
    return React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("span", {
        "className": "standard-button help-text-vis"
      }, "Help text"),
      "underlayStyle": style
    }, React.createElement("div", {
      "className": 'help-preview'
    }, React.createElement(Markdown, {
      "className": 'markdown-vis'
    }, helpText)));
  }
});

module.exports = {
  TaskName: TaskName,
  RequireBox: RequireBox,
  HelpButton: HelpButton
};


},{"../../../classifier/tasks":36,"markdownz":"markdownz","modal-form/triggered":548,"react":"react"}],173:[function(require,module,exports){
var AnswerList, HelpButton, React, ReactDOM, RequireBox, Resizable, StartEndNode, Task, TaskName, clone, isFirefox, jsPlumbStyle, max_z, ref, timer;

React = require('react');

ReactDOM = require('react-dom');

Resizable = require('react-component-resizable');

ref = require('./task-helpers'), TaskName = ref.TaskName, RequireBox = ref.RequireBox, HelpButton = ref.HelpButton;

AnswerList = require('./answers');

jsPlumbStyle = require('./jsplumb-style');

max_z = 0;

isFirefox = typeof InstallTrigger !== 'undefined';

timer = null;

Task = React.createClass({
  displayName: 'Task',
  getInitialState: function() {
    return {
      task: this.props.workflow[this.props.taskKey],
      endpoints: [],
      uuid: 0,
      uuids: [],
      style: this.computeInitialStyle(this.props.initialPosition, this.props.taskNumber),
      width: {
        min: 0,
        max: 0,
        val: 0
      }
    };
  },
  computeInitialStyle: function(initialPosition, taskNumber) {
    var style;
    style = initialPosition;
    style['zIndex'] = taskNumber + 2;
    return style;
  },
  componentDidMount: function() {
    var L, computedStyle, dragOptions, ep, eps, i, id, idx, me, new_state, ref1, ref2, style, uuid, uuids;
    me = ReactDOM.findDOMNode(this);
    dragOptions = {
      handle: '.drag-handel',
      start: this.onDrag,
      stop: this.onDragStop
    };
    this.props.jp.draggable(this.props.plumbId, dragOptions);
    if (this.state.task.type === 'drawing') {
      ep = this.props.jp.addEndpoint(this.props.plumbId, jsPlumbStyle.commonTDraw, {
        uuid: this.props.plumbId
      });
    } else {
      ep = this.props.jp.addEndpoint(this.props.plumbId, jsPlumbStyle.commonT, {
        uuid: this.props.plumbId
      });
    }
    ep.canvas.style['z-index'] = this.state.style.zIndex;
    eps = [ep];
    if (this.state.task.subtask) {
      ep = this.props.jp.addEndpoint(this.props.plumbId + '_name', jsPlumbStyle.commonAOpen, {
        uuid: this.props.plumbId + '_next'
      });
      ep.canvas.style['z-index'] = this.state.style.zIndex;
      eps.push(ep);
    } else {
      if (this.state.task.type !== 'multiple') {
        uuids = [];
        uuid = 0;
        if ((ref1 = this.state.task.type) === 'single' || ref1 === 'multiple' || ref1 === 'drawing') {
          if (this.state.task.type === 'single') {
            L = Object.keys(this.state.task.answers).length;
          } else {
            L = Object.keys(this.state.task.tools).length;
          }
          for (idx = i = 0, ref2 = L; 0 <= ref2 ? i < ref2 : i > ref2; idx = 0 <= ref2 ? ++i : --i) {
            id = this.getUuid(idx, uuid, uuids);
            uuids.push(id);
            uuid += 1;
            switch (this.state.task.type) {
              case 'single':
                ep = this.props.jp.addEndpoint(id, jsPlumbStyle.commonA, {
                  uuid: id
                });
                break;
              case 'drawing':
                ep = this.props.jp.addEndpoint(id, jsPlumbStyle.commonAOpen, {
                  uuid: id
                });
            }
            ep.canvas.style['z-index'] = this.state.style.zIndex;
            eps.push(ep);
          }
        }
        this.setUuid(null, uuid, uuids);
      }
      if (this.state.task.type !== 'single') {
        ep = this.props.jp.addEndpoint(this.props.plumbId + '_name', jsPlumbStyle.commonA, {
          uuid: this.props.plumbId + '_next'
        });
        ep.canvas.style['z-index'] = this.state.style.zIndex;
        eps.push(ep);
      }
    }
    computedStyle = window.getComputedStyle(me);
    style = this.state.style;
    style['width'] = computedStyle['width'];
    new_state = {
      style: style,
      endpoints: eps,
      width: {
        min: parseFloat(computedStyle['min-width']),
        max: parseFloat(computedStyle['max-width']),
        val: parseFloat(computedStyle['width'])
      }
    };
    return this.setState(new_state, this.props.onDone);
  },
  componentWillUnmount: function() {
    var ep, i, len, ref1, results;
    ref1 = this.state.endpoints;
    results = [];
    for (i = 0, len = ref1.length; i < len; i++) {
      ep = ref1[i];
      results.push(this.props.jp.deleteEndpoint(ep));
    }
    return results;
  },
  setUuid: function(id, uuid, uuids) {
    var current_uuid, current_uuids;
    current_uuids = uuids != null ? uuids : this.state.uuids.concat([id]);
    current_uuid = uuid != null ? uuid : this.state.uuid + 1;
    return this.setState({
      uuids: current_uuids,
      uuid: current_uuid
    });
  },
  getUuid: function(idx, uuid, uuids) {
    if (uuid == null) {
      uuid = this.state.uuid;
    }
    if (uuids == null) {
      uuids = this.state.uuids;
    }
    if (uuids[idx] != null) {
      return this.state.uuids[idx];
    } else {
      return this.props.plumbId + '_answer_' + idx;
    }
  },
  pushEps: function(ep) {
    var eps;
    eps = this.state.endpoints.concat([ep]);
    return this.setState({
      endpoints: eps
    });
  },
  removeEps: function() {
    var current_uuids, eps;
    eps = this.state.endpoints.slice(0, -1);
    current_uuids = this.state.uuids.slice(0, -1);
    this.setState({
      endpoints: eps
    });
    return this.setState({
      uuids: current_uuids
    });
  },
  updateStyle: function() {
    var me, style;
    me = ReactDOM.findDOMNode(this);
    style = {
      left: me.style.left,
      top: me.style.top,
      width: me.style.width,
      zIndex: this.state.style.zIndex
    };
    if (this.state.style.zIndex > max_z) {
      max_z = this.state.style.zIndex;
    }
    return this.setState({
      style: style
    }, this.onMove);
  },
  validWidth: function(width, type) {
    if (type == null) {
      type = 'string';
    }
    width = parseInt(width);
    if (width > this.state.width.max) {
      width = this.state.width.max;
    }
    if (width < this.state.width.min) {
      width = this.state.width.min;
    }
    if (type === 'string') {
      width += 'px';
    }
    return width;
  },
  onMove: function() {
    return this.props.onMove(this.props.taskKey);
  },
  getInputs: function() {
    var inputs;
    return inputs = {
      eps: {
        add: this.pushEps,
        remove: this.removeEps,
        zIndex: this.state.style.zIndex,
        endpoints: this.state.endpoints
      },
      uuid: {
        set: this.setUuid,
        get: this.getUuid
      }
    };
  },
  moveMe: function(position) {
    var me;
    me = ReactDOM.findDOMNode(this);
    me.style.left = position.left + 'px';
    me.style.top = position.top + 'px';
    if (position.width != null) {
      me.style.width = position.width + 'px';
    }
    this.onDrag();
    this.updateEndpoints();
    return this.updateStyle();
  },
  onDrag: function(e) {
    var ep, i, len, ref1, style;
    style = this.state.style;
    if (style.zIndex < max_z) {
      max_z += 1;
      ref1 = this.state.endpoints;
      for (i = 0, len = ref1.length; i < len; i++) {
        ep = ref1[i];
        ep.canvas.style['z-index'] = max_z;
      }
      style.zIndex = max_z;
      return this.setState({
        style: style
      });
    }
  },
  onDragStop: function(e) {
    this.updateEndpoints();
    return this.updateStyle();
  },
  onResize: function(e) {
    var delta, ep, i, len, offset, ref1, width;
    width = this.state.width;
    delta = e.width - width.val - 2;
    this.setState({
      width: width
    });
    ref1 = this.state.endpoints.slice(1);
    for (i = 0, len = ref1.length; i < len; i++) {
      ep = ref1[i];
      offset = this.props.jp.getOffset(ep.elementId);
      offset.left += delta;
      if (isFirefox) {
        offset.left += 2;
        offset.top += 2;
      }
      this.props.jp.repaint(ep.elementId, offset);
      this.props.jp.dragManager.updateOffsets(this.props.plumbId);
    }
    if (timer !== null) {
      clearTimeout(timer);
    }
    return timer = setTimeout(this.onResizeStop, 150);
  },
  onResizeStop: function(e) {
    var me, width;
    me = ReactDOM.findDOMNode(this);
    this.updateEndpoints();
    width = this.state.width;
    width.val = this.validWidth(me.style.width, 'int');
    return this.setState({
      width: width
    }, this.updateStyle);
  },
  updateEndpoints: function() {
    var ep, i, len, offset, ref1;
    ref1 = this.state.endpoints;
    for (i = 0, len = ref1.length; i < len; i++) {
      ep = ref1[i];
      this.props.jp.revalidate(ep.elementId, null, true);
      if (isFirefox) {
        offset = this.props.jp.getOffset(ep.elementId);
        offset.top += 2;
        offset.left += 2;
        this.props.jp.repaint(ep.elementId, offset);
      }
    }
    return this.props.jp.dragManager.updateOffsets(this.props.plumbId);
  },
  render: function() {
    var box_class, helpButton, icon, inputs;
    box_class = 'box noselect ';
    helpButton = void 0;
    if (!this.state.task.subtask && this.state.task.help) {
      helpButton = React.createElement(HelpButton, {
        "workflow": this.props.workflow,
        "taskKey": this.props.taskKey,
        "zIndex": this.state.style.zIndex
      });
    }
    box_class += this.state.task.type + "-box";
    switch (this.state.task.type) {
      case 'single':
        icon = React.createElement("i", {
          "className": "fa fa-dot-circle-o fa-fw"
        });
        break;
      case 'multiple':
        icon = React.createElement("i", {
          "className": "fa fa-check-square-o fa-fw"
        });
        break;
      case 'drawing':
        icon = React.createElement("i", {
          "className": "fa fa-pencil fa-fw"
        });
        break;
      case 'survey':
        icon = React.createElement("i", {
          "className": "fa fa-binoculars fa-fw"
        });
        break;
      case 'crop':
        icon = React.createElement("i", {
          "className": "fa fa-crop fa-fw"
        });
        break;
      case 'text':
        icon = React.createElement("i", {
          "className": "fa fa-file-text-o fa-fw"
        });
        break;
      default:
        icon = void 0;
    }
    inputs = this.getInputs();
    return React.createElement(Resizable, {
      "className": box_class,
      "style": clone(this.state.style),
      "id": this.props.plumbId,
      "ref": this.props.plumbId,
      "embedCss": false,
      "onResize": this.onResize
    }, React.createElement("div", {
      "className": 'drag-handel'
    }, React.createElement("span", {
      "className": 'box-head noselect'
    }, (this.state.task.subtask ? "Sub-" : void 0), "Task " + (this.props.taskKey.substr(1)) + ": ", icon, " " + (this.state.task.type.charAt(0).toUpperCase()) + (this.state.task.type.substr(1))), React.createElement("br", null)), React.createElement(TaskName, {
      "workflow": this.props.workflow,
      "taskKey": this.props.taskKey,
      "plumbId": this.props.plumbId
    }), helpButton, React.createElement(RequireBox, {
      "workflow": this.props.workflow,
      "taskKey": this.props.taskKey
    }), React.createElement(AnswerList, {
      "jp": this.props.jp,
      "inputs": inputs,
      "plumbId": this.props.plumbId,
      "task": this.state.task
    }));
  }
});

StartEndNode = React.createClass({
  displayName: 'StartNode',
  getInitialState: function() {
    return {
      ep: null,
      style: this.getInitialStyle()
    };
  },
  componentDidMount: function() {
    var drag_options, ep;
    drag_options = {
      start: this.onDrag,
      stop: this.onDragStop
    };
    this.props.jp.draggable(this.props.type, drag_options);
    switch (this.props.type) {
      case 'start':
        ep = this.props.jp.addEndpoint(this.props.type, jsPlumbStyle.commonA, {
          uuid: this.props.type
        });
        break;
      case 'end':
        ep = this.props.jp.addEndpoint(this.props.type, jsPlumbStyle.commonT, {
          uuid: this.props.type
        });
    }
    ep.canvas.style['z-index'] = this.state.style.zIndex;
    this.setState({
      ep: ep
    });
    return this.props.onMove(this.props.type);
  },
  moveMe: function(position) {
    var me, style;
    me = ReactDOM.findDOMNode(this);
    style = {
      left: position.left + '',
      top: position.top + ''
    };
    me.style.left = style.left.slice(-2) === 'px' || style.left[-1] === '%' ? style.left : style.left + 'px';
    me.style.top = style.top.slice(-2) === 'px' || style.top[-1] === '%' ? style.top : style.top + 'px';
    this.updateEndpoints();
    this.props.jp.revalidate(this.state.ep.elementId, null, true);
    return this.updateStyle();
  },
  onMove: function() {
    return this.props.onMove(this.props.type);
  },
  onDrag: function() {
    var ep, style;
    ep = this.state.ep;
    if (this.state.style.zIndex < max_z) {
      max_z += 1;
      ep.canvas.style['z-index'] = max_z;
      style = this.state.style;
      style.zIndex = max_z;
      return this.setState({
        style: style,
        ep: ep
      });
    }
  },
  onDragStop: function(e) {
    this.updateEndpoints();
    return this.updateStyle();
  },
  updateStyle: function() {
    var me, style;
    me = ReactDOM.findDOMNode(this);
    style = {
      left: me.style.left,
      top: me.style.top,
      zIndex: this.state.style.zIndex
    };
    return this.setState({
      style: style
    }, this.onMove);
  },
  updateEndpoints: function() {
    return this.props.jp.revalidate(this.state.ep.elementId, null, true);
  },
  getInitialStyle: function() {
    var style;
    style = {
      top: '50%',
      zIndex: 1
    };
    switch (this.props.type) {
      case 'start':
        style['left'] = '0%';
        break;
      case 'end':
        style['right'] = '0%';
    }
    return style;
  },
  render: function() {
    var classString;
    classString = 'box-end noselect ' + this.props.type;
    return React.createElement("div", {
      "className": classString,
      "id": this.props.type,
      "style": clone(this.state.style)
    }, this.props.type.charAt(0).toUpperCase() + this.props.type.slice(1));
  }
});

clone = function(obj) {
  return JSON.parse(JSON.stringify(obj));
};

module.exports = {
  Task: Task,
  StartEndNode: StartEndNode
};


},{"./answers":169,"./jsplumb-style":171,"./task-helpers":172,"react":"react","react-component-resizable":"react-component-resizable","react-dom":"react-dom"}],174:[function(require,module,exports){
var DETACHABLE, React, ReactDOM, StartEndNode, Task, clone, ref;

React = require('react');

ReactDOM = require('react-dom');

ref = require('./task.cjsx'), Task = ref.Task, StartEndNode = ref.StartEndNode;

DETACHABLE = false;

module.exports = React.createClass({
  displayName: 'WorkflowNodes',
  getInitialState: function() {
    var initialTask, keys, position, ref1, taskStateSet, workflow;
    ref1 = this.getWorkflow(), initialTask = ref1.initialTask, keys = ref1.keys, workflow = ref1.workflow, taskStateSet = ref1.taskStateSet;
    position = {};
    return {
      taskStateSet: taskStateSet,
      initialTask: initialTask,
      uuid: keys.length,
      uuids: keys,
      workflow: workflow,
      position: position,
      allSet: false,
      nextTask: {},
      previousTask: {}
    };
  },
  appendToDict: function(dict, key, value) {
    if (dict[key] == null) {
      dict[key] = {};
    }
    return dict[key][value] = value;
  },
  addConnection: function(c, id, nextTask, previousTask) {
    this.props.jp.connect({
      uuids: c,
      detachable: DETACHABLE
    });
    this.appendToDict(nextTask, id, c[1]);
    return this.appendToDict(previousTask, c[1], id);
  },
  componentDidMount: function() {
    var a, adx, c, id, j, l, len, len1, len2, m, nextTask, previousTask, ref1, ref2, ref3, task;
    nextTask = {};
    previousTask = {};
    ref1 = this.state.uuids;
    for (j = 0, len = ref1.length; j < len; j++) {
      id = ref1[j];
      if (id === this.state.initialTask) {
        c = ['start', id];
        this.props.jp.connect({
          uuids: c,
          detachable: DETACHABLE
        });
      }
      task = this.state.workflow[id];
      switch (task.type) {
        case 'single':
          if (task.subtask) {
            if (task.next != null) {
              c = [id + "_next", task.next];
              this.addConnection(c, id, nextTask, previousTask);
            }
          } else {
            ref2 = task.answers;
            for (adx = l = 0, len1 = ref2.length; l < len1; adx = ++l) {
              a = ref2[adx];
              c = [id + "_answer_" + adx, a.next ? a.next : 'end'];
              this.addConnection(c, id, nextTask, previousTask);
            }
          }
          break;
        case 'multiple':
          if (task.subtask) {
            if (task.next != null) {
              c = [id + "_next", task.next];
              this.addConnection(c, id, nextTask, previousTask);
            }
          } else {
            c = [id + "_next", task.next ? task.next : 'end'];
            this.addConnection(c, id, nextTask, previousTask);
          }
          break;
        case 'drawing':
          c = [id + "_next", task.next ? task.next : 'end'];
          this.addConnection(c, id, nextTask, previousTask);
          ref3 = task.tools;
          for (adx = m = 0, len2 = ref3.length; m < len2; adx = ++m) {
            a = ref3[adx];
            if (a.details[0] != null) {
              c = [id + "_answer_" + adx, a.details[0]];
              this.addConnection(c, id, nextTask, previousTask);
            }
          }
          break;
        default:
          c = [id + "_next", task.next ? task.next : 'end'];
          this.addConnection(c, id, nextTask, previousTask);
      }
      if (nextTask[id] == null) {
        nextTask[id] = {
          'end': 'end'
        };
      }
    }
    return this.setState({
      nextTask: nextTask,
      previousTask: previousTask
    });
  },
  getUuid: function(idx, uuid, uuids) {
    if (uuid == null) {
      uuid = this.state.uuid;
    }
    if (uuids == null) {
      uuids = this.state.uuids;
    }
    if (uuids[idx] != null) {
      return uuids[idx];
    } else {
      return "T" + uuid;
    }
  },
  setUuid: function(id) {
    var current_uuid, current_uuids;
    current_uuids = this.state.uuids.concat([id]);
    current_uuid = this.state.uuid + 1;
    return this.setState({
      uuids: current_uuids,
      uuid: current_uuid
    });
  },
  getWorkflow: function() {
    var L, ct, initialTask, j, k, keys, l, len, len1, ref1, ref2, ref3, sdx, st, subList, taskStateSet, tdx, tmp, tool, v, workflow;
    keys = [];
    taskStateSet = {};
    workflow = {};
    initialTask = this.props.workflow.first_task;
    L = 0;
    ref1 = this.props.workflow.tasks;
    for (k in ref1) {
      v = ref1[k];
      if (k === 'init') {
        ct = 0;
        tmp = 'T' + ct;
        while (tmp in this.props.workflow.tasks) {
          ct += 1;
          tmp = 'T' + ct;
        }
        k = tmp;
        if (initialTask === 'init') {
          initialTask = k;
        }
      }
      keys.push(k);
      taskStateSet[k] = false;
      workflow[k] = clone(v);
      workflow[k].subTask = false;
      if (v.type === 'drawing') {
        ref2 = v.tools;
        for (tdx = j = 0, len = ref2.length; j < len; tdx = ++j) {
          tool = ref2[tdx];
          subList = [];
          ref3 = tool.details;
          for (sdx = l = 0, len1 = ref3.length; l < len1; sdx = ++l) {
            st = ref3[sdx];
            tmp = 'S' + L;
            subList.push(tmp);
            keys.push(tmp);
            workflow[tmp] = clone(st);
            workflow[tmp].subtask = true;
            L += 1;
            if (tool.details[sdx + 1] != null) {
              workflow[tmp].next = 'S' + L;
            }
          }
          workflow[k].tools[tdx].details = subList;
        }
      }
    }
    keys.sort();
    return {
      initialTask: initialTask,
      keys: keys,
      workflow: workflow,
      taskStateSet: taskStateSet
    };
  },
  doSort: function(task_map, t, D) {
    var i, msg, results;
    results = [];
    for (i in task_map[t]) {
      msg = i + ' ' + D[i] + ' ,' + D[t];
      if ((!(i in D)) || (D[i] <= D[t])) {
        D[i] = D[t] + 1;
      }
      results.push(this.doSort(task_map, i, D));
    }
    return results;
  },
  sortTasks: function() {
    var D, DOMNode, N, i, j, k, l, len, levels, max_width, posX, posY, previousY, pt, ref1, ref2, ref3, results, start, t, v, w;
    start = this.state.initialTask;
    D = {};
    D[this.state.initialTask] = 0;
    this.doSort(this.state.nextTask, start, D);
    levels = {};
    for (k in D) {
      v = D[k];
      if (levels[v] != null) {
        levels[v].push(k);
      } else {
        levels[v] = [k];
      }
    }
    posX = 150;
    w = 0;
    results = [];
    for (i = j = 0, ref1 = Object.keys(levels).length; 0 <= ref1 ? j < ref1 : j > ref1; i = 0 <= ref1 ? ++j : --j) {
      max_width = 0;
      posY = 20;
      ref2 = levels[i];
      for (l = 0, len = ref2.length; l < len; l++) {
        t = ref2[l];
        if (this.state.previousTask[t] != null) {
          N = 0;
          if (((ref3 = this.state.workflow[t]) != null ? ref3.subtask : void 0) && !this.state.workflow[Object.keys(this.state.previousTask[t])[0]].subtask) {
            previousY = 65;
          } else {
            previousY = 0;
          }
          for (pt in this.state.previousTask[t]) {
            previousY += parseFloat(ReactDOM.findDOMNode(this.refs[pt]).style.top);
            N += 1;
          }
          previousY /= N;
          if (previousY > posY) {
            posY = previousY;
          }
        }
        this.refs[t].moveMe({
          left: posX,
          top: posY
        });
        DOMNode = ReactDOM.findDOMNode(this.refs[t]);
        posY += DOMNode.offsetHeight + 40;
        w = DOMNode.offsetWidth;
        if (w > max_width) {
          max_width = w;
        }
      }
      results.push(posX += 70 + max_width);
    }
    return results;
  },
  taskMove: function(id) {
    var currentPosition, newPosition, position;
    if (this.state.allSet) {
      position = this.refs[id].state.style;
      currentPosition = this.state.position;
      newPosition = {
        left: position.left,
        top: position.top
      };
      if (position.width) {
        newPosition.width = position.width;
      }
      currentPosition[id] = newPosition;
      return this.setState({
        position: currentPosition
      });
    }
  },
  setTaskState: function(id) {
    var currentTaskState;
    if (!this.state.allSet) {
      currentTaskState = this.state.taskStateSet;
      currentTaskState[id] = true;
      return this.setState({
        taskStateSet: currentTaskState
      }, this.allTasksSet);
    }
  },
  allTasksSet: function() {
    var id, ref1, s, taskSet;
    s = true;
    ref1 = this.state.taskStateSet;
    for (id in ref1) {
      taskSet = ref1[id];
      s &= taskSet;
    }
    if (s && !this.state.allSet) {
      return this.setState({
        allSet: true
      }, this.sortTasks);
    }
  },
  createTask: function(id, idx) {
    var position;
    if (this.state.position[id] != null) {
      position = this.state.position[id];
    } else {
      position = {
        left: 100 + 240 * idx + 'px',
        top: 0 + 'px'
      };
    }
    return React.createElement(Task, React.__spread({}, this.props, {
      "workflow": this.state.workflow,
      "key": id,
      "plumbId": id,
      "taskKey": id,
      "taskNumber": idx,
      "initialPosition": position,
      "ref": id,
      "onMove": this.taskMove,
      "onDone": this.setTaskState.bind(this, id)
    }));
  },
  render: function() {
    var id, idx, tasks;
    tasks = (function() {
      var j, len, ref1, results;
      ref1 = this.state.uuids;
      results = [];
      for (idx = j = 0, len = ref1.length; j < len; idx = ++j) {
        id = ref1[idx];
        results.push(this.createTask(id, idx));
      }
      return results;
    }).call(this);
    return React.createElement("div", {
      "id": 'editor',
      "className": 'editor noselect'
    }, React.createElement(StartEndNode, {
      "jp": this.props.jp,
      "type": 'start',
      "onMove": this.taskMove,
      "ref": 'start',
      "key": 'start'
    }), React.createElement(StartEndNode, {
      "jp": this.props.jp,
      "type": 'end',
      "onMove": this.taskMove,
      "ref": 'end',
      "key": 'end'
    }), tasks);
  }
});

clone = function(obj) {
  return JSON.parse(JSON.stringify(obj));
};


},{"./task.cjsx":173,"react":"react","react-dom":"react-dom"}],175:[function(require,module,exports){
(function (process){
var AutoSave, ChangeListener, DEMO_SUBJECT_SET_ID, EXAMPLE_GOLD_STANDARD_DATA, EditWorkflowPage, FileButton, GoldStandardImporter, History, Link, ModalFormDialog, MultiImageSubjectOptionsEditor, Navigation, PromiseRenderer, React, RetirementRulesEditor, TriggeredModalForm, WorkflowCreateForm, WorkflowTasksEditor, apiClient, handleInputChange, ref, tasks, workflowActions,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

handleInputChange = require('../../lib/handle-input-change');

PromiseRenderer = require('../../components/promise-renderer');

TriggeredModalForm = require('modal-form/triggered');

ModalFormDialog = require('modal-form/dialog');

WorkflowTasksEditor = require('../../components/workflow-tasks-editor');

apiClient = require('panoptes-client/lib/api-client');

ChangeListener = require('../../components/change-listener');

RetirementRulesEditor = require('../../components/retirement-rules-editor');

ref = require('react-router'), History = ref.History, Navigation = ref.Navigation, Link = ref.Link;

MultiImageSubjectOptionsEditor = require('../../components/multi-image-subject-options-editor');

tasks = require('../../classifier/tasks');

AutoSave = require('../../components/auto-save');

FileButton = require('../../components/file-button');

GoldStandardImporter = require('./gold-standard-importer');

WorkflowCreateForm = require('./workflow-create-form');

workflowActions = require('./actions/workflow');

DEMO_SUBJECT_SET_ID = process.env.NODE_ENV === 'production' ? '6' : '1166';

EXAMPLE_GOLD_STANDARD_DATA = '[{\n  "links": {\n    "subjects": ["123"]\n  },\n  "annotations": [{\n    task: "T1",\n    value: 3\n  }, {\n    task: "T2",\n    value: "The value"\n  }, ...]\n}, ...]';

EditWorkflowPage = React.createClass({
  displayName: 'EditWorkflowPage',
  mixins: [History],
  getDefaultProps: function() {
    return {
      workflow: null,
      workflowActions: workflowActions
    };
  },
  getInitialState: function() {
    return {
      selectedTaskKey: this.props.workflow.first_task,
      goldStandardFilesToImport: null,
      forceReloader: 0,
      deletionInProgress: false,
      deletionError: null,
      workflowCreationInProgress: false
    };
  },
  workflowLink: function() {
    var name, owner, ref1, viewQuery;
    ref1 = this.props.project.slug.split('/'), owner = ref1[0], name = ref1[1];
    viewQuery = {
      workflow: this.props.workflow.id,
      reload: this.state.forceReloader
    };
    return this.history.createHref("/projects/" + owner + "/" + name + "/classify", viewQuery);
  },
  showCreateWorkflow: function() {
    return this.setState({
      workflowCreationInProgress: true
    });
  },
  hideCreateWorkflow: function() {
    return this.setState({
      workflowCreationInProgress: false
    });
  },
  handleWorkflowCreation: function(workflow) {
    var newLocation;
    this.hideCreateWorkflow();
    newLocation = Object.assign({}, this.props.location, {
      pathname: "/lab/" + this.props.project.id + "/workflow/" + workflow.id
    });
    this.props.history.push(newLocation);
    this.props.project.uncacheLink('workflows');
    return this.props.project.uncacheLink('subject_sets');
  },
  canUseTask: function(project, task) {
    return indexOf.call(project.experimental_tools, task) >= 0;
  },
  handleTaskChange: function(taskKey, taskDescription) {
    var changes;
    changes = {};
    changes["tasks." + taskKey] = taskDescription;
    return this.props.workflow.update(changes).save();
  },
  render: function() {
    var TaskEditorComponent, classNames, definition, disabledStyle, key, ref1, taskKey;
    window.editingWorkflow = this.props.workflow;
    disabledStyle = {
      opacity: 0.4,
      pointerEvents: 'none'
    };
    return React.createElement("div", {
      "className": "edit-workflow-page"
    }, React.createElement("h3", null, this.props.workflow.display_name, " #", this.props.workflow.id, ' ', React.createElement("button", {
      "onClick": this.showCreateWorkflow,
      "disabled": this.props.project.live || this.state.workflowCreationInProgress,
      "title": "Copy workflow"
    }, React.createElement("i", {
      "className": "fa fa-copy"
    }))), (this.state.workflowCreationInProgress ? React.createElement(ModalFormDialog, {
      "tag": "div"
    }, React.createElement(WorkflowCreateForm, {
      "onSubmit": this.props.workflowActions.createWorkflowForProject,
      "onCancel": this.hideCreateWorkflow,
      "onSuccess": this.handleWorkflowCreation,
      "projectID": this.props.project.id,
      "workflowToClone": this.props.workflow
    })) : void 0), React.createElement("p", {
      "className": "form-help"
    }, "A workflow is the sequence of tasks that youre asking volunteers to perform. For example, you might want to ask volunteers to answer questions about your images, or to mark features in your images, or both."), (this.props.project.live ? React.createElement("p", {
      "className": "form-help warning"
    }, React.createElement("strong", null, "You cannot edit a projects workflows once its gone live.")) : void 0), React.createElement("div", {
      "className": "columns-container",
      "style": (this.props.project.live ? disabledStyle : void 0)
    }, React.createElement("div", {
      "className": "column"
    }, React.createElement("div", null, React.createElement(AutoSave, {
      "tag": "label",
      "resource": this.props.workflow
    }, React.createElement("span", {
      "className": "form-label"
    }, "Workflow title"), React.createElement("br", null), React.createElement("input", {
      "type": "text",
      "name": "display_name",
      "value": this.props.workflow.display_name,
      "className": "standard-input full",
      "onChange": handleInputChange.bind(this.props.workflow)
    })), React.createElement("small", {
      "className": "form-help"
    }, "If you let your volunteers choose which workflow to attempt, this text will appear as an option on the project front page."), React.createElement("br", null), React.createElement("div", null, React.createElement("div", {
      "className": "nav-list standalone"
    }, React.createElement("span", {
      "className": "nav-list-header"
    }, "Tasks"), React.createElement("br", null), (function() {
      var ref1, results;
      ref1 = this.props.workflow.tasks;
      results = [];
      for (key in ref1) {
        definition = ref1[key];
        classNames = ['secret-button', 'nav-list-item'];
        if (key === this.state.selectedTaskKey) {
          classNames.push('active');
        }
        results.push(React.createElement("div", {
          "key": key
        }, React.createElement("button", {
          "type": "button",
          "className": classNames.join(' '),
          "onClick": this.setState.bind(this, {
            selectedTaskKey: key
          }, null)
        }, ((function() {
          switch (definition.type) {
            case 'single':
              return React.createElement("i", {
                "className": "fa fa-dot-circle-o fa-fw"
              });
            case 'multiple':
              return React.createElement("i", {
                "className": "fa fa-check-square-o fa-fw"
              });
            case 'drawing':
              return React.createElement("i", {
                "className": "fa fa-pencil fa-fw"
              });
            case 'survey':
              return React.createElement("i", {
                "className": "fa fa-binoculars fa-fw"
              });
            case 'flexibleSurvey':
              return React.createElement("i", {
                "className": "fa fa-binoculars fa-fw"
              });
            case 'crop':
              return React.createElement("i", {
                "className": "fa fa-crop fa-fw"
              });
            case 'text':
              return React.createElement("i", {
                "className": "fa fa-file-text-o fa-fw"
              });
            case 'dropdown':
              return React.createElement("i", {
                "className": "fa fa-list fa-fw"
              });
            case 'combo':
              return React.createElement("i", {
                "className": "fa fa-cubes fa-fw"
              });
          }
        })()), ' ', tasks[definition.type].getTaskText(definition), (key === this.props.workflow.first_task ? React.createElement("small", null, " ", React.createElement("em", null, "(first)")) : void 0))));
      }
      return results;
    }).call(this)), React.createElement("p", null, React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("span", {
        "className": "standard-button"
      }, React.createElement("i", {
        "className": "fa fa-plus-circle"
      }), ' ', "Add a task")
    }, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "submit",
      "className": "minor-button",
      "onClick": this.addNewTask.bind(this, 'single'),
      "title": "Question tasks: the volunteer chooses from among a list of answers but does not mark or draw on the image(s)."
    }, React.createElement("i", {
      "className": "fa fa-question-circle fa-2x"
    }), React.createElement("br", null), React.createElement("small", null, React.createElement("strong", null, "Question")))), ' ', React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "submit",
      "className": "minor-button",
      "onClick": this.addNewTask.bind(this, 'drawing'),
      "title": "Marking tasks: the volunteer marks or draws directly on the image(s) using tools that you specify. They can also give sub-classifications for each mark."
    }, React.createElement("i", {
      "className": "fa fa-pencil fa-2x"
    }), React.createElement("br", null), React.createElement("small", null, React.createElement("strong", null, "Drawing")))), ' ', (this.canUseTask(this.props.project, "text") ? React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "submit",
      "className": "minor-button",
      "onClick": this.addNewTask.bind(this, 'text'),
      "title": "Text tasks: the volunteer writes free-form text into a dialog box."
    }, React.createElement("i", {
      "className": "fa fa-file-text-o fa-2x"
    }), React.createElement("br", null), React.createElement("small", null, React.createElement("strong", null, "Text")))) : void 0), ' ', (this.canUseTask(this.props.project, "survey") ? React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "submit",
      "className": "minor-button",
      "onClick": this.addNewTask.bind(this, 'survey'),
      "title": "Survey tasks: the volunteer identifies objects (usually animals) in the image(s) by filtering by their visible charactaristics, then answers questions about them."
    }, React.createElement("i", {
      "className": "fa fa-binoculars fa-2x"
    }), React.createElement("br", null), React.createElement("small", null, React.createElement("strong", null, "Survey")))) : void 0), ' ', (this.canUseTask(this.props.project, "crop") ? React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "submit",
      "className": "minor-button",
      "onClick": this.addNewTask.bind(this, 'crop'),
      "title": "Crop tasks: the volunteer draws a rectangle around an area of interest, and the view of the subject is approximately cropped to that area."
    }, React.createElement("i", {
      "className": "fa fa-crop fa-2x"
    }), React.createElement("br", null), React.createElement("small", null, React.createElement("strong", null, "Crop")))) : void 0), ' ', (this.canUseTask(this.props.project, "dropdown") ? React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "submit",
      "className": "minor-button",
      "onClick": this.addNewTask.bind(this, 'dropdown'),
      "title": "Dropdown tasks: the volunteer selects an option from a list. Conditional dropdowns can be created, and if a research team enables the feature, a volunteer can enter text if the answer they'd like to provide is not an option available."
    }, React.createElement("i", {
      "className": "fa fa-list fa-2x"
    }), React.createElement("br", null), React.createElement("small", null, React.createElement("strong", null, "Dropdown")))) : void 0), ' ', (this.canUseTask(this.props.project, "combo") ? React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("button", {
      "type": "submit",
      "className": "minor-button",
      "onClick": this.addNewTask.bind(this, 'combo'),
      "title": "Combo tasks: show a bunch of tasks at the same time."
    }, React.createElement("i", {
      "className": "fa fa-cubes fa-2x"
    }), React.createElement("br", null), React.createElement("small", null, React.createElement("strong", null, "Combo")))) : void 0))), React.createElement(AutoSave, {
      "tag": "div",
      "resource": this.props.workflow
    }, React.createElement("small", null, "First task"), ' ', React.createElement("select", {
      "name": "first_task",
      "value": this.props.workflow.first_task,
      "onChange": handleInputChange.bind(this.props.workflow)
    }, (function() {
      var ref1, results;
      ref1 = this.props.workflow.tasks;
      results = [];
      for (taskKey in ref1) {
        definition = ref1[taskKey];
        results.push(React.createElement("option", {
          "key": taskKey,
          "value": taskKey
        }, tasks[definition.type].getTaskText(definition)));
      }
      return results;
    }).call(this)))), React.createElement("p", {
      "className": "form-help"
    }, React.createElement("small", null, "A task is a unit of work you are asking volunteers to do. You can ask them to answer a question or mark an image. Add a task by clicking the question or marking buttons below.")), React.createElement("hr", null), React.createElement("p", null, React.createElement("small", {
      "className": "form-help"
    }, "Version ", this.props.workflow.version)), React.createElement("p", {
      "className": "form-help"
    }, React.createElement("small", null, "Version indicates which version of the workflow you are on. Every time you save changes to a workflow, you create a new version. Big changes, like adding or deleting questions, will change the version by a whole number: 1.0 to 2.0, etc. Smaller changes, like modifying the help text, will change the version by a decimal, e.g. 2.0 to 2.1. The version is tracked with each classification in case you need it when analyzing your data."))), React.createElement("hr", null), React.createElement("div", null, React.createElement("span", {
      "className": "form-label"
    }, "Associated subject sets"), React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "Choose the set of subjects you want to use for this workflow."), this.renderSubjectSets()), React.createElement("hr", null), (indexOf.call(this.props.project.experimental_tools, 'hide classification summaries') >= 0 ? React.createElement("div", null, React.createElement("div", null, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("span", {
      "className": "form-label"
    }, "Classification summaries"), React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "Classification summaries show the user how they have answered\x2Fmarked for each task once the classification is complete"), React.createElement("br", null), React.createElement("input", {
      "type": "checkbox",
      "id": "hide_classification_summaries",
      "onChange": this.handleSetHideClassificationSummaries,
      "defaultChecked": ((ref1 = this.props.workflow.configuration) != null ? ref1.hide_classification_summaries : void 0)
    }), React.createElement("label", {
      "htmlFor": "hide_classification_summaries"
    }, "Hide classification summaries"))), React.createElement("hr", null)) : void 0), React.createElement(AutoSave, {
      "tag": "div",
      "resource": this.props.workflow
    }, React.createElement("span", {
      "className": "form-label"
    }, "Multi-image options"), React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "Choose how to display multiple images"), React.createElement(MultiImageSubjectOptionsEditor, {
      "workflow": this.props.workflow
    })), React.createElement("hr", null), React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, "Subject retirement ", React.createElement(RetirementRulesEditor, {
      "workflow": this.props.workflow
    })), React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "How many people should classify each subject before it is done? Once a subject has reached the retirement limit it will no longer be shown to any volunteers.")), React.createElement("hr", null), React.createElement("p", null, React.createElement(FileButton, {
      "className": "standard-button",
      "accept": "application/json",
      "multiple": true,
      "onSelect": this.handleGoldStandardDataImport
    }, "Import gold standard classifications"), React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "Import gold standard classifications to improve the quality of automatic aggregations and optionally provide classification feedback for volunteers."), ' ', React.createElement(TriggeredModalForm, {
      "trigger": React.createElement("i", {
        "className": "fa fa-question-circle"
      })
    }, React.createElement("p", null, "Gold standard classificaitons should be in the form:"), React.createElement("pre", null, EXAMPLE_GOLD_STANDARD_DATA))), React.createElement("p", null, React.createElement(AutoSave, {
      "tag": "label",
      "resource": this.props.workflow
    }, React.createElement("input", {
      "type": "checkbox",
      "name": "public_gold_standard",
      "checked": this.props.workflow.public_gold_standard,
      "onChange": handleInputChange.bind(this.props.workflow)
    }), ' ', "Use gold standard data to provide classification feedback to volunteers."), React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "After they classify, theyll be able to compare their own classification to the gold standard data to make sure theyre on the right track.")), React.createElement("hr", null), (indexOf.call(this.props.project.experimental_tools, 'worldwide telescope') >= 0 ? React.createElement("div", null, React.createElement("div", null, React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("span", {
      "className": "form-label"
    }, "Use World Wide Telescope API"), React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "Allow user to view subject in the WWT after classifying."), React.createElement("br", null), React.createElement("label", {
      "htmlFor": "world_wide_telescope_summary"
    }, React.createElement("input", {
      "type": "checkbox",
      "onChange": this.handleSetWorldWideTelescope,
      "checked": this.telescopeValue()
    }), "WorldWide Telescope"))), React.createElement("hr", null)) : void 0), React.createElement("div", {
      "style": {
        pointerEvents: 'all'
      }
    }, React.createElement("a", {
      "href": this.workflowLink(),
      "className": "standard-button",
      "target": "from-lab",
      "onClick": this.handleViewClick
    }, "Test this workflow")), React.createElement("hr", null), React.createElement("div", {
      "style": {
        pointerEvents: 'all'
      }
    }, React.createElement(Link, {
      "to": "/lab/" + this.props.project.id + "/workflow/" + this.props.workflow.id + "/visualize",
      "className": "standard-button",
      "params": {
        workflowID: this.props.workflow.id,
        projectID: this.props.project.id
      },
      "title": "A workflow is the sequence of tasks that youre asking volunteers to perform."
    }, "Visualize this workflow")), React.createElement("hr", null), React.createElement("div", null, React.createElement("small", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "disabled": this.state.deletionInProgress,
      "data-busy": this.state.deletionInProgress || null,
      "onClick": this.handleDelete
    }, "Delete this workflow")), ' ', (this.state.deletionError != null ? React.createElement("span", {
      "className": "form-help error"
    }, this.state.deletionError.message) : void 0))), React.createElement("div", {
      "className": "column"
    }, ((this.state.selectedTaskKey != null) && (this.props.workflow.tasks[this.state.selectedTaskKey] != null) ? (TaskEditorComponent = tasks[this.props.workflow.tasks[this.state.selectedTaskKey].type].Editor, React.createElement("div", null, React.createElement(TaskEditorComponent, {
      "workflow": this.props.workflow,
      "task": this.props.workflow.tasks[this.state.selectedTaskKey],
      "taskPrefix": "tasks." + this.state.selectedTaskKey,
      "project": this.props.project,
      "onChange": this.handleTaskChange.bind(this, this.state.selectedTaskKey)
    }), React.createElement("hr", null), React.createElement("br", null), React.createElement(AutoSave, {
      "resource": this.props.workflow
    }, React.createElement("small", null, React.createElement("button", {
      "type": "button",
      "onClick": this.handleTaskDelete.bind(this, this.state.selectedTaskKey)
    }, "Delete this task"))))) : React.createElement("p", null, "Choose a task to edit")))), (this.state.goldStandardFilesToImport != null ? React.createElement(ModalFormDialog, {
      "required": true
    }, React.createElement(GoldStandardImporter, {
      "project": this.props.project,
      "workflow": this.props.workflow,
      "files": this.state.goldStandardFilesToImport,
      "onClose": this.handleGoldStandardImportClose
    })) : void 0));
  },
  renderSubjectSets: function() {
    var projectAndWorkflowSubjectSets;
    projectAndWorkflowSubjectSets = Promise.all([
      this.props.project.get('subject_sets', {
        sort: 'display_name',
        page_size: 100
      }), this.props.workflow.get('subject_sets', {
        sort: 'display_name',
        page_size: 100
      })
    ]);
    return React.createElement(PromiseRenderer, {
      "promise": projectAndWorkflowSubjectSets
    }, ((function(_this) {
      return function(arg) {
        var assigned, projectSubjectSets, subjectSet, toggle, workflowSubjectSets;
        projectSubjectSets = arg[0], workflowSubjectSets = arg[1];
        return React.createElement("div", null, React.createElement("table", null, React.createElement("tbody", null, (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = projectSubjectSets.length; i < len; i++) {
            subjectSet = projectSubjectSets[i];
            assigned = indexOf.call(workflowSubjectSets, subjectSet) >= 0;
            toggle = this.handleSubjectSetToggle.bind(this, subjectSet);
            results.push(React.createElement("tr", {
              "key": subjectSet.id
            }, React.createElement("td", null, React.createElement("input", {
              "type": "checkbox",
              "checked": assigned,
              "onChange": toggle
            })), React.createElement("td", null, subjectSet.display_name, " (#", subjectSet.id, ")")));
          }
          return results;
        }).call(_this))), (projectSubjectSets.length === 0 ? React.createElement("p", null, "This project has no subject sets.", ' ', React.createElement("button", {
          "type": "button",
          "onClick": _this.addDemoSubjectSet
        }, "Add an example subject set")) : void 0));
      };
    })(this)));
  },
  addNewTask: function(type) {
    var changes, nextTaskID, taskCount, taskIDNumber;
    taskCount = Object.keys(this.props.workflow.tasks).length;
    taskIDNumber = -1;
    while (!((nextTaskID != null) && !(nextTaskID in this.props.workflow.tasks))) {
      taskIDNumber += 1;
      nextTaskID = "T" + (taskCount + taskIDNumber);
    }
    changes = {};
    changes["tasks." + nextTaskID] = tasks[type].getDefaultTask();
    if (!this.props.workflow.first_task) {
      changes.first_task = nextTaskID;
    }
    this.props.workflow.update(changes);
    return this.setState({
      selectedTaskKey: nextTaskID
    });
  },
  handleSetHideClassificationSummaries: function(e) {
    return this.props.workflow.update({
      'configuration.hide_classification_summaries': e.target.checked
    });
  },
  handleSetWorldWideTelescope: function(e) {
    var index, summary_path;
    if (!this.props.workflow.configuration.custom_summary) {
      this.props.workflow.update({
        'configuration.custom_summary': []
      });
    }
    summary_path = this.props.workflow.configuration.custom_summary;
    if (e.target.checked) {
      summary_path.push('world_wide_telescope');
    } else {
      index = summary_path.indexOf('world_wide_telescope');
      summary_path.splice(index, 1);
    }
    return this.props.workflow.update({
      'configuration.custom_summary': summary_path
    });
  },
  telescopeValue: function() {
    if (this.props.workflow.configuration.custom_summary) {
      return indexOf.call(this.props.workflow.configuration.custom_summary, 'world_wide_telescope') >= 0;
    }
  },
  handleSubjectSetToggle: function(subjectSet, e) {
    var ensureSaved, shouldAdd;
    shouldAdd = e.target.checked;
    ensureSaved = this.props.workflow.hasUnsavedChanges() ? this.props.workflow.save() : Promise.resolve();
    return ensureSaved.then((function(_this) {
      return function() {
        if (shouldAdd) {
          return _this.props.workflow.addLink('subject_sets', [subjectSet.id]);
        } else {
          return _this.props.workflow.removeLink('subject_sets', subjectSet.id);
        }
      };
    })(this));
  },
  addDemoSubjectSet: function() {
    this.props.project.uncacheLink('subject_sets');
    return this.props.workflow.addLink('subject_sets', [DEMO_SUBJECT_SET_ID]);
  },
  handleDelete: function() {
    var confirmed;
    this.setState({
      deletionError: null
    });
    confirmed = confirm('Really delete this workflow and all its tasks?');
    if (confirmed) {
      this.setState({
        deletionInProgress: true
      });
      return this.props.workflow["delete"]().then((function(_this) {
        return function() {
          _this.props.project.uncacheLink('workflows');
          return _this.history.pushState(null, "/lab/" + _this.props.project.id);
        };
      })(this))["catch"]((function(_this) {
        return function(error) {
          return _this.setState({
            deletionError: error
          });
        };
      })(this)).then((function(_this) {
        return function() {
          if (_this.isMounted()) {
            return _this.setState({
              deletionInProgress: false
            });
          }
        };
      })(this));
    }
  },
  handleGoldStandardDataImport: function(e) {
    return this.setState({
      goldStandardFilesToImport: e.target.files
    });
  },
  handleGoldStandardImportClose: function() {
    return this.setState({
      goldStandardFilesToImport: null
    });
  },
  handleViewClick: function() {
    return setTimeout((function(_this) {
      return function() {
        return _this.setState({
          forceReloader: _this.state.forceReloader + 1
        });
      };
    })(this));
  },
  handleTaskDelete: function(taskKey, e) {
    var changes, ref1;
    if (e.shiftKey || confirm('Really delete this task?')) {
      changes = {};
      changes["tasks." + taskKey] = void 0;
      this.props.workflow.update(changes);
      if (!(this.props.workflow.first_task in this.props.workflow.tasks)) {
        return this.props.workflow.update({
          first_task: (ref1 = Object.keys(this.props.workflow.tasks)[0]) != null ? ref1 : ''
        });
      }
    }
  }
});

module.exports = React.createClass({
  displayName: 'EditWorkflowPageWrapper',
  getDefaultProps: function() {
    return {
      params: {
        workflowID: ''
      }
    };
  },
  render: function() {
    return React.createElement(PromiseRenderer, {
      "promise": apiClient.type('workflows').get(this.props.params.workflowID)
    }, ((function(_this) {
      return function(workflow) {
        return React.createElement(ChangeListener, {
          "target": workflow
        }, (function() {
          return React.createElement(EditWorkflowPage, React.__spread({}, _this.props, {
            "workflow": workflow
          }));
        }));
      };
    })(this)));
  }
});


}).call(this,require('_process'))
},{"../../classifier/tasks":36,"../../components/auto-save":62,"../../components/change-listener":63,"../../components/file-button":72,"../../components/multi-image-subject-options-editor":81,"../../components/promise-renderer":86,"../../components/retirement-rules-editor":87,"../../components/workflow-tasks-editor":97,"../../lib/handle-input-change":103,"./actions/workflow":137,"./gold-standard-importer":153,"./workflow-create-form":168,"_process":503,"modal-form/dialog":546,"modal-form/triggered":548,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],176:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'NotFoundPage',
  componentDidMount: function() {
    if ((typeof location !== "undefined" && location !== null ? location.hash.charAt(location.hash.length - 1) : void 0) === '/') {
      return location.hash = location.hash.slice(0, -1);
    }
  },
  render: function() {
    return React.createElement("div", {
      "className": "content-container"
    }, React.createElement("i", {
      "className": "fa fa-frown-o"
    }), " Not found");
  }
});


},{"react":"react"}],177:[function(require,module,exports){
var ChangeListener, Loading, Notification, Paginator, React, talkClient,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

Loading = require('../components/loading-indicator');

Paginator = require('../talk/lib/paginator');

ChangeListener = require('../components/change-listener');

talkClient = require('panoptes-client/lib/talk-client');

Notification = require('./notifications/notification');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'NotificationsPage',
    propTypes: {
      project: React.PropTypes.object,
      user: React.PropTypes.object
    },
    getDefaultProps: function() {
      return {
        location: {
          query: {
            page: 1
          }
        }
      };
    },
    getInitialState: function() {
      return {
        firstMeta: {},
        lastMeta: {},
        notificationsMap: {}
      };
    },
    componentWillMount: function() {
      if (this.props.user) {
        return this.getNotifications();
      }
    },
    componentWillUnmount: function() {
      if (this.props.user) {
        this.markAsRead('first')();
        return this.markAsRead('last')();
      }
    },
    componentWillReceiveProps: function(nextProps) {
      var pageChanged, userChanged;
      pageChanged = nextProps.location.query.page !== this.props.location.query.page;
      userChanged = nextProps.user && nextProps.user !== this.props.user;
      if (pageChanged || userChanged) {
        return this.getNotifications(nextProps.location.query.page);
      }
    },
    getNotifications: function(page) {
      this.getUnreadCount();
      return talkClient.type('notifications').get(this.notificationsQuery(page)).then((function(_this) {
        return function(newNotifications) {
          var firstMeta, i, lastMeta, len, meta, n, notification, notifications, notificationsMap, ref, ref1;
          meta = ((ref = newNotifications[0]) != null ? ref.getMeta() : void 0) || {};
          notifications = _this.state.notifications || newNotifications;
          meta.notificationIds = (function() {
            var i, len, results;
            results = [];
            for (i = 0, len = newNotifications.length; i < len; i++) {
              n = newNotifications[i];
              results.push(n.id);
            }
            return results;
          })();
          notificationsMap = _this.state.notificationsMap;
          for (i = 0, len = newNotifications.length; i < len; i++) {
            notification = newNotifications[i];
            notificationsMap[notification.id] = notification;
          }
          ref1 = _this.state, firstMeta = ref1.firstMeta, lastMeta = ref1.lastMeta;
          if (meta.page > _this.state.lastMeta.page) {
            lastMeta = meta;
            notifications.push.apply(notifications, newNotifications);
          } else if (meta.page < _this.state.firstMeta.page) {
            firstMeta = meta;
            notifications.unshift.apply(notifications, newNotifications);
          } else {
            firstMeta = lastMeta = meta;
          }
          return _this.setState({
            notifications: notifications,
            notificationsMap: notificationsMap,
            firstMeta: firstMeta,
            lastMeta: lastMeta
          });
        };
      })(this));
    },
    notificationsQuery: function(page, options) {
      var query;
      if (page == null) {
        page = this.props.location.query.page;
      }
      if (options == null) {
        options = {};
      }
      page || (page = 1);
      query = Object.assign({}, options, {
        page: page
      });
      if (this.props.project) {
        query.section = "project-" + this.props.project.id;
      }
      if (this.props.params.section) {
        query.section = this.props.params.section;
      }
      return query;
    },
    getUnreadCount: function() {
      return talkClient.type('notifications').get(this.notificationsQuery(1, {
        page_size: 1,
        delivered: false
      })).then((function(_this) {
        return function(notifications) {
          var ref, ref1, unreadCount;
          unreadCount = ((ref = notifications[0]) != null ? (ref1 = ref.getMeta()) != null ? ref1.count : void 0 : void 0) || 0;
          return _this.setState({
            unreadCount: unreadCount
          });
        };
      })(this));
    },
    markAsRead: function(meta) {
      return (function(_this) {
        return function() {
          var i, id, ids, len, notification, ref, ref1, results;
          ids = _this.state[meta + "Meta"].notificationIds;
          ids = (function() {
            var i, len, results;
            results = [];
            for (i = 0, len = ids.length; i < len; i++) {
              id = ids[i];
              if (!this.state.notificationsMap[id].delivered) {
                results.push(id);
              }
            }
            return results;
          }).call(_this);
          if (ids.length === 0) {
            return;
          }
          talkClient.put('/notifications/read', {
            id: ids.join(',')
          });
          ref = _this.state.notifications;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            notification = ref[i];
            if (ref1 = notification.id, indexOf.call(ids, ref1) >= 0) {
              results.push(notification.update({
                delivered: true
              }));
            }
          }
          return results;
        };
      })(this);
    },
    markAllAsRead: function() {
      var i, len, notification, ref;
      talkClient.put('/notifications/read');
      ref = this.state.notifications;
      for (i = 0, len = ref.length; i < len; i++) {
        notification = ref[i];
        notification.update({
          delivered: true
        });
      }
      return this.setState({
        unreadCount: 0
      });
    },
    title: function() {
      if (this.props.project) {
        return this.props.project.display_name + " Notifications";
      } else if (this.props.params.section) {
        return this.props.params.section + " Notifications";
      } else {
        return 'Notifications';
      }
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk notifications"
      }, React.createElement("div", {
        "className": "content-container"
      }, React.createElement("h1", {
        "className": "title " + (this.props.project ? 'talk-module' : '')
      }, this.title()), (this.props.user != null ? React.createElement(ChangeListener, {
        "target": this.props.user
      }, ((function(_this) {
        return function() {
          var notification, ref, ref1;
          if (((ref = _this.state.notifications) != null ? ref.length : void 0) > 0) {
            return React.createElement("div", null, React.createElement("p", null, "You have", ' ', (_this.state.unreadCount === 0 ? 'no' : _this.state.unreadCount), ' ', "unread notifications"), (_this.state.firstMeta.page > 1 || _this.state.unreadCount > 0 ? React.createElement("div", {
              "className": "centering"
            }, React.createElement("div", {
              "className": "talk-module inline-block"
            }, (_this.state.firstMeta.page > 1 ? React.createElement(Paginator, {
              "className": "newer inline-block",
              "page": +_this.state.firstMeta.page,
              "pageCount": _this.state.firstMeta.page_count,
              "scrollOnChange": false,
              "firstAndLast": false,
              "pageSelector": false,
              "previousLabel": React.createElement("span", null, "Load newer ", React.createElement("i", {
                "className": "fa fa-long-arrow-up"
              })),
              "onClickPrev": _this.markAsRead('first')
            }) : void 0), (_this.state.unreadCount > 0 ? React.createElement("button", {
              "onClick": _this.markAllAsRead
            }, "Mark all as read") : void 0))) : void 0), React.createElement("div", {
              "className": "list"
            }, (function() {
              var i, len, ref1, results;
              ref1 = this.state.notifications;
              results = [];
              for (i = 0, len = ref1.length; i < len; i++) {
                notification = ref1[i];
                results.push(React.createElement(Notification, {
                  "notification": notification,
                  "key": notification.id,
                  "user": this.props.user
                }));
              }
              return results;
            }).call(_this)), React.createElement("div", {
              "className": "centering"
            }, React.createElement(Paginator, {
              "className": "older",
              "page": +_this.state.lastMeta.page,
              "pageCount": _this.state.lastMeta.page_count,
              "scrollOnChange": false,
              "firstAndLast": false,
              "pageSelector": false,
              "nextLabel": React.createElement("span", null, "Load more ", React.createElement("i", {
                "className": "fa fa-long-arrow-down"
              })),
              "onClickNext": _this.markAsRead('last')
            })));
          } else if (((ref1 = _this.state.notifications) != null ? ref1.length : void 0) === 0) {
            return React.createElement("div", {
              "className": "centering talk-module"
            }, React.createElement("p", null, "You have no notifications"));
          } else {
            return React.createElement(Loading, null);
          }
        };
      })(this))) : React.createElement("div", {
        "className": "centering talk-module"
      }, React.createElement("p", null, "You\'re not signed in.")))));
    }
  });
}


},{"../components/change-listener":63,"../components/loading-indicator":77,"../talk/lib/paginator":273,"./notifications/notification":182,"panoptes-client/lib/talk-client":553,"react":"react"}],178:[function(require,module,exports){
var Comment, Loading, React, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

Loading = require('../../components/loading-indicator');

Comment = require('../../talk/search-result');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CommentNotification',
    propTypes: {
      project: React.PropTypes.object,
      user: React.PropTypes.object.isRequired,
      notification: React.PropTypes.object.isRequired
    },
    getInitialState: function() {
      return {
        comment: null
      };
    },
    componentWillMount: function() {
      return talkClient.type('comments').get(this.props.notification.source_id).then((function(_this) {
        return function(comment) {
          return _this.setState({
            comment: comment
          });
        };
      })(this));
    },
    render: function() {
      if (this.state.comment) {
        return React.createElement("div", {
          "className": "talk-comment"
        }, React.createElement(Comment, {
          "data": this.state.comment,
          "user": this.props.user,
          "project": this.props.project
        }));
      } else {
        return React.createElement("div", {
          "className": "talk-module"
        }, React.createElement(Loading, null));
      }
    }
  });
}


},{"../../components/loading-indicator":77,"../../talk/search-result":298,"panoptes-client/lib/talk-client":553,"react":"react"}],179:[function(require,module,exports){
var React, apiClient, moment;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

moment = require('moment');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'DataRequestNotification',
    propTypes: {
      project: React.PropTypes.object,
      user: React.PropTypes.object.isRequired,
      notification: React.PropTypes.object.isRequired
    },
    getInitialState: function() {
      return {
        projectName: null
      };
    },
    componentWillMount: function() {
      return apiClient.type('projects').get(this.props.notification.project_id).then((function(_this) {
        return function(project) {
          return _this.setState({
            projectName: project.display_name
          });
        };
      })(this));
    },
    stopPropagation: function(e) {
      return e.stopPropagation();
    },
    render: function() {
      var notification;
      notification = this.props.notification;
      return React.createElement("div", {
        "className": "data-request-notification talk-module"
      }, React.createElement("p", {
        "className": "title"
      }, "Data export from ", this.state.projectName), React.createElement("div", {
        "className": "bottom"
      }, React.createElement("a", {
        "href": notification.url,
        "target": "_blank",
        "onClick": this.stopPropagation
      }, notification.message), ' ', React.createElement("a", {
        "className": "time-ago",
        "href": notification.url,
        "target": "_blank",
        "onClick": this.stopPropagation
      }, moment(this.props.notification.created_at).fromNow())));
    }
  });
}


},{"moment":"moment","panoptes-client/lib/api-client":549,"react":"react"}],180:[function(require,module,exports){
var Avatar, Link, Loading, Markdown, React, moment, talkClient;

React = require('react');

Link = require('react-router').Link;

Markdown = require('markdownz').Markdown;

moment = require('moment');

talkClient = require('panoptes-client/lib/talk-client');

Loading = require('../../components/loading-indicator');

Avatar = require('../../partials/avatar');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'MessageNotification',
    propTypes: {
      project: React.PropTypes.object,
      user: React.PropTypes.object.isRequired,
      notification: React.PropTypes.object.isRequired
    },
    getInitialState: function() {
      return {
        message: null,
        messageUser: null,
        conversation: null
      };
    },
    componentWillMount: function() {
      return talkClient.type('messages').get(this.props.notification.source_id, {
        include: 'conversation,user'
      }).then((function(_this) {
        return function(message) {
          return message.get('user').then(function(messageUser) {
            return message.get('conversation').then(function(conversation) {
              return _this.setState({
                message: message,
                conversation: conversation,
                messageUser: messageUser
              });
            });
          });
        };
      })(this));
    },
    render: function() {
      var notification;
      notification = this.props.notification;
      if (this.state.message) {
        return React.createElement("div", {
          "className": "conversation-message talk-module"
        }, React.createElement(Link, React.__spread({
          "to": "/inbox/" + notification.source.conversation_id
        }, this.props, {
          "className": "message-link"
        }), notification.message, ' ', "in ", this.state.conversation.title), React.createElement(Markdown, null, this.state.message.body), React.createElement("div", {
          "className": "bottom"
        }, React.createElement(Link, {
          "className": "user-profile-link",
          "to": "/users/" + this.state.messageUser.login
        }, React.createElement(Avatar, {
          "user": this.state.messageUser
        }), ' ', this.state.messageUser.display_name), ' ', React.createElement(Link, React.__spread({
          "to": "/inbox/" + notification.source.conversation_id
        }, this.props, {
          "className": "time-ago"
        }), moment(this.state.message.created_at).fromNow())));
      } else {
        return React.createElement("div", {
          "className": "talk-module"
        }, React.createElement(Loading, null));
      }
    }
  });
}


},{"../../components/loading-indicator":77,"../../partials/avatar":212,"markdownz":"markdownz","moment":"moment","panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],181:[function(require,module,exports){
var Avatar, Link, Loading, Markdown, React, apiClient, moment, talkClient;

React = require('react');

Link = require('react-router').Link;

Markdown = require('markdownz').Markdown;

moment = require('moment');

talkClient = require('panoptes-client/lib/talk-client');

apiClient = require('panoptes-client/lib/api-client');

Loading = require('../../components/loading-indicator');

Avatar = require('../../partials/avatar');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'ModerationNotification',
    propTypes: {
      project: React.PropTypes.object,
      user: React.PropTypes.object.isRequired,
      notification: React.PropTypes.object.isRequired
    },
    getInitialState: function() {
      return {
        moderation: null,
        comment: null,
        commentUser: null,
        reports: []
      };
    },
    componentWillMount: function() {
      return talkClient.type('moderations').get(this.props.notification.source_id).then((function(_this) {
        return function(moderation) {
          var comment, fn, j, len, promises, ref, report;
          comment = moderation.target || moderation.destroyed_target;
          _this.setState({
            moderation: moderation,
            comment: comment
          });
          promises = [];
          ref = moderation.reports;
          fn = function(report) {
            return promises.push(apiClient.type('users').get(report.user_id.toString(), {}).then(function(user) {
              report.user = user;
              return report;
            }));
          };
          for (j = 0, len = ref.length; j < len; j++) {
            report = ref[j];
            fn(report);
          }
          apiClient.type('users').get(comment.user_id.toString()).then(function(commentUser) {
            return _this.setState({
              moderation: moderation,
              comment: comment,
              commentUser: commentUser
            });
          });
          return Promise.all(promises).then(function(reports) {
            return _this.setState({
              reports: reports
            });
          });
        };
      })(this));
    },
    render: function() {
      var i, name, notification, owner, path, ref, report;
      notification = this.props.notification;
      if (notification.project_slug) {
        ref = notification.project_slug.split('/'), owner = ref[0], name = ref[1];
      }
      path = notification.project_id ? "/projects/" + owner + "/" + name + "/talk/moderations" : '/talk/moderations';
      if (this.state.moderation) {
        return React.createElement("div", {
          "className": "moderation talk-module"
        }, React.createElement("div", {
          "className": "title"
        }, React.createElement(Link, React.__spread({
          "to": path
        }, this.props), notification.message)), React.createElement(Markdown, null, this.state.comment.body), React.createElement("p", null, "Reports:"), React.createElement("ul", null, (function() {
          var j, len, ref1, results;
          ref1 = this.state.reports;
          results = [];
          for (i = j = 0, len = ref1.length; j < len; i = ++j) {
            report = ref1[i];
            results.push(React.createElement("div", {
              "key": this.state.moderation.id + "-report-" + i
            }, React.createElement("li", null, React.createElement(Link, {
              "className": "user-profile-link",
              "to": "/users/" + report.user.login
            }, React.createElement(Avatar, {
              "user": report.user
            }), ' ', report.user.display_name), ': ', report.message)));
          }
          return results;
        }).call(this)), React.createElement("div", {
          "className": "bottom"
        }, (this.state.commentUser ? React.createElement(Link, {
          "className": "user-profile-link",
          "to": "/users/@state.commentUser.login"
        }, React.createElement(Avatar, {
          "user": this.state.commentUser
        }), ' ', this.state.commentUser.display_name) : void 0), ' ', React.createElement(Link, React.__spread({
          "to": path
        }, this.props), notification.message, ' ', moment(notification.created_at).fromNow())));
      } else {
        return React.createElement("div", {
          "className": "talk-module"
        }, React.createElement(Loading, null));
      }
    }
  });
}


},{"../../components/loading-indicator":77,"../../partials/avatar":212,"markdownz":"markdownz","moment":"moment","panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],182:[function(require,module,exports){
var CommentNotification, DataRequestNotification, MessageNotification, ModerationNotification, React, StartedDiscussionNotification;

React = require('react');

CommentNotification = require('./comment');

DataRequestNotification = require('./data-request');

MessageNotification = require('./message');

ModerationNotification = require('./moderation');

StartedDiscussionNotification = require('./started-discussion');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'Notification',
    propTypes: {
      project: React.PropTypes.object,
      user: React.PropTypes.object.isRequired,
      notification: React.PropTypes.object.isRequired
    },
    renderNotification: function() {
      switch (this.props.notification.source_type) {
        case 'Comment':
          return React.createElement(CommentNotification, React.__spread({}, this.props));
        case 'DataRequest':
          return React.createElement(DataRequestNotification, React.__spread({}, this.props));
        case 'Message':
          return React.createElement(MessageNotification, React.__spread({}, this.props));
        case 'Moderation':
          return React.createElement(ModerationNotification, React.__spread({}, this.props));
        case 'Discussion':
          return React.createElement(StartedDiscussionNotification, React.__spread({}, this.props));
      }
    },
    render: function() {
      var delivered, key, notification;
      notification = this.props.notification;
      delivered = notification.delivered ? '' : 'unread';
      key = notification.source_type + "-notification-" + notification.source_id;
      return React.createElement("div", {
        "className": delivered + " notification",
        "key": key
      }, this.renderNotification());
    }
  });
}


},{"./comment":178,"./data-request":179,"./message":180,"./moderation":181,"./started-discussion":183,"react":"react"}],183:[function(require,module,exports){
var Comment, Link, Loading, Markdown, React, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

Link = require('react-router').Link;

Markdown = require('markdownz').Markdown;

Loading = require('../../components/loading-indicator');

Comment = require('../../talk/search-result');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CommentNotification',
    propTypes: {
      project: React.PropTypes.object,
      user: React.PropTypes.object.isRequired,
      notification: React.PropTypes.object.isRequired
    },
    getInitialState: function() {
      return {
        discussion: null,
        comment: null
      };
    },
    componentWillMount: function() {
      return talkClient.type('discussions').get(this.props.notification.source_id).then((function(_this) {
        return function(discussion) {
          _this.setState({
            discussion: discussion
          });
          return talkClient.type('comments').get({
            discussion_id: discussion.id,
            sort: 'created_at',
            page_size: 1
          }).then(function(arg) {
            var comment;
            comment = arg[0];
            return _this.setState({
              comment: comment
            });
          });
        };
      })(this));
    },
    render: function() {
      var name, owner, ref, ref1, slug;
      if (this.state.discussion) {
        ref1 = ((ref = this.state.discussion.project_slug) != null ? ref.split('/') : void 0) || [], owner = ref1[0], name = ref1[1];
        slug = this.state.discussion.project_slug ? "/projects/" + this.state.discussion.project_slug : '';
        return React.createElement("div", {
          "className": "talk-started-discussion talk-module"
        }, React.createElement("div", null, React.createElement("div", {
          "className": "title"
        }, React.createElement(Link, React.__spread({
          "to": slug + "/talk/" + this.state.discussion.board_id + "/" + this.state.discussion.id
        }, this.props), this.props.notification.message)), (this.state.comment ? React.createElement(Comment, {
          "data": this.state.comment,
          "user": this.props.user,
          "project": this.props.project
        }) : void 0)));
      } else {
        return React.createElement("div", {
          "className": "talk-module"
        }, React.createElement(Loading, null));
      }
    }
  });
}


},{"../../components/loading-indicator":77,"../../talk/search-result":298,"markdownz":"markdownz","panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],184:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Markdown = require('markdownz').Markdown;

Translate = require('react-translate-component');

counterpart.registerTranslations('en', {
  privacy: {
    title: 'Zooniverse User Agreement and Privacy Policy',
    userAgreement: '## User Agreement\n\n**Summary**\n\nThe Zooniverse is a suite of citizen science projects operated by the Citizen Science Alliance (CSA), which support scientific research by involving members of the public - you - in the processes of analyzing and discussing data. Data from these projects is used to study online community design and theory, interface design, and other topics. This document describes what will happen to your contributions if you choose to contribute and what data we collect, how we use it and how we protect it.\n\n**What you agree to if you contribute to the Zooniverse**\n\nProjects involving the public are needed to enable researchers to cope with the otherwise unmanageable flood of data. The web provides a means of reaching a large audience willing to devote their free time to projects that can add to our knowledge of the world and the Universe.\n\nThe major goal for this project is for the analyzed data to be available to the researchers for use, modification and redistribution in order to further scientific research. Therefore, if you contribute to the Zooniverse, you grant the CSA and its collaborators, permission to use your contributions however we like to further this goal, trusting us to do the right thing with your data. However, you give us this permission non-exclusively, meaning that you yourself still own your contribution.\n\nWe ask you to grant us these broad permissions, because they allow us to change the legal details by which we keep the data available; this is important because the legal environment can change and we need to be able to respond without obtaining permission from every single contributor.\n\nFinally, you must not contribute data to the Zooniverse that you do not own. For example, do not copy information from published journal articles. If people do this, it can cause major legal headaches for us.\n\n**What you may do with Zooniverse data**\n\nYou retain ownership of any contribution you make to the Zooniverse, and any recorded interaction with the dataset associated with the Zooniverse. You may use, distribute or modify your individual contribution in any way you like. However, you do not possess ownership of the dataset itself. This license does not apply to data about you, covered in the Privacy Policy.\n\n**Legal details**\n\nBy submitting your contribution to the Zooniverse, you agree to grant the CSA a perpetual, royalty-free, non-exclusive, sub-licensable license to: use, reproduce, modify, adapt, publish, translate, create derivative works from, distribute, and exercise all copyright and publicity rights with respect to your contribution worldwide and/or to incorporate your contribution in other works in any media now known or later developed for the full term of any rights that may exist in your contribution.\n\nIf you do not want to grant to the CSA the rights set out above, you cannot interact with the Zooniverse.\n\nBy interacting with the Zooniverse, you:\n\n* Warrant that your contribution contains only data that you have the right to make available to the CSA for all the purposes specified above, is not defamatory, and does not infringe any law; and\n\n* Indemnify the CSA against all legal fees, damages and other expenses that may be incurred by the CSA as a result of your breach of the above warranty; and\n\n* Waive any moral rights in your contribution for the purposes specified above.\n\nThis license does not apply to data about you, covered in the Privacy Policy.',
    privacyPolicy: '## Privacy Policy\n\nIn addition to the contributions you make towards the scientific goals of the Zooniverse, we collect additional data about you to support and improve the operation of the project. We also conduct experiments on the design of the website that we evaluate based on your reactions and behavior. This Privacy Policy describes what data we collect, how we use it and how we protect it.\n\nWe respect the privacy of every individual who participates in the Zooniverse. We operate in accordance with the United Kingdom Data Protection Act 1998 and the Freedom of Information Act 2000, as well as with United States regulations regarding protection of human subjects in research.\n\n**Data we collect**\n\n_Identifying information_: If you register with the Zooniverse, we ask you to create a username and supply your e-mail address. Your e-mail address is not visible to other users, but others will see your username in various contexts. Notably, your username is associated with any classifications or other contributions you make, e.g., on Talk pages. You may optionally provide your real name to be included when we publically thank participants, e.g., in presentations, publications or discoveries.\n\n_Usage information_: We also monitor how people use our website, and aggregate general statistics about users and traffic patterns as well as data about how users respond to various site features. This includes, among other things, recording:\n\n* When you log in.\n\n* Pages you request.\n\n* Classifications you make.\n\n* Other contributions, such as posts on Talk pages.\n\nIf you register and log in, the logs associate these activities with your username. Otherwise, they are associated with your IP address. In order to collect this data, we may use software that collects statistics from IP data. This software can determine what times of day people access our site, which country they access the websites from, how long they visit for, what browser they are using, etc.\n\n**What we do with the information we gather**\n\nUsage information is collected to help us improve our website in particular for the following reasons:\n\n* Internal record keeping.\n\n* We may periodically send email promoting new research-related projects or other information relating to our research. Information about these contacts is given below. We will not use your contact information for commercial purposes.\n\n* We may use the information to customize the website.\n\n* We may use the information to conduct experiments regarding the use of various site features.\n\n**What is shared with third parties**\n\nWe will never release e-mail addresses to third parties without your express permission. We will also never share data we collect about you unless (a) it cannot be associated with you or your username, and (b) it is necessary to accomplish our research goals. Specifically, we may share your anonymized data with research study participants, other researchers, or in scholarly work describing our research. For example, we might use one of your classifications as an illustration in a paper, show some of your classifications to another user to see if they agree or disagree, or publish statistics about user interaction.\n\nContributions you make to the Talk pages are widely available to others. Aside from the above, information is held as confidentially as is practical within our secured database.\n\n**How we use cookies**\n\nIn some areas of our site, a cookie may be placed on your computer. A cookie is a small file that resides on your computer\'s hard drive that allows us to improve the quality of your visit to our websites by responding to you as an individual.\n\nWe use traffic log cookies to identify which pages are being used and improve our website. We only use this information for statistical analysis purposes, they are not shared with other sites and are not used for advertisements.\n\nYou can choose to accept or decline cookies. Most web browsers automatically accept cookies, but you can usually modify your browser setting to decline cookies if you prefer. However, if you choose to decline cookies from the Zooniverse then functionality, including your ability to log-in and participate, will be impaired.\n\nAcceptance of cookies is implied if you continue to access our website without adjusting your browser settings.\n\n**Where we store your data**\n\nWe use Amazon Web Services so we can quickly and reliably serve our website to an unpredictable number of people. This means that your data will be stored in multiple locations, including the United States of America (USA). Amazon is a participant in the Safe Harbor program developed by the USA Department of Commerce and the European Union (EU). Amazon has certified that it adheres to the Safe Harbor Privacy Principles agreed upon by the USA and the EU.\n\n**Security measures**\n\nMembers of the research teams are made aware of our privacy policy and practices by reviewing this statement upon joining the team. We follow industry best practices to secure user data, and access to the database and logs are limited to members of the research group and system administrative staff.\n\n**Removing your data**\n\nDue to the way in which we archive data, it is generally not possible to completely remove your personal data from our systems. However, if you have specific concerns, please contact us and we will see what we can do.\n\n**When we will contact you**\n\nIf you do not register, we will never contact you. If you do register, we will contact you by e-mail in the following circumstances:\n\n* Occasionally, we will send e-mail messages to you highlighting a particular aspect of our research, announcing new features, explaining changes to the system, or inviting you to special events.\n\n* We may also use your information to contact you for the purpose of research into our site\'s operation. We may contact you by email. We may ask for additional information at that time. Providing additional information is entirely optional and will in no way affect your service in the site.\n\n* We may contact you with a newsletter about the progress of the project.\n\nYou are unlikely to receive more than two messages per month.\n\nThe Zooniverse email newsletter service is provided by JISCmail, which is operated by the United Kingdom Science and Technology Facilities Council. JISCmail does not sell or otherwise transfer any personal data to commercial companies or other organisations. Please review the full JISCmail privacy policy. You can \'opt out\' of the newsletter at any time by visiting the Zooniverse [unsubscribe](https://www.zooniverse.org/unsubscribe) page.\n\n**Further information and requests**\n\nThe Data Controller is the Department of Physics, University of Oxford. For a copy of the information we hold on you please contact the project team at the address below:\n\nProfessor Chris Lintott\nOxford Astrophysics\nDenys Wilkinson Building\nKeble Road\nOxford, OX1 3RH\nUnited Kingdom'
  }
});

module.exports = React.createClass({
  displayName: 'PrivacyPage',
  componentDidMount: function() {
    return counterpart.onLocaleChange(this.handleLocaleChange);
  },
  componentWillUnmount: function() {
    return counterpart.offLocaleChange(this.handleLocaleChange);
  },
  handleLocaleChange: function() {
    return this.forceUpdate();
  },
  render: function() {
    return React.createElement("div", {
      "className": "content-container"
    }, React.createElement(Translate, {
      "component": "h1",
      "content": "privacy.title"
    }), React.createElement("div", {
      "className": "columns-container"
    }, React.createElement(Markdown, {
      "className": "column"
    }, counterpart('privacy.userAgreement')), React.createElement(Markdown, {
      "className": "column"
    }, counterpart('privacy.privacyPolicy'))));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],185:[function(require,module,exports){
var Markdown, PAGE_SIZE, React, apiClient, moment, talkClient;

React = require('react');

moment = require('moment');

apiClient = require('panoptes-client/lib/api-client');

talkClient = require('panoptes-client/lib/talk-client');

Markdown = require('markdownz').Markdown;

PAGE_SIZE = require('../../talk/config').discussionPageSize;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CommentLink',
    getDefaultProps: function() {
      return {
        comment: null
      };
    },
    getInitialState: function() {
      return {
        project: null,
        owner: null,
        discussion: null,
        board: null,
        href: ''
      };
    },
    componentDidMount: function() {
      return this.getCommentHREF(this.props.comment);
    },
    componentWillReceiveProps: function(nextProps) {
      if (nextProps.comment !== this.props.comment) {
        return this.getCommentHREF(nextProps.comment);
      }
    },
    getCommentHREF: function(comment) {
      var ref, rootID, rootType;
      ref = comment.section.split('-'), rootType = ref[0], rootID = ref[1];
      return talkClient.type('discussions').get(comment.discussion_id).then((function(_this) {
        return function(discussion) {
          _this.setState({
            discussion: discussion
          });
          return talkClient.type('boards').get(discussion.board_id).then(function(board) {
            var href;
            _this.setState({
              board: board
            });
            href = rootID != null ? rootType === 'project' ? apiClient.type('projects').get(rootID).then(function(project) {
              _this.setState({
                project: project
              });
              return project.get('owner').then(function(owner) {
                var name, ref1;
                _this.setState({
                  owner: owner
                });
                ref1 = project.slug.split('/'), owner = ref1[0], name = ref1[1];
                return "/projects/" + owner + "/" + name + "/talk/" + board.id + "/" + discussion.id + "?comment=" + comment.id;
              });
            }) : void 0 : Promise.resolve("/talk/" + board.id + "/" + discussion.id + "?comment=" + comment.id);
            return href.then(function(href) {
              return _this.setState({
                href: document.baseURI.slice(0, -1) + href
              });
            });
          });
        };
      })(this));
    },
    render: function() {
      var ref, ref1, ref2, ref3;
      return React.createElement("div", {
        "className": "profile-feed-comment-link"
      }, React.createElement("header", null, React.createElement("span", {
        "className": "comment-timestamp",
        "title": moment(this.props.comment.created_at).toISOString()
      }, moment(this.props.comment.created_at).fromNow()), (((ref = this.state.board) != null ? ref.id : void 0) && ((ref1 = this.state.discussion) != null ? ref1.id : void 0) ? React.createElement("span", null, ' ', "in", ' ', React.createElement("a", {
        "href": this.state.href
      }, ((this.state.project != null) && this.state.owner ? React.createElement("span", null, React.createElement("strong", {
        "className": "comment-project",
        "title": this.state.owner.display_name + "/" + this.state.project.display_name
      }, this.state.project.display_name), "") : void 0), React.createElement("strong", {
        "className": "comment-board"
      }, ((ref2 = this.state.board) != null ? ref2.title : void 0)), "", React.createElement("strong", {
        "className": "comment-discussion"
      }, ((ref3 = this.state.discussion) != null ? ref3.title : void 0)))) : void 0)), React.createElement(Markdown, {
        "className": "comment-body",
        "content": this.props.comment.body
      }));
    }
  });
}


},{"../../talk/config":249,"markdownz":"markdownz","moment":"moment","panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react"}],186:[function(require,module,exports){
var CommentLink, Markdown, Paginator, React, apiClient, moment, talkClient;

React = require('react');

moment = require('moment');

apiClient = require('panoptes-client/lib/api-client');

talkClient = require('panoptes-client/lib/talk-client');

Markdown = require('markdownz').Markdown;

Paginator = require('../../talk/lib/paginator');

CommentLink = require('./comment-link');

module.exports = React.createClass({
  displayName: 'UserProfileFeed',
  propTypes: {
    user: React.PropTypes.object
  },
  getDefaultProps: function() {
    return {
      location: {
        query: {
          page: 1
        }
      }
    };
  },
  getInitialState: function() {
    return {
      comments: null,
      error: null
    };
  },
  componentDidMount: function() {
    return this.getComments(this.props.profileUser, this.props.location.query.page);
  },
  componentWillReceiveProps: function(nextProps) {
    if (!(nextProps === this.props.profileUser && nextProps.location.query.page === this.props.location.query.page)) {
      return this.getComments(nextProps.profileUser, nextProps.location.query.page);
    }
  },
  getComments: function(user, page) {
    return this.setState({
      comments: null,
      error: null
    }, (function(_this) {
      return function() {
        return talkClient.type('comments').get({
          user_id: user.id,
          page: page,
          sort: '-created_at'
        })["catch"](function(error) {
          return _this.setState({
            error: error
          });
        }).then(function(comments) {
          return _this.setState({
            comments: comments
          });
        });
      };
    })(this));
  },
  render: function() {
    var comment, meta, ref;
    return React.createElement("div", {
      "className": "content-container"
    }, (((ref = this.state.comments) != null ? ref.length : void 0) === 0 ? React.createElement("p", {
      "className": "form-help"
    }, "No recent comments") : this.state.comments != null ? (meta = this.state.comments[0].getMeta(), React.createElement("div", null, React.createElement("h2", null, "Recent comments"), (function() {
      var i, len, ref1, results;
      ref1 = this.state.comments;
      results = [];
      for (i = 0, len = ref1.length; i < len; i++) {
        comment = ref1[i];
        results.push(React.createElement(CommentLink, {
          "key": comment.id,
          "comment": comment
        }));
      }
      return results;
    }).call(this), React.createElement(Paginator, {
      "pageCount": meta.page_count,
      "page": meta.page
    }))) : this.state.error != null ? React.createElement("p", {
      "className": "form-help error"
    }, this.state.error.toString()) : null));
  }
});


},{"../../talk/lib/paginator":273,"./comment-link":185,"markdownz":"markdownz","moment":"moment","panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react"}],187:[function(require,module,exports){
var IndexLink, Link, PrivateMessageForm, PromiseRenderer, React, Translate, UserProfilePage, apiClient, counterpart, ref, talkClient;

counterpart = require('counterpart');

React = require('react');

PrivateMessageForm = require('../../talk/private-message-form');

PromiseRenderer = require('../../components/promise-renderer');

apiClient = require('panoptes-client/lib/api-client');

Translate = require('react-translate-component');

ref = require('react-router'), Link = ref.Link, IndexLink = ref.IndexLink;

talkClient = require('panoptes-client/lib/talk-client');

counterpart.registerTranslations('en', {
  profile: {
    title: "Hi, %(name)s!",
    nav: {
      comments: "Recent comments",
      stats: "Stats",
      collections: "Collections",
      favorites: "Favorites",
      message: "Message",
      moderation: "Moderation",
      stats: "Your stats",
      settings: "Settings"
    }
  }
});

UserProfilePage = React.createClass({
  displayName: 'UserProfilePage',
  getDefaultProps: function() {
    return {
      profileUser: null
    };
  },
  getInitialState: function() {
    return {
      profileHeader: null
    };
  },
  componentDidMount: function() {
    document.documentElement.classList.add('on-secondary-page');
    return this.getProfileHeader(this.props.profileUser);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.profileUser !== this.props.profileUser) {
      return this.getProfileHeader(nextProps.profileUser);
    }
  },
  componentWillUnmount: function() {
    return document.documentElement.classList.remove('on-secondary-page');
  },
  getProfileHeader: function(user) {
    return this.props.profileUser.get('profile_header')["catch"]((function(_this) {
      return function() {
        return [];
      };
    })(this)).then((function(_this) {
      return function(arg) {
        var profileHeader;
        profileHeader = arg[0];
        return _this.setState({
          profileHeader: profileHeader
        });
      };
    })(this));
  },
  render: function() {
    var headerStyle;
    if (this.state.profileHeader != null) {
      headerStyle = {
        backgroundImage: "url(" + this.state.profileHeader.src + ")"
      };
    }
    return React.createElement("div", {
      "className": "secondary-page user-profile"
    }, React.createElement("section", {
      "className": "hero user-profile-hero",
      "style": headerStyle
    }, React.createElement("div", {
      "className": "overlay"
    }), React.createElement("div", {
      "className": "hero-container"
    }, React.createElement("h1", null, this.props.profileUser.display_name), React.createElement("nav", {
      "className": "hero-nav"
    }, React.createElement(IndexLink, {
      "to": "/users/" + this.props.profileUser.login,
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "profile.nav.comments"
    })), ' ', React.createElement(Link, {
      "to": "/collections/" + this.props.profileUser.login,
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "profile.nav.collections"
    })), ' ', React.createElement(Link, {
      "to": "/favorites/" + this.props.profileUser.login,
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "profile.nav.favorites"
    })), ' ', React.createElement("span", null, (this.props.user === this.props.profileUser ? React.createElement(Link, {
      "to": "/users/" + this.props.profileUser.login + "/stats",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "profile.nav.stats"
    })) : React.createElement(Link, {
      "to": "/users/" + this.props.profileUser.login + "/message",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "profile.nav.message"
    }))))))), React.createElement("section", {
      "className": "user-profile-content"
    }, React.cloneElement(this.props.children, this.props)));
  }
});

module.exports = React.createClass({
  displayName: 'UserProfilePageWrapper',
  render: function() {
    return React.createElement(PromiseRenderer, {
      "promise": apiClient.type('users').get({
        login: this.props.params.name
      }),
      "then": ((function(_this) {
        return function(arg) {
          var profileUser;
          profileUser = arg[0];
          if (profileUser != null) {
            return React.createElement(UserProfilePage, React.__spread({}, _this.props, {
              "profileUser": profileUser,
              "user": _this.props.user
            }));
          } else {
            return React.createElement("p", null, "Sorry, we couldnt find any user going by ", React.createElement("strong", null, _this.props.params.name), ".");
          }
        };
      })(this))
    });
  }
});


},{"../../components/promise-renderer":86,"../../talk/private-message-form":294,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],188:[function(require,module,exports){
var PrivateMessageForm, React, talkClient;

React = require('react');

PrivateMessageForm = require('../../talk/private-message-form');

talkClient = require('panoptes-client/lib/talk-client');

module.exports = React.createClass({
  displayName: 'PrivateMessagePage',
  getInitialState: function() {
    return {
      block: null
    };
  },
  componentDidMount: function() {
    var ref, userId;
    userId = (ref = this.props.profileUser) != null ? ref.id : void 0;
    if (userId) {
      return this.getBlockedUser(userId);
    }
  },
  componentWillReceiveProps: function(nextProps) {
    var ref, ref1, userId;
    userId = (ref = nextProps.profileUser) != null ? ref.id : void 0;
    if (userId && userId !== ((ref1 = this.props.profileUser) != null ? ref1.id : void 0)) {
      return this.getBlockedUser(userId);
    }
  },
  getBlockedUser: function(id) {
    return talkClient.type('blocked_users').get({
      blocked_user_id: id
    }).then((function(_this) {
      return function(arg) {
        var block;
        block = arg[0];
        return _this.setState({
          block: block
        });
      };
    })(this));
  },
  handleBlock: function(e) {
    return talkClient.type('blocked_users').create({
      blocked_user_id: this.props.profileUser.id
    }).save().then((function(_this) {
      return function(block) {
        return _this.setState({
          block: block
        });
      };
    })(this));
  },
  handleUnblock: function(e) {
    return this.state.block["delete"]().then((function(_this) {
      return function() {
        return _this.setState({
          block: null
        });
      };
    })(this));
  },
  render: function() {
    var block;
    block = this.state.block;
    return React.createElement("div", {
      "className": "private-message-page"
    }, (this.props.user != null ? React.createElement("div", {
      "className": "content-container"
    }, (block ? React.createElement("div", {
      "className": "block-user"
    }, React.createElement("button", {
      "className": "block-button",
      "onClick": this.handleUnblock
    }, "Unblock"), React.createElement("p", {
      "className": "description"
    }, "You have blocked this user")) : React.createElement("div", null, React.createElement("h2", null, "Send a private message to ", this.props.profileUser.display_name, ' ', (this.props.user === this.props.profileUser ? React.createElement("span", null, React.createElement("br", null), React.createElement("small", {
      "className": "form-help"
    }, "(Hey wait, thats you!)")) : void 0)), React.createElement(PrivateMessageForm, React.__spread({}, this.props)), React.createElement("div", {
      "className": "block-user"
    }, React.createElement("button", {
      "className": "block-button",
      "onClick": this.handleBlock
    }, "Block"), React.createElement("p", {
      "className": "description"
    }, "You can prevent this user from sending you messages"))))) : React.createElement("p", null, "Sign in to send this user a message.")));
  }
});


},{"../../talk/private-message-form":294,"panoptes-client/lib/talk-client":553,"react":"react"}],189:[function(require,module,exports){
var ClassificationsRibbon, ProjectIcon, PromiseRenderer, React;

React = require('react');

ClassificationsRibbon = require('../../components/classifications-ribbon');

PromiseRenderer = require('../../components/promise-renderer');

ProjectIcon = require('../../components/project-icon');

module.exports = React.createClass({displayName: "exports",
  getDefaultProps: function() {
    return {
      user: null
    };
  },
  render: function() {
    var centered;
    return React.createElement("div", {
      "className": "content-container"
    }, React.createElement("h3", null, "Your contribution stats"), React.createElement("p", {
      "className": "form-help"
    }, "Users can only view their own stats."), (this.props.profileUser === this.props.user ? (centered = {
      textAlign: 'center'
    }, React.createElement("div", {
      "style": centered
    }, React.createElement("p", null, React.createElement(ClassificationsRibbon, {
      "user": this.props.profileUser
    })), React.createElement(PromiseRenderer, {
      "promise": ClassificationsRibbon.prototype.getAllProjectPreferences(this.props.profileUser),
      "then": ((function(_this) {
        return function(projectPreferences) {
          return React.createElement("div", null, projectPreferences.map(function(projectPreference) {
            return React.createElement(PromiseRenderer, {
              "key": projectPreference.id,
              "promise": projectPreference.get('project'),
              "catch": null,
              "then": (function(project) {
                if (project != null) {
                  return React.createElement("span", null, React.createElement(ProjectIcon, {
                    "project": project,
                    "badge": projectPreference.activity_count
                  }), "                      ");
                } else {
                  return null;
                }
              })
            });
          }));
        };
      })(this))
    }))) : React.createElement("p", null, "Sorry, we cant show you stats for ", this.props.profileUser.display_name, ".")));
  }
});


},{"../../components/classifications-ribbon":65,"../../components/project-icon":85,"../../components/promise-renderer":86,"react":"react"}],190:[function(require,module,exports){
var Classifier, FAILED_CLASSIFICATION_QUEUE_NAME, FinishedBanner, HandlePropChanges, PROMPT_TO_SIGN_IN_AFTER, PromiseToSetState, React, ReactDOM, SKIP_CELLECT, SignInPrompt, TitleMixin, alert, animatedScrollTo, apiClient, auth, classificationsThisSession, counterpart, currentClassifications, currentWorkflowForProject, emptySubjectQueue, seenThisSession, sessionDemoMode, upcomingSubjects,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

auth = require('panoptes-client/lib/auth');

React = require('react');

ReactDOM = require('react-dom');

TitleMixin = require('../../lib/title-mixin');

HandlePropChanges = require('../../lib/handle-prop-changes');

PromiseToSetState = require('../../lib/promise-to-set-state');

apiClient = require('panoptes-client/lib/api-client');

animatedScrollTo = require('animated-scrollto');

counterpart = require('counterpart');

FinishedBanner = require('./finished-banner');

Classifier = require('../../classifier');

alert = require('../../lib/alert');

SignInPrompt = require('../../partials/sign-in-prompt');

seenThisSession = require('../../lib/seen-this-session');

FAILED_CLASSIFICATION_QUEUE_NAME = 'failed-classifications';

PROMPT_TO_SIGN_IN_AFTER = [5, 10, 25, 50, 100, 250, 500];

SKIP_CELLECT = (typeof location !== "undefined" && location !== null ? location.search.match(/\Wcellect=0(?:\W|$)/) : void 0) != null;

if (SKIP_CELLECT) {
  if (typeof console !== "undefined" && console !== null) {
    console.warn('Intelligent subject selection disabled');
  }
}

classificationsThisSession = 0;

auth.listen(function() {
  return classificationsThisSession = 0;
});

currentWorkflowForProject = {};

currentClassifications = {
  forWorkflow: {}
};

upcomingSubjects = {
  forWorkflow: {}
};

emptySubjectQueue = function() {
  var i, len, queue, ref, results, subject, workflowID;
  if (typeof console !== "undefined" && console !== null) {
    console.log('Emptying upcoming subjects queue');
  }
  ref = upcomingSubjects.forWorkflow;
  results = [];
  for (workflowID in ref) {
    queue = ref[workflowID];
    for (i = 0, len = queue.length; i < len; i++) {
      subject = queue[i];
      subject.destroy();
    }
    results.push(queue.splice(0));
  }
  return results;
};

auth.listen('change', emptySubjectQueue);

apiClient.type('subject_sets').listen('add-or-remove', emptySubjectQueue);

sessionDemoMode = false;

module.exports = React.createClass({
  displayName: 'ProjectClassifyPage',
  mixins: [TitleMixin, HandlePropChanges, PromiseToSetState],
  title: 'Classify',
  getDefaultProps: function() {
    var ref;
    return {
      query: null,
      project: null,
      simulateSaveFailure: ((ref = typeof location !== "undefined" && location !== null ? location.search : void 0) != null ? ref : '').indexOf('simulate-classification-save-failure') !== -1
    };
  },
  getInitialState: function() {
    return {
      workflow: null,
      subject: null,
      classification: null,
      projectIsComplete: false,
      demoMode: sessionDemoMode
    };
  },
  propChangeHandlers: {
    project: 'loadAppropriateClassification',
    query: 'loadAppropriateClassification'
  },
  componentDidMount: function() {
    return this.getCurrentWorkflow().then((function(_this) {
      return function(workflow) {
        return _this.setState({
          workflow: workflow
        });
      };
    })(this));
  },
  loadAppropriateClassification: function(_, props) {
    if (props == null) {
      props = this.props;
    }
    return this.promiseToSetState({
      classification: this.getCurrentWorkflow(props).then((function(_this) {
        return function(workflow) {
          var base, name;
          if ((base = currentClassifications.forWorkflow)[name = workflow.id] == null) {
            base[name] = _this.createNewClassification(props.project, workflow);
          }
          return currentClassifications.forWorkflow[workflow.id];
        };
      })(this))
    });
  },
  getCurrentWorkflow: function(props) {
    var name, ref;
    if (props == null) {
      props = this.props;
    }
    if (((ref = props.location.query) != null ? ref.workflow : void 0) != null) {
      return this.getWorkflow(props.project, props.location.query.workflow);
    } else {
      if (currentWorkflowForProject[name = props.project.id] == null) {
        currentWorkflowForProject[name] = this.getRandomWorkflow(props.project);
      }
      return currentWorkflowForProject[props.project.id];
    }
  },
  getRandomWorkflow: function(project) {
    return project.get('workflows', {
      active: true
    }).then((function(_this) {
      return function(workflows) {
        var projectIsComplete, randomIndex, workflow;
        if (workflows.length === 0) {
          throw new Error("No workflows for project " + project.id);
          return project.uncacheLink('workflows');
        } else {
          projectIsComplete = ((function() {
            var i, len, results;
            results = [];
            for (i = 0, len = workflows.length; i < len; i++) {
              workflow = workflows[i];
              if (workflow.finished_at == null) {
                results.push(true);
              }
            }
            return results;
          })()).length === 0;
          _this.setState({
            projectIsComplete: projectIsComplete
          });
          randomIndex = Math.floor(Math.random() * workflows.length);
          return workflows[randomIndex];
        }
      };
    })(this));
  },
  createNewClassification: function(project, workflow) {
    var getSubjectSet, loadSubject;
    this.setState({
      workflow: workflow
    });
    getSubjectSet = workflow.grouped ? workflow.get('subject_sets').then((function(_this) {
      return function(subjectSets) {
        var randomIndex;
        randomIndex = Math.floor(Math.random() * subjectSets.length);
        return subjectSets[randomIndex];
      };
    })(this)) : Promise.resolve();
    loadSubject = getSubjectSet.then((function(_this) {
      return function(subjectSet) {
        return _this.getNextSubject(project, workflow, subjectSet);
      };
    })(this));
    return loadSubject.then((function(_this) {
      return function(subject) {
        var classification, location;
        classification = apiClient.type('classifications').create({
          annotations: [],
          metadata: {
            workflow_version: workflow.version,
            started_at: (new Date).toISOString(),
            user_agent: navigator.userAgent,
            user_language: counterpart.getLocale(),
            utc_offset: ((new Date).getTimezoneOffset() * 60).toString(),
            subject_dimensions: (function() {
              var i, len, ref, results;
              ref = subject.locations;
              results = [];
              for (i = 0, len = ref.length; i < len; i++) {
                location = ref[i];
                results.push(null);
              }
              return results;
            })()
          },
          links: {
            project: project.id,
            workflow: workflow.id,
            subjects: [subject.id]
          }
        });
        classification._workflow = workflow;
        classification._subjects = [subject];
        return classification;
      };
    })(this));
  },
  getWorkflow: function(project, workflowID) {
    return project.get('workflows', {
      id: workflowID
    }).then(function(arg) {
      var workflow;
      workflow = arg[0];
      if (workflow == null) {
        throw new Error("No workflow " + workflowID + " for project " + project.id);
      }
      return workflow;
    });
  },
  getNextSubject: function(project, workflow, subjectSet) {
    var base, fetchSubjects, name, subject, subjectQuery, subjectToLoad;
    if ((base = upcomingSubjects.forWorkflow)[name = workflow.id] == null) {
      base[name] = [];
    }
    if (upcomingSubjects.forWorkflow[workflow.id].length !== 0) {
      subjectToLoad = upcomingSubjects.forWorkflow[workflow.id].shift();
      subject = Promise.resolve(subjectToLoad);
    }
    if (upcomingSubjects.forWorkflow[workflow.id].length === 0) {
      subjectQuery = {
        workflow_id: workflow.id,
        sort: !SKIP_CELLECT ? 'queued' : void 0
      };
      if (subjectSet != null) {
        subjectQuery.subject_set_id = subjectSet.id;
      }
      fetchSubjects = apiClient.type('subjects').get(subjectQuery)["catch"](function(error) {
        if (error.message.indexOf('please try again') === -1) {
          throw error;
        } else {
          return new Promise(function(resolve, reject) {
            var fetchSubjectsAgain;
            fetchSubjectsAgain = function() {
              return apiClient.type('subjects').get(subjectQuery).then(resolve)["catch"](reject);
            };
            return setTimeout(fetchSubjectsAgain, 2000);
          });
        }
      }).then(function(subjects) {
        var newSubject, nonLoadedSubjects, ref;
        nonLoadedSubjects = (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = subjects.length; i < len; i++) {
            newSubject = subjects[i];
            if (newSubject !== subjectToLoad) {
              results.push(newSubject);
            }
          }
          return results;
        })();
        return (ref = upcomingSubjects.forWorkflow[workflow.id]).push.apply(ref, nonLoadedSubjects);
      });
      if (subject == null) {
        subject = fetchSubjects.then(function() {
          if (upcomingSubjects.forWorkflow[workflow.id].length === 0) {
            throw new Error("No subjects available for workflow " + workflow.id);
          } else {
            return upcomingSubjects.forWorkflow[workflow.id].shift();
          }
        });
      }
    }
    return subject;
  },
  render: function() {
    var ref, ref1;
    return React.createElement("div", {
      "className": "classify-page content-container"
    }, (this.state.projectIsComplete ? React.createElement(FinishedBanner, {
      "project": this.props.project
    }) : void 0), (this.state.classification != null ? React.createElement(Classifier, React.__spread({}, this.props, {
      "classification": this.state.classification,
      "onLoad": this.scrollIntoView,
      "demoMode": this.state.demoMode,
      "onChangeDemoMode": this.handleDemoModeChange,
      "onComplete": (((ref = this.state.workflow) != null ? (ref1 = ref.configuration) != null ? ref1.hide_classification_summaries : void 0 : void 0) ? this.saveClassificationAndLoadAnotherSubject : this.saveClassification),
      "onClickNext": this.loadAnotherSubject
    })) : this.state.rejected.classification != null ? React.createElement("code", null, this.state.rejected.classification.toString()) : React.createElement("span", null, "Loading classification")));
  },
  scrollIntoView: function(e) {
    var idealScrollY, lineHeight, node, space;
    lineHeight = parseFloat(getComputedStyle(document.body).lineHeight);
    node = ReactDOM.findDOMNode(this);
    space = (innerHeight - node.offsetHeight) / 2;
    idealScrollY = node.offsetTop - space;
    if (Math.abs(idealScrollY - scrollY) > lineHeight) {
      return animatedScrollTo(document.body, node.offsetTop - space, 333);
    }
  },
  handleDemoModeChange: function(newDemoMode) {
    sessionDemoMode = newDemoMode;
    return this.setState({
      demoMode: sessionDemoMode
    });
  },
  saveClassificationAndLoadAnotherSubject: function() {
    return this.saveClassification().then(this.loadAnotherSubject());
  },
  saveClassification: function() {
    var classification, savingClassification;
    classification = this.state.classification;
    if (typeof console !== "undefined" && console !== null) {
      console.info('Completed classification', classification);
    }
    savingClassification = this.state.demoMode ? Promise.resolve(classification) : this.props.simulateSaveFailure ? Promise.reject(new Error('Simulated failure of classification save')) : classification.save();
    savingClassification.then((function(_this) {
      return function(classification) {
        if (_this.state.demoMode) {
          if (typeof console !== "undefined" && console !== null) {
            console.log('Demo mode: Did NOT save classification');
          }
        } else {
          if (typeof console !== "undefined" && console !== null) {
            console.log('Saved classification', classification.id);
          }
          Promise.all([classification.get('workflow'), classification.get('subjects')]).then(function(arg) {
            var subjects, workflow;
            workflow = arg[0], subjects = arg[1];
            seenThisSession.add(workflow, subjects);
            return classification.destroy();
          });
        }
        return _this.saveAllQueuedClassifications();
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        if (typeof console !== "undefined" && console !== null) {
          console.warn('Failed to save classification:', error);
        }
        return _this.queueClassification(classification);
      };
    })(this));
    classificationsThisSession += 1;
    this.maybePromptToSignIn();
    return savingClassification;
  },
  queueClassification: function(classification) {
    var error, error1, queue;
    queue = JSON.parse(localStorage.getItem(FAILED_CLASSIFICATION_QUEUE_NAME));
    if (queue == null) {
      queue = [];
    }
    queue.push(classification);
    try {
      localStorage.setItem(FAILED_CLASSIFICATION_QUEUE_NAME, JSON.stringify(queue));
      return typeof console !== "undefined" && console !== null ? console.info('Queued classifications:', queue.length) : void 0;
    } catch (error1) {
      error = error1;
      return typeof console !== "undefined" && console !== null ? console.error('Failed to queue classification:', error) : void 0;
    }
  },
  saveAllQueuedClassifications: function() {
    var classificationData, i, len, queue, results;
    queue = JSON.parse(localStorage.getItem(FAILED_CLASSIFICATION_QUEUE_NAME));
    if ((queue != null) && queue.length !== 0) {
      if (typeof console !== "undefined" && console !== null) {
        console.log('Saving queued classifications:', queue.length);
      }
      results = [];
      for (i = 0, len = queue.length; i < len; i++) {
        classificationData = queue[i];
        results.push((function(_this) {
          return function(classificationData) {
            return apiClient.type('classifications').create(classificationData).save().then(function(actualClassification) {
              var error, error1, indexInQueue;
              actualClassification.destroy();
              indexInQueue = queue.indexOf(classificationData);
              queue.splice(indexInQueue, 1);
              try {
                localStorage.setItem(FAILED_CLASSIFICATION_QUEUE_NAME, JSON.stringify(queue));
                return typeof console !== "undefined" && console !== null ? console.info('Saved a queued classification, remaining:', queue.length) : void 0;
              } catch (error1) {
                error = error1;
                return typeof console !== "undefined" && console !== null ? console.error('Failed to update classification queue:', error) : void 0;
              }
            })["catch"](function(error) {
              return typeof console !== "undefined" && console !== null ? console.error('Failed to save a queued classification:', error) : void 0;
            });
          };
        })(this)(classificationData));
      }
      return results;
    }
  },
  maybePromptToSignIn: function() {
    if (indexOf.call(PROMPT_TO_SIGN_IN_AFTER, classificationsThisSession) >= 0 && (this.props.user == null)) {
      return alert((function(_this) {
        return function(resolve) {
          return React.createElement(SignInPrompt, {
            "project": _this.props.project,
            "onChoose": resolve
          }, React.createElement("p", null, React.createElement("strong", null, "Youve done ", classificationsThisSession, " classifications, but youre not signed in!")));
        };
      })(this));
    }
  },
  loadAnotherSubject: function() {
    return this.getCurrentWorkflow(this.props).then((function(_this) {
      return function(workflow) {
        var ref;
        currentClassifications.forWorkflow[workflow.id] = null;
        if (((ref = _this.props.location.query) != null ? ref.workflow : void 0) == null) {
          currentWorkflowForProject[_this.props.project.id] = null;
        }
        return _this.loadAppropriateClassification();
      };
    })(this));
  }
});

window.currentWorkflowForProject = currentWorkflowForProject;

window.currentClassifications = currentClassifications;

window.upcomingSubjects = upcomingSubjects;


},{"../../classifier":16,"../../lib/alert":98,"../../lib/handle-prop-changes":104,"../../lib/promise-to-set-state":111,"../../lib/seen-this-session":113,"../../lib/title-mixin":117,"../../partials/sign-in-prompt":228,"./finished-banner":193,"animated-scrollto":"animated-scrollto","counterpart":"counterpart","panoptes-client/lib/api-client":549,"panoptes-client/lib/auth":550,"react":"react","react-dom":"react-dom"}],191:[function(require,module,exports){
var Markdown, PromiseRenderer, React, TitleMixin;

React = require('react');

TitleMixin = require('../../lib/title-mixin');

Markdown = require('markdownz').Markdown;

PromiseRenderer = require('../../components/promise-renderer');

module.exports = React.createClass({
  displayName: 'ProjectEducationPage',
  mixins: [TitleMixin],
  title: 'Educational resources',
  render: function() {
    return React.createElement("div", {
      "className": "project-text-content content-container"
    }, React.createElement(PromiseRenderer, {
      "promise": this.props.project.get('pages', {
        url_key: "education"
      }).index(0)
    }, ((function(_this) {
      return function(education) {
        return React.createElement(Markdown, {
          "project": _this.props.project,
          "className": "column"
        }, ((education != null ? education.content : void 0) ? education != null ? education.content : void 0 : 'This project has no educational resources yet.'));
      };
    })(this))));
  }
});


},{"../../components/promise-renderer":86,"../../lib/title-mixin":117,"markdownz":"markdownz","react":"react"}],192:[function(require,module,exports){
var Markdown, PromiseRenderer, React, TitleMixin;

React = require('react');

TitleMixin = require('../../lib/title-mixin');

Markdown = require('markdownz').Markdown;

PromiseRenderer = require('../../components/promise-renderer');

module.exports = React.createClass({
  displayName: 'ProjectFAQPage',
  mixins: [TitleMixin],
  title: 'FAQ',
  render: function() {
    return React.createElement("div", {
      "className": "project-text-content content-container"
    }, React.createElement(PromiseRenderer, {
      "promise": this.props.project.get('pages', {
        url_key: "faq"
      }).index(0)
    }, ((function(_this) {
      return function(faq) {
        return React.createElement(Markdown, {
          "project": _this.props.project,
          "className": "column"
        }, ((faq != null ? faq.content : void 0) ? faq != null ? faq.content : void 0 : 'This project has no frequently asked questions yet.'));
      };
    })(this))));
  }
});


},{"../../components/promise-renderer":86,"../../lib/title-mixin":117,"markdownz":"markdownz","react":"react"}],193:[function(require,module,exports){
var Link, React, THREE_DAYS;

React = require('react');

Link = require('react-router').Link;

THREE_DAYS = 3 * 24 * 60 * 60 * 1000;

module.exports = React.createClass({displayName: "exports",
  getDefaultProps: function() {
    return {
      project: null,
      dismissFor: THREE_DAYS
    };
  },
  getInitialState: function() {
    return {
      projectIsComplete: false,
      hasResultsPage: false
    };
  },
  componentDidMount: function() {
    return this.refresh(this.props.project);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.project !== this.props.project) {
      return this.refresh(nextProps.project);
    }
  },
  refresh: function(project) {
    this.setState({
      projectIsComplete: false,
      hasResultsPage: false
    });
    return Promise.all([this.getCompleteness(project), this.getResultsPageExistence(project)]).then((function(_this) {
      return function(arg) {
        var hasResultsPage, projectIsComplete;
        projectIsComplete = arg[0], hasResultsPage = arg[1];
        return _this.setState({
          projectIsComplete: projectIsComplete,
          hasResultsPage: hasResultsPage
        });
      };
    })(this));
  },
  getCompleteness: function(project) {
    if (project.redirect) {
      return Promise.resolve(false);
    } else {
      return project.get('workflows').then(function(allWorkflows) {
        var activeUnfinishedWorkflows, activeWorkflows;
        activeWorkflows = allWorkflows.filter(function(workflow) {
          return workflow.active;
        });
        if (activeWorkflows.length === 0) {
          return false;
        } else {
          activeUnfinishedWorkflows = activeWorkflows.filter(function(workflow) {
            return workflow.finished_at == null;
          });
          return activeUnfinishedWorkflows.length === 0;
        }
      });
    }
  },
  getResultsPageExistence: function(project) {
    return project.get('pages').then(function(pages) {
      var resultsPages;
      resultsPages = pages.filter(function(page) {
        return page.url_key === 'result';
      });
      return resultsPages[0] != null;
    });
  },
  hide: function() {
    var dismissals, ref;
    dismissals = (ref = JSON.parse(localStorage.getItem('finished-project-dismissals'))) != null ? ref : {};
    dismissals[this.props.project.id] = Date.now();
    localStorage.setItem('finished-project-dismissals', JSON.stringify(dismissals));
    return this.forceUpdate();
  },
  render: function() {
    var dismissals, name, owner, recentlyDismissed, ref, ref1;
    dismissals = (ref = JSON.parse(localStorage.getItem('finished-project-dismissals'))) != null ? ref : {};
    recentlyDismissed = Date.now() - dismissals[this.props.project.id] < this.props.dismissFor;
    if (recentlyDismissed || !this.state.projectIsComplete) {
      return null;
    } else {
      return React.createElement("div", {
        "className": "successful project-announcement-banner"
      }, React.createElement("p", null, React.createElement("strong", null, "Great work!"), ' ', "Looks like this project is out of data at the moment!", React.createElement("br", null), (this.state.hasResultsPage ? ((ref1 = this.props.project.slug.split('/'), owner = ref1[0], name = ref1[1], ref1), React.createElement("strong", null, React.createElement(Link, {
        "to": "/projects/" + owner + "/" + name + "/results"
      }, "See the results"))) : void 0), ' ', React.createElement("small", null, "or", ' ', React.createElement("button", {
        "type": "button",
        "className": "secret-button",
        "onClick": this.hide
      }, React.createElement("u", null, "dismiss this message")))));
    }
  }
});


},{"react":"react","react-router":"react-router"}],194:[function(require,module,exports){
var FinishedBanner, HandlePropChanges, Link, Markdown, ProjectMetadata, PromiseRenderer, PromiseToSetState, React;

React = require('react');

Markdown = require('markdownz').Markdown;

HandlePropChanges = require('../../lib/handle-prop-changes');

PromiseToSetState = require('../../lib/promise-to-set-state');

PromiseRenderer = require('../../components/promise-renderer');

FinishedBanner = require('./finished-banner');

ProjectMetadata = require('./metadata');

Link = require('react-router').Link;

module.exports = React.createClass({
  displayName: 'ProjectHomePage',
  mixins: [HandlePropChanges, PromiseToSetState],
  propChangeHandlers: {
    project: function(project) {
      var workflows;
      if (project._workflows != null) {
        return this.setState({
          workflows: project._workflows
        });
      } else {
        workflows = project.get('workflows', {
          active: true
        });
        workflows.then((function(_this) {
          return function(workflows) {
            return project._workflows = workflows;
          };
        })(this));
        return this.promiseToSetState({
          workflows: workflows
        });
      }
    }
  },
  getInitialState: function() {
    return {
      workflows: []
    };
  },
  render: function() {
    var name, owner, ref, ref1, workflow;
    ref = this.props.project.slug.split('/'), owner = ref[0], name = ref[1];
    return React.createElement("div", {
      "className": "project-home-page"
    }, React.createElement("div", {
      "className": "call-to-action-container content-container"
    }, React.createElement(FinishedBanner, {
      "project": this.props.project
    }), React.createElement("div", {
      "className": "description"
    }, this.props.project.description), ((this.props.project.workflow_description != null) && this.props.project.workflow_description !== '' ? React.createElement("div", {
      "className": "workflow-description"
    }, this.props.project.workflow_description) : void 0), ((function() {
      var i, len, ref1, ref2, results;
      if (this.props.project.redirect) {
        return React.createElement("a", {
          "href": this.props.project.redirect,
          "className": "call-to-action standard-button"
        }, React.createElement("strong", null, "Visit the project"), React.createElement("br", null), React.createElement("small", null, "at ", this.props.project.redirect));
      } else if ((ref1 = this.props.project.configuration) != null ? ref1.user_chooses_workflow : void 0) {
        ref2 = this.state.workflows;
        results = [];
        for (i = 0, len = ref2.length; i < len; i++) {
          workflow = ref2[i];
          results.push(React.createElement(Link, {
            "to": "/projects/" + owner + "/" + name + "/classify?workflow=" + workflow.id,
            "key": workflow.id,
            "className": "call-to-action standard-button"
          }, workflow.display_name));
        }
        return results;
      } else {
        return React.createElement(Link, {
          "to": "/projects/" + owner + "/" + name + "/classify",
          "className": "call-to-action standard-button"
        }, "Get started!");
      }
    }).call(this))), React.createElement("hr", null), React.createElement("div", {
      "className": "introduction content-container"
    }, React.createElement("h3", {
      "className": "about-project"
    }, "About ", this.props.project.display_name), React.createElement(Markdown, {
      "project": this.props.project
    }, (ref1 = this.props.project.introduction) != null ? ref1 : '')), React.createElement(ProjectMetadata, {
      "project": this.props.project
    }));
  }
});


},{"../../components/promise-renderer":86,"../../lib/handle-prop-changes":104,"../../lib/promise-to-set-state":111,"./finished-banner":193,"./metadata":196,"markdownz":"markdownz","react":"react","react-router":"react-router"}],195:[function(require,module,exports){
var IndexLink, Link, Markdown, PotentialFieldGuide, ProjectPage, ProjectPageController, React, SOCIAL_ICONS, TitleMixin, Translate, apiClient, counterpart, ref, sugarClient,
  slice = [].slice;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

ref = require('react-router'), IndexLink = ref.IndexLink, Link = ref.Link;

Markdown = require('markdownz').Markdown;

PotentialFieldGuide = require('./potential-field-guide');

TitleMixin = require('../../lib/title-mixin');

apiClient = require('panoptes-client/lib/api-client');

sugarClient = require('panoptes-client/lib/sugar').sugarClient;

counterpart.registerTranslations('en', {
  project: {
    loading: 'Loading project',
    disclaimer: "This project has been built using the Zooniverse Project Builder but is not yet an official Zooniverse project. Queries and issues relating to this project directed at the Zooniverse Team may not receive any response.",
    nav: {
      research: 'Research',
      results: 'Results',
      classify: 'Classify',
      faq: 'FAQ',
      education: 'Education',
      talk: 'Talk'
    }
  }
});

SOCIAL_ICONS = {
  'bitbucket.com/': 'bitbucket',
  'facebook.com/': 'facebook-square',
  'github.com/': 'github',
  'pinterest.com/': 'pinterest',
  'plus.google.com/': 'google-plus',
  'reddit.com/': 'reddit',
  'tumblr.com/': 'tumblr',
  'twitter.com/': 'twitter',
  'vine.com/': 'vine',
  'weibo.com/': 'weibo',
  'wordpress.com/': 'wordpress',
  'youtu.be/': 'youtube',
  'youtube.com/': 'youtube'
};

ProjectPage = React.createClass({displayName: "ProjectPage",
  getDefaultProps: function() {
    return {
      project: null,
      owner: null
    };
  },
  getInitialState: function() {
    return {
      background: null,
      avatar: null,
      pages: []
    };
  },
  componentDidMount: function() {
    document.documentElement.classList.add('on-project-page');
    this.fetchInfo(this.props.project);
    return this.updateSugarSubscription(this.props.project);
  },
  componentWillUnmount: function() {
    document.documentElement.classList.remove('on-project-page');
    return this.updateSugarSubscription(null);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.project !== this.props.project) {
      this.fetchInfo(nextProps.project);
      return this.updateSugarSubscription(nextProps.project);
    }
  },
  fetchInfo: function(project) {
    this.setState({
      background: null,
      avatar: null,
      pages: []
    });
    project.get('background')["catch"]((function(_this) {
      return function() {
        return null;
      };
    })(this)).then((function(_this) {
      return function(background) {
        return _this.setState({
          background: background
        });
      };
    })(this));
    project.get('avatar')["catch"]((function(_this) {
      return function() {
        return null;
      };
    })(this)).then((function(_this) {
      return function(avatar) {
        return _this.setState({
          avatar: avatar
        });
      };
    })(this));
    return project.get('pages')["catch"]((function(_this) {
      return function() {
        return [];
      };
    })(this)).then((function(_this) {
      return function(pages) {
        return _this.setState({
          pages: pages
        });
      };
    })(this));
  },
  _lastSugarSubscribedID: null,
  updateSugarSubscription: function(project) {
    if (this._lastSugarSubscribedID != null) {
      sugarClient.unsubscribeFrom("project-" + this._lastSugarSubscribedID);
    }
    if (project != null) {
      return sugarClient.subscribeTo("project-" + project.id);
    }
  },
  redirectClassifyLink: function(redirect) {
    return (redirect.replace(/\/?#?\/+$/, "")) + "/#/classify";
  },
  render: function() {
    var pages, projectPath, ref1, ref2, ref3, ref4;
    projectPath = "/projects/" + this.props.project.slug;
    pages = [{}].concat(slice.call(this.state.pages)).reduce((function(_this) {
      return function(map, page) {
        map[page.url_key] = page;
        return map;
      };
    })(this));
    return React.createElement("div", {
      "className": "project-page"
    }, (this.state.background != null ? React.createElement("div", {
      "className": "project-background",
      "style": {
        backgroundImage: "url('" + this.state.background.src + "')"
      }
    }) : void 0), React.createElement("nav", {
      "className": "project-nav tabbed-content-tabs"
    }, (this.props.project.redirect ? React.createElement("a", {
      "href": this.props.project.redirect,
      "className": "tabbed-content-tab",
      "target": "_blank"
    }, (this.state.avatar != null ? React.createElement("img", {
      "src": this.state.avatar.src,
      "className": "avatar"
    }) : void 0), "Visit ", this.props.project.display_name) : React.createElement(IndexLink, {
      "to": "" + projectPath,
      "activeClassName": "active",
      "className": "tabbed-content-tab"
    }, (this.state.avatar != null ? React.createElement("img", {
      "src": this.state.avatar.src,
      "className": "avatar"
    }) : void 0), this.props.project.display_name)), (!this.props.project.redirect ? React.createElement(Link, {
      "to": projectPath + "/research",
      "activeClassName": "active",
      "className": "tabbed-content-tab"
    }, React.createElement(Translate, {
      "content": "project.nav.research"
    })) : void 0), (this.props.project.redirect ? React.createElement("a", {
      "href": this.redirectClassifyLink(this.props.project.redirect),
      "className": "tabbed-content-tab",
      "target": "_blank"
    }, React.createElement(Translate, {
      "content": "project.nav.classify"
    })) : React.createElement(Link, {
      "to": projectPath + "/classify",
      "activeClassName": "active",
      "className": "classify tabbed-content-tab"
    }, React.createElement(Translate, {
      "content": "project.nav.classify"
    }))), (!!((ref1 = pages.results) != null ? ref1.content : void 0) ? React.createElement(Link, {
      "to": projectPath + "/results",
      "activeClassName": "active",
      "className": "tabbed-content-tab"
    }, pages.results.title) : void 0), (!!((ref2 = pages.faq) != null ? ref2.content : void 0) ? React.createElement(Link, {
      "to": projectPath + "/faq",
      "activeClassName": "active",
      "className": "tabbed-content-tab"
    }, pages.faq.title) : void 0), (!!((ref3 = pages.education) != null ? ref3.content : void 0) ? React.createElement(Link, {
      "to": projectPath + "/education",
      "activeClassName": "active",
      "className": "tabbed-content-tab"
    }, pages.education.title) : void 0), React.createElement(Link, {
      "to": projectPath + "/talk",
      "activeClassName": "active",
      "className": "tabbed-content-tab"
    }, React.createElement(Translate, {
      "content": "project.nav.talk"
    })), this.props.project.urls.map((function(_this) {
      return function(arg, i) {
        var icon, iconForLabel, label, pattern, url;
        label = arg.label, url = arg.url;
        if (!label) {
          for (pattern in SOCIAL_ICONS) {
            icon = SOCIAL_ICONS[pattern];
            if (url.indexOf(pattern) !== -1) {
              iconForLabel = icon;
            }
          }
          if (iconForLabel == null) {
            iconForLabel = 'globe';
          }
          label = React.createElement("i", {
            "className": "fa fa-" + iconForLabel + " fa-fw fa-2x"
          });
        }
        return React.createElement("a", {
          "key": i,
          "href": url,
          "className": "tabbed-content-tab",
          "target": "" + _this.props.project.id + url
        }, label);
      };
    })(this))), (!!((ref4 = this.props.project.configuration) != null ? ref4.announcement : void 0) ? React.createElement("div", {
      "className": "informational project-announcement-banner"
    }, React.createElement(Markdown, null, this.props.project.configuration.announcement)) : void 0), React.cloneElement(this.props.children, {
      user: this.props.user,
      project: this.props.project,
      owner: this.props.owner
    }), (!(this.props.project.launch_approved || this.props.project.beta_approved) ? React.createElement(Translate, {
      "component": "p",
      "className": "project-disclaimer",
      "content": "project.disclaimer"
    }) : void 0), React.createElement(PotentialFieldGuide, {
      "project": this.props.project
    }));
  }
});

ProjectPageController = React.createClass({
  displayName: 'ProjectPageController',
  mixins: [TitleMixin],
  title: function() {
    var ref1, ref2;
    return (ref1 = (ref2 = this.state.project) != null ? ref2.display_name : void 0) != null ? ref1 : '(Loading)';
  },
  getDefaultProps: function() {
    return {
      params: {},
      user: null
    };
  },
  getInitialState: function() {
    return {
      loading: false,
      error: null,
      project: null,
      owner: null
    };
  },
  componentDidMount: function() {
    return this.fetchProject(this.props.params.owner, this.props.params.name);
  },
  componentWillReceiveProps: function(nextProps) {
    var name, owner, pathChanged, ref1, userChanged;
    ref1 = nextProps.params, owner = ref1.owner, name = ref1.name;
    pathChanged = owner !== this.props.params.owner || name !== this.props.params.name;
    userChanged = nextProps.user !== this.props.user;
    if (pathChanged || userChanged) {
      return this.fetchProject(owner, name);
    }
  },
  fetchProject: function(owner, name) {
    var query;
    this.setState({
      loading: true,
      error: null,
      project: null,
      owner: null
    });
    query = {
      slug: owner + '/' + name
    };
    return apiClient.type('projects').get(query).then((function(_this) {
      return function(arg) {
        var project;
        project = arg[0];
        _this.setState({
          project: project
        });
        return project.get('owner');
      };
    })(this)).then((function(_this) {
      return function(owner) {
        return _this.setState({
          owner: owner
        });
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          loading: false
        });
      };
    })(this));
  },
  render: function() {
    var slug;
    slug = this.props.params.owner + '/' + this.props.params.name;
    return React.createElement("div", {
      "className": "project-page-wrapper"
    }, (this.state.loading ? React.createElement("div", null, React.createElement("p", null, "Loading", ' ', React.createElement("strong", null, slug), "...")) : void 0), (this.state.error != null ? React.createElement("div", null, React.createElement("p", null, "There was an error retrieving the project", ' ', React.createElement("strong", null, slug), "."), React.createElement("p", null, React.createElement("code", null, this.state.error.stack))) : void 0), ((this.state.project != null) && (this.state.owner != null) ? React.createElement(ProjectPage, React.__spread({}, this.props, {
      "project": this.state.project,
      "owner": this.state.owner
    })) : void 0));
  }
});

module.exports = ProjectPageController;


},{"../../lib/title-mixin":117,"./potential-field-guide":197,"counterpart":"counterpart","markdownz":"markdownz","panoptes-client/lib/api-client":549,"panoptes-client/lib/sugar":552,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],196:[function(require,module,exports){
var React;

React = require('react');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'ProjectMetadata',
    propTypes: {
      project: React.PropTypes.object
    },
    render: function() {
      var project;
      project = this.props.project;
      return React.createElement("div", {
        "className": "project-metadata content-container"
      }, React.createElement("div", {
        "className": "project-metadata-header"
      }, React.createElement("span", null, project.display_name), ' ', React.createElement("span", null, "Statistics")), React.createElement("div", {
        "className": "project-metadata-stats"
      }, React.createElement("div", {
        "className": "project-metadata-stat"
      }, React.createElement("div", null, project.classifiers_count.toLocaleString()), React.createElement("div", null, "Registered Volunteers")), React.createElement("div", {
        "className": "project-metadata-stat"
      }, React.createElement("div", null, project.classifications_count.toLocaleString()), React.createElement("div", null, "Classifications")), React.createElement("div", {
        "className": "project-metadata-stat"
      }, React.createElement("div", null, project.subjects_count.toLocaleString()), React.createElement("div", null, "Subjects")), React.createElement("div", {
        "className": "project-metadata-stat"
      }, React.createElement("div", null, project.retired_subjects_count.toLocaleString()), React.createElement("div", null, "Retired Subjects"))));
    }
  });
}


},{"react":"react"}],197:[function(require,module,exports){
var FieldGuide, Pullout, React, apiClient;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

Pullout = require('react-pullout');

FieldGuide = require('../../components/field-guide');

module.exports = React.createClass({displayName: "exports",
  getDefaultProps: function() {
    return {
      project: null
    };
  },
  getInitialState: function() {
    return {
      guide: null,
      icons: {},
      revealed: true
    };
  },
  componentDidMount: function() {
    return this.fetchGuide(this.props.project);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.project !== this.props.project) {
      return this.fetchGuide(nextProps.project);
    }
  },
  fetchGuide: function(project) {
    this.setState({
      guide: null,
      icons: {},
      revealed: false
    });
    return apiClient.type('field_guides').get({
      project_id: project.id
    }).then((function(_this) {
      return function(arg) {
        var guide, ref;
        guide = arg[0];
        _this.setState({
          guide: guide
        });
        return guide != null ? (ref = guide.get('attached_images')) != null ? ref.then(function(images) {
          var i, icons, image, len;
          icons = {};
          for (i = 0, len = images.length; i < len; i++) {
            image = images[i];
            icons[image.id] = image;
          }
          return _this.setState({
            icons: icons
          });
        }) : void 0 : void 0;
      };
    })(this));
  },
  toggleFieldGuide: function() {
    return this.setState({
      revealed: !this.state.revealed
    });
  },
  render: function() {
    if ((this.state.guide != null) && this.state.guide.items.length !== 0) {
      return React.createElement(Pullout, {
        "className": "field-guide-pullout",
        "side": "right",
        "open": this.state.revealed
      }, React.createElement("button", {
        "type": "button",
        "className": "field-guide-pullout-toggle",
        "onClick": this.toggleFieldGuide
      }, React.createElement("strong", null, "Field guide")), React.createElement(FieldGuide, {
        "items": this.state.guide.items,
        "icons": this.state.icons,
        "onClickClose": this.toggleFieldGuide
      }));
    } else {
      return null;
    }
  }
});


},{"../../components/field-guide":71,"panoptes-client/lib/api-client":549,"react":"react","react-pullout":"react-pullout"}],198:[function(require,module,exports){
var Markdown, PromiseRenderer, React, TitleMixin, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

PromiseRenderer = require('../../components/promise-renderer');

Translate = require('react-translate-component');

TitleMixin = require('../../lib/title-mixin');

Markdown = require('markdownz').Markdown;

counterpart.registerTranslations('en', {
  projectRoles: {
    title: 'The team',
    owner: 'Owner',
    collaborator: 'Collaborator',
    translator: 'Translator',
    scientist: 'Researcher',
    moderator: 'Moderator',
    tester: 'Tester',
    expert: 'Expert'
  }
});

module.exports = React.createClass({
  displayName: 'ProjectScienceCasePage',
  mixins: [TitleMixin],
  title: 'Science case',
  render: function() {
    return React.createElement("div", {
      "className": "project-text-content content-container"
    }, React.createElement("div", {
      "className": "columns-container"
    }, React.createElement(PromiseRenderer, {
      "promise": this.props.project.get('pages', {
        url_key: "science_case"
      }).index(0)
    }, ((function(_this) {
      return function(science_case) {
        return React.createElement(Markdown, {
          "project": _this.props.project,
          "className": "column"
        }, ((science_case != null ? science_case.content : void 0) ? science_case != null ? science_case.content : void 0 : 'This project has no science case yet.'));
      };
    })(this))), React.createElement("hr", null), React.createElement("div", null, React.createElement(Translate, {
      "content": "projectRoles.title"
    }), React.createElement(PromiseRenderer, {
      "promise": this.props.project.get('project_roles')
    }, ((function(_this) {
      return function(projectRoles) {
        var projectRole;
        return React.createElement("div", null, (function() {
          var i, len, results;
          results = [];
          for (i = 0, len = projectRoles.length; i < len; i++) {
            projectRole = projectRoles[i];
            results.push((function(_this) {
              return function(projectRole) {
                return React.createElement(PromiseRenderer, {
                  "key": projectRole.id,
                  "promise": projectRole.get('owner')
                }, (function(user) {
                  var role;
                  return React.createElement("p", null, React.createElement("img", {
                    "src": user.avatar,
                    "className": "avatar"
                  }), ' ', user.display_name, ' ', (function() {
                    var j, len1, ref, results1;
                    ref = projectRole.roles;
                    results1 = [];
                    for (j = 0, len1 = ref.length; j < len1; j++) {
                      role = ref[j];
                      results1.push(React.createElement(Translate, {
                        "key": role,
                        "content": "projectRoles." + role,
                        "className": "project-role " + role
                      }));
                    }
                    return results1;
                  })());
                }));
              };
            })(this)(projectRole));
          }
          return results;
        }).call(_this));
      };
    })(this))))));
  }
});


},{"../../components/promise-renderer":86,"../../lib/title-mixin":117,"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],199:[function(require,module,exports){
var Markdown, PromiseRenderer, React, TitleMixin;

React = require('react');

TitleMixin = require('../../lib/title-mixin');

Markdown = require('markdownz').Markdown;

PromiseRenderer = require('../../components/promise-renderer');

module.exports = React.createClass({
  displayName: 'ProjectResultsPage',
  mixins: [TitleMixin],
  title: 'Results',
  render: function() {
    return React.createElement("div", {
      "className": "project-text-content content-container"
    }, React.createElement(PromiseRenderer, {
      "promise": this.props.project.get('pages', {
        url_key: 'results'
      }).index(0)
    }, ((function(_this) {
      return function(page) {
        return React.createElement(Markdown, {
          "project": _this.props.project,
          "className": "column"
        }, ((page != null ? page.content : void 0) ? page != null ? page.content : void 0 : 'This project has no results to report yet.'));
      };
    })(this))));
  }
});


},{"../../components/promise-renderer":86,"../../lib/title-mixin":117,"markdownz":"markdownz","react":"react"}],200:[function(require,module,exports){
var Link, React, TalkBreadcrumbs, TalkFootnote, TalkInit, TalkSearchInput, projectSection;

React = require('react');

Link = require('react-router').Link;

TalkInit = require('../../talk/init');

TalkBreadcrumbs = require('../../talk/breadcrumbs');

TalkSearchInput = require('../../talk/search-input');

projectSection = require('../../talk/lib/project-section');

TalkFootnote = require('../../talk/footnote');

module.exports = React.createClass({
  displayName: 'ProjectTalkPage',
  render: function() {
    var name, owner, ref;
    ref = this.props.project.slug.split('/'), owner = ref[0], name = ref[1];
    return React.createElement("div", {
      "className": "project-text-content talk project"
    }, React.createElement("div", {
      "className": "content-container"
    }, React.createElement("h1", {
      "className": "talk-main-link"
    }, React.createElement(Link, {
      "to": "/projects/" + owner + "/" + name + "/talk"
    }, this.props.project.display_name, " Talk")), React.createElement(TalkBreadcrumbs, React.__spread({}, this.props)), React.createElement(TalkSearchInput, React.__spread({}, this.props)), React.cloneElement(this.props.children, {
      section: projectSection(this.props.project),
      project: this.props.project,
      user: this.props.user
    }), React.createElement(TalkFootnote, null)));
  }
});


},{"../../talk/breadcrumbs":243,"../../talk/footnote":256,"../../talk/init":261,"../../talk/lib/project-section":276,"../../talk/search-input":297,"react":"react","react-router":"react-router"}],201:[function(require,module,exports){
var Filmstrip, Link, OwnedCardList, PROJECT_SORTS, ProjectFilteringInterface, ProjectsPage, React, Router, TitleMixin, apiClient, counterpart, ref;

counterpart = require('counterpart');

React = require('react');

TitleMixin = require('../lib/title-mixin');

apiClient = require('panoptes-client/lib/api-client');

OwnedCardList = require('../components/owned-card-list');

ref = require('react-router'), Link = ref.Link, Router = ref.Router;

Filmstrip = require('../components/filmstrip');

PROJECT_SORTS = require('../lib/project-sorts').PROJECT_SORTS;

ProjectFilteringInterface = require('../components/project-card-list').ProjectFilteringInterface;

counterpart.registerTranslations('en', {
  projectsPage: {
    title: 'All Projects',
    countMessage: 'Showing %(pageStart)s-%(pageEnd)s of %(count)s projects found.',
    button: 'Get Started',
    notFoundMessage: 'Sorry, no projects found.'
  }
});

ProjectsPage = React.createClass({
  displayName: 'ProjectsPage',
  title: 'Projects',
  mixins: [TitleMixin],
  contextTypes: {
    location: React.PropTypes.object,
    history: React.PropTypes.object
  },
  emptyPromise: {
    then: function() {},
    "catch": function() {}
  },
  getDefaultProps: function() {
    return {
      location: {
        query: {
          discipline: ProjectFilteringInterface.defaultProps.discipline,
          page: ProjectFilteringInterface.defaultProps.page,
          sort: ProjectFilteringInterface.defaultProps.sort
        }
      }
    };
  },
  updateQuery: function(newParams) {
    var key, newLocation, query, value;
    query = Object.assign({}, this.props.location.query, newParams);
    for (key in query) {
      value = query[key];
      if (value === '') {
        delete query[key];
      }
    }
    newLocation = Object.assign({}, this.props.location, {
      query: query
    });
    newLocation.search = "";
    return this.props.history.replace(newLocation);
  },
  render: function() {
    var discipline, listingProps, page, ref1, sort;
    ref1 = this.props.location.query, discipline = ref1.discipline, page = ref1.page, sort = ref1.sort;
    listingProps = {
      discipline: discipline,
      page: page,
      sort: sort
    };
    return React.createElement(ProjectFilteringInterface, React.__spread({}, listingProps, {
      "onChangeQuery": this.updateQuery
    }));
  }
});

module.exports = ProjectsPage;


},{"../components/filmstrip":73,"../components/owned-card-list":82,"../components/project-card-list":84,"../lib/project-sorts":110,"../lib/title-mixin":117,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],202:[function(require,module,exports){
var LoginDialog, React, alert, auth;

React = require('react');

auth = require('panoptes-client/lib/auth');

alert = require('../lib/alert');

LoginDialog = require('../partials/login-dialog');

module.exports = React.createClass({
  displayName: 'ResetPasswordPage',
  getDefaultProps: function() {
    return {
      query: {}
    };
  },
  getInitialState: function() {
    return {
      inProgress: false,
      resetSuccess: false,
      resetError: null,
      emailSuccess: false,
      emailError: false,
      emailIsValid: false
    };
  },
  componentDidMount: function() {
    return this.handleEmailChange();
  },
  handleResetSubmit: function(e) {
    var confirmation, password, token;
    e.preventDefault();
    this.setState({
      inProgress: true,
      resetSuccess: false,
      resetError: null
    });
    token = this.props.location.query.reset_password_token;
    password = this.refs.password.value;
    confirmation = this.refs.confirmation.value;
    return auth.resetPassword({
      password: password,
      confirmation: confirmation,
      token: token
    }).then((function(_this) {
      return function() {
        _this.setState({
          resetSuccess: true
        });
        alert(function(resolve) {
          return React.createElement(LoginDialog, {
            "onSuccess": ((function(_this) {
              return function() {
                location.hash = '/';
                return resolve();
              };
            })(this))
          });
        });
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          resetError: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          inProgress: false
        });
      };
    })(this));
  },
  handleEmailChange: function() {
    var ref;
    return this.setState({
      emailIsValid: (ref = this.refs.email) != null ? ref.checkValidity() : void 0
    });
  },
  handleEmailSubmit: function(e) {
    var email;
    e.preventDefault();
    this.setState({
      inProgress: true,
      emailSuccess: false,
      emailError: false
    });
    email = this.refs.email.value;
    return auth.requestPasswordReset({
      email: email
    }).then((function(_this) {
      return function() {
        return _this.setState({
          emailSuccess: true
        });
      };
    })(this))["catch"]((function(_this) {
      return function() {
        return _this.setState({
          emailError: true
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          inProgress: false
        });
      };
    })(this));
  },
  render: function() {
    var ref, ref1;
    return React.createElement("div", {
      "className": "centered-grid"
    }, (((ref = this.props.location.query) != null ? ref.reset_password_token : void 0) != null ? this.state.resetSuccess ? React.createElement("p", null, "You have successfully reset your password, please login to get started.") : React.createElement("form", {
      "method": "POST",
      "onSubmit": this.handleResetSubmit
    }, React.createElement("p", null, "Go ahead and enter a new password, then you can get back to doing some research."), React.createElement("p", null, "New password:", React.createElement("br", null), React.createElement("input", {
      "ref": "password",
      "type": "password",
      "className": "standard-input",
      "size": "20"
    })), React.createElement("p", null, "Again, to confirm:", React.createElement("br", null), React.createElement("input", {
      "ref": "confirmation",
      "type": "password",
      "className": "standard-input",
      "size": "20"
    })), React.createElement("p", null, React.createElement("button", {
      "type": "submit",
      "className": "standard-button",
      "disabled": this.state.resetError || this.state.resetSuccess
    }, "Submit"), ' ', (this.state.inProgress ? React.createElement("i", {
      "className": "fa fa-spinner fa-spin form-help"
    }) : this.state.resetSuccess ? React.createElement("i", {
      "className": "fa fa-check-circle form-help success"
    }) : this.state.resetError != null ? React.createElement("small", {
      "className": "form-help error"
    }, "Something went wrong, please try and reset your password via email again. ", this.state.resetError.toString()) : void 0))) : React.createElement("form", {
      "onSubmit": this.handleEmailSubmit
    }, React.createElement("p", null, React.createElement("strong", null, "So, youve forgotten your password.")), React.createElement("p", null, "It happens to the best of us. Just enter your email address here and well send you a link you can follow to reset it."), React.createElement("p", null, React.createElement("input", {
      "ref": "email",
      "type": "email",
      "required": true,
      "onChange": this.handleEmailChange,
      "className": "standard-input",
      "defaultValue": ((ref1 = this.props.location.query) != null ? ref1.email : void 0),
      "size": "50"
    })), React.createElement("p", null, React.createElement("button", {
      "type": "submit",
      "className": "standard-button",
      "disabled": !this.state.emailIsValid
    }, "Submit"), ' ', (this.state.inProgress ? React.createElement("i", {
      "className": "fa fa-spinner fa-spin form-help"
    }) : this.state.emailSuccess ? React.createElement("i", {
      "className": "fa fa-check-circle form-help success"
    }) : void 0)), (this.state.emailSuccess ? React.createElement("p", null, "Weve just sent you an email with a link to reset your password.") : this.state.emailError ? React.createElement("small", {
      "className": "form-help error"
    }, "There was an error reseting your password.") : void 0))));
  }
});


},{"../lib/alert":98,"../partials/login-dialog":219,"panoptes-client/lib/auth":550,"react":"react"}],203:[function(require,module,exports){
var Markdown, React, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Markdown = require('markdownz').Markdown;

Translate = require('react-translate-component');

counterpart.registerTranslations('en', {
  security: {
    title: 'Zooniverse Security',
    securityIntro: 'The Zooniverse takes very seriously the security of our websites and systems, and protecting our users and their personal information is our highest priority. We take every precaution to ensure that the information you give us stays secure, but it is also important that you take steps to secure your own account, including:\n\n* Do not use the same password on different websites. The password you use for your Zooniverse account should be unique to us.\n* Never give your password to anyone. We will never ask you to send us your password, and you should never enter your Zooniverse password into any website other than ours. Always check your browser\'s address bar to make sure you have a secure connection to _www.zooniverse.org_.\n\nFor general advice and information about staying safe online, please visit:\n\n* [Get Safe Online](https://www.getsafeonline.org)\n* [Stay Safe Online](https://www.staysafeonline.org)\n* [US-CERT - Tips](https://www.us-cert.gov/ncas/tips)',
    securityDetails: '## Reporting Security Issues\n\nThe Zooniverse supports [responsible disclosure](https://en.wikipedia.org/wiki/Responsible_disclosure) of vulnerabilities. If you believe you have discovered a security vulnerability in any Zooniverse software, we ask that this first be reported to [security@zooniverse.org](mailto:security@zooniverse.org) to allow time for vulnerabilities to be fixed before details are published.\n\n## Known Vulnerabilities and Incidents\n\nWe believe it is important to be completely transparent about security issues. A complete list of fixed vulnerabilities and past security incidents is given below:\n\n* _(No entries at this time)_\n\nNew vulnerabilities and incidents will be announced via the [Zooniverse blog in the "technical" category](http://blog.zooniverse.org/category/technical/).'
  }
});

module.exports = React.createClass({
  displayName: 'SecurityPage',
  componentDidMount: function() {
    return counterpart.onLocaleChange(this.handleLocaleChange);
  },
  componentWillUnmount: function() {
    return counterpart.offLocaleChange(this.handleLocaleChange);
  },
  handleLocaleChange: function() {
    return this.forceUpdate();
  },
  render: function() {
    return React.createElement("div", {
      "className": "content-container"
    }, React.createElement(Translate, {
      "component": "h1",
      "content": "security.title"
    }), React.createElement("div", {
      "className": "columns-container"
    }, React.createElement(Markdown, {
      "className": "column"
    }, counterpart('security.securityIntro')), React.createElement(Markdown, {
      "className": "column"
    }, counterpart('security.securityDetails'))));
  }
});


},{"counterpart":"counterpart","markdownz":"markdownz","react":"react","react-translate-component":"react-translate-component"}],204:[function(require,module,exports){
var AutoSave, ChangePasswordForm, MIN_PASSWORD_LENGTH, React, auth, handleInputChange;

React = require('react');

AutoSave = require('../../components/auto-save');

handleInputChange = require('../../lib/handle-input-change');

auth = require('panoptes-client/lib/auth');

MIN_PASSWORD_LENGTH = 8;

ChangePasswordForm = React.createClass({
  displayName: 'ChangePasswordForm',
  getDefaultProps: function() {
    return {
      user: {}
    };
  },
  getInitialState: function() {
    return {
      old: '',
      "new": '',
      confirmation: '',
      inProgress: false,
      success: false,
      error: null
    };
  },
  render: function() {
    return React.createElement("form", {
      "ref": "form",
      "method": "POST",
      "onSubmit": this.handleSubmit
    }, React.createElement("p", null, React.createElement("strong", null, "Change your password")), React.createElement("table", {
      "className": "standard-table"
    }, React.createElement("tbody", null, React.createElement("tr", null, React.createElement("td", null, "Current password"), React.createElement("td", null, React.createElement("input", {
      "type": "password",
      "className": "standard-input",
      "size": "20",
      "onChange": ((function(_this) {
        return function(e) {
          return _this.setState({
            old: e.target.value
          });
        };
      })(this))
    }))), React.createElement("tr", null, React.createElement("td", null, "New password"), React.createElement("td", null, React.createElement("input", {
      "type": "password",
      "className": "standard-input",
      "size": "20",
      "onChange": ((function(_this) {
        return function(e) {
          return _this.setState({
            "new": e.target.value
          });
        };
      })(this))
    }), (this.state["new"].length !== 0 && this.tooShort() ? React.createElement("small", {
      "className": "form-help error"
    }, "Thats too short") : void 0))), React.createElement("tr", null, React.createElement("td", null, "Confirm new password"), React.createElement("td", null, React.createElement("input", {
      "type": "password",
      "className": "standard-input",
      "size": "20",
      "onChange": ((function(_this) {
        return function(e) {
          return _this.setState({
            confirmation: e.target.value
          });
        };
      })(this))
    }), (this.state.confirmation.length >= this.state["new"].length - 1 && this.doesntMatch() ? React.createElement("small", {
      "className": "form-help error"
    }, "These dont match") : void 0))))), React.createElement("p", null, React.createElement("button", {
      "type": "submit",
      "className": "standard-button",
      "disabled": !this.state.old || !this.state["new"] || this.tooShort() || this.doesntMatch() || this.state.inProgress
    }, "Change"), ' ', (this.state.inProgress ? React.createElement("i", {
      "className": "fa fa-spinner fa-spin form-help"
    }) : this.state.success ? React.createElement("i", {
      "className": "fa fa-check-circle form-help success"
    }) : this.state.error ? React.createElement("small", {
      "className": "form-help error"
    }, this.state.error.toString()) : void 0)));
  },
  tooShort: function() {
    return this.state["new"].length < MIN_PASSWORD_LENGTH;
  },
  doesntMatch: function() {
    return this.state["new"] !== this.state.confirmation;
  },
  handleSubmit: function(e) {
    var current, replacement;
    e.preventDefault();
    current = this.state.old;
    replacement = this.state["new"];
    this.setState({
      inProgress: true,
      success: false,
      error: null
    });
    return auth.changePassword({
      current: current,
      replacement: replacement
    }).then((function(_this) {
      return function() {
        _this.setState({
          success: true
        });
        return _this.refs.form.reset();
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          inProgress: false
        });
      };
    })(this));
  }
});

module.exports = React.createClass({
  displayName: "AccountInformationPage",
  render: function() {
    return React.createElement("div", {
      "className": "account-information-tab"
    }, React.createElement("div", {
      "className": "columns-container"
    }, React.createElement("div", {
      "className": "content-container column"
    }, React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.user
    }, React.createElement("span", {
      "className": "form-label"
    }, "Display name"), React.createElement("br", null), React.createElement("input", {
      "type": "text",
      "className": "standard-input full",
      "name": "display_name",
      "value": this.props.user.display_name,
      "onChange": handleInputChange.bind(this.props.user)
    })), React.createElement("span", {
      "className": "form-help"
    }, "How your name will appear to other users in Talk and on your Profile Page"), React.createElement("br", null), React.createElement(AutoSave, {
      "resource": this.props.user
    }, React.createElement("span", {
      "className": "form-label"
    }, "Credited name"), React.createElement("br", null), React.createElement("input", {
      "type": "text",
      "className": "standard-input full",
      "name": "credited_name",
      "value": this.props.user.credited_name,
      "onChange": handleInputChange.bind(this.props.user)
    })), React.createElement("span", {
      "className": "form-help"
    }, "Public; well use this to give acknowledgement in papers, on posters, etc.")))), React.createElement("hr", null), React.createElement("div", {
      "className": "content-container"
    }, React.createElement(ChangePasswordForm, React.__spread({}, this.props))));
  }
});


},{"../../components/auto-save":62,"../../lib/handle-input-change":103,"panoptes-client/lib/auth":550,"react":"react"}],205:[function(require,module,exports){
var AutoSave, ChangeListener, PromiseRenderer, React, handleInputChange, talkClient,
  slice = [].slice;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

AutoSave = require('../../components/auto-save');

PromiseRenderer = require('../../components/promise-renderer');

ChangeListener = require('../../components/change-listener');

handleInputChange = require('../../lib/handle-input-change');

module.exports = React.createClass({
  displayName: 'EmailSettingsPage',
  getDefaultProps: function() {
    return {
      user: null
    };
  },
  getInitialState: function() {
    return {
      page: 1
    };
  },
  nameOfPreference: function(preference) {
    switch (preference.category) {
      case 'participating_discussions':
        return "When discussions I'm participating in are updated";
      case 'followed_discussions':
        return "When discussions I'm following are updated";
      case 'mentions':
        return "When I'm mentioned";
      case 'group_mentions':
        return "When I'm mentioned by group (@admins, @team, etc)";
      case 'messages':
        return 'When I receive a private message';
      case 'started_discussions':
        return "When a discussion is started in a board I'm following";
    }
  },
  sortPreferences: function(preferences) {
    var order;
    order = ['participating_discussions', 'followed_discussions', 'started_discussions', 'mentions', 'group_mentions', 'messages'];
    return preferences.sort(function(a, b) {
      return order.indexOf(a.category) > order.indexOf(b.category);
    });
  },
  handlePreferenceChange: function(preference, event) {
    return preference.update({
      email_digest: event.target.value
    }).save();
  },
  talkPreferenceOption: function(preference, digest) {
    return React.createElement("td", {
      "className": "option"
    }, React.createElement("input", {
      "type": "radio",
      "name": preference.category,
      "value": digest,
      "checked": preference.email_digest === digest,
      "onChange": this.handlePreferenceChange.bind(this, preference)
    }));
  },
  render: function() {
    return React.createElement("div", {
      "className": "content-container"
    }, React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.user
    }, React.createElement("span", {
      "className": "form-label"
    }, "Email address"), React.createElement("br", null), React.createElement("input", {
      "type": "text",
      "className": "standard-input full",
      "name": "email",
      "value": this.props.user.email,
      "onChange": handleInputChange.bind(this.props.user)
    }))), React.createElement("p", null, React.createElement("strong", null, "Zooniverse email preferences")), React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.user
    }, React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "name": "global_email_communication",
      "checked": this.props.user.global_email_communication,
      "onChange": handleInputChange.bind(this.props.user)
    }), ' ', "Get general Zooniverse email updates")), React.createElement("br", null), React.createElement(AutoSave, {
      "resource": this.props.user
    }, React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "name": "project_email_communication",
      "checked": this.props.user.project_email_communication,
      "onChange": handleInputChange.bind(this.props.user)
    }), ' ', "Get email updates from the Projects you classify on")), React.createElement("br", null), React.createElement(AutoSave, {
      "resource": this.props.user
    }, React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "name": "beta_email_communication",
      "checked": this.props.user.beta_email_communication,
      "onChange": handleInputChange.bind(this.props.user)
    }), ' ', "Get beta project email updates"))), React.createElement("p", null, React.createElement("strong", null, "Talk email preferences")), React.createElement("table", {
      "className": "talk-email-preferences"
    }, React.createElement("thead", null, React.createElement("tr", null, React.createElement("th", null, "Send me an email"), React.createElement("th", null, "Immediately"), React.createElement("th", null, "Daily"), React.createElement("th", null, "Weekly"), React.createElement("th", null, "Never"))), React.createElement(PromiseRenderer, {
      "promise": talkClient.type('subscription_preferences').get(),
      "pending": (function() {
        return React.createElement("tbody", null);
      }),
      "then": ((function(_this) {
        return function(preferences) {
          var preference;
          return React.createElement("tbody", null, (function() {
            var i, len, ref, results;
            ref = this.sortPreferences(preferences);
            results = [];
            for (i = 0, len = ref.length; i < len; i++) {
              preference = ref[i];
              if (preference.category !== 'system' && preference.category !== 'moderation_reports') {
                results.push((function(_this) {
                  return function(preference) {
                    return React.createElement(ChangeListener, {
                      "key": preference.id,
                      "target": preference,
                      "handler": (function() {
                        return React.createElement("tr", null, React.createElement("td", null, _this.nameOfPreference(preference)), _this.talkPreferenceOption(preference, 'immediate'), _this.talkPreferenceOption(preference, 'daily'), _this.talkPreferenceOption(preference, 'weekly'), _this.talkPreferenceOption(preference, 'never'));
                      })
                    });
                  };
                })(this)(preference));
              }
            }
            return results;
          }).call(_this));
        };
      })(this))
    })), React.createElement("p", null, React.createElement("strong", null, "Project email preferences")), React.createElement("table", null, React.createElement("thead", null, React.createElement("tr", null, React.createElement("th", null, React.createElement("i", {
      "className": "fa fa-envelope-o fa-fw"
    })), React.createElement("th", null, "Project"))), React.createElement(PromiseRenderer, {
      "promise": this.props.user.get('project_preferences', {
        page: this.state.page
      }),
      "pending": ((function(_this) {
        return function() {
          return React.createElement("tbody", null);
        };
      })(this)),
      "then": ((function(_this) {
        return function(projectPreferences) {
          var meta, p, projectPreference;
          meta = projectPreferences[0].getMeta();
          return React.createElement("tbody", null, (function() {
            var i, len, results;
            results = [];
            for (i = 0, len = projectPreferences.length; i < len; i++) {
              projectPreference = projectPreferences[i];
              results.push((function(_this) {
                return function(projectPreference) {
                  return React.createElement(PromiseRenderer, {
                    "key": projectPreference.id,
                    "promise": projectPreference.get('project'),
                    "then": (function(project) {
                      return React.createElement(ChangeListener, {
                        "target": projectPreference,
                        "handler": (function() {
                          return React.createElement("tr", null, React.createElement("td", null, React.createElement("input", {
                            "type": "checkbox",
                            "name": "email_communication",
                            "checked": projectPreference.email_communication,
                            "onChange": _this.handleProjectEmailChange.bind(_this, projectPreference)
                          })), React.createElement("td", null, project.display_name));
                        })
                      });
                    })
                  });
                };
              })(this)(projectPreference));
            }
            return results;
          }).call(_this), React.createElement("tr", null, React.createElement("td", {
            "colSpan": "2"
          }, (meta != null ? React.createElement("nav", {
            "className": "pagination"
          }, "Page ", React.createElement("select", {
            "value": _this.state.page,
            "disabled": meta.page_count < 2,
            "onChange": (function(e) {
              return _this.setState({
                page: e.target.value
              });
            })
          }, (function() {
            var i, ref, results;
            results = [];
            for (p = i = 1, ref = meta.page_count; 1 <= ref ? i <= ref : i >= ref; p = 1 <= ref ? ++i : --i) {
              results.push(React.createElement("option", {
                "key": p,
                "value": p
              }, p));
            }
            return results;
          })()), " of ", meta.page_count || '?') : void 0))));
        };
      })(this))
    })));
  },
  handleProjectEmailChange: function() {
    var args, projectPreference;
    projectPreference = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];
    handleInputChange.apply(projectPreference, args);
    return projectPreference.save();
  }
});


},{"../../components/auto-save":62,"../../components/change-listener":63,"../../components/promise-renderer":86,"../../lib/handle-input-change":103,"panoptes-client/lib/talk-client":553,"react":"react"}],206:[function(require,module,exports){
var ChangeListener, IndexLink, Link, React, Translate, UserSettingsPage, counterpart, ref;

React = require('react');

counterpart = require('counterpart');

Translate = require('react-translate-component');

ChangeListener = require('../../components/change-listener');

ref = require('react-router'), Link = ref.Link, IndexLink = ref.IndexLink;

counterpart.registerTranslations('en', {
  userSettingsPage: {
    header: "Settings",
    nav: {
      accountInformation: "Account Information",
      customizeProfile: "Customize Profile",
      email: "Email"
    }
  }
});

UserSettingsPage = React.createClass({
  displayName: 'UserSettingsPage',
  getInitialState: function() {
    return {
      activeTab: "account-information"
    };
  },
  render: function() {
    return React.createElement("section", {
      "className": "user-profile-content"
    }, React.createElement("div", {
      "className": "secondary-page settings-page"
    }, React.createElement("h2", null, React.createElement(Translate, {
      "content": "userSettingsPage.header"
    })), React.createElement("div", {
      "className": "settings-content"
    }, React.createElement("aside", {
      "className": "secondary-page-side-bar settings-side-bar"
    }, React.createElement("nav", null, React.createElement(IndexLink, {
      "to": "/settings",
      "type": "button",
      "activeClassName": "active",
      "className": "secret-button settings-button"
    }, React.createElement(Translate, {
      "content": "userSettingsPage.nav.accountInformation"
    })), React.createElement(Link, {
      "to": "/settings/profile",
      "type": "button",
      "activeClassName": "active",
      "className": "secret-button settings-button"
    }, React.createElement(Translate, {
      "content": "userSettingsPage.nav.customizeProfile"
    })), React.createElement(Link, {
      "to": "/settings/email",
      "type": "button",
      "activeClassName": "active",
      "className": "secret-button settings-button"
    }, React.createElement(Translate, {
      "content": "userSettingsPage.nav.email"
    })))), React.createElement("section", {
      "className": "settings-tab-content"
    }, React.cloneElement(this.props.children, this.props)))));
  }
});

module.exports = React.createClass({
  displayName: 'UserSettingsPageWrapper',
  render: function() {
    return React.createElement("div", null, (this.props.user != null ? React.createElement(ChangeListener, {
      "target": this.props.user
    }, ((function(_this) {
      return function() {
        return React.createElement(UserSettingsPage, React.__spread({}, _this.props, {
          "user": _this.props.user
        }));
      };
    })(this))) : React.createElement("div", {
      "className": "content-container"
    }, React.createElement("p", null, "Youre not signed in."))));
  }
});


},{"../../components/change-listener":63,"counterpart":"counterpart","react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],207:[function(require,module,exports){
var ImageSelector, MAX_AVATAR_SIZE, MAX_HEADER_SIZE, PromiseRenderer, React, apiClient, putFile;

React = require('react');

PromiseRenderer = require('../../components/promise-renderer');

ImageSelector = require('../../components/image-selector');

apiClient = require('panoptes-client/lib/api-client');

putFile = require('../../lib/put-file');

MAX_AVATAR_SIZE = 65536;

MAX_HEADER_SIZE = 256000;

module.exports = React.createClass({
  displayName: 'CustomizeProfilePage',
  getDefaultProps: function() {
    return {
      user: null
    };
  },
  getInitialState: function() {
    return {
      avatarError: null,
      headerError: null
    };
  },
  render: function() {
    if (this.avatarGet == null) {
      this.avatarGet = this.props.user.get('avatar', {}).then(function(arg) {
        var avatar;
        avatar = arg[0];
        return avatar;
      })["catch"](function() {
        return null;
      });
    }
    if (this.profile_headerGet == null) {
      this.profile_headerGet = this.props.user.get('profile_header', {}).then(function(arg) {
        var header;
        header = arg[0];
        return header;
      })["catch"](function() {
        return null;
      });
    }
    return React.createElement("div", null, React.createElement("div", {
      "className": "content-container"
    }, React.createElement("h3", null, "Change avatar"), React.createElement(PromiseRenderer, {
      "promise": this.avatarGet
    }, ((function(_this) {
      return function(avatar) {
        var placeholder;
        placeholder = React.createElement("p", {
          "className": "content-container"
        }, "Drop an image here (or click to select).");
        return React.createElement("div", null, React.createElement("p", {
          "className": "form-help"
        }, "Drop an image here (square, less than ", Math.floor(MAX_AVATAR_SIZE / 1000), " KB)"), React.createElement("div", {
          "style": {
            width: '20vw'
          }
        }, React.createElement(ImageSelector, {
          "maxSize": MAX_AVATAR_SIZE,
          "ratio": 1.,
          "src": (avatar != null ? avatar.src : void 0),
          "placeholder": placeholder,
          "onChange": _this.handleMediaChange.bind(_this, 'avatar')
        })), React.createElement("div", null, React.createElement("button", {
          "type": "button",
          "disabled": avatar === null,
          "onClick": _this.handleMediaClear.bind(_this, 'avatar')
        }, "Clear avatar")));
      };
    })(this))), (this.state.avatarError ? React.createElement("div", {
      "className": "form-help error"
    }, this.state.avatarError.toString()) : void 0)), React.createElement("hr", null), React.createElement("div", {
      "className": "content-container"
    }, React.createElement("h3", null, "Change profile header"), React.createElement(PromiseRenderer, {
      "promise": this.profile_headerGet
    }, ((function(_this) {
      return function(header) {
        var placeholder;
        placeholder = React.createElement("p", {
          "className": "content-container"
        }, "Drop an image here (or click to select).");
        return React.createElement("div", null, React.createElement("p", {
          "className": "form-help"
        }, "Drop an image here (any dimensions, less than ", Math.floor(MAX_HEADER_SIZE / 1000), " KB)"), React.createElement("div", {
          "style": {
            width: '40vw'
          }
        }, React.createElement(ImageSelector, {
          "maxSize": MAX_HEADER_SIZE,
          "src": (header != null ? header.src : void 0),
          "placeholder": placeholder,
          "onChange": _this.handleMediaChange.bind(_this, 'profile_header')
        })), React.createElement("div", null, React.createElement("button", {
          "type": "button",
          "disabled": header === null,
          "onClick": _this.handleMediaClear.bind(_this, 'profile_header')
        }, "Clear header")));
      };
    })(this))), (this.state.headerError ? React.createElement("div", {
      "className": "form-help error"
    }, this.state.headerError.toString()) : void 0)));
  },
  handleMediaChange: function(type, file) {
    var errorProp, newState;
    errorProp = type + "Error";
    newState = {};
    newState[errorProp] = null;
    this.setState(newState);
    return apiClient.post(this.props.user._getURL(type), {
      media: {
        content_type: file.type
      }
    }).then((function(_this) {
      return function(arg) {
        var resource;
        resource = arg[0];
        return putFile(resource.src, file, {
          'Content-Type': file.type
        });
      };
    })(this)).then((function(_this) {
      return function() {
        _this[type + "Get"] = null;
        return _this.forceUpdate();
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        newState = {};
        newState[errorProp] = error;
        return _this.setState(newState);
      };
    })(this));
  },
  handleMediaClear: function(type) {
    var errorProp, newState;
    errorProp = type + "Error";
    newState = {};
    newState[errorProp] = null;
    this.setState(newState);
    return this[type + "Get"].then((function(_this) {
      return function(resource) {
        return resource != null ? resource["delete"]() : void 0;
      };
    })(this)).then((function(_this) {
      return function() {
        _this[type + "Get"] = null;
        return _this.forceUpdate();
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        newState = {};
        newState[errorProp] = error;
        return _this.setState(newState);
      };
    })(this));
  }
});


},{"../../components/image-selector":76,"../../components/promise-renderer":86,"../../lib/put-file":112,"panoptes-client/lib/api-client":549,"react":"react"}],208:[function(require,module,exports){
var Link, React, TitleMixin, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

TitleMixin = require('../lib/title-mixin');

Translate = require('react-translate-component');

Link = require('react-router').Link;

counterpart.registerTranslations('en', {
  signIn: {
    withZooniverse: 'Sign in with your Zooniverse account',
    whyHaveAccount: 'Signed-in volunteers can keep track of their work and will be credited in any resulting publications.',
    signIn: 'Sign in',
    register: 'Register',
    orThirdParty: 'Or sign in with another service',
    withFacebook: 'Sign in with Facebook',
    withTwitter: 'Sign in with Twitter',
    withGoogle: 'Sign in with Google'
  }
});

module.exports = React.createClass({
  displayName: 'SignInPage',
  mixins: [TitleMixin],
  title: 'Sign in/register',
  render: function() {
    return React.createElement("div", {
      "className": "sign-in-page content-container"
    }, React.createElement(Translate, {
      "component": "h1",
      "content": "signIn.withZooniverse"
    }), React.createElement(Translate, {
      "component": "p",
      "content": "signIn.whyHaveAccount"
    }), React.createElement("div", {
      "className": "columns-container"
    }, React.createElement("div", {
      "className": "tabbed-content column",
      "data-side": "top"
    }, React.createElement("nav", {
      "className": "tabbed-content-tabs"
    }, React.createElement(Link, {
      "to": "/accounts/sign-in",
      "className": "tabbed-content-tab"
    }, React.createElement(Translate, {
      "content": "signIn.signIn"
    })), React.createElement(Link, {
      "to": "/accounts/register",
      "className": "tabbed-content-tab"
    }, React.createElement(Translate, {
      "content": "signIn.register"
    }))), this.props.children), React.createElement("hr", null), React.createElement("div", {
      "className": "oauth-providers"
    }, React.createElement(Translate, {
      "content": "signIn.orThirdParty"
    }), React.createElement("br", null), React.createElement("div", null, React.createElement("button", null, React.createElement(Translate, {
      "content": "signIn.withFacebook"
    }))), React.createElement("div", null, React.createElement("button", null, React.createElement(Translate, {
      "content": "signIn.withTwitter"
    }))), React.createElement("div", null, React.createElement("button", null, React.createElement(Translate, {
      "content": "signIn.withGoogle"
    }))))));
  }
});


},{"../lib/title-mixin":117,"counterpart":"counterpart","react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],209:[function(require,module,exports){
var LoginDialog, React, alert, auth;

React = require('react');

auth = require('panoptes-client/lib/auth');

alert = require('../lib/alert');

LoginDialog = require('../partials/login-dialog');

module.exports = React.createClass({
  displayName: 'UnsubscribeFromEmailsPage',
  getDefaultProps: function() {
    return {
      location: {
        query: {}
      }
    };
  },
  getInitialState: function() {
    return {
      inProgress: false,
      resetSuccess: false,
      resetError: null,
      emailSuccess: false,
      emailError: false,
      emailIsValid: false
    };
  },
  componentDidMount: function() {
    return this.handleEmailChange();
  },
  handleEmailChange: function() {
    return this.setState({
      emailIsValid: this.refs.email.checkValidity()
    });
  },
  handleEmailSubmit: function(e) {
    var email;
    e.preventDefault();
    this.setState({
      inProgress: true,
      emailSuccess: false,
      emailError: false
    });
    email = this.refs.email.value;
    return auth.unsubscribeEmail({
      email: email
    }).then((function(_this) {
      return function() {
        return _this.setState({
          emailSuccess: true
        });
      };
    })(this))["catch"]((function(_this) {
      return function() {
        return _this.setState({
          emailError: true
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          inProgress: false
        });
      };
    })(this));
  },
  render: function() {
    var ref, ref1;
    return React.createElement("div", {
      "className": "centered-grid"
    }, (((ref = this.props.location.query) != null ? ref.processed : void 0) ? React.createElement("div", null, React.createElement("p", null, React.createElement("strong", null, "Your unsubscribe request was successfully processed.")), React.createElement("p", null, "If you change your mind, just visit your ", React.createElement("a", {
      "href": (document.baseURI.slice(0, -1)) + "/settings"
    }, "account settings"), " page to update your email preferences.")) : React.createElement("form", {
      "onSubmit": this.handleEmailSubmit
    }, React.createElement("p", null, React.createElement("strong", null, "Unsubscribe from all Zooniverse emails.")), React.createElement("p", null, "We get it - no one likes to keep receiving email they don\'t want."), React.createElement("p", null, "Just enter your email address here and we\'ll ", React.createElement("b", null, "unsubscribe you from all"), " our email lists."), React.createElement("p", null, React.createElement("input", {
      "ref": "email",
      "type": "email",
      "required": true,
      "onChange": this.handleEmailChange,
      "className": "standard-input",
      "defaultValue": ((ref1 = this.props.location.query) != null ? ref1.email : void 0),
      "size": "50"
    })), React.createElement("p", null, React.createElement("button", {
      "type": "submit",
      "className": "standard-button",
      "disabled": !this.state.emailIsValid || this.state.emailSuccess
    }, "Submit"), ' ', (this.state.inProgress ? React.createElement("i", {
      "className": "fa fa-spinner fa-spin form-help"
    }) : this.state.emailSuccess ? React.createElement("i", {
      "className": "fa fa-check-circle form-help success"
    }) : void 0)), (this.state.emailSuccess ? React.createElement("p", null, "You\'ve been unsubscribed!") : this.state.emailError ? React.createElement("small", {
      "className": "form-help error"
    }, "There was an error unsubscribing your email.") : void 0))));
  }
});


},{"../lib/alert":98,"../partials/login-dialog":219,"panoptes-client/lib/auth":550,"react":"react"}],210:[function(require,module,exports){
var Avatar, DOWN, History, Link, PassHistoryContext, React, ReactDOM, Translate, TriggeredModalForm, UP, auth, counterpart, ref, talkClient;

React = require('react');

ReactDOM = require('react-dom');

ref = require('react-router'), Link = ref.Link, History = ref.History;

auth = require('panoptes-client/lib/auth');

talkClient = require('panoptes-client/lib/talk-client');

counterpart = require('counterpart');

Translate = require('react-translate-component');

Avatar = require('../partials/avatar');

TriggeredModalForm = require('modal-form/triggered');

PassHistoryContext = require('../components/pass-history-context');

UP = 38;

DOWN = 40;

counterpart.registerTranslations('en', {
  accountMenu: {
    profile: 'Profile',
    settings: 'Settings',
    signOut: 'Sign Out',
    collections: 'Collections',
    favorites: 'Favorites'
  }
});

module.exports = React.createClass({
  displayName: 'AccountBar',
  mixins: [History],
  propTypes: {
    user: React.PropTypes.object.isRequired
  },
  getDefaultProps: function() {
    return {
      focusablesSelector: 'a[href], button'
    };
  },
  getInitialState: function() {
    return {
      unread: false
    };
  },
  componentDidMount: function() {
    window.addEventListener('locationchange', this.setUnread);
    return this.setUnread();
  },
  componentWillUnmount: function() {
    return window.removeEventListener('locationchange', this.setUnread);
  },
  setUnread: function() {
    return talkClient.type('conversations').get({
      user_id: this.props.user.id,
      unread: true,
      page_size: 1
    }).then((function(_this) {
      return function(conversations) {
        return _this.setState({
          unread: !!conversations.length
        });
      };
    })(this))["catch"](function(e) {
      throw new Error(e);
    });
  },
  render: function() {
    return React.createElement("div", {
      "className": "account-bar"
    }, React.createElement("div", {
      "className": "account-info"
    }, React.createElement(TriggeredModalForm, {
      "ref": "accountMenuButton",
      "className": "account-menu",
      "trigger": React.createElement("span", null, React.createElement("strong", null, this.props.user.display_name), ' ', React.createElement(Avatar, {
        "user": this.props.user
      })),
      "triggerProps": {
        className: 'secret-button',
        onClick: this.handleAccountMenuOpen
      }
    }, React.createElement(PassHistoryContext, React.__spread({}, this.props, {
      "context": {
        history: this.history
      }
    }), React.createElement("div", {
      "ref": "accountMenu",
      "role": "menu",
      "className": "secret-list",
      "onKeyDown": this.navigateMenu
    }, React.createElement(Link, {
      "role": "menuitem",
      "to": "/users/" + this.props.user.login
    }, React.createElement("i", {
      "className": "fa fa-user fa-fw"
    }), ' ', React.createElement(Translate, {
      "content": "accountMenu.profile"
    })), React.createElement(Link, {
      "role": "menuitem",
      "to": "/settings"
    }, React.createElement("i", {
      "className": "fa fa-cogs fa-fw"
    }), ' ', React.createElement(Translate, {
      "content": "accountMenu.settings"
    })), React.createElement(Link, {
      "role": "menuitem",
      "to": "/collections/" + this.props.user.login
    }, React.createElement("i", {
      "className": "fa fa-image fa-fw"
    }), ' ', React.createElement(Translate, {
      "content": "accountMenu.collections"
    })), React.createElement(Link, {
      "role": "menuitem",
      "to": "/favorites/" + this.props.user.login
    }, React.createElement("i", {
      "className": "fa fa-star fa-fw"
    }), ' ', React.createElement(Translate, {
      "content": "accountMenu.favorites"
    })), React.createElement("hr", null), React.createElement("button", {
      "role": "menuitem",
      "type": "button",
      "className": "secret-button sign-out-button",
      "onClick": this.handleSignOutClick
    }, React.createElement("i", {
      "className": "fa fa-sign-out fa-fw"
    }), ' ', React.createElement(Translate, {
      "content": "accountMenu.signOut"
    }))))), ' ', React.createElement(Link, {
      "to": "/inbox",
      "className": "message-link",
      "aria-label": "Inbox " + (this.state.unread ? 'with unread messages' : '')
    }, React.createElement("i", {
      "className": "fa fa-envelope" + (this.state.unread ? ' unread' : '-o')
    }))));
  },
  handleAccountMenuOpen: function() {
    return setTimeout((function(_this) {
      return function() {
        var ref1;
        if (_this.refs.accountMenuButton.state.open) {
          return (ref1 = _this.refs.accountMenu.querySelector(_this.props.focusablesSelector)) != null ? ref1.focus() : void 0;
        }
      };
    })(this));
  },
  navigateMenu: function(e) {
    var control, focusIndex, focusables, i, j, len, newIndex, ref1, ref2;
    focusables = this.refs.accountMenu.querySelectorAll(this.props.focusablesSelector);
    for (i = j = 0, len = focusables.length; j < len; i = ++j) {
      control = focusables[i];
      if (control === document.activeElement) {
        focusIndex = i;
      }
    }
    switch (e.which) {
      case UP:
        newIndex = Math.max(0, focusIndex - 1);
        if ((ref1 = focusables[newIndex]) != null) {
          ref1.focus();
        }
        return e.preventDefault();
      case DOWN:
        newIndex = Math.min(focusables.length - 1, focusIndex + 1);
        if ((ref2 = focusables[newIndex]) != null) {
          ref2.focus();
        }
        return e.preventDefault();
    }
  },
  handleSignOutClick: function() {
    return auth.signOut();
  }
});


},{"../components/pass-history-context":83,"../partials/avatar":212,"counterpart":"counterpart","modal-form/triggered":548,"panoptes-client/lib/auth":550,"panoptes-client/lib/talk-client":553,"react":"react","react-dom":"react-dom","react-router":"react-router","react-translate-component":"react-translate-component"}],211:[function(require,module,exports){
var IOStatus, MainFooter, MainHeader, React, auth, generateSessionID;

React = require('react');

auth = require('panoptes-client/lib/auth');

IOStatus = require('./io-status');

MainHeader = require('./main-header');

MainFooter = require('./main-footer');

generateSessionID = require('../lib/session').generateSessionID;

module.exports = React.createClass({
  displayName: 'PanoptesApp',
  getInitialState: function() {
    return {
      user: null,
      initialLoadComplete: false
    };
  },
  componentDidMount: function() {
    auth.listen('change', this.handleAuthChange);
    generateSessionID();
    return this.handleAuthChange();
  },
  componentWillUnmount: function() {
    return auth.stopListening('change', this.handleAuthChange);
  },
  handleAuthChange: function() {
    return auth.checkCurrent().then((function(_this) {
      return function(user) {
        return _this.setState({
          user: user,
          initialLoadComplete: true
        });
      };
    })(this));
  },
  render: function() {
    return React.createElement("div", {
      "className": "panoptes-main"
    }, React.createElement(IOStatus, null), React.createElement(MainHeader, {
      "user": this.state.user
    }), React.createElement("div", {
      "className": "main-content"
    }, (this.state.initialLoadComplete ? React.cloneElement(this.props.children, {
      user: this.state.user
    }) : void 0)), React.createElement(MainFooter, {
      "user": this.state.user
    }));
  }
});


},{"../lib/session":114,"./io-status":216,"./main-footer":220,"./main-header":221,"panoptes-client/lib/auth":550,"react":"react"}],212:[function(require,module,exports){
var DEFAULT_AVATAR, React;

React = require('react');

DEFAULT_AVATAR = './assets/simple-avatar.jpg';

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'Avatar',
    propTypes: {
      user: React.PropTypes.object
    },
    getDefaultProps: function() {
      return {
        user: null
      };
    },
    getInitialState: function() {
      return {
        loading: false,
        src: DEFAULT_AVATAR
      };
    },
    componentDidMount: function() {
      this.props.user.listen('change', this.handleResourceChange);
      return this.handleResourceChange();
    },
    componentWillReceiveProps: function(nextProps) {
      if (nextProps.user !== this.props.user) {
        this.props.user.stopListening('change', this.handleResourceChange);
        nextProps.user.listen('change', this.handleResourceChange);
        return this.handleResourceChange(nextProps.user);
      }
    },
    componentWillUnmount: function() {
      return this.props.user.stopListening('change', this.handleResourceChange);
    },
    handleResourceChange: function(user) {
      if (user == null) {
        user = this.props.user;
      }
      this.setState({
        loading: true
      });
      return user.get('avatar').then((function(_this) {
        return function(arg) {
          var avatar;
          avatar = arg[0];
          return _this.setState({
            src: avatar.src
          });
        };
      })(this))["catch"]((function(_this) {
        return function() {
          return _this.setState({
            src: DEFAULT_AVATAR
          });
        };
      })(this)).then((function(_this) {
        return function() {
          return _this.setState({
            loading: false
          });
        };
      })(this));
    },
    handleError: function() {
      return this.setState({
        src: DEFAULT_AVATAR
      });
    },
    render: function() {
      return React.createElement("img", {
        "src": this.state.src,
        "onError": this.handleError,
        "alt": "User avatar",
        "className": "avatar",
        "data-loading": this.state.loading || null
      });
    }
  });
}


},{"react":"react"}],213:[function(require,module,exports){
var PromiseRenderer, React, Translate, apiClient, moment;

React = require('react');

PromiseRenderer = require('../components/promise-renderer');

apiClient = require('panoptes-client/lib/api-client');

moment = require('moment');

Translate = require('react-translate-component');

module.exports = React.createClass({
  displayName: 'DataExportButton',
  getDefaultProps: function() {
    return {
      contentType: 'text/csv',
      newFeature: false
    };
  },
  getInitialState: function() {
    return {
      exportRequested: false,
      exportError: null
    };
  },
  exportGet: function() {
    return this._exportsGet || (this._exportsGet = this.props.project.get(this.props.exportType)["catch"](function() {
      return [];
    }));
  },
  requestDataExport: function() {
    this.setState({
      exportError: null
    });
    return apiClient.post(this.props.project._getURL(this.props.exportType), {
      media: {
        content_type: this.props.contentType
      }
    }).then((function(_this) {
      return function() {
        _this._exportsGet = null;
        return _this.setState({
          exportRequested: true
        });
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          exportError: error
        });
      };
    })(this));
  },
  recentAndReady: function(exported) {
    return (exported != null) && (exported.metadata.state === 'ready' || (exported.metadata.state == null));
  },
  pending: function(exported) {
    return exported != null;
  },
  render: function() {
    return React.createElement("div", null, (this.props.newFeature ? React.createElement("i", {
      "className": "fa fa-cog fa-lg fa-fw"
    }) : void 0), React.createElement("button", {
      "type": "button",
      "disabled": this.state.exportRequested,
      "onClick": this.requestDataExport
    }, React.createElement(Translate, {
      "content": this.props.buttonKey
    })), " ", ' ', React.createElement("small", {
      "className": "form-help"
    }, "CSV format.", ' ', React.createElement(PromiseRenderer, {
      "promise": this.exportGet()
    }, ((function(_this) {
      return function(arg) {
        var mostRecent;
        mostRecent = arg[0];
        if (_this.recentAndReady(mostRecent)) {
          return React.createElement("span", null, "Most recent data available requested", ' ', React.createElement("a", {
            "href": mostRecent.src
          }, moment(mostRecent.updated_at).fromNow()), ".");
        } else if (_this.pending(mostRecent)) {
          return React.createElement("span", null, "Processing your request.");
        } else {
          return React.createElement("span", null, "Never requested.");
        }
      };
    })(this))), React.createElement("br", null)), (this.state.exportError != null ? React.createElement("div", {
      "className": "form-help error"
    }, this.state.exportError.toString()) : this.state.exportRequested ? React.createElement("div", {
      "className": "form-help success"
    }, "Weve received your request, check your email for a link to your data soon!") : void 0));
  }
});


},{"../components/promise-renderer":86,"moment":"moment","panoptes-client/lib/api-client":549,"react":"react","react-translate-component":"react-translate-component"}],214:[function(require,module,exports){
var AutoSave, PromiseRenderer, React, handleInputChange;

React = require('react');

AutoSave = require('../components/auto-save');

PromiseRenderer = require('../components/promise-renderer');

handleInputChange = require('../lib/handle-input-change');

module.exports = React.createClass({
  displayName: "DisplayNameSlugEditor",
  getDefaultProps: function() {
    return {
      disabled: false,
      resource: {}
    };
  },
  getInitialState: function() {
    var ref, ref1;
    return {
      currentSlug: (ref = this.props.resource) != null ? ref.slug : void 0,
      currentName: (ref1 = this.props.resource) != null ? ref1.display_name : void 0
    };
  },
  warnURLChange: function() {
    return this.props.resource.slug !== this.state.currentSlug && this.state.currentSlug.match(/untitled-project/i) === null;
  },
  resourceURL: function() {
    return this.props.resource.get('owner').then((function(_this) {
      return function(owner) {
        return "/" + _this.props.resourceType + "s/" + _this.props.resource.slug;
      };
    })(this));
  },
  undoNameChange: function() {
    this.props.resource.update({
      display_name: this.state.currentName
    });
    return this.props.resource.save();
  },
  render: function() {
    return React.createElement("p", null, React.createElement(AutoSave, {
      "resource": this.props.resource
    }, React.createElement("span", {
      "className": "form-label"
    }, "Name"), React.createElement("br", null), React.createElement("input", {
      "type": "text",
      "className": "standard-input full",
      "name": "display_name",
      "value": this.props.resource.display_name,
      "onChange": handleInputChange.bind(this.props.resource),
      "disabled": this.props.disabled || this.props.resource.live
    })), (this.warnURLChange() ? React.createElement("small", {
      "className": "form-help"
    }, "Youre changing the url of your ", this.props.resourceType, ". Users with bookmarks and links in talk will no longer work. ", React.createElement("button", {
      "type": "button",
      "onClick": this.undoNameChange
    }, "Undo")) : void 0), React.createElement(PromiseRenderer, {
      "promise": this.resourceURL(),
      "pending": null
    }, ((function(_this) {
      return function(url) {
        return React.createElement("small", {
          "className": "form-help"
        }, (_this.props.resource.live ? "You cannot change a live " + _this.props.resourceType + "'s name." : "The " + _this.props.resourceType + " name is the first thing people will see about the " + _this.props.resourceType + ", and it will show up in the " + _this.props.resourceType + " URL. Try to keep it short and sweet."), "Your ", _this.props.resourceType, "s URL is ", React.createElement("a", {
          "href": document.baseURI.slice(0, -1) + url
        }, url));
      };
    })(this))));
  }
});


},{"../components/auto-save":62,"../components/promise-renderer":86,"../lib/handle-input-change":103,"react":"react"}],215:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'HamburgerIcon',
  propTypes: {
    fill: React.PropTypes.string
  },
  getDefaultProps: function() {
    return {
      fill: '#ffffff',
      width: '30',
      height: '5'
    };
  },
  render: function() {
    var fill, height, ref, width;
    ref = this.props, fill = ref.fill, width = ref.width, height = ref.height;
    return React.createElement("svg", {
      "x": "0px",
      "y": "0px",
      "viewBox": "0 0 30 30",
      "xmlSpace": "preserve"
    }, React.createElement("g", null, React.createElement("rect", {
      "y": "2.5",
      "fill": fill,
      "width": width,
      "height": height
    }), React.createElement("rect", {
      "y": "12.5",
      "fill": fill,
      "width": width,
      "height": height
    }), React.createElement("rect", {
      "y": "22.5",
      "fill": fill,
      "width": width,
      "height": height
    })));
  }
});


},{"react":"react"}],216:[function(require,module,exports){
var React, apiClient;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

module.exports = React.createClass({
  displayName: 'IOStatus',
  getDefaultProps: function() {
    return {
      target: apiClient,
      confirmation: 'Some data hasnt finished syncing, please wait just a second!',
      style: {
        background: 'rgba(0, 0, 0, 0.5)',
        borderRadius: '0 0 0.3em 0.3em',
        color: 'white',
        fontSize: '11px',
        fontWeight: 'bold',
        left: '50%',
        padding: '0 1.5em',
        position: 'fixed',
        textTransform: 'uppercase',
        top: 0,
        transform: 'translateX(-50%)'
      }
    };
  },
  getInitialState: function() {
    return {
      reads: this.props.target.reads,
      writes: this.props.target.writes
    };
  },
  componentDidMount: function() {
    this.props.target.listen('change', this.handleTargetChange);
    return addEventListener('beforeunload', this.handlePageExit);
  },
  componentWillReceiveProps: function(nextProps) {
    this.props.target.stopListening('change', this.handleTargetChange);
    return nextProps.target.listen('change', this.handleTargetChange);
  },
  componentWillUnmount: function() {
    this.props.target.stopListening('change', this.handleTargetChange);
    return removeEventListener('beforeunload', this.handlePageExit);
  },
  handleTargetChange: function() {
    return setTimeout((function(_this) {
      return function() {
        var reads, ref, writes;
        ref = _this.props.target, reads = ref.reads, writes = ref.writes;
        return _this.setState({
          reads: reads,
          writes: writes
        });
      };
    })(this));
  },
  render: function() {
    var reads, ref, rootStyle, writes;
    ref = this.state, reads = ref.reads, writes = ref.writes;
    rootStyle = {
      pointerEvents: 'none',
      zIndex: 1
    };
    if (reads === 0 && writes === 0) {
      rootStyle.display = 'none';
    }
    return React.createElement("span", {
      "style": rootStyle
    }, React.createElement("span", {
      "className": "io-status",
      "style": this.props.style
    }, React.createElement("span", {
      "style": (reads === 0 && writes === 0 ? {
        visibility: 'hidden'
      } : void 0)
    }, React.createElement("i", {
      "className": "fa fa-spinner fa-spin fa-fw"
    })), ' ', "Loading\n", React.createElement("span", {
      "style": (reads === 0 ? {
        opacity: 0.3
      } : void 0)
    }, React.createElement("i", {
      "className": "fa fa-chevron-down fa-fw"
    }), reads), "        ", React.createElement("span", {
      "style": (writes === 0 ? {
        opacity: 0.3
      } : void 0)
    }, React.createElement("i", {
      "className": "fa fa-chevron-up fa-fw"
    }), writes)));
  },
  handlePageExit: function(e) {
    if (this.state.writes !== 0) {
      e.returnValue = this.props.confirmation;
      return this.props.confirmation;
    }
  }
});


},{"panoptes-client/lib/api-client":549,"react":"react"}],217:[function(require,module,exports){
var LoginDialog, React, Translate, alert, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

alert = require('../lib/alert');

LoginDialog = require('../partials/login-dialog');

counterpart.registerTranslations('en', {
  loginBar: {
    signIn: 'Sign in',
    register: 'Register'
  }
});

module.exports = React.createClass({
  displayName: 'LoginBar',
  render: function() {
    return React.createElement("div", {
      "className": "login-bar"
    }, React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "onClick": this.showLoginDialog.bind(this, 'sign-in')
    }, React.createElement(Translate, {
      "content": "loginBar.signIn"
    })), React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "onClick": this.showLoginDialog.bind(this, 'register')
    }, React.createElement(Translate, {
      "content": "loginBar.register"
    })));
  },
  showLoginDialog: function(which) {
    return alert(function(resolve) {
      return React.createElement(LoginDialog, {
        "which": which,
        "onSuccess": resolve
      });
    });
  }
});


},{"../lib/alert":98,"../partials/login-dialog":219,"counterpart":"counterpart","react":"react","react-translate-component":"react-translate-component"}],218:[function(require,module,exports){
var LoadingIndicator, React, ReactDOM, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

ReactDOM = require('react-dom');

Translate = require('react-translate-component');

LoadingIndicator = require('../components/loading-indicator');

counterpart.registerTranslations('en', {
  loginChangeForm: {
    updateMessage: "To use our new platform, you may need to update your Zooniverse ID. Please choose carefully: this will be your only chance to choose a new username for this account! User names can no longer have spaces, or symbols other than hyphens and underscores.",
    updateMessageCont: "Your username will be used for other users to reference you by typing: @%(login)s. In addition to your user name, you will also have a display name that you may change as often as you like from your Profile page.",
    login: "Login",
    submit: "Set Login"
  }
});

module.exports = React.createClass({
  displayName: "LoginChangeForm",
  getInitialState: function() {
    return {
      login: this.props.user.login,
      busy: false,
      error: null
    };
  },
  changeLogin: function() {
    return this.props.user.update({
      login: this.state.login
    }).save().then((function(_this) {
      return function(user) {
        return _this.setState({
          busy: false
        }, function() {
          return _this.props.onSuccess(user);
        });
      };
    })(this))["catch"]((function(_this) {
      return function(e) {
        return _this.setState({
          busy: false,
          error: e
        }, function() {
          var base, ref;
          if ((ref = ReactDOM.findDOMNode(_this).querySelector('[name="login"]')) != null) {
            ref.focus();
          }
          return typeof (base = _this.props).onFailure === "function" ? base.onFailure(user) : void 0;
        });
      };
    })(this));
  },
  handleSubmit: function(e) {
    e.preventDefault();
    if (this.state.login !== this.props.user.login) {
      return this.setState({
        busy: true
      }, (function(_this) {
        return function() {
          return _this.changeLogin();
        };
      })(this));
    } else {
      return this.props.onSuccess(this.props.user);
    }
  },
  handleLoginChange: function(e) {
    return this.setState({
      login: e.target.value
    });
  },
  render: function() {
    return React.createElement("form", {
      "onSubmit": this.handleSubmit
    }, React.createElement(Translate, {
      "content": "loginChangeForm.updateMessage",
      "component": 'p'
    }), React.createElement(Translate, {
      "login": this.state.login,
      "content": "loginChangeForm.updateMessageCont",
      "component": 'p'
    }), React.createElement("label", null, React.createElement(Translate, {
      "content": "loginChangeForm.login",
      "component": 'p'
    }), React.createElement("input", {
      "type": "text",
      "className": "standard-input full",
      "name": "login",
      "value": this.state.login,
      "disabled": this.state.busy,
      "autoFocus": true,
      "onChange": this.handleLoginChange
    })), React.createElement("br", null), React.createElement("p", {
      "style": {
        textAlign: 'center'
      }
    }, (this.state.error != null ? React.createElement("span", null, this.state.error.toString()) : this.state.busy ? React.createElement(LoadingIndicator, null) : React.createElement("span", null, "")), ' '), React.createElement("button", {
      "type": "submit",
      "className": "standard-button full",
      "disabled": this.state.busy || this.state.login.length === 0
    }, React.createElement(Translate, {
      "content": "loginChangeForm.submit"
    })));
  }
});


},{"../components/loading-indicator":77,"counterpart":"counterpart","react":"react","react-dom":"react-dom","react-translate-component":"react-translate-component"}],219:[function(require,module,exports){
var LoginChangeForm, React, RegisterForm, SignInForm, Translate, counterpart;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

SignInForm = require('./sign-in-form');

RegisterForm = require('./register-form');

LoginChangeForm = require('./login-change-form');

counterpart.registerTranslations('en', {
  signInDialog: {
    signIn: 'Sign in',
    register: 'Register'
  }
});

module.exports = React.createClass({
  displayName: 'LoginDialog',
  getDefaultProps: function() {
    return {
      which: 'sign-in',
      project: {}
    };
  },
  getInitialState: function() {
    return {
      which: this.props.which
    };
  },
  render: function() {
    var ref, ref1;
    return React.createElement("div", {
      "className": "tabbed-content",
      "data-side": "top",
      "onSubmit": this.handleSubmit
    }, React.createElement("nav", {
      "className": "tabbed-content-tabs"
    }, React.createElement("button", {
      "type": "button",
      "className": "tabbed-content-tab " + ((ref = (this.state.which === 'sign-in' ? 'active' : void 0)) != null ? ref : ''),
      "onClick": this.goTo.bind(this, 'sign-in')
    }, React.createElement(Translate, {
      "content": "signInDialog.signIn"
    })), React.createElement("button", {
      "type": "button",
      "className": "tabbed-content-tab " + ((ref1 = (this.state.which === 'register' ? 'active' : void 0)) != null ? ref1 : ''),
      "onClick": this.goTo.bind(this, 'register')
    }, React.createElement(Translate, {
      "content": "signInDialog.register"
    }))), React.createElement("div", {
      "className": "content-container"
    }, ((function() {
      switch (this.state.which) {
        case 'login-change':
          return React.createElement(LoginChangeForm, {
            "user": this.props.user,
            "onSuccess": this.props.onSuccess
          });
        case 'sign-in':
          return React.createElement(SignInForm, {
            "user": this.props.user,
            "onSuccess": this.onSuccessOrLoginChange
          });
        case 'register':
          return React.createElement(RegisterForm, {
            "project": this.props.project,
            "onSuccess": this.props.onSuccess
          });
      }
    }).call(this))));
  },
  goTo: function(which) {
    return this.setState({
      which: which
    });
  },
  onSuccessOrLoginChange: function(user) {
    if (user.login_prompt) {
      return this.setState({
        which: 'login-change',
        user: user
      });
    } else {
      return this.props.onSuccess(user);
    }
  }
});


},{"./login-change-form":218,"./register-form":226,"./sign-in-form":227,"counterpart":"counterpart","react":"react","react-translate-component":"react-translate-component"}],220:[function(require,module,exports){
(function (process){
var AdminToggle, IndexLink, Link, React, Translate, ZooniverseLogoType, apiClient, counterpart, ref;

counterpart = require('counterpart');

React = require('react');

Translate = require('react-translate-component');

ref = require('react-router'), IndexLink = ref.IndexLink, Link = ref.Link;

ZooniverseLogoType = require('./zooniverse-logotype');

apiClient = require('panoptes-client/lib/api-client');

counterpart.registerTranslations('en', {
  footer: {
    adminMode: 'Admin mode',
    discover: {
      title: 'Projects',
      projectList: 'Projects',
      collectionList: 'Collections',
      projectBuilder: 'Build a Project',
      howToGuide: 'How to Build',
      projectBuilderPolicies: 'Project Policies'
    },
    about: {
      title: 'About',
      aboutUs: 'About Us',
      ourTeam: 'Our Team',
      education: 'Education',
      publications: 'Publications'
    },
    talk: {
      title: 'Talk',
      zooTalk: 'Zooniverse Talk',
      daily: 'Daily Zooniverse',
      blog: 'Blog'
    },
    boilerplate: {
      contact: 'Contact Us',
      jobs: 'Jobs',
      privacyPolicy: 'Privacy Policy',
      status: 'System Status',
      security: 'Security'
    }
  }
});

AdminToggle = React.createClass({
  displayName: 'AdminToggle',
  getInitialState: function() {
    var adminFlag;
    adminFlag = localStorage.getItem('adminFlag') || void 0;
    apiClient.update({
      'params.admin': adminFlag
    });
    return {
      checked: adminFlag ? adminFlag : false
    };
  },
  componentDidMount: function() {
    return apiClient.listen('change', this.handleClientChange);
  },
  componentWillUnmount: function() {
    return apiClient.stopListening('change', this.handleClientChange);
  },
  handleClientChange: function() {
    var checked, ref1;
    checked = (ref1 = apiClient.params.admin) != null ? ref1 : false;
    if (this.state.checked !== checked) {
      if (checked) {
        localStorage.setItem('adminFlag', checked);
      } else {
        localStorage.removeItem('adminFlag');
      }
      return this.setState({
        checked: checked
      });
    }
  },
  toggleAdminMode: function(e) {
    return apiClient.update({
      'params.admin': e.target.checked ? true : void 0
    });
  },
  render: function() {
    var classes;
    classes = 'admin-toggle ' + (this.state.checked ? 'in-admin-mode' : '');
    return React.createElement("label", {
      "className": classes
    }, React.createElement("input", {
      "type": "checkbox",
      "checked": this.state.checked,
      "onChange": this.toggleAdminMode
    }), ' ', React.createElement(Translate, {
      "content": "footer.adminMode"
    }));
  }
});

module.exports = React.createClass({
  displayName: 'MainFooter',
  render: function() {
    var ref1;
    return React.createElement("footer", {
      "className": "main-footer"
    }, React.createElement("div", {
      "className": "centered-grid main-footer-flex"
    }, React.createElement("div", {
      "className": "main-logo"
    }, React.createElement(IndexLink, {
      "to": "/",
      "className": "main-logo-link"
    }, React.createElement(ZooniverseLogoType, null)), React.createElement("br", null), (((ref1 = this.props.user) != null ? ref1.admin : void 0) ? React.createElement(AdminToggle, null) : void 0)), React.createElement("nav", {
      "className": "site-map"
    }, React.createElement("div", {
      "className": "site-map-section"
    }, React.createElement(Translate, {
      "component": "h6",
      "content": "footer.discover.title"
    }), React.createElement(Link, {
      "to": "/projects"
    }, React.createElement(Translate, {
      "content": "footer.discover.projectList"
    })), React.createElement(Link, {
      "to": "/collections"
    }, React.createElement(Translate, {
      "content": "footer.discover.collectionList"
    })), React.createElement(Link, {
      "to": "/lab"
    }, React.createElement(Translate, {
      "content": "footer.discover.projectBuilder"
    })), React.createElement(Link, {
      "to": "/lab-how-to"
    }, React.createElement(Translate, {
      "content": "footer.discover.howToGuide"
    })), React.createElement(Link, {
      "to": "/lab-policies"
    }, React.createElement(Translate, {
      "content": "footer.discover.projectBuilderPolicies"
    })), (process.env.NODE_ENV !== 'production' ? React.createElement(Link, {
      "to": "/dev/classifier"
    }, "Dev Classifier") : void 0)), React.createElement("div", {
      "className": "site-map-section"
    }, React.createElement(Translate, {
      "component": "h6",
      "content": "footer.about.title"
    }), React.createElement(Link, {
      "to": "/about"
    }, React.createElement(Translate, {
      "content": "footer.about.aboutUs"
    })), React.createElement(Link, {
      "to": "/about/education"
    }, React.createElement(Translate, {
      "content": "footer.about.education"
    })), React.createElement(Link, {
      "to": "/about/team"
    }, React.createElement(Translate, {
      "content": "footer.about.ourTeam"
    })), React.createElement(Link, {
      "to": "/about/publications"
    }, React.createElement(Translate, {
      "content": "footer.about.publications"
    })), React.createElement(Link, {
      "to": "/about/contact"
    }, React.createElement(Translate, {
      "content": "footer.boilerplate.contact"
    }))), React.createElement("div", {
      "className": "site-map-section"
    }, React.createElement(Translate, {
      "component": "h6",
      "content": "footer.talk.title"
    }), React.createElement(Link, {
      "to": "/talk"
    }, React.createElement(Translate, {
      "content": "footer.talk.zooTalk"
    })), React.createElement("a", {
      "href": "http://daily.zooniverse.org/",
      "target": "_blank"
    }, React.createElement(Translate, {
      "content": "footer.talk.daily"
    })), React.createElement("a", {
      "href": "http://blog.zooniverse.org/",
      "target": "_blank"
    }, React.createElement(Translate, {
      "content": "footer.talk.blog"
    }))), React.createElement("div", {
      "className": "site-map-section social-media"
    }, React.createElement("a", {
      "href": "https://www.facebook.com/therealzooniverse",
      "target": "_blank"
    }, React.createElement("i", {
      "className": "fa fa-facebook"
    })), React.createElement("a", {
      "href": "https://twitter.com/the_zooniverse",
      "target": "_blank"
    }, React.createElement("i", {
      "className": "fa fa-twitter"
    })), React.createElement("a", {
      "href": "https://plus.google.com/+ZooniverseOrgReal",
      "target": "_blank"
    }, React.createElement("i", {
      "className": "fa fa-google-plus"
    }))))), React.createElement("div", {
      "className": "footer-sole"
    }, React.createElement("div", {
      "className": "centered-grid footer-sole-links"
    }, React.createElement(Link, {
      "to": "/privacy"
    }, React.createElement(Translate, {
      "content": "footer.boilerplate.privacyPolicy"
    })), React.createElement("i", {
      "className": "fa fa-ellipsis-v footer-sole-links-separator"
    }), React.createElement("a", {
      "href": "http://jobs.zooniverse.org/"
    }, React.createElement(Translate, {
      "content": "footer.boilerplate.jobs"
    })), React.createElement("i", {
      "className": "fa fa-ellipsis-v footer-sole-links-separator"
    }), React.createElement("a", {
      "href": "https://status.zooniverse.org/"
    }, React.createElement(Translate, {
      "content": "footer.boilerplate.status"
    })), React.createElement("i", {
      "className": "fa fa-ellipsis-v footer-sole-links-separator"
    }), React.createElement(Link, {
      "to": "/security"
    }, React.createElement(Translate, {
      "content": "footer.boilerplate.security"
    })))));
  }
});


}).call(this,require('_process'))
},{"./zooniverse-logotype":231,"_process":503,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],221:[function(require,module,exports){
var AccountBar, HamburgerIcon, History, IndexLink, Link, LoadingIndicator, LoginBar, MOBILE_WIDTH, PassHistoryContext, PromiseToSetState, React, Translate, TriggeredModalForm, ZooniverseLogo, auth, counterpart, debounce, isAdmin, ref;

counterpart = require('counterpart');

React = require('react');

ref = require('react-router'), IndexLink = ref.IndexLink, Link = ref.Link, History = ref.History;

ZooniverseLogo = require('./zooniverse-logo');

Translate = require('react-translate-component');

LoadingIndicator = require('../components/loading-indicator');

AccountBar = require('./account-bar');

LoginBar = require('./login-bar');

PromiseToSetState = require('../lib/promise-to-set-state');

auth = require('panoptes-client/lib/auth');

isAdmin = require('../lib/is-admin');

TriggeredModalForm = require('modal-form/triggered');

debounce = require('debounce');

HamburgerIcon = require('../partials/hamburger-icon');

PassHistoryContext = require('../components/pass-history-context');

counterpart.registerTranslations('en', {
  mainNav: {
    home: 'Home',
    projects: 'Projects',
    about: 'About',
    collect: 'Collect',
    talk: 'Talk',
    daily: 'Daily Zooniverse',
    blog: 'Blog',
    lab: 'Build a project',
    admin: 'Admin',
    notifications: 'Notifications'
  }
});

MOBILE_WIDTH = 875;

module.exports = React.createClass({
  displayName: 'MainHeader',
  mixins: [History],
  getDefaultProps: function() {
    return {
      user: null
    };
  },
  getInitialState: function() {
    return {
      mobile: this.isMobile()
    };
  },
  componentDidMount: function() {
    if (this.checkIfOnHome()) {
      document.addEventListener('scroll', this.onScroll);
    }
    window.addEventListener('locationchange', this.onLocationChange);
    return window.addEventListener('resize', debounce(this.onResize, 100));
  },
  componentWillUnmount: function() {
    document.removeEventListener('scroll', this.onScroll);
    return window.removeEventListener('resize', debounce(this.onResize, 100));
  },
  isMobile: function() {
    var ref1;
    return (ref1 = (typeof window !== "undefined" && window !== null ? window.innerWidth : void 0) < MOBILE_WIDTH) != null ? ref1 : false;
  },
  onResize: function() {
    return this.setState({
      mobile: this.isMobile()
    });
  },
  onLocationChange: function() {
    if (this.checkIfOnHome()) {
      return document.addEventListener('scroll', this.onScroll);
    } else {
      document.removeEventListener('scroll', this.onScroll);
      return this.refs.mainTitle.classList.remove('header-sticky');
    }
  },
  checkIfOnHome: function() {
    return window.location === '/';
  },
  mobileClass: function() {
    if (this.state.mobile) {
      return 'mobile';
    } else {
      return '';
    }
  },
  links: function() {
    return React.createElement("nav", {
      "className": "main-nav " + (this.mobileClass())
    }, React.createElement(Link, {
      "to": "/projects",
      "className": "main-nav-item",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "mainNav.projects"
    })), React.createElement(Link, {
      "to": "/about",
      "className": "main-nav-item",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "mainNav.about"
    })), React.createElement(Link, {
      "to": "/talk",
      "className": "main-nav-item",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "mainNav.talk"
    })), React.createElement(Link, {
      "to": "/notifications",
      "className": "main-nav-item",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "mainNav.notifications"
    })), React.createElement(Link, {
      "to": "/collections",
      "className": "main-nav-item",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "content": "mainNav.collect"
    })), React.createElement("hr", null), React.createElement(Link, {
      "to": "/lab",
      "activeClassName": "active",
      "className": "main-nav-item nav-build"
    }, React.createElement(Translate, {
      "className": "minor",
      "content": "mainNav.lab"
    })), (isAdmin() ? React.createElement(Link, {
      "to": "/admin",
      "className": "main-nav-item nav-build",
      "activeClassName": "active"
    }, React.createElement(Translate, {
      "className": "minor",
      "content": "mainNav.admin"
    })) : void 0), React.createElement(TriggeredModalForm, {
      "triggerProps": {
        title: "Other Links"
      },
      "trigger": React.createElement("span", {
        "className": "main-nav-item"
      }, React.createElement("i", {
        "style": {
          verticalAlign: 'middle'
        },
        "className": "fa fa-globe"
      }))
    }, React.createElement("div", {
      "className": "modal-nav-links"
    }, React.createElement("a", {
      "href": "http://daily.zooniverse.org/",
      "className": "main-nav-item",
      "target": "_blank"
    }, React.createElement(Translate, {
      "content": "mainNav.daily"
    })), React.createElement("a", {
      "href": "http://blog.zooniverse.org/",
      "className": "main-nav-item",
      "target": "_blank"
    }, React.createElement(Translate, {
      "content": "mainNav.blog"
    })))));
  },
  render: function() {
    var mobile;
    mobile = this.state.mobile;
    return React.createElement("header", {
      "className": "main-header " + (this.mobileClass())
    }, React.createElement("div", {
      "className": "main-title",
      "ref": "mainTitle"
    }, React.createElement(IndexLink, {
      "to": "/",
      "className": "main-logo"
    }, React.createElement(ZooniverseLogo, null)), (!mobile ? React.createElement("span", null, this.links()) : void 0), (this.props.user != null ? React.createElement(AccountBar, {
      "user": this.props.user
    }) : React.createElement(LoginBar, null)), (mobile ? React.createElement(TriggeredModalForm, {
      "triggerProps": {
        className: "hamburger-modal-trigger"
      },
      "trigger": React.createElement(HamburgerIcon, null)
    }, React.createElement(PassHistoryContext, React.__spread({}, this.props, {
      "context": {
        history: this.history
      }
    }), this.links())) : void 0)), React.createElement("div", {
      "className": "main-header-group"
    }));
  },
  onScroll: function() {
    var mainTitle;
    mainTitle = this.refs.mainTitle;
    if (window.scrollY >= 1) {
      mainTitle.classList.add('header-sticky');
    }
    if (window.scrollY === 0) {
      return mainTitle.classList.remove('header-sticky');
    }
  }
});


},{"../components/loading-indicator":77,"../components/pass-history-context":83,"../lib/is-admin":105,"../lib/promise-to-set-state":111,"../partials/hamburger-icon":215,"./account-bar":210,"./login-bar":217,"./zooniverse-logo":230,"counterpart":"counterpart","debounce":"debounce","modal-form/triggered":548,"panoptes-client/lib/auth":550,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],222:[function(require,module,exports){
var Markdown, React, TalkMarkdownHelp;

React = require('react');

Markdown = require('markdownz').Markdown;

TalkMarkdownHelp = React.createClass({displayName: "TalkMarkdownHelp",
  render: function() {
    return React.createElement("table", {
      "border": "1"
    }, React.createElement("thead", null, React.createElement("tr", null, React.createElement("th", {
      "colSpan": "2"
    }, "Zooniverse Hashtags, Users and Subjects"))), React.createElement("tbody", null, React.createElement("tr", null, React.createElement("td", null, "Add a Hashtag"), React.createElement("td", null, "#hashtag")), React.createElement("tr", null, React.createElement("td", null, "Mention User"), React.createElement("td", null, "@user")), React.createElement("tr", null, React.createElement("td", null, "Mention Subject", React.createElement("br", null), "(project Talk)"), React.createElement("td", null, "^S\x3Csubject_id\x3E", React.createElement("br", null), "e.g. ^S830273")), React.createElement("tr", null, React.createElement("td", null, "Mention Subject", React.createElement("br", null), "(any Talk)"), React.createElement("td", null, "@owner\x2Fproject^S\x3Csubject_id\x3E", React.createElement("br", null), "e.g. @zooniverse\x2Fwildcam-gorongosa^S830273")), React.createElement("tr", null, React.createElement("td", null, "Mention", React.createElement("br", null), "Project Teams"), React.createElement("td", null, "@admins - mention the project administrators", React.createElement("br", null), "@moderators - mention the project moderators", React.createElement("br", null), "@researchers or @scientists - mention the project researchers", React.createElement("br", null), "@team - mention the entire Zooniverse team")), React.createElement("tr", null, React.createElement("th", {
      "colSpan": "2"
    }, "Adding Emoji to Posts")), React.createElement("tr", null, React.createElement("td", null, "Complete", React.createElement("br", null), "Emoji List"), React.createElement("td", null, React.createElement("a", {
      "href": "http://www.emoji-cheat-sheet.com/",
      "target": "_blank"
    }, "use this website for all supported emoji")))));
  }
});

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'MarkdownHelp',
    getDefaultProps: function() {
      return {
        talk: false,
        title: React.createElement("h1", null, "Guide to using Markdown")
      };
    },
    render: function() {
      return React.createElement("div", {
        "className": "markdown-editor-help"
      }, React.createElement("table", {
        "border": "1"
      }, React.createElement("thead", null, React.createElement("tr", null, React.createElement("th", {
        "colSpan": "3"
      }, this.props.title)), React.createElement("tr", null, React.createElement("th", {
        "colSpan": "3"
      }, React.createElement("p", null, "Utilizing a slightly customized version of ", React.createElement("a", {
        "href": 'http://daringfireball.net/projects/markdown/basics',
        "target": "_blank"
      }, "Markdown"), "."))), React.createElement("tr", null, React.createElement("th", null, "Style"), React.createElement("th", null, "Type"), React.createElement("th", null, "Result"))), React.createElement("tbody", null, React.createElement("tr", null, React.createElement("td", null, "Bold"), React.createElement("td", null, "**bold** ", React.createElement("em", null, "or"), " __bold__"), React.createElement("td", null, React.createElement(Markdown, null, "**bold** _or_ __bold__"))), React.createElement("tr", null, React.createElement("td", null, "Italics"), React.createElement("td", null, "*italics* ", React.createElement("em", null, "or"), " _italics_"), React.createElement("td", null, React.createElement(Markdown, null, "*italics* _or_ _italics_"))), React.createElement("tr", null, React.createElement("td", null, "Bold Italics"), React.createElement("td", null, "**_bolditalics_**"), React.createElement("td", null, React.createElement(Markdown, null, "**_bolditalics_**"))), React.createElement("tr", null, React.createElement("td", null, "Hyperlink"), React.createElement("td", null, "[zooniverse](http:\x2F\x2Fwww.zooniverse.org)"), React.createElement("td", null, React.createElement(Markdown, null, "[zooniverse](http:\x2F\x2Fwww.zooniverse.org)"))), React.createElement("tr", null, React.createElement("td", null, "Hyperlink", React.createElement("br", null), "(new tab)"), React.createElement("td", null, "[zooniverse](+tab+http:\x2F\x2Fwww.zooniverse.org)"), React.createElement("td", null, React.createElement(Markdown, null, "[zooniverse](+tab+http:\x2F\x2Fwww.zooniverse.org)"))), React.createElement("tr", null, React.createElement("td", null, "Bulleted List"), React.createElement("td", null, "- item one", React.createElement("br", null), "- item two", React.createElement("br", null), "- item three"), React.createElement("td", null, React.createElement(Markdown, null, "- item one\n- item two\n- item three"))), React.createElement("tr", null, React.createElement("td", null, "Numbered List"), React.createElement("td", null, "1. item one", React.createElement("br", null), "2. item two", React.createElement("br", null), "3. item three"), React.createElement("td", null, React.createElement(Markdown, null, "1. item one\n2. item two\n3. item three"))), React.createElement("tr", null, React.createElement("td", null, "Nested List"), React.createElement("td", null, React.createElement("span", null, "- item one"), React.createElement("br", null), React.createElement("span", null, "- item two"), React.createElement("br", null), React.createElement("span", null, "- item three"), React.createElement("br", null), React.createElement("span", null, "- item four")), React.createElement("td", null, React.createElement(Markdown, null, "- item one\n  - item two\n    - item three\n- item four"))), React.createElement("tr", null, React.createElement("td", null, "Quoted Text \x2F", React.createElement("br", null), "Blockquote"), React.createElement("td", null, "\x3E Quoted text."), React.createElement("td", null, React.createElement(Markdown, null, "\x3E Quoted text."))), React.createElement("tr", null, React.createElement("td", null, "Header"), React.createElement("td", null, "# header1", React.createElement("br", null), "## header2", React.createElement("br", null), "### header3", React.createElement("br", null), React.createElement("em", null, "etc., up to six # symbols")), React.createElement("td", null, React.createElement(Markdown, null, "# header1\n## header2\n### header3"))), React.createElement("tr", null, React.createElement("td", null, "Code Blocks"), React.createElement("td", null, React.createElement("span", null, "`code block`"), React.createElement("br", null), React.createElement("span", null, React.createElement("em", null, "or with four (4) spaces before (and optionally, after)")), React.createElement("br", null), React.createElement("span", null, "code block")), React.createElement("td", null, React.createElement(Markdown, null, "`code block`"))), React.createElement("tr", null, React.createElement("td", null, "Strikethrough"), React.createElement("td", null, "~~strikethrough~~"), React.createElement("td", null, React.createElement(Markdown, null, "~~strikethrough~~"))), React.createElement("tr", null, React.createElement("td", null, "Image"), React.createElement("td", null, "![imagealttext](.\x2Fassets\x2Fsimple-avatar.jpg)", React.createElement("br", null), React.createElement("em", null, "images must already be uploaded; use ", React.createElement("a", {
        "href": "http://imgur.com/",
        "target": "_blank"
      }, "imgur"), " to host new images")), React.createElement("td", null, React.createElement(Markdown, null, "![imagealttext](.\x2Fassets\x2Fsimple-avatar.jpg)"))), React.createElement("tr", null, React.createElement("td", null, "Resized Image"), React.createElement("td", null, "![imagealttext](.\x2Fassets\x2Fsimple-avatar.jpg =MxN)", React.createElement("br", null), React.createElement("em", null, "M is width in pixels, N is height in pixels"), React.createElement("br", null), React.createElement("em", null, "constrain by ommitting one value, e.g.: =75x or =x75")), React.createElement("td", null, React.createElement(Markdown, null, "![imagealttext](.\x2Fassets\x2Fsimple-avatar.jpg =75x75)"), "sample set @ 75x75")), React.createElement("tr", null, React.createElement("td", null, "Horizontal Line"), React.createElement("td", null, "--- ", React.createElement("em", null, "or"), " *** ", React.createElement("em", null, "or"), " ___"), React.createElement("td", null, React.createElement(Markdown, null, "---"))), React.createElement("tr", null, React.createElement("td", null, "Tables"), React.createElement("td", {
        "colSpan": "2"
      }, React.createElement("a", {
        "href": "http://www.tablesgenerator.com/markdown_tables",
        "target": "_blank"
      }, "use this website to generate markdown tables"))), React.createElement("tr", null, React.createElement("td", null, "URL Shortening"), React.createElement("td", {
        "colSpan": "2"
      }, "URLs can be written as \x2Fprojects\x2Fusername\x2Fprojectname and \x2Fprojects\x2Fusername\x2Fprojectname\x2Fpagename, omitting the \"https:\x2F\x2Fwww.zooniverse.org.\"")))), (this.props.talk ? React.createElement(TalkMarkdownHelp, null) : void 0), React.createElement("p", null, "If you need any more help formatting posts, please ask on the ", React.createElement("a", {
        "href": "https://www.zooniverse.org/talk/"
      }, "Zooniverse Talk"), " boards!"));
    }
  });
}


},{"markdownz":"markdownz","react":"react"}],223:[function(require,module,exports){
var FlexibleLink, Link, PromiseRenderer, React, Translate, apiClient, counterpart;

React = require('react');

PromiseRenderer = require('../components/promise-renderer');

Link = require('react-router').Link;

apiClient = require('panoptes-client/lib/api-client');

counterpart = require('counterpart');

Translate = require('react-translate-component');

FlexibleLink = React.createClass({
  displayName: 'FlexibleLink',
  propTypes: {
    to: React.PropTypes.string.isRequired,
    skipOwner: React.PropTypes.bool
  },
  isExternal: function() {
    return this.props.to.indexOf('http') > -1;
  },
  render: function() {
    if (this.isExternal()) {
      return React.createElement("a", {
        "href": this.props.to
      }, this.props.children);
    } else {
      return React.createElement(Link, React.__spread({}, this.props), this.props.children);
    }
  }
});

module.exports = React.createClass({
  displayName: 'OwnedCard',
  propTypes: {
    resource: React.PropTypes.object.isRequired,
    imagePromise: React.PropTypes.object.isRequired,
    linkTo: React.PropTypes.string.isRequired,
    translationObjectName: React.PropTypes.string.isRequired
  },
  resourceOwner: function() {
    return apiClient.type(this.props.resource.links.owner.type).get(this.props.resource.links.owner.id);
  },
  componentDidMount: function() {
    var card;
    card = this.refs.ownedCard;
    this.props.imagePromise.then((function(_this) {
      return function(src) {
        card.style.backgroundImage = "url('" + src + "')";
        return card.style.backgroundSize = "contain";
      };
    })(this))["catch"]((function(_this) {
      return function() {
        return card.style.background = "url('./assets/simple-pattern.jpg') center center repeat";
      };
    })(this));
    if (this.props.resource.description != null) {
      return card.classList.add('project-card');
    }
  },
  render: function() {
    var linkProps, name, owner, ref;
    ref = this.props.resource.slug.split('/'), owner = ref[0], name = ref[1];
    linkProps = {
      to: this.props.linkTo,
      params: {
        owner: owner,
        name: name
      }
    };
    return React.createElement(FlexibleLink, React.__spread({}, linkProps), React.createElement("div", {
      "className": "card",
      "ref": "ownedCard"
    }, React.createElement("svg", {
      "className": "card-space-maker",
      "viewBox": "0 0 2 1",
      "width": "100%"
    }), React.createElement("div", {
      "className": "details"
    }, React.createElement("div", {
      "className": "name"
    }, React.createElement("span", null, this.props.resource.display_name)), (!this.props.skipOwner ? React.createElement(PromiseRenderer, {
      "promise": this.props.resource.get('owner')
    }, (function(owner) {
      var ref1;
      if (document.location.hash === "/collections") {
        return React.createElement("div", {
          "className": "owner"
        }, (ref1 = owner != null ? owner.display_name : void 0) != null ? ref1 : 'LOADING');
      }
    })) : void 0), (this.props.resource.description != null ? React.createElement("div", {
      "className": "description"
    }, this.props.resource.description) : void 0), (this.props.resource["private"] ? React.createElement("div", {
      "className": "private"
    }, React.createElement("i", {
      "className": "fa fa-lock"
    }), " Private") : void 0), React.createElement("button", {
      "type": "button",
      "tabIndex": "-1",
      "className": "standard-button card-button"
    }, React.createElement(Translate, {
      "content": this.props.translationObjectName + ".button"
    })))));
  }
});


},{"../components/promise-renderer":86,"counterpart":"counterpart","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router","react-translate-component":"react-translate-component"}],224:[function(require,module,exports){
var FileButton, MarkdownEditor, ProjectModalCreator, ProjectModalEditor, ProjectModalEditorController, ProjectModalEditorFetcher, ProjectModalStepEditor, React, apiClient, debounce, putFile,
  slice = [].slice;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

putFile = require('../lib/put-file');

FileButton = require('../components/file-button');

MarkdownEditor = require('markdownz').MarkdownEditor;

debounce = require('debounce');

ProjectModalStepEditor = React.createClass({displayName: "ProjectModalStepEditor",
  getDefaultProps: function() {
    return {
      step: null,
      media: null,
      onChange: function() {
        return console.log('ProjectModalStepEditor onChange', arguments);
      },
      onMediaSelect: function() {
        return console.log('ProjectModalStepEditor onMediaSelect', arguments);
      },
      onMediaClear: function() {
        return console.log('ProjectModalStepEditor onMediaClear', arguments);
      },
      onRemove: function() {
        return console.log('ProjectModalStepEditor onRemove', arguments);
      }
    };
  },
  render: function() {
    return React.createElement("div", {
      "className": "project-modal-step-editor"
    }, React.createElement("header", null, React.createElement("button", {
      "type": "button",
      "className": "secret-button",
      "title": "Remove step",
      "aria-label": "Remove step",
      "onClick": this.props.onRemove
    }, React.createElement("i", {
      "className": "fa fa-times fa-fw"
    }))), React.createElement("p", null, (this.props.media != null ? React.createElement("span", null, React.createElement("img", {
      "className": "project-modal-step-editor-media",
      "src": this.props.media.src
    }), ' ', React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.props.onMediaClear
    }, "Clear")) : void 0), ' ', React.createElement(FileButton, {
      "className": "standard-button",
      "onSelect": this.handleMediaChange
    }, "Select media")), React.createElement("div", null, React.createElement(MarkdownEditor, {
      "className": "full",
      "value": this.props.step.content,
      "onChange": this.handleContentChange
    })));
  },
  handleMediaChange: function(e) {
    var ref;
    return (ref = this.props).onMediaSelect.apply(ref, [e.target.files[0]].concat(slice.call(arguments)));
  },
  handleContentChange: function(e) {
    var ref;
    return (ref = this.props).onChange.apply(ref, ['content', e.target.value].concat(slice.call(arguments)));
  }
});

ProjectModalEditor = React.createClass({displayName: "ProjectModalEditor",
  getDefaultProps: function() {
    return {
      projectModal: null,
      media: null,
      type: null,
      onStepAdd: function() {
        return console.log('ProjectModalEditor onStepAdd', arguments);
      },
      onStepRemove: function() {
        return console.log('ProjectModalEditor onStepRemove', arguments);
      },
      onMediaSelect: function() {
        return console.log('ProjectModalEditor onMediaSelect', arguments);
      },
      onStepChange: function() {
        return console.log('ProjectModalEditor onChange', arguments);
      }
    };
  },
  render: function() {
    var i, step;
    return React.createElement("div", {
      "style": {
        maxWidth: '50ch'
      }
    }, ((function() {
      var j, len, ref, ref1, results;
      if (this.props.projectModal.steps.length === 0) {
        return React.createElement("p", null, "This tutorial has no steps.");
      } else {
        ref = this.props.projectModal.steps;
        results = [];
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          step = ref[i];
          if (step._key == null) {
            step._key = Math.random();
          }
          results.push(React.createElement(ProjectModalStepEditor, {
            "key": step._key,
            "step": step,
            "media": ((ref1 = this.props.media) != null ? ref1[step.media] : void 0),
            "onMediaSelect": this.props.onMediaSelect.bind(null, i),
            "onMediaClear": this.props.onMediaClear.bind(null, i),
            "onChange": this.props.onStepChange.bind(null, i),
            "onRemove": this.props.onStepRemove.bind(null, i)
          }));
        }
        return results;
      }
    }).call(this)), React.createElement("div", null, React.createElement("button", {
      "type": "button",
      "onClick": this.props.onStepAdd
    }, "Add a step")));
  }
});

ProjectModalEditorController = React.createClass({displayName: "ProjectModalEditorController",
  getDefaultProps: function() {
    return {
      project: null,
      projectModal: null,
      media: {},
      delayBeforeSave: 5000,
      type: null,
      onChangeMedia: function() {
        return console.log('ProjectModalEditorController onChangeMedia', arguments);
      },
      onDelete: function() {
        return console.log('ProjectModalEditorController onDelete', arguments);
      }
    };
  },
  componentDidMount: function() {
    this._boundForceUpdate = this.forceUpdate.bind(this);
    return this.props.projectModal.listen(this._boundForceUpdate);
  },
  componentWillUnmount: function() {
    return this.props.projectModal.stopListening(this._boundForceUpdate);
  },
  render: function() {
    return React.createElement(ProjectModalEditor, {
      "projectModal": this.props.projectModal,
      "media": this.props.media,
      "type": this.props.type,
      "onStepAdd": this.handleStepAdd,
      "onStepRemove": this.handleStepRemove,
      "onMediaSelect": this.handleStepMediaChange,
      "onMediaClear": this.handleStepMediaClear,
      "onStepChange": this.handleStepChange
    });
  },
  handleStepAdd: function() {
    this.props.projectModal.steps.push({
      media: '',
      content: ''
    });
    this.props.projectModal.update('steps');
    return this.props.projectModal.save();
  },
  handleStepRemove: function(index) {
    var changes;
    this.handleStepMediaClear(index);
    changes = {};
    changes["steps." + index] = void 0;
    this.props.projectModal.update(changes);
    if (this.props.projectModal.steps.length === 0) {
      return this.props.projectModal["delete"]().then((function(_this) {
        return function() {
          return _this.props.onDelete();
        };
      })(this));
    } else {
      return this.props.projectModal.save();
    }
  },
  handleStepMediaChange: function(index, file) {
    var payload;
    this.handleStepMediaClear(index);
    payload = {
      media: {
        content_type: file.type,
        metadata: {
          filename: file.name
        }
      }
    };
    return apiClient.post(this.props.projectModal._getURL('attached_images'), payload).then((function(_this) {
      return function(media) {
        media = [].concat(media)[0];
        return putFile(media.src, file, {
          'Content-Type': file.type
        }).then(function() {
          var changes;
          changes = {};
          changes["steps." + index + ".media"] = media.id;
          _this.props.projectModal.update(changes);
          return _this.props.projectModal.save().then(function() {
            return _this.props.onChangeMedia();
          });
        });
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return console.error(error);
      };
    })(this));
  },
  handleStepMediaClear: function(index) {
    var changes, ref;
    if ((ref = this.props.media[this.props.projectModal.steps[index].media]) != null) {
      ref["delete"]();
    }
    changes = {};
    changes["steps." + index + ".media"] = void 0;
    this.props.projectModal.update(changes);
    return this.props.projectModal.save();
  },
  handleStepChange: function(index, key, value) {
    var changes;
    changes = {};
    changes["steps." + index + "." + key] = value;
    this.props.projectModal.update(changes);
    return this.saveProjectModal();
  },
  saveProjectModal: function() {
    var boundProjectModalSave;
    if (this._debouncedSaveProjectModal == null) {
      boundProjectModalSave = this.props.projectModal.save.bind(this.props.projectModal);
      this._debouncedSaveProjectModal = debounce(boundProjectModalSave, this.props.delayBeforeSave);
    }
    return this._debouncedSaveProjectModal.apply(this, arguments);
  }
});

ProjectModalCreator = React.createClass({displayName: "ProjectModalCreator",
  getDefaultProps: function() {
    return {
      project: null,
      type: null,
      onCreate: function() {
        return console.log('ProjectModalCreator onCreate', arguments);
      }
    };
  },
  getInitialState: function() {
    return {
      error: null
    };
  },
  render: function() {
    return React.createElement("div", null, React.createElement("p", null, "This project doesnt have a tutorial."), (this.state.error != null ? React.createElement("p", null, this.state.error.toString()) : void 0), React.createElement("p", null, React.createElement("button", {
      "type": "button",
      "onClick": this.handleCreateClick
    }, "Build one")));
  },
  handleCreateClick: function() {
    var projectModalData, projectModalType;
    projectModalType = this.props.type;
    projectModalData = {
      steps: [],
      language: 'en',
      links: {
        project: this.props.project.id
      }
    };
    this.setState({
      error: null
    });
    return apiClient.type(projectModalType).create(projectModalData).save().then((function(_this) {
      return function(createdProjectModal) {
        return _this.props.onCreate(createdProjectModal);
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this));
  }
});

ProjectModalEditorFetcher = React.createClass({displayName: "ProjectModalEditorFetcher",
  getDefaultProps: function() {
    return {
      project: null,
      type: null
    };
  },
  getInitialState: function() {
    return {
      loading: false,
      error: null,
      projectModal: null,
      media: {}
    };
  },
  componentDidMount: function() {
    this._boundForceUpdate = this.forceUpdate.bind(this);
    this.props.project.listen(this._boundForceUpdate);
    return this.fetchProjectModalFor(this.props.project);
  },
  componentWillUnmount: function() {
    return this.props.project.stopListening(this._boundForceUpdate);
  },
  componentWillReceiveProps: function(nextProps) {
    if (nextProps.project !== this.props.project) {
      this.props.project.stopListening(this._boundForceUpdate);
      nextProps.project.listen(this._boundForceUpdate);
      return this.fetchProjectModalFor(nextProps.project);
    }
  },
  fetchProjectModalFor: function(project) {
    this.setState({
      loading: true,
      error: null,
      projectModal: null
    });
    return apiClient.type(this.props.type).get({
      project_id: project.id
    }).then((function(_this) {
      return function(arg) {
        var projectModal;
        projectModal = arg[0];
        _this.setState({
          projectModal: projectModal
        });
        return _this.fetchMediaFor(projectModal);
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          error: error
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          loading: false
        });
      };
    })(this));
  },
  fetchMediaFor: function(projectModal) {
    if (projectModal != null) {
      return projectModal.get('attached_images', {})["catch"]((function(_this) {
        return function() {
          return [];
        };
      })(this)).then((function(_this) {
        return function(mediaResources) {
          var j, len, media, mediaResource;
          media = {};
          for (j = 0, len = mediaResources.length; j < len; j++) {
            mediaResource = mediaResources[j];
            media[mediaResource.id] = mediaResource;
          }
          return _this.setState({
            media: media
          });
        };
      })(this));
    } else {
      return this.setState({
        media: {}
      });
    }
  },
  render: function() {
    if (this.state.loading) {
      return React.createElement("p", null, "Loading...");
    } else if (this.state.error != null) {
      return React.createElement("p", null, this.state.error.toString());
    } else if (this.state.projectModal != null) {
      if (typeof window !== "undefined" && window !== null) {
        window.editingProjectModal = this.state.projectModal;
      }
      return React.createElement(ProjectModalEditorController, {
        "project": this.props.project,
        "projectModal": this.state.projectModal,
        "media": this.state.media,
        "type": this.props.type,
        "onChangeMedia": this.handleChangeToMedia,
        "onDelete": this.handleProjectModalCreateOrDelete
      });
    } else {
      return React.createElement(ProjectModalCreator, {
        "project": this.props.project,
        "type": this.props.type,
        "onCreate": this.handleProjectModalCreateOrDelete
      });
    }
  },
  handleChangeToMedia: function() {
    return this.fetchMediaFor(this.state.projectModal);
  },
  handleProjectModalCreateOrDelete: function() {
    return this.fetchProjectModalFor(this.props.project);
  }
});

module.exports = ProjectModalEditorFetcher;


},{"../components/file-button":72,"../lib/put-file":112,"debounce":"debounce","markdownz":"markdownz","panoptes-client/lib/api-client":549,"react":"react"}],225:[function(require,module,exports){
var AutoSave, ChangeListener, MarkdownEditor, MarkdownHelp, PromiseToSetState, React, alert, apiClient, handleInputChange;

React = require('react');

AutoSave = require('../components/auto-save');

handleInputChange = require('../lib/handle-input-change');

apiClient = require('panoptes-client/lib/api-client');

PromiseToSetState = require('../lib/promise-to-set-state');

MarkdownEditor = require('markdownz').MarkdownEditor;

ChangeListener = require('../components/change-listener');

MarkdownHelp = require('../partials/markdown-help');

alert = require('../lib/alert');

module.exports = React.createClass({
  displayName: 'ProjectPageEditor',
  getDefaultState: function() {
    return {
      pageContent: null
    };
  },
  fetchOrCreate: function() {
    return new Promise((function(_this) {
      return function(resolve, reject) {
        return _this.props.project.get('pages', {
          url_key: _this.props.page
        }).then(function(arg) {
          var page, params;
          page = arg[0];
          if (page != null) {
            return resolve(page);
          } else {
            params = {
              project_pages: {
                url_key: _this.props.page,
                title: _this.props.pageTitle,
                language: _this.props.project.primary_language
              }
            };
            return apiClient.post(_this.props.project._getURL("pages"), params).then(function(arg1) {
              var page;
              page = arg1[0];
              return resolve(page);
            })["catch"](function(e) {
              return reject(e);
            });
          }
        })["catch"](function(e) {
          return reject(e);
        });
      };
    })(this));
  },
  mixins: [PromiseToSetState],
  componentDidMount: function() {
    return this.promiseToSetState({
      pageContent: this.fetchOrCreate()
    });
  },
  render: function() {
    return React.createElement("div", null, (this.state.pending.pageContent != null ? React.createElement("div", null, "Loading") : this.state.rejected.pageContent != null ? React.createElement("div", null, this.state.rejected.pageContent.toString()) : this.state.pageContent != null ? React.createElement(AutoSave, {
      "resource": this.state.pageContent
    }, React.createElement("span", {
      "className": "form-label"
    }, this.props.pageTitle), React.createElement("br", null), React.createElement(ChangeListener, {
      "target": this.state.pageContent
    }, ((function(_this) {
      return function() {
        return React.createElement(MarkdownEditor, {
          "project": _this.props.project,
          "onHelp": (function() {
            return alert(React.createElement(MarkdownHelp, null));
          }),
          "className": "full",
          "name": "content",
          "value": _this.state.pageContent.content,
          "rows": "20",
          "onChange": handleInputChange.bind(_this.state.pageContent)
        });
      };
    })(this)))) : void 0));
  }
});


},{"../components/auto-save":62,"../components/change-listener":63,"../lib/alert":98,"../lib/handle-input-change":103,"../lib/promise-to-set-state":111,"../partials/markdown-help":222,"markdownz":"markdownz","panoptes-client/lib/api-client":549,"react":"react"}],226:[function(require,module,exports){
var LoadingIndicator, MIN_PASSWORD_LENGTH, PromiseToSetState, REMOTE_CHECK_DELAY, React, Translate, apiClient, auth, counterpart, debounce;

counterpart = require('counterpart');

React = require('react');

PromiseToSetState = require('../lib/promise-to-set-state');

auth = require('panoptes-client/lib/auth');

Translate = require('react-translate-component');

LoadingIndicator = require('../components/loading-indicator');

debounce = require('debounce');

apiClient = require('panoptes-client/lib/api-client');

REMOTE_CHECK_DELAY = 1000;

MIN_PASSWORD_LENGTH = 8;

counterpart.registerTranslations('en', {
  registerForm: {
    required: 'Required',
    looksGood: 'Looks good',
    userName: 'User name',
    badChars: "Only letters, numbers, '.', '_', and '-'.",
    nameConflict: 'That username is taken',
    forgotPassword: 'Forget your password?',
    password: 'Password',
    passwordTooShort: 'Must be at least 8 characters',
    confirmPassword: 'Confirm password',
    passwordsDontMatch: 'These dont match',
    email: 'Email address',
    emailConflict: 'An account with this address already exists',
    realName: 'Real name',
    whyRealName: 'Well use this to give you credit in scientific papers, posters, etc',
    agreeToPrivacyPolicy: 'You agree to our %(link)s (required)',
    privacyPolicy: 'privacy policy',
    okayToEmail: 'Its okay to send me email every once in a while.',
    betaTester: 'Id like to help test new projects, and be emailed when theyre available.',
    register: 'Register',
    alreadySignedIn: 'Signed in as %(name)s',
    signOut: 'Sign out'
  }
});

module.exports = React.createClass({
  displayName: 'RegisterForm',
  mixins: [PromiseToSetState],
  getDefaultProps: function() {
    return {
      project: {}
    };
  },
  getInitialState: function() {
    return {
      badNameChars: null,
      nameConflict: null,
      passwordTooShort: null,
      passwordsDontMatch: null,
      emailConflict: null,
      agreedToPrivacyPolicy: null,
      error: null
    };
  },
  render: function() {
    var badNameChars, emailConflict, nameConflict, passwordTooShort, passwordsDontMatch, privacyPolicyLink, ref;
    ref = this.state, badNameChars = ref.badNameChars, nameConflict = ref.nameConflict, passwordTooShort = ref.passwordTooShort, passwordsDontMatch = ref.passwordsDontMatch, emailConflict = ref.emailConflict;
    return React.createElement("form", {
      "method": "POST",
      "onSubmit": this.handleSubmit
    }, React.createElement("label", null, React.createElement("span", {
      "className": "columns-container inline spread"
    }, React.createElement(Translate, {
      "content": "registerForm.userName"
    }), ((badNameChars != null ? badNameChars.length : void 0) > 0 ? React.createElement(Translate, {
      "className": "form-help error",
      "content": "registerForm.badChars"
    }) : "nameConflict" in this.state.pending ? React.createElement(LoadingIndicator, null) : nameConflict != null ? nameConflict ? React.createElement("span", {
      "className": "form-help error"
    }, React.createElement(Translate, {
      "content": "registerForm.nameConflict"
    }), ' ', React.createElement("a", {
      "href": (document.baseURI.slice(0, -1)) + "/reset-password",
      "onClick": this.props.onSuccess
    }, React.createElement(Translate, {
      "content": "registerForm.forgotPassword"
    }))) : React.createElement("span", {
      "className": "form-help success"
    }, React.createElement(Translate, {
      "content": "registerForm.looksGood"
    })) : void 0)), React.createElement("input", {
      "type": "text",
      "ref": "name",
      "className": "standard-input full",
      "disabled": (this.props.user != null),
      "autoFocus": true,
      "onChange": this.handleNameChange
    })), React.createElement("br", null), React.createElement("label", null, React.createElement("span", {
      "className": "columns-container inline spread"
    }, React.createElement(Translate, {
      "content": "registerForm.password"
    }), (passwordTooShort ? React.createElement(Translate, {
      "className": "form-help error",
      "content": "registerForm.passwordTooShort"
    }) : void 0)), React.createElement("input", {
      "type": "password",
      "ref": "password",
      "className": "standard-input full",
      "disabled": (this.props.user != null),
      "onChange": this.handlePasswordChange
    })), React.createElement("br", null), React.createElement("label", null, React.createElement("span", {
      "className": "columns-container inline spread"
    }, React.createElement(Translate, {
      "content": "registerForm.confirmPassword"
    }), React.createElement("br", null), (passwordsDontMatch != null ? passwordsDontMatch ? React.createElement(Translate, {
      "className": "form-help error",
      "content": "registerForm.passwordsDontMatch"
    }) : !passwordTooShort ? React.createElement(Translate, {
      "className": "form-help success",
      "content": "registerForm.looksGood"
    }) : void 0 : void 0)), React.createElement("input", {
      "type": "password",
      "ref": "confirmedPassword",
      "className": "standard-input full",
      "disabled": (this.state.props != null),
      "onChange": this.handlePasswordChange
    })), React.createElement("br", null), React.createElement("label", null, React.createElement("span", {
      "className": "columns-container inline spread"
    }, React.createElement(Translate, {
      "content": "registerForm.email"
    }), ('emailConflict' in this.state.pending ? React.createElement(LoadingIndicator, null) : emailConflict != null ? emailConflict ? React.createElement("span", {
      "className": "form-help error"
    }, React.createElement(Translate, {
      "content": "registerForm.emailConflict"
    }), ' ', React.createElement("a", {
      "href": (document.baseURI.slice(0, -1)) + "/reset-password",
      "onClick": this.props.onSuccess
    }, React.createElement(Translate, {
      "content": "registerForm.forgotPassword"
    }))) : React.createElement(Translate, {
      "className": "form-help success",
      "content": "registerForm.looksGood"
    }) : React.createElement(Translate, {
      "className": "form-help info",
      "content": "registerForm.required"
    }))), React.createElement("input", {
      "type": "text",
      "ref": "email",
      "className": "standard-input full",
      "disabled": (this.state.props != null),
      "onChange": this.handleEmailChange
    })), React.createElement("br", null), React.createElement("label", null, React.createElement("span", {
      "className": "columns-container inline spread"
    }, React.createElement(Translate, {
      "content": "registerForm.realName"
    })), React.createElement("input", {
      "type": "text",
      "ref": "realName",
      "className": "standard-input full",
      "disabled": (this.props.user != null)
    }), React.createElement(Translate, {
      "component": "span",
      "className": "form-help info",
      "content": "registerForm.whyRealName"
    })), React.createElement("br", null), React.createElement("br", null), React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "ref": "agreesToPrivacyPolicy",
      "disabled": (this.props.user != null),
      "onChange": this.handlePrivacyPolicyChange
    }), (privacyPolicyLink = React.createElement("a", {
      "target": "_blank",
      "href": (document.baseURI.slice(0, -1)) + "/privacy"
    }, React.createElement(Translate, {
      "content": "registerForm.privacyPolicy"
    })), null), React.createElement(Translate, {
      "component": "span",
      "content": "registerForm.agreeToPrivacyPolicy",
      "link": privacyPolicyLink
    })), React.createElement("br", null), React.createElement("br", null), React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "ref": "okayToEmail",
      "defaultChecked": true,
      "disabled": (this.props.user != null),
      "onChange": this.forceUpdate.bind(this, null)
    }), React.createElement(Translate, {
      "component": "span",
      "content": "registerForm.okayToEmail"
    })), React.createElement("br", null), React.createElement("label", null, React.createElement("input", {
      "type": "checkbox",
      "ref": "betaTester",
      "disabled": (this.props.user != null),
      "onChange": this.forceUpdate.bind(this, null)
    }), React.createElement(Translate, {
      "component": "span",
      "content": "registerForm.betaTester"
    })), React.createElement("br", null), React.createElement("p", {
      "style": {
        textAlign: 'center'
      }
    }, ('user' in this.state.pending ? React.createElement(LoadingIndicator, null) : this.props.user != null ? React.createElement("span", {
      "className": "form-help warning"
    }, React.createElement(Translate, {
      "content": "registerForm.alreadySignedIn",
      "name": this.props.user.login
    }), ' ', React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.handleSignOut
    }, React.createElement(Translate, {
      "content": "registerForm.signOut"
    }))) : this.state.error != null ? React.createElement("span", {
      "className": "form-help error"
    }, this.state.error.toString()) : React.createElement("span", null, ""))), React.createElement("div", null, React.createElement("button", {
      "type": "submit",
      "className": "standard-button full",
      "disabled": !this.isFormValid() || Object.keys(this.state.pending).length !== 0 || (this.props.user != null)
    }, React.createElement(Translate, {
      "content": "registerForm.register"
    }))));
  },
  handleNameChange: function() {
    var badChars, char, exists, name;
    name = this.refs.name.value;
    exists = name.length !== 0;
    badChars = (function() {
      var i, len, ref, results;
      ref = name.split('');
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        char = ref[i];
        if (char.match(/[\w\-\']/) === null) {
          results.push(char);
        }
      }
      return results;
    })();
    this.setState({
      badNameChars: badChars,
      nameConflict: null,
      nameExists: exists
    });
    if (exists && badChars.length === 0) {
      if (this.debouncedCheckForNameConflict == null) {
        this.debouncedCheckForNameConflict = debounce(this.checkForNameConflict, REMOTE_CHECK_DELAY);
      }
      return this.debouncedCheckForNameConflict(name);
    }
  },
  debouncedCheckForNameConflict: null,
  checkForNameConflict: function(username) {
    return this.promiseToSetState({
      nameConflict: auth.register({
        login: username
      })["catch"](function(error) {
        var ref;
        return (ref = error.message.match(/login(.+)taken/mi)) != null ? ref : false;
      })
    });
  },
  handlePasswordChange: function() {
    var asLong, confirmedPassword, exists, longEnough, matches, password;
    password = this.refs.password.value;
    confirmedPassword = this.refs.confirmedPassword.value;
    exists = password.length !== 0;
    longEnough = password.length >= MIN_PASSWORD_LENGTH;
    asLong = confirmedPassword.length >= password.length;
    matches = password === confirmedPassword;
    return this.setState({
      passwordTooShort: exists ? !longEnough : void 0,
      passwordsDontMatch: exists && asLong ? !matches : void 0
    });
  },
  handleEmailChange: function() {
    var email;
    this.promiseToSetState({
      emailConflict: Promise.resolve(null)
    });
    email = this.refs.email.value;
    if (email.match(/.+@.+\..+/)) {
      if (this.debouncedCheckForEmailConflict == null) {
        this.debouncedCheckForEmailConflict = debounce(this.checkForEmailConflict, REMOTE_CHECK_DELAY);
      }
      return this.debouncedCheckForEmailConflict(email);
    }
  },
  debouncedCheckForEmailConflict: null,
  checkForEmailConflict: function(email) {
    return this.promiseToSetState({
      emailConflict: auth.register({
        email: email
      })["catch"](function(error) {
        var ref;
        return (ref = error.message.match(/email(.+)taken/mi)) != null ? ref : false;
      })
    });
  },
  handlePrivacyPolicyChange: function() {
    return this.setState({
      agreesToPrivacyPolicy: this.refs.agreesToPrivacyPolicy.checked
    });
  },
  isFormValid: function() {
    var agreesToPrivacyPolicy, badNameChars, emailConflict, nameConflict, nameExists, passwordsDontMatch, ref;
    ref = this.state, badNameChars = ref.badNameChars, nameConflict = ref.nameConflict, passwordsDontMatch = ref.passwordsDontMatch, emailConflict = ref.emailConflict, agreesToPrivacyPolicy = ref.agreesToPrivacyPolicy, nameExists = ref.nameExists;
    return (badNameChars != null ? badNameChars.length : void 0) === 0 && !nameConflict && !passwordsDontMatch && !emailConflict && nameExists && agreesToPrivacyPolicy;
  },
  handleSubmit: function(e) {
    var base, beta_email_communication, credited_name, email, global_email_communication, login, password, project_email_communication, project_id, ref;
    e.preventDefault();
    login = this.refs.name.value;
    password = this.refs.password.value;
    email = this.refs.email.value;
    credited_name = this.refs.realName.value;
    global_email_communication = this.refs.okayToEmail.checked;
    project_email_communication = global_email_communication;
    beta_email_communication = this.refs.betaTester.checked;
    project_id = (ref = this.props.project) != null ? ref.id : void 0;
    this.setState({
      error: null
    });
    if (typeof (base = this.props).onSubmit === "function") {
      base.onSubmit();
    }
    return auth.register({
      login: login,
      password: password,
      email: email,
      credited_name: credited_name,
      project_email_communication: project_email_communication,
      global_email_communication: global_email_communication,
      project_id: project_id,
      beta_email_communication: beta_email_communication
    }).then((function(_this) {
      return function() {
        var base1;
        return typeof (base1 = _this.props).onSuccess === "function" ? base1.onSuccess.apply(base1, arguments) : void 0;
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        var base1;
        _this.setState({
          error: error
        });
        return typeof (base1 = _this.props).onFailure === "function" ? base1.onFailure.apply(base1, arguments) : void 0;
      };
    })(this));
  },
  handleSignOut: function() {
    return auth.signOut();
  }
});


},{"../components/loading-indicator":77,"../lib/promise-to-set-state":111,"counterpart":"counterpart","debounce":"debounce","panoptes-client/lib/api-client":549,"panoptes-client/lib/auth":550,"react":"react","react-translate-component":"react-translate-component"}],227:[function(require,module,exports){
var LoadingIndicator, React, ReactDOM, Translate, auth, counterpart;

counterpart = require('counterpart');

React = require('react');

ReactDOM = require('react-dom');

Translate = require('react-translate-component');

auth = require('panoptes-client/lib/auth');

LoadingIndicator = require('../components/loading-indicator');

counterpart.registerTranslations('en', {
  signInForm: {
    signIn: 'Sign in',
    signOut: 'Sign out',
    userName: 'User name or Email Address',
    password: 'Password',
    incorrectDetails: 'Username or password incorrect',
    forgotPassword: 'Forget your password?'
  }
});

module.exports = React.createClass({
  displayName: 'SignInForm',
  getInitialState: function() {
    return {
      busy: false,
      login: '',
      password: '',
      error: null
    };
  },
  render: function() {
    var disabled, ref, ref1;
    disabled = (this.props.user != null) || this.state.busy;
    return React.createElement("form", {
      "method": "POST",
      "onSubmit": this.handleSubmit
    }, React.createElement("label", null, React.createElement(Translate, {
      "content": "signInForm.userName"
    }), React.createElement("input", {
      "type": "text",
      "className": "standard-input full",
      "name": "login",
      "value": ((ref = this.props.user) != null ? ref.login : void 0),
      "disabled": disabled,
      "autoFocus": true,
      "onChange": this.handleInputChange
    })), React.createElement("br", null), React.createElement("label", null, React.createElement(Translate, {
      "content": "signInForm.password"
    }), React.createElement("br", null), React.createElement("input", {
      "type": "password",
      "className": "standard-input full",
      "name": "password",
      "value": ((ref1 = this.props.user) != null ? ref1.password : void 0),
      "disabled": disabled,
      "onChange": this.handleInputChange
    })), React.createElement("p", {
      "style": {
        textAlign: 'center'
      }
    }, (this.props.user != null ? React.createElement("div", {
      "className": "form-help"
    }, "Signed in as ", this.props.user.login, ' ', React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.handleSignOut
    }, "Sign out")) : this.state.error != null ? React.createElement("div", {
      "className": "form-help error"
    }, (this.state.error.message.match(/invalid(.+)password/i) ? React.createElement(Translate, {
      "content": "signInForm.incorrectDetails"
    }) : React.createElement("span", null, this.state.error.toString())), ' ', React.createElement("a", {
      "href": (document.baseURI.slice(0, -1)) + "/reset-password",
      "onClick": this.props.onSuccess
    }, React.createElement(Translate, {
      "content": "signInForm.forgotPassword"
    }))) : this.state.busy ? React.createElement(LoadingIndicator, null) : React.createElement("a", {
      "href": (document.baseURI.slice(0, -1)) + "/reset-password",
      "onClick": this.props.onSuccess
    }, React.createElement(Translate, {
      "content": "signInForm.forgotPassword"
    })))), React.createElement("button", {
      "type": "submit",
      "className": "standard-button full",
      "disabled": disabled || this.state.login.length === 0 || this.state.password.length === 0
    }, React.createElement(Translate, {
      "content": "signInForm.signIn"
    })));
  },
  handleInputChange: function(e) {
    var newState;
    newState = {};
    newState[e.target.name] = e.target.value;
    return this.setState(newState);
  },
  handleSubmit: function(e) {
    e.preventDefault();
    return this.setState({
      working: true
    }, (function(_this) {
      return function() {
        var base, login, password, ref;
        ref = _this.state, login = ref.login, password = ref.password;
        auth.signIn({
          login: login,
          password: password
        }).then(function(user) {
          return _this.setState({
            working: false,
            error: null
          }, function() {
            var base;
            return typeof (base = _this.props).onSuccess === "function" ? base.onSuccess(user) : void 0;
          });
        })["catch"](function(error) {
          return _this.setState({
            working: false,
            error: error
          }, function() {
            var base, ref1;
            if ((ref1 = ReactDOM.findDOMNode(_this).querySelector('[name="login"]')) != null) {
              ref1.focus();
            }
            return typeof (base = _this.props).onFailure === "function" ? base.onFailure(error) : void 0;
          });
        });
        return typeof (base = _this.props).onSubmit === "function" ? base.onSubmit(e) : void 0;
      };
    })(this));
  },
  handleSignOut: function() {
    return this.setState({
      busy: true
    }, (function(_this) {
      return function() {
        return auth.signOut().then(function() {
          return _this.setState({
            busy: false,
            password: ''
          });
        });
      };
    })(this));
  }
});


},{"../components/loading-indicator":77,"counterpart":"counterpart","panoptes-client/lib/auth":550,"react":"react","react-dom":"react-dom","react-translate-component":"react-translate-component"}],228:[function(require,module,exports){
var LoginDialog, React, alert;

React = require('react');

alert = require('../lib/alert');

LoginDialog = require('./login-dialog');

module.exports = React.createClass({
  displayName: 'SignInPrompt',
  getDefaultProps: function() {
    return {
      project: {},
      onChoose: Function.prototype
    };
  },
  render: function() {
    return React.createElement("div", {
      "className": "content-container"
    }, this.props.children, React.createElement("p", null, "Signing in allows you to participate in discussions, allows us to give you credit for your work, and helps the science team make the best use of the data you provide."), React.createElement("p", {
      "className": "columns-container spread inline"
    }, React.createElement("span", null, React.createElement("button", {
      "type": "button",
      "className": "minor-button",
      "onClick": this.dismiss
    }, "No thanks")), React.createElement("span", null, React.createElement("button", {
      "type": "button",
      "className": "standard-button",
      "autoFocus": true,
      "onClick": this.signIn
    }, "Sign in"), ' ', React.createElement("button", {
      "type": "button",
      "className": "standard-button",
      "onClick": this.register
    }, "Register"))));
  },
  dismiss: function() {
    return this.props.onChoose();
  },
  signIn: function() {
    this.props.onChoose();
    return alert((function(_this) {
      return function(resolve) {
        return React.createElement(LoginDialog, {
          "which": "sign-in",
          "project": _this.props.project,
          "onSuccess": resolve
        });
      };
    })(this));
  },
  register: function() {
    this.props.onChoose();
    return alert((function(_this) {
      return function(resolve) {
        return React.createElement(LoginDialog, {
          "which": "register",
          "project": _this.props.project,
          "onSuccess": resolve
        });
      };
    })(this));
  }
});


},{"../lib/alert":98,"./login-dialog":219,"react":"react"}],229:[function(require,module,exports){
var NOOP, React, apiClient, putFile;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

putFile = require('../lib/put-file');

NOOP = Function.prototype;

module.exports = React.createClass({
  displayName: 'SubjectUploader',
  getDefaultProps: function() {
    return {
      subjects: [],
      files: {},
      project: null,
      subjectSet: null,
      autoStart: false,
      onComplete: NOOP
    };
  },
  getInitialState: function() {
    return {
      inProgress: false,
      current: 0,
      batch: [],
      creates: [],
      uploads: [],
      errors: []
    };
  },
  componentDidMount: function() {
    if (this.props.autoStart) {
      return this.start();
    }
  },
  render: function() {
    var error;
    return React.createElement("div", {
      "className": "subject-uploader"
    }, React.createElement("p", null, "Progress: ", React.createElement("strong", null, this.state.current), " \x2F ", this.props.subjects.length), (this.state.errors.length !== 0 ? React.createElement("ul", null, (function() {
      var j, len, ref, results;
      ref = this.state.errors;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        error = ref[j];
        if (error._key == null) {
          error._key = Math.random();
        }
        results.push(React.createElement("li", {
          "key": error._key,
          "className": "form-help error"
        }, error.toString()));
      }
      return results;
    }).call(this)) : void 0), React.createElement("p", {
      "className": "columns-container"
    }, React.createElement("button", {
      "type": "button",
      "className": "standard-button",
      "disabled": !this.state.inProgress,
      "onClick": this.finish
    }, "Pause"), React.createElement("button", {
      "type": "button",
      "className": "major-button",
      "disabled": this.state.inProgress || this.state.current === this.props.subjects.length,
      "onClick": this.start
    }, "Start")));
  },
  start: function() {
    return this.setState({
      inProgress: true
    }, (function(_this) {
      return function() {
        return _this.processNext();
      };
    })(this));
  },
  processNext: function() {
    var filename, locationTypes, subject, subjectData;
    subjectData = this.props.subjects[this.state.current];
    if ((subjectData != null) && this.state.inProgress) {
      locationTypes = (function() {
        var j, len, ref, results;
        ref = subjectData.locations;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          filename = ref[j];
          results.push(this.props.files[filename].type);
        }
        return results;
      }).call(this);
      subject = apiClient.type('subjects').create({
        locations: locationTypes,
        metadata: subjectData.metadata,
        links: {
          project: this.props.project.id
        }
      });
      return subject.save().then((function(_this) {
        return function(subject) {
          var headers, i, typeToUploadURL, uploadURL, uploads;
          uploads = (function() {
            var j, len, ref, results;
            ref = subject.locations;
            results = [];
            for (i = j = 0, len = ref.length; j < len; i = ++j) {
              typeToUploadURL = ref[i];
              uploadURL = typeToUploadURL[Object.keys(typeToUploadURL)[0]];
              headers = {
                'Content-Type': locationTypes[i]
              };
              results.push(putFile(uploadURL, this.props.files[subjectData.locations[i]], headers));
            }
            return results;
          }).call(_this);
          return Promise.all(uploads).then(function(uploads) {
            _this.setState({
              creates: _this.state.creates.concat(subject)
            });
            return uploads;
          });
        };
      })(this)).then((function(_this) {
        return function(success) {
          return _this.setState({
            uploads: _this.state.uploads.concat(success),
            batch: _this.state.batch.concat(subject)
          });
        };
      })(this))["catch"]((function(_this) {
        return function(error) {
          subject["delete"]();
          return _this.setState({
            errors: _this.state.errors.concat(error)
          });
        };
      })(this)).then((function(_this) {
        return function() {
          return _this.setState({
            current: _this.state.current + 1
          }, function() {
            return _this.processNext();
          });
        };
      })(this));
    } else {
      return this.finish();
    }
  },
  finish: function() {
    var id, linkToSubjectSet, newSubjectIDs;
    if (this.state.batch.length !== 0) {
      newSubjectIDs = (function() {
        var j, len, ref, results;
        ref = this.state.batch;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          id = ref[j].id;
          results.push(id);
        }
        return results;
      }).call(this);
      linkToSubjectSet = this.props.subjectSet.addLink('subjects', newSubjectIDs).then((function(_this) {
        return function() {
          return _this.state.batch.splice(0);
        };
      })(this))["catch"]((function(_this) {
        return function(error) {
          return _this.setState({
            errors: _this.state.errors.concat(error)
          });
        };
      })(this));
    }
    if (linkToSubjectSet == null) {
      linkToSubjectSet = Promise.resolve();
    }
    return linkToSubjectSet.then((function(_this) {
      return function() {
        if (_this.state.current === _this.props.subjects.length) {
          _this.props.onComplete({
            creates: _this.state.creates,
            uploads: _this.state.uploads,
            errors: _this.state.errors
          });
        }
        if (_this.isMounted()) {
          return _this.setState({
            inProgress: false
          });
        }
      };
    })(this));
  }
});


},{"../lib/put-file":112,"panoptes-client/lib/api-client":549,"react":"react"}],230:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'ZooniverseLogo',
  getDefaultProps: function() {
    return {
      width: '1em',
      height: '1em'
    };
  },
  render: function() {
    var useHTML;
    useHTML = '<use xlink:href="#zooniverse-logo-source" x="0" y="0" width="100" height="100" />';
    return React.createElement("svg", {
      "viewBox": "0 0 100 100",
      "width": this.props.width,
      "height": this.props.height,
      "className": "zooniverse-logo",
      "dangerouslySetInnerHTML": {
        __html: useHTML
      }
    });
  }
});


},{"react":"react"}],231:[function(require,module,exports){
var React;

React = require('react');

module.exports = React.createClass({
  displayName: 'ZooniverseLogoType',
  getDefaultProps: function() {
    return {
      width: '178px',
      height: '18px'
    };
  },
  render: function() {
    var useHTML;
    if (this.titleID == null) {
      this.titleID = 'logo_' + Math.random();
    }
    useHTML = "<title id=" + this.titleID + ">Zooniverse</title> <use xlink:href='#zooniverse-logotype-source' x='0' y='0' width='178px' height='18px' />";
    return React.createElement("svg", {
      "viewBox": "0 0 178 18",
      "width": this.props.width,
      "height": this.props.height,
      "aria-labelledby": this.titleID,
      "role": "img",
      "className": "zooniverse-logotype",
      "dangerouslySetInnerHTML": {
        __html: useHTML
      }
    });
  }
});


},{"react":"react"}],232:[function(require,module,exports){
(function (process){
var IndexRoute, ONE_UP_REDIRECT, React, Redirect, Route, Router, ref;

Router = (ref = require('react-router'), IndexRoute = ref.IndexRoute, Route = ref.Route, Redirect = ref.Redirect, ref);

React = require('react');

ONE_UP_REDIRECT = React.createClass({displayName: "ONE_UP_REDIRECT",
  componentDidMount: function() {
    var givenPathSegments, pathOneLevelUp;
    givenPathSegments = this.props.location.pathname.split('/');
    givenPathSegments.pop();
    pathOneLevelUp = givenPathSegments.join('/');
    return this.props.history.replace({
      pathname: pathOneLevelUp,
      query: this.props.location.query
    });
  },
  render: function() {
    return null;
  }
});

module.exports = React.createElement(Route, {
  "path": "/",
  "component": require('./partials/app')
}, React.createElement(IndexRoute, {
  "component": require('./pages/home')
}), React.createElement(Route, {
  "path": "home",
  "component": ONE_UP_REDIRECT
}), React.createElement(Route, {
  "path": "about",
  "component": require('./pages/about'),
  "ignoreScrollBehavior": true
}, React.createElement(IndexRoute, {
  "component": require('./pages/about/about-home')
}), React.createElement(Route, {
  "path": "team",
  "component": require('./pages/about/team-page')
}), React.createElement(Route, {
  "path": "publications",
  "component": require('./pages/about/publications-page')
}), React.createElement(Route, {
  "path": "education",
  "component": require('./pages/about/education-page')
}), React.createElement(Route, {
  "path": "contact",
  "component": require('./pages/about/contact-page')
})), React.createElement(Route, {
  "path": "reset-password",
  "component": require('./pages/reset-password')
}), React.createElement(Route, {
  "path": "unsubscribe",
  "component": require('./pages/unsubscribe')
}), React.createElement(Route, {
  "path": "accounts",
  "component": require('./pages/sign-in')
}, React.createElement(Route, {
  "path": "sign-in",
  "component": require('./partials/sign-in-form')
}), React.createElement(Route, {
  "path": "register",
  "component": require('./partials/register-form')
})), React.createElement(Route, {
  "path": "privacy",
  "component": require('./pages/privacy-policy')
}), React.createElement(Route, {
  "path": "security",
  "component": require('./pages/security')
}), React.createElement(Route, {
  "path": "users/:name",
  "component": require('./pages/profile')
}, React.createElement(IndexRoute, {
  "component": require('./pages/profile/feed')
}), React.createElement(Route, {
  "path": "message",
  "component": require('./pages/profile/private-message')
}), React.createElement(Route, {
  "path": "stats",
  "component": require('./pages/profile/stats')
})), React.createElement(Route, {
  "path": "inbox",
  "component": require('./talk/inbox')
}), React.createElement(Route, {
  "path": "inbox/:conversation",
  "component": require('./talk/inbox-conversation')
}), React.createElement(Route, {
  "path": "settings",
  "component": require('./pages/settings')
}, React.createElement(IndexRoute, {
  "component": require('./pages/settings/account')
}), React.createElement(Route, {
  "path": "profile",
  "component": require('./pages/settings/profile')
}), React.createElement(Route, {
  "path": "email",
  "component": require('./pages/settings/email')
})), React.createElement(Route, {
  "path": "projects",
  "component": require('./pages/projects')
}), React.createElement(Route, {
  "path": "projects/:owner/:name",
  "component": require('./pages/project')
}, React.createElement(IndexRoute, {
  "component": require('./pages/project/home')
}), React.createElement(Route, {
  "path": "home",
  "component": ONE_UP_REDIRECT
}), React.createElement(Route, {
  "path": "research",
  "component": require('./pages/project/research')
}), React.createElement(Route, {
  "path": "results",
  "component": require('./pages/project/results')
}), React.createElement(Route, {
  "path": "classify",
  "component": require('./pages/project/classify')
}), React.createElement(Route, {
  "path": "notifications",
  "component": require('./pages/notifications')
}), React.createElement(Route, {
  "path": "talk",
  "component": require('./pages/project/talk')
}, React.createElement(IndexRoute, {
  "component": require('./talk/init')
}), React.createElement(Route, {
  "path": "recents",
  "component": require('./talk/recents')
}), React.createElement(Route, {
  "path": "not-found",
  "component": require('./pages/not-found')
}), React.createElement(Route, {
  "path": "search",
  "component": require('./talk/search')
}), React.createElement(Route, {
  "path": "moderations",
  "component": require('./talk/moderations')
}), React.createElement(Route, {
  "path": "subjects/:id",
  "component": require('./subjects')
}), React.createElement(Route, {
  "path": "recents/:board",
  "component": require('./talk/recents')
}), React.createElement(Route, {
  "path": "tags/:tag",
  "component": require('./talk/tags')
}), React.createElement(Route, {
  "path": ":board",
  "component": require('./talk/board')
}), React.createElement(Route, {
  "path": ":board/:discussion",
  "component": require('./talk/discussion')
})), React.createElement(Route, {
  "path": "faq",
  "component": require('./pages/project/faq')
}), React.createElement(Route, {
  "path": "education",
  "component": require('./pages/project/education')
})), React.createElement(Route, {
  "path": "notifications",
  "component": require('./pages/notifications')
}), React.createElement(Route, {
  "path": ":section/notifications",
  "component": require('./pages/notifications')
}), React.createElement(Route, {
  "path": "talk",
  "component": require('./talk')
}, React.createElement(IndexRoute, {
  "component": require('./talk/init')
}), React.createElement(Route, {
  "path": "recents",
  "component": require('./talk/recents')
}), React.createElement(Route, {
  "path": "not-found",
  "component": require('./pages/not-found')
}), React.createElement(Route, {
  "path": "search",
  "component": require('./talk/search')
}), React.createElement(Route, {
  "path": "moderations",
  "component": require('./talk/moderations')
}), React.createElement(Route, {
  "path": ":board",
  "component": require('./talk/board')
}), React.createElement(Route, {
  "path": "recents/:board",
  "component": require('./talk/recents')
}), React.createElement(Route, {
  "name": "talk-discussion",
  "path": ":board/:discussion",
  "component": require('./talk/discussion')
})), React.createElement(Route, {
  "path": "favorites",
  "component": (require('./pages/collections').FavoritesList)
}, React.createElement(Route, {
  "path": ":owner",
  "component": (require('./pages/collections').FavoritesList)
})), React.createElement(Route, {
  "path": "collections",
  "component": (require('./pages/collections').CollectionsList)
}, React.createElement(Route, {
  "path": ":owner",
  "component": (require('./pages/collections').CollectionsList)
})), React.createElement(Route, {
  "path": "collections/:owner/:name",
  "component": require('./collections/show')
}, React.createElement(IndexRoute, {
  "component": require('./collections/show-list')
}), React.createElement(Route, {
  "path": "settings",
  "component": require('./collections/settings')
}), React.createElement(Route, {
  "path": "collaborators",
  "component": require('./collections/collaborators')
}), React.createElement(Route, {
  "path": "talk",
  "component": require('./collections/show-list')
})), React.createElement(Route, {
  "path": "lab",
  "component": require('./pages/lab')
}), React.createElement(Route, {
  "path": "lab/:projectID",
  "component": require('./pages/lab/project')
}, React.createElement(IndexRoute, {
  "component": require('./pages/lab/project-details')
}), React.createElement(Route, {
  "path": "research",
  "component": require('./pages/lab/research')
}), React.createElement(Route, {
  "path": "results",
  "component": require('./pages/lab/results')
}), React.createElement(Route, {
  "path": "faq",
  "component": require('./pages/lab/faq')
}), React.createElement(Route, {
  "path": "education",
  "component": require('./pages/lab/education')
}), React.createElement(Route, {
  "path": "collaborators",
  "component": require('./pages/lab/collaborators')
}), React.createElement(Route, {
  "path": "media",
  "component": require('./pages/lab/media')
}), React.createElement(Route, {
  "path": "workflow/:workflowID",
  "component": require('./pages/lab/workflow')
}), React.createElement(Route, {
  "path": "workflow/:workflowID/visualize",
  "component": require('./pages/lab/workflow-viewer')
}), React.createElement(Route, {
  "path": "workflow/:workflowID/visualise",
  "component": require('./pages/lab/workflow-viewer')
}), React.createElement(Route, {
  "path": "subject-set/:subjectSetID",
  "component": require('./pages/lab/subject-set')
}), React.createElement(Route, {
  "path": "visibility",
  "component": require('./pages/lab/visibility')
}), React.createElement(Route, {
  "path": "talk",
  "component": require('./pages/lab/talk')
}), React.createElement(Route, {
  "path": "data-exports",
  "component": require('./pages/lab/data-dumps')
}), React.createElement(Route, {
  "path": "tutorial",
  "component": require('./pages/lab/tutorial')
}), React.createElement(Route, {
  "path": "guide",
  "component": require('./pages/lab/field-guide')
}), React.createElement(Route, {
  "path": "mini-course",
  "component": require('./pages/lab/mini-course')
})), React.createElement(Route, {
  "path": "lab-policies",
  "component": require('./pages/lab/lab-policies')
}), React.createElement(Route, {
  "path": "lab-how-to",
  "component": require('./pages/lab/how-to-page')
}), React.createElement(Route, {
  "path": "lab-best-practices",
  "component": require('./pages/lab/best-practices')
}, React.createElement(Route, {
  "path": "introduction",
  "component": require('./pages/lab/best-practices/introduction')
}), React.createElement(Route, {
  "path": "great-project",
  "component": require('./pages/lab/best-practices/great-project')
}), React.createElement(Route, {
  "path": "launch-rush",
  "component": require('./pages/lab/best-practices/launch-rush')
}), React.createElement(Route, {
  "path": "the-long-haul",
  "component": require('./pages/lab/best-practices/the-long-haul')
}), React.createElement(Route, {
  "path": "resources",
  "component": require('./pages/lab/best-practices/resources')
})), React.createElement(Route, {
  "path": "admin",
  "component": require('./pages/admin')
}, React.createElement(IndexRoute, {
  "component": require('./pages/admin/user-settings')
}), React.createElement(Route, {
  "path": "project_status",
  "component": require('./pages/admin/project-status-list')
}), React.createElement(Route, {
  "path": "project_status/:owner/:name",
  "component": require('./pages/admin/project-status')
})), React.createElement(Route, {
  "path": "todo",
  "component": (function() {
    return React.createElement("div", {
      "className": "content-container"
    }, React.createElement("i", {
      "className": "fa fa-cogs"
    }), " TODO");
  })
}), React.createElement(Route, {
  "path": "dev/workflow-tasks-editor",
  "component": require('./components/workflow-tasks-editor')
}), React.createElement(Route, {
  "path": "dev/classifier",
  "component": (process.env.NODE_ENV === 'production' ? require('./pages/not-found') : require('./pages/dev-classifier'))
}), React.createElement(Route, {
  "path": "dev/ribbon",
  "component": require('./components/classifications-ribbon')
}), React.createElement(Route, {
  "path": "*",
  "component": require('./pages/not-found')
}));


}).call(this,require('_process'))
},{"./collections/collaborators":52,"./collections/settings":59,"./collections/show":61,"./collections/show-list":60,"./components/classifications-ribbon":65,"./components/workflow-tasks-editor":97,"./pages/about":125,"./pages/about/about-home":122,"./pages/about/contact-page":123,"./pages/about/education-page":124,"./pages/about/publications-page":126,"./pages/about/team-page":127,"./pages/admin":128,"./pages/admin/project-status":130,"./pages/admin/project-status-list":129,"./pages/admin/user-settings":131,"./pages/collections":132,"./pages/dev-classifier":133,"./pages/home":135,"./pages/lab":155,"./pages/lab/best-practices":139,"./pages/lab/best-practices/great-project":138,"./pages/lab/best-practices/introduction":140,"./pages/lab/best-practices/launch-rush":141,"./pages/lab/best-practices/resources":142,"./pages/lab/best-practices/the-long-haul":143,"./pages/lab/collaborators":144,"./pages/lab/data-dumps":145,"./pages/lab/education":146,"./pages/lab/faq":147,"./pages/lab/field-guide":152,"./pages/lab/how-to-page":154,"./pages/lab/lab-policies":156,"./pages/lab/media":158,"./pages/lab/mini-course":159,"./pages/lab/project":161,"./pages/lab/project-details":160,"./pages/lab/research":162,"./pages/lab/results":163,"./pages/lab/subject-set":164,"./pages/lab/talk":165,"./pages/lab/tutorial":166,"./pages/lab/visibility":167,"./pages/lab/workflow":175,"./pages/lab/workflow-viewer":170,"./pages/not-found":176,"./pages/notifications":177,"./pages/privacy-policy":184,"./pages/profile":187,"./pages/profile/feed":186,"./pages/profile/private-message":188,"./pages/profile/stats":189,"./pages/project":195,"./pages/project/classify":190,"./pages/project/education":191,"./pages/project/faq":192,"./pages/project/home":194,"./pages/project/research":198,"./pages/project/results":199,"./pages/project/talk":200,"./pages/projects":201,"./pages/reset-password":202,"./pages/security":203,"./pages/settings":206,"./pages/settings/account":204,"./pages/settings/email":205,"./pages/settings/profile":207,"./pages/sign-in":208,"./pages/unsubscribe":209,"./partials/app":211,"./partials/register-form":226,"./partials/sign-in-form":227,"./subjects":237,"./talk":260,"./talk/board":242,"./talk/discussion":253,"./talk/inbox":259,"./talk/inbox-conversation":257,"./talk/init":261,"./talk/moderations":292,"./talk/recents":296,"./talk/search":299,"./talk/tags":301,"_process":503,"react":"react","react-router":"react-router"}],233:[function(require,module,exports){
var CollectionPreview, Loading, React, apiClient;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

Loading = require('../components/loading-indicator');

CollectionPreview = require('../collections/preview');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'SubjectCollectionList',
    componentWillMount: function() {
      return this.getCollections();
    },
    getInitialState: function() {
      return {
        collections: null
      };
    },
    getCollections: function() {
      var query;
      query = {
        subject_id: this.props.subject.id,
        page_size: 20,
        sort: '-created_at',
        include: 'owner'
      };
      return apiClient.type('collections').get(query).then((function(_this) {
        return function(collections) {
          return _this.setState({
            collections: collections
          });
        };
      })(this));
    },
    render: function() {
      var collection;
      if (!this.state.collections) {
        return React.createElement(Loading, null);
      }
      if (this.state.collections.length > 0) {
        return React.createElement("div", {
          "className": "subject-collection-list"
        }, React.createElement("h2", null, "Collections:"), React.createElement("div", {
          "className": "subject-collection-list-container"
        }, (function() {
          var i, len, ref, results;
          ref = this.state.collections;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            collection = ref[i];
            results.push(React.createElement(CollectionPreview, {
              "key": "collection-" + collection.id,
              "collection": collection
            }));
          }
          return results;
        }).call(this)));
      } else {
        return React.createElement("p", null, "There are no collections yet");
      }
    }
  });
}


},{"../collections/preview":58,"../components/loading-indicator":77,"panoptes-client/lib/api-client":549,"react":"react"}],234:[function(require,module,exports){
var History, Link, Loading, NewDiscussionForm, PromiseRenderer, QuickSubjectCommentForm, React, SignInPrompt, alert, ref, talkClient;

React = require('react');

ref = require('react-router'), History = ref.History, Link = ref.Link;

talkClient = require('panoptes-client/lib/talk-client');

NewDiscussionForm = require('../talk/discussion-new-form');

QuickSubjectCommentForm = require('../talk/quick-subject-comment-form');

PromiseRenderer = require('../components/promise-renderer');

Loading = require('../components/loading-indicator');

SignInPrompt = require('../partials/sign-in-prompt');

alert = require('../lib/alert');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'SubjectCommentForm',
    mixins: [History],
    componentWillMount: function() {
      return Promise.all([this.getBoards(), this.getSubjectDefaultBoard()]).then((function(_this) {
        return function() {
          return _this.setState({
            loading: false
          });
        };
      })(this));
    },
    getInitialState: function() {
      return {
        loading: true,
        tab: 0
      };
    },
    getBoards: function() {
      return talkClient.type('boards').get({
        section: this.props.section,
        subject_default: false
      }).then((function(_this) {
        return function(boards) {
          return _this.setState({
            boards: boards
          });
        };
      })(this));
    },
    getSubjectDefaultBoard: function() {
      return talkClient.type('boards').get({
        section: this.props.section,
        subject_default: true
      }).then((function(_this) {
        return function(arg) {
          var subjectDefaultBoard;
          subjectDefaultBoard = arg[0];
          return _this.setState({
            subjectDefaultBoard: subjectDefaultBoard
          });
        };
      })(this));
    },
    onCreateDiscussion: function(createdDiscussion) {
      var board, discussion, name, owner, ref1;
      ref1 = this.props.params, owner = ref1.owner, name = ref1.name;
      board = createdDiscussion.board_id;
      discussion = createdDiscussion.id;
      return this.history.pushState(null, "/projects/" + owner + "/" + name + "/talk/" + board + "/" + discussion);
    },
    linkToClassifier: function(text) {
      var name, owner, ref1;
      ref1 = this.props.project.slug.split('/'), owner = ref1[0], name = ref1[1];
      return React.createElement(Link, {
        "to": "/projects/" + owner + "/" + name + "/classify"
      }, text);
    },
    popup: function() {
      return alert(function(resolve) {
        return React.createElement(SignInPrompt, {
          "onChoose": resolve
        });
      });
    },
    loginPrompt: function() {
      return React.createElement("p", null, "Please", ' ', React.createElement("button", {
        "className": "link-style",
        "type": "button",
        "onClick": this.popup
      }, "sign in"), ' ', "to contribute to subject discussions");
    },
    notSetup: function() {
      return React.createElement("p", null, "There are no discussion boards setup for this project yet. Check back soon!");
    },
    quickComment: function() {
      if (this.state.subjectDefaultBoard) {
        return React.createElement(QuickSubjectCommentForm, React.__spread({}, this.props, {
          "subject": this.props.subject,
          "user": this.props.user
        }));
      } else {
        return React.createElement("p", null, "There is no default board for subject comments setup yet, Please", ' ', React.createElement("button", {
          "className": "link-style",
          "onClick": ((function(_this) {
            return function() {
              return _this.setState({
                tab: 1
              });
            };
          })(this))
        }, "start a new discussion"), ' ', "or ", this.linkToClassifier('return to classifying'));
      }
    },
    startDiscussion: function() {
      return React.createElement(NewDiscussionForm, {
        "user": this.props.user,
        "subject": this.props.subject,
        "onCreateDiscussion": this.onCreateDiscussion
      });
    },
    renderTab: function() {
      switch (this.state.tab) {
        case 0:
          return this.quickComment();
        case 1:
          return this.startDiscussion();
      }
    },
    render: function() {
      if (this.state.loading) {
        return React.createElement(Loading, null);
      }
      if (!this.state.boards) {
        return this.notSetup();
      }
      if (!this.props.user) {
        return this.loginPrompt();
      }
      return React.createElement("div", null, React.createElement("div", {
        "className": "tabbed-content"
      }, React.createElement("div", {
        "className": "tabbed-content-tabs"
      }, React.createElement("div", {
        "className": "subject-page-tabs"
      }, React.createElement("div", {
        "className": "tabbed-content-tab " + (this.state.tab === 0 ? 'active' : ''),
        "onClick": ((function(_this) {
          return function() {
            return _this.setState({
              tab: 0
            });
          };
        })(this))
      }, "Add a note about this subject"), React.createElement("div", {
        "className": "tabbed-content-tab " + (this.state.tab === 1 ? 'active' : ''),
        "onClick": ((function(_this) {
          return function() {
            return _this.setState({
              tab: 1
            });
          };
        })(this))
      }, "Start a new discussion")))), this.renderTab());
    }
  });
}


},{"../components/loading-indicator":77,"../components/promise-renderer":86,"../lib/alert":98,"../partials/sign-in-prompt":228,"../talk/discussion-new-form":251,"../talk/quick-subject-comment-form":295,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],235:[function(require,module,exports){
var Comment, Loading, Paginator, React, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

Comment = require('../talk/comment');

Paginator = require('../talk/lib/paginator');

Loading = require('../components/loading-indicator');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'SubjectCommentList',
    componentWillMount: function() {
      return this.getComments();
    },
    componentWillReceiveProps: function(nextProps) {
      if (nextProps.location.query.page !== this.props.location.query.page) {
        return this.getComments(nextProps.location.query.page);
      }
    },
    getDefaultProps: function() {
      return {
        location: {
          query: {
            page: 1
          }
        }
      };
    },
    getInitialState: function() {
      return {
        meta: {}
      };
    },
    getComments: function(page) {
      var query;
      if (page == null) {
        page = this.props.location.query.page;
      }
      query = {
        section: this.props.section,
        focus_id: this.props.subject.id,
        focus_type: 'Subject',
        page: page || 1,
        sort: '-created_at'
      };
      return talkClient.type('comments').get(query).then((function(_this) {
        return function(comments) {
          var meta, ref;
          meta = ((ref = comments[0]) != null ? ref.getMeta() : void 0) || {};
          return _this.setState({
            comments: comments,
            meta: meta
          });
        };
      })(this));
    },
    render: function() {
      var comment;
      if (!this.state.comments) {
        return React.createElement(Loading, null);
      }
      if (this.state.comments.length > 0) {
        return React.createElement("div", null, React.createElement("h2", null, "Comments:"), React.createElement("div", null, (function() {
          var i, len, ref, results;
          ref = this.state.comments;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            comment = ref[i];
            results.push(React.createElement(Comment, {
              "key": "comment-" + comment.id,
              "data": comment,
              "locked": true,
              "linked": true
            }));
          }
          return results;
        }).call(this)), (+this.state.meta.page_count > 1 ? React.createElement(Paginator, {
          "page": +this.state.meta.page,
          "pageCount": +this.state.meta.page_count
        }) : void 0));
      } else {
        return React.createElement("p", null, "There are no comments yet");
      }
    }
  });
}


},{"../components/loading-indicator":77,"../talk/comment":248,"../talk/lib/paginator":273,"panoptes-client/lib/talk-client":553,"react":"react"}],236:[function(require,module,exports){
var DiscussionPreview, Loading, React, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

DiscussionPreview = require('../talk/discussion-preview');

Loading = require('../components/loading-indicator');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'SubjectDiscussionList',
    componentWillMount: function() {
      return this.getDiscussions();
    },
    getInitialState: function() {
      return {
        discussions: null
      };
    },
    getDiscussions: function() {
      var query;
      query = {
        section: this.props.section,
        focus_id: this.props.subject.id,
        focus_type: 'Subject',
        page_size: 20,
        sort: '-created_at'
      };
      return talkClient.type('discussions').get(query).then((function(_this) {
        return function(discussions) {
          return _this.setState({
            discussions: discussions
          });
        };
      })(this));
    },
    render: function() {
      var discussion;
      if (!this.state.discussions) {
        return React.createElement(Loading, null);
      }
      if (this.state.discussions.length > 0) {
        return React.createElement("div", null, React.createElement("h2", null, "Discussions:"), React.createElement("div", null, (function() {
          var i, len, ref, results;
          ref = this.state.discussions;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            discussion = ref[i];
            results.push(React.createElement(DiscussionPreview, React.__spread({}, this.props, {
              "key": "discussion-" + discussion.id,
              "discussion": discussion,
              "locked": true,
              "linked": true
            })));
          }
          return results;
        }).call(this)));
      } else {
        return React.createElement("p", null, "There are no discussions yet");
      }
    }
  });
}


},{"../components/loading-indicator":77,"../talk/discussion-preview":252,"panoptes-client/lib/talk-client":553,"react":"react"}],237:[function(require,module,exports){
var ActiveUsers, PopularTags, ProjectLinker, React, SubjectCollectionList, SubjectCommentForm, SubjectCommentList, SubjectDiscussionList, SubjectMentionList, SubjectViewer, apiClient, talkClient;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

talkClient = require('panoptes-client/lib/talk-client');

SubjectViewer = require('../components/subject-viewer');

PopularTags = require('../talk/popular-tags');

ActiveUsers = require('../talk/active-users');

ProjectLinker = require('../talk/lib/project-linker');

SubjectCommentForm = require('./comment-form');

SubjectCommentList = require('./comment-list');

SubjectDiscussionList = require('./discussion-list');

SubjectMentionList = require('./mention-list');

SubjectCollectionList = require('./collection-list');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'Subject',
    getInitialState: function() {
      return {
        subject: null
      };
    },
    componentWillMount: function() {
      return this.setSubject();
    },
    componentWillReceiveProps: function(nextProps) {
      var ref, ref1;
      if (((ref = nextProps.params) != null ? ref.id : void 0) !== ((ref1 = this.props.params) != null ? ref1.id : void 0)) {
        return this.setSubject();
      }
    },
    setSubject: function() {
      var subjectId;
      subjectId = this.props.params.id.toString();
      return apiClient.type('subjects').get(subjectId).then((function(_this) {
        return function(subject) {
          return _this.setState({
            subject: subject
          });
        };
      })(this));
    },
    render: function() {
      return React.createElement("div", {
        "className": "subject-page talk"
      }, React.createElement("div", {
        "className": "talk-list-content"
      }, React.createElement("section", null, (this.state.subject ? React.createElement("div", null, React.createElement("h1", null, "Subject ", this.state.subject.id), React.createElement(SubjectViewer, {
        "subject": this.state.subject,
        "user": this.props.user,
        "project": this.props.project,
        "linkToFullImage": true
      }), React.createElement(SubjectCommentList, React.__spread({
        "subject": this.state.subject
      }, this.props)), React.createElement(SubjectCollectionList, React.__spread({
        "subject": this.state.subject
      }, this.props)), React.createElement(SubjectDiscussionList, React.__spread({
        "subject": this.state.subject
      }, this.props)), React.createElement(SubjectMentionList, React.__spread({
        "subject": this.state.subject
      }, this.props)), React.createElement(SubjectCommentForm, React.__spread({
        "subject": this.state.subject
      }, this.props))) : void 0)), React.createElement("div", {
        "className": "talk-sidebar"
      }, React.createElement("section", null, React.createElement(PopularTags, {
        "header": React.createElement("h3", null, "Popular Tags:"),
        "section": this.props.section,
        "type": "Subject",
        "id": this.props.params.id,
        "project": this.props.project
      })), React.createElement("section", null, React.createElement(ActiveUsers, {
        "section": this.props.section
      })), React.createElement("section", null, React.createElement("h3", null, "Projects:"), React.createElement(ProjectLinker, {
        "user": this.props.user
      })))));
    }
  });
}


},{"../components/subject-viewer":90,"../talk/active-users":239,"../talk/lib/project-linker":275,"../talk/popular-tags":293,"./collection-list":233,"./comment-form":234,"./comment-list":235,"./discussion-list":236,"./mention-list":238,"panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react"}],238:[function(require,module,exports){
var Comment, Loading, Paginator, React, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

Comment = require('../talk/comment');

Paginator = require('../talk/lib/paginator');

Loading = require('../components/loading-indicator');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'SubjectMentionList',
    componentWillMount: function() {
      return this.getMentions();
    },
    getInitialState: function() {
      return {
        mentions: null
      };
    },
    getMentions: function() {
      var query;
      query = {
        section: this.props.section,
        mentionable_id: this.props.subject.id,
        mentionable_type: 'Subject',
        sort: '-created_at',
        page_size: 20,
        include: 'comment'
      };
      return talkClient.type('mentions').get(query).then((function(_this) {
        return function(mentions) {
          return Promise.all(mentions.map(function(mention) {
            return mention.get('comment').then(function(comment) {
              return mention.update({
                comment: comment
              });
            });
          })).then(function(mentions) {
            return _this.setState({
              mentions: mentions
            });
          });
        };
      })(this));
    },
    render: function() {
      var i, mention;
      if (!this.state.mentions) {
        return React.createElement(Loading, null);
      }
      if (this.state.mentions.length > 0) {
        return React.createElement("div", null, React.createElement("h2", null, "Mentions:"), React.createElement("div", null, (function() {
          var j, len, ref, results;
          ref = this.state.mentions;
          results = [];
          for (i = j = 0, len = ref.length; j < len; i = ++j) {
            mention = ref[i];
            results.push(React.createElement(Comment, {
              "key": "mention-" + mention.comment.id + "-" + i,
              "data": mention.comment,
              "locked": true,
              "linked": true
            }));
          }
          return results;
        }).call(this)));
      } else {
        return React.createElement("span", null);
      }
    }
  });
}


},{"../components/loading-indicator":77,"../talk/comment":248,"../talk/lib/paginator":273,"panoptes-client/lib/talk-client":553,"react":"react"}],239:[function(require,module,exports){
var Link, Paginator, React, apiClient, sugarApiClient, sugarClient, talkClient,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

sugarClient = require('panoptes-client/lib/sugar').sugarClient;

apiClient = require('panoptes-client/lib/api-client');

sugarApiClient = require('panoptes-client/lib/sugar').sugarApiClient;

Link = require('react-router').Link;

Paginator = require('./lib/paginator');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'ActiveUsers',
    getInitialState: function() {
      return {
        userRecords: {},
        users: [],
        total: 0,
        pageCount: 0,
        perPage: 10,
        page: 1
      };
    },
    componentDidMount: function() {
      return this.update();
    },
    componentWillUnmount: function() {
      return this.resetTimer();
    },
    update: function() {
      this.restartTimer();
      return this.getActiveUserIds().then((function(_this) {
        return function(userIds) {
          var onPage, page, pageCount;
          pageCount = _this.pageCount(userIds);
          page = _this.boundedPage(pageCount);
          onPage = _this.userIdsOnPage(userIds, page);
          return _this.fetchUncachedUsers(onPage).then(_this.cacheUsers).then(function(users) {
            var activeUsers, id;
            activeUsers = (function() {
              var i, len, results;
              results = [];
              for (i = 0, len = onPage.length; i < len; i++) {
                id = onPage[i];
                if (this.state.userRecords[id] != null) {
                  results.push(this.state.userRecords[id]);
                }
              }
              return results;
            }).call(_this);
            _this.setState({
              userRecords: _this.state.userRecords,
              users: activeUsers,
              page: page,
              pageCount: pageCount,
              total: userIds.length
            });
            return _this.restartTimer();
          })["catch"](function() {
            return _this.restartTimer();
          });
        };
      })(this));
    },
    cacheUsers: function(users) {
      var i, len, results, user;
      results = [];
      for (i = 0, len = users.length; i < len; i++) {
        user = users[i];
        results.push(this.state.userRecords[user.id] = user);
      }
      return results;
    },
    fetchUncachedUsers: function(ids) {
      var cachedIds, id, uncachedIds;
      cachedIds = Object.keys(this.state.userRecords);
      uncachedIds = (function() {
        var i, len, results;
        results = [];
        for (i = 0, len = ids.length; i < len; i++) {
          id = ids[i];
          if (indexOf.call(cachedIds, id) < 0) {
            results.push(id);
          }
        }
        return results;
      })();
      if (uncachedIds.length > 0) {
        return apiClient.type('users').get({
          id: uncachedIds
        });
      } else {
        return Promise.resolve([]);
      }
    },
    userIdsOnPage: function(ids, page) {
      var offset;
      offset = (page - 1) * this.state.perPage;
      return ids.slice(offset, offset + this.state.perPage);
    },
    getActiveUserIds: function() {
      return sugarApiClient.get('/active_users', {
        channel: this.props.section
      }).then((function(_this) {
        return function(activeUserIds) {
          var user;
          return ((function() {
            var i, len, results;
            results = [];
            for (i = 0, len = activeUserIds.length; i < len; i++) {
              user = activeUserIds[i];
              results.push(user.id);
            }
            return results;
          })()).reverse();
        };
      })(this))["catch"]((function(_this) {
        return function() {
          return _this.restartTimer();
        };
      })(this));
    },
    boundedPage: function(pageCount) {
      if (this.state.page > pageCount) {
        return pageCount;
      } else if (this.state.page < 1) {
        return 1;
      } else {
        return this.state.page;
      }
    },
    pageCount: function(userIds) {
      return Math.ceil(userIds.length / this.state.perPage);
    },
    onPageChange: function(page) {
      this.setState({
        page: page
      });
      return this.update();
    },
    resetTimer: function() {
      if (this.updateTimeout) {
        return clearTimeout(this.updateTimeout);
      }
    },
    restartTimer: function() {
      this.resetTimer();
      return this.updateTimeout = setTimeout(this.update, 10000);
    },
    userLink: function(user) {
      return React.createElement("li", {
        "key": user.id
      }, React.createElement(Link, {
        "to": "/users/" + user.login,
        "title": user.display_name + "'s profile"
      }, user.display_name));
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk-active-users"
      }, React.createElement("h3", null, this.state.total, " Active Participants:"), React.createElement("ul", null, this.state.users.map(this.userLink)), (this.state.pageCount > 1 ? React.createElement(Paginator, {
        "page": +this.state.page,
        "onPageChange": this.onPageChange,
        "pageCount": this.state.pageCount,
        "scrollOnChange": false,
        "firstAndLast": false,
        "pageSelector": false
      }) : void 0));
    }
  });
}


},{"./lib/paginator":273,"panoptes-client/lib/api-client":549,"panoptes-client/lib/sugar":552,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],240:[function(require,module,exports){
var Feedback, React, UserSearch, findDOMNode, ref, talkClient;

React = (ref = require('react'), findDOMNode = ref.findDOMNode, ref);

UserSearch = require('../components/user-search.cjsx');

talkClient = require('panoptes-client/lib/talk-client');

Feedback = require('./mixins/feedback');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'ModerationsZooniverseTeam',
    mixins: [Feedback],
    getInitialState: function() {
      return {
        error: ''
      };
    },
    onClickAddZooniverseTeamMember: function(e) {
      var userId, userSelect;
      if (!window.confirm('Are you sure that you want to add this user to the Zooniverse team?')) {
        return;
      }
      e.preventDefault();
      userSelect = findDOMNode(this).querySelector('[name="userids"]');
      userId = userSelect.value;
      return talkClient.type('roles').create({
        name: 'admin',
        section: 'zooniverse',
        user_id: userId
      }).save().then((function(_this) {
        return function(role) {
          return _this.setFeedback("Zooniverse Team Member Added!");
        };
      })(this))["catch"]((function(_this) {
        return function(e) {
          return _this.setState({
            error: e.message
          });
        };
      })(this));
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk moderations-zooniverse-team content-container"
      }, React.createElement("strong", null, "Add a zooniverse team member"), React.createElement("p", {
        "style": {
          color: 'red'
        }
      }, React.createElement("strong", null, "Careful:"), " You are about to add someone to the Zooniverse team on Talk, this will grant them magical powers in the Zooniverse wide talk, and label them as \'Zooniverse Team\'"), React.createElement(UserSearch, {
        "multi": false
      }), React.createElement("button", {
        "type": "button",
        "onClick": this.onClickAddZooniverseTeamMember
      }, "Add Member to The Zooniverse Team"), this.renderFeedback(), (this.state.error ? React.createElement("p", {
        "className": "talk-error"
      }, this.state.error) : void 0));
    }
  });
}


},{"../components/user-search.cjsx":95,"./mixins/feedback":287,"panoptes-client/lib/talk-client":553,"react":"react"}],241:[function(require,module,exports){
var LatestCommentLink, Link, React, merge, resourceCount;

React = require('react');

Link = require('react-router').Link;

resourceCount = require('./lib/resource-count');

LatestCommentLink = require('./latest-comment-link');

merge = require('lodash.merge');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkBoardDisplay',
    propTypes: {
      data: React.PropTypes.object
    },
    "private": function() {
      return this.props.data.permissions.read !== 'all';
    },
    boardLink: function() {
      var boardId, name, owner, ref;
      ref = this.props.params, owner = ref.owner, name = ref.name;
      boardId = this.props.data.id;
      if (this.props.project) {
        return React.createElement(Link, {
          "to": "/projects/" + owner + "/" + name + "/talk/" + boardId
        }, this.props.data.title);
      } else {
        return React.createElement(Link, {
          "to": "/talk/" + boardId
        }, this.props.data.title);
      }
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk-board-preview " + (this["private"]() ? 'private' : 'all')
      }, (this["private"]() ? React.createElement("i", {
        "className": "board-locked fa fa-lock"
      }) : void 0), React.createElement("div", {
        "className": "preview-content"
      }, React.createElement("h1", null, this.boardLink()), React.createElement("p", null, this.props.data.description), React.createElement(LatestCommentLink, React.__spread({}, this.props, {
        "title": true,
        "project": this.props.project,
        "discussion": this.props.data.latest_discussion,
        "comment": this.props.comment
      }))), React.createElement("div", {
        "className": "preview-stats"
      }, React.createElement("p", null, React.createElement("i", {
        "className": "fa fa-user"
      }), " ", resourceCount(this.props.data.users_count, "Participants")), React.createElement("p", null, React.createElement("i", {
        "className": "fa fa-newspaper-o"
      }), " ", resourceCount(this.props.data.discussions_count, "Discussions")), React.createElement("p", null, React.createElement("i", {
        "className": "fa fa-comment"
      }), " ", resourceCount(this.props.data.comments_count, "Comments"))));
    }
  });
}


},{"./latest-comment-link":262,"./lib/resource-count":277,"lodash.merge":"lodash.merge","react":"react","react-router":"react-router"}],242:[function(require,module,exports){
var ActiveUsers, CommentBox, DiscussionPreview, FollowBoard, History, Link, Loading, Moderation, NewDiscussionForm, PAGE_SIZE, Paginator, PopularTags, ProjectLinker, ROLES, React, ReactDOM, SidebarNotifications, SignInPrompt, SingleSubmitButton, StickyDiscussionList, alert, commentValidations, discussionValidations, getErrors, merge, promptToSignIn, ref, talkClient, talkConfig;

React = require('react');

ReactDOM = require('react-dom');

ref = require('react-router'), Link = ref.Link, History = ref.History;

DiscussionPreview = require('./discussion-preview');

talkClient = require('panoptes-client/lib/talk-client');

CommentBox = require('./comment-box');

FollowBoard = require('./follow-board');

commentValidations = require('./lib/comment-validations');

discussionValidations = require('./lib/discussion-validations');

getErrors = require('./lib/validations').getErrors;

NewDiscussionForm = require('./discussion-new-form');

Paginator = require('./lib/paginator');

Moderation = require('./lib/moderation');

StickyDiscussionList = require('./sticky-discussion-list');

ROLES = require('./lib/roles');

Loading = require('../components/loading-indicator');

SingleSubmitButton = require('../components/single-submit-button');

merge = require('lodash.merge');

talkConfig = require('./config');

SignInPrompt = require('../partials/sign-in-prompt');

alert = require('../lib/alert');

PopularTags = require('./popular-tags');

ActiveUsers = require('./active-users');

ProjectLinker = require('./lib/project-linker');

SidebarNotifications = require('./lib/sidebar-notifications');

promptToSignIn = function() {
  return alert(function(resolve) {
    return React.createElement(SignInPrompt, {
      "onChoose": resolve
    });
  });
};

PAGE_SIZE = talkConfig.boardPageSize;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkBoard',
    mixins: [History],
    getInitialState: function() {
      return {
        discussions: [],
        board: {},
        discussionsMeta: {},
        newDiscussionOpen: false,
        loading: true,
        moderationOpen: false
      };
    },
    getDefaultProps: function() {
      return {
        location: {
          query: {
            page: 1
          }
        }
      };
    },
    componentWillReceiveProps: function(nextProps) {
      var ref1;
      if (nextProps.location.query.page !== this.props.location.query.page) {
        return this.setDiscussions((ref1 = nextProps.location.query.page) != null ? ref1 : 1);
      }
    },
    componentWillMount: function() {
      var ref1;
      this.setDiscussions((ref1 = this.props.location.query.page) != null ? ref1 : 1);
      return this.setBoard();
    },
    discussionsRequest: function(page) {
      var board_id;
      this.setState({
        loading: true
      });
      board_id = +this.props.params.board;
      return talkClient.type('discussions').get({
        board_id: board_id,
        page_size: PAGE_SIZE,
        page: page
      });
    },
    setDiscussions: function(page) {
      if (page == null) {
        page = this.props.location.query.page;
      }
      return this.discussionsRequest(page).then((function(_this) {
        return function(discussions) {
          var discussionsMeta, ref1;
          discussionsMeta = (ref1 = discussions[0]) != null ? ref1.getMeta() : void 0;
          return _this.setState({
            discussions: discussions,
            discussionsMeta: discussionsMeta,
            loading: false
          });
        };
      })(this));
    },
    boardRequest: function() {
      var id;
      id = this.props.params.board.toString();
      return talkClient.type('boards').get(id);
    },
    setBoard: function() {
      return this.boardRequest().then((function(_this) {
        return function(board) {
          return _this.setState({
            board: board
          });
        };
      })(this));
    },
    onCreateDiscussion: function() {
      this.setState({
        newDiscussionOpen: false
      });
      return this.setDiscussions();
    },
    discussionPreview: function(discussion, i) {
      return React.createElement(DiscussionPreview, React.__spread({}, this.props, {
        "key": i,
        "discussion": discussion
      }));
    },
    onClickDeleteBoard: function() {
      var name, owner, projectName, ref1;
      projectName = this.state.board.title.toLowerCase();
      if (window.prompt("Are you sure that you want to delete this board? All of the comments and discussions will be lost forever. Type \"" + projectName + "\" below to confirm:") === projectName) {
        ref1 = this.props.params, owner = ref1.owner, name = ref1.name;
        if (this.state.board.section === 'zooniverse') {
          return this.boardRequest()["delete"]().then((function(_this) {
            return function() {
              return _this.history.pushState(null, "/talk");
            };
          })(this));
        } else {
          return this.boardRequest()["delete"]().then((function(_this) {
            return function() {
              return _this.history.pushState(null, "/projects/" + owner + "/" + name + "/talk");
            };
          })(this));
        }
      }
    },
    onEditBoard: function(e) {
      var board, description, form, input, permissions, read, title, write;
      e.preventDefault();
      form = ReactDOM.findDOMNode(this).querySelector('.talk-edit-board-form');
      input = form.querySelector('input');
      title = input.value;
      description = form.querySelector('textarea').value;
      read = form.querySelector(".roles-read input[name='role-read']:checked").value;
      write = form.querySelector(".roles-write input[name='role-write']:checked").value;
      permissions = {
        read: read,
        write: write
      };
      board = {
        title: title,
        permissions: permissions,
        description: description
      };
      return this.boardRequest().update(board).save().then((function(_this) {
        return function(board) {
          return _this.setState({
            board: board
          });
        };
      })(this));
    },
    onClickNewDiscussion: function() {
      return this.setState({
        newDiscussionOpen: !this.state.newDiscussionOpen
      });
    },
    roleReadLabel: function(data, i) {
      return React.createElement("label", {
        "key": i
      }, React.createElement("input", {
        "type": "radio",
        "name": "role-read",
        "onChange": ((function(_this) {
          return function() {
            return _this.setState({
              board: merge({}, _this.state.board, {
                permissions: {
                  read: data
                }
              })
            });
          };
        })(this)),
        "value": data,
        "checked": this.state.board.permissions.read === data
      }), data);
    },
    roleWriteLabel: function(data, i) {
      return React.createElement("label", {
        "key": i
      }, React.createElement("input", {
        "type": "radio",
        "name": "role-write",
        "onChange": ((function(_this) {
          return function() {
            return _this.setState({
              board: merge({}, _this.state.board, {
                permissions: {
                  write: data
                }
              })
            });
          };
        })(this)),
        "checked": this.state.board.permissions.write === data,
        "value": data
      }), data);
    },
    render: function() {
      var board, ref1, ref2, ref3, ref4, ref5;
      board = this.state.board;
      return React.createElement("div", {
        "className": "talk-board"
      }, React.createElement("h1", {
        "className": "talk-page-header"
      }, (board != null ? board.title : void 0)), React.createElement("p", null, (board != null ? board.description : void 0)), React.createElement(FollowBoard, {
        "user": this.props.user,
        "board": board
      }), (board && (this.props.user != null) ? React.createElement("div", {
        "className": "talk-moderation"
      }, React.createElement(Moderation, {
        "user": this.props.user,
        "section": this.props.section
      }, React.createElement("button", {
        "onClick": ((function(_this) {
          return function() {
            return _this.setState({
              moderationOpen: !_this.state.moderationOpen
            });
          };
        })(this))
      }, React.createElement("i", {
        "className": "fa fa-" + (this.state.moderationOpen ? 'close' : 'warning')
      }), " Moderator Controls")), (this.state.moderationOpen ? React.createElement("div", {
        "className": "talk-moderation-children talk-module"
      }, React.createElement("h2", null, "Moderator Zone:"), (this.props.section !== 'zooniverse' ? React.createElement(Link, {
        "to": "/projects/" + ((ref1 = this.props.params) != null ? ref1.owner : void 0) + "/" + ((ref2 = this.props.params) != null ? ref2.name : void 0) + "/talk/moderations"
      }, "View Reported Comments") : React.createElement(Link, {
        "to": "/talk/moderations"
      }, "View Reported Comments")), ((board != null ? board.title : void 0) ? React.createElement("form", {
        "className": "talk-edit-board-form",
        "onSubmit": this.onEditBoard
      }, React.createElement("h3", null, "Edit Title:"), React.createElement("input", {
        "defaultValue": (board != null ? board.title : void 0)
      }), React.createElement("h3", null, "Edit Description"), React.createElement("textarea", {
        "defaultValue": (board != null ? board.description : void 0)
      }), React.createElement("h4", null, "Can Read:"), React.createElement("div", {
        "className": "roles-read"
      }, ROLES.map(this.roleReadLabel)), React.createElement("h4", null, "Can Write:"), React.createElement("div", {
        "className": "roles-write"
      }, ROLES.map(this.roleWriteLabel)), React.createElement(SingleSubmitButton, {
        "type": "submit",
        "onClick": this.onEditBoard
      }, "Update")) : void 0), React.createElement(SingleSubmitButton, {
        "onClick": this.onClickDeleteBoard
      }, "Delete this board ", React.createElement("i", {
        "className": "fa fa-close"
      })), React.createElement(StickyDiscussionList, {
        "board": board
      })) : void 0)) : void 0), (this.state.board.subject_default ? React.createElement("span", null) : this.props.user != null ? React.createElement("section", null, React.createElement("button", {
        "onClick": this.onClickNewDiscussion
      }, React.createElement("i", {
        "className": "fa fa-" + (this.state.newDiscussionOpen ? 'close' : 'plus')
      }), ' ', "New Discussion"), (this.state.newDiscussionOpen ? React.createElement(NewDiscussionForm, {
        "boardId": +this.props.params.board,
        "onCreateDiscussion": this.onCreateDiscussion,
        "user": this.props.user
      }) : void 0)) : React.createElement("p", null, "Please ", React.createElement("button", {
        "className": "link-style",
        "type": "button",
        "onClick": promptToSignIn
      }, "sign in"), " to create discussions")), React.createElement("div", {
        "className": "talk-list-content"
      }, React.createElement("section", null, (this.state.loading ? React.createElement(Loading, null) : ((ref3 = this.state.discussions) != null ? ref3.length : void 0) ? this.state.discussions.map(this.discussionPreview) : React.createElement("p", null, "There are currently no discussions in this board."))), React.createElement("div", {
        "className": "talk-sidebar"
      }, React.createElement(SidebarNotifications, React.__spread({}, this.props)), React.createElement("section", null, React.createElement("h3", null, (this.props.section === 'zooniverse' ? React.createElement(Link, {
        "className": "sidebar-link",
        "to": "/talk/recents/" + this.props.params.board
      }, "Recent Comments") : React.createElement(Link, {
        "className": "sidebar-link",
        "to": "/projects/" + this.props.params.owner + "/" + this.props.params.name + "/talk/recents/" + this.props.params.board
      }, "Recent Comments")))), React.createElement("section", null, React.createElement(PopularTags, {
        "header": React.createElement("h3", null, "Popular Tags:"),
        "section": this.props.section,
        "project": this.props.project
      })), React.createElement("section", null, React.createElement(ActiveUsers, {
        "section": this.props.section
      })), React.createElement("section", null, React.createElement("h3", null, "Projects:"), React.createElement(ProjectLinker, {
        "user": this.props.user
      })))), React.createElement(Paginator, {
        "page": +((ref4 = this.state.discussionsMeta) != null ? ref4.page : void 0),
        "pageCount": ((ref5 = this.state.discussionsMeta) != null ? ref5.page_count : void 0)
      }));
    }
  });
}


},{"../components/loading-indicator":77,"../components/single-submit-button":88,"../lib/alert":98,"../partials/sign-in-prompt":228,"./active-users":239,"./comment-box":244,"./config":249,"./discussion-new-form":251,"./discussion-preview":252,"./follow-board":254,"./lib/comment-validations":264,"./lib/discussion-validations":267,"./lib/moderation":272,"./lib/paginator":273,"./lib/project-linker":275,"./lib/roles":278,"./lib/sidebar-notifications":279,"./lib/validations":285,"./popular-tags":293,"./sticky-discussion-list":300,"lodash.merge":"lodash.merge","panoptes-client/lib/talk-client":553,"react":"react","react-dom":"react-dom","react-router":"react-router"}],243:[function(require,module,exports){
var Link, PromiseRenderer, React, merge, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

Link = require('react-router').Link;

PromiseRenderer = require('../components/promise-renderer');

merge = require('lodash.merge');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkBreadcrumbs',
    crumbCatch: function(e) {
      if (e.message.indexOf('not allowed to show') !== -1) {
        return this.history.replaceState(null, "/talk/not-found");
      }
    },
    boardLink: function(board) {
      return React.createElement(Link, {
        "to": (this.rootTalkPath()) + "/" + board.id
      }, board.title);
    },
    rootTalkPath: function() {
      var name, owner, ref;
      if (this.props.project) {
        ref = this.props.project.slug.split('/'), owner = ref[0], name = ref[1];
        return "/projects/" + owner + "/" + name + "/talk";
      } else {
        return "/talk";
      }
    },
    render: function() {
      var onBoard, onDiscussion, onRecents, params;
      params = this.props.params;
      onBoard = params.board != null;
      onDiscussion = onBoard && (params.discussion != null);
      onRecents = this.props.route.path.match(/\/talk\/recents/);
      return React.createElement("div", {
        "className": "talk-breadcrumbs"
      }, React.createElement("div", {
        "className": "talk-breadcrumbs"
      }, (onBoard || onRecents ? React.createElement("span", null, React.createElement(Link, {
        "to": this.rootTalkPath()
      }, (this.props.project ? this.props.project.display_name : 'Zooniverse'), " Talk"), (onBoard ? React.createElement("span", null, "\x3E") : void 0)) : void 0), (onBoard ? React.createElement(PromiseRenderer, {
        "promise": talkClient.type('boards').get(params.board),
        "catch": this.crumbCatch
      }, ((function(_this) {
        return function(board) {
          return React.createElement("span", null, (onDiscussion ? React.createElement("span", null, _this.boardLink(board), React.createElement(PromiseRenderer, {
            "promise": talkClient.type('discussions').get(params.discussion),
            "catch": _this.crumbCatch
          }, (function(discussion) {
            return React.createElement("span", null, "\x3E", discussion.title);
          }))) : !onDiscussion && !onRecents ? React.createElement("span", null, board.title) : void 0), (onRecents ? React.createElement("span", null, _this.boardLink(board), React.createElement("span", null, "\x3ERecents")) : void 0));
        };
      })(this))) : onRecents ? React.createElement("span", null, "\x3ERecents") : void 0)));
    }
  });
}


},{"../components/promise-renderer":86,"lodash.merge":"lodash.merge","panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],244:[function(require,module,exports){
var CommentImageSelector, Feedback, Loading, Markdown, MarkdownEditor, MarkdownHelp, React, SingleSubmitButton, ToggleChildren, alert, getSubjectLocation, ref;

React = require('react');

ToggleChildren = require('./mixins/toggle-children');

Feedback = require('./mixins/feedback');

MarkdownHelp = require('../partials/markdown-help');

CommentImageSelector = require('./comment-image-selector');

getSubjectLocation = require('../lib/get-subject-location');

Loading = require('../components/loading-indicator');

SingleSubmitButton = require('../components/single-submit-button');

alert = require('../lib/alert');

ref = require('markdownz'), Markdown = ref.Markdown, MarkdownEditor = ref.MarkdownEditor;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'Commentbox',
    mixins: [ToggleChildren, Feedback],
    propTypes: {
      submit: React.PropTypes.string,
      user: React.PropTypes.object,
      header: React.PropTypes.string,
      placeholder: React.PropTypes.string,
      submitFeedback: React.PropTypes.string,
      onSubmitComment: React.PropTypes.func,
      onCancelClick: React.PropTypes.func
    },
    getDefaultProps: function() {
      return {
        submit: "Submit",
        header: "Add to the discussion +",
        placeholder: "Type your comment here",
        submitFeedback: "Comment Successfully Submitted",
        content: '',
        subject: null,
        user: null
      };
    },
    getInitialState: function() {
      return {
        subject: this.props.subject,
        content: this.props.content,
        reply: null,
        loading: false,
        error: ''
      };
    },
    componentWillReceiveProps: function(nextProps) {
      if (nextProps.reply !== this.props.reply) {
        return this.setState({
          reply: nextProps.reply
        });
      }
    },
    onSubmitComment: function(e) {
      var base, base1, textareaValue;
      e.preventDefault();
      textareaValue = this.state.content;
      if (typeof (base = this.props).validationCheck === "function" ? base.validationCheck(textareaValue) : void 0) {
        return;
      }
      this.setState({
        loading: true
      });
      return typeof (base1 = this.props).onSubmitComment === "function" ? base1.onSubmitComment(e, textareaValue, this.state.subject, this.state.reply).then((function(_this) {
        return function() {
          _this.hideChildren();
          _this.setState({
            subject: null,
            content: '',
            error: '',
            loading: false
          });
          return _this.setFeedback(_this.props.submitFeedback);
        };
      })(this))["catch"]((function(_this) {
        return function(e) {
          return _this.setState({
            error: e.message,
            loading: false
          });
        };
      })(this)) : void 0;
    },
    onInputChange: function(e) {
      return this.setState({
        content: e.target.value
      });
    },
    onImageSelectClick: function(e) {
      return this.toggleComponent('image-selector');
    },
    onSelectImage: function(imageData) {
      this.setState({
        subject: imageData
      });
      return this.hideChildren();
    },
    onClearImageClick: function(e) {
      return this.setState({
        subject: null
      });
    },
    render: function() {
      var feedback, loader, ref1, validationErrors;
      validationErrors = this.props.validationErrors.map((function(_this) {
        return function(message, i) {
          return React.createElement("p", {
            "key": i,
            "className": "talk-validation-error"
          }, message);
        };
      })(this));
      feedback = this.renderFeedback();
      loader = this.state.loading ? React.createElement(Loading, null) : void 0;
      return React.createElement("div", {
        "className": "talk-comment-box"
      }, (this.props.reply ? React.createElement("div", {
        "className": "talk-comment-reply"
      }, React.createElement("div", {
        "style": {
          color: '#afaeae'
        }
      }, "In reply to ", this.props.reply.comment.user_display_name, "\'s comment:"), React.createElement(Markdown, {
        "project": this.props.project
      }, this.props.reply.comment.body), React.createElement("button", {
        "type": "button",
        "onClick": this.props.onClickClearReply
      }, React.createElement("i", {
        "className": "fa fa-close"
      }), " Clear Reply")) : void 0), React.createElement("h1", null, this.props.header), (this.state.subject ? React.createElement("img", {
        "className": "talk-comment-focus-image",
        "src": (getSubjectLocation(this.state.subject).src)
      }) : void 0), React.createElement("form", {
        "className": "talk-comment-form",
        "onSubmit": this.onSubmitComment
      }, React.createElement(MarkdownEditor, {
        "previewing": this.state.loading,
        "placeholder": this.props.placeholder,
        "project": this.props.project,
        "className": "full",
        "value": this.state.content,
        "onChange": this.onInputChange,
        "onHelp": (function() {
          return alert(React.createElement(MarkdownHelp, {
            "talk": true,
            "title": React.createElement("h1", null, "Guide to commenting in Talk")
          }));
        })
      }), React.createElement("section", null, React.createElement("button", {
        "type": "button",
        "className": "talk-comment-image-select-button " + (this.state.showing === 'image-selector' ? 'active' : ''),
        "onClick": this.onImageSelectClick
      }, "Linked Image", (this.state.showing === 'image-selector' ? React.createElement("span", null, "", React.createElement("i", {
        "className": "fa fa-close"
      })) : void 0)), React.createElement(SingleSubmitButton, {
        "type": "submit",
        "onClick": this.onSubmitComment,
        "className": 'talk-comment-submit-button'
      }, this.props.submit), (this.props.onCancelClick ? React.createElement("button", {
        "type": "button",
        "className": "button talk-comment-submit-button",
        "onClick": this.props.onCancelClick
      }, "Cancel") : void 0)), feedback, React.createElement("div", {
        "className": "submit-error"
      }, validationErrors, (ref1 = this.state.error) != null ? ref1 : null)), React.createElement("div", {
        "className": "talk-comment-children"
      }, ((function() {
        switch (this.state.showing) {
          case 'image-selector':
            return React.createElement(CommentImageSelector, {
              "onSelectImage": this.onSelectImage,
              "onClearImageClick": this.onClearImageClick,
              "user": this.props.user
            });
        }
      }).call(this))), loader);
    }
  });
}


},{"../components/loading-indicator":77,"../components/single-submit-button":88,"../lib/alert":98,"../lib/get-subject-location":102,"../partials/markdown-help":222,"./comment-image-selector":245,"./mixins/feedback":287,"./mixins/toggle-children":288,"markdownz":"markdownz","react":"react"}],245:[function(require,module,exports){
var React, SingleSubmitButton, apiClient, getSubjectLocation;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

getSubjectLocation = require('../lib/get-subject-location');

SingleSubmitButton = require('../components/single-submit-button');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkCommentImageSelector',
    getInitialState: function() {
      return {
        subjects: []
      };
    },
    getDefaultProps: function() {
      return {
        header: "Select a linked image"
      };
    },
    componentWillMount: function() {
      return this.setRecents();
    },
    setRecents: function() {
      return this.props.user.get('recents', {
        sort: '-created_at'
      }).then((function(_this) {
        return function(subjects) {
          var j, len, subject;
          for (j = 0, len = subjects.length; j < len; j++) {
            subject = subjects[j];
            subject.type = 'recent';
          }
          return _this.setState({
            subjects: subjects
          });
        };
      })(this))["catch"]((function(_this) {
        return function() {};
      })(this));
    },
    setQuery: function(id) {
      return apiClient.type('subjects').get({
        id: id
      }).then((function(_this) {
        return function(subjects) {
          var j, len, subject;
          for (j = 0, len = subjects.length; j < len; j++) {
            subject = subjects[j];
            subject.type = 'subject';
          }
          _this.setState({
            subjects: subjects
          });
          if ((subjects != null ? subjects.length : void 0) === 1) {
            return _this.setFocusImage(subjects[0]);
          }
        };
      })(this))["catch"]((function(_this) {
        return function() {};
      })(this));
    },
    onSubmitSearch: function(e) {
      var query;
      e.preventDefault();
      query = this.refs.imageSearch.value.trim();
      if (query === "") {
        return this.setRecents();
      } else {
        return this.setQuery(query);
      }
    },
    setFocusImage: function(image) {
      if (image.type === 'subject') {
        return this.props.onSelectImage(image);
      } else if (image.type === 'recent') {
        return image.get('subject').then((function(_this) {
          return function(subject) {
            return _this.props.onSelectImage(subject);
          };
        })(this));
      }
    },
    imageItem: function(data, i) {
      return React.createElement("div", {
        "key": data.id,
        "className": "talk-comment-image-item"
      }, React.createElement("img", {
        "src": (getSubjectLocation(data).src)
      }), React.createElement("div", {
        "className": "image-card-select"
      }, React.createElement("button", {
        "onClick": ((function(_this) {
          return function() {
            return _this.setFocusImage(data);
          };
        })(this))
      }, "Select")));
    },
    render: function() {
      var ref;
      return React.createElement("div", {
        "className": "talk-comment-image-selector"
      }, React.createElement("h1", null, this.props.header), React.createElement("form", {
        "onSubmit": this.onSubmitSearch,
        "className": "talk-form talk-search-form"
      }, React.createElement("input", {
        "ref": "imageSearch",
        "type": "search",
        "placeholder": "Search by ID"
      }), React.createElement(SingleSubmitButton, {
        "type": "submit",
        "onClick": this.onSubmitSearch
      }, "Search")), React.createElement("button", {
        "className": 'talk-comment-clear-image-button',
        "onClick": this.props.onClearImageClick
      }, "Clear image"), React.createElement("div", {
        "className": "talk-comment-suggested-images"
      }, (ref = this.state.subjects) != null ? ref.map(this.imageItem) : void 0));
    }
  });
}


},{"../components/single-submit-button":88,"../lib/get-subject-location":102,"panoptes-client/lib/api-client":549,"react":"react"}],246:[function(require,module,exports){
var PAGE_SIZE, PromiseRenderer, React, parseSection, talkConfig;

React = require('react');

PromiseRenderer = require('../components/promise-renderer');

parseSection = require('./lib/parse-section');

talkConfig = require('./config');

PAGE_SIZE = talkConfig.discussionPageSize;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkCommentLink',
    propTypes: {
      comment: React.PropTypes.object,
      pageSize: React.PropTypes.number
    },
    getDefaultProps: function() {
      return {
        pageSize: PAGE_SIZE
      };
    },
    projectComment: function() {
      return this.props.comment.section !== 'zooniverse';
    },
    projectCommentUrl: function() {
      var comment, ownerName, projectName, ref;
      comment = this.props.comment;
      ref = comment.project_slug.split('/'), ownerName = ref[0], projectName = ref[1];
      return document.baseURI.slice(0, -1) + ("/projects/" + ownerName + "/" + projectName + "/talk/" + comment.board_id + "/" + comment.discussion_id + "?comment=" + comment.id);
    },
    mainTalkCommentUrl: function() {
      var comment;
      comment = this.props.comment;
      return document.baseURI.slice(0, -1) + ("/talk/" + comment.board_id + "/" + comment.discussion_id + "?comment=" + comment.id);
    },
    render: function() {
      var ref, ref1;
      return React.createElement("div", {
        "className": "talk-comment-link"
      }, (this.projectComment() ? React.createElement("a", {
        "href": this.projectCommentUrl()
      }, (ref = this.props.children) != null ? ref : this.projectCommentUrl()) : React.createElement("a", {
        "href": this.mainTalkCommentUrl()
      }, (ref1 = this.props.children) != null ? ref1 : this.mainTalkCommentUrl())));
    }
  });
}


},{"../components/promise-renderer":86,"./config":249,"./lib/parse-section":274,"react":"react"}],247:[function(require,module,exports){
var Feedback, React, talkClient;

React = require('react');

Feedback = require('./mixins/feedback');

talkClient = require('panoptes-client/lib/talk-client');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkCommentReportForm',
    mixins: [Feedback],
    propTypes: {
      comment: React.PropTypes.object
    },
    getInitialState: function() {
      return {
        error: '',
        submitted: false
      };
    },
    onSubmit: function(e) {
      var comment, moderation;
      e.preventDefault();
      comment = this.refs.textarea;
      moderation = {
        section: this.props.comment.section,
        target_id: this.props.comment.id,
        target_type: 'Comment',
        reports: [
          {
            user_id: this.props.comment.user_id,
            message: comment.value
          }
        ]
      };
      return talkClient.type('moderations').create(moderation).save().then((function(_this) {
        return function(moderation) {
          _this.setFeedback('Report submitted. Thank you!');
          return _this.setState({
            submitted: true
          });
        };
      })(this))["catch"]((function(_this) {
        return function(e) {
          return _this.setState({
            error: e.message
          });
        };
      })(this));
    },
    render: function() {
      var error, feedback;
      feedback = this.renderFeedback();
      error = this.state.error;
      return React.createElement("div", {
        "className": "talk-comment-report-form"
      }, feedback, (error ? React.createElement("p", {
        "className": 'submit-error'
      }, error) : void 0), (!this.state.submitted ? React.createElement("form", {
        "className": "talk-comment-report-form-form",
        "onSubmit": this.onSubmit
      }, React.createElement("textarea", {
        "ref": "textarea",
        "placeholder": "Why are you reporting this comment?"
      }), React.createElement("button", {
        "type": "submit"
      }, "Report")) : void 0));
    }
  });
}


},{"./mixins/feedback":287,"panoptes-client/lib/talk-client":553,"react":"react"}],248:[function(require,module,exports){
var Avatar, CommentBox, CommentContextIcon, CommentLink, CommentReportForm, DEFAULT_AVATAR, DisplayRoles, Feedback, Link, Markdown, PromiseRenderer, React, ReactDOM, SingleSubmitButton, SubjectViewer, ToggleChildren, apiClient, commentValidations, getErrors, merge, talkClient, timestamp, upvotedByCurrentUser;

React = require('react');

ReactDOM = require('react-dom');

ToggleChildren = require('./mixins/toggle-children');

commentValidations = require('./lib/comment-validations');

getErrors = require('./lib/validations').getErrors;

Feedback = require('./mixins/feedback');

CommentBox = require('./comment-box');

CommentReportForm = require('./comment-report-form');

CommentLink = require('./comment-link');

upvotedByCurrentUser = require('./lib/upvoted-by-current-user');

PromiseRenderer = require('../components/promise-renderer');

Link = require('react-router').Link;

timestamp = require('./lib/time').timestamp;

apiClient = require('panoptes-client/lib/api-client');

talkClient = require('panoptes-client/lib/talk-client');

Avatar = require('../partials/avatar');

SubjectViewer = require('../components/subject-viewer');

SingleSubmitButton = require('../components/single-submit-button');

DisplayRoles = require('./lib/display-roles');

CommentContextIcon = require('./lib/comment-context-icon');

merge = require('lodash.merge');

Markdown = require('markdownz').Markdown;

DEFAULT_AVATAR = './assets/simple-avatar.jpg';

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkComment',
    mixins: [ToggleChildren, Feedback],
    propTypes: {
      data: React.PropTypes.object,
      onUpdateComment: React.PropTypes.func,
      onDeleteComment: React.PropTypes.func,
      onLikeComment: React.PropTypes.func,
      onClickReply: React.PropTypes.func,
      active: React.PropTypes.bool,
      user: React.PropTypes.object,
      index: React.PropTypes.number,
      locked: React.PropTypes.bool,
      linked: React.PropTypes.bool
    },
    getDefaultProps: function() {
      return {
        active: false,
        locked: false,
        linked: false
      };
    },
    getInitialState: function() {
      return {
        editing: false,
        commentValidationErrors: [],
        replies: []
      };
    },
    componentDidMount: function() {
      if (this.props.active) {
        return ReactDOM.findDOMNode(this).scrollIntoView();
      }
    },
    onClickReply: function(e) {
      return this.props.onClickReply(this.props.data);
    },
    onClickLink: function(e) {
      return this.toggleComponent('link');
    },
    onClickReport: function(e) {
      return this.toggleComponent('report');
    },
    onClickEdit: function(e) {
      React.findDOMNode(this).scrollIntoView();
      this.setState({
        editing: true
      });
      return this.removeFeedback();
    },
    onClickDelete: function(e) {
      return this.props.onDeleteComment(this.props.data.id);
    },
    onCancelClick: function(e) {
      return this.setState({
        editing: false
      });
    },
    onSubmitComment: function(e, textContent, subject) {
      var base;
      return typeof (base = this.props).onUpdateComment === "function" ? base.onUpdateComment(textContent, subject, this.props.data.id).then((function(_this) {
        return function() {
          _this.setState({
            editing: false
          });
          return _this.setFeedback("Comment Updated");
        };
      })(this)) : void 0;
    },
    commentValidations: function(commentBody) {
      var commentValidationErrors;
      commentValidationErrors = getErrors(commentBody, commentValidations);
      this.setState({
        commentValidationErrors: commentValidationErrors
      });
      return !!commentValidationErrors.length;
    },
    onClickLike: function() {
      return this.props.onLikeComment(this.props.data.id);
    },
    upvoteCount: function() {
      return Object.keys(this.props.data.upvotes).length;
    },
    commentSubjectTitle: function(comment, subject) {
      var name, owner, ref;
      ref = this.props.params, owner = ref.owner, name = ref.name;
      if ((comment.focus_type === 'Subject') && (owner && name)) {
        return React.createElement(Link, {
          "to": "/projects/" + owner + "/" + name + "/talk/subjects/" + comment.focus_id
        }, "Subject ", subject.id);
      } else {
        return React.createElement("span", null, "Subject ", subject.id);
      }
    },
    flashHighlightedComment: function(commentId) {
      var reply;
      reply = this.refs["comment-reply-" + commentId];
      reply.classList.add('highlighted');
      return window.setTimeout(((function(_this) {
        return function() {
          return reply.classList.remove('highlighted');
        };
      })(this)), 500);
    },
    onClickRenderReplies: function(e, comment) {
      if (this.state.replies.map(function(c) {
        return c.id;
      }).indexOf(comment.reply_id) !== -1) {
        return this.flashHighlightedComment(comment.reply_id);
      } else {
        return talkClient.type('comments').get(comment.reply_id).then((function(_this) {
          return function(comment) {
            return _this.setState({
              replies: [comment].concat(_this.state.replies)
            });
          };
        })(this));
      }
    },
    replyLine: function(comment) {
      return React.createElement("div", {
        "key": comment.id,
        "className": "comment-reply-line",
        "ref": "comment-reply-" + comment.id
      }, React.createElement("p", null, React.createElement(Link, {
        "to": "/users/" + comment.user_login
      }, comment.user_display_name), (comment.reply_id ? React.createElement("span", null, ' ', "in reply to ", React.createElement(Link, {
        "to": "/users/" + comment.reply_user_login
      }, comment.reply_user_display_name), "\'s", ' ', React.createElement("button", {
        "className": "link-style",
        "type": "button",
        "onClick": ((function(_this) {
          return function(e) {
            return _this.onClickRenderReplies(e, comment);
          };
        })(this))
      }, "comment")) : void 0)), React.createElement(Markdown, {
        "project": this.props.project,
        "content": comment.body
      }));
    },
    shouldShowFocus: function() {
      var isDifferentFocus, isFirstSubjectComment, notInDiscussion;
      if (!this.props.data.focus_id) {
        return false;
      }
      notInDiscussion = !this.props.index;
      isFirstSubjectComment = this.props.index === 0 && this.props.data.discussion_focus_id;
      isDifferentFocus = this.props.data.focus_id !== this.props.data.discussion_focus_id;
      return notInDiscussion || isFirstSubjectComment || isDifferentFocus;
    },
    render: function() {
      var activeClass, feedback, isDeleted, ref, ref1;
      feedback = this.renderFeedback();
      activeClass = this.props.active ? 'active' : '';
      isDeleted = this.props.data.is_deleted ? 'deleted' : '';
      return React.createElement("div", {
        "className": "talk-comment " + activeClass + " " + isDeleted
      }, React.createElement("div", {
        "className": "talk-comment-author"
      }, React.createElement(PromiseRenderer, {
        "promise": apiClient.type('users').get({
          id: this.props.data.user_id
        }).index(0)
      }, ((function(_this) {
        return function(commentOwner) {
          return React.createElement(Avatar, {
            "user": commentOwner
          });
        };
      })(this))), React.createElement("div", null, React.createElement(Link, {
        "to": "/users/" + this.props.data.user_login
      }, this.props.data.user_display_name), React.createElement("div", {
        "className": "user-mention-name"
      }, "@", this.props.data.user_login)), React.createElement(PromiseRenderer, {
        "promise": talkClient.type('roles').get({
          user_id: this.props.data.user_id,
          section: ['zooniverse', this.props.data.section],
          is_shown: true,
          page_size: 100
        })
      }, ((function(_this) {
        return function(roles) {
          return React.createElement(DisplayRoles, {
            "roles": roles,
            "section": _this.props.data.section
          });
        };
      })(this)))), React.createElement("div", {
        "className": "talk-comment-body"
      }, React.createElement(CommentContextIcon, {
        "comment": this.props.data
      }), (this.props.data.reply_id ? React.createElement("div", {
        "className": "talk-comment-reply"
      }, (this.state.replies.length ? React.createElement("div", null, React.createElement("button", {
        "type": "button",
        "className": "clear-replies",
        "onClick": ((function(_this) {
          return function() {
            return _this.setState({
              replies: []
            });
          };
        })(this))
      }, React.createElement("i", {
        "className": "fa fa-close"
      }), " Clear Replies"), React.createElement("div", null, this.state.replies.map(this.replyLine))) : void 0), "\nIn reply to ", React.createElement(Link, {
        "to": "/users/" + this.props.data.reply_user_login
      }, this.props.data.reply_user_display_name), "\'s", ' ', React.createElement("button", {
        "className": "link-style",
        "type": "button",
        "onClick": ((function(_this) {
          return function(e) {
            return _this.onClickRenderReplies(e, _this.props.data);
          };
        })(this))
      }, "comment")) : void 0), feedback, (!this.state.editing ? React.createElement("div", {
        "className": "talk-comment-content"
      }, (this.props.title ? React.createElement("div", {
        "className": "talk-comment-title"
      }, this.props.title) : void 0), React.createElement("p", {
        "className": "talk-comment-date"
      }, timestamp(this.props.data.created_at)), (this.shouldShowFocus() ? React.createElement(PromiseRenderer, {
        "promise": apiClient.type('subjects').get(this.props.data.focus_id),
        "then": ((function(_this) {
          return function(subject) {
            return React.createElement("div", {
              "className": "polaroid-image"
            }, _this.commentSubjectTitle(_this.props.data, subject), React.createElement(SubjectViewer, {
              "subject": subject,
              "user": _this.props.user,
              "project": _this.props.project,
              "linkToFullImage": true
            }));
          };
        })(this)),
        "catch": null
      }) : void 0), React.createElement(Markdown, {
        "content": this.props.data.body,
        "project": this.props.project,
        "header": null
      }), (this.props.linked ? React.createElement("div", {
        "style": {
          textAlign: "right"
        }
      }, React.createElement(CommentLink, {
        "comment": this.props.data
      }, React.createElement("i", {
        "className": "fa fa-comments-o"
      }), " View the discussion")) : void 0), React.createElement("div", {
        "className": "talk-comment-links " + (this.props.locked ? 'locked' : '')
      }, React.createElement(SingleSubmitButton, {
        "className": "talk-comment-like-button",
        "onClick": this.onClickLike
      }, (upvotedByCurrentUser(this.props.user, this.props.data) ? React.createElement("i", {
        "className": "fa fa-thumbs-up upvoted"
      }) : React.createElement("i", {
        "className": "fa fa-thumbs-o-up"
      })), ' ', "Helpful", ' ', "(", this.upvoteCount(), ")"), React.createElement("button", {
        "className": "talk-comment-reply-button",
        "onClick": this.onClickReply
      }, React.createElement("i", {
        "className": "fa fa-reply"
      }), " Reply"), React.createElement("button", {
        "className": "talk-comment-link-button",
        "onClick": this.onClickLink
      }, React.createElement("i", {
        "className": "fa fa-link"
      }), " Link"), (this.props.user != null ? React.createElement("button", {
        "className": "talk-comment-report-button",
        "onClick": this.onClickReport
      }, React.createElement("i", {
        "className": "fa fa-warning"
      }), " Report") : void 0), (+((ref = this.props.data) != null ? ref.user_id : void 0) === +((ref1 = this.props.user) != null ? ref1.id : void 0) ? React.createElement("span", null, React.createElement("button", {
        "className": "talk-comment-edit-button",
        "onClick": this.onClickEdit
      }, React.createElement("i", {
        "className": "fa fa-pencil"
      }), " Edit"), React.createElement(SingleSubmitButton, {
        "className": "talk-comment-delete-button",
        "onClick": this.onClickDelete
      }, React.createElement("i", {
        "className": "fa fa-remove"
      }), " Delete")) : void 0)), React.createElement("div", {
        "className": "talk-comment-children"
      }, ((function() {
        switch (this.state.showing) {
          case 'link':
            return React.createElement(CommentLink, {
              "comment": this.props.data
            });
          case 'report':
            return React.createElement(CommentReportForm, {
              "comment": this.props.data
            });
        }
      }).call(this)))) : React.createElement(CommentBox, {
        "header": "Editing Comment...",
        "content": this.props.data.body,
        "validationCheck": this.commentValidations,
        "validationErrors": this.state.commentValidationErrors,
        "submitFeedback": "Updated!",
        "submit": "Update Comment",
        "onCancelClick": this.onCancelClick,
        "onSubmitComment": this.onSubmitComment,
        "user": this.props.user
      }))));
    }
  });
}


},{"../components/promise-renderer":86,"../components/single-submit-button":88,"../components/subject-viewer":90,"../partials/avatar":212,"./comment-box":244,"./comment-link":246,"./comment-report-form":247,"./lib/comment-context-icon":263,"./lib/comment-validations":264,"./lib/display-roles":268,"./lib/time":280,"./lib/upvoted-by-current-user":282,"./lib/validations":285,"./mixins/feedback":287,"./mixins/toggle-children":288,"lodash.merge":"lodash.merge","markdownz":"markdownz","panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-dom":"react-dom","react-router":"react-router"}],249:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = {
    discussionPageSize: 20,
    inboxPageSize: 10,
    boardPageSize: 10,
    moderationsPageSize: 20,
    recentsPageSize: 20
  };
}


},{}],250:[function(require,module,exports){
var PromiseRenderer, React, moment, talkClient;

React = require('react');

PromiseRenderer = require('../components/promise-renderer');

talkClient = require('panoptes-client/lib/talk-client');

moment = require('moment');

module.exports = React.createClass({
  displayName: 'DataExportButton',
  getInitialState: function() {
    return {
      isAvailable: null,
      exportRequested: false,
      exportError: null
    };
  },
  exportGet: function() {
    return this._exportsGet || (this._exportsGet = talkClient.type('data_requests').get({
      section: this.section(),
      kind: this.props.exportType
    }).then((function(_this) {
      return function(requests) {
        if (requests.length > 0) {
          _this.setState({
            isAvailable: true
          });
        }
        return requests;
      };
    })(this)));
  },
  section: function() {
    return "project-" + this.props.project.id;
  },
  requestDataExport: function() {
    this.setState({
      exportError: null
    });
    return talkClient.type('data_requests').create({
      section: this.section(),
      kind: this.props.exportType
    }).save().then((function(_this) {
      return function() {
        _this._exportsGet = null;
        return _this.setState({
          exportRequested: true
        });
      };
    })(this))["catch"]((function(_this) {
      return function(error) {
        return _this.setState({
          exportError: error
        });
      };
    })(this));
  },
  render: function() {
    return React.createElement("div", null, React.createElement("button", {
      "type": "button",
      "disabled": this.state.exportRequested || this.state.isAvailable,
      "onClick": this.requestDataExport
    }, this.props.label), " ", ' ', React.createElement("small", {
      "className": "form-help"
    }, "JSON format.", ' ', React.createElement(PromiseRenderer, {
      "promise": this.exportGet()
    }, ((function(_this) {
      return function(arg) {
        var mostRecent;
        mostRecent = arg[0];
        if ((mostRecent != null) && (mostRecent != null ? mostRecent.url : void 0)) {
          return React.createElement("span", null, "Most recent data available requested ", moment(mostRecent.created_at).fromNow(), ":", ' ', React.createElement("a", {
            "href": mostRecent.url
          }, "Download"), ".\nAvailable until ", moment(mostRecent.expires_at).calendar(), ".");
        } else if (mostRecent != null) {
          return React.createElement("span", null, "Most recent data available requested ", moment(mostRecent.created_at).fromNow(), ":", ' ', mostRecent.state);
        } else {
          return React.createElement("span", null, "No recent requests");
        }
      };
    })(this))), React.createElement("br", null)), (this.state.exportError != null ? React.createElement("div", {
      "className": "form-help error"
    }, this.state.exportError.toString()) : this.state.exportRequested ? React.createElement("div", {
      "className": "form-help success"
    }, "Weve received your request, check your email for a link to your data soon!") : void 0));
  }
});


},{"../components/promise-renderer":86,"moment":"moment","panoptes-client/lib/talk-client":553,"react":"react"}],251:[function(require,module,exports){
var CommentBox, Loading, PromiseRenderer, React, ReactDOM, commentValidations, discussionValidations, getErrors, projectSection, talkClient;

React = require('react');

ReactDOM = require('react-dom');

CommentBox = require('./comment-box');

getErrors = require('./lib/validations').getErrors;

commentValidations = require('./lib/comment-validations');

discussionValidations = require('./lib/discussion-validations');

talkClient = require('panoptes-client/lib/talk-client');

Loading = require('../components/loading-indicator');

PromiseRenderer = require('../components/promise-renderer');

projectSection = require('../talk/lib/project-section');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'DiscussionNewForm',
    propTypes: {
      boardId: React.PropTypes.number,
      onCreateDiscussion: React.PropTypes.func,
      subject: React.PropTypes.object
    },
    getInitialState: function() {
      return {
        discussionValidationErrors: [],
        loading: false
      };
    },
    discussionValidations: function(commentBody) {
      var commentErrors, discussionErrors, discussionTitle, discussionValidationErrors;
      discussionTitle = ReactDOM.findDOMNode(this).querySelector('.new-discussion-title').value;
      commentErrors = getErrors(commentBody, commentValidations);
      discussionErrors = getErrors(discussionTitle, discussionValidations);
      discussionValidationErrors = commentErrors.concat(discussionErrors);
      this.setState({
        discussionValidationErrors: discussionValidationErrors
      });
      return !!discussionValidationErrors.length;
    },
    onSubmitDiscussion: function(e, commentText, subject) {
      var board_id, body, comment, comments, discussion, focus_id, focus_type, form, ref, title, titleInput, user_id;
      this.setState({
        loading: true
      });
      form = ReactDOM.findDOMNode(this).querySelector('.talk-board-new-discussion');
      titleInput = form.querySelector('input[type="text"]');
      title = titleInput.value;
      user_id = this.props.user.id;
      board_id = (ref = this.props.boardId) != null ? ref : +form.querySelector('label > input[type="radio"]:checked').value;
      body = commentText;
      focus_id = subject != null ? subject.id : void 0;
      if (!!focus_id) {
        focus_type = 'Subject';
      }
      comment = !!focus_id ? {
        user_id: user_id,
        body: body,
        focus_id: focus_id,
        focus_type: focus_type
      } : {
        user_id: user_id,
        body: body
      };
      comments = [comment];
      discussion = {
        title: title,
        user_id: user_id,
        board_id: board_id,
        comments: comments
      };
      return talkClient.type('discussions').create(discussion).save().then((function(_this) {
        return function(discussion) {
          var base;
          _this.setState({
            loading: false
          });
          titleInput.value = '';
          return typeof (base = _this.props).onCreateDiscussion === "function" ? base.onCreateDiscussion(discussion) : void 0;
        };
      })(this));
    },
    boardRadio: function(board, i) {
      return React.createElement("label", {
        "key": board.id
      }, React.createElement("input", {
        "type": "radio",
        "name": "board",
        "defaultChecked": i === 0,
        "pre-check": true,
        "the": true,
        "first": true,
        "value": board.id
      }), board.title);
    },
    render: function() {
      return React.createElement("div", {
        "className": "discussion-new-form"
      }, React.createElement("div", {
        "className": "talk-board-new-discussion"
      }, React.createElement("h2", null, "Create a discussion +"), (!this.props.boardId ? React.createElement(PromiseRenderer, {
        "promise": this.props.subject.get('project')
      }, ((function(_this) {
        return function(project) {
          return React.createElement(PromiseRenderer, {
            "promise": talkClient.type('boards').get({
              section: projectSection(project),
              subject_default: false
            })
          }, (function(boards) {
            return React.createElement("div", null, React.createElement("h2", null, "Board"), boards.map(_this.boardRadio));
          }));
        };
      })(this))) : void 0), React.createElement("input", {
        "className": "new-discussion-title",
        "type": "text",
        "placeholder": "Discussion Title"
      }), React.createElement(CommentBox, {
        "user": this.props.user,
        "header": null,
        "validationCheck": this.discussionValidations,
        "validationErrors": this.state.discussionValidationErrors,
        "submitFeedback": "Discussion successfully created",
        "placeholder": "Add a comment here to start the discussion.\nThis comment will appear at the start of the discussion.",
        "onSubmitComment": this.onSubmitDiscussion,
        "subject": this.props.subject,
        "submit": "Create Discussion"
      }), (this.state.loading ? React.createElement(Loading, null) : void 0)));
    }
  });
}


},{"../components/loading-indicator":77,"../components/promise-renderer":86,"../talk/lib/project-section":276,"./comment-box":244,"./lib/comment-validations":264,"./lib/discussion-validations":267,"./lib/validations":285,"panoptes-client/lib/talk-client":553,"react":"react","react-dom":"react-dom"}],252:[function(require,module,exports){
var LatestCommentLink, Link, PromiseRenderer, React, State, Thumbnail, apiClient, getSubjectLocation, resourceCount, talkClient;

React = require('react');

Link = require('react-router').Link;

resourceCount = require('./lib/resource-count');

State = require('react-router').State;

PromiseRenderer = require('../components/promise-renderer');

LatestCommentLink = require('./latest-comment-link');

Thumbnail = require('../components/thumbnail');

apiClient = require('panoptes-client/lib/api-client');

talkClient = require('panoptes-client/lib/talk-client');

getSubjectLocation = require('../lib/get-subject-location');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkDiscussionPreview',
    propTypes: {
      discussion: React.PropTypes.object
    },
    discussionLink: function() {
      var discussion, name, owner, projectTalk, ref, ref1, ref2, ref3;
      discussion = this.props.discussion;
      if (((ref = this.props.params) != null ? ref.owner : void 0) && ((ref1 = this.props.params) != null ? ref1.name : void 0)) {
        ref2 = this.props.params, owner = ref2.owner, name = ref2.name;
        projectTalk = "/projects/" + owner + "/" + name + "/talk/" + discussion.board_id + "/" + discussion.id;
        return React.createElement(Link, {
          "to": projectTalk
        }, discussion.title);
      } else if (this.props.project) {
        ref3 = this.props.project.slug.split('/'), owner = ref3[0], name = ref3[1];
        projectTalk = "/projects/" + owner + "/" + name + "/talk/" + discussion.board_id + "/" + discussion.id;
        return React.createElement(Link, {
          "to": projectTalk
        }, discussion.title);
      } else {
        return React.createElement(Link, {
          "to": "/talk/" + discussion.board_id + "/" + discussion.id
        }, discussion.title);
      }
    },
    render: function() {
      var comment, discussion, params, ref;
      ref = this.props, params = ref.params, discussion = ref.discussion;
      comment = this.props.comment || discussion.latest_comment;
      return React.createElement("div", {
        "className": "talk-discussion-preview"
      }, React.createElement("div", {
        "className": "preview-content"
      }, (discussion.focus_id && (discussion.focus_type === 'Subject') ? React.createElement("div", {
        "className": "subject-preview"
      }, React.createElement(PromiseRenderer, {
        "catch": null,
        "promise": apiClient.type('subjects').get(discussion.focus_id)
      }, ((function(_this) {
        return function(subject) {
          return React.createElement(Thumbnail, {
            "src": (getSubjectLocation(subject).src),
            "width": 100.
          });
        };
      })(this)))) : void 0), React.createElement("h1", null, (discussion.sticky ? React.createElement("i", {
        "className": "fa fa-thumb-tack talk-sticky-pin"
      }) : void 0), this.discussionLink()), React.createElement(LatestCommentLink, React.__spread({}, this.props, {
        "project": this.props.project,
        "discussion": discussion,
        "comment": this.props.comment,
        "preview": true
      }))), React.createElement("div", {
        "className": "preview-stats"
      }, React.createElement("p", null, React.createElement("i", {
        "className": "fa fa-user"
      }), " ", resourceCount(discussion.users_count, "Participants")), React.createElement("p", null, React.createElement("i", {
        "className": "fa fa-comment"
      }), " ", resourceCount(discussion.comments_count, "Comments"))));
    }
  });
}


},{"../components/promise-renderer":86,"../components/thumbnail":93,"../lib/get-subject-location":102,"./latest-comment-link":262,"./lib/resource-count":277,"panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],253:[function(require,module,exports){
var ActiveUsers, Avatar, Comment, CommentBox, DisplayRoles, FollowDiscussion, History, Link, Moderation, PAGE_SIZE, Paginator, PopularTags, ProjectLinker, PromiseRenderer, React, ReactDOM, Router, SidebarNotifications, SignInPrompt, SingleSubmitButton, alert, commentValidations, getErrors, merge, ref, talkClient, talkConfig, timestamp, upvotedByCurrentUser;

React = require('react');

ReactDOM = require('react-dom');

Comment = require('./comment');

CommentBox = require('./comment-box');

commentValidations = require('./lib/comment-validations');

getErrors = require('./lib/validations').getErrors;

Router = (ref = require('react-router'), History = ref.History, ref);

talkClient = require('panoptes-client/lib/talk-client');

Paginator = require('./lib/paginator');

PromiseRenderer = require('../components/promise-renderer');

SingleSubmitButton = require('../components/single-submit-button');

upvotedByCurrentUser = require('./lib/upvoted-by-current-user');

Moderation = require('./lib/moderation');

timestamp = require('./lib/time').timestamp;

Link = require('react-router').Link;

merge = require('lodash.merge');

Avatar = require('../partials/avatar');

DisplayRoles = require('./lib/display-roles');

talkConfig = require('./config');

SignInPrompt = require('../partials/sign-in-prompt');

alert = require('../lib/alert');

merge = require('lodash.merge');

FollowDiscussion = require('./follow-discussion');

PopularTags = require('./popular-tags');

ActiveUsers = require('./active-users');

ProjectLinker = require('./lib/project-linker');

SidebarNotifications = require('./lib/sidebar-notifications');

PAGE_SIZE = talkConfig.discussionPageSize;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkDiscussion',
    mixins: [History],
    getInitialState: function() {
      return {
        comments: [],
        discussion: {},
        commentsMeta: {},
        commentValidationErrors: [],
        editingTitle: false,
        reply: null,
        moderationOpen: false
      };
    },
    getDefaultProps: function() {
      return {
        location: {
          query: {
            page: 1
          }
        }
      };
    },
    promptToSignIn: function() {
      return alert(function(resolve) {
        return React.createElement(SignInPrompt, {
          "onChoose": resolve
        });
      });
    },
    componentWillReceiveProps: function(nextProps) {
      if (this.props.params.discussion !== nextProps.params.discussion) {
        return this.setDiscussion(nextProps.params.discussion).then((function(_this) {
          return function() {
            var ref1;
            return _this.setComments((ref1 = nextProps.location.query.page) != null ? ref1 : 1);
          };
        })(this));
      } else if (nextProps.location.query.page !== this.props.location.query.page) {
        return this.setComments(nextProps.location.query.page);
      }
    },
    componentDidMount: function() {
      var ref1;
      if ((ref1 = this.props.location.query) != null ? ref1.scrollToLastComment : void 0) {
        return this.shouldScrollToBottom = true;
      }
    },
    componentWillMount: function() {
      return this.setDiscussion().then((function(_this) {
        return function() {
          var commentId, commentNumber, comments, page, ref1, ref2;
          if ((ref1 = _this.props.location.query) != null ? ref1.comment : void 0) {
            commentId = _this.props.location.query.comment;
            comments = _this.state.discussion.links.comments;
            commentNumber = comments.indexOf(commentId) + 1;
            page = Math.ceil(commentNumber / PAGE_SIZE);
            if (page !== _this.props.location.query.page) {
              _this.props.location.query.page = page;
              _this.history.replaceState(null, _this.props.location.pathname, _this.props.location.query);
            }
          }
          return _this.setComments((ref2 = _this.props.location.query.page) != null ? ref2 : 1);
        };
      })(this));
    },
    commentsRequest: function(page) {
      var board, discussion, ref1;
      ref1 = this.props.params, board = ref1.board, discussion = ref1.discussion;
      return talkClient.type('comments').get({
        discussion_id: discussion,
        page_size: PAGE_SIZE,
        page: page
      });
    },
    setComments: function(page) {
      var ref1;
      if (page == null) {
        page = (ref1 = this.props.location.query) != null ? ref1.page : void 0;
      }
      return this.commentsRequest(page).then((function(_this) {
        return function(comments) {
          var board, commentsMeta, name, owner, ref2, ref3, ref4;
          if (comments.length) {
            commentsMeta = (ref2 = (ref3 = comments[0]) != null ? ref3.getMeta() : void 0) != null ? ref2 : {};
            return _this.setState({
              comments: comments,
              commentsMeta: commentsMeta
            }, function() {
              if (_this.shouldScrollToBottom) {
                _this.scrollToBottomOfDiscussion();
                return _this.shouldScrollToBottom = false;
              }
            });
          } else {
            ref4 = _this.props.params, board = ref4.board, owner = ref4.owner, name = ref4.name;
            if (owner && name) {
              return _this.history.pushState(null, "/projects/" + owner + "/" + name + "/talk/" + board);
            } else {
              return _this.history.pushState(null, "/talk/" + board);
            }
          }
        };
      })(this));
    },
    setCommentsMeta: function(page) {
      var ref1;
      if (page == null) {
        page = (ref1 = this.props.location.query) != null ? ref1.page : void 0;
      }
      return this.commentsRequest(page).then((function(_this) {
        return function(comments) {
          var commentsMeta, ref2, ref3;
          commentsMeta = (ref2 = (ref3 = comments[0]) != null ? ref3.getMeta() : void 0) != null ? ref2 : {};
          return _this.setState({
            commentsMeta: commentsMeta
          });
        };
      })(this));
    },
    scrollToBottomOfDiscussion: function() {
      var ref1;
      return (ref1 = ReactDOM.findDOMNode(this)) != null ? ref1.scrollIntoView(false) : void 0;
    },
    discussionsRequest: function(discussion) {
      if (discussion == null) {
        discussion = this.props.params.discussion;
      }
      return talkClient.type('discussions').get({
        id: discussion,
        sort_linked_comments: 'created_at'
      });
    },
    setDiscussion: function(discussion) {
      if (discussion == null) {
        discussion = this.props.params.discussion;
      }
      return this.discussionsRequest(discussion).then((function(_this) {
        return function(discussion) {
          return _this.setState({
            discussion: discussion[0]
          });
        };
      })(this));
    },
    onUpdateComment: function(textContent, subject, commentId) {
      var body, comment, commentToUpdate, discussion, discussion_id, focus_id, focus_type, ref1;
      discussion = this.props.params.discussion;
      commentToUpdate = talkClient.type('comments').get({
        id: commentId
      });
      discussion_id = +discussion;
      body = textContent;
      focus_id = (ref1 = +(subject != null ? subject.id : void 0)) != null ? ref1 : null;
      if (!!focus_id) {
        focus_type = 'Subject';
      }
      comment = merge({}, {
        discussion_id: discussion_id,
        body: body
      }, (!!focus_id ? {
        focus_id: focus_id,
        focus_type: focus_type
      } : void 0));
      return commentToUpdate.update(comment).save().then((function(_this) {
        return function(comment) {
          return _this.setComments(_this.props.location.query.page);
        };
      })(this));
    },
    onDeleteComment: function(commentId) {
      var board, discussion, ref1;
      ref1 = this.props.params, board = ref1.board, discussion = ref1.discussion;
      if (window.confirm("Are you sure that you want to delete this comment?")) {
        return talkClient.type('comments').get({
          id: commentId
        })["delete"]().then((function(_this) {
          return function(deleted) {
            return _this.setComments(_this.props.location.query.page);
          };
        })(this));
      }
    },
    onSubmitComment: function(e, textContent, subject, reply) {
      var body, comment, discussion, discussion_id, focus_id, focus_type, ref1, reply_id, user_id;
      discussion = this.props.params.discussion;
      user_id = this.props.user.id;
      discussion_id = +discussion;
      body = textContent;
      focus_id = (ref1 = +(subject != null ? subject.id : void 0)) != null ? ref1 : null;
      if (reply) {
        reply_id = reply.comment.id;
      }
      if (!!focus_id) {
        focus_type = 'Subject';
      }
      comment = merge({}, {
        user_id: user_id,
        discussion_id: discussion_id,
        body: body
      }, !!focus_id ? {
        focus_id: focus_id,
        focus_type: focus_type
      } : void 0, reply ? {
        reply_id: reply_id
      } : void 0);
      return talkClient.type('comments').create(comment).save().then((function(_this) {
        return function(comment) {
          return _this.setCommentsMeta().then(function() {
            var ref2;
            _this.setComments((ref2 = _this.state.commentsMeta) != null ? ref2.page_count : void 0);
            return _this.setState({
              reply: null
            });
          });
        };
      })(this));
    },
    onLikeComment: function(commentId) {
      return talkClient.type('comments').get(commentId).then((function(_this) {
        return function(comment) {
          var ref1, voteUrl;
          if (+((ref1 = _this.props.user) != null ? ref1.id : void 0) === +comment.user_id) {
            return alert("Hey you can't upvote your own comment!");
          }
          voteUrl = comment.href + (upvotedByCurrentUser(_this.props.user, comment) ? '/remove_upvote' : '/upvote');
          return talkClient.request('put', voteUrl, null, {}).then(function(voted) {
            return _this.setComments(_this.props.location.query.page);
          });
        };
      })(this));
    },
    onClickReply: function(comment) {
      if (!this.props.user) {
        this.promptToSignIn();
      } else {
        this.setState({
          reply: {
            comment: comment
          }
        });
      }
      return ReactDOM.findDOMNode(this).scrollIntoView(false);
    },
    comment: function(data, i) {
      var ref1, ref2;
      return React.createElement(Comment, React.__spread({}, this.props, {
        "project": this.props.project,
        "key": data.id,
        "index": i,
        "data": data,
        "active": +data.id === +((ref1 = this.props.location.query) != null ? ref1.comment : void 0),
        "user": this.props.user,
        "locked": ((ref2 = this.state.discussion) != null ? ref2.locked : void 0),
        "project": this.props.project,
        "onClickReply": this.onClickReply,
        "onLikeComment": this.onLikeComment,
        "onUpdateComment": this.onUpdateComment,
        "onDeleteComment": this.onDeleteComment
      }));
    },
    onClickDeleteDiscussion: function() {
      var deletePhrase;
      deletePhrase = 'delete';
      if (window.prompt("Are you sure that you want to delete this discussion? All of the comments and discussions will be lost forever. Please type \"" + deletePhrase + "\" in the box below to confirm:") === deletePhrase) {
        return this.discussionsRequest()["delete"]().then((function(_this) {
          return function(deleted) {
            var name, owner, ref1;
            _this.setComments(_this.props.location.query.page);
            ref1 = _this.props.params, owner = ref1.owner, name = ref1.name;
            if (owner && name) {
              return _this.history.pushState(null, "/projects/" + owner + "/" + name + "/talk");
            } else {
              return _this.history.pushState(null, "/talk");
            }
          };
        })(this));
      }
    },
    commentValidations: function(commentBody) {
      var commentValidationErrors;
      commentValidationErrors = getErrors(commentBody, commentValidations);
      this.setState({
        commentValidationErrors: commentValidationErrors
      });
      return !!commentValidationErrors.length;
    },
    onEditSubmit: function(e) {
      var boardSelect, board_id, form, locked, sticky, title;
      e.preventDefault();
      form = document.querySelector('.talk-edit-discussion-form');
      boardSelect = form.querySelector('select');
      title = form.querySelector('[name="title"]').value;
      sticky = form.querySelector('[name="sticky"]').checked;
      locked = form.querySelector('[name="locked"]').checked;
      board_id = boardSelect.options[boardSelect.selectedIndex].value;
      return this.discussionsRequest().update({
        title: title,
        sticky: sticky,
        locked: locked,
        board_id: board_id
      }).save().then((function(_this) {
        return function(discussion) {
          var name, owner, ref1;
          if (discussion[0].board_id !== _this.props.params.board) {
            ref1 = _this.props.params, owner = ref1.owner, name = ref1.name;
            if (owner && name) {
              return _this.history.pushState(null, "/projects/" + owner + "/" + name + "/talk/" + board_id + "/", _this.props.location.query);
            } else {
              return _this.history.pushState(null, "/talk/" + board_id + "/", _this.props.location.query);
            }
          } else {
            return _this.setDiscussion();
          }
        };
      })(this));
    },
    lockedMessage: function() {
      return React.createElement("div", {
        "className": "talk-discussion-locked"
      }, React.createElement("i", {
        "className": "fa fa-lock"
      }), " This discussion has been Locked and is read-only");
    },
    onClickEditTitle: function() {
      return this.setState({
        editingTitle: !this.state.editingTitle
      });
    },
    onChangeTitle: function(e) {
      var title;
      e.preventDefault();
      title = this.refs.editTitle.value;
      return this.discussionsRequest().update({
        title: title
      }).save().then((function(_this) {
        return function(discussion) {
          _this.setState({
            editingTitle: false
          });
          return _this.setDiscussion();
        };
      })(this))["catch"]((function(_this) {
        return function(e) {
          return _this.setState({
            editingTitle: false
          });
        };
      })(this));
    },
    render: function() {
      var discussion, ref1;
      discussion = this.state.discussion;
      return React.createElement("div", {
        "className": "talk-discussion"
      }, (!this.state.editingTitle ? React.createElement("h1", {
        "className": "talk-page-header"
      }, (discussion != null ? discussion.title : void 0), ((discussion != null ? discussion.user_id : void 0) === ((ref1 = this.props.user) != null ? ref1.id : void 0) ? React.createElement("span", null, ' ', React.createElement("i", {
        "className": "fa fa-pencil",
        "title": "Edit Title",
        "onClick": this.onClickEditTitle
      })) : void 0)) : React.createElement("h1", null, React.createElement("input", {
        "ref": "editTitle",
        "type": "text",
        "defaultValue": (discussion != null ? discussion.title : void 0),
        "onBlur": this.onChangeTitle
      }))), (discussion && (this.props.user != null) ? React.createElement("div", {
        "className": "talk-moderation"
      }, React.createElement(Moderation, {
        "user": this.props.user,
        "section": this.props.section
      }, React.createElement("button", {
        "onClick": ((function(_this) {
          return function() {
            return _this.setState({
              moderationOpen: !_this.state.moderationOpen
            });
          };
        })(this))
      }, React.createElement("i", {
        "className": "fa fa-" + (this.state.moderationOpen ? 'close' : 'warning')
      }), " Moderator Controls")), (this.state.moderationOpen ? React.createElement("div", {
        "className": "talk-moderation-children talk-module"
      }, React.createElement("h2", null, "Moderator Zone:"), ((discussion != null ? discussion.title : void 0) ? React.createElement("form", {
        "className": "talk-edit-discussion-form",
        "onSubmit": this.onEditSubmit
      }, React.createElement("h3", null, "Edit Title:"), React.createElement("input", {
        "name": "title",
        "type": "text",
        "defaultValue": (discussion != null ? discussion.title : void 0)
      }), React.createElement("label", {
        "className": "toggle"
      }, "Sticky:", React.createElement("input", {
        "name": "sticky",
        "type": "checkbox",
        "defaultChecked": (discussion != null ? discussion.sticky : void 0)
      })), React.createElement("label", {
        "className": "toggle"
      }, "Locked:", React.createElement("input", {
        "name": "locked",
        "type": "checkbox",
        "defaultChecked": (discussion != null ? discussion.locked : void 0)
      })), React.createElement(PromiseRenderer, {
        "promise": talkClient.type('boards').get({
          section: discussion.section,
          page_size: 100
        })
      }, ((function(_this) {
        return function(boards) {
          return React.createElement("div", null, React.createElement("p", null, React.createElement("strong", null, "Board:")), React.createElement("select", {
            "defaultValue": discussion.board_id
          }, boards.map(function(board, i) {
            return React.createElement("option", {
              "key": board.id,
              "value": board.id
            }, board.title);
          })));
        };
      })(this))), React.createElement(SingleSubmitButton, {
        "type": "submit",
        "onClick": this.onEditSubmit
      }, "Update")) : void 0), React.createElement(SingleSubmitButton, {
        "onClick": this.onClickDeleteDiscussion
      }, "Delete this discussion ", React.createElement("i", {
        "className": "fa fa-close"
      }))) : void 0)) : void 0), ((discussion != null ? discussion.locked : void 0) ? this.lockedMessage() : void 0), (discussion && this.props.user ? React.createElement(FollowDiscussion, {
        "user": this.props.user,
        "discussion": discussion
      }) : void 0), React.createElement(Paginator, {
        "page": +this.state.commentsMeta.page,
        "pageCount": this.state.commentsMeta.page_count
      }), React.createElement("div", {
        "className": "talk-list-content"
      }, React.createElement("section", null, React.createElement("div", {
        "className": "talk-discussion-comments " + ((discussion != null ? discussion.locked : void 0) ? 'locked' : '')
      }, this.state.comments.map(this.comment))), React.createElement("div", {
        "className": "talk-sidebar"
      }, React.createElement(SidebarNotifications, React.__spread({}, this.props)), React.createElement("section", null, React.createElement(PopularTags, {
        "header": React.createElement("h3", null, "Popular Tags:"),
        "section": this.props.section,
        "project": this.props.project
      })), React.createElement("section", null, React.createElement(ActiveUsers, {
        "section": this.props.section
      })), React.createElement("section", null, React.createElement("h3", null, "Projects:"), React.createElement(ProjectLinker, {
        "user": this.props.user
      })))), React.createElement(Paginator, {
        "page": +this.state.commentsMeta.page,
        "pageCount": this.state.commentsMeta.page_count
      }), ((discussion != null ? discussion.locked : void 0) ? this.lockedMessage() : this.props.user != null ? React.createElement("section", null, React.createElement("div", {
        "className": "talk-comment-author"
      }, React.createElement(Avatar, {
        "user": this.props.user
      }), React.createElement("p", null, React.createElement(Link, {
        "to": "/users/" + this.props.user.login
      }, this.props.user.display_name)), React.createElement("div", {
        "className": "user-mention-name"
      }, "@", this.props.user.login), React.createElement(PromiseRenderer, {
        "promise": talkClient.type('roles').get({
          user_id: this.props.user.id,
          section: ['zooniverse', discussion.section],
          is_shown: true,
          page_size: 100
        })
      }, ((function(_this) {
        return function(roles) {
          return React.createElement(DisplayRoles, {
            "roles": roles,
            "section": discussion.section
          });
        };
      })(this)))), React.createElement(CommentBox, {
        "user": this.props.user,
        "project": this.props.project,
        "validationCheck": this.commentValidations,
        "validationErrors": this.state.commentValidationErrors,
        "onSubmitComment": this.onSubmitComment,
        "reply": this.state.reply,
        "onClickClearReply": ((function(_this) {
          return function() {
            return _this.setState({
              reply: null
            });
          };
        })(this)),
        "header": null
      })) : React.createElement("p", null, "Please ", React.createElement("button", {
        "className": "link-style",
        "type": "button",
        "onClick": this.promptToSignIn
      }, "sign in"), " to contribute to the discussion")));
    }
  });
}


},{"../components/promise-renderer":86,"../components/single-submit-button":88,"../lib/alert":98,"../partials/avatar":212,"../partials/sign-in-prompt":228,"./active-users":239,"./comment":248,"./comment-box":244,"./config":249,"./follow-discussion":255,"./lib/comment-validations":264,"./lib/display-roles":268,"./lib/moderation":272,"./lib/paginator":273,"./lib/project-linker":275,"./lib/sidebar-notifications":279,"./lib/time":280,"./lib/upvoted-by-current-user":282,"./lib/validations":285,"./popular-tags":293,"lodash.merge":"lodash.merge","panoptes-client/lib/talk-client":553,"react":"react","react-dom":"react-dom","react-router":"react-router"}],254:[function(require,module,exports){
var React, SingleSubmitButton, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

SingleSubmitButton = require('../components/single-submit-button');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'FollowBoard',
    propTypes: {
      board: React.PropTypes.object.isRequired,
      user: React.PropTypes.object.isRequired
    },
    getInitialState: function() {
      return {
        digest: null
      };
    },
    componentWillMount: function() {
      var board;
      board = this.props.board;
      if (board) {
        return this.getSubscriptionFor(board.id);
      }
    },
    componentWillReceiveProps: function(nextProps) {
      var boardId, ref, ref1;
      boardId = (ref = nextProps.board) != null ? ref.id : void 0;
      this.getPreferences();
      if (boardId && boardId !== ((ref1 = this.props.board) != null ? ref1.id : void 0)) {
        return this.getSubscriptionFor(boardId);
      }
    },
    toggle: function(e) {
      e.preventDefault();
      if (this.state.subscription) {
        return this.state.subscription.update({
          enabled: !this.state.subscription.enabled
        }).save().then((function(_this) {
          return function() {
            return _this.getSubscriptionFor(_this.props.board.id);
          };
        })(this));
      } else {
        return talkClient.type('subscriptions').create({
          source_id: this.props.board.id,
          source_type: 'Board',
          category: 'started_discussions'
        }).save().then((function(_this) {
          return function() {
            return _this.getSubscriptionFor(_this.props.board.id);
          };
        })(this));
      }
    },
    follow: function() {
      return talkClient.type('subscriptions').create({
        source_id: this.props.board.id,
        source_type: 'Board',
        category: 'started_discussions'
      }).save().then((function(_this) {
        return function() {
          return _this.getSubscriptionFor(_this.props.board.id);
        };
      })(this));
    },
    buttonLabel: function() {
      var ref;
      if ((ref = this.state.subscription) != null ? ref.enabled : void 0) {
        return 'Unsubscribe';
      } else {
        return 'Subscribe';
      }
    },
    getPreferences: function() {
      return talkClient.type('subscription_preferences').get().then((function(_this) {
        return function(preferences) {
          var i, len, preference, results;
          results = [];
          for (i = 0, len = preferences.length; i < len; i++) {
            preference = preferences[i];
            if (preference.category === 'started_discussions') {
              results.push(_this.setState({
                digest: preference.email_digest
              }));
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this));
    },
    getSubscriptionFor: function(id) {
      return talkClient.type('subscriptions').get({
        source_id: id,
        source_type: 'Board'
      }).then((function(_this) {
        return function(arg) {
          var subscription;
          subscription = arg[0];
          return _this.setState({
            subscription: subscription,
            loaded: true
          });
        };
      })(this));
    },
    render: function() {
      var ref;
      return React.createElement("div", {
        "className": "talk-board-follow"
      }, (this.props.user && this.state.loaded ? React.createElement("div", null, React.createElement(SingleSubmitButton, {
        "onClick": this.toggle
      }, this.buttonLabel()), React.createElement("p", {
        "className": "description"
      }, (((ref = this.state.subscription) != null ? ref.enabled : void 0) ? "You're receiving notifications because you've subscribed to new discussions in this board" : "Subscribe to receive notifications for new discussions in this board"), ' ', (this.state.digest ? "(" + this.state.digest + " email)" : void 0))) : void 0));
    }
  });
}


},{"../components/single-submit-button":88,"panoptes-client/lib/talk-client":553,"react":"react"}],255:[function(require,module,exports){
var React, SingleSubmitButton, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

SingleSubmitButton = require('../components/single-submit-button');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'FollowDiscussion',
    propTypes: {
      discussion: React.PropTypes.object.isRequired,
      user: React.PropTypes.object.isRequired
    },
    getInitialState: function() {
      return {
        followed: null,
        followedDigest: null,
        participating: false,
        participatingDigest: null
      };
    },
    componentWillMount: function() {
      var discussion;
      discussion = this.props.discussion;
      if (discussion) {
        return this.getSubscriptionsFor(discussion.id);
      }
    },
    componentWillReceiveProps: function(nextProps) {
      var discussionId, ref, ref1;
      discussionId = (ref = nextProps.discussion) != null ? ref.id : void 0;
      this.getPreferences();
      if (discussionId && discussionId !== ((ref1 = this.props.discussion) != null ? ref1.id : void 0)) {
        return this.getSubscriptionsFor(discussionId);
      }
    },
    toggleFollowed: function(e) {
      var subscription;
      e.preventDefault();
      subscription = this.state.subscriptions.followed_discussions;
      if (subscription) {
        return this.toggle(subscription);
      } else {
        return this.follow();
      }
    },
    toggleParticipating: function(e) {
      e.preventDefault();
      return this.toggle(this.state.subscriptions.participating_discussions);
    },
    toggle: function(subscription) {
      return subscription.update({
        enabled: !subscription.enabled
      }).save().then((function(_this) {
        return function() {
          return _this.getSubscriptionsFor(_this.props.discussion.id);
        };
      })(this));
    },
    follow: function() {
      return talkClient.type('subscriptions').create({
        source_id: this.props.discussion.id,
        source_type: 'Discussion',
        category: 'followed_discussions'
      }).save().then((function(_this) {
        return function() {
          return _this.getSubscriptionsFor(_this.props.discussion.id);
        };
      })(this));
    },
    buttonLabel: function() {
      if (this.state.followed || this.state.participating) {
        return 'Unsubscribe';
      } else {
        return 'Subscribe';
      }
    },
    followedText: function() {
      if (this.state.followed) {
        return "You're receiving notifications because you've subscribed to this discussion";
      } else {
        return "Subscribe to receive notifications for updates to this discussion";
      }
    },
    digestText: function(category) {
      var digest;
      digest = this.state[category + "Digest"];
      if (digest) {
        return "(" + digest + " email)";
      } else {
        return '';
      }
    },
    getPreferences: function() {
      return talkClient.type('subscription_preferences').get().then((function(_this) {
        return function(preferences) {
          var i, len, newState, preference;
          newState = {};
          for (i = 0, len = preferences.length; i < len; i++) {
            preference = preferences[i];
            if (preference.category === 'followed_discussions') {
              newState.followedDigest = preference.email_digest;
            }
            if (preference.category === 'participating_discussions') {
              newState.participatingDigest = preference.email_digest;
            }
          }
          return _this.setState(newState);
        };
      })(this));
    },
    getSubscriptionsFor: function(id) {
      return talkClient.type('subscriptions').get({
        source_id: id,
        source_type: 'Discussion'
      }).then((function(_this) {
        return function(subscriptions) {
          var i, len, newState, subscription;
          newState = {
            subscriptions: {},
            followed: null,
            participating: null,
            loaded: true
          };
          for (i = 0, len = subscriptions.length; i < len; i++) {
            subscription = subscriptions[i];
            newState.subscriptions[subscription.category] = subscription;
            if (subscription.category === 'followed_discussions') {
              newState.followed = subscription.enabled;
            }
            if (subscription.category === 'participating_discussions') {
              newState.participating = subscription.enabled;
            }
          }
          return _this.setState(newState);
        };
      })(this));
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk-discussion-follow"
      }, (this.props.user && this.state.loaded ? React.createElement("div", null, (this.state.participating ? React.createElement("div", null, React.createElement(SingleSubmitButton, {
        "onClick": this.toggleParticipating
      }, this.buttonLabel()), React.createElement("p", {
        "className": "description"
      }, "You\'re receiving notifications from this discussion because you\'ve joined it ", this.digestText('participating'))) : React.createElement("div", null, React.createElement(SingleSubmitButton, {
        "onClick": this.toggleFollowed
      }, this.buttonLabel()), React.createElement("p", {
        "className": "description"
      }, this.followedText(), " ", this.digestText('followed'))))) : void 0));
    }
  });
}


},{"../components/single-submit-button":88,"panoptes-client/lib/talk-client":553,"react":"react"}],256:[function(require,module,exports){
var React;

React = require('react');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkFootnote',
    render: function() {
      return React.createElement("div", {
        "className": "talk-footnote"
      }, "Talk is a place for Zooniverse volunteers and researchers to discuss their projects, collect and share data, and work together to make new discoveries.");
    }
  });
}


},{"react":"react"}],257:[function(require,module,exports){
var CommentBox, HandlePropChanges, History, Link, Markdown, PromiseRenderer, React, SingleSubmitButton, apiClient, ref, talkClient, timestamp;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

apiClient = require('panoptes-client/lib/api-client');

PromiseRenderer = require('../components/promise-renderer');

SingleSubmitButton = require('../components/single-submit-button');

HandlePropChanges = require('../lib/handle-prop-changes');

Markdown = require('markdownz').Markdown;

CommentBox = require('./comment-box');

ref = require('react-router'), Link = ref.Link, History = ref.History;

timestamp = require('./lib/time').timestamp;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'InboxConversation',
    mixins: [HandlePropChanges, History],
    getInitialState: function() {
      return {
        messages: [],
        messagesMeta: {},
        conversation: {},
        recipients: []
      };
    },
    propChangeHandlers: {
      user: 'setConversation'
    },
    setConversation: function() {
      var conversation_id, ref1, ref2;
      conversation_id = (ref1 = this.props.params) != null ? (ref2 = ref1.conversation) != null ? ref2.toString() : void 0 : void 0;
      return talkClient.type('conversations').get(conversation_id, {
        include: 'users'
      }).then((function(_this) {
        return function(conversation) {
          return apiClient.type('users').get(conversation.links.users).then(function(recipients) {
            return _this.setState({
              conversation: conversation,
              recipients: recipients
            }, _this.setMessagesMeta);
          });
        };
      })(this));
    },
    setMessagesMeta: function() {
      var conversation_id;
      conversation_id = +this.props.params.conversation;
      return talkClient.type('messages').get({
        conversation_id: conversation_id
      }).then((function(_this) {
        return function(messages) {
          var messagesMeta, ref1;
          messagesMeta = (ref1 = messages[0]) != null ? ref1.getMeta() : void 0;
          return _this.setState({
            messagesMeta: messagesMeta
          }, function() {
            return _this.setMessages(messagesMeta.count);
          });
        };
      })(this));
    },
    setMessages: function(count) {
      var conversation_id;
      if (count == null) {
        count = 10;
      }
      conversation_id = +this.props.params.conversation;
      return talkClient.type('messages').get({
        conversation_id: conversation_id,
        page_size: count
      }).then((function(_this) {
        return function(messages) {
          var messagesMeta;
          messagesMeta = messages[0].getMeta();
          return _this.setState({
            messages: messages,
            messagesMeta: messagesMeta
          });
        };
      })(this));
    },
    message: function(data, i) {
      return React.createElement("div", {
        "className": "conversation-message",
        "key": data.id
      }, React.createElement(PromiseRenderer, {
        "promise": apiClient.type('users').get(data.user_id)
      }, ((function(_this) {
        return function(commentOwner) {
          return React.createElement("span", null, React.createElement("strong", null, React.createElement(Link, {
            "to": "/users/" + commentOwner.login
          }, commentOwner.display_name)), ' ', React.createElement("span", null, timestamp(data.updated_at)));
        };
      })(this))), React.createElement(Markdown, null, data.body));
    },
    onSubmitMessage: function(_, textContent) {
      var body, conversation_id, message, user_id;
      body = textContent;
      user_id = +this.props.user.id;
      conversation_id = +this.state.conversation.id;
      message = {
        user_id: user_id,
        body: body,
        conversation_id: conversation_id
      };
      return talkClient.type('messages').create(message).save().then((function(_this) {
        return function(message) {
          return _this.setConversation();
        };
      })(this));
    },
    handleDelete: function(e) {
      e.preventDefault();
      if (confirm('Are you sure you want to archive this conversation?')) {
        return this.state.conversation["delete"]().then((function(_this) {
          return function() {
            return _this.history.pushState(null, '/inbox');
          };
        })(this));
      }
    },
    render: function() {
      var ref1;
      if (this.props.user) {
        return React.createElement("div", {
          "className": "talk inbox-conversation content-container"
        }, React.createElement(Link, {
          "to": "/inbox"
        }, "Back to Inbox"), React.createElement("h1", null, ((ref1 = this.state.conversation) != null ? ref1.title : void 0)), (this.state.recipients.length ? React.createElement("div", null, "In this conversation:", ' ', this.state.recipients.map((function(_this) {
          return function(user, i) {
            return React.createElement("span", {
              "key": user.id
            }, React.createElement(Link, {
              "to": "/users/" + user.login
            }, user.display_name), (i !== _this.state.recipients.length - 1 ? ', ' : void 0));
          };
        })(this))) : void 0), React.createElement(SingleSubmitButton, {
          "className": "delete-conversation",
          "onClick": this.handleDelete
        }, "Archive this conversation"), React.createElement("div", null, this.state.messages.map(this.message)), React.createElement(CommentBox, {
          "header": "Send a message...",
          "content": "",
          "submitFeedback": 'Sent!',
          "submit": "Send",
          "onSubmitComment": this.onSubmitMessage,
          "validationCheck": (function() {
            return false;
          }),
          "validationErrors": [],
          "user": this.props.user
        }));
      } else {
        return React.createElement("div", {
          "className": "content-container"
        }, "You are not permitted to view this conversation.");
      }
    }
  });
}


},{"../components/promise-renderer":86,"../components/single-submit-button":88,"../lib/handle-prop-changes":104,"./comment-box":244,"./lib/time":280,"markdownz":"markdownz","panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],258:[function(require,module,exports){
var CommentBox, History, React, ReactDOM, UserSearch, getErrors, messageValidations, subjectValidations, talkClient;

React = require('react');

ReactDOM = require('react-dom');

talkClient = require('panoptes-client/lib/talk-client');

UserSearch = require('../components/user-search');

History = require('react-router').History;

getErrors = require('./lib/validations').getErrors;

subjectValidations = require('./lib/message-subject-validations');

messageValidations = require('./lib/message-validations');

CommentBox = require('./comment-box');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'InboxForm',
    mixins: [History],
    propTypes: {
      user: React.PropTypes.object
    },
    getInitialState: function() {
      return {
        validationErrors: []
      };
    },
    validations: function(message, subject, recipients) {
      var messageValidationErrors, subjectErrors, userErrors, validationErrors;
      userErrors = !recipients.length ? ['Messages must have a recipient'] : [];
      subjectErrors = getErrors(subject, subjectValidations);
      messageValidationErrors = getErrors(message, messageValidations);
      validationErrors = userErrors.concat(subjectErrors.concat(messageValidationErrors));
      this.setState({
        validationErrors: validationErrors
      });
      return !!validationErrors.length;
    },
    onSubmitMessage: function(_, body) {
      var conversation, errored, recipient_ids, title, user_id;
      recipient_ids = ReactDOM.findDOMNode(this).querySelector('[name="userids"]').value.split(',').map(function(id) {
        return parseInt(id);
      }).filter(Number);
      title = this.refs.subject.value;
      user_id = this.props.user.id;
      errored = this.validations(body, title, recipient_ids);
      if (errored) {
        return errored;
      }
      conversation = {
        title: title,
        body: body,
        user_id: user_id,
        recipient_ids: recipient_ids
      };
      return talkClient.type('conversations').create(conversation).save().then((function(_this) {
        return function(conversation) {
          return _this.history.pushState(null, "/inbox/" + conversation.id);
        };
      })(this));
    },
    render: function() {
      return React.createElement("div", {
        "className": "inbox-form talk-module"
      }, React.createElement("div", {
        "className": "talk-form talk-moderation-children"
      }, React.createElement("h2", null, "To:"), React.createElement(UserSearch, {
        "multi": false
      }), React.createElement("h2", null, "Message:"), React.createElement("input", {
        "placeholder": "Subject",
        "type": "text",
        "ref": "subject"
      }), React.createElement(CommentBox, {
        "user": this.props.user,
        "header": null,
        "content": "",
        "validationCheck": (function() {
          return false;
        }),
        "validationErrors": this.state.validationErrors,
        "submitFeedback": "Sent!",
        "onSubmitComment": this.onSubmitMessage,
        "submit": "Send Message"
      })));
    }
  });
}


},{"../components/user-search":95,"./comment-box":244,"./lib/message-subject-validations":270,"./lib/message-validations":271,"./lib/validations":285,"panoptes-client/lib/talk-client":553,"react":"react","react-dom":"react-dom","react-router":"react-router"}],259:[function(require,module,exports){
var History, InboxForm, Link, Loading, PAGE_SIZE, Paginator, PromiseRenderer, React, SignInPrompt, alert, apiClient, promptToSignIn, ref, talkClient, talkConfig, timeAgo;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

apiClient = require('panoptes-client/lib/api-client');

PromiseRenderer = require('../components/promise-renderer');

Paginator = require('./lib/paginator');

ref = require('react-router'), Link = ref.Link, History = ref.History;

Loading = require('../components/loading-indicator');

InboxForm = require('./inbox-form');

talkConfig = require('./config');

timeAgo = require('./lib/time').timeAgo;

SignInPrompt = require('../partials/sign-in-prompt');

alert = require('../lib/alert');

PAGE_SIZE = talkConfig.inboxPageSize;

promptToSignIn = function() {
  return alert(function(resolve) {
    return React.createElement(SignInPrompt, {
      "onChoose": resolve
    });
  });
};

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkInbox',
    mixins: [History],
    getDefaultProps: function() {
      return {
        location: {
          query: {
            page: 1
          }
        }
      };
    },
    componentWillReceiveProps: function(nextProps) {
      if (nextProps.location.query.page !== this.props.location.query.page) {
        return this.setConversations(nextProps.location.query.page);
      }
    },
    setConversations: function(page) {
      var conversationsQuery;
      conversationsQuery = {
        user_id: this.props.user.id,
        page_size: PAGE_SIZE,
        page: this.props.location.query.page,
        sort: '-updated_at',
        include: 'users'
      };
      return talkClient.type('conversations').get(conversationsQuery);
    },
    onPageChange: function(page) {
      return this.goToPage(page);
    },
    goToPage: function(n) {
      this.history.pushState(null, "/inbox?page=" + n);
      return this.setConversations(n);
    },
    message: function(data, i) {
      return React.createElement("p", {
        "key": data.id,
        "class": true
      }, data.body);
    },
    conversationLink: function(conversation, i) {
      var unread;
      unread = conversation.is_unread;
      return React.createElement("div", {
        "className": "conversation-link " + (unread ? 'unread' : ''),
        "key": conversation.id
      }, React.createElement(PromiseRenderer, {
        "promise": apiClient.type('users').get(conversation.links.users.filter((function(_this) {
          return function(userId) {
            return userId !== _this.props.user.id;
          };
        })(this)))
      }, ((function(_this) {
        return function(users) {
          return React.createElement("div", null, users.map(function(user, i) {
            return React.createElement("div", {
              "key": user.id
            }, React.createElement("strong", null, React.createElement(Link, {
              "key": user.id,
              "to": "/users/" + user.login
            }, user.display_name)), React.createElement(PromiseRenderer, {
              "promise": conversation.get('messages', {
                page_size: 1,
                sort: '-created_at'
              })
            }, (function(messages) {
              return React.createElement("div", null, timeAgo(messages[0].updated_at), (i !== (users.length - 1) ? ', ' : void 0));
            })));
          }));
        };
      })(this))), React.createElement(Link, {
        "to": "/inbox/" + conversation.id
      }, (unread ? React.createElement("i", {
        "className": "fa fa-comments-o"
      }) : void 0), conversation.title));
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk inbox content-container"
      }, (this.props.user == null ? React.createElement("p", null, "Please ", React.createElement("button", {
        "className": "link-style",
        "type": "button",
        "onClick": promptToSignIn
      }, "sign in"), " to view your inbox") : React.createElement(PromiseRenderer, {
        "promise": this.setConversations(),
        "pending": (function() {
          return React.createElement(Loading, null);
        })
      }, ((function(_this) {
        return function(conversations) {
          var conversationsMeta;
          if (conversations == null) {
            conversations = [];
          }
          return React.createElement("div", null, React.createElement("h1", null, "Inbox"), (conversations.length === 0 ? React.createElement("p", null, "You have not started any private conversations yet. Send users private messages by visiting their profile page.") : (conversationsMeta = conversations[0].getMeta(), React.createElement("div", null, React.createElement("div", null, conversations.map(_this.conversationLink)), React.createElement(Paginator, {
            "page": +conversationsMeta.page,
            "pageCount": +conversationsMeta.page_count
          })))), React.createElement("div", null, React.createElement("h1", null, "Send a message"), React.createElement(InboxForm, {
            "user": _this.props.user
          })));
        };
      })(this)))));
    }
  });
}


},{"../components/loading-indicator":77,"../components/promise-renderer":86,"../lib/alert":98,"../partials/sign-in-prompt":228,"./config":249,"./inbox-form":258,"./lib/paginator":273,"./lib/time":280,"panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],260:[function(require,module,exports){
var Link, React, TalkBreadcrumbs, TalkFootnote, TalkSearchInput, sugarClient;

React = require('react');

Link = require('react-router').Link;

TalkBreadcrumbs = require('./breadcrumbs.cjsx');

TalkSearchInput = require('./search-input');

TalkFootnote = require('./footnote');

sugarClient = require('panoptes-client/lib/sugar').sugarClient;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'Talk',
    componentWillMount: function() {
      return sugarClient.subscribeTo(this.props.section || 'zooniverse');
    },
    componentWillUnmount: function() {
      return sugarClient.unsubscribeFrom(this.props.section || 'zooniverse');
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk content-container"
      }, React.createElement("h1", {
        "className": "talk-main-link"
      }, React.createElement(Link, {
        "to": "/talk"
      }, "Zooniverse Talk")), React.createElement(TalkBreadcrumbs, React.__spread({}, this.props)), React.createElement(TalkSearchInput, React.__spread({}, this.props, {
        "placeholder": 'Search the Zooniverse...'
      })), React.cloneElement(this.props.children, {
        section: 'zooniverse',
        user: this.props.user
      }), React.createElement(TalkFootnote, null));
    }
  });
}


},{"./breadcrumbs.cjsx":243,"./footnote":256,"./search-input":297,"panoptes-client/lib/sugar":552,"react":"react","react-router":"react-router"}],261:[function(require,module,exports){
var ActiveUsers, AddZooTeamForm, BoardPreview, CreateBoardForm, CreateSubjectDefaultButton, DragReorderable, HandlePropChanges, Link, Loading, Moderation, Paginator, PopularTags, ProjectLinker, PromiseRenderer, ROLES, React, SidebarNotifications, SingleSubmitButton, ZooniverseTeam, alert, talkClient;

React = require('react');

BoardPreview = require('./board-preview');

ActiveUsers = require('./active-users');

talkClient = require('panoptes-client/lib/talk-client');

PromiseRenderer = require('../components/promise-renderer');

HandlePropChanges = require('../lib/handle-prop-changes');

Moderation = require('./lib/moderation');

ProjectLinker = require('./lib/project-linker');

ROLES = require('./lib/roles');

Link = require('react-router').Link;

CreateSubjectDefaultButton = require('./lib/create-subject-default-button');

CreateBoardForm = require('./lib/create-board-form');

Loading = require('../components/loading-indicator');

SingleSubmitButton = require('../components/single-submit-button');

PopularTags = require('./popular-tags');

ZooniverseTeam = require('./lib/zoo-team.cjsx');

alert = require('../lib/alert');

AddZooTeamForm = require('./add-zoo-team-form');

DragReorderable = require('drag-reorderable');

Paginator = require('./lib/paginator');

SidebarNotifications = require('./lib/sidebar-notifications');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkInit',
    mixins: [HandlePropChanges],
    propTypes: {
      section: React.PropTypes.string
    },
    propChangeHandlers: {
      'section': 'setBoards',
      'user': 'setBoards'
    },
    getInitialState: function() {
      return {
        boards: [],
        boardsMeta: {},
        loading: true,
        moderationOpen: false
      };
    },
    getDefaultProps: function() {
      return {
        location: {
          query: {
            page: 1
          }
        }
      };
    },
    componentWillReceiveProps: function(nextProps) {
      if (nextProps.location.query.page !== this.props.location.query.page) {
        return this.setBoards({}, nextProps);
      }
    },
    setBoards: function(propValue, props) {
      if (props == null) {
        props = this.props;
      }
      return talkClient.type('boards').get({
        section: props.section,
        page_size: 20,
        page: props.location.query.page
      }).then((function(_this) {
        return function(boards) {
          var boardsMeta, ref;
          boardsMeta = (ref = boards[0]) != null ? ref.getMeta() : void 0;
          return _this.setState({
            boards: boards,
            boardsMeta: boardsMeta,
            loading: false
          });
        };
      })(this));
    },
    boardPreview: function(data, i) {
      return React.createElement(BoardPreview, React.__spread({}, this.props, {
        "key": i,
        "data": data
      }));
    },
    boardOrders: function() {
      return React.createElement(DragReorderable, {
        "tag": 'ul',
        "className": 'talk-reorder-boards',
        "items": this.state.boards,
        "render": this.boardOrderItem,
        "onChange": this.boardOrderChanged
      });
    },
    boardOrderItem: function(board, i) {
      return React.createElement("li", {
        "key": board.id
      }, React.createElement("i", {
        "className": "fa fa-bars bars"
      }), board.title);
    },
    boardOrderChanged: function(boards) {
      this.setState({
        boards: boards
      });
      return this.updateBoardOrder(boards).then((function(_this) {
        return function() {
          return _this.setBoards();
        };
      })(this));
    },
    updateBoardOrder: function(boards) {
      var board, boardsById, changes, i, id, idsAfter, idsBefore, j, k, len, len1;
      boardsById = {};
      for (j = 0, len = boards.length; j < len; j++) {
        board = boards[j];
        boardsById[board.id] = board;
      }
      idsBefore = (function() {
        var k, len1, ref, results;
        ref = this.state.boards;
        results = [];
        for (k = 0, len1 = ref.length; k < len1; k++) {
          board = ref[k];
          results.push(board.id);
        }
        return results;
      }).call(this);
      idsAfter = (function() {
        var k, len1, results;
        results = [];
        for (k = 0, len1 = boards.length; k < len1; k++) {
          board = boards[k];
          results.push(board.id);
        }
        return results;
      })();
      changes = {};
      for (i = k = 0, len1 = idsAfter.length; k < len1; i = ++k) {
        id = idsAfter[i];
        if (id !== idsBefore[i]) {
          changes[id] = i;
        }
      }
      if (changes.length < 1) {
        return Promise.resolve();
      }
      return Promise.all(Object.keys(changes).map((function(_this) {
        return function(id) {
          return boardsById[id].update({
            position: changes[id]
          }).save();
        };
      })(this)));
    },
    clearBoardOrder: function() {
      return Promise.all(this.state.boards.map((function(_this) {
        return function(board) {
          return board.update({
            position: 0
          }).save();
        };
      })(this))).then((function(_this) {
        return function() {
          _this.setState({
            loading: true
          });
          return _this.setBoards();
        };
      })(this));
    },
    render: function() {
      var ref, ref1, ref2, ref3, ref4, ref5, ref6;
      return React.createElement("div", {
        "className": "talk-home"
      }, (this.props.user != null ? React.createElement("div", {
        "className": "talk-moderation"
      }, React.createElement(Moderation, {
        "user": this.props.user,
        "section": this.props.section
      }, React.createElement("button", {
        "onClick": ((function(_this) {
          return function() {
            return _this.setState({
              moderationOpen: !_this.state.moderationOpen
            });
          };
        })(this))
      }, React.createElement("i", {
        "className": "fa fa-" + (this.state.moderationOpen ? 'close' : 'warning')
      }), " Moderator Controls")), (this.state.moderationOpen ? React.createElement("div", {
        "className": "talk-moderation-children talk-module"
      }, React.createElement("h2", null, "Moderator Zone:"), (this.props.section !== 'zooniverse' ? React.createElement(CreateSubjectDefaultButton, {
        "section": this.props.section,
        "onCreateBoard": ((function(_this) {
          return function() {
            return _this.setBoards();
          };
        })(this))
      }) : void 0), React.createElement(ZooniverseTeam, {
        "user": this.props.user,
        "section": this.props.section
      }, React.createElement("button", {
        "className": "link-style",
        "type": "button",
        "onClick": ((function(_this) {
          return function() {
            return alert(function(resolve) {
              return React.createElement(AddZooTeamForm, null);
            });
          };
        })(this))
      }, "Invite someone to the Zooniverse team")), (this.props.section !== 'zooniverse' ? React.createElement(Link, {
        "to": "/projects/" + ((ref = this.props.params) != null ? ref.owner : void 0) + "/" + ((ref1 = this.props.params) != null ? ref1.name : void 0) + "/talk/moderations"
      }, "View Reported Comments") : React.createElement(Link, {
        "to": "/talk/moderations"
      }, "View Reported Comments")), React.createElement(CreateBoardForm, {
        "section": this.props.section,
        "user": this.props.user,
        "onSubmitBoard": ((function(_this) {
          return function() {
            return _this.setBoards();
          };
        })(this))
      }), React.createElement("h3", null, "Reorder Boards:"), this.boardOrders(), React.createElement(SingleSubmitButton, {
        "onClick": this.clearBoardOrder
      }, "Order by activity")) : void 0)) : void 0), React.createElement("div", {
        "className": "talk-list-content"
      }, React.createElement("section", null, (this.state.loading ? React.createElement(Loading, null) : ((ref2 = this.state.boards) != null ? ref2.length : void 0) === 0 ? React.createElement("p", null, "There are currently no boards.") : ((ref3 = this.state.boards) != null ? ref3.length : void 0) ? this.state.boards.map(this.boardPreview) : void 0)), React.createElement("div", {
        "className": "talk-sidebar"
      }, React.createElement(SidebarNotifications, React.__spread({}, this.props)), React.createElement("section", null, React.createElement("h3", null, (this.props.section === 'zooniverse' ? React.createElement(Link, React.__spread({
        "className": "sidebar-link",
        "to": "/talk/recents"
      }, this.props), "Recent Comments") : React.createElement(Link, React.__spread({
        "className": "sidebar-link",
        "to": "/projects/" + this.props.params.owner + "/" + this.props.params.name + "/talk/recents"
      }, this.props), "Recent Comments")))), React.createElement("section", null, React.createElement(PopularTags, {
        "header": React.createElement("h3", null, "Popular Tags:"),
        "section": this.props.section,
        "project": this.props.project
      })), React.createElement("section", null, React.createElement(ActiveUsers, {
        "section": this.props.section
      })), React.createElement("section", null, React.createElement("h3", null, "Projects:"), React.createElement("div", null, React.createElement(ProjectLinker, {
        "user": this.props.user
      }))))), (+((ref4 = this.state.boardsMeta) != null ? ref4.page_count : void 0) > 1 ? React.createElement(Paginator, {
        "page": +((ref5 = this.state.boardsMeta) != null ? ref5.page : void 0),
        "pageCount": +((ref6 = this.state.boardsMeta) != null ? ref6.page_count : void 0)
      }) : void 0));
    }
  });
}


},{"../components/loading-indicator":77,"../components/promise-renderer":86,"../components/single-submit-button":88,"../lib/alert":98,"../lib/handle-prop-changes":104,"./active-users":239,"./add-zoo-team-form":240,"./board-preview":241,"./lib/create-board-form":265,"./lib/create-subject-default-button":266,"./lib/moderation":272,"./lib/paginator":273,"./lib/project-linker":275,"./lib/roles":278,"./lib/sidebar-notifications":279,"./lib/zoo-team.cjsx":286,"./popular-tags":293,"drag-reorderable":"drag-reorderable","panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],262:[function(require,module,exports){
var Avatar, DisplayRoles, History, Link, Markdown, PAGE_SIZE, PromiseRenderer, React, apiClient, merge, ref, talkClient, timeAgo, truncate;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

talkClient = require('panoptes-client/lib/talk-client');

timeAgo = require('./lib/time').timeAgo;

DisplayRoles = require('./lib/display-roles');

Avatar = require('../partials/avatar');

PromiseRenderer = require('../components/promise-renderer');

ref = require('react-router'), Link = ref.Link, History = ref.History;

merge = require('lodash.merge');

Markdown = require('markdownz').Markdown;

PAGE_SIZE = require('./config').discussionPageSize;

truncate = function(string, ending, length) {
  if (string == null) {
    string = '';
  }
  if (ending == null) {
    ending = '';
  }
  if (length == null) {
    length = 80;
  }
  if (string.trim().length <= length) {
    return string;
  }
  return string.trim().slice(0, length - ending.length) + ending;
};

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkLatestCommentComment',
    mixins: [History],
    propTypes: {
      project: React.PropTypes.object,
      discussion: React.PropTypes.object,
      title: React.PropTypes.bool,
      preview: React.PropTypes.bool
    },
    getDefaultProps: function() {
      return {
        title: false,
        preview: false
      };
    },
    getInitialState: function() {
      return {
        commentUser: null,
        latestCommentText: ''
      };
    },
    projectPrefix: function() {
      if (this.props.project) {
        return 'project-';
      } else {
        return '';
      }
    },
    lastPage: function() {
      return Math.ceil(this.props.discussion.comments_count / PAGE_SIZE);
    },
    componentWillMount: function() {
      var comment, ref1;
      comment = this.props.comment || ((ref1 = this.props.discussion) != null ? ref1.latest_comment : void 0);
      if (!comment) {
        return;
      }
      return apiClient.type('users').get(comment.user_id).then((function(_this) {
        return function(commentUser) {
          return _this.setState({
            commentUser: commentUser
          });
        };
      })(this));
    },
    componentDidMount: function() {
      var latestCommentText, ref1, ref2;
      latestCommentText = (ref1 = this.refs) != null ? (ref2 = ref1.markdownText) != null ? ref2.textContent : void 0 : void 0;
      if (latestCommentText) {
        return this.setState({
          latestCommentText: latestCommentText
        });
      }
    },
    discussionLink: function(childtext, query, className) {
      var name, owner, ref1, ref2, ref3;
      if (childtext == null) {
        childtext = '';
      }
      if (query == null) {
        query = {};
      }
      if (className == null) {
        className = '';
      }
      if (((ref1 = this.props.params) != null ? ref1.owner : void 0) && ((ref2 = this.props.params) != null ? ref2.name : void 0)) {
        ref3 = this.props.params, owner = ref3.owner, name = ref3.name;
        return React.createElement(Link, {
          "className": className,
          "to": this.history.createHref("/projects/" + owner + "/" + name + "/talk/" + this.props.discussion.board_id + "/" + this.props.discussion.id, query)
        }, childtext);
      } else {
        return React.createElement(Link, {
          "className": className,
          "to": this.history.createHref("/talk/" + this.props.discussion.board_id + "/" + this.props.discussion.id, query)
        }, childtext);
      }
    },
    render: function() {
      var comment, discussion, linkQuery;
      discussion = this.props.discussion;
      comment = this.props.comment || (discussion != null ? discussion.latest_comment : void 0);
      if (!(discussion && comment)) {
        return React.createElement("div", null);
      }
      linkQuery = this.props.comment ? {
        comment: comment.id
      } : {
        scrollToLastComment: true,
        page: this.lastPage()
      };
      return React.createElement("div", {
        "className": "talk-latest-comment-link"
      }, React.createElement("div", {
        "className": "talk-discussion-link"
      }, React.createElement("div", {
        "ref": "markdownText",
        "className": "hidden-markdown"
      }, React.createElement(Markdown, {
        "content": comment.body
      })), (this.state.commentUser != null ? React.createElement(Link, {
        "className": "user-profile-link",
        "to": "/users/" + this.state.commentUser.login
      }, React.createElement(Avatar, {
        "user": this.state.commentUser
      }), ' ', this.state.commentUser.display_name) : void 0), ' ', React.createElement(PromiseRenderer, {
        "promise": talkClient.type('roles').get({
          user_id: comment.user_id,
          section: ['zooniverse', comment.section],
          is_shown: true,
          page_size: 100
        })
      }, ((function(_this) {
        return function(roles) {
          return React.createElement(DisplayRoles, {
            "roles": roles,
            "section": comment.section
          });
        };
      })(this))), React.createElement("span", null, (discussion.title && this.props.title ? this.discussionLink(discussion.title, linkQuery) : void 0), ' '), this.discussionLink(timeAgo(comment.created_at), linkQuery, "latest-comment-time"), (this.props.preview ? this.discussionLink(" " + (truncate(this.state.latestCommentText, '...')), linkQuery, "latest-comment-preview-link") : void 0)));
    }
  });
}


},{"../components/promise-renderer":86,"../partials/avatar":212,"./config":249,"./lib/display-roles":268,"./lib/time":280,"lodash.merge":"lodash.merge","markdownz":"markdownz","panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],263:[function(require,module,exports){
var React;

React = require('react');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CommentContextIcon',
    getInitialState: function() {
      var status;
      status = this.props.comment.board_permissions.read !== 'all' ? 'private' : this.props.comment.discussion_locked ? 'locked' : void 0;
      return {
        status: status
      };
    },
    title: function() {
      switch (this.state.status) {
        case 'locked':
          return 'This comment is in a locked discussion';
        case 'private':
          return 'This comment is in a private board';
        default:
          return '';
      }
    },
    icon: function() {
      switch (this.state.status) {
        case 'locked':
          return 'lock';
        case 'private':
          return 'eye-slash';
        default:
          return '';
      }
    },
    render: function() {
      if (!this.state.status) {
        return React.createElement("span", null);
      }
      return React.createElement("i", {
        "className": "talk-comment-context-icon fa fa-" + (this.icon()),
        "title": this.title()
      });
    }
  });
}


},{"react":"react"}],264:[function(require,module,exports){
var MAX_LENGTH;

MAX_LENGTH = 10000;

if (typeof module !== "undefined" && module !== null) {
  module.exports = [
    {
      check: function(comment) {
        return comment.length > 0;
      },
      error: "Comments cannot be empty"
    }, {
      check: function(comment) {
        return comment.length < MAX_LENGTH;
      },
      error: "Comments cannot be more than " + MAX_LENGTH + " characters"
    }
  ];
}


},{}],265:[function(require,module,exports){
var ROLES, React, ReactDOM, SingleSubmitButton, getUserRoleNames, roleRankText, talkClient;

React = require('react');

ReactDOM = require('react-dom');

ROLES = require('./roles');

talkClient = require('panoptes-client/lib/talk-client');

SingleSubmitButton = require('../../components/single-submit-button');

getUserRoleNames = function(user, section) {
  return talkClient.type('roles').get({
    user_id: user.id,
    section: ['zooniverse', section],
    page_size: 100
  }).then(function(roles) {
    return roles.map(function(role) {
      return role.name;
    });
  });
};

roleRankText = React.createElement("span", null, "Roles rank from most private to least private in the order: ", React.createElement("strong", null, ROLES.join(' > ')));

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CreateBoardForm',
    propTypes: {
      section: React.PropTypes.string,
      onSubmitBoard: React.PropTypes.func,
      user: React.PropTypes.object
    },
    getInitialState: function() {
      return {
        error: '',
        admin: false
      };
    },
    componentWillMount: function() {
      return this.setAdmin();
    },
    setAdmin: function() {
      var ref, section, user;
      ref = this.props, user = ref.user, section = ref.section;
      return getUserRoleNames(user, section).then((function(_this) {
        return function(roleNames) {
          var admin;
          admin = roleNames.indexOf('admin') !== -1;
          return _this.setState({
            admin: admin
          });
        };
      })(this));
    },
    roleNames: function(admin) {
      if (admin) {
        return ROLES;
      } else {
        return ROLES.filter(function(role) {
          return role !== 'admin';
        });
      }
    },
    onSubmitBoard: function(e) {
      var board, description, descriptionInput, node, permissions, read, section, title, titleInput, write;
      e.preventDefault();
      node = ReactDOM.findDOMNode(this);
      titleInput = node.querySelector('form input');
      descriptionInput = node.querySelector('form textarea');
      read = node.querySelector(".roles-read input[name='role-read']:checked").value;
      write = node.querySelector(".roles-write input[name='role-write']:checked").value;
      permissions = {
        read: read,
        write: write
      };
      title = titleInput.value;
      description = descriptionInput.value;
      section = this.props.section;
      board = {
        title: title,
        description: description,
        section: section,
        permissions: permissions
      };
      if (!(title && description)) {
        return this.setState({
          error: 'Boards must have a title and description'
        });
      }
      return talkClient.type('boards').create(board).save().then((function(_this) {
        return function(board) {
          var base;
          titleInput.value = '';
          descriptionInput.value = '';
          _this.setState({
            error: ''
          });
          return typeof (base = _this.props).onSubmitBoard === "function" ? base.onSubmitBoard(board) : void 0;
        };
      })(this))["catch"]((function(_this) {
        return function(e) {
          return _this.setState({
            error: e.message
          });
        };
      })(this));
    },
    roleReadLabel: function(roleName, i) {
      return React.createElement("label", {
        "key": i
      }, React.createElement("input", {
        "type": "radio",
        "name": "role-read",
        "defaultChecked": i === ROLES.length - 1,
        "value": roleName
      }), roleName);
    },
    roleWriteLabel: function(roleName, i) {
      return React.createElement("label", {
        "key": i
      }, React.createElement("input", {
        "type": "radio",
        "name": "role-write",
        "defaultChecked": i === ROLES.length - 1,
        "value": roleName
      }), roleName);
    },
    render: function() {
      return React.createElement("form", {
        "onSubmit": this.onSubmitBoard
      }, React.createElement("h3", null, "Add a board:"), React.createElement("input", {
        "type": "text",
        "ref": "boardTitle",
        "placeholder": "Board Title"
      }), React.createElement("textarea", {
        "ref": "boardDescription",
        "placeholder": "Board Description"
      }), React.createElement("br", null), React.createElement("div", null, roleRankText, React.createElement("h4", null, "Can Read:"), React.createElement("span", null, "Users of this status or lower will be able to read content in this board"), React.createElement("div", {
        "className": "roles-read"
      }, this.roleNames(this.state.admin).map(this.roleReadLabel)), React.createElement("h4", null, "Can Write:"), React.createElement("span", null, "Users of this status or lower will be able to post content in this board"), React.createElement("div", {
        "className": "roles-write"
      }, this.roleNames(this.state.admin).map(this.roleWriteLabel))), React.createElement(SingleSubmitButton, {
        "type": "submit",
        "onClick": this.onSubmitBoard
      }, React.createElement("i", {
        "className": "fa fa-plus-circle"
      }), " Create Board"), (this.state.error ? React.createElement("p", {
        "className": "submit-error"
      }, this.state.error) : void 0));
    }
  });
}


},{"../../components/single-submit-button":88,"./roles":278,"panoptes-client/lib/talk-client":553,"react":"react","react-dom":"react-dom"}],266:[function(require,module,exports){
var DEFAULT_BOARD_DESCRIPTION, DEFAULT_BOARD_TITLE, PromiseRenderer, React, SingleSubmitButton, projectSection, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

projectSection = require('./project-section');

PromiseRenderer = require('../../components/promise-renderer');

SingleSubmitButton = require('../../components/single-submit-button');

DEFAULT_BOARD_TITLE = 'Notes';

DEFAULT_BOARD_DESCRIPTION = 'General comment threads about individual subjects';

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'CreateSubjectDefaultButton',
    propTypes: {
      section: React.PropTypes.string,
      onCreateBoard: React.PropTypes.func
    },
    defaultBoardPromise: function() {
      return talkClient.type('boards').get({
        section: this.props.section,
        subject_default: true
      }).index(0);
    },
    createSubjectDefaultBoard: function() {
      var board;
      board = {
        title: DEFAULT_BOARD_TITLE,
        description: DEFAULT_BOARD_DESCRIPTION,
        subject_default: true,
        permissions: {
          read: 'all',
          write: 'all'
        },
        section: this.props.section
      };
      return talkClient.type('boards').create(board).save().then((function(_this) {
        return function() {
          var base;
          return typeof (base = _this.props).onCreateBoard === "function" ? base.onCreateBoard(board) : void 0;
        };
      })(this));
    },
    render: function() {
      return React.createElement(PromiseRenderer, {
        "promise": this.defaultBoardPromise()
      }, ((function(_this) {
        return function(defaultBoard) {
          if (defaultBoard != null) {
            return React.createElement("div", null, React.createElement("i", {
              "className": "fa fa-check"
            }), " Subject Default Board Setup");
          } else {
            return React.createElement(SingleSubmitButton, {
              "type": "button",
              "onClick": _this.createSubjectDefaultBoard
            }, React.createElement("i", {
              "className": "fa fa-photo"
            }), " Activate Talk Subject Comments Board");
          }
        };
      })(this)));
    }
  });
}


},{"../../components/promise-renderer":86,"../../components/single-submit-button":88,"./project-section":276,"panoptes-client/lib/talk-client":553,"react":"react"}],267:[function(require,module,exports){
var MAX_LENGTH;

MAX_LENGTH = 255;

if (typeof module !== "undefined" && module !== null) {
  module.exports = [
    {
      check: function(comment) {
        return comment.length > 0;
      },
      error: "Discussion title cannot be empty"
    }, {
      check: function(comment) {
        return comment.length < MAX_LENGTH;
      },
      error: "Discussion title cannot be more than " + MAX_LENGTH + " characters"
    }
  ];
}


},{}],268:[function(require,module,exports){
var DisplayRoles, React, researcherRole, roleDisplayName, uniq, zooniverseTeamRole;

React = require('react');

uniq = require('lodash.uniq');

zooniverseTeamRole = function(role) {
  return role.section === 'zooniverse' && ['admin', 'team'].indexOf(role.name) !== -1;
};

researcherRole = function(role) {
  var userIsResearcher;
  userIsResearcher = ['admin', 'scientist', 'owner'].indexOf(role.name) !== -1;
  return role.section !== 'zooniverse' && userIsResearcher;
};

roleDisplayName = function(role) {
  if (zooniverseTeamRole(role)) {
    return "Zooniverse Team";
  } else if (researcherRole(role)) {
    return "Researcher";
  } else {
    return role.name;
  }
};

DisplayRoles = React.createClass({
  displayName: 'TalkDisplayRoles',
  propTypes: {
    roles: React.PropTypes.array
  },
  role: function(role, i) {
    var zooTeamName;
    zooTeamName = zooniverseTeamRole(role) ? 'zoo-team' : void 0;
    return React.createElement("p", {
      "key": role.id,
      "className": "project-role " + (zooTeamName != null ? zooTeamName : role.name)
    }, roleDisplayName(role));
  },
  render: function() {
    return React.createElement("div", {
      "className": "talk-display-roles"
    }, uniq(this.props.roles, roleDisplayName).map(this.role));
  }
});

if (typeof module !== "undefined" && module !== null) {
  module.exports = DisplayRoles;
}


},{"lodash.uniq":"lodash.uniq","react":"react"}],269:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = function(number) {
    if (number == null) {
      return;
    }
    return number.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,');
  };
}


},{}],270:[function(require,module,exports){
var MAX_LENGTH;

MAX_LENGTH = 256;

if (typeof module !== "undefined" && module !== null) {
  module.exports = [
    {
      check: function(subject) {
        return subject.length > 0;
      },
      error: "Subject field cannot be empty"
    }, {
      check: function(subject) {
        return subject.length < MAX_LENGTH;
      },
      error: "Subject field cannot be more than " + MAX_LENGTH + " characters"
    }
  ];
}


},{}],271:[function(require,module,exports){
var MAX_LENGTH;

MAX_LENGTH = 10000;

if (typeof module !== "undefined" && module !== null) {
  module.exports = [
    {
      check: function(message) {
        return message.length > 0;
      },
      error: "Messages cannot be empty"
    }, {
      check: function(message) {
        return message.length < MAX_LENGTH;
      },
      error: "Messages cannot be more than " + MAX_LENGTH + " characters"
    }
  ];
}


},{}],272:[function(require,module,exports){
var PromiseRenderer, React, talkClient, userIsModerator;

React = require('react');

PromiseRenderer = require('../../components/promise-renderer');

talkClient = require('panoptes-client/lib/talk-client');

userIsModerator = require('./user-is-moderator');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'Moderation',
    propTypes: {
      section: React.PropTypes.string.isRequired,
      user: React.PropTypes.object.isRequired
    },
    render: function() {
      var ref, section, user;
      ref = this.props, section = ref.section, user = ref.user;
      return React.createElement(PromiseRenderer, {
        "pending": null,
        "promise": talkClient.type('roles').get({
          user_id: user.id,
          section: ['zooniverse', section],
          page_size: 100
        })
      }, ((function(_this) {
        return function(roles) {
          if (userIsModerator(user, roles, section)) {
            return _this.props.children;
          } else {
            return null;
          }
        };
      })(this)));
    }
  });
}


},{"../../components/promise-renderer":86,"./user-is-moderator":283,"panoptes-client/lib/talk-client":553,"react":"react"}],273:[function(require,module,exports){
var History, React, updateQueryParams;

React = require('react');

History = require('react-router').History;

updateQueryParams = require('./update-query-params');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'Paginator',
    propTypes: {
      pageCount: React.PropTypes.number,
      page: React.PropTypes.number,
      onPageChange: React.PropTypes.func.isRequired,
      firstAndLast: React.PropTypes.bool,
      scrollOnChange: React.PropTypes.bool,
      pageSelector: React.PropTypes.bool,
      pageKey: React.PropTypes.string
    },
    getDefaultProps: function() {
      return {
        page: 1,
        pageKey: 'page',
        onPageChange: function(page) {
          var queryChange;
          queryChange = {};
          queryChange[this.props.pageKey] = page;
          return updateQueryParams(this.history, queryChange);
        },
        firstAndLast: true,
        pageSelector: true,
        scrollOnChange: true,
        previousLabel: React.createElement("span", null, React.createElement("i", {
          "className": "fa fa-long-arrow-left"
        }), " Previous"),
        nextLabel: React.createElement("span", null, "Next ", React.createElement("i", {
          "className": "fa fa-long-arrow-right"
        }))
      };
    },
    mixins: [History],
    setPage: function(activePage) {
      this.props.onPageChange.call(this, activePage);
      if (this.props.scrollOnChange) {
        return window.scrollTo(0, 0);
      }
    },
    onClickNext: function() {
      var base, nextPage, page, pageCount;
      pageCount = this.props.pageCount;
      page = this.props[this.props.pageKey];
      if (typeof (base = this.props).onClickNext === "function") {
        base.onClickNext();
      }
      nextPage = page === pageCount ? pageCount : page + 1;
      return this.setPage(nextPage);
    },
    onClickPrev: function() {
      var base, page, prevPage;
      page = this.props[this.props.pageKey];
      if (typeof (base = this.props).onClickPrev === "function") {
        base.onClickPrev();
      }
      prevPage = page === 1 ? page : page - 1;
      return this.setPage(prevPage);
    },
    onSelectPage: function(e) {
      var selectedPage;
      selectedPage = +this.refs.pageSelect.value;
      return this.setPage(selectedPage);
    },
    pageOption: function(n, i) {
      return React.createElement("option", {
        "key": i,
        "value": n
      }, n);
    },
    render: function() {
      var j, page, pageCount, results;
      pageCount = this.props.pageCount;
      page = this.props[this.props.pageKey];
      return React.createElement("div", {
        "className": "paginator " + this.props.className
      }, (this.props.firstAndLast ? React.createElement("button", {
        "className": "paginator-first",
        "onClick": ((function(_this) {
          return function() {
            return _this.setPage(1);
          };
        })(this)),
        "disabled": page === 1
      }, React.createElement("i", {
        "className": "fa fa-fast-backward"
      }), " First") : void 0), React.createElement("button", {
        "className": "paginator-prev",
        "onClick": this.onClickPrev,
        "disabled": page === 1
      }, this.props.previousLabel), (this.props.pageSelector ? React.createElement("div", {
        "className": "paginator-page-selector"
      }, "Page", React.createElement("select", {
        "value": page,
        "onChange": this.onSelectPage,
        "ref": "pageSelect"
      }, (function() {
        results = [];
        for (var j = 1; 1 <= pageCount ? j <= pageCount : j >= pageCount; 1 <= pageCount ? j++ : j--){ results.push(j); }
        return results;
      }).apply(this).map(this.pageOption)), " of ", pageCount) : void 0), React.createElement("button", {
        "className": "paginator-next",
        "onClick": this.onClickNext,
        "disabled": page === pageCount
      }, this.props.nextLabel), (this.props.firstAndLast ? React.createElement("button", {
        "className": "paginator-last",
        "onClick": ((function(_this) {
          return function() {
            return _this.setPage(pageCount);
          };
        })(this)),
        "disabled": page === pageCount
      }, "Last ", React.createElement("i", {
        "className": "fa fa-fast-forward"
      })) : void 0));
    }
  });
}


},{"./update-query-params":281,"react":"react","react-router":"react-router"}],274:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = function(section) {
    var splitSection;
    if (section === 'zooniverse') {
      return section;
    }
    splitSection = section.split('project-');
    return splitSection.slice(1, +(splitSection.length - 1) + 1 || 9e9).join('project-');
  };
}


},{}],275:[function(require,module,exports){
var FEATURED_PRODUCT_IDS, Link, Loading, React, apiClient, filterNonRedirected, take;

React = require('react');

apiClient = require('panoptes-client/lib/api-client');

Link = require('react-router').Link;

Loading = require('../../components/loading-indicator');

FEATURED_PRODUCT_IDS = require('../../lib/featured-projects');

take = function(n, arr) {
  return arr.slice(0, n);
};

filterNonRedirected = function(projects) {
  return projects.filter(function(p) {
    return p && (!p.redirect);
  });
};

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'ProjectLinker',
    getInitialState: function() {
      return {
        projects: [],
        projectsMeta: {},
        loading: true,
        open: false
      };
    },
    componentDidMount: function() {
      return this.loadMoreProjects().then(this.setState.bind(this));
    },
    loadMoreProjects: function(page, newProjects, load) {
      if (page == null) {
        page = 1;
      }
      if (newProjects == null) {
        newProjects = [];
      }
      if (load == null) {
        load = 10;
      }
      return apiClient.type('projects').get({
        launch_approved: true,
        cards: true,
        page: page,
        page_size: 20
      }).then((function(_this) {
        return function(projects) {
          var projectsMeta, ref;
          projectsMeta = (ref = projects[0]) != null ? ref.getMeta() : void 0;
          newProjects = newProjects.concat(filterNonRedirected(projects));
          if ((newProjects.length < load) && (projectsMeta.page < projectsMeta.page_count)) {
            return _this.loadMoreProjects(page + 1, newProjects);
          } else {
            return {
              projects: _this.state.projects.concat(take(load, newProjects)),
              projectsMeta: projectsMeta
            };
          }
        };
      })(this));
    },
    shouldComponentUpdate: function(nextProps, nextState) {
      return (nextState.projects.length > this.state.projects.length) || (nextState.open !== this.state.open) || (nextState.projectsMeta !== this.state.projectsMeta);
    },
    projectLink: function(project, i) {
      var name, owner, ref;
      ref = project.slug.split('/'), owner = ref[0], name = ref[1];
      return React.createElement("div", {
        "key": project.id
      }, (project.redirect ? React.createElement("a", {
        "href": project.redirect,
        "title": project.redirect
      }, project.display_name) : React.createElement(Link, {
        "to": "/projects/" + owner + "/" + name
      }, project.display_name)));
    },
    onClickLoadMore: function(e) {
      return this.loadMoreProjects(this.state.projectsMeta.next_page).then(this.setState.bind(this));
    },
    render: function() {
      var ref, ref1, ref2;
      return React.createElement("div", null, React.createElement("button", {
        "onClick": ((function(_this) {
          return function() {
            return _this.setState({
              open: !_this.state.open
            });
          };
        })(this))
      }, (this.state.open ? React.createElement("span", null, React.createElement("i", {
        "className": "fa fa-close"
      }), " Collapse Projects") : React.createElement("span", null, "Change projects"))), (this.state.open ? (this.state.loading ? React.createElement(Loading, null) : void 0, React.createElement("div", {
        "className": "project-linker"
      }, React.createElement("div", null, React.createElement(Link, {
        "to": "/talk"
      }, "Zooniverse Talk")), React.createElement("div", null, (ref = this.state.projects) != null ? ref.map(this.projectLink) : void 0), (((ref1 = this.state.projectsMeta) != null ? ref1.page : void 0) !== ((ref2 = this.state.projectsMeta) != null ? ref2.page_count : void 0) ? React.createElement("button", {
        "type": "button",
        "onClick": this.onClickLoadMore
      }, "Load more ", React.createElement("i", {
        "className": "fa fa-arrow-down"
      })) : React.createElement("hr", null)))) : void 0));
    }
  });
}


},{"../../components/loading-indicator":77,"../../lib/featured-projects":101,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],276:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = function(project) {
    return "project-" + project.id;
  };
}


},{}],277:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = function(count, string) {
    return count + " " + (+count === 1 ? string.replace(/[Ss]$/, '') : string);
  };
}


},{}],278:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = ["admin", "moderator", "team", "all"];
}


},{}],279:[function(require,module,exports){
var Link, React, formatNumber, resourceCount, talkClient;

React = require('react');

Link = require('react-router').Link;

talkClient = require('panoptes-client/lib/talk-client');

resourceCount = require('./resource-count');

formatNumber = require('./format-number');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'SidebarNotifications',
    componentDidMount: function() {
      if (this.props.user) {
        return this.getUndeliveredCount();
      }
    },
    componentWillReceiveProps: function() {
      if (this.props.user) {
        return this.getUndeliveredCount();
      }
    },
    getInitialState: function() {
      return {
        unreadCount: null
      };
    },
    getUndeliveredCount: function() {
      var delivered, page_size, section;
      delivered = false;
      page_size = 1;
      section = this.props.section;
      if (this.props.project) {
        section = "project-" + this.props.project.id;
      }
      return talkClient.type('notifications').get({
        section: section,
        delivered: delivered,
        page_size: page_size
      }).then((function(_this) {
        return function(notifications) {
          var ref, ref1, unreadCount;
          unreadCount = ((ref = notifications[0]) != null ? (ref1 = ref.getMeta()) != null ? ref1.count : void 0 : void 0) || 0;
          return _this.setState({
            unreadCount: unreadCount
          });
        };
      })(this));
    },
    label: function() {
      if (this.state.unreadCount > 0) {
        return "Notifications (" + (formatNumber(this.state.unreadCount)) + " unread)";
      } else {
        return 'Notifications';
      }
    },
    render: function() {
      var linkParams, linkProps, name, owner, project, ref, ref1, section, user;
      if (!(this.props.user && (this.state.unreadCount != null))) {
        return null;
      }
      ref = this.props, project = ref.project, user = ref.user;
      ref1 = this.props.params, section = ref1.section, owner = ref1.owner, name = ref1.name;
      section || (section = this.props.section);
      linkProps = {
        project: project,
        section: section,
        user: user
      };
      linkParams = {
        section: section,
        owner: owner,
        name: name
      };
      return React.createElement("section", {
        "className": "talk-sidebar-notifications"
      }, React.createElement("h3", null, (project ? React.createElement(Link, React.__spread({
        "to": "/projects/" + owner + "/" + name + "/notifications"
      }, linkProps, {
        "className": "sidebar-link"
      }), this.label()) : section ? React.createElement(Link, React.__spread({
        "to": "/" + section + "/notifications"
      }, linkProps, {
        "className": "sidebar-link"
      }), this.label()) : React.createElement(Link, React.__spread({
        "to": "/notifications"
      }, linkProps, {
        "className": "sidebar-link"
      }), this.label()))));
    }
  });
}


},{"./format-number":269,"./resource-count":277,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],280:[function(require,module,exports){
var moment;

moment = require('moment');

if (typeof module !== "undefined" && module !== null) {
  module.exports = {
    timestamp: function(ts) {
      return moment(ts).format('MMMM Do YYYY, h:mm a');
    },
    timeAgo: function(t) {
      return moment(t).fromNow();
    }
  };
}


},{"moment":"moment"}],281:[function(require,module,exports){
var React, parseQuery;

React = require('react');

parseQuery = function() {
  var i, key, len, params, query, ref, string, value;
  query = window.location.search.replace('?', '').split('&');
  params = {};
  for (i = 0, len = query.length; i < len; i++) {
    string = query[i];
    ref = string.split('='), key = ref[0], value = ref[1];
    if (key) {
      params[key] = value;
    }
  }
  return params;
};

if (typeof module !== "undefined" && module !== null) {
  module.exports = function(reactHistory, queryChange) {
    var nextHref, nextQuery;
    nextQuery = Object.assign({}, parseQuery(), queryChange);
    nextHref = reactHistory.createHref(window.location.pathname, nextQuery);
    return reactHistory.pushState(null, nextHref);
  };
}


},{"react":"react"}],282:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = function(user, comment) {
    return (user != null) && (Object.keys(comment.upvotes).indexOf(user.login) !== -1);
  };
}


},{}],283:[function(require,module,exports){
var intersect, userIsModerator, userIsZooniverseAdmin;

userIsZooniverseAdmin = require('./user-is-zooniverse-admin');

intersect = function(arr1, arr2) {
  return arr1.filter(function(n) {
    return arr2.indexOf(n) !== -1;
  });
};

userIsModerator = function(user, roles, section) {
  var allowedModerationRoles, moderationRoles;
  if (userIsZooniverseAdmin(roles)) {
    return true;
  }
  allowedModerationRoles = ['admin', 'moderator'];
  moderationRoles = roles.filter(function(role) {
    return role.section === section;
  }).map(function(role) {
    return role.name;
  });
  return intersect(moderationRoles, allowedModerationRoles).length > 0;
};

if (typeof module !== "undefined" && module !== null) {
  module.exports = userIsModerator;
}


},{"./user-is-zooniverse-admin":284}],284:[function(require,module,exports){
var userIsZooniverseAdmin;

userIsZooniverseAdmin = function(usersRoles) {
  var zooniverseAdminRoles;
  zooniverseAdminRoles = usersRoles.filter(function(role) {
    return role.section === 'zooniverse' && role.name === 'admin';
  });
  return zooniverseAdminRoles.length > 0;
};

if (typeof module !== "undefined" && module !== null) {
  module.exports = userIsZooniverseAdmin;
}


},{}],285:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = {
    getErrors: function(input, tests) {
      return tests.reduce(function(errors, validation) {
        if (!validation.check(input)) {
          return errors.concat(validation.error);
        }
        return errors;
      }, []);
    }
  };
}


},{}],286:[function(require,module,exports){
var PromiseRenderer, React, talkClient, userIsZooniverseAdmin;

React = require('react');

PromiseRenderer = require('../../components/promise-renderer');

talkClient = require('panoptes-client/lib/talk-client');

userIsZooniverseAdmin = require('./user-is-zooniverse-admin');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'ZooniverseTeam',
    propTypes: {
      section: React.PropTypes.string.isRequired,
      user: React.PropTypes.object.isRequired
    },
    getInitialState: function() {
      return {
        open: false
      };
    },
    render: function() {
      var section;
      section = this.props.section;
      return React.createElement("div", null, React.createElement(PromiseRenderer, {
        "pending": null,
        "promise": talkClient.type('roles').get({
          user_id: this.props.user.id,
          section: ['zooniverse', section],
          page_size: 100
        })
      }, ((function(_this) {
        return function(roles) {
          if (userIsZooniverseAdmin(roles)) {
            return _this.props.children;
          } else {
            return null;
          }
        };
      })(this))));
    }
  });
}


},{"../../components/promise-renderer":86,"./user-is-zooniverse-admin":284,"panoptes-client/lib/talk-client":553,"react":"react"}],287:[function(require,module,exports){
var React;

React = require('react');

if (typeof module !== "undefined" && module !== null) {
  module.exports = {
    getInitialState: function() {
      return {
        feedback: null
      };
    },
    setFeedback: function(text) {
      window.addEventListener('click', this.removeFeedback);
      return this.setState({
        feedback: text
      });
    },
    removeFeedback: function() {
      window.removeEventListener('click', this.removeFeedback);
      return this.setState({
        feedback: null
      });
    },
    renderFeedback: function() {
      if (this.state.feedback) {
        return React.createElement("p", {
          "className": "talk-comment-feedback"
        }, this.state.feedback);
      }
    }
  };
}


},{"react":"react"}],288:[function(require,module,exports){
if (typeof module !== "undefined" && module !== null) {
  module.exports = {
    getInitialState: function() {
      return {
        showing: null
      };
    },
    toggleComponent: function(name) {
      return this.setState({
        showing: this.state.showing === name ? null : name
      });
    },
    hideChildren: function() {
      return this.setState({
        showing: null
      });
    }
  };
}


},{}],289:[function(require,module,exports){
var Link, Loading, React, actionTaken, apiClient, moment;

React = require('react');

Link = require('react-router').Link;

moment = require('moment');

apiClient = require('panoptes-client/lib/api-client');

Loading = require('../../components/loading-indicator');

actionTaken = {
  destroy: 'Deleted',
  destroyed: 'Deleted',
  open: 'Opened',
  opened: 'Opened',
  close: 'Deleted',
  closed: 'Deleted',
  ignore: 'Ignored',
  ignored: 'Ignored',
  watch: 'Watched',
  watched: 'Watched'
};

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'ModerationActions',
    propTypes: {
      moderation: React.PropTypes.object.isRequired,
      comment: React.PropTypes.object.isRequired,
      user: React.PropTypes.object.isRequired,
      updateModeration: React.PropTypes.func.isRequired
    },
    getInitialState: function() {
      return {
        actions: null
      };
    },
    componentDidMount: function() {
      if (this.props.moderation.actions.length === 0) {
        return this.setState({
          actions: []
        });
      } else {
        return Promise.all(this.props.moderation.actions.map((function(_this) {
          return function(action) {
            return apiClient.type('users').get(action.user_id.toString()).then(function(user) {
              return Object.assign({}, action, {
                user: user
              });
            });
          };
        })(this))).then((function(_this) {
          return function(actions) {
            return _this.setState({
              actions: actions
            });
          };
        })(this));
      }
    },
    confirmDelete: function() {
      return window.confirm('Are you sure that you want to delete the reported comment?');
    },
    updateModeration: function(action) {
      return (function(_this) {
        return function() {
          var message, ref;
          if (action === 'destroy' && !_this.confirmDelete()) {
            return;
          }
          message = (ref = _this.refs.message.value) != null ? ref : null;
          _this.refs.message.value = '';
          return _this.props.updateModeration(_this.props.moderation, action, message);
        };
      })(this);
    },
    availableActions: function() {
      return this.props.comment.moderatable_actions.filter((function(_this) {
        return function(action) {
          return (_this.props.moderation.state.indexOf(action) === -1) && action !== 'report';
        };
      })(this));
    },
    actionButtons: function() {
      return this.availableActions().map((function(_this) {
        return function(action) {
          var label;
          label = action === 'destroy' ? 'delete' : action;
          return React.createElement("button", {
            "key": "action-" + _this.props.comment.id + "-" + action,
            "className": "moderations-" + action,
            "onClick": _this.updateModeration(action)
          }, label);
        };
      })(this));
    },
    render: function() {
      var action, moderation, ref;
      moderation = this.props.moderation;
      return React.createElement("div", {
        "className": "moderations-actions-buttons"
      }, React.createElement("p", null, "Status: ", React.createElement("strong", null, (ref = actionTaken[moderation.state]) != null ? ref : moderation.state), " ", moment(moderation.created_at).fromNow()), (this.state.actions ? React.createElement("div", null, (function() {
        var i, len, ref1, ref2, results;
        ref1 = this.state.actions;
        results = [];
        for (i = 0, len = ref1.length; i < len; i++) {
          action = ref1[i];
          results.push(React.createElement("div", {
            "key": "moderation-" + moderation.id + "-action-" + action.action
          }, (ref2 = actionTaken[action.action]) != null ? ref2 : action.action, " by ", React.createElement(Link, {
            "to": "/users/" + action.user.login
          }, action.user.display_name), (action.message ? React.createElement("div", null, React.createElement("i", {
            "className": "fa fa-quote-left"
          }), " ", action.message, " ", React.createElement("i", {
            "className": "fa fa-quote-right"
          })) : void 0)));
        }
        return results;
      }).call(this)) : React.createElement(Loading, null)), (moderation.state !== 'closed' ? React.createElement("div", null, React.createElement("div", {
        "className": "textarea-container"
      }, React.createElement("textarea", {
        "ref": "message",
        "placeholder": "Optional message"
      })), this.actionButtons()) : void 0));
    }
  });
}


},{"../../components/loading-indicator":77,"moment":"moment","panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],290:[function(require,module,exports){
var CommentLink, Link, Loading, ModerationActions, ModerationReports, React, talkClient;

React = require('react');

Link = require('react-router').Link;

talkClient = require('panoptes-client/lib/talk-client');

Loading = require('../../components/loading-indicator');

CommentLink = require('../../pages/profile/comment-link');

ModerationReports = require('./reports');

ModerationActions = require('./actions');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'ModerationComment',
    propTypes: {
      moderation: React.PropTypes.object.isRequired,
      user: React.PropTypes.object.isRequired,
      updateModeration: React.PropTypes.func.isRequired
    },
    getInitialState: function() {
      return {
        comment: null
      };
    },
    getComment: function() {
      if (this.props.moderation.destroyed_target) {
        return Promise.resolve(this.props.moderation.destroyed_target);
      } else {
        return talkClient.type('comments').get(this.props.moderation.target_id);
      }
    },
    componentDidMount: function() {
      return this.getComment().then((function(_this) {
        return function(comment) {
          return _this.setState({
            comment: comment
          });
        };
      })(this));
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk-module"
      }, (this.state.comment ? React.createElement("div", {
        "key": "comment-" + this.state.comment.id
      }, React.createElement("h1", null, "Comment ", this.state.comment.id, " Reports"), React.createElement(ModerationReports, {
        "reports": this.props.moderation.reports
      }), React.createElement("span", null, "Reported comment by:", ' ', React.createElement(Link, {
        "to": "/users/" + this.state.comment.user_login
      }, this.state.comment.user_display_name || this.state.comment.user_login), ":"), React.createElement(CommentLink, {
        "comment": this.state.comment
      }), React.createElement(ModerationActions, React.__spread({}, this.props, {
        "comment": this.state.comment
      }))) : React.createElement(Loading, null)));
    }
  });
}


},{"../../components/loading-indicator":77,"../../pages/profile/comment-link":185,"./actions":289,"./reports":291,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],291:[function(require,module,exports){
var Link, Loading, React, apiClient;

React = require('react');

Link = require('react-router').Link;

apiClient = require('panoptes-client/lib/api-client');

Loading = require('../../components/loading-indicator');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'ModerationActions',
    propTypes: {
      reports: React.PropTypes.array.isRequired
    },
    getInitialState: function() {
      return {
        reports: null
      };
    },
    componentDidMount: function() {
      return Promise.all(this.props.reports.map((function(_this) {
        return function(report) {
          return apiClient.type('users').get(report.user_id.toString()).then(function(user) {
            return Object.assign({}, report, {
              user: user
            });
          });
        };
      })(this))).then((function(_this) {
        return function(reports) {
          return _this.setState({
            reports: reports
          });
        };
      })(this));
    },
    render: function() {
      var i, report;
      return React.createElement("ul", null, ((function() {
        var j, len, ref, results;
        if (this.state.reports) {
          ref = this.state.reports;
          results = [];
          for (i = j = 0, len = ref.length; j < len; i = ++j) {
            report = ref[i];
            results.push(React.createElement("li", {
              "key": "report-" + i
            }, React.createElement(Link, {
              "to": "/users/" + report.user.login
            }, report.user.display_name), ": ", report.message));
          }
          return results;
        } else {
          return React.createElement(Loading, null);
        }
      }).call(this)));
    }
  });
}


},{"../../components/loading-indicator":77,"panoptes-client/lib/api-client":549,"react":"react","react-router":"react-router"}],292:[function(require,module,exports){
var History, Loading, ModerationComment, Paginator, React, auth, page_size, talkClient, updateQueryParams;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

auth = require('panoptes-client/lib/auth');

Paginator = require('./lib/paginator');

Loading = require('../components/loading-indicator');

page_size = require('./config').moderationsPageSize;

History = require('react-router').History;

updateQueryParams = require('./lib/update-query-params');

ModerationComment = require('./moderation/comment');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkModerations',
    mixins: [History],
    getInitialState: function() {
      return {
        moderations: [],
        moderationsMeta: {},
        user: null,
        loading: true
      };
    },
    getDefaultProps: function() {
      return {
        foo: 'bar',
        location: {
          query: {
            page: 1,
            state: 'opened'
          }
        }
      };
    },
    componentDidMount: function() {
      var base;
      (base = this.props.location.query).state || (base.state = 'opened');
      return this.setModerations();
    },
    componentWillReceiveProps: function(nextProps) {
      return this.setModerations(nextProps.location.query);
    },
    setModerations: function(arg) {
      var page, ref, section, state;
      ref = arg != null ? arg : {}, page = ref.page, state = ref.state;
      page || (page = this.props.location.query.page);
      state || (state = this.props.location.query.state);
      section = this.props.section;
      this.setState({
        loading: true
      });
      return auth.checkCurrent().then((function(_this) {
        return function(user) {
          return talkClient.type('moderations').get({
            section: section,
            state: state,
            page: page,
            page_size: page_size
          }).then(function(moderations) {
            var moderationsMeta, ref1;
            moderationsMeta = (ref1 = moderations[0]) != null ? ref1.getMeta() : void 0;
            return _this.setState({
              user: user,
              moderations: moderations,
              moderationsMeta: moderationsMeta,
              loading: false
            });
          })["catch"](function(e) {
            _this.setState({
              loading: false
            });
            throw new Error(e);
          });
        };
      })(this));
    },
    updateModeration: function(moderation, action, message) {
      var user_id;
      user_id = this.state.user.id;
      return moderation.update({
        actions: [
          {
            user_id: user_id,
            action: action,
            message: message
          }
        ]
      }).save().then((function(_this) {
        return function() {
          return _this.setModerations();
        };
      })(this));
    },
    filterByAction: function(action) {
      return updateQueryParams(this.history, {
        state: action
      });
    },
    nameOf: function(action) {
      switch (action) {
        case 'closed':
          return 'deleted';
        case 'all':
          return 'all reports';
        default:
          return action;
      }
    },
    render: function() {
      var moderation, state;
      if (!this.props.user) {
        return React.createElement("p", null, "You must be logged in to view this page");
      }
      state = this.props.location.query.state;
      return React.createElement("div", {
        "className": "talk moderations"
      }, React.createElement("section", null, ['all', 'opened', 'ignored', 'closed'].map((function(_this) {
        return function(action) {
          return React.createElement("button", {
            "key": action,
            "onClick": (function() {
              return _this.filterByAction(action);
            }),
            "className": (state === action ? 'active' : '')
          }, _this.nameOf(action));
        };
      })(this))), React.createElement("div", null, (this.state.loading ? React.createElement(Loading, null) : this.state.moderations.length > 0 ? React.createElement("div", null, (function() {
        var i, len, ref, results;
        ref = this.state.moderations;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          moderation = ref[i];
          results.push(React.createElement(ModerationComment, React.__spread({}, this.props, {
            "key": "moderation-" + moderation.id,
            "moderation": moderation,
            "updateModeration": this.updateModeration
          })));
        }
        return results;
      }).call(this), React.createElement(Paginator, {
        "page": +this.state.moderationsMeta.page,
        "pageCount": +this.state.moderationsMeta.page_count
      })) : React.createElement("p", null, "There are not currently any ", (state !== 'all' ? this.nameOf(state) : void 0), " moderations."))));
    }
  });
}


},{"../components/loading-indicator":77,"./config":249,"./lib/paginator":273,"./lib/update-query-params":281,"./moderation/comment":290,"panoptes-client/lib/auth":550,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],293:[function(require,module,exports){
var Link, PromiseRenderer, React, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

PromiseRenderer = require('../components/promise-renderer');

Link = require('react-router').Link;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkPopularTags',
    propTypes: {
      header: React.PropTypes.object,
      section: React.PropTypes.string.isRequired
    },
    tagsRequest: function() {
      var query;
      query = {
        section: this.props.section,
        limit: 20,
        page_size: 20
      };
      if (this.props.type && this.props.id) {
        query.taggable_type = this.props.type;
        query.taggable_id = this.props.id;
      }
      return talkClient.type('tags/popular').get(query);
    },
    tag: function(talkTag, i) {
      var tag;
      tag = talkTag.name;
      if (this.props.project) {
        return React.createElement("div", {
          "key": talkTag.id,
          "className": "truncated"
        }, React.createElement(Link, {
          "to": "/projects/" + this.props.project.slug + "/talk/tags/" + tag
        }, "#", tag), ' ');
      } else {
        return React.createElement("div", {
          "key": talkTag.id,
          "className": "truncated"
        }, React.createElement(Link, {
          "to": "/talk/search/?query=" + tag
        }, "#", tag), ' ');
      }
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk-popular-tags"
      }, React.createElement(PromiseRenderer, {
        "promise": this.tagsRequest()
      }, ((function(_this) {
        return function(tags) {
          var ref;
          if (tags != null ? tags.length : void 0) {
            return React.createElement("div", null, (ref = _this.props.header) != null ? ref : null, React.createElement("section", null, tags.map(_this.tag)));
          }
        };
      })(this))));
    }
  });
}


},{"../components/promise-renderer":86,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],294:[function(require,module,exports){
var CommentBox, History, React, ReactDOM, apiClient, talkClient;

React = require('react');

ReactDOM = require('react-dom');

apiClient = require('panoptes-client/lib/api-client');

talkClient = require('panoptes-client/lib/talk-client');

History = require('react-router').History;

CommentBox = require('./comment-box');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'PrivateMessageForm',
    mixins: [History],
    onSubmitMessage: function(_, body) {
      var input, pm, title, user_id;
      pm = ReactDOM.findDOMNode(this).querySelector('.private-message-form');
      input = pm.querySelector('input');
      title = input.value;
      user_id = this.props.user.id;
      return apiClient.type('users').get({
        login: this.props.params.name
      }).index(0).then((function(_this) {
        return function(user) {
          var conversation, recipient_ids;
          recipient_ids = [+user.id];
          return conversation = {
            title: title,
            body: body,
            user_id: user_id,
            recipient_ids: recipient_ids
          };
        };
      })(this)).then((function(_this) {
        return function(conversation) {
          return talkClient.type('conversations').create(conversation).save().then(function(conversation) {
            return _this.history.pushState(null, "/inbox/" + conversation.id);
          });
        };
      })(this));
    },
    render: function() {
      return React.createElement("div", {
        "className": "talk talk-module"
      }, (this.props.user ? React.createElement("div", {
        "className": "private-message-form"
      }, React.createElement("input", {
        "placeholder": "Subject"
      }), React.createElement(CommentBox, {
        "header": null,
        "user": this.props.user,
        "content": "",
        "validationCheck": (function() {
          return false;
        }),
        "validationErrors": [],
        "submitFeedback": "Sent!",
        "onSubmitComment": this.onSubmitMessage,
        "submit": "Send Message"
      })) : void 0));
    }
  });
}


},{"./comment-box":244,"panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-dom":"react-dom","react-router":"react-router"}],295:[function(require,module,exports){
var BOARD_DESCRIPTION, BOARD_TITLE, CommentBox, History, PAGE_SIZE, React, State, apiClient, commentValidations, defaultDiscussionTitle, getErrors, merge, parseSection, projectSection, ref, talkClient, talkConfig;

React = require('react');

CommentBox = require('./comment-box');

talkClient = require('panoptes-client/lib/talk-client');

apiClient = require('panoptes-client/lib/api-client');

parseSection = require('./lib/parse-section');

projectSection = require('./lib/project-section');

ref = require('react-router'), State = ref.State, History = ref.History;

merge = require('lodash.merge');

getErrors = require('./lib/validations').getErrors;

commentValidations = require('./lib/comment-validations');

talkConfig = require('./config');

BOARD_TITLE = 'Notes';

BOARD_DESCRIPTION = 'General comment threads about individual subjects';

defaultDiscussionTitle = function(subject) {
  return "Subject " + subject.id;
};

PAGE_SIZE = talkConfig.discussionPageSize;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkQuickSubjectCommentForm',
    mixins: [State, History],
    propTypes: {
      subject: React.PropTypes.object,
      user: React.PropTypes.object
    },
    getInitialState: function() {
      return {
        commentValidationErrors: []
      };
    },
    commentValidations: function(commentBody) {
      var commentErrors;
      commentErrors = getErrors(commentBody, commentValidations);
      this.setState({
        commentValidationErrors: commentValidationErrors
      });
      return !!commentErrors.length;
    },
    onSubmitComment: function(e, commentText, subject) {
      var name, owner, ref1;
      e.preventDefault();
      ref1 = this.props.params, name = ref1.name, owner = ref1.owner;
      return apiClient.type('projects').get({
        slug: owner + '/' + name
      }).then((function(_this) {
        return function(arg) {
          var project, section;
          project = arg[0];
          section = projectSection(project);
          return talkClient.type('boards').get({
            section: section,
            subject_default: true
          }).index(0).then(function(board) {
            var discussionTitle;
            if (board != null) {
              discussionTitle = defaultDiscussionTitle(_this.props.subject);
              return talkClient.type('discussions').get({
                board_id: board.id,
                title: discussionTitle,
                subject_default: true
              }).index(0).then(function(discussion) {
                var body, comment, comments, discussion_id, focus_id, focus_type, ref2, ref3, ref4, ref5, user_id;
                if (discussion != null) {
                  user_id = (ref2 = _this.props.user) != null ? ref2.id : void 0;
                  body = commentText;
                  discussion_id = +discussion.id;
                  comment = merge({}, {
                    user_id: user_id,
                    discussion_id: discussion_id,
                    body: body
                  });
                  return talkClient.type('comments').create(comment).save().then(function(comment) {
                    return _this.history.pushState(null, "/projects/" + owner + "/" + name + "/talk/" + discussion.board_id + "/" + discussion.id + "?comment=" + comment.id);
                  });
                } else {
                  focus_id = +((ref3 = _this.props.subject) != null ? ref3.id : void 0);
                  if (!!focus_id) {
                    focus_type = 'Subject';
                  }
                  user_id = (ref4 = _this.props.user) != null ? ref4.id : void 0;
                  body = commentText;
                  comments = [
                    merge({}, {
                      user_id: user_id,
                      body: body
                    }, (!!focus_id ? {
                      focus_id: focus_id,
                      focus_type: focus_type
                    } : void 0))
                  ];
                  discussion = {
                    title: "Subject " + _this.props.subject.id,
                    user_id: (ref5 = _this.props.user) != null ? ref5.id : void 0,
                    subject_default: true,
                    board_id: board.id,
                    comments: comments
                  };
                  return talkClient.type('discussions').create(discussion).save().then(function(discussion) {
                    return _this.history.pushState(null, "/projects/" + owner + "/" + name + "/talk/" + discussion.board_id + "/" + discussion.id);
                  });
                }
              });
            } else {
              throw new Error("A board for subject comments has not been setup for this project yet.");
            }
          });
        };
      })(this));
    },
    render: function() {
      return React.createElement("div", {
        "className": "quick-subject-comment-form talk-module"
      }, React.createElement("h1", null, "Leave a note about this subject"), React.createElement(CommentBox, {
        "user": this.props.user,
        "header": null,
        "validationCheck": this.commentErrors,
        "validationErrors": this.state.commentValidationErrors,
        "submitFeedback": "Comment successfully added",
        "placeholder": "Add a note about this subject, or mark with a #hashtag",
        "onSubmitComment": this.onSubmitComment,
        "subject": this.props.subject,
        "submit": "Add Your comment"
      }));
    }
  });
}


},{"./comment-box":244,"./config":249,"./lib/comment-validations":264,"./lib/parse-section":274,"./lib/project-section":276,"./lib/validations":285,"lodash.merge":"lodash.merge","panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],296:[function(require,module,exports){
var Comment, History, Link, Loading, Paginator, React, ref, talkClient, talkConfig, updateQueryParams;

React = require('react');

Comment = require('./comment');

ref = require('react-router'), Link = ref.Link, History = ref.History;

talkClient = require('panoptes-client/lib/talk-client');

Paginator = require('./lib/paginator');

updateQueryParams = require('./lib/update-query-params');

Loading = require('../components/loading-indicator');

talkConfig = require('./config');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkRecents',
    mixins: [History],
    getInitialState: function() {
      return {
        comments: [],
        boardTitle: null,
        loading: true
      };
    },
    getDefaultProps: function() {
      return {
        location: {
          query: {
            page: 1,
            showNotes: 'true'
          }
        }
      };
    },
    componentWillReceiveProps: function(nextProps) {
      if (nextProps.location.query.page !== this.props.location.query.page) {
        return this.getComments(nextProps.location.query.page);
      }
    },
    componentDidMount: function() {
      return this.getComments();
    },
    commentParams: function(page) {
      var params, showNotes;
      params = {
        sort: '-created_at',
        page: page
      };
      showNotes = this.refs.showNotes ? this.refs.showNotes.checked : this.props.location.query.showNotes === 'true';
      params.page_size = talkConfig.recentsPageSize;
      if (!(showNotes || this.props.params.board)) {
        params.subject_default = false;
      }
      if (this.props.params.board) {
        if (this.props.params.board) {
          params.board_id = this.props.params.board;
        }
      } else if (this.props.project) {
        params.section = "project-" + this.props.project.id;
      } else {
        params.section = 'zooniverse';
      }
      return params;
    },
    getComments: function(page) {
      if (page == null) {
        page = this.props.location.query.page;
      }
      return talkClient.type('comments').get(this.commentParams(page)).then((function(_this) {
        return function(comments) {
          var boardTitle, loading, meta, ref1;
          meta = ((ref1 = comments[0]) != null ? ref1.getMeta() : void 0) || {};
          if (_this.props.params.board) {
            boardTitle = comments[0].board_title;
          }
          loading = false;
          return _this.setState({
            comments: comments,
            boardTitle: boardTitle,
            meta: meta,
            loading: loading
          });
        };
      })(this));
    },
    toggleNotes: function() {
      updateQueryParams(this.history, {
        showNotes: this.refs.showNotes.checked,
        page: 1
      });
      return this.getComments();
    },
    commentTitle: function(comment) {
      var name, owner, ref1;
      return React.createElement("span", null, (this.props.params.owner && this.props.params.name ? ((ref1 = this.props.params, owner = ref1.owner, name = ref1.name, ref1), React.createElement(Link, {
        "to": "/projects/" + owner + "/" + name + "/talk/" + comment.board_id + "/" + comment.discussion_id + "?comment=" + comment.id
      }, comment.discussion_title, " on ", comment.board_title)) : React.createElement(Link, {
        "to": "/talk/" + comment.board_id + "/" + comment.discussion_id + "?comment=" + comment.id
      }, comment.discussion_title, " on ", comment.board_title)));
    },
    renderComment: function(comment) {
      return React.createElement(Comment, React.__spread({}, this.props, {
        "title": this.commentTitle(comment),
        "project": this.props.project,
        "key": comment.id,
        "data": comment,
        "user": this.props.user,
        "project": this.props.project
      }));
    },
    renderPagination: function() {
      return React.createElement(Paginator, {
        "page": +this.state.meta.page,
        "pageCount": this.state.meta.page_count
      });
    },
    render: function() {
      var ref1, ref2, showNotes;
      showNotes = (ref1 = this.props.location.query.showNotes) != null ? ref1 : 'true';
      return React.createElement("div", {
        "className": "talk-recents"
      }, React.createElement("h1", {
        "className": "talk-page-header"
      }, "Recent Comments ", "on " + (this.state.boardTitle || ((ref2 = this.props.project) != null ? ref2.display_name : void 0) || 'Zooniverse'), (!this.props.params.board ? React.createElement("small", {
        "className": "talk-subject-default-toggle"
      }, React.createElement("label", null, React.createElement("input", {
        "ref": "showNotes",
        "type": "checkbox",
        "checked": showNotes === 'true',
        "onChange": this.toggleNotes
      }), "Show subject notes")) : void 0)), (this.state.loading ? React.createElement(Loading, null) : React.createElement("div", null, this.renderPagination(), React.createElement("div", {
        "className": "talk-discussion-comments"
      }, this.state.comments.map(this.renderComment)), this.renderPagination())));
    }
  });
}


},{"../components/loading-indicator":77,"./comment":248,"./config":249,"./lib/paginator":273,"./lib/update-query-params":281,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],297:[function(require,module,exports){
var History, React;

React = require('react');

History = require('react-router').History;

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'TalkSearchInput',
    mixins: [History],
    propTypes: {
      params: React.PropTypes.object,
      query: React.PropTypes.object,
      placeholder: React.PropTypes.string
    },
    onSearchSubmit: function(e) {
      var inputValue, name, owner, ref;
      e.preventDefault();
      ref = this.props.params, owner = ref.owner, name = ref.name;
      inputValue = this.searchInput().value;
      if (owner && name) {
        if (inputValue.match(/\#[-\w\d]{3,40}/)) {
          return this.history.pushState(null, "/projects/" + owner + "/" + name + "/talk/tags/" + (inputValue.slice(1, inputValue.length)));
        } else {
          return this.history.pushState(null, "/projects/" + owner + "/" + name + "/talk/search", {
            query: inputValue
          });
        }
      } else {
        return this.history.pushState(null, "/talk/search", {
          query: inputValue
        });
      }
    },
    searchInput: function() {
      return this.refs.talkSearchInput;
    },
    componentWillReceiveProps: function(nextProps) {
      var ref;
      if ((ref = nextProps.location.query) != null ? ref.query : void 0) {
        return this.searchInput().value = nextProps.location.query.query;
      } else {
        return this.searchInput().value = '';
      }
    },
    render: function() {
      var ref, ref1;
      return React.createElement("form", {
        "className": "talk-search-form",
        "onSubmit": this.onSearchSubmit
      }, React.createElement("input", {
        "type": "text",
        "defaultValue": ((ref = this.props.location.query) != null ? ref.query : void 0),
        "placeholder": (ref1 = this.props.placeholder) != null ? ref1 : "Search...",
        "ref": "talkSearchInput"
      }), React.createElement("button", {
        "type": "submit"
      }, React.createElement("i", {
        "className": "fa fa-search"
      })));
    }
  });
}


},{"react":"react","react-router":"react-router"}],298:[function(require,module,exports){
var CommentContextIcon, CommentLink, DiscussionPreview, Markdown, PromiseRenderer, React, apiClient, parseSection;

React = require('react');

DiscussionPreview = require('./discussion-preview');

CommentLink = require('./comment-link');

PromiseRenderer = require('../components/promise-renderer');

parseSection = require('./lib/parse-section');

CommentContextIcon = require('./lib/comment-context-icon');

apiClient = require('panoptes-client/lib/api-client');

Markdown = require('markdownz').Markdown;

module.exports = React.createClass({
  displayName: "TalkSearchResult",
  discussionFromComment: function(comment) {
    return {
      id: comment.discussion_id,
      board_id: comment.board_id,
      title: comment.discussion_title,
      users_count: comment.discussion_users_count,
      comments_count: comment.discussion_comments_count,
      latest_comment: comment
    };
  },
  render: function() {
    var comment, discussion, name, owner, ref, ref1, section;
    comment = this.props.data;
    discussion = this.discussionFromComment(comment);
    section = parseSection(comment.section);
    ref1 = ((ref = comment.project_slug) != null ? ref.split('/') : void 0) || [], owner = ref1[0], name = ref1[1];
    return React.createElement("div", {
      "className": "talk-search-result talk-module"
    }, React.createElement(CommentContextIcon, {
      "comment": comment
    }), React.createElement(CommentLink, {
      "comment": comment
    }, comment.discussion_title), React.createElement(Markdown, {
      "content": comment.body,
      "project": this.props.project
    }), React.createElement(DiscussionPreview, React.__spread({}, this.props, {
      "discussion": discussion,
      "owner": owner,
      "name": name,
      "comment": comment
    })));
  }
});


},{"../components/promise-renderer":86,"./comment-link":246,"./discussion-preview":252,"./lib/comment-context-icon":263,"./lib/parse-section":274,"markdownz":"markdownz","panoptes-client/lib/api-client":549,"react":"react"}],299:[function(require,module,exports){
var ActiveUsers, History, Loading, Paginator, PopularTags, ProjectLinker, React, SidebarNotifications, TALK_SEARCH_ERROR_MESSAGE, TalkSearchResult, VALID_SEARCH_PARAMS, filterObjectKeys, resourceCount, talkClient;

React = require('react');

History = require('react-router').History;

talkClient = require('panoptes-client/lib/talk-client');

Paginator = require('./lib/paginator');

TalkSearchResult = require('./search-result');

resourceCount = require('./lib/resource-count');

Loading = require('../components/loading-indicator');

PopularTags = require('./popular-tags');

ActiveUsers = require('./active-users');

ProjectLinker = require('./lib/project-linker');

SidebarNotifications = require('./lib/sidebar-notifications');

TALK_SEARCH_ERROR_MESSAGE = 'There was an error with your search. Please try again.';

VALID_SEARCH_PARAMS = ['page', 'page_size', 'query', 'types', 'section'];

filterObjectKeys = function(object, validKeys) {
  var key, newObject, value;
  newObject = {};
  for (key in object) {
    value = object[key];
    if (validKeys.indexOf(key) > -1) {
      newObject[key] = value;
    }
  }
  return newObject;
};

module.exports = React.createClass({
  displayName: 'TalkSearch',
  mixins: [History],
  getInitialState: function() {
    return {
      errorThrown: false,
      isLoading: true,
      results: [],
      resultsMeta: {}
    };
  },
  componentDidMount: function() {
    return this.runSearchQuery(filterObjectKeys(this.props.location.query, VALID_SEARCH_PARAMS));
  },
  componentWillReceiveProps: function(nextProps) {
    if (this.props.location.query !== nextProps.location.query) {
      return this.runSearchQuery(filterObjectKeys(nextProps.location.query, VALID_SEARCH_PARAMS));
    }
  },
  runSearchQuery: function(params) {
    var defaultParams, paramsToUse;
    this.setState({
      errorThrown: false,
      isLoading: true,
      results: []
    });
    defaultParams = {
      section: this.props.section,
      types: ['comments'],
      page: 1,
      page_size: 10
    };
    paramsToUse = Object.assign({}, defaultParams, params);
    return talkClient.type('searches').get(paramsToUse).then((function(_this) {
      return function(searches) {
        var ref;
        return _this.setState({
          results: searches,
          resultsMeta: (ref = searches[0]) != null ? ref.getMeta('searches') : void 0
        });
      };
    })(this))["catch"]((function(_this) {
      return function(e) {
        return _this.setState({
          errorThrown: true
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.setState({
          isLoading: false
        });
      };
    })(this));
  },
  onPageChange: function(page) {
    return this.goToPage(page);
  },
  goToPage: function(n) {
    var nextQuery;
    nextQuery = Object.assign({}, this.props.location.query, {
      page: n
    });
    return this.history.pushState(null, location.pathname, nextQuery);
  },
  render: function() {
    var numberOfResults;
    numberOfResults = this.state.results.length;
    return React.createElement("div", {
      "className": "talk-search"
    }, React.createElement("button", {
      "className": "link-style",
      "type": "button",
      "onClick": this.history.goBack
    }, React.createElement("i", {
      "className": "fa fa-backward"
    }), " Back"), (this.state.isLoading ? React.createElement(Loading, null) : void 0), (this.state.errorThrown ? React.createElement("p", {
      "className": "form-help error"
    }, TALK_SEARCH_ERROR_MESSAGE) : void 0), (!this.state.isLoading && numberOfResults === 0 && !this.state.errorThrown ? React.createElement("p", null, "No results found.") : void 0), (!this.state.isLoading && numberOfResults > 0 ? React.createElement("div", {
      "className": "talk-search-container"
    }, React.createElement("div", {
      "className": "talk-search-counts"
    }, "Your search returned ", resourceCount(this.state.resultsMeta.count, 'results'), "."), React.createElement("div", {
      "className": "talk-list-content"
    }, React.createElement("section", {
      "className": "talk-search-results"
    }, this.state.results.map((function(_this) {
      return function(result, i) {
        return React.createElement(TalkSearchResult, React.__spread({}, _this.props, {
          "data": result,
          "key": i
        }));
      };
    })(this)), React.createElement(Paginator, {
      "page": +this.state.resultsMeta.page,
      "onPageChange": this.onPageChange,
      "pageCount": this.state.resultsMeta.page_count
    })), React.createElement("div", {
      "className": "talk-sidebar"
    }, React.createElement(SidebarNotifications, React.__spread({}, this.props)), React.createElement("section", null, React.createElement(PopularTags, {
      "header": React.createElement("h3", null, "Popular Tags:"),
      "section": this.props.section,
      "project": this.props.project
    })), React.createElement("section", null, React.createElement(ActiveUsers, {
      "section": this.props.section
    })), React.createElement("section", null, React.createElement("h3", null, "Projects:"), React.createElement(ProjectLinker, null))))) : void 0));
  }
});


},{"../components/loading-indicator":77,"./active-users":239,"./lib/paginator":273,"./lib/project-linker":275,"./lib/resource-count":277,"./lib/sidebar-notifications":279,"./popular-tags":293,"./search-result":298,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],300:[function(require,module,exports){
var React, talkClient;

React = require('react');

talkClient = require('panoptes-client/lib/talk-client');

if (typeof module !== "undefined" && module !== null) {
  module.exports = React.createClass({
    displayName: 'StickyDiscussionList',
    placeholder: function() {
      this.placeholder || (this.placeholder = document.getElementById("talk-sticky-placeholder"));
      return this.placeholder;
    },
    getInitialState: function() {
      return {
        data: []
      };
    },
    componentDidMount: function() {
      return this.reloadList();
    },
    reloadList: function() {
      return this.getStickyDiscussions().then((function(_this) {
        return function(data) {
          return _this.setState({
            data: data
          });
        };
      })(this));
    },
    getStickyDiscussions: function() {
      return talkClient.type('discussions').get({
        board_id: this.props.board.id,
        sticky: true
      });
    },
    stickyDiscussion: function(discussion) {
      return React.createElement("li", {
        "data-id": discussion.id,
        "key": discussion.id,
        "draggable": "true",
        "onDragEnd": this.dragEnd,
        "onTouchEnd": this.touchEnd,
        "onDragStart": this.dragStart,
        "onTouchStart": this.touchStart,
        "className": "fa fa-bars bars"
      }, discussion.title);
    },
    dragStart: function(e) {
      var ref, ref1;
      this.start(e);
      if ((ref = e.dataTransfer) != null) {
        ref.effectAllowed = 'move';
      }
      return (ref1 = e.dataTransfer) != null ? ref1.setData('text/html', e.currentTarget) : void 0;
    },
    touchStart: function(e) {
      this.start(e);
      return this.startY = e.targetTouches[0].clientY;
    },
    start: function(e) {
      this.dragged = e.currentTarget;
      this.first = this.last = false;
      return this.placeholder().innerHTML = this.dragged.innerHTML;
    },
    dragEnd: function(e) {
      return this.end(e);
    },
    touchEnd: function(e) {
      this.end(e);
      return this.translate(this.dragged, 0);
    },
    end: function(e) {
      this.dragged.style.display = 'block';
      this.dragged.parentNode.removeChild(this.placeholder());
      this.placeholder().dataset.content = '';
      return this.swap();
    },
    dragMove: function(e) {
      e.preventDefault();
      this.dragged.style.display = 'none';
      if (e.target.className === 'placeholder') {
        return;
      }
      this.over = e.target;
      return e.target.parentNode.insertBefore(this.placeholder(), e.target);
    },
    touchMove: function(e) {
      var error, offset, target, touch;
      e.preventDefault();
      touch = e.targetTouches[0];
      this.dragged.style.display = 'none';
      target = document.elementFromPoint(touch.clientX, touch.clientY);
      if ((target != null ? target.className : void 0) === 'placeholder') {
        return;
      }
      if (target) {
        this.over = target;
      }
      offset = touch.clientY - this.startY;
      try {
        this.dragged.parentNode.insertBefore(this.placeholder(), target);
        this.first = this.last = false;
      } catch (error) {
        if (offset > 0) {
          this.last = true;
          this.dragged.parentNode.insertBefore(this.placeholder(), null);
        } else {
          this.first = true;
          this.dragged.parentNode.insertBefore(this.placeholder(), this.dragged.parentNode.children[0]);
        }
      }
      return this.translate(touch.target, offset);
    },
    swap: function() {
      var data, from, newPosition, positionAfter, positionBefore, ref, ref1, ref2, to;
      data = this.state.data;
      ref = this.findIndexesIn(data), from = ref[0], to = ref[1];
      data.splice(to, 0, data.splice(from, 1)[0]);
      positionBefore = ((ref1 = data[to - 1]) != null ? ref1.sticky_position : void 0) || 1.0;
      positionAfter = ((ref2 = data[to + 1]) != null ? ref2.sticky_position : void 0) || 100.0;
      newPosition = (positionBefore + positionAfter) / 2.0;
      this.setState({
        data: data
      });
      return data[to].update({
        sticky_position: newPosition
      }).save().then(this.reloadList);
    },
    findIndexesIn: function(data) {
      var datum, from, i, j, len, to;
      from = 0;
      to = 0;
      for (i = j = 0, len = data.length; j < len; i = ++j) {
        datum = data[i];
        if (datum.id === +this.dragged.dataset.id) {
          from = i;
        }
        if (datum.id === +this.over.dataset.id) {
          to = i;
        }
      }
      if (from < to) {
        to -= 1;
      }
      if (this.first) {
        to = 0;
      }
      if (this.last) {
        to = data.length - 1;
      }
      return [from, to];
    },
    translate: function(y) {
      var amount;
      amount = "translate(0px, " + y + "px)";
      this.dragged.style.webkitTransform = amount;
      this.dragged.style.msTransform = amount;
      return this.dragged.style.transform = amount;
    },
    render: function() {
      var ref;
      return React.createElement("div", {
        "className": "talk-sticky-list"
      }, (((ref = this.state.data) != null ? ref.length : void 0) > 0 ? React.createElement("ul", {
        "onDragOver": this.dragMove,
        "onTouchMove": this.touchMove
      }, this.state.data.map(this.stickyDiscussion)) : React.createElement("p", null, "There are no sticky discussions on this board")));
    }
  });
}


},{"panoptes-client/lib/talk-client":553,"react":"react"}],301:[function(require,module,exports){
var ActiveUsers, History, Link, Loading, Paginator, PopularTags, ProjectLinker, React, SidebarNotifications, SubjectViewer, apiClient, ref, resourceCount, talkClient;

React = require('react');

ref = require('react-router'), Link = ref.Link, History = ref.History;

talkClient = require('panoptes-client/lib/talk-client');

apiClient = require('panoptes-client/lib/api-client');

Paginator = require('./lib/paginator');

SubjectViewer = require('../components/subject-viewer');

resourceCount = require('./lib/resource-count');

Loading = require('../components/loading-indicator');

PopularTags = require('./popular-tags');

ActiveUsers = require('./active-users');

ProjectLinker = require('./lib/project-linker');

SidebarNotifications = require('./lib/sidebar-notifications');

module.exports = React.createClass({
  displayName: 'TalkTags',
  mixins: [History],
  getInitialState: function() {
    return {
      tags: null,
      meta: {}
    };
  },
  componentDidMount: function() {
    return this.getTags();
  },
  componentWillReceiveProps: function(nextProps) {
    var differentTag, pageChanged;
    pageChanged = nextProps.location.query.page !== this.props.location.query.page;
    differentTag = nextProps.params.tag !== this.props.params.tag;
    if (pageChanged || differentTag) {
      return this.getTags(nextProps.location.query.page, nextProps.params.tag);
    }
  },
  getTags: function(page, name) {
    var section, taggable_type;
    if (page == null) {
      page = this.props.location.query.page;
    }
    if (name == null) {
      name = this.props.params.tag;
    }
    page || (page = 1);
    taggable_type = 'Subject';
    section = "project-" + this.props.project.id;
    return talkClient.type('tags/popular').get({
      page: page,
      taggable_type: taggable_type,
      section: section,
      name: name
    }).then((function(_this) {
      return function(tags) {
        var meta, ref1;
        meta = (ref1 = tags[0]) != null ? ref1.getMeta() : void 0;
        return Promise.all(tags.map(function(tag) {
          return apiClient.type('subjects').get(tag.taggable_id.toString()).then(function(subject) {
            var taggable_id;
            taggable_id = subject.id;
            return talkClient.type('tags/popular').get({
              taggable_type: taggable_type,
              taggable_id: taggable_id
            }).then(function(subjectTags) {
              return tag.update({
                subject: subject,
                subjectTags: subjectTags
              });
            });
          });
        })).then(function(tags) {
          return _this.setState({
            tags: tags,
            meta: meta
          });
        });
      };
    })(this));
  },
  render: function() {
    var ref1, subjectTag, tag;
    return React.createElement("div", {
      "className": "talk-search"
    }, React.createElement("h1", null, "Subjects tagged with #", this.props.params.tag), React.createElement("button", {
      "className": "link-style",
      "type": "button",
      "onClick": this.history.goBack
    }, React.createElement("i", {
      "className": "fa fa-backward"
    }), " Back"), (((ref1 = this.state.tags) != null ? ref1.length : void 0) > 0 ? React.createElement("div", {
      "className": "talk-search-container"
    }, React.createElement("div", {
      "className": "talk-search-counts"
    }, "Your search returned ", resourceCount(this.state.meta.count, 'subjects'), "."), React.createElement("div", {
      "className": "talk-search-results"
    }, React.createElement("div", {
      "className": "talk-list-content"
    }, React.createElement("section", null, (function() {
      var i, len, ref2, results;
      ref2 = this.state.tags;
      results = [];
      for (i = 0, len = ref2.length; i < len; i++) {
        tag = ref2[i];
        results.push(React.createElement("div", {
          "className": "tagged-subject talk-search-result talk-module",
          "key": "tag-" + tag.id
        }, React.createElement("p", null, React.createElement(Link, {
          "to": "/projects/" + this.props.params.owner + "/" + this.props.params.name + "/talk/subjects/" + tag.subject.id
        }, "Subject ", tag.subject.id)), React.createElement(SubjectViewer, {
          "subject": tag.subject,
          "user": this.props.user,
          "project": this.props.project
        }), React.createElement("ul", {
          "className": "tag-list"
        }, (function() {
          var j, len1, ref3, results1;
          ref3 = tag.subjectTags;
          results1 = [];
          for (j = 0, len1 = ref3.length; j < len1; j++) {
            subjectTag = ref3[j];
            results1.push(React.createElement("li", {
              "key": "tag-" + tag.id + "-" + subjectTag.id
            }, React.createElement(Link, React.__spread({
              "to": "/projects/" + this.props.params.owner + "/" + this.props.params.name + "/talk/tags/" + subjectTag.name
            }, this.props), "#", subjectTag.name)));
          }
          return results1;
        }).call(this))));
      }
      return results;
    }).call(this)), React.createElement("div", {
      "className": "talk-sidebar"
    }, React.createElement(SidebarNotifications, React.__spread({}, this.props)), React.createElement("section", null, React.createElement(PopularTags, {
      "header": React.createElement("h3", null, "Popular Tags:"),
      "section": this.props.section,
      "project": this.props.project
    })), React.createElement("section", null, React.createElement(ActiveUsers, {
      "section": this.props.section
    })), React.createElement("section", null, React.createElement("h3", null, "Projects:"), React.createElement(ProjectLinker, {
      "user": this.props.user
    })))), React.createElement(Paginator, {
      "page": +this.state.meta.page,
      "pageCount": this.state.meta.page_count
    }))) : this.state.tags ? React.createElement("p", null, "No tags found.") : React.createElement(Loading, null)));
  }
});


},{"../components/loading-indicator":77,"../components/subject-viewer":90,"./active-users":239,"./lib/paginator":273,"./lib/project-linker":275,"./lib/resource-count":277,"./lib/sidebar-notifications":279,"./popular-tags":293,"panoptes-client/lib/api-client":549,"panoptes-client/lib/talk-client":553,"react":"react","react-router":"react-router"}],302:[function(require,module,exports){

},{}],303:[function(require,module,exports){
(function (global){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
/* eslint-disable no-proto */

'use strict'

var base64 = require('base64-js')
var ieee754 = require('ieee754')
var isArray = require('isarray')

exports.Buffer = Buffer
exports.SlowBuffer = SlowBuffer
exports.INSPECT_MAX_BYTES = 50
Buffer.poolSize = 8192 // not used by this implementation

var rootParent = {}

/**
 * If `Buffer.TYPED_ARRAY_SUPPORT`:
 *   === true    Use Uint8Array implementation (fastest)
 *   === false   Use Object implementation (most compatible, even IE6)
 *
 * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,
 * Opera 11.6+, iOS 4.2+.
 *
 * Due to various browser bugs, sometimes the Object implementation will be used even
 * when the browser supports typed arrays.
 *
 * Note:
 *
 *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,
 *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.
 *
 *   - Safari 5-7 lacks support for changing the `Object.prototype.constructor` property
 *     on objects.
 *
 *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.
 *
 *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of
 *     incorrect length in some situations.

 * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they
 * get the Object implementation, which is slower but behaves correctly.
 */
Buffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined
  ? global.TYPED_ARRAY_SUPPORT
  : typedArraySupport()

function typedArraySupport () {
  function Bar () {}
  try {
    var arr = new Uint8Array(1)
    arr.foo = function () { return 42 }
    arr.constructor = Bar
    return arr.foo() === 42 && // typed array instances can be augmented
        arr.constructor === Bar && // constructor can be set
        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`
        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`
  } catch (e) {
    return false
  }
}

function kMaxLength () {
  return Buffer.TYPED_ARRAY_SUPPORT
    ? 0x7fffffff
    : 0x3fffffff
}

/**
 * Class: Buffer
 * =============
 *
 * The Buffer constructor returns instances of `Uint8Array` that are augmented
 * with function properties for all the node `Buffer` API functions. We use
 * `Uint8Array` so that square bracket notation works as expected -- it returns
 * a single octet.
 *
 * By augmenting the instances, we can avoid modifying the `Uint8Array`
 * prototype.
 */
function Buffer (arg) {
  if (!(this instanceof Buffer)) {
    // Avoid going through an ArgumentsAdaptorTrampoline in the common case.
    if (arguments.length > 1) return new Buffer(arg, arguments[1])
    return new Buffer(arg)
  }

  if (!Buffer.TYPED_ARRAY_SUPPORT) {
    this.length = 0
    this.parent = undefined
  }

  // Common case.
  if (typeof arg === 'number') {
    return fromNumber(this, arg)
  }

  // Slightly less common case.
  if (typeof arg === 'string') {
    return fromString(this, arg, arguments.length > 1 ? arguments[1] : 'utf8')
  }

  // Unusual.
  return fromObject(this, arg)
}

function fromNumber (that, length) {
  that = allocate(that, length < 0 ? 0 : checked(length) | 0)
  if (!Buffer.TYPED_ARRAY_SUPPORT) {
    for (var i = 0; i < length; i++) {
      that[i] = 0
    }
  }
  return that
}

function fromString (that, string, encoding) {
  if (typeof encoding !== 'string' || encoding === '') encoding = 'utf8'

  // Assumption: byteLength() return value is always < kMaxLength.
  var length = byteLength(string, encoding) | 0
  that = allocate(that, length)

  that.write(string, encoding)
  return that
}

function fromObject (that, object) {
  if (Buffer.isBuffer(object)) return fromBuffer(that, object)

  if (isArray(object)) return fromArray(that, object)

  if (object == null) {
    throw new TypeError('must start with number, buffer, array or string')
  }

  if (typeof ArrayBuffer !== 'undefined') {
    if (object.buffer instanceof ArrayBuffer) {
      return fromTypedArray(that, object)
    }
    if (object instanceof ArrayBuffer) {
      return fromArrayBuffer(that, object)
    }
  }

  if (object.length) return fromArrayLike(that, object)

  return fromJsonObject(that, object)
}

function fromBuffer (that, buffer) {
  var length = checked(buffer.length) | 0
  that = allocate(that, length)
  buffer.copy(that, 0, 0, length)
  return that
}

function fromArray (that, array) {
  var length = checked(array.length) | 0
  that = allocate(that, length)
  for (var i = 0; i < length; i += 1) {
    that[i] = array[i] & 255
  }
  return that
}

// Duplicate of fromArray() to keep fromArray() monomorphic.
function fromTypedArray (that, array) {
  var length = checked(array.length) | 0
  that = allocate(that, length)
  // Truncating the elements is probably not what people expect from typed
  // arrays with BYTES_PER_ELEMENT > 1 but it's compatible with the behavior
  // of the old Buffer constructor.
  for (var i = 0; i < length; i += 1) {
    that[i] = array[i] & 255
  }
  return that
}

function fromArrayBuffer (that, array) {
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    // Return an augmented `Uint8Array` instance, for best performance
    array.byteLength
    that = Buffer._augment(new Uint8Array(array))
  } else {
    // Fallback: Return an object instance of the Buffer class
    that = fromTypedArray(that, new Uint8Array(array))
  }
  return that
}

function fromArrayLike (that, array) {
  var length = checked(array.length) | 0
  that = allocate(that, length)
  for (var i = 0; i < length; i += 1) {
    that[i] = array[i] & 255
  }
  return that
}

// Deserialize { type: 'Buffer', data: [1,2,3,...] } into a Buffer object.
// Returns a zero-length buffer for inputs that don't conform to the spec.
function fromJsonObject (that, object) {
  var array
  var length = 0

  if (object.type === 'Buffer' && isArray(object.data)) {
    array = object.data
    length = checked(array.length) | 0
  }
  that = allocate(that, length)

  for (var i = 0; i < length; i += 1) {
    that[i] = array[i] & 255
  }
  return that
}

if (Buffer.TYPED_ARRAY_SUPPORT) {
  Buffer.prototype.__proto__ = Uint8Array.prototype
  Buffer.__proto__ = Uint8Array
} else {
  // pre-set for values that may exist in the future
  Buffer.prototype.length = undefined
  Buffer.prototype.parent = undefined
}

function allocate (that, length) {
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    // Return an augmented `Uint8Array` instance, for best performance
    that = Buffer._augment(new Uint8Array(length))
    that.__proto__ = Buffer.prototype
  } else {
    // Fallback: Return an object instance of the Buffer class
    that.length = length
    that._isBuffer = true
  }

  var fromPool = length !== 0 && length <= Buffer.poolSize >>> 1
  if (fromPool) that.parent = rootParent

  return that
}

function checked (length) {
  // Note: cannot use `length < kMaxLength` here because that fails when
  // length is NaN (which is otherwise coerced to zero.)
  if (length >= kMaxLength()) {
    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +
                         'size: 0x' + kMaxLength().toString(16) + ' bytes')
  }
  return length | 0
}

function SlowBuffer (subject, encoding) {
  if (!(this instanceof SlowBuffer)) return new SlowBuffer(subject, encoding)

  var buf = new Buffer(subject, encoding)
  delete buf.parent
  return buf
}

Buffer.isBuffer = function isBuffer (b) {
  return !!(b != null && b._isBuffer)
}

Buffer.compare = function compare (a, b) {
  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {
    throw new TypeError('Arguments must be Buffers')
  }

  if (a === b) return 0

  var x = a.length
  var y = b.length

  var i = 0
  var len = Math.min(x, y)
  while (i < len) {
    if (a[i] !== b[i]) break

    ++i
  }

  if (i !== len) {
    x = a[i]
    y = b[i]
  }

  if (x < y) return -1
  if (y < x) return 1
  return 0
}

Buffer.isEncoding = function isEncoding (encoding) {
  switch (String(encoding).toLowerCase()) {
    case 'hex':
    case 'utf8':
    case 'utf-8':
    case 'ascii':
    case 'binary':
    case 'base64':
    case 'raw':
    case 'ucs2':
    case 'ucs-2':
    case 'utf16le':
    case 'utf-16le':
      return true
    default:
      return false
  }
}

Buffer.concat = function concat (list, length) {
  if (!isArray(list)) throw new TypeError('list argument must be an Array of Buffers.')

  if (list.length === 0) {
    return new Buffer(0)
  }

  var i
  if (length === undefined) {
    length = 0
    for (i = 0; i < list.length; i++) {
      length += list[i].length
    }
  }

  var buf = new Buffer(length)
  var pos = 0
  for (i = 0; i < list.length; i++) {
    var item = list[i]
    item.copy(buf, pos)
    pos += item.length
  }
  return buf
}

function byteLength (string, encoding) {
  if (typeof string !== 'string') string = '' + string

  var len = string.length
  if (len === 0) return 0

  // Use a for loop to avoid recursion
  var loweredCase = false
  for (;;) {
    switch (encoding) {
      case 'ascii':
      case 'binary':
      // Deprecated
      case 'raw':
      case 'raws':
        return len
      case 'utf8':
      case 'utf-8':
        return utf8ToBytes(string).length
      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return len * 2
      case 'hex':
        return len >>> 1
      case 'base64':
        return base64ToBytes(string).length
      default:
        if (loweredCase) return utf8ToBytes(string).length // assume utf8
        encoding = ('' + encoding).toLowerCase()
        loweredCase = true
    }
  }
}
Buffer.byteLength = byteLength

function slowToString (encoding, start, end) {
  var loweredCase = false

  start = start | 0
  end = end === undefined || end === Infinity ? this.length : end | 0

  if (!encoding) encoding = 'utf8'
  if (start < 0) start = 0
  if (end > this.length) end = this.length
  if (end <= start) return ''

  while (true) {
    switch (encoding) {
      case 'hex':
        return hexSlice(this, start, end)

      case 'utf8':
      case 'utf-8':
        return utf8Slice(this, start, end)

      case 'ascii':
        return asciiSlice(this, start, end)

      case 'binary':
        return binarySlice(this, start, end)

      case 'base64':
        return base64Slice(this, start, end)

      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return utf16leSlice(this, start, end)

      default:
        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)
        encoding = (encoding + '').toLowerCase()
        loweredCase = true
    }
  }
}

Buffer.prototype.toString = function toString () {
  var length = this.length | 0
  if (length === 0) return ''
  if (arguments.length === 0) return utf8Slice(this, 0, length)
  return slowToString.apply(this, arguments)
}

Buffer.prototype.equals = function equals (b) {
  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')
  if (this === b) return true
  return Buffer.compare(this, b) === 0
}

Buffer.prototype.inspect = function inspect () {
  var str = ''
  var max = exports.INSPECT_MAX_BYTES
  if (this.length > 0) {
    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')
    if (this.length > max) str += ' ... '
  }
  return '<Buffer ' + str + '>'
}

Buffer.prototype.compare = function compare (b) {
  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')
  if (this === b) return 0
  return Buffer.compare(this, b)
}

Buffer.prototype.indexOf = function indexOf (val, byteOffset) {
  if (byteOffset > 0x7fffffff) byteOffset = 0x7fffffff
  else if (byteOffset < -0x80000000) byteOffset = -0x80000000
  byteOffset >>= 0

  if (this.length === 0) return -1
  if (byteOffset >= this.length) return -1

  // Negative offsets start from the end of the buffer
  if (byteOffset < 0) byteOffset = Math.max(this.length + byteOffset, 0)

  if (typeof val === 'string') {
    if (val.length === 0) return -1 // special case: looking for empty string always fails
    return String.prototype.indexOf.call(this, val, byteOffset)
  }
  if (Buffer.isBuffer(val)) {
    return arrayIndexOf(this, val, byteOffset)
  }
  if (typeof val === 'number') {
    if (Buffer.TYPED_ARRAY_SUPPORT && Uint8Array.prototype.indexOf === 'function') {
      return Uint8Array.prototype.indexOf.call(this, val, byteOffset)
    }
    return arrayIndexOf(this, [ val ], byteOffset)
  }

  function arrayIndexOf (arr, val, byteOffset) {
    var foundIndex = -1
    for (var i = 0; byteOffset + i < arr.length; i++) {
      if (arr[byteOffset + i] === val[foundIndex === -1 ? 0 : i - foundIndex]) {
        if (foundIndex === -1) foundIndex = i
        if (i - foundIndex + 1 === val.length) return byteOffset + foundIndex
      } else {
        foundIndex = -1
      }
    }
    return -1
  }

  throw new TypeError('val must be string, number or Buffer')
}

// `get` is deprecated
Buffer.prototype.get = function get (offset) {
  console.log('.get() is deprecated. Access using array indexes instead.')
  return this.readUInt8(offset)
}

// `set` is deprecated
Buffer.prototype.set = function set (v, offset) {
  console.log('.set() is deprecated. Access using array indexes instead.')
  return this.writeUInt8(v, offset)
}

function hexWrite (buf, string, offset, length) {
  offset = Number(offset) || 0
  var remaining = buf.length - offset
  if (!length) {
    length = remaining
  } else {
    length = Number(length)
    if (length > remaining) {
      length = remaining
    }
  }

  // must be an even number of digits
  var strLen = string.length
  if (strLen % 2 !== 0) throw new Error('Invalid hex string')

  if (length > strLen / 2) {
    length = strLen / 2
  }
  for (var i = 0; i < length; i++) {
    var parsed = parseInt(string.substr(i * 2, 2), 16)
    if (isNaN(parsed)) throw new Error('Invalid hex string')
    buf[offset + i] = parsed
  }
  return i
}

function utf8Write (buf, string, offset, length) {
  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)
}

function asciiWrite (buf, string, offset, length) {
  return blitBuffer(asciiToBytes(string), buf, offset, length)
}

function binaryWrite (buf, string, offset, length) {
  return asciiWrite(buf, string, offset, length)
}

function base64Write (buf, string, offset, length) {
  return blitBuffer(base64ToBytes(string), buf, offset, length)
}

function ucs2Write (buf, string, offset, length) {
  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)
}

Buffer.prototype.write = function write (string, offset, length, encoding) {
  // Buffer#write(string)
  if (offset === undefined) {
    encoding = 'utf8'
    length = this.length
    offset = 0
  // Buffer#write(string, encoding)
  } else if (length === undefined && typeof offset === 'string') {
    encoding = offset
    length = this.length
    offset = 0
  // Buffer#write(string, offset[, length][, encoding])
  } else if (isFinite(offset)) {
    offset = offset | 0
    if (isFinite(length)) {
      length = length | 0
      if (encoding === undefined) encoding = 'utf8'
    } else {
      encoding = length
      length = undefined
    }
  // legacy write(string, encoding, offset, length) - remove in v0.13
  } else {
    var swap = encoding
    encoding = offset
    offset = length | 0
    length = swap
  }

  var remaining = this.length - offset
  if (length === undefined || length > remaining) length = remaining

  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {
    throw new RangeError('attempt to write outside buffer bounds')
  }

  if (!encoding) encoding = 'utf8'

  var loweredCase = false
  for (;;) {
    switch (encoding) {
      case 'hex':
        return hexWrite(this, string, offset, length)

      case 'utf8':
      case 'utf-8':
        return utf8Write(this, string, offset, length)

      case 'ascii':
        return asciiWrite(this, string, offset, length)

      case 'binary':
        return binaryWrite(this, string, offset, length)

      case 'base64':
        // Warning: maxLength not taken into account in base64Write
        return base64Write(this, string, offset, length)

      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return ucs2Write(this, string, offset, length)

      default:
        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)
        encoding = ('' + encoding).toLowerCase()
        loweredCase = true
    }
  }
}

Buffer.prototype.toJSON = function toJSON () {
  return {
    type: 'Buffer',
    data: Array.prototype.slice.call(this._arr || this, 0)
  }
}

function base64Slice (buf, start, end) {
  if (start === 0 && end === buf.length) {
    return base64.fromByteArray(buf)
  } else {
    return base64.fromByteArray(buf.slice(start, end))
  }
}

function utf8Slice (buf, start, end) {
  end = Math.min(buf.length, end)
  var res = []

  var i = start
  while (i < end) {
    var firstByte = buf[i]
    var codePoint = null
    var bytesPerSequence = (firstByte > 0xEF) ? 4
      : (firstByte > 0xDF) ? 3
      : (firstByte > 0xBF) ? 2
      : 1

    if (i + bytesPerSequence <= end) {
      var secondByte, thirdByte, fourthByte, tempCodePoint

      switch (bytesPerSequence) {
        case 1:
          if (firstByte < 0x80) {
            codePoint = firstByte
          }
          break
        case 2:
          secondByte = buf[i + 1]
          if ((secondByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)
            if (tempCodePoint > 0x7F) {
              codePoint = tempCodePoint
            }
          }
          break
        case 3:
          secondByte = buf[i + 1]
          thirdByte = buf[i + 2]
          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)
            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {
              codePoint = tempCodePoint
            }
          }
          break
        case 4:
          secondByte = buf[i + 1]
          thirdByte = buf[i + 2]
          fourthByte = buf[i + 3]
          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)
            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {
              codePoint = tempCodePoint
            }
          }
      }
    }

    if (codePoint === null) {
      // we did not generate a valid codePoint so insert a
      // replacement char (U+FFFD) and advance only 1 byte
      codePoint = 0xFFFD
      bytesPerSequence = 1
    } else if (codePoint > 0xFFFF) {
      // encode to utf16 (surrogate pair dance)
      codePoint -= 0x10000
      res.push(codePoint >>> 10 & 0x3FF | 0xD800)
      codePoint = 0xDC00 | codePoint & 0x3FF
    }

    res.push(codePoint)
    i += bytesPerSequence
  }

  return decodeCodePointsArray(res)
}

// Based on http://stackoverflow.com/a/22747272/680742, the browser with
// the lowest limit is Chrome, with 0x10000 args.
// We go 1 magnitude less, for safety
var MAX_ARGUMENTS_LENGTH = 0x1000

function decodeCodePointsArray (codePoints) {
  var len = codePoints.length
  if (len <= MAX_ARGUMENTS_LENGTH) {
    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()
  }

  // Decode in chunks to avoid "call stack size exceeded".
  var res = ''
  var i = 0
  while (i < len) {
    res += String.fromCharCode.apply(
      String,
      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)
    )
  }
  return res
}

function asciiSlice (buf, start, end) {
  var ret = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; i++) {
    ret += String.fromCharCode(buf[i] & 0x7F)
  }
  return ret
}

function binarySlice (buf, start, end) {
  var ret = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; i++) {
    ret += String.fromCharCode(buf[i])
  }
  return ret
}

function hexSlice (buf, start, end) {
  var len = buf.length

  if (!start || start < 0) start = 0
  if (!end || end < 0 || end > len) end = len

  var out = ''
  for (var i = start; i < end; i++) {
    out += toHex(buf[i])
  }
  return out
}

function utf16leSlice (buf, start, end) {
  var bytes = buf.slice(start, end)
  var res = ''
  for (var i = 0; i < bytes.length; i += 2) {
    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)
  }
  return res
}

Buffer.prototype.slice = function slice (start, end) {
  var len = this.length
  start = ~~start
  end = end === undefined ? len : ~~end

  if (start < 0) {
    start += len
    if (start < 0) start = 0
  } else if (start > len) {
    start = len
  }

  if (end < 0) {
    end += len
    if (end < 0) end = 0
  } else if (end > len) {
    end = len
  }

  if (end < start) end = start

  var newBuf
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    newBuf = Buffer._augment(this.subarray(start, end))
  } else {
    var sliceLen = end - start
    newBuf = new Buffer(sliceLen, undefined)
    for (var i = 0; i < sliceLen; i++) {
      newBuf[i] = this[i + start]
    }
  }

  if (newBuf.length) newBuf.parent = this.parent || this

  return newBuf
}

/*
 * Need to make sure that buffer isn't trying to write out of bounds.
 */
function checkOffset (offset, ext, length) {
  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')
  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')
}

Buffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var val = this[offset]
  var mul = 1
  var i = 0
  while (++i < byteLength && (mul *= 0x100)) {
    val += this[offset + i] * mul
  }

  return val
}

Buffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) {
    checkOffset(offset, byteLength, this.length)
  }

  var val = this[offset + --byteLength]
  var mul = 1
  while (byteLength > 0 && (mul *= 0x100)) {
    val += this[offset + --byteLength] * mul
  }

  return val
}

Buffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 1, this.length)
  return this[offset]
}

Buffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  return this[offset] | (this[offset + 1] << 8)
}

Buffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  return (this[offset] << 8) | this[offset + 1]
}

Buffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return ((this[offset]) |
      (this[offset + 1] << 8) |
      (this[offset + 2] << 16)) +
      (this[offset + 3] * 0x1000000)
}

Buffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset] * 0x1000000) +
    ((this[offset + 1] << 16) |
    (this[offset + 2] << 8) |
    this[offset + 3])
}

Buffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var val = this[offset]
  var mul = 1
  var i = 0
  while (++i < byteLength && (mul *= 0x100)) {
    val += this[offset + i] * mul
  }
  mul *= 0x80

  if (val >= mul) val -= Math.pow(2, 8 * byteLength)

  return val
}

Buffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var i = byteLength
  var mul = 1
  var val = this[offset + --i]
  while (i > 0 && (mul *= 0x100)) {
    val += this[offset + --i] * mul
  }
  mul *= 0x80

  if (val >= mul) val -= Math.pow(2, 8 * byteLength)

  return val
}

Buffer.prototype.readInt8 = function readInt8 (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 1, this.length)
  if (!(this[offset] & 0x80)) return (this[offset])
  return ((0xff - this[offset] + 1) * -1)
}

Buffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  var val = this[offset] | (this[offset + 1] << 8)
  return (val & 0x8000) ? val | 0xFFFF0000 : val
}

Buffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  var val = this[offset + 1] | (this[offset] << 8)
  return (val & 0x8000) ? val | 0xFFFF0000 : val
}

Buffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset]) |
    (this[offset + 1] << 8) |
    (this[offset + 2] << 16) |
    (this[offset + 3] << 24)
}

Buffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset] << 24) |
    (this[offset + 1] << 16) |
    (this[offset + 2] << 8) |
    (this[offset + 3])
}

Buffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)
  return ieee754.read(this, offset, true, 23, 4)
}

Buffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)
  return ieee754.read(this, offset, false, 23, 4)
}

Buffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 8, this.length)
  return ieee754.read(this, offset, true, 52, 8)
}

Buffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 8, this.length)
  return ieee754.read(this, offset, false, 52, 8)
}

function checkInt (buf, value, offset, ext, max, min) {
  if (!Buffer.isBuffer(buf)) throw new TypeError('buffer must be a Buffer instance')
  if (value > max || value < min) throw new RangeError('value is out of bounds')
  if (offset + ext > buf.length) throw new RangeError('index out of range')
}

Buffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)

  var mul = 1
  var i = 0
  this[offset] = value & 0xFF
  while (++i < byteLength && (mul *= 0x100)) {
    this[offset + i] = (value / mul) & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)

  var i = byteLength - 1
  var mul = 1
  this[offset + i] = value & 0xFF
  while (--i >= 0 && (mul *= 0x100)) {
    this[offset + i] = (value / mul) & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)
  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)
  this[offset] = (value & 0xff)
  return offset + 1
}

function objectWriteUInt16 (buf, value, offset, littleEndian) {
  if (value < 0) value = 0xffff + value + 1
  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; i++) {
    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>
      (littleEndian ? i : 1 - i) * 8
  }
}

Buffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value & 0xff)
    this[offset + 1] = (value >>> 8)
  } else {
    objectWriteUInt16(this, value, offset, true)
  }
  return offset + 2
}

Buffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 8)
    this[offset + 1] = (value & 0xff)
  } else {
    objectWriteUInt16(this, value, offset, false)
  }
  return offset + 2
}

function objectWriteUInt32 (buf, value, offset, littleEndian) {
  if (value < 0) value = 0xffffffff + value + 1
  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; i++) {
    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff
  }
}

Buffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset + 3] = (value >>> 24)
    this[offset + 2] = (value >>> 16)
    this[offset + 1] = (value >>> 8)
    this[offset] = (value & 0xff)
  } else {
    objectWriteUInt32(this, value, offset, true)
  }
  return offset + 4
}

Buffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 24)
    this[offset + 1] = (value >>> 16)
    this[offset + 2] = (value >>> 8)
    this[offset + 3] = (value & 0xff)
  } else {
    objectWriteUInt32(this, value, offset, false)
  }
  return offset + 4
}

Buffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) {
    var limit = Math.pow(2, 8 * byteLength - 1)

    checkInt(this, value, offset, byteLength, limit - 1, -limit)
  }

  var i = 0
  var mul = 1
  var sub = value < 0 ? 1 : 0
  this[offset] = value & 0xFF
  while (++i < byteLength && (mul *= 0x100)) {
    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) {
    var limit = Math.pow(2, 8 * byteLength - 1)

    checkInt(this, value, offset, byteLength, limit - 1, -limit)
  }

  var i = byteLength - 1
  var mul = 1
  var sub = value < 0 ? 1 : 0
  this[offset + i] = value & 0xFF
  while (--i >= 0 && (mul *= 0x100)) {
    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)
  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)
  if (value < 0) value = 0xff + value + 1
  this[offset] = (value & 0xff)
  return offset + 1
}

Buffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value & 0xff)
    this[offset + 1] = (value >>> 8)
  } else {
    objectWriteUInt16(this, value, offset, true)
  }
  return offset + 2
}

Buffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 8)
    this[offset + 1] = (value & 0xff)
  } else {
    objectWriteUInt16(this, value, offset, false)
  }
  return offset + 2
}

Buffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value & 0xff)
    this[offset + 1] = (value >>> 8)
    this[offset + 2] = (value >>> 16)
    this[offset + 3] = (value >>> 24)
  } else {
    objectWriteUInt32(this, value, offset, true)
  }
  return offset + 4
}

Buffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)
  if (value < 0) value = 0xffffffff + value + 1
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 24)
    this[offset + 1] = (value >>> 16)
    this[offset + 2] = (value >>> 8)
    this[offset + 3] = (value & 0xff)
  } else {
    objectWriteUInt32(this, value, offset, false)
  }
  return offset + 4
}

function checkIEEE754 (buf, value, offset, ext, max, min) {
  if (value > max || value < min) throw new RangeError('value is out of bounds')
  if (offset + ext > buf.length) throw new RangeError('index out of range')
  if (offset < 0) throw new RangeError('index out of range')
}

function writeFloat (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)
  }
  ieee754.write(buf, value, offset, littleEndian, 23, 4)
  return offset + 4
}

Buffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {
  return writeFloat(this, value, offset, true, noAssert)
}

Buffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {
  return writeFloat(this, value, offset, false, noAssert)
}

function writeDouble (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)
  }
  ieee754.write(buf, value, offset, littleEndian, 52, 8)
  return offset + 8
}

Buffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {
  return writeDouble(this, value, offset, true, noAssert)
}

Buffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {
  return writeDouble(this, value, offset, false, noAssert)
}

// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)
Buffer.prototype.copy = function copy (target, targetStart, start, end) {
  if (!start) start = 0
  if (!end && end !== 0) end = this.length
  if (targetStart >= target.length) targetStart = target.length
  if (!targetStart) targetStart = 0
  if (end > 0 && end < start) end = start

  // Copy 0 bytes; we're done
  if (end === start) return 0
  if (target.length === 0 || this.length === 0) return 0

  // Fatal error conditions
  if (targetStart < 0) {
    throw new RangeError('targetStart out of bounds')
  }
  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')
  if (end < 0) throw new RangeError('sourceEnd out of bounds')

  // Are we oob?
  if (end > this.length) end = this.length
  if (target.length - targetStart < end - start) {
    end = target.length - targetStart + start
  }

  var len = end - start
  var i

  if (this === target && start < targetStart && targetStart < end) {
    // descending copy from end
    for (i = len - 1; i >= 0; i--) {
      target[i + targetStart] = this[i + start]
    }
  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {
    // ascending copy from start
    for (i = 0; i < len; i++) {
      target[i + targetStart] = this[i + start]
    }
  } else {
    target._set(this.subarray(start, start + len), targetStart)
  }

  return len
}

// fill(value, start=0, end=buffer.length)
Buffer.prototype.fill = function fill (value, start, end) {
  if (!value) value = 0
  if (!start) start = 0
  if (!end) end = this.length

  if (end < start) throw new RangeError('end < start')

  // Fill 0 bytes; we're done
  if (end === start) return
  if (this.length === 0) return

  if (start < 0 || start >= this.length) throw new RangeError('start out of bounds')
  if (end < 0 || end > this.length) throw new RangeError('end out of bounds')

  var i
  if (typeof value === 'number') {
    for (i = start; i < end; i++) {
      this[i] = value
    }
  } else {
    var bytes = utf8ToBytes(value.toString())
    var len = bytes.length
    for (i = start; i < end; i++) {
      this[i] = bytes[i % len]
    }
  }

  return this
}

/**
 * Creates a new `ArrayBuffer` with the *copied* memory of the buffer instance.
 * Added in Node 0.12. Only available in browsers that support ArrayBuffer.
 */
Buffer.prototype.toArrayBuffer = function toArrayBuffer () {
  if (typeof Uint8Array !== 'undefined') {
    if (Buffer.TYPED_ARRAY_SUPPORT) {
      return (new Buffer(this)).buffer
    } else {
      var buf = new Uint8Array(this.length)
      for (var i = 0, len = buf.length; i < len; i += 1) {
        buf[i] = this[i]
      }
      return buf.buffer
    }
  } else {
    throw new TypeError('Buffer.toArrayBuffer not supported in this browser')
  }
}

// HELPER FUNCTIONS
// ================

var BP = Buffer.prototype

/**
 * Augment a Uint8Array *instance* (not the Uint8Array class!) with Buffer methods
 */
Buffer._augment = function _augment (arr) {
  arr.constructor = Buffer
  arr._isBuffer = true

  // save reference to original Uint8Array set method before overwriting
  arr._set = arr.set

  // deprecated
  arr.get = BP.get
  arr.set = BP.set

  arr.write = BP.write
  arr.toString = BP.toString
  arr.toLocaleString = BP.toString
  arr.toJSON = BP.toJSON
  arr.equals = BP.equals
  arr.compare = BP.compare
  arr.indexOf = BP.indexOf
  arr.copy = BP.copy
  arr.slice = BP.slice
  arr.readUIntLE = BP.readUIntLE
  arr.readUIntBE = BP.readUIntBE
  arr.readUInt8 = BP.readUInt8
  arr.readUInt16LE = BP.readUInt16LE
  arr.readUInt16BE = BP.readUInt16BE
  arr.readUInt32LE = BP.readUInt32LE
  arr.readUInt32BE = BP.readUInt32BE
  arr.readIntLE = BP.readIntLE
  arr.readIntBE = BP.readIntBE
  arr.readInt8 = BP.readInt8
  arr.readInt16LE = BP.readInt16LE
  arr.readInt16BE = BP.readInt16BE
  arr.readInt32LE = BP.readInt32LE
  arr.readInt32BE = BP.readInt32BE
  arr.readFloatLE = BP.readFloatLE
  arr.readFloatBE = BP.readFloatBE
  arr.readDoubleLE = BP.readDoubleLE
  arr.readDoubleBE = BP.readDoubleBE
  arr.writeUInt8 = BP.writeUInt8
  arr.writeUIntLE = BP.writeUIntLE
  arr.writeUIntBE = BP.writeUIntBE
  arr.writeUInt16LE = BP.writeUInt16LE
  arr.writeUInt16BE = BP.writeUInt16BE
  arr.writeUInt32LE = BP.writeUInt32LE
  arr.writeUInt32BE = BP.writeUInt32BE
  arr.writeIntLE = BP.writeIntLE
  arr.writeIntBE = BP.writeIntBE
  arr.writeInt8 = BP.writeInt8
  arr.writeInt16LE = BP.writeInt16LE
  arr.writeInt16BE = BP.writeInt16BE
  arr.writeInt32LE = BP.writeInt32LE
  arr.writeInt32BE = BP.writeInt32BE
  arr.writeFloatLE = BP.writeFloatLE
  arr.writeFloatBE = BP.writeFloatBE
  arr.writeDoubleLE = BP.writeDoubleLE
  arr.writeDoubleBE = BP.writeDoubleBE
  arr.fill = BP.fill
  arr.inspect = BP.inspect
  arr.toArrayBuffer = BP.toArrayBuffer

  return arr
}

var INVALID_BASE64_RE = /[^+\/0-9A-Za-z-_]/g

function base64clean (str) {
  // Node strips out invalid characters like \n and \t from the string, base64-js does not
  str = stringtrim(str).replace(INVALID_BASE64_RE, '')
  // Node converts strings with length < 2 to ''
  if (str.length < 2) return ''
  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not
  while (str.length % 4 !== 0) {
    str = str + '='
  }
  return str
}

function stringtrim (str) {
  if (str.trim) return str.trim()
  return str.replace(/^\s+|\s+$/g, '')
}

function toHex (n) {
  if (n < 16) return '0' + n.toString(16)
  return n.toString(16)
}

function utf8ToBytes (string, units) {
  units = units || Infinity
  var codePoint
  var length = string.length
  var leadSurrogate = null
  var bytes = []

  for (var i = 0; i < length; i++) {
    codePoint = string.charCodeAt(i)

    // is surrogate component
    if (codePoint > 0xD7FF && codePoint < 0xE000) {
      // last char was a lead
      if (!leadSurrogate) {
        // no lead yet
        if (codePoint > 0xDBFF) {
          // unexpected trail
          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
          continue
        } else if (i + 1 === length) {
          // unpaired lead
          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
          continue
        }

        // valid lead
        leadSurrogate = codePoint

        continue
      }

      // 2 leads in a row
      if (codePoint < 0xDC00) {
        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
        leadSurrogate = codePoint
        continue
      }

      // valid surrogate pair
      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000
    } else if (leadSurrogate) {
      // valid bmp char, but last char was a lead
      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
    }

    leadSurrogate = null

    // encode utf8
    if (codePoint < 0x80) {
      if ((units -= 1) < 0) break
      bytes.push(codePoint)
    } else if (codePoint < 0x800) {
      if ((units -= 2) < 0) break
      bytes.push(
        codePoint >> 0x6 | 0xC0,
        codePoint & 0x3F | 0x80
      )
    } else if (codePoint < 0x10000) {
      if ((units -= 3) < 0) break
      bytes.push(
        codePoint >> 0xC | 0xE0,
        codePoint >> 0x6 & 0x3F | 0x80,
        codePoint & 0x3F | 0x80
      )
    } else if (codePoint < 0x110000) {
      if ((units -= 4) < 0) break
      bytes.push(
        codePoint >> 0x12 | 0xF0,
        codePoint >> 0xC & 0x3F | 0x80,
        codePoint >> 0x6 & 0x3F | 0x80,
        codePoint & 0x3F | 0x80
      )
    } else {
      throw new Error('Invalid code point')
    }
  }

  return bytes
}

function asciiToBytes (str) {
  var byteArray = []
  for (var i = 0; i < str.length; i++) {
    // Node's code seems to be doing this and not & 0x7F..
    byteArray.push(str.charCodeAt(i) & 0xFF)
  }
  return byteArray
}

function utf16leToBytes (str, units) {
  var c, hi, lo
  var byteArray = []
  for (var i = 0; i < str.length; i++) {
    if ((units -= 2) < 0) break

    c = str.charCodeAt(i)
    hi = c >> 8
    lo = c % 256
    byteArray.push(lo)
    byteArray.push(hi)
  }

  return byteArray
}

function base64ToBytes (str) {
  return base64.toByteArray(base64clean(str))
}

function blitBuffer (src, dst, offset, length) {
  for (var i = 0; i < length; i++) {
    if ((i + offset >= dst.length) || (i >= src.length)) break
    dst[i + offset] = src[i]
  }
  return i
}

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"base64-js":304,"ieee754":305,"isarray":306}],304:[function(require,module,exports){
var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';

;(function (exports) {
	'use strict';

  var Arr = (typeof Uint8Array !== 'undefined')
    ? Uint8Array
    : Array

	var PLUS   = '+'.charCodeAt(0)
	var SLASH  = '/'.charCodeAt(0)
	var NUMBER = '0'.charCodeAt(0)
	var LOWER  = 'a'.charCodeAt(0)
	var UPPER  = 'A'.charCodeAt(0)
	var PLUS_URL_SAFE = '-'.charCodeAt(0)
	var SLASH_URL_SAFE = '_'.charCodeAt(0)

	function decode (elt) {
		var code = elt.charCodeAt(0)
		if (code === PLUS ||
		    code === PLUS_URL_SAFE)
			return 62 // '+'
		if (code === SLASH ||
		    code === SLASH_URL_SAFE)
			return 63 // '/'
		if (code < NUMBER)
			return -1 //no match
		if (code < NUMBER + 10)
			return code - NUMBER + 26 + 26
		if (code < UPPER + 26)
			return code - UPPER
		if (code < LOWER + 26)
			return code - LOWER + 26
	}

	function b64ToByteArray (b64) {
		var i, j, l, tmp, placeHolders, arr

		if (b64.length % 4 > 0) {
			throw new Error('Invalid string. Length must be a multiple of 4')
		}

		// the number of equal signs (place holders)
		// if there are two placeholders, than the two characters before it
		// represent one byte
		// if there is only one, then the three characters before it represent 2 bytes
		// this is just a cheap hack to not do indexOf twice
		var len = b64.length
		placeHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0

		// base64 is 4/3 + up to two characters of the original data
		arr = new Arr(b64.length * 3 / 4 - placeHolders)

		// if there are placeholders, only get up to the last complete 4 chars
		l = placeHolders > 0 ? b64.length - 4 : b64.length

		var L = 0

		function push (v) {
			arr[L++] = v
		}

		for (i = 0, j = 0; i < l; i += 4, j += 3) {
			tmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))
			push((tmp & 0xFF0000) >> 16)
			push((tmp & 0xFF00) >> 8)
			push(tmp & 0xFF)
		}

		if (placeHolders === 2) {
			tmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)
			push(tmp & 0xFF)
		} else if (placeHolders === 1) {
			tmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)
			push((tmp >> 8) & 0xFF)
			push(tmp & 0xFF)
		}

		return arr
	}

	function uint8ToBase64 (uint8) {
		var i,
			extraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes
			output = "",
			temp, length

		function encode (num) {
			return lookup.charAt(num)
		}

		function tripletToBase64 (num) {
			return encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)
		}

		// go through the array every three bytes, we'll deal with trailing stuff later
		for (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {
			temp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])
			output += tripletToBase64(temp)
		}

		// pad the end with zeros, but make sure to not forget the extra bytes
		switch (extraBytes) {
			case 1:
				temp = uint8[uint8.length - 1]
				output += encode(temp >> 2)
				output += encode((temp << 4) & 0x3F)
				output += '=='
				break
			case 2:
				temp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])
				output += encode(temp >> 10)
				output += encode((temp >> 4) & 0x3F)
				output += encode((temp << 2) & 0x3F)
				output += '='
				break
		}

		return output
	}

	exports.toByteArray = b64ToByteArray
	exports.fromByteArray = uint8ToBase64
}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))

},{}],305:[function(require,module,exports){
exports.read = function (buffer, offset, isLE, mLen, nBytes) {
  var e, m
  var eLen = nBytes * 8 - mLen - 1
  var eMax = (1 << eLen) - 1
  var eBias = eMax >> 1
  var nBits = -7
  var i = isLE ? (nBytes - 1) : 0
  var d = isLE ? -1 : 1
  var s = buffer[offset + i]

  i += d

  e = s & ((1 << (-nBits)) - 1)
  s >>= (-nBits)
  nBits += eLen
  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8) {}

  m = e & ((1 << (-nBits)) - 1)
  e >>= (-nBits)
  nBits += mLen
  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8) {}

  if (e === 0) {
    e = 1 - eBias
  } else if (e === eMax) {
    return m ? NaN : ((s ? -1 : 1) * Infinity)
  } else {
    m = m + Math.pow(2, mLen)
    e = e - eBias
  }
  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)
}

exports.write = function (buffer, value, offset, isLE, mLen, nBytes) {
  var e, m, c
  var eLen = nBytes * 8 - mLen - 1
  var eMax = (1 << eLen) - 1
  var eBias = eMax >> 1
  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)
  var i = isLE ? 0 : (nBytes - 1)
  var d = isLE ? 1 : -1
  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0

  value = Math.abs(value)

  if (isNaN(value) || value === Infinity) {
    m = isNaN(value) ? 1 : 0
    e = eMax
  } else {
    e = Math.floor(Math.log(value) / Math.LN2)
    if (value * (c = Math.pow(2, -e)) < 1) {
      e--
      c *= 2
    }
    if (e + eBias >= 1) {
      value += rt / c
    } else {
      value += rt * Math.pow(2, 1 - eBias)
    }
    if (value * c >= 2) {
      e++
      c /= 2
    }

    if (e + eBias >= eMax) {
      m = 0
      e = eMax
    } else if (e + eBias >= 1) {
      m = (value * c - 1) * Math.pow(2, mLen)
      e = e + eBias
    } else {
      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)
      e = 0
    }
  }

  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}

  e = (e << mLen) | m
  eLen += mLen
  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}

  buffer[offset + i - d] |= s * 128
}

},{}],306:[function(require,module,exports){
var toString = {}.toString;

module.exports = Array.isArray || function (arr) {
  return toString.call(arr) == '[object Array]';
};

},{}],307:[function(require,module,exports){
'use strict'

exports.randomBytes = exports.rng = exports.pseudoRandomBytes = exports.prng = require('randombytes')
exports.createHash = exports.Hash = require('create-hash')
exports.createHmac = exports.Hmac = require('create-hmac')

var hashes = ['sha1', 'sha224', 'sha256', 'sha384', 'sha512', 'md5', 'rmd160'].concat(Object.keys(require('browserify-sign/algos')))
exports.getHashes = function () {
  return hashes
}

var p = require('pbkdf2')
exports.pbkdf2 = p.pbkdf2
exports.pbkdf2Sync = p.pbkdf2Sync

var aes = require('browserify-cipher')
;[
  'Cipher',
  'createCipher',
  'Cipheriv',
  'createCipheriv',
  'Decipher',
  'createDecipher',
  'Decipheriv',
  'createDecipheriv',
  'getCiphers',
  'listCiphers'
].forEach(function (key) {
  exports[key] = aes[key]
})

var dh = require('diffie-hellman')
;[
  'DiffieHellmanGroup',
  'createDiffieHellmanGroup',
  'getDiffieHellman',
  'createDiffieHellman',
  'DiffieHellman'
].forEach(function (key) {
  exports[key] = dh[key]
})

var sign = require('browserify-sign')
;[
  'createSign',
  'Sign',
  'createVerify',
  'Verify'
].forEach(function (key) {
  exports[key] = sign[key]
})

exports.createECDH = require('create-ecdh')

var publicEncrypt = require('public-encrypt')

;[
  'publicEncrypt',
  'privateEncrypt',
  'publicDecrypt',
  'privateDecrypt'
].forEach(function (key) {
  exports[key] = publicEncrypt[key]
})

// the least I can do is make error messages for the rest of the node.js/crypto api.
;[
  'createCredentials'
].forEach(function (name) {
  exports[name] = function () {
    throw new Error([
      'sorry, ' + name + ' is not implemented yet',
      'we accept pull requests',
      'https://github.com/crypto-browserify/crypto-browserify'
    ].join('\n'))
  }
})

},{"browserify-cipher":308,"browserify-sign":338,"browserify-sign/algos":337,"create-ecdh":405,"create-hash":431,"create-hmac":444,"diffie-hellman":445,"pbkdf2":452,"public-encrypt":453,"randombytes":498}],308:[function(require,module,exports){
var ebtk = require('evp_bytestokey')
var aes = require('browserify-aes/browser')
var DES = require('browserify-des')
var desModes = require('browserify-des/modes')
var aesModes = require('browserify-aes/modes')
function createCipher (suite, password) {
  var keyLen, ivLen
  suite = suite.toLowerCase()
  if (aesModes[suite]) {
    keyLen = aesModes[suite].key
    ivLen = aesModes[suite].iv
  } else if (desModes[suite]) {
    keyLen = desModes[suite].key * 8
    ivLen = desModes[suite].iv
  } else {
    throw new TypeError('invalid suite type')
  }
  var keys = ebtk(password, false, keyLen, ivLen)
  return createCipheriv(suite, keys.key, keys.iv)
}
function createDecipher (suite, password) {
  var keyLen, ivLen
  suite = suite.toLowerCase()
  if (aesModes[suite]) {
    keyLen = aesModes[suite].key
    ivLen = aesModes[suite].iv
  } else if (desModes[suite]) {
    keyLen = desModes[suite].key * 8
    ivLen = desModes[suite].iv
  } else {
    throw new TypeError('invalid suite type')
  }
  var keys = ebtk(password, false, keyLen, ivLen)
  return createDecipheriv(suite, keys.key, keys.iv)
}

function createCipheriv (suite, key, iv) {
  suite = suite.toLowerCase()
  if (aesModes[suite]) {
    return aes.createCipheriv(suite, key, iv)
  } else if (desModes[suite]) {
    return new DES({
      key: key,
      iv: iv,
      mode: suite
    })
  } else {
    throw new TypeError('invalid suite type')
  }
}
function createDecipheriv (suite, key, iv) {
  suite = suite.toLowerCase()
  if (aesModes[suite]) {
    return aes.createDecipheriv(suite, key, iv)
  } else if (desModes[suite]) {
    return new DES({
      key: key,
      iv: iv,
      mode: suite,
      decrypt: true
    })
  } else {
    throw new TypeError('invalid suite type')
  }
}
exports.createCipher = exports.Cipher = createCipher
exports.createCipheriv = exports.Cipheriv = createCipheriv
exports.createDecipher = exports.Decipher = createDecipher
exports.createDecipheriv = exports.Decipheriv = createDecipheriv
function getCiphers () {
  return Object.keys(desModes).concat(aes.getCiphers())
}
exports.listCiphers = exports.getCiphers = getCiphers

},{"browserify-aes/browser":311,"browserify-aes/modes":315,"browserify-des":326,"browserify-des/modes":327,"evp_bytestokey":336}],309:[function(require,module,exports){
(function (Buffer){
// based on the aes implimentation in triple sec
// https://github.com/keybase/triplesec

// which is in turn based on the one from crypto-js
// https://code.google.com/p/crypto-js/

var uint_max = Math.pow(2, 32)
function fixup_uint32 (x) {
  var ret, x_pos
  ret = x > uint_max || x < 0 ? (x_pos = Math.abs(x) % uint_max, x < 0 ? uint_max - x_pos : x_pos) : x
  return ret
}
function scrub_vec (v) {
  for (var i = 0; i < v.length; v++) {
    v[i] = 0
  }
  return false
}

function Global () {
  this.SBOX = []
  this.INV_SBOX = []
  this.SUB_MIX = [[], [], [], []]
  this.INV_SUB_MIX = [[], [], [], []]
  this.init()
  this.RCON = [0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36]
}

Global.prototype.init = function () {
  var d, i, sx, t, x, x2, x4, x8, xi, _i
  d = (function () {
    var _i, _results
    _results = []
    for (i = _i = 0; _i < 256; i = ++_i) {
      if (i < 128) {
        _results.push(i << 1)
      } else {
        _results.push((i << 1) ^ 0x11b)
      }
    }
    return _results
  })()
  x = 0
  xi = 0
  for (i = _i = 0; _i < 256; i = ++_i) {
    sx = xi ^ (xi << 1) ^ (xi << 2) ^ (xi << 3) ^ (xi << 4)
    sx = (sx >>> 8) ^ (sx & 0xff) ^ 0x63
    this.SBOX[x] = sx
    this.INV_SBOX[sx] = x
    x2 = d[x]
    x4 = d[x2]
    x8 = d[x4]
    t = (d[sx] * 0x101) ^ (sx * 0x1010100)
    this.SUB_MIX[0][x] = (t << 24) | (t >>> 8)
    this.SUB_MIX[1][x] = (t << 16) | (t >>> 16)
    this.SUB_MIX[2][x] = (t << 8) | (t >>> 24)
    this.SUB_MIX[3][x] = t
    t = (x8 * 0x1010101) ^ (x4 * 0x10001) ^ (x2 * 0x101) ^ (x * 0x1010100)
    this.INV_SUB_MIX[0][sx] = (t << 24) | (t >>> 8)
    this.INV_SUB_MIX[1][sx] = (t << 16) | (t >>> 16)
    this.INV_SUB_MIX[2][sx] = (t << 8) | (t >>> 24)
    this.INV_SUB_MIX[3][sx] = t
    if (x === 0) {
      x = xi = 1
    } else {
      x = x2 ^ d[d[d[x8 ^ x2]]]
      xi ^= d[d[xi]]
    }
  }
  return true
}

var G = new Global()

AES.blockSize = 4 * 4

AES.prototype.blockSize = AES.blockSize

AES.keySize = 256 / 8

AES.prototype.keySize = AES.keySize

function bufferToArray (buf) {
  var len = buf.length / 4
  var out = new Array(len)
  var i = -1
  while (++i < len) {
    out[i] = buf.readUInt32BE(i * 4)
  }
  return out
}
function AES (key) {
  this._key = bufferToArray(key)
  this._doReset()
}

AES.prototype._doReset = function () {
  var invKsRow, keySize, keyWords, ksRow, ksRows, t
  keyWords = this._key
  keySize = keyWords.length
  this._nRounds = keySize + 6
  ksRows = (this._nRounds + 1) * 4
  this._keySchedule = []
  for (ksRow = 0; ksRow < ksRows; ksRow++) {
    this._keySchedule[ksRow] = ksRow < keySize ? keyWords[ksRow] : (t = this._keySchedule[ksRow - 1], (ksRow % keySize) === 0 ? (t = (t << 8) | (t >>> 24), t = (G.SBOX[t >>> 24] << 24) | (G.SBOX[(t >>> 16) & 0xff] << 16) | (G.SBOX[(t >>> 8) & 0xff] << 8) | G.SBOX[t & 0xff], t ^= G.RCON[(ksRow / keySize) | 0] << 24) : keySize > 6 && ksRow % keySize === 4 ? t = (G.SBOX[t >>> 24] << 24) | (G.SBOX[(t >>> 16) & 0xff] << 16) | (G.SBOX[(t >>> 8) & 0xff] << 8) | G.SBOX[t & 0xff] : void 0, this._keySchedule[ksRow - keySize] ^ t)
  }
  this._invKeySchedule = []
  for (invKsRow = 0; invKsRow < ksRows; invKsRow++) {
    ksRow = ksRows - invKsRow
    t = this._keySchedule[ksRow - (invKsRow % 4 ? 0 : 4)]
    this._invKeySchedule[invKsRow] = invKsRow < 4 || ksRow <= 4 ? t : G.INV_SUB_MIX[0][G.SBOX[t >>> 24]] ^ G.INV_SUB_MIX[1][G.SBOX[(t >>> 16) & 0xff]] ^ G.INV_SUB_MIX[2][G.SBOX[(t >>> 8) & 0xff]] ^ G.INV_SUB_MIX[3][G.SBOX[t & 0xff]]
  }
  return true
}

AES.prototype.encryptBlock = function (M) {
  M = bufferToArray(new Buffer(M))
  var out = this._doCryptBlock(M, this._keySchedule, G.SUB_MIX, G.SBOX)
  var buf = new Buffer(16)
  buf.writeUInt32BE(out[0], 0)
  buf.writeUInt32BE(out[1], 4)
  buf.writeUInt32BE(out[2], 8)
  buf.writeUInt32BE(out[3], 12)
  return buf
}

AES.prototype.decryptBlock = function (M) {
  M = bufferToArray(new Buffer(M))
  var temp = [M[3], M[1]]
  M[1] = temp[0]
  M[3] = temp[1]
  var out = this._doCryptBlock(M, this._invKeySchedule, G.INV_SUB_MIX, G.INV_SBOX)
  var buf = new Buffer(16)
  buf.writeUInt32BE(out[0], 0)
  buf.writeUInt32BE(out[3], 4)
  buf.writeUInt32BE(out[2], 8)
  buf.writeUInt32BE(out[1], 12)
  return buf
}

AES.prototype.scrub = function () {
  scrub_vec(this._keySchedule)
  scrub_vec(this._invKeySchedule)
  scrub_vec(this._key)
}

AES.prototype._doCryptBlock = function (M, keySchedule, SUB_MIX, SBOX) {
  var ksRow, s0, s1, s2, s3, t0, t1, t2, t3

  s0 = M[0] ^ keySchedule[0]
  s1 = M[1] ^ keySchedule[1]
  s2 = M[2] ^ keySchedule[2]
  s3 = M[3] ^ keySchedule[3]
  ksRow = 4
  for (var round = 1; round < this._nRounds; round++) {
    t0 = SUB_MIX[0][s0 >>> 24] ^ SUB_MIX[1][(s1 >>> 16) & 0xff] ^ SUB_MIX[2][(s2 >>> 8) & 0xff] ^ SUB_MIX[3][s3 & 0xff] ^ keySchedule[ksRow++]
    t1 = SUB_MIX[0][s1 >>> 24] ^ SUB_MIX[1][(s2 >>> 16) & 0xff] ^ SUB_MIX[2][(s3 >>> 8) & 0xff] ^ SUB_MIX[3][s0 & 0xff] ^ keySchedule[ksRow++]
    t2 = SUB_MIX[0][s2 >>> 24] ^ SUB_MIX[1][(s3 >>> 16) & 0xff] ^ SUB_MIX[2][(s0 >>> 8) & 0xff] ^ SUB_MIX[3][s1 & 0xff] ^ keySchedule[ksRow++]
    t3 = SUB_MIX[0][s3 >>> 24] ^ SUB_MIX[1][(s0 >>> 16) & 0xff] ^ SUB_MIX[2][(s1 >>> 8) & 0xff] ^ SUB_MIX[3][s2 & 0xff] ^ keySchedule[ksRow++]
    s0 = t0
    s1 = t1
    s2 = t2
    s3 = t3
  }
  t0 = ((SBOX[s0 >>> 24] << 24) | (SBOX[(s1 >>> 16) & 0xff] << 16) | (SBOX[(s2 >>> 8) & 0xff] << 8) | SBOX[s3 & 0xff]) ^ keySchedule[ksRow++]
  t1 = ((SBOX[s1 >>> 24] << 24) | (SBOX[(s2 >>> 16) & 0xff] << 16) | (SBOX[(s3 >>> 8) & 0xff] << 8) | SBOX[s0 & 0xff]) ^ keySchedule[ksRow++]
  t2 = ((SBOX[s2 >>> 24] << 24) | (SBOX[(s3 >>> 16) & 0xff] << 16) | (SBOX[(s0 >>> 8) & 0xff] << 8) | SBOX[s1 & 0xff]) ^ keySchedule[ksRow++]
  t3 = ((SBOX[s3 >>> 24] << 24) | (SBOX[(s0 >>> 16) & 0xff] << 16) | (SBOX[(s1 >>> 8) & 0xff] << 8) | SBOX[s2 & 0xff]) ^ keySchedule[ksRow++]
  return [
    fixup_uint32(t0),
    fixup_uint32(t1),
    fixup_uint32(t2),
    fixup_uint32(t3)
  ]
}

exports.AES = AES

}).call(this,require("buffer").Buffer)
},{"buffer":303}],310:[function(require,module,exports){
(function (Buffer){
var aes = require('./aes')
var Transform = require('cipher-base')
var inherits = require('inherits')
var GHASH = require('./ghash')
var xor = require('buffer-xor')
inherits(StreamCipher, Transform)
module.exports = StreamCipher

function StreamCipher (mode, key, iv, decrypt) {
  if (!(this instanceof StreamCipher)) {
    return new StreamCipher(mode, key, iv)
  }
  Transform.call(this)
  this._finID = Buffer.concat([iv, new Buffer([0, 0, 0, 1])])
  iv = Buffer.concat([iv, new Buffer([0, 0, 0, 2])])
  this._cipher = new aes.AES(key)
  this._prev = new Buffer(iv.length)
  this._cache = new Buffer('')
  this._secCache = new Buffer('')
  this._decrypt = decrypt
  this._alen = 0
  this._len = 0
  iv.copy(this._prev)
  this._mode = mode
  var h = new Buffer(4)
  h.fill(0)
  this._ghash = new GHASH(this._cipher.encryptBlock(h))
  this._authTag = null
  this._called = false
}
StreamCipher.prototype._update = function (chunk) {
  if (!this._called && this._alen) {
    var rump = 16 - (this._alen % 16)
    if (rump < 16) {
      rump = new Buffer(rump)
      rump.fill(0)
      this._ghash.update(rump)
    }
  }
  this._called = true
  var out = this._mode.encrypt(this, chunk)
  if (this._decrypt) {
    this._ghash.update(chunk)
  } else {
    this._ghash.update(out)
  }
  this._len += chunk.length
  return out
}
StreamCipher.prototype._final = function () {
  if (this._decrypt && !this._authTag) {
    throw new Error('Unsupported state or unable to authenticate data')
  }
  var tag = xor(this._ghash.final(this._alen * 8, this._len * 8), this._cipher.encryptBlock(this._finID))
  if (this._decrypt) {
    if (xorTest(tag, this._authTag)) {
      throw new Error('Unsupported state or unable to authenticate data')
    }
  } else {
    this._authTag = tag
  }
  this._cipher.scrub()
}
StreamCipher.prototype.getAuthTag = function getAuthTag () {
  if (!this._decrypt && Buffer.isBuffer(this._authTag)) {
    return this._authTag
  } else {
    throw new Error('Attempting to get auth tag in unsupported state')
  }
}
StreamCipher.prototype.setAuthTag = function setAuthTag (tag) {
  if (this._decrypt) {
    this._authTag = tag
  } else {
    throw new Error('Attempting to set auth tag in unsupported state')
  }
}
StreamCipher.prototype.setAAD = function setAAD (buf) {
  if (!this._called) {
    this._ghash.update(buf)
    this._alen += buf.length
  } else {
    throw new Error('Attempting to set AAD in unsupported state')
  }
}
function xorTest (a, b) {
  var out = 0
  if (a.length !== b.length) {
    out++
  }
  var len = Math.min(a.length, b.length)
  var i = -1
  while (++i < len) {
    out += (a[i] ^ b[i])
  }
  return out
}

}).call(this,require("buffer").Buffer)
},{"./aes":309,"./ghash":314,"buffer":303,"buffer-xor":323,"cipher-base":324,"inherits":500}],311:[function(require,module,exports){
var ciphers = require('./encrypter')
exports.createCipher = exports.Cipher = ciphers.createCipher
exports.createCipheriv = exports.Cipheriv = ciphers.createCipheriv
var deciphers = require('./decrypter')
exports.createDecipher = exports.Decipher = deciphers.createDecipher
exports.createDecipheriv = exports.Decipheriv = deciphers.createDecipheriv
var modes = require('./modes')
function getCiphers () {
  return Object.keys(modes)
}
exports.listCiphers = exports.getCiphers = getCiphers

},{"./decrypter":312,"./encrypter":313,"./modes":315}],312:[function(require,module,exports){
(function (Buffer){
var aes = require('./aes')
var Transform = require('cipher-base')
var inherits = require('inherits')
var modes = require('./modes')
var StreamCipher = require('./streamCipher')
var AuthCipher = require('./authCipher')
var ebtk = require('evp_bytestokey')

inherits(Decipher, Transform)
function Decipher (mode, key, iv) {
  if (!(this instanceof Decipher)) {
    return new Decipher(mode, key, iv)
  }
  Transform.call(this)
  this._cache = new Splitter()
  this._last = void 0
  this._cipher = new aes.AES(key)
  this._prev = new Buffer(iv.length)
  iv.copy(this._prev)
  this._mode = mode
  this._autopadding = true
}
Decipher.prototype._update = function (data) {
  this._cache.add(data)
  var chunk
  var thing
  var out = []
  while ((chunk = this._cache.get(this._autopadding))) {
    thing = this._mode.decrypt(this, chunk)
    out.push(thing)
  }
  return Buffer.concat(out)
}
Decipher.prototype._final = function () {
  var chunk = this._cache.flush()
  if (this._autopadding) {
    return unpad(this._mode.decrypt(this, chunk))
  } else if (chunk) {
    throw new Error('data not multiple of block length')
  }
}
Decipher.prototype.setAutoPadding = function (setTo) {
  this._autopadding = !!setTo
  return this
}
function Splitter () {
  if (!(this instanceof Splitter)) {
    return new Splitter()
  }
  this.cache = new Buffer('')
}
Splitter.prototype.add = function (data) {
  this.cache = Buffer.concat([this.cache, data])
}

Splitter.prototype.get = function (autoPadding) {
  var out
  if (autoPadding) {
    if (this.cache.length > 16) {
      out = this.cache.slice(0, 16)
      this.cache = this.cache.slice(16)
      return out
    }
  } else {
    if (this.cache.length >= 16) {
      out = this.cache.slice(0, 16)
      this.cache = this.cache.slice(16)
      return out
    }
  }
  return null
}
Splitter.prototype.flush = function () {
  if (this.cache.length) {
    return this.cache
  }
}
function unpad (last) {
  var padded = last[15]
  var i = -1
  while (++i < padded) {
    if (last[(i + (16 - padded))] !== padded) {
      throw new Error('unable to decrypt data')
    }
  }
  if (padded === 16) {
    return
  }
  return last.slice(0, 16 - padded)
}

var modelist = {
  ECB: require('./modes/ecb'),
  CBC: require('./modes/cbc'),
  CFB: require('./modes/cfb'),
  CFB8: require('./modes/cfb8'),
  CFB1: require('./modes/cfb1'),
  OFB: require('./modes/ofb'),
  CTR: require('./modes/ctr'),
  GCM: require('./modes/ctr')
}

function createDecipheriv (suite, password, iv) {
  var config = modes[suite.toLowerCase()]
  if (!config) {
    throw new TypeError('invalid suite type')
  }
  if (typeof iv === 'string') {
    iv = new Buffer(iv)
  }
  if (typeof password === 'string') {
    password = new Buffer(password)
  }
  if (password.length !== config.key / 8) {
    throw new TypeError('invalid key length ' + password.length)
  }
  if (iv.length !== config.iv) {
    throw new TypeError('invalid iv length ' + iv.length)
  }
  if (config.type === 'stream') {
    return new StreamCipher(modelist[config.mode], password, iv, true)
  } else if (config.type === 'auth') {
    return new AuthCipher(modelist[config.mode], password, iv, true)
  }
  return new Decipher(modelist[config.mode], password, iv)
}

function createDecipher (suite, password) {
  var config = modes[suite.toLowerCase()]
  if (!config) {
    throw new TypeError('invalid suite type')
  }
  var keys = ebtk(password, false, config.key, config.iv)
  return createDecipheriv(suite, keys.key, keys.iv)
}
exports.createDecipher = createDecipher
exports.createDecipheriv = createDecipheriv

}).call(this,require("buffer").Buffer)
},{"./aes":309,"./authCipher":310,"./modes":315,"./modes/cbc":316,"./modes/cfb":317,"./modes/cfb1":318,"./modes/cfb8":319,"./modes/ctr":320,"./modes/ecb":321,"./modes/ofb":322,"./streamCipher":325,"buffer":303,"cipher-base":324,"evp_bytestokey":336,"inherits":500}],313:[function(require,module,exports){
(function (Buffer){
var aes = require('./aes')
var Transform = require('cipher-base')
var inherits = require('inherits')
var modes = require('./modes')
var ebtk = require('evp_bytestokey')
var StreamCipher = require('./streamCipher')
var AuthCipher = require('./authCipher')
inherits(Cipher, Transform)
function Cipher (mode, key, iv) {
  if (!(this instanceof Cipher)) {
    return new Cipher(mode, key, iv)
  }
  Transform.call(this)
  this._cache = new Splitter()
  this._cipher = new aes.AES(key)
  this._prev = new Buffer(iv.length)
  iv.copy(this._prev)
  this._mode = mode
  this._autopadding = true
}
Cipher.prototype._update = function (data) {
  this._cache.add(data)
  var chunk
  var thing
  var out = []
  while ((chunk = this._cache.get())) {
    thing = this._mode.encrypt(this, chunk)
    out.push(thing)
  }
  return Buffer.concat(out)
}
Cipher.prototype._final = function () {
  var chunk = this._cache.flush()
  if (this._autopadding) {
    chunk = this._mode.encrypt(this, chunk)
    this._cipher.scrub()
    return chunk
  } else if (chunk.toString('hex') !== '10101010101010101010101010101010') {
    this._cipher.scrub()
    throw new Error('data not multiple of block length')
  }
}
Cipher.prototype.setAutoPadding = function (setTo) {
  this._autopadding = !!setTo
  return this
}

function Splitter () {
  if (!(this instanceof Splitter)) {
    return new Splitter()
  }
  this.cache = new Buffer('')
}
Splitter.prototype.add = function (data) {
  this.cache = Buffer.concat([this.cache, data])
}

Splitter.prototype.get = function () {
  if (this.cache.length > 15) {
    var out = this.cache.slice(0, 16)
    this.cache = this.cache.slice(16)
    return out
  }
  return null
}
Splitter.prototype.flush = function () {
  var len = 16 - this.cache.length
  var padBuff = new Buffer(len)

  var i = -1
  while (++i < len) {
    padBuff.writeUInt8(len, i)
  }
  var out = Buffer.concat([this.cache, padBuff])
  return out
}
var modelist = {
  ECB: require('./modes/ecb'),
  CBC: require('./modes/cbc'),
  CFB: require('./modes/cfb'),
  CFB8: require('./modes/cfb8'),
  CFB1: require('./modes/cfb1'),
  OFB: require('./modes/ofb'),
  CTR: require('./modes/ctr'),
  GCM: require('./modes/ctr')
}

function createCipheriv (suite, password, iv) {
  var config = modes[suite.toLowerCase()]
  if (!config) {
    throw new TypeError('invalid suite type')
  }
  if (typeof iv === 'string') {
    iv = new Buffer(iv)
  }
  if (typeof password === 'string') {
    password = new Buffer(password)
  }
  if (password.length !== config.key / 8) {
    throw new TypeError('invalid key length ' + password.length)
  }
  if (iv.length !== config.iv) {
    throw new TypeError('invalid iv length ' + iv.length)
  }
  if (config.type === 'stream') {
    return new StreamCipher(modelist[config.mode], password, iv)
  } else if (config.type === 'auth') {
    return new AuthCipher(modelist[config.mode], password, iv)
  }
  return new Cipher(modelist[config.mode], password, iv)
}
function createCipher (suite, password) {
  var config = modes[suite.toLowerCase()]
  if (!config) {
    throw new TypeError('invalid suite type')
  }
  var keys = ebtk(password, false, config.key, config.iv)
  return createCipheriv(suite, keys.key, keys.iv)
}

exports.createCipheriv = createCipheriv
exports.createCipher = createCipher

}).call(this,require("buffer").Buffer)
},{"./aes":309,"./authCipher":310,"./modes":315,"./modes/cbc":316,"./modes/cfb":317,"./modes/cfb1":318,"./modes/cfb8":319,"./modes/ctr":320,"./modes/ecb":321,"./modes/ofb":322,"./streamCipher":325,"buffer":303,"cipher-base":324,"evp_bytestokey":336,"inherits":500}],314:[function(require,module,exports){
(function (Buffer){
var zeros = new Buffer(16)
zeros.fill(0)
module.exports = GHASH
function GHASH (key) {
  this.h = key
  this.state = new Buffer(16)
  this.state.fill(0)
  this.cache = new Buffer('')
}
// from http://bitwiseshiftleft.github.io/sjcl/doc/symbols/src/core_gcm.js.html
// by Juho Vh-Herttua
GHASH.prototype.ghash = function (block) {
  var i = -1
  while (++i < block.length) {
    this.state[i] ^= block[i]
  }
  this._multiply()
}

GHASH.prototype._multiply = function () {
  var Vi = toArray(this.h)
  var Zi = [0, 0, 0, 0]
  var j, xi, lsb_Vi
  var i = -1
  while (++i < 128) {
    xi = (this.state[~~(i / 8)] & (1 << (7 - i % 8))) !== 0
    if (xi) {
      // Z_i+1 = Z_i ^ V_i
      Zi = xor(Zi, Vi)
    }

    // Store the value of LSB(V_i)
    lsb_Vi = (Vi[3] & 1) !== 0

    // V_i+1 = V_i >> 1
    for (j = 3; j > 0; j--) {
      Vi[j] = (Vi[j] >>> 1) | ((Vi[j - 1] & 1) << 31)
    }
    Vi[0] = Vi[0] >>> 1

    // If LSB(V_i) is 1, V_i+1 = (V_i >> 1) ^ R
    if (lsb_Vi) {
      Vi[0] = Vi[0] ^ (0xe1 << 24)
    }
  }
  this.state = fromArray(Zi)
}
GHASH.prototype.update = function (buf) {
  this.cache = Buffer.concat([this.cache, buf])
  var chunk
  while (this.cache.length >= 16) {
    chunk = this.cache.slice(0, 16)
    this.cache = this.cache.slice(16)
    this.ghash(chunk)
  }
}
GHASH.prototype.final = function (abl, bl) {
  if (this.cache.length) {
    this.ghash(Buffer.concat([this.cache, zeros], 16))
  }
  this.ghash(fromArray([
    0, abl,
    0, bl
  ]))
  return this.state
}

function toArray (buf) {
  return [
    buf.readUInt32BE(0),
    buf.readUInt32BE(4),
    buf.readUInt32BE(8),
    buf.readUInt32BE(12)
  ]
}
function fromArray (out) {
  out = out.map(fixup_uint32)
  var buf = new Buffer(16)
  buf.writeUInt32BE(out[0], 0)
  buf.writeUInt32BE(out[1], 4)
  buf.writeUInt32BE(out[2], 8)
  buf.writeUInt32BE(out[3], 12)
  return buf
}
var uint_max = Math.pow(2, 32)
function fixup_uint32 (x) {
  var ret, x_pos
  ret = x > uint_max || x < 0 ? (x_pos = Math.abs(x) % uint_max, x < 0 ? uint_max - x_pos : x_pos) : x
  return ret
}
function xor (a, b) {
  return [
    a[0] ^ b[0],
    a[1] ^ b[1],
    a[2] ^ b[2],
    a[3] ^ b[3]
  ]
}

}).call(this,require("buffer").Buffer)
},{"buffer":303}],315:[function(require,module,exports){
exports['aes-128-ecb'] = {
  cipher: 'AES',
  key: 128,
  iv: 0,
  mode: 'ECB',
  type: 'block'
}
exports['aes-192-ecb'] = {
  cipher: 'AES',
  key: 192,
  iv: 0,
  mode: 'ECB',
  type: 'block'
}
exports['aes-256-ecb'] = {
  cipher: 'AES',
  key: 256,
  iv: 0,
  mode: 'ECB',
  type: 'block'
}
exports['aes-128-cbc'] = {
  cipher: 'AES',
  key: 128,
  iv: 16,
  mode: 'CBC',
  type: 'block'
}
exports['aes-192-cbc'] = {
  cipher: 'AES',
  key: 192,
  iv: 16,
  mode: 'CBC',
  type: 'block'
}
exports['aes-256-cbc'] = {
  cipher: 'AES',
  key: 256,
  iv: 16,
  mode: 'CBC',
  type: 'block'
}
exports['aes128'] = exports['aes-128-cbc']
exports['aes192'] = exports['aes-192-cbc']
exports['aes256'] = exports['aes-256-cbc']
exports['aes-128-cfb'] = {
  cipher: 'AES',
  key: 128,
  iv: 16,
  mode: 'CFB',
  type: 'stream'
}
exports['aes-192-cfb'] = {
  cipher: 'AES',
  key: 192,
  iv: 16,
  mode: 'CFB',
  type: 'stream'
}
exports['aes-256-cfb'] = {
  cipher: 'AES',
  key: 256,
  iv: 16,
  mode: 'CFB',
  type: 'stream'
}
exports['aes-128-cfb8'] = {
  cipher: 'AES',
  key: 128,
  iv: 16,
  mode: 'CFB8',
  type: 'stream'
}
exports['aes-192-cfb8'] = {
  cipher: 'AES',
  key: 192,
  iv: 16,
  mode: 'CFB8',
  type: 'stream'
}
exports['aes-256-cfb8'] = {
  cipher: 'AES',
  key: 256,
  iv: 16,
  mode: 'CFB8',
  type: 'stream'
}
exports['aes-128-cfb1'] = {
  cipher: 'AES',
  key: 128,
  iv: 16,
  mode: 'CFB1',
  type: 'stream'
}
exports['aes-192-cfb1'] = {
  cipher: 'AES',
  key: 192,
  iv: 16,
  mode: 'CFB1',
  type: 'stream'
}
exports['aes-256-cfb1'] = {
  cipher: 'AES',
  key: 256,
  iv: 16,
  mode: 'CFB1',
  type: 'stream'
}
exports['aes-128-ofb'] = {
  cipher: 'AES',
  key: 128,
  iv: 16,
  mode: 'OFB',
  type: 'stream'
}
exports['aes-192-ofb'] = {
  cipher: 'AES',
  key: 192,
  iv: 16,
  mode: 'OFB',
  type: 'stream'
}
exports['aes-256-ofb'] = {
  cipher: 'AES',
  key: 256,
  iv: 16,
  mode: 'OFB',
  type: 'stream'
}
exports['aes-128-ctr'] = {
  cipher: 'AES',
  key: 128,
  iv: 16,
  mode: 'CTR',
  type: 'stream'
}
exports['aes-192-ctr'] = {
  cipher: 'AES',
  key: 192,
  iv: 16,
  mode: 'CTR',
  type: 'stream'
}
exports['aes-256-ctr'] = {
  cipher: 'AES',
  key: 256,
  iv: 16,
  mode: 'CTR',
  type: 'stream'
}
exports['aes-128-gcm'] = {
  cipher: 'AES',
  key: 128,
  iv: 12,
  mode: 'GCM',
  type: 'auth'
}
exports['aes-192-gcm'] = {
  cipher: 'AES',
  key: 192,
  iv: 12,
  mode: 'GCM',
  type: 'auth'
}
exports['aes-256-gcm'] = {
  cipher: 'AES',
  key: 256,
  iv: 12,
  mode: 'GCM',
  type: 'auth'
}

},{}],316:[function(require,module,exports){
var xor = require('buffer-xor')

exports.encrypt = function (self, block) {
  var data = xor(block, self._prev)

  self._prev = self._cipher.encryptBlock(data)
  return self._prev
}

exports.decrypt = function (self, block) {
  var pad = self._prev

  self._prev = block
  var out = self._cipher.decryptBlock(block)

  return xor(out, pad)
}

},{"buffer-xor":323}],317:[function(require,module,exports){
(function (Buffer){
var xor = require('buffer-xor')

exports.encrypt = function (self, data, decrypt) {
  var out = new Buffer('')
  var len

  while (data.length) {
    if (self._cache.length === 0) {
      self._cache = self._cipher.encryptBlock(self._prev)
      self._prev = new Buffer('')
    }

    if (self._cache.length <= data.length) {
      len = self._cache.length
      out = Buffer.concat([out, encryptStart(self, data.slice(0, len), decrypt)])
      data = data.slice(len)
    } else {
      out = Buffer.concat([out, encryptStart(self, data, decrypt)])
      break
    }
  }

  return out
}
function encryptStart (self, data, decrypt) {
  var len = data.length
  var out = xor(data, self._cache)
  self._cache = self._cache.slice(len)
  self._prev = Buffer.concat([self._prev, decrypt ? data : out])
  return out
}

}).call(this,require("buffer").Buffer)
},{"buffer":303,"buffer-xor":323}],318:[function(require,module,exports){
(function (Buffer){
function encryptByte (self, byteParam, decrypt) {
  var pad
  var i = -1
  var len = 8
  var out = 0
  var bit, value
  while (++i < len) {
    pad = self._cipher.encryptBlock(self._prev)
    bit = (byteParam & (1 << (7 - i))) ? 0x80 : 0
    value = pad[0] ^ bit
    out += ((value & 0x80) >> (i % 8))
    self._prev = shiftIn(self._prev, decrypt ? bit : value)
  }
  return out
}
exports.encrypt = function (self, chunk, decrypt) {
  var len = chunk.length
  var out = new Buffer(len)
  var i = -1
  while (++i < len) {
    out[i] = encryptByte(self, chunk[i], decrypt)
  }
  return out
}
function shiftIn (buffer, value) {
  var len = buffer.length
  var i = -1
  var out = new Buffer(buffer.length)
  buffer = Buffer.concat([buffer, new Buffer([value])])
  while (++i < len) {
    out[i] = buffer[i] << 1 | buffer[i + 1] >> (7)
  }
  return out
}

}).call(this,require("buffer").Buffer)
},{"buffer":303}],319:[function(require,module,exports){
(function (Buffer){
function encryptByte (self, byteParam, decrypt) {
  var pad = self._cipher.encryptBlock(self._prev)
  var out = pad[0] ^ byteParam
  self._prev = Buffer.concat([self._prev.slice(1), new Buffer([decrypt ? byteParam : out])])
  return out
}
exports.encrypt = function (self, chunk, decrypt) {
  var len = chunk.length
  var out = new Buffer(len)
  var i = -1
  while (++i < len) {
    out[i] = encryptByte(self, chunk[i], decrypt)
  }
  return out
}

}).call(this,require("buffer").Buffer)
},{"buffer":303}],320:[function(require,module,exports){
(function (Buffer){
var xor = require('buffer-xor')

function incr32 (iv) {
  var len = iv.length
  var item
  while (len--) {
    item = iv.readUInt8(len)
    if (item === 255) {
      iv.writeUInt8(0, len)
    } else {
      item++
      iv.writeUInt8(item, len)
      break
    }
  }
}

function getBlock (self) {
  var out = self._cipher.encryptBlock(self._prev)
  incr32(self._prev)
  return out
}

exports.encrypt = function (self, chunk) {
  while (self._cache.length < chunk.length) {
    self._cache = Buffer.concat([self._cache, getBlock(self)])
  }
  var pad = self._cache.slice(0, chunk.length)
  self._cache = self._cache.slice(chunk.length)
  return xor(chunk, pad)
}

}).call(this,require("buffer").Buffer)
},{"buffer":303,"buffer-xor":323}],321:[function(require,module,exports){
exports.encrypt = function (self, block) {
  return self._cipher.encryptBlock(block)
}
exports.decrypt = function (self, block) {
  return self._cipher.decryptBlock(block)
}

},{}],322:[function(require,module,exports){
(function (Buffer){
var xor = require('buffer-xor')

function getBlock (self) {
  self._prev = self._cipher.encryptBlock(self._prev)
  return self._prev
}

exports.encrypt = function (self, chunk) {
  while (self._cache.length < chunk.length) {
    self._cache = Buffer.concat([self._cache, getBlock(self)])
  }

  var pad = self._cache.slice(0, chunk.length)
  self._cache = self._cache.slice(chunk.length)
  return xor(chunk, pad)
}

}).call(this,require("buffer").Buffer)
},{"buffer":303,"buffer-xor":323}],323:[function(require,module,exports){
(function (Buffer){
module.exports = function xor (a, b) {
  var length = Math.min(a.length, b.length)
  var buffer = new Buffer(length)

  for (var i = 0; i < length; ++i) {
    buffer[i] = a[i] ^ b[i]
  }

  return buffer
}

}).call(this,require("buffer").Buffer)
},{"buffer":303}],324:[function(require,module,exports){
(function (Buffer){
var Transform = require('stream').Transform
var inherits = require('inherits')
var StringDecoder = require('string_decoder').StringDecoder
module.exports = CipherBase
inherits(CipherBase, Transform)
function CipherBase (hashMode) {
  Transform.call(this)
  this.hashMode = typeof hashMode === 'string'
  if (this.hashMode) {
    this[hashMode] = this._finalOrDigest
  } else {
    this.final = this._finalOrDigest
  }
  this._decoder = null
  this._encoding = null
}
CipherBase.prototype.update = function (data, inputEnc, outputEnc) {
  if (typeof data === 'string') {
    data = new Buffer(data, inputEnc)
  }
  var outData = this._update(data)
  if (this.hashMode) {
    return this
  }
  if (outputEnc) {
    outData = this._toString(outData, outputEnc)
  }
  return outData
}

CipherBase.prototype.setAutoPadding = function () {}

CipherBase.prototype.getAuthTag = function () {
  throw new Error('trying to get auth tag in unsupported state')
}

CipherBase.prototype.setAuthTag = function () {
  throw new Error('trying to set auth tag in unsupported state')
}

CipherBase.prototype.setAAD = function () {
  throw new Error('trying to set aad in unsupported state')
}

CipherBase.prototype._transform = function (data, _, next) {
  var err
  try {
    if (this.hashMode) {
      this._update(data)
    } else {
      this.push(this._update(data))
    }
  } catch (e) {
    err = e
  } finally {
    next(err)
  }
}
CipherBase.prototype._flush = function (done) {
  var err
  try {
    this.push(this._final())
  } catch (e) {
    err = e
  } finally {
    done(err)
  }
}
CipherBase.prototype._finalOrDigest = function (outputEnc) {
  var outData = this._final() || new Buffer('')
  if (outputEnc) {
    outData = this._toString(outData, outputEnc, true)
  }
  return outData
}

CipherBase.prototype._toString = function (value, enc, final) {
  if (!this._decoder) {
    this._decoder = new StringDecoder(enc)
    this._encoding = enc
  }
  if (this._encoding !== enc) {
    throw new Error('can\'t switch encodings')
  }
  var out = this._decoder.write(value)
  if (final) {
    out += this._decoder.end()
  }
  return out
}

}).call(this,require("buffer").Buffer)
},{"buffer":303,"inherits":500,"stream":521,"string_decoder":522}],325:[function(require,module,exports){
(function (Buffer){
var aes = require('./aes')
var Transform = require('cipher-base')
var inherits = require('inherits')

inherits(StreamCipher, Transform)
module.exports = StreamCipher
function StreamCipher (mode, key, iv, decrypt) {
  if (!(this instanceof StreamCipher)) {
    return new StreamCipher(mode, key, iv)
  }
  Transform.call(this)
  this._cipher = new aes.AES(key)
  this._prev = new Buffer(iv.length)
  this._cache = new Buffer('')
  this._secCache = new Buffer('')
  this._decrypt = decrypt
  iv.copy(this._prev)
  this._mode = mode
}
StreamCipher.prototype._update = function (chunk) {
  return this._mode.encrypt(this, chunk, this._decrypt)
}
StreamCipher.prototype._final = function () {
  this._cipher.scrub()
}

}).call(this,require("buffer").Buffer)
},{"./aes":309,"buffer":303,"cipher-base":324,"inherits":500}],326:[function(require,module,exports){
(function (Buffer){
var CipherBase = require('cipher-base')
var des = require('des.js')
var inherits = require('inherits')

var modes = {
  'des-ede3-cbc': des.CBC.instantiate(des.EDE),
  'des-ede3': des.EDE,
  'des-ede-cbc': des.CBC.instantiate(des.EDE),
  'des-ede': des.EDE,
  'des-cbc': des.CBC.instantiate(des.DES),
  'des-ecb': des.DES
}
modes.des = modes['des-cbc']
modes.des3 = modes['des-ede3-cbc']
module.exports = DES
inherits(DES, CipherBase)
function DES (opts) {
  CipherBase.call(this)
  var modeName = opts.mode.toLowerCase()
  var mode = modes[modeName]
  var type
  if (opts.decrypt) {
    type = 'decrypt'
  } else {
    type = 'encrypt'
  }
  var key = opts.key
  if (modeName === 'des-ede' || modeName === 'des-ede-cbc') {
    key = Buffer.concat([key, key.slice(0, 8)])
  }
  var iv = opts.iv
  this._des = mode.create({
    key: key,
    iv: iv,
    type: type
  })
}
DES.prototype._update = function (data) {
  return new Buffer(this._des.update(data))
}
DES.prototype._final = function () {
  return new Buffer(this._des.final())
}

}).call(this,require("buffer").Buffer)
},{"buffer":303,"cipher-base":328,"des.js":329,"inherits":500}],327:[function(require,module,exports){
exports['des-ecb'] = {
  key: 8,
  iv: 0
}
exports['des-cbc'] = exports.des = {
  key: 8,
  iv: 8
}
exports['des-ede3-cbc'] = exports.des3 = {
  key: 24,
  iv: 8
}
exports['des-ede3'] = {
  key: 24,
  iv: 0
}
exports['des-ede-cbc'] = {
  key: 16,
  iv: 8
}
exports['des-ede'] = {
  key: 16,
  iv: 0
}

},{}],328:[function(require,module,exports){
arguments[4][324][0].apply(exports,arguments)
},{"buffer":303,"dup":324,"inherits":500,"stream":521,"string_decoder":522}],329:[function(require,module,exports){
'use strict';

exports.utils = require('./des/utils');
exports.Cipher = require('./des/cipher');
exports.DES = require('./des/des');
exports.CBC = require('./des/cbc');
exports.EDE = require('./des/ede');

},{"./des/cbc":330,"./des/cipher":331,"./des/des":332,"./des/ede":333,"./des/utils":334}],330:[function(require,module,exports){
'use strict';

var assert = require('minimalistic-assert');
var inherits = require('inherits');

var proto = {};

function CBCState(iv) {
  assert.equal(iv.length, 8, 'Invalid IV length');

  this.iv = new Array(8);
  for (var i = 0; i < this.iv.length; i++)
    this.iv[i] = iv[i];
}

function instantiate(Base) {
  function CBC(options) {
    Base.call(this, options);
    this._cbcInit();
  }
  inherits(CBC, Base);

  var keys = Object.keys(proto);
  for (var i = 0; i < keys.length; i++) {
    var key = keys[i];
    CBC.prototype[key] = proto[key];
  }

  CBC.create = function create(options) {
    return new CBC(options);
  };

  return CBC;
}

exports.instantiate = instantiate;

proto._cbcInit = function _cbcInit() {
  var state = new CBCState(this.options.iv);
  this._cbcState = state;
};

proto._update = function _update(inp, inOff, out, outOff) {
  var state = this._cbcState;
  var superProto = this.constructor.super_.prototype;

  var iv = state.iv;
  if (this.type === 'encrypt') {
    for (var i = 0; i < this.blockSize; i++)
      iv[i] ^= inp[inOff + i];

    superProto._update.call(this, iv, 0, out, outOff);

    for (var i = 0; i < this.blockSize; i++)
      iv[i] = out[outOff + i];
  } else {
    superProto._update.call(this, inp, inOff, out, outOff);

    for (var i = 0; i < this.blockSize; i++)
      out[outOff + i] ^= iv[i];

    for (var i = 0; i < this.blockSize; i++)
      iv[i] = inp[inOff + i];
  }
};

},{"inherits":500,"minimalistic-assert":335}],331:[function(require,module,exports){
'use strict';

var assert = require('minimalistic-assert');

function Cipher(options) {
  this.options = options;

  this.type = this.options.type;
  this.blockSize = 8;
  this._init();

  this.buffer = new Array(this.blockSize);
  this.bufferOff = 0;
}
module.exports = Cipher;

Cipher.prototype._init = function _init() {
  // Might be overrided
};

Cipher.prototype.update = function update(data) {
  if (data.length === 0)
    return [];

  if (this.type === 'decrypt')
    return this._updateDecrypt(data);
  else
    return this._updateEncrypt(data);
};

Cipher.prototype._buffer = function _buffer(data, off) {
  // Append data to buffer
  var min = Math.min(this.buffer.length - this.bufferOff, data.length - off);
  for (var i = 0; i < min; i++)
    this.buffer[this.bufferOff + i] = data[off + i];
  this.bufferOff += min;

  // Shift next
  return min;
};

Cipher.prototype._flushBuffer = function _flushBuffer(out, off) {
  this._update(this.buffer, 0, out, off);
  this.bufferOff = 0;
  return this.blockSize;
};

Cipher.prototype._updateEncrypt = function _updateEncrypt(data) {
  var inputOff = 0;
  var outputOff = 0;

  var count = ((this.bufferOff + data.length) / this.blockSize) | 0;
  var out = new Array(count * this.blockSize);

  if (this.bufferOff !== 0) {
    inputOff += this._buffer(data, inputOff);

    if (this.bufferOff === this.buffer.length)
      outputOff += this._flushBuffer(out, outputOff);
  }

  // Write blocks
  var max = data.length - ((data.length - inputOff) % this.blockSize);
  for (; inputOff < max; inputOff += this.blockSize) {
    this._update(data, inputOff, out, outputOff);
    outputOff += this.blockSize;
  }

  // Queue rest
  for (; inputOff < data.length; inputOff++, this.bufferOff++)
    this.buffer[this.bufferOff] = data[inputOff];

  return out;
};

Cipher.prototype._updateDecrypt = function _updateDecrypt(data) {
  var inputOff = 0;
  var outputOff = 0;

  var count = Math.ceil((this.bufferOff + data.length) / this.blockSize) - 1;
  var out = new Array(count * this.blockSize);

  // TODO(indutny): optimize it, this is far from optimal
  for (; count > 0; count--) {
    inputOff += this._buffer(data, inputOff);
    outputOff += this._flushBuffer(out, outputOff);
  }

  // Buffer rest of the input
  inputOff += this._buffer(data, inputOff);

  return out;
};

Cipher.prototype.final = function final(buffer) {
  var first;
  if (buffer)
    first = this.update(buffer);

  var last;
  if (this.type === 'encrypt')
    last = this._finalEncrypt();
  else
    last = this._finalDecrypt();

  if (first)
    return first.concat(last);
  else
    return last;
};

Cipher.prototype._pad = function _pad(buffer, off) {
  if (off === 0)
    return false;

  while (off < buffer.length)
    buffer[off++] = 0;

  return true;
};

Cipher.prototype._finalEncrypt = function _finalEncrypt() {
  if (!this._pad(this.buffer, this.bufferOff))
    return [];

  var out = new Array(this.blockSize);
  this._update(this.buffer, 0, out, 0);
  return out;
};

Cipher.prototype._unpad = function _unpad(buffer) {
  return buffer;
};

Cipher.prototype._finalDecrypt = function _finalDecrypt() {
  assert.equal(this.bufferOff, this.blockSize, 'Not enough data to decrypt');
  var out = new Array(this.blockSize);
  this._flushBuffer(out, 0);

  return this._unpad(out);
};

},{"minimalistic-assert":335}],332:[function(require,module,exports){
'use strict';

var assert = require('minimalistic-assert');
var inherits = require('inherits');

var des = require('../des');
var utils = des.utils;
var Cipher = des.Cipher;

function DESState() {
  this.tmp = new Array(2);
  this.keys = null;
}

function DES(options) {
  Cipher.call(this, options);

  var state = new DESState();
  this._desState = state;

  this.deriveKeys(state, options.key);
}
inherits(DES, Cipher);
module.exports = DES;

DES.create = function create(options) {
  return new DES(options);
};

var shiftTable = [
  1, 1, 2, 2, 2, 2, 2, 2,
  1, 2, 2, 2, 2, 2, 2, 1
];

DES.prototype.deriveKeys = function deriveKeys(state, key) {
  state.keys = new Array(16 * 2);

  assert.equal(key.length, this.blockSize, 'Invalid key length');

  var kL = utils.readUInt32BE(key, 0);
  var kR = utils.readUInt32BE(key, 4);

  utils.pc1(kL, kR, state.tmp, 0);
  kL = state.tmp[0];
  kR = state.tmp[1];
  for (var i = 0; i < state.keys.length; i += 2) {
    var shift = shiftTable[i >>> 1];
    kL = utils.r28shl(kL, shift);
    kR = utils.r28shl(kR, shift);
    utils.pc2(kL, kR, state.keys, i);
  }
};

DES.prototype._update = function _update(inp, inOff, out, outOff) {
  var state = this._desState;

  var l = utils.readUInt32BE(inp, inOff);
  var r = utils.readUInt32BE(inp, inOff + 4);

  // Initial Permutation
  utils.ip(l, r, state.tmp, 0);
  l = state.tmp[0];
  r = state.tmp[1];

  if (this.type === 'encrypt')
    this._encrypt(state, l, r, state.tmp, 0);
  else
    this._decrypt(state, l, r, state.tmp, 0);

  l = state.tmp[0];
  r = state.tmp[1];

  utils.writeUInt32BE(out, l, outOff);
  utils.writeUInt32BE(out, r, outOff + 4);
};

DES.prototype._pad = function _pad(buffer, off) {
  var value = buffer.length - off;
  for (var i = off; i < buffer.length; i++)
    buffer[i] = value;

  return true;
};

DES.prototype._unpad = function _unpad(buffer) {
  var pad = buffer[buffer.length - 1];
  for (var i = buffer.length - pad; i < buffer.length; i++)
    assert.equal(buffer[i], pad);

  return buffer.slice(0, buffer.length - pad);
};

DES.prototype._encrypt = function _encrypt(state, lStart, rStart, out, off) {
  var l = lStart;
  var r = rStart;

  // Apply f() x16 times
  for (var i = 0; i < state.keys.length; i += 2) {
    var keyL = state.keys[i];
    var keyR = state.keys[i + 1];

    // f(r, k)
    utils.expand(r, state.tmp, 0);

    keyL ^= state.tmp[0];
    keyR ^= state.tmp[1];
    var s = utils.substitute(keyL, keyR);
    var f = utils.permute(s);

    var t = r;
    r = (l ^ f) >>> 0;
    l = t;
  }

  // Reverse Initial Permutation
  utils.rip(r, l, out, off);
};

DES.prototype._decrypt = function _decrypt(state, lStart, rStart, out, off) {
  var l = rStart;
  var r = lStart;

  // Apply f() x16 times
  for (var i = state.keys.length - 2; i >= 0; i -= 2) {
    var keyL = state.keys[i];
    var keyR = state.keys[i + 1];

    // f(r, k)
    utils.expand(l, state.tmp, 0);

    keyL ^= state.tmp[0];
    keyR ^= state.tmp[1];
    var s = utils.substitute(keyL, keyR);
    var f = utils.permute(s);

    var t = l;
    l = (r ^ f) >>> 0;
    r = t;
  }

  // Reverse Initial Permutation
  utils.rip(l, r, out, off);
};

},{"../des":329,"inherits":500,"minimalistic-assert":335}],333:[function(require,module,exports){
'use strict';

var assert = require('minimalistic-assert');
var inherits = require('inherits');

var des = require('../des');
var Cipher = des.Cipher;
var DES = des.DES;

function EDEState(type, key) {
  assert.equal(key.length, 24, 'Invalid key length');

  var k1 = key.slice(0, 8);
  var k2 = key.slice(8, 16);
  var k3 = key.slice(16, 24);

  if (type === 'encrypt') {
    this.ciphers = [
      DES.create({ type: 'encrypt', key: k1 }),
      DES.create({ type: 'decrypt', key: k2 }),
      DES.create({ type: 'encrypt', key: k3 })
    ];
  } else {
    this.ciphers = [
      DES.create({ type: 'decrypt', key: k3 }),
      DES.create({ type: 'encrypt', key: k2 }),
      DES.create({ type: 'decrypt', key: k1 })
    ];
  }
}

function EDE(options) {
  Cipher.call(this, options);

  var state = new EDEState(this.type, this.options.key);
  this._edeState = state;
}
inherits(EDE, Cipher);

module.exports = EDE;

EDE.create = function create(options) {
  return new EDE(options);
};

EDE.prototype._update = function _update(inp, inOff, out, outOff) {
  var state = this._edeState;

  state.ciphers[0]._update(inp, inOff, out, outOff);
  state.ciphers[1]._update(out, outOff, out, outOff);
  state.ciphers[2]._update(out, outOff, out, outOff);
};

EDE.prototype._pad = DES.prototype._pad;
EDE.prototype._unpad = DES.prototype._unpad;

},{"../des":329,"inherits":500,"minimalistic-assert":335}],334:[function(require,module,exports){
'use strict';

exports.readUInt32BE = function readUInt32BE(bytes, off) {
  var res =  (bytes[0 + off] << 24) |
             (bytes[1 + off] << 16) |
             (bytes[2 + off] << 8) |
             bytes[3 + off];
  return res >>> 0;
};

exports.writeUInt32BE = function writeUInt32BE(bytes, value, off) {
  bytes[0 + off] = value >>> 24;
  bytes[1 + off] = (value >>> 16) & 0xff;
  bytes[2 + off] = (value >>> 8) & 0xff;
  bytes[3 + off] = value & 0xff;
};

exports.ip = function ip(inL, inR, out, off) {
  var outL = 0;
  var outR = 0;

  for (var i = 6; i >= 0; i -= 2) {
    for (var j = 0; j <= 24; j += 8) {
      outL <<= 1;
      outL |= (inR >>> (j + i)) & 1;
    }
    for (var j = 0; j <= 24; j += 8) {
      outL <<= 1;
      outL |= (inL >>> (j + i)) & 1;
    }
  }

  for (var i = 6; i >= 0; i -= 2) {
    for (var j = 1; j <= 25; j += 8) {
      outR <<= 1;
      outR |= (inR >>> (j + i)) & 1;
    }
    for (var j = 1; j <= 25; j += 8) {
      outR <<= 1;
      outR |= (inL >>> (j + i)) & 1;
    }
  }

  out[off + 0] = outL >>> 0;
  out[off + 1] = outR >>> 0;
};

exports.rip = function rip(inL, inR, out, off) {
  var outL = 0;
  var outR = 0;

  for (var i = 0; i < 4; i++) {
    for (var j = 24; j >= 0; j -= 8) {
      outL <<= 1;
      outL |= (inR >>> (j + i)) & 1;
      outL <<= 1;
      outL |= (inL >>> (j + i)) & 1;
    }
  }
  for (var i = 4; i < 8; i++) {
    for (var j = 24; j >= 0; j -= 8) {
      outR <<= 1;
      outR |= (inR >>> (j + i)) & 1;
      outR <<= 1;
      outR |= (inL >>> (j + i)) & 1;
    }
  }

  out[off + 0] = outL >>> 0;
  out[off + 1] = outR >>> 0;
};

exports.pc1 = function pc1(inL, inR, out, off) {
  var outL = 0;
  var outR = 0;

  // 7, 15, 23, 31, 39, 47, 55, 63
  // 6, 14, 22, 30, 39, 47, 55, 63
  // 5, 13, 21, 29, 39, 47, 55, 63
  // 4, 12, 20, 28
  for (var i = 7; i >= 5; i--) {
    for (var j = 0; j <= 24; j += 8) {
      outL <<= 1;
      outL |= (inR >> (j + i)) & 1;
    }
    for (var j = 0; j <= 24; j += 8) {
      outL <<= 1;
      outL |= (inL >> (j + i)) & 1;
    }
  }
  for (var j = 0; j <= 24; j += 8) {
    outL <<= 1;
    outL |= (inR >> (j + i)) & 1;
  }

  // 1, 9, 17, 25, 33, 41, 49, 57
  // 2, 10, 18, 26, 34, 42, 50, 58
  // 3, 11, 19, 27, 35, 43, 51, 59
  // 36, 44, 52, 60
  for (var i = 1; i <= 3; i++) {
    for (var j = 0; j <= 24; j += 8) {
      outR <<= 1;
      outR |= (inR >> (j + i)) & 1;
    }
    for (var j = 0; j <= 24; j += 8) {
      outR <<= 1;
      outR |= (inL >> (j + i)) & 1;
    }
  }
  for (var j = 0; j <= 24; j += 8) {
    outR <<= 1;
    outR |= (inL >> (j + i)) & 1;
  }

  out[off + 0] = outL >>> 0;
  out[off + 1] = outR >>> 0;
};

exports.r28shl = function r28shl(num, shift) {
  return ((num << shift) & 0xfffffff) | (num >>> (28 - shift));
};

var pc2table = [
  // inL => outL
  14, 11, 17, 4, 27, 23, 25, 0,
  13, 22, 7, 18, 5, 9, 16, 24,
  2, 20, 12, 21, 1, 8, 15, 26,

  // inR => outR
  15, 4, 25, 19, 9, 1, 26, 16,
  5, 11, 23, 8, 12, 7, 17, 0,
  22, 3, 10, 14, 6, 20, 27, 24
];

exports.pc2 = function pc2(inL, inR, out, off) {
  var outL = 0;
  var outR = 0;

  var len = pc2table.length >>> 1;
  for (var i = 0; i < len; i++) {
    outL <<= 1;
    outL |= (inL >>> pc2table[i]) & 0x1;
  }
  for (var i = len; i < pc2table.length; i++) {
    outR <<= 1;
    outR |= (inR >>> pc2table[i]) & 0x1;
  }

  out[off + 0] = outL >>> 0;
  out[off + 1] = outR >>> 0;
};

exports.expand = function expand(r, out, off) {
  var outL = 0;
  var outR = 0;

  outL = ((r & 1) << 5) | (r >>> 27);
  for (var i = 23; i >= 15; i -= 4) {
    outL <<= 6;
    outL |= (r >>> i) & 0x3f;
  }
  for (var i = 11; i >= 3; i -= 4) {
    outR |= (r >>> i) & 0x3f;
    outR <<= 6;
  }
  outR |= ((r & 0x1f) << 1) | (r >>> 31);

  out[off + 0] = outL >>> 0;
  out[off + 1] = outR >>> 0;
};

var sTable = [
  14, 0, 4, 15, 13, 7, 1, 4, 2, 14, 15, 2, 11, 13, 8, 1,
  3, 10, 10, 6, 6, 12, 12, 11, 5, 9, 9, 5, 0, 3, 7, 8,
  4, 15, 1, 12, 14, 8, 8, 2, 13, 4, 6, 9, 2, 1, 11, 7,
  15, 5, 12, 11, 9, 3, 7, 14, 3, 10, 10, 0, 5, 6, 0, 13,

  15, 3, 1, 13, 8, 4, 14, 7, 6, 15, 11, 2, 3, 8, 4, 14,
  9, 12, 7, 0, 2, 1, 13, 10, 12, 6, 0, 9, 5, 11, 10, 5,
  0, 13, 14, 8, 7, 10, 11, 1, 10, 3, 4, 15, 13, 4, 1, 2,
  5, 11, 8, 6, 12, 7, 6, 12, 9, 0, 3, 5, 2, 14, 15, 9,

  10, 13, 0, 7, 9, 0, 14, 9, 6, 3, 3, 4, 15, 6, 5, 10,
  1, 2, 13, 8, 12, 5, 7, 14, 11, 12, 4, 11, 2, 15, 8, 1,
  13, 1, 6, 10, 4, 13, 9, 0, 8, 6, 15, 9, 3, 8, 0, 7,
  11, 4, 1, 15, 2, 14, 12, 3, 5, 11, 10, 5, 14, 2, 7, 12,

  7, 13, 13, 8, 14, 11, 3, 5, 0, 6, 6, 15, 9, 0, 10, 3,
  1, 4, 2, 7, 8, 2, 5, 12, 11, 1, 12, 10, 4, 14, 15, 9,
  10, 3, 6, 15, 9, 0, 0, 6, 12, 10, 11, 1, 7, 13, 13, 8,
  15, 9, 1, 4, 3, 5, 14, 11, 5, 12, 2, 7, 8, 2, 4, 14,

  2, 14, 12, 11, 4, 2, 1, 12, 7, 4, 10, 7, 11, 13, 6, 1,
  8, 5, 5, 0, 3, 15, 15, 10, 13, 3, 0, 9, 14, 8, 9, 6,
  4, 11, 2, 8, 1, 12, 11, 7, 10, 1, 13, 14, 7, 2, 8, 13,
  15, 6, 9, 15, 12, 0, 5, 9, 6, 10, 3, 4, 0, 5, 14, 3,

  12, 10, 1, 15, 10, 4, 15, 2, 9, 7, 2, 12, 6, 9, 8, 5,
  0, 6, 13, 1, 3, 13, 4, 14, 14, 0, 7, 11, 5, 3, 11, 8,
  9, 4, 14, 3, 15, 2, 5, 12, 2, 9, 8, 5, 12, 15, 3, 10,
  7, 11, 0, 14, 4, 1, 10, 7, 1, 6, 13, 0, 11, 8, 6, 13,

  4, 13, 11, 0, 2, 11, 14, 7, 15, 4, 0, 9, 8, 1, 13, 10,
  3, 14, 12, 3, 9, 5, 7, 12, 5, 2, 10, 15, 6, 8, 1, 6,
  1, 6, 4, 11, 11, 13, 13, 8, 12, 1, 3, 4, 7, 10, 14, 7,
  10, 9, 15, 5, 6, 0, 8, 15, 0, 14, 5, 2, 9, 3, 2, 12,

  13, 1, 2, 15, 8, 13, 4, 8, 6, 10, 15, 3, 11, 7, 1, 4,
  10, 12, 9, 5, 3, 6, 14, 11, 5, 0, 0, 14, 12, 9, 7, 2,
  7, 2, 11, 1, 4, 14, 1, 7, 9, 4, 12, 10, 14, 8, 2, 13,
  0, 15, 6, 12, 10, 9, 13, 0, 15, 3, 3, 5, 5, 6, 8, 11
];

exports.substitute = function substitute(inL, inR) {
  var out = 0;
  for (var i = 0; i < 4; i++) {
    var b = (inL >>> (18 - i * 6)) & 0x3f;
    var sb = sTable[i * 0x40 + b];

    out <<= 4;
    out |= sb;
  }
  for (var i = 0; i < 4; i++) {
    var b = (inR >>> (18 - i * 6)) & 0x3f;
    var sb = sTable[4 * 0x40 + i * 0x40 + b];

    out <<= 4;
    out |= sb;
  }
  return out >>> 0;
};

var permuteTable = [
  16, 25, 12, 11, 3, 20, 4, 15, 31, 17, 9, 6, 27, 14, 1, 22,
  30, 24, 8, 18, 0, 5, 29, 23, 13, 19, 2, 26, 10, 21, 28, 7
];

exports.permute = function permute(num) {
  var out = 0;
  for (var i = 0; i < permuteTable.length; i++) {
    out <<= 1;
    out |= (num >>> permuteTable[i]) & 0x1;
  }
  return out >>> 0;
};

exports.padSplit = function padSplit(num, size, group) {
  var str = num.toString(2);
  while (str.length < size)
    str = '0' + str;

  var out = [];
  for (var i = 0; i < size; i += group)
    out.push(str.slice(i, i + group));
  return out.join(' ');
};

},{}],335:[function(require,module,exports){
module.exports = assert;

function assert(val, msg) {
  if (!val)
    throw new Error(msg || 'Assertion failed');
}

assert.equal = function assertEqual(l, r, msg) {
  if (l != r)
    throw new Error(msg || ('Assertion failed: ' + l + ' != ' + r));
};

},{}],336:[function(require,module,exports){
(function (Buffer){
var md5 = require('create-hash/md5')
module.exports = EVP_BytesToKey
function EVP_BytesToKey (password, salt, keyLen, ivLen) {
  if (!Buffer.isBuffer(password)) {
    password = new Buffer(password, 'binary')
  }
  if (salt && !Buffer.isBuffer(salt)) {
    salt = new Buffer(salt, 'binary')
  }
  keyLen = keyLen / 8
  ivLen = ivLen || 0
  var ki = 0
  var ii = 0
  var key = new Buffer(keyLen)
  var iv = new Buffer(ivLen)
  var addmd = 0
  var md_buf
  var i
  var bufs = []
  while (true) {
    if (addmd++ > 0) {
      bufs.push(md_buf)
    }
    bufs.push(password)
    if (salt) {
      bufs.push(salt)
    }
    md_buf = md5(Buffer.concat(bufs))
    bufs = []
    i = 0
    if (keyLen > 0) {
      while (true) {
        if (keyLen === 0) {
          break
        }
        if (i === md_buf.length) {
          break
        }
        key[ki++] = md_buf[i]
        keyLen--
        i++
      }
    }
    if (ivLen > 0 && i !== md_buf.length) {
      while (true) {
        if (ivLen === 0) {
          break
        }
        if (i === md_buf.length) {
          break
        }
        iv[ii++] = md_buf[i]
        ivLen--
        i++
      }
    }
    if (keyLen === 0 && ivLen === 0) {
      break
    }
  }
  for (i = 0; i < md_buf.length; i++) {
    md_buf[i] = 0
  }
  return {
    key: key,
    iv: iv
  }
}

}).call(this,require("buffer").Buffer)
},{"buffer":303,"create-hash/md5":433}],337:[function(require,module,exports){
(function (Buffer){
'use strict'
exports['RSA-SHA224'] = exports.sha224WithRSAEncryption = {
  sign: 'rsa',
  hash: 'sha224',
  id: new Buffer('302d300d06096086480165030402040500041c', 'hex')
}
exports['RSA-SHA256'] = exports.sha256WithRSAEncryption = {
  sign: 'rsa',
  hash: 'sha256',
  id: new Buffer('3031300d060960864801650304020105000420', 'hex')
}
exports['RSA-SHA384'] = exports.sha384WithRSAEncryption = {
  sign: 'rsa',
  hash: 'sha384',
  id: new Buffer('3041300d060960864801650304020205000430', 'hex')
}
exports['RSA-SHA512'] = exports.sha512WithRSAEncryption = {
  sign: 'rsa',
  hash: 'sha512',
  id: new Buffer('3051300d060960864801650304020305000440', 'hex')
}
exports['RSA-SHA1'] = {
  sign: 'rsa',
  hash: 'sha1',
  id: new Buffer('3021300906052b0e03021a05000414', 'hex')
}
exports['ecdsa-with-SHA1'] = {
  sign: 'ecdsa',
  hash: 'sha1',
  id: new Buffer('', 'hex')
}

exports.DSA = exports['DSA-SHA1'] = exports['DSA-SHA'] = {
  sign: 'dsa',
  hash: 'sha1',
  id: new Buffer('', 'hex')
}
exports['DSA-SHA224'] = exports['DSA-WITH-SHA224'] = {
  sign: 'dsa',
  hash: 'sha224',
  id: new Buffer('', 'hex')
}
exports['DSA-SHA256'] = exports['DSA-WITH-SHA256'] = {
  sign: 'dsa',
  hash: 'sha256',
  id: new Buffer('', 'hex')
}
exports['DSA-SHA384'] = exports['DSA-WITH-SHA384'] = {
  sign: 'dsa',
  hash: 'sha384',
  id: new Buffer('', 'hex')
}
exports['DSA-SHA512'] = exports['DSA-WITH-SHA512'] = {
  sign: 'dsa',
  hash: 'sha512',
  id: new Buffer('', 'hex')
}
exports['DSA-RIPEMD160'] = {
  sign: 'dsa',
  hash: 'rmd160',
  id: new Buffer('', 'hex')
}
exports['RSA-RIPEMD160'] = exports.ripemd160WithRSA = {
  sign: 'rsa',
  hash: 'rmd160',
  id: new Buffer('3021300906052b2403020105000414', 'hex')
}
exports['RSA-MD5'] = exports.md5WithRSAEncryption = {
  sign: 'rsa',
  hash: 'md5',
  id: new Buffer('3020300c06082a864886f70d020505000410', 'hex')
}

}).call(this,require("buffer").Buffer)
},{"buffer":303}],338:[function(require,module,exports){
(function (Buffer){
var _algos = require('./algos')
var createHash = require('create-hash')
var inherits = require('inherits')
var sign = require('./sign')
var stream = require('stream')
var verify = require('./verify')

var algos = {}
Object.keys(_algos).forEach(function (key) {
  algos[key] = algos[key.toLowerCase()] = _algos[key]
})

function Sign (algorithm) {
  stream.Writable.call(this)

  var data = algos[algorithm]
  if (!data) {
    throw new Error('Unknown message digest')
  }

  this._hashType = data.hash
  this._hash = createHash(data.hash)
  this._tag = data.id
  this._signType = data.sign
}
inherits(Sign, stream.Writable)

Sign.prototype._write = function _write (data, _, done) {
  this._hash.update(data)
  done()
}

Sign.prototype.update = function update (data, enc) {
  if (typeof data === 'string') {
    data = new Buffer(data, enc)
  }

  this._hash.update(data)
  return this
}

Sign.prototype.sign = function signMethod (key, enc) {
  this.end()
  var hash = this._hash.digest()
  var sig = sign(Buffer.concat([this._tag, hash]), key, this._hashType, this._signType)

  return enc ? sig.toString(enc) : sig
}

function Verify (algorithm) {
  stream.Writable.call(this)

  var data = algos[algorithm]
  if (!data) {
    throw new Error('Unknown message digest')
  }

  this._hash = createHash(data.hash)
  this._tag = data.id
  this._signType = data.sign
}
inherits(Verify, stream.Writable)

Verify.prototype._write = function _write (data, _, done) {
  this._hash.update(data)

  done()
}

Verify.prototype.update = function update (data, enc) {
  if (typeof data === 'string') {
    data = new Buffer(data, enc)
  }

  this._hash.update(data)
  return this
}

Verify.prototype.verify = function verifyMethod (key, sig, enc) {
  if (typeof sig === 'string') {
    sig = new Buffer(sig, enc)
  }

  this.end()
  var hash = this._hash.digest()

  return verify(sig, Buffer.concat([this._tag, hash]), key, this._signType)
}

function createSign (algorithm) {
  return new Sign(algorithm)
}

function createVerify (algorithm) {
  return new Verify(algorithm)
}

module.exports = {
  Sign: createSign,
  Verify: createVerify,
  createSign: createSign,
  createVerify: createVerify
}

}).call(this,require("buffer").Buffer)
},{"./algos":337,"./sign":403,"./verify":404,"buffer":303,"create-hash":431,"inherits":500,"stream":521}],339:[function(require,module,exports){
'use strict'
exports['1.3.132.0.10'] = 'secp256k1'

exports['1.3.132.0.33'] = 'p224'

exports['1.2.840.10045.3.1.1'] = 'p192'

exports['1.2.840.10045.3.1.7'] = 'p256'

exports['1.3.132.0.34'] = 'p384'

exports['1.3.132.0.35'] = 'p521'

},{}],340:[function(require,module,exports){
(function (module, exports) {
  'use strict';

  // Utils
  function assert (val, msg) {
    if (!val) throw new Error(msg || 'Assertion failed');
  }

  // Could use `inherits` module, but don't want to move from single file
  // architecture yet.
  function inherits (ctor, superCtor) {
    ctor.super_ = superCtor;
    var TempCtor = function () {};
    TempCtor.prototype = superCtor.prototype;
    ctor.prototype = new TempCtor();
    ctor.prototype.constructor = ctor;
  }

  // BN

  function BN (number, base, endian) {
    // May be `new BN(bn)` ?
    if (number !== null &&
      typeof number === 'object' &&
      Array.isArray(number.words)) {
      return number;
    }

    this.negative = 0;
    this.words = null;
    this.length = 0;

    // Reduction context
    this.red = null;

    if (number !== null) {
      if (base === 'le' || base === 'be') {
        endian = base;
        base = 10;
      }

      this._init(number || 0, base || 10, endian || 'be');
    }
  }
  if (typeof module === 'object') {
    module.exports = BN;
  } else {
    exports.BN = BN;
  }

  BN.BN = BN;
  BN.wordSize = 26;

  var Buffer;
  try {
    Buffer = require('buf' + 'fer').Buffer;
  } catch (e) {
  }

  BN.max = function max (left, right) {
    if (left.cmp(right) > 0) return left;
    return right;
  };

  BN.min = function min (left, right) {
    if (left.cmp(right) < 0) return left;
    return right;
  };

  BN.prototype._init = function init (number, base, endian) {
    if (typeof number === 'number') {
      return this._initNumber(number, base, endian);
    }

    if (typeof number === 'object') {
      return this._initArray(number, base, endian);
    }

    if (base === 'hex') {
      base = 16;
    }
    assert(base === (base | 0) && base >= 2 && base <= 36);

    number = number.toString().replace(/\s+/g, '');
    var start = 0;
    if (number[0] === '-') {
      start++;
    }

    if (base === 16) {
      this._parseHex(number, start);
    } else {
      this._parseBase(number, base, start);
    }

    if (number[0] === '-') {
      this.negative = 1;
    }

    this.strip();

    if (endian !== 'le') return;

    this._initArray(this.toArray(), base, endian);
  };

  BN.prototype._initNumber = function _initNumber (number, base, endian) {
    if (number < 0) {
      this.negative = 1;
      number = -number;
    }
    if (number < 0x4000000) {
      this.words = [ number & 0x3ffffff ];
      this.length = 1;
    } else if (number < 0x10000000000000) {
      this.words = [
        number & 0x3ffffff,
        (number / 0x4000000) & 0x3ffffff
      ];
      this.length = 2;
    } else {
      assert(number < 0x20000000000000); // 2 ^ 53 (unsafe)
      this.words = [
        number & 0x3ffffff,
        (number / 0x4000000) & 0x3ffffff,
        1
      ];
      this.length = 3;
    }

    if (endian !== 'le') return;

    // Reverse the bytes
    this._initArray(this.toArray(), base, endian);
  };

  BN.prototype._initArray = function _initArray (number, base, endian) {
    // Perhaps a Uint8Array
    assert(typeof number.length === 'number');
    if (number.length <= 0) {
      this.words = [ 0 ];
      this.length = 1;
      return this;
    }

    this.length = Math.ceil(number.length / 3);
    this.words = new Array(this.length);
    for (var i = 0; i < this.length; i++) {
      this.words[i] = 0;
    }

    var j, w;
    var off = 0;
    if (endian === 'be') {
      for (i = number.length - 1, j = 0; i >= 0; i -= 3) {
        w = number[i] | (number[i - 1] << 8) | (number[i - 2] << 16);
        this.words[j] |= (w << off) & 0x3ffffff;
        this.words[j + 1] = (w >>> (26 - off)) & 0x3ffffff;
        off += 24;
        if (off >= 26) {
          off -= 26;
          j++;
        }
      }
    } else if (endian === 'le') {
      for (i = 0, j = 0; i < number.length; i += 3) {
        w = number[i] | (number[i + 1] << 8) | (number[i + 2] << 16);
        this.words[j] |= (w << off) & 0x3ffffff;
        this.words[j + 1] = (w >>> (26 - off)) & 0x3ffffff;
        off += 24;
        if (off >= 26) {
          off -= 26;
          j++;
        }
      }
    }
    return this.strip();
  };

  function parseHex (str, start, end) {
    var r = 0;
    var len = Math.min(str.length, end);
    for (var i = start; i < len; i++) {
      var c = str.charCodeAt(i) - 48;

      r <<= 4;

      // 'a' - 'f'
      if (c >= 49 && c <= 54) {
        r |= c - 49 + 0xa;

      // 'A' - 'F'
      } else if (c >= 17 && c <= 22) {
        r |= c - 17 + 0xa;

      // '0' - '9'
      } else {
        r |= c & 0xf;
      }
    }
    return r;
  }

  BN.prototype._parseHex = function _parseHex (number, start) {
    // Create possibly bigger array to ensure that it fits the number
    this.length = Math.ceil((number.length - start) / 6);
    this.words = new Array(this.length);
    for (var i = 0; i < this.length; i++) {
      this.words[i] = 0;
    }

    var j, w;
    // Scan 24-bit chunks and add them to the number
    var off = 0;
    for (i = number.length - 6, j = 0; i >= start; i -= 6) {
      w = parseHex(number, i, i + 6);
      this.words[j] |= (w << off) & 0x3ffffff;
      this.words[j + 1] |= w >>> (26 - off) & 0x3fffff;
      off += 24;
      if (off >= 26) {
        off -= 26;
        j++;
      }
    }
    if (i + 6 !== start) {
      w = parseHex(number, start, i + 6);
      this.words[j] |= (w << off) & 0x3ffffff;
      this.words[j + 1] |= w >>> (26 - off) & 0x3fffff;
    }
    this.strip();
  };

  function parseBase (str, start, end, mul) {
    var r = 0;
    var len = Math.min(str.length, end);
    for (var i = start; i < len; i++) {
      var c = str.charCodeAt(i) - 48;

      r *= mul;

      // 'a'
      if (c >= 49) {
        r += c - 49 + 0xa;

      // 'A'
      } else if (c >= 17) {
        r += c - 17 + 0xa;

      // '0' - '9'
      } else {
        r += c;
      }
    }
    return r;
  }

  BN.prototype._parseBase = function _parseBase (number, base, start) {
    // Initialize as zero
    this.words = [ 0 ];
    this.length = 1;

    // Find length of limb in base
    for (var limbLen = 0, limbPow = 1; limbPow <= 0x3ffffff; limbPow *= base) {
      limbLen++;
    }
    limbLen--;
    limbPow = (limbPow / base) | 0;

    var total = number.length - start;
    var mod = total % limbLen;
    var end = Math.min(total, total - mod) + start;

    var word = 0;
    for (var i = start; i < end; i += limbLen) {
      word = parseBase(number, i, i + limbLen, base);

      this.imuln(limbPow);
      if (this.words[0] + word < 0x4000000) {
        this.words[0] += word;
      } else {
        this._iaddn(word);
      }
    }

    if (mod !== 0) {
      var pow = 1;
      word = parseBase(number, i, number.length, base);

      for (i = 0; i < mod; i++) {
        pow *= base;
      }

      this.imuln(pow);
      if (this.words[0] + word < 0x4000000) {
        this.words[0] += word;
      } else {
        this._iaddn(word);
      }
    }
  };

  BN.prototype.copy = function copy (dest) {
    dest.words = new Array(this.length);
    for (var i = 0; i < this.length; i++) {
      dest.words[i] = this.words[i];
    }
    dest.length = this.length;
    dest.negative = this.negative;
    dest.red = this.red;
  };

  BN.prototype.clone = function clone () {
    var r = new BN(null);
    this.copy(r);
    return r;
  };

  // Remove leading `0` from `this`
  BN.prototype.strip = function strip () {
    while (this.length > 1 && this.words[this.length - 1] === 0) {
      this.length--;
    }
    return this._normSign();
  };

  BN.prototype._normSign = function _normSign () {
    // -0 = 0
    if (this.length === 1 && this.words[0] === 0) {
      this.negative = 0;
    }
    return this;
  };

  BN.prototype.inspect = function inspect () {
    return (this.red ? '<BN-R: ' : '<BN: ') + this.toString(16) + '>';
  };

  /*

  var zeros = [];
  var groupSizes = [];
  var groupBases = [];

  var s = '';
  var i = -1;
  while (++i < BN.wordSize) {
    zeros[i] = s;
    s += '0';
  }
  groupSizes[0] = 0;
  groupSizes[1] = 0;
  groupBases[0] = 0;
  groupBases[1] = 0;
  var base = 2 - 1;
  while (++base < 36 + 1) {
    var groupSize = 0;
    var groupBase = 1;
    while (groupBase < (1 << BN.wordSize) / base) {
      groupBase *= base;
      groupSize += 1;
    }
    groupSizes[base] = groupSize;
    groupBases[base] = groupBase;
  }

  */

  var zeros = [
    '',
    '0',
    '00',
    '000',
    '0000',
    '00000',
    '000000',
    '0000000',
    '00000000',
    '000000000',
    '0000000000',
    '00000000000',
    '000000000000',
    '0000000000000',
    '00000000000000',
    '000000000000000',
    '0000000000000000',
    '00000000000000000',
    '000000000000000000',
    '0000000000000000000',
    '00000000000000000000',
    '000000000000000000000',
    '0000000000000000000000',
    '00000000000000000000000',
    '000000000000000000000000',
    '0000000000000000000000000'
  ];

  var groupSizes = [
    0, 0,
    25, 16, 12, 11, 10, 9, 8,
    8, 7, 7, 7, 7, 6, 6,
    6, 6, 6, 6, 6, 5, 5,
    5, 5, 5, 5, 5, 5, 5,
    5, 5, 5, 5, 5, 5, 5
  ];

  var groupBases = [
    0, 0,
    33554432, 43046721, 16777216, 48828125, 60466176, 40353607, 16777216,
    43046721, 10000000, 19487171, 35831808, 62748517, 7529536, 11390625,
    16777216, 24137569, 34012224, 47045881, 64000000, 4084101, 5153632,
    6436343, 7962624, 9765625, 11881376, 14348907, 17210368, 20511149,
    24300000, 28629151, 33554432, 39135393, 45435424, 52521875, 60466176
  ];

  BN.prototype.toString = function toString (base, padding) {
    base = base || 10;
    padding = padding | 0 || 1;

    var out;
    if (base === 16 || base === 'hex') {
      out = '';
      var off = 0;
      var carry = 0;
      for (var i = 0; i < this.length; i++) {
        var w = this.words[i];
        var word = (((w << off) | carry) & 0xffffff).toString(16);
        carry = (w >>> (24 - off)) & 0xffffff;
        if (carry !== 0 || i !== this.length - 1) {
          out = zeros[6 - word.length] + word + out;
        } else {
          out = word + out;
        }
        off += 2;
        if (off >= 26) {
          off -= 26;
          i--;
        }
      }
      if (carry !== 0) {
        out = carry.toString(16) + out;
      }
      while (out.length % padding !== 0) {
        out = '0' + out;
      }
      if (this.negative !== 0) {
        out = '-' + out;
      }
      return out;
    }

    if (base === (base | 0) && base >= 2 && base <= 36) {
      // var groupSize = Math.floor(BN.wordSize * Math.LN2 / Math.log(base));
      var groupSize = groupSizes[base];
      // var groupBase = Math.pow(base, groupSize);
      var groupBase = groupBases[base];
      out = '';
      var c = this.clone();
      c.negative = 0;
      while (!c.isZero()) {
        var r = c.modn(groupBase).toString(base);
        c = c.idivn(groupBase);

        if (!c.isZero()) {
          out = zeros[groupSize - r.length] + r + out;
        } else {
          out = r + out;
        }
      }
      if (this.isZero()) {
        out = '0' + out;
      }
      while (out.length % padding !== 0) {
        out = '0' + out;
      }
      if (this.negative !== 0) {
        out = '-' + out;
      }
      return out;
    }

    assert(false, 'Base should be between 2 and 36');
  };

  BN.prototype.toNumber = function toNumber () {
    var length = this.bitLength();
    var ret;
    if (length <= 26) {
      ret = this.words[0];
    } else if (length <= 52) {
      ret = (this.words[1] * 0x4000000) + this.words[0];
    } else if (length === 53) {
      // NOTE: at this stage it is known that the top bit is set
      ret = 0x10000000000000 + (this.words[1] * 0x4000000) + this.words[0];
    } else {
      assert(false, 'Number can only safely store up to 53 bits');
    }
    return (this.negative !== 0) ? -ret : ret;
  };

  BN.prototype.toJSON = function toJSON () {
    return this.toString(16);
  };

  BN.prototype.toBuffer = function toBuffer (endian, length) {
    assert(typeof Buffer !== 'undefined');
    return this.toArrayLike(Buffer, endian, length);
  };

  BN.prototype.toArray = function toArray (endian, length) {
    return this.toArrayLike(Array, endian, length);
  };

  BN.prototype.toArrayLike = function toArrayLike (ArrayType, endian, length) {
    var byteLength = this.byteLength();
    var reqLength = length || Math.max(1, byteLength);
    assert(byteLength <= reqLength, 'byte array longer than desired length');
    assert(reqLength > 0, 'Requested array length <= 0');

    this.strip();
    var littleEndian = endian === 'le';
    var res = new ArrayType(reqLength);

    var b, i;
    var q = this.clone();
    if (!littleEndian) {
      // Assume big-endian
      for (i = 0; i < reqLength - byteLength; i++) {
        res[i] = 0;
      }

      for (i = 0; !q.isZero(); i++) {
        b = q.andln(0xff);
        q.iushrn(8);

        res[reqLength - i - 1] = b;
      }
    } else {
      for (i = 0; !q.isZero(); i++) {
        b = q.andln(0xff);
        q.iushrn(8);

        res[i] = b;
      }

      for (; i < reqLength; i++) {
        res[i] = 0;
      }
    }

    return res;
  };

  if (Math.clz32) {
    BN.prototype._countBits = function _countBits (w) {
      return 32 - Math.clz32(w);
    };
  } else {
    BN.prototype._countBits = function _countBits (w) {
      var t = w;
      var r = 0;
      if (t >= 0x1000) {
        r += 13;
        t >>>= 13;
      }
      if (t >= 0x40) {
        r += 7;
        t >>>= 7;
      }
      if (t >= 0x8) {
        r += 4;
        t >>>= 4;
      }
      if (t >= 0x02) {
        r += 2;
        t >>>= 2;
      }
      return r + t;
    };
  }

  BN.prototype._zeroBits = function _zeroBits (w) {
    // Short-cut
    if (w === 0) return 26;

    var t = w;
    var r = 0;
    if ((t & 0x1fff) === 0) {
      r += 13;
      t >>>= 13;
    }
    if ((t & 0x7f) === 0) {
      r += 7;
      t >>>= 7;
    }
    if ((t & 0xf) === 0) {
      r += 4;
      t >>>= 4;
    }
    if ((t & 0x3) === 0) {
      r += 2;
      t >>>= 2;
    }
    if ((t & 0x1) === 0) {
      r++;
    }
    return r;
  };

  // Return number of used bits in a BN
  BN.prototype.bitLength = function bitLength () {
    var w = this.words[this.length - 1];
    var hi = this._countBits(w);
    return (this.length - 1) * 26 + hi;
  };

  function toBitArray (num) {
    var w = new Array(num.bitLength());

    for (var bit = 0; bit < w.length; bit++) {
      var off = (bit / 26) | 0;
      var wbit = bit % 26;

      w[bit] = (num.words[off] & (1 << wbit)) >>> wbit;
    }

    return w;
  }

  // Number of trailing zero bits
  BN.prototype.zeroBits = function zeroBits () {
    if (this.isZero()) return 0;

    var r = 0;
    for (var i = 0; i < this.length; i++) {
      var b = this._zeroBits(this.words[i]);
      r += b;
      if (b !== 26) break;
    }
    return r;
  };

  BN.prototype.byteLength = function byteLength () {
    return Math.ceil(this.bitLength() / 8);
  };

  BN.prototype.toTwos = function toTwos (width) {
    if (this.negative !== 0) {
      return this.abs().inotn(width).iaddn(1);
    }
    return this.clone();
  };

  BN.prototype.fromTwos = function fromTwos (width) {
    if (this.testn(width - 1)) {
      return this.notn(width).iaddn(1).ineg();
    }
    return this.clone();
  };

  BN.prototype.isNeg = function isNeg () {
    return this.negative !== 0;
  };

  // Return negative clone of `this`
  BN.prototype.neg = function neg () {
    return this.clone().ineg();
  };

  BN.prototype.ineg = function ineg () {
    if (!this.isZero()) {
      this.negative ^= 1;
    }

    return this;
  };

  // Or `num` with `this` in-place
  BN.prototype.iuor = function iuor (num) {
    while (this.length < num.length) {
      this.words[this.length++] = 0;
    }

    for (var i = 0; i < num.length; i++) {
      this.words[i] = this.words[i] | num.words[i];
    }

    return this.strip();
  };

  BN.prototype.ior = function ior (num) {
    assert((this.negative | num.negative) === 0);
    return this.iuor(num);
  };

  // Or `num` with `this`
  BN.prototype.or = function or (num) {
    if (this.length > num.length) return this.clone().ior(num);
    return num.clone().ior(this);
  };

  BN.prototype.uor = function uor (num) {
    if (this.length > num.length) return this.clone().iuor(num);
    return num.clone().iuor(this);
  };

  // And `num` with `this` in-place
  BN.prototype.iuand = function iuand (num) {
    // b = min-length(num, this)
    var b;
    if (this.length > num.length) {
      b = num;
    } else {
      b = this;
    }

    for (var i = 0; i < b.length; i++) {
      this.words[i] = this.words[i] & num.words[i];
    }

    this.length = b.length;

    return this.strip();
  };

  BN.prototype.iand = function iand (num) {
    assert((this.negative | num.negative) === 0);
    return this.iuand(num);
  };

  // And `num` with `this`
  BN.prototype.and = function and (num) {
    if (this.length > num.length) return this.clone().iand(num);
    return num.clone().iand(this);
  };

  BN.prototype.uand = function uand (num) {
    if (this.length > num.length) return this.clone().iuand(num);
    return num.clone().iuand(this);
  };

  // Xor `num` with `this` in-place
  BN.prototype.iuxor = function iuxor (num) {
    // a.length > b.length
    var a;
    var b;
    if (this.length > num.length) {
      a = this;
      b = num;
    } else {
      a = num;
      b = this;
    }

    for (var i = 0; i < b.length; i++) {
      this.words[i] = a.words[i] ^ b.words[i];
    }

    if (this !== a) {
      for (; i < a.length; i++) {
        this.words[i] = a.words[i];
      }
    }

    this.length = a.length;

    return this.strip();
  };

  BN.prototype.ixor = function ixor (num) {
    assert((this.negative | num.negative) === 0);
    return this.iuxor(num);
  };

  // Xor `num` with `this`
  BN.prototype.xor = function xor (num) {
    if (this.length > num.length) return this.clone().ixor(num);
    return num.clone().ixor(this);
  };

  BN.prototype.uxor = function uxor (num) {
    if (this.length > num.length) return this.clone().iuxor(num);
    return num.clone().iuxor(this);
  };

  // Not ``this`` with ``width`` bitwidth
  BN.prototype.inotn = function inotn (width) {
    assert(typeof width === 'number' && width >= 0);

    var bytesNeeded = Math.ceil(width / 26) | 0;
    var bitsLeft = width % 26;

    // Extend the buffer with leading zeroes
    while (this.length < bytesNeeded) {
      this.words[this.length++] = 0;
    }

    if (bitsLeft > 0) {
      bytesNeeded--;
    }

    // Handle complete words
    for (var i = 0; i < bytesNeeded; i++) {
      this.words[i] = ~this.words[i] & 0x3ffffff;
    }

    // Handle the residue
    if (bitsLeft > 0) {
      this.words[i] = ~this.words[i] & (0x3ffffff >> (26 - bitsLeft));
    }

    // And remove leading zeroes
    return this.strip();
  };

  BN.prototype.notn = function notn (width) {
    return this.clone().inotn(width);
  };

  // Set `bit` of `this`
  BN.prototype.setn = function setn (bit, val) {
    assert(typeof bit === 'number' && bit >= 0);

    var off = (bit / 26) | 0;
    var wbit = bit % 26;

    while (this.length <= off) {
      this.words[this.length++] = 0;
    }

    if (val) {
      this.words[off] = this.words[off] | (1 << wbit);
    } else {
      this.words[off] = this.words[off] & ~(1 << wbit);
    }

    return this.strip();
  };

  // Add `num` to `this` in-place
  BN.prototype.iadd = function iadd (num) {
    var r;

    // negative + positive
    if (this.negative !== 0 && num.negative === 0) {
      this.negative = 0;
      r = this.isub(num);
      this.negative ^= 1;
      return this._normSign();

    // positive + negative
    } else if (this.negative === 0 && num.negative !== 0) {
      num.negative = 0;
      r = this.isub(num);
      num.negative = 1;
      return r._normSign();
    }

    // a.length > b.length
    var a, b;
    if (this.length > num.length) {
      a = this;
      b = num;
    } else {
      a = num;
      b = this;
    }

    var carry = 0;
    for (var i = 0; i < b.length; i++) {
      r = (a.words[i] | 0) + (b.words[i] | 0) + carry;
      this.words[i] = r & 0x3ffffff;
      carry = r >>> 26;
    }
    for (; carry !== 0 && i < a.length; i++) {
      r = (a.words[i] | 0) + carry;
      this.words[i] = r & 0x3ffffff;
      carry = r >>> 26;
    }

    this.length = a.length;
    if (carry !== 0) {
      this.words[this.length] = carry;
      this.length++;
    // Copy the rest of the words
    } else if (a !== this) {
      for (; i < a.length; i++) {
        this.words[i] = a.words[i];
      }
    }

    return this;
  };

  // Add `num` to `this`
  BN.prototype.add = function add (num) {
    var res;
    if (num.negative !== 0 && this.negative === 0) {
      num.negative = 0;
      res = this.sub(num);
      num.negative ^= 1;
      return res;
    } else if (num.negative === 0 && this.negative !== 0) {
      this.negative = 0;
      res = num.sub(this);
      this.negative = 1;
      return res;
    }

    if (this.length > num.length) return this.clone().iadd(num);

    return num.clone().iadd(this);
  };

  // Subtract `num` from `this` in-place
  BN.prototype.isub = function isub (num) {
    // this - (-num) = this + num
    if (num.negative !== 0) {
      num.negative = 0;
      var r = this.iadd(num);
      num.negative = 1;
      return r._normSign();

    // -this - num = -(this + num)
    } else if (this.negative !== 0) {
      this.negative = 0;
      this.iadd(num);
      this.negative = 1;
      return this._normSign();
    }

    // At this point both numbers are positive
    var cmp = this.cmp(num);

    // Optimization - zeroify
    if (cmp === 0) {
      this.negative = 0;
      this.length = 1;
      this.words[0] = 0;
      return this;
    }

    // a > b
    var a, b;
    if (cmp > 0) {
      a = this;
      b = num;
    } else {
      a = num;
      b = this;
    }

    var carry = 0;
    for (var i = 0; i < b.length; i++) {
      r = (a.words[i] | 0) - (b.words[i] | 0) + carry;
      carry = r >> 26;
      this.words[i] = r & 0x3ffffff;
    }
    for (; carry !== 0 && i < a.length; i++) {
      r = (a.words[i] | 0) + carry;
      carry = r >> 26;
      this.words[i] = r & 0x3ffffff;
    }

    // Copy rest of the words
    if (carry === 0 && i < a.length && a !== this) {
      for (; i < a.length; i++) {
        this.words[i] = a.words[i];
      }
    }

    this.length = Math.max(this.length, i);

    if (a !== this) {
      this.negative = 1;
    }

    return this.strip();
  };

  // Subtract `num` from `this`
  BN.prototype.sub = function sub (num) {
    return this.clone().isub(num);
  };

  function smallMulTo (self, num, out) {
    out.negative = num.negative ^ self.negative;
    var len = (self.length + num.length) | 0;
    out.length = len;
    len = (len - 1) | 0;

    // Peel one iteration (compiler can't do it, because of code complexity)
    var a = self.words[0] | 0;
    var b = num.words[0] | 0;
    var r = a * b;

    var lo = r & 0x3ffffff;
    var carry = (r / 0x4000000) | 0;
    out.words[0] = lo;

    for (var k = 1; k < len; k++) {
      // Sum all words with the same `i + j = k` and accumulate `ncarry`,
      // note that ncarry could be >= 0x3ffffff
      var ncarry = carry >>> 26;
      var rword = carry & 0x3ffffff;
      var maxJ = Math.min(k, num.length - 1);
      for (var j = Math.max(0, k - self.length + 1); j <= maxJ; j++) {
        var i = (k - j) | 0;
        a = self.words[i] | 0;
        b = num.words[j] | 0;
        r = a * b + rword;
        ncarry += (r / 0x4000000) | 0;
        rword = r & 0x3ffffff;
      }
      out.words[k] = rword | 0;
      carry = ncarry | 0;
    }
    if (carry !== 0) {
      out.words[k] = carry | 0;
    } else {
      out.length--;
    }

    return out.strip();
  }

  // TODO(indutny): it may be reasonable to omit it for users who don't need
  // to work with 256-bit numbers, otherwise it gives 20% improvement for 256-bit
  // multiplication (like elliptic secp256k1).
  var comb10MulTo = function comb10MulTo (self, num, out) {
    var a = self.words;
    var b = num.words;
    var o = out.words;
    var c = 0;
    var lo;
    var mid;
    var hi;
    var a0 = a[0] | 0;
    var al0 = a0 & 0x1fff;
    var ah0 = a0 >>> 13;
    var a1 = a[1] | 0;
    var al1 = a1 & 0x1fff;
    var ah1 = a1 >>> 13;
    var a2 = a[2] | 0;
    var al2 = a2 & 0x1fff;
    var ah2 = a2 >>> 13;
    var a3 = a[3] | 0;
    var al3 = a3 & 0x1fff;
    var ah3 = a3 >>> 13;
    var a4 = a[4] | 0;
    var al4 = a4 & 0x1fff;
    var ah4 = a4 >>> 13;
    var a5 = a[5] | 0;
    var al5 = a5 & 0x1fff;
    var ah5 = a5 >>> 13;
    var a6 = a[6] | 0;
    var al6 = a6 & 0x1fff;
    var ah6 = a6 >>> 13;
    var a7 = a[7] | 0;
    var al7 = a7 & 0x1fff;
    var ah7 = a7 >>> 13;
    var a8 = a[8] | 0;
    var al8 = a8 & 0x1fff;
    var ah8 = a8 >>> 13;
    var a9 = a[9] | 0;
    var al9 = a9 & 0x1fff;
    var ah9 = a9 >>> 13;
    var b0 = b[0] | 0;
    var bl0 = b0 & 0x1fff;
    var bh0 = b0 >>> 13;
    var b1 = b[1] | 0;
    var bl1 = b1 & 0x1fff;
    var bh1 = b1 >>> 13;
    var b2 = b[2] | 0;
    var bl2 = b2 & 0x1fff;
    var bh2 = b2 >>> 13;
    var b3 = b[3] | 0;
    var bl3 = b3 & 0x1fff;
    var bh3 = b3 >>> 13;
    var b4 = b[4] | 0;
    var bl4 = b4 & 0x1fff;
    var bh4 = b4 >>> 13;
    var b5 = b[5] | 0;
    var bl5 = b5 & 0x1fff;
    var bh5 = b5 >>> 13;
    var b6 = b[6] | 0;
    var bl6 = b6 & 0x1fff;
    var bh6 = b6 >>> 13;
    var b7 = b[7] | 0;
    var bl7 = b7 & 0x1fff;
    var bh7 = b7 >>> 13;
    var b8 = b[8] | 0;
    var bl8 = b8 & 0x1fff;
    var bh8 = b8 >>> 13;
    var b9 = b[9] | 0;
    var bl9 = b9 & 0x1fff;
    var bh9 = b9 >>> 13;

    out.negative = self.negative ^ num.negative;
    out.length = 19;
    /* k = 0 */
    lo = Math.imul(al0, bl0);
    mid = Math.imul(al0, bh0);
    mid += Math.imul(ah0, bl0);
    hi = Math.imul(ah0, bh0);
    var w0 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w0 >>> 26);
    w0 &= 0x3ffffff;
    /* k = 1 */
    lo = Math.imul(al1, bl0);
    mid = Math.imul(al1, bh0);
    mid += Math.imul(ah1, bl0);
    hi = Math.imul(ah1, bh0);
    lo += Math.imul(al0, bl1);
    mid += Math.imul(al0, bh1);
    mid += Math.imul(ah0, bl1);
    hi += Math.imul(ah0, bh1);
    var w1 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w1 >>> 26);
    w1 &= 0x3ffffff;
    /* k = 2 */
    lo = Math.imul(al2, bl0);
    mid = Math.imul(al2, bh0);
    mid += Math.imul(ah2, bl0);
    hi = Math.imul(ah2, bh0);
    lo += Math.imul(al1, bl1);
    mid += Math.imul(al1, bh1);
    mid += Math.imul(ah1, bl1);
    hi += Math.imul(ah1, bh1);
    lo += Math.imul(al0, bl2);
    mid += Math.imul(al0, bh2);
    mid += Math.imul(ah0, bl2);
    hi += Math.imul(ah0, bh2);
    var w2 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w2 >>> 26);
    w2 &= 0x3ffffff;
    /* k = 3 */
    lo = Math.imul(al3, bl0);
    mid = Math.imul(al3, bh0);
    mid += Math.imul(ah3, bl0);
    hi = Math.imul(ah3, bh0);
    lo += Math.imul(al2, bl1);
    mid += Math.imul(al2, bh1);
    mid += Math.imul(ah2, bl1);
    hi += Math.imul(ah2, bh1);
    lo += Math.imul(al1, bl2);
    mid += Math.imul(al1, bh2);
    mid += Math.imul(ah1, bl2);
    hi += Math.imul(ah1, bh2);
    lo += Math.imul(al0, bl3);
    mid += Math.imul(al0, bh3);
    mid += Math.imul(ah0, bl3);
    hi += Math.imul(ah0, bh3);
    var w3 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w3 >>> 26);
    w3 &= 0x3ffffff;
    /* k = 4 */
    lo = Math.imul(al4, bl0);
    mid = Math.imul(al4, bh0);
    mid += Math.imul(ah4, bl0);
    hi = Math.imul(ah4, bh0);
    lo += Math.imul(al3, bl1);
    mid += Math.imul(al3, bh1);
    mid += Math.imul(ah3, bl1);
    hi += Math.imul(ah3, bh1);
    lo += Math.imul(al2, bl2);
    mid += Math.imul(al2, bh2);
    mid += Math.imul(ah2, bl2);
    hi += Math.imul(ah2, bh2);
    lo += Math.imul(al1, bl3);
    mid += Math.imul(al1, bh3);
    mid += Math.imul(ah1, bl3);
    hi += Math.imul(ah1, bh3);
    lo += Math.imul(al0, bl4);
    mid += Math.imul(al0, bh4);
    mid += Math.imul(ah0, bl4);
    hi += Math.imul(ah0, bh4);
    var w4 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w4 >>> 26);
    w4 &= 0x3ffffff;
    /* k = 5 */
    lo = Math.imul(al5, bl0);
    mid = Math.imul(al5, bh0);
    mid += Math.imul(ah5, bl0);
    hi = Math.imul(ah5, bh0);
    lo += Math.imul(al4, bl1);
    mid += Math.imul(al4, bh1);
    mid += Math.imul(ah4, bl1);
    hi += Math.imul(ah4, bh1);
    lo += Math.imul(al3, bl2);
    mid += Math.imul(al3, bh2);
    mid += Math.imul(ah3, bl2);
    hi += Math.imul(ah3, bh2);
    lo += Math.imul(al2, bl3);
    mid += Math.imul(al2, bh3);
    mid += Math.imul(ah2, bl3);
    hi += Math.imul(ah2, bh3);
    lo += Math.imul(al1, bl4);
    mid += Math.imul(al1, bh4);
    mid += Math.imul(ah1, bl4);
    hi += Math.imul(ah1, bh4);
    lo += Math.imul(al0, bl5);
    mid += Math.imul(al0, bh5);
    mid += Math.imul(ah0, bl5);
    hi += Math.imul(ah0, bh5);
    var w5 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w5 >>> 26);
    w5 &= 0x3ffffff;
    /* k = 6 */
    lo = Math.imul(al6, bl0);
    mid = Math.imul(al6, bh0);
    mid += Math.imul(ah6, bl0);
    hi = Math.imul(ah6, bh0);
    lo += Math.imul(al5, bl1);
    mid += Math.imul(al5, bh1);
    mid += Math.imul(ah5, bl1);
    hi += Math.imul(ah5, bh1);
    lo += Math.imul(al4, bl2);
    mid += Math.imul(al4, bh2);
    mid += Math.imul(ah4, bl2);
    hi += Math.imul(ah4, bh2);
    lo += Math.imul(al3, bl3);
    mid += Math.imul(al3, bh3);
    mid += Math.imul(ah3, bl3);
    hi += Math.imul(ah3, bh3);
    lo += Math.imul(al2, bl4);
    mid += Math.imul(al2, bh4);
    mid += Math.imul(ah2, bl4);
    hi += Math.imul(ah2, bh4);
    lo += Math.imul(al1, bl5);
    mid += Math.imul(al1, bh5);
    mid += Math.imul(ah1, bl5);
    hi += Math.imul(ah1, bh5);
    lo += Math.imul(al0, bl6);
    mid += Math.imul(al0, bh6);
    mid += Math.imul(ah0, bl6);
    hi += Math.imul(ah0, bh6);
    var w6 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w6 >>> 26);
    w6 &= 0x3ffffff;
    /* k = 7 */
    lo = Math.imul(al7, bl0);
    mid = Math.imul(al7, bh0);
    mid += Math.imul(ah7, bl0);
    hi = Math.imul(ah7, bh0);
    lo += Math.imul(al6, bl1);
    mid += Math.imul(al6, bh1);
    mid += Math.imul(ah6, bl1);
    hi += Math.imul(ah6, bh1);
    lo += Math.imul(al5, bl2);
    mid += Math.imul(al5, bh2);
    mid += Math.imul(ah5, bl2);
    hi += Math.imul(ah5, bh2);
    lo += Math.imul(al4, bl3);
    mid += Math.imul(al4, bh3);
    mid += Math.imul(ah4, bl3);
    hi += Math.imul(ah4, bh3);
    lo += Math.imul(al3, bl4);
    mid += Math.imul(al3, bh4);
    mid += Math.imul(ah3, bl4);
    hi += Math.imul(ah3, bh4);
    lo += Math.imul(al2, bl5);
    mid += Math.imul(al2, bh5);
    mid += Math.imul(ah2, bl5);
    hi += Math.imul(ah2, bh5);
    lo += Math.imul(al1, bl6);
    mid += Math.imul(al1, bh6);
    mid += Math.imul(ah1, bl6);
    hi += Math.imul(ah1, bh6);
    lo += Math.imul(al0, bl7);
    mid += Math.imul(al0, bh7);
    mid += Math.imul(ah0, bl7);
    hi += Math.imul(ah0, bh7);
    var w7 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w7 >>> 26);
    w7 &= 0x3ffffff;
    /* k = 8 */
    lo = Math.imul(al8, bl0);
    mid = Math.imul(al8, bh0);
    mid += Math.imul(ah8, bl0);
    hi = Math.imul(ah8, bh0);
    lo += Math.imul(al7, bl1);
    mid += Math.imul(al7, bh1);
    mid += Math.imul(ah7, bl1);
    hi += Math.imul(ah7, bh1);
    lo += Math.imul(al6, bl2);
    mid += Math.imul(al6, bh2);
    mid += Math.imul(ah6, bl2);
    hi += Math.imul(ah6, bh2);
    lo += Math.imul(al5, bl3);
    mid += Math.imul(al5, bh3);
    mid += Math.imul(ah5, bl3);
    hi += Math.imul(ah5, bh3);
    lo += Math.imul(al4, bl4);
    mid += Math.imul(al4, bh4);
    mid += Math.imul(ah4, bl4);
    hi += Math.imul(ah4, bh4);
    lo += Math.imul(al3, bl5);
    mid += Math.imul(al3, bh5);
    mid += Math.imul(ah3, bl5);
    hi += Math.imul(ah3, bh5);
    lo += Math.imul(al2, bl6);
    mid += Math.imul(al2, bh6);
    mid += Math.imul(ah2, bl6);
    hi += Math.imul(ah2, bh6);
    lo += Math.imul(al1, bl7);
    mid += Math.imul(al1, bh7);
    mid += Math.imul(ah1, bl7);
    hi += Math.imul(ah1, bh7);
    lo += Math.imul(al0, bl8);
    mid += Math.imul(al0, bh8);
    mid += Math.imul(ah0, bl8);
    hi += Math.imul(ah0, bh8);
    var w8 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w8 >>> 26);
    w8 &= 0x3ffffff;
    /* k = 9 */
    lo = Math.imul(al9, bl0);
    mid = Math.imul(al9, bh0);
    mid += Math.imul(ah9, bl0);
    hi = Math.imul(ah9, bh0);
    lo += Math.imul(al8, bl1);
    mid += Math.imul(al8, bh1);
    mid += Math.imul(ah8, bl1);
    hi += Math.imul(ah8, bh1);
    lo += Math.imul(al7, bl2);
    mid += Math.imul(al7, bh2);
    mid += Math.imul(ah7, bl2);
    hi += Math.imul(ah7, bh2);
    lo += Math.imul(al6, bl3);
    mid += Math.imul(al6, bh3);
    mid += Math.imul(ah6, bl3);
    hi += Math.imul(ah6, bh3);
    lo += Math.imul(al5, bl4);
    mid += Math.imul(al5, bh4);
    mid += Math.imul(ah5, bl4);
    hi += Math.imul(ah5, bh4);
    lo += Math.imul(al4, bl5);
    mid += Math.imul(al4, bh5);
    mid += Math.imul(ah4, bl5);
    hi += Math.imul(ah4, bh5);
    lo += Math.imul(al3, bl6);
    mid += Math.imul(al3, bh6);
    mid += Math.imul(ah3, bl6);
    hi += Math.imul(ah3, bh6);
    lo += Math.imul(al2, bl7);
    mid += Math.imul(al2, bh7);
    mid += Math.imul(ah2, bl7);
    hi += Math.imul(ah2, bh7);
    lo += Math.imul(al1, bl8);
    mid += Math.imul(al1, bh8);
    mid += Math.imul(ah1, bl8);
    hi += Math.imul(ah1, bh8);
    lo += Math.imul(al0, bl9);
    mid += Math.imul(al0, bh9);
    mid += Math.imul(ah0, bl9);
    hi += Math.imul(ah0, bh9);
    var w9 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w9 >>> 26);
    w9 &= 0x3ffffff;
    /* k = 10 */
    lo = Math.imul(al9, bl1);
    mid = Math.imul(al9, bh1);
    mid += Math.imul(ah9, bl1);
    hi = Math.imul(ah9, bh1);
    lo += Math.imul(al8, bl2);
    mid += Math.imul(al8, bh2);
    mid += Math.imul(ah8, bl2);
    hi += Math.imul(ah8, bh2);
    lo += Math.imul(al7, bl3);
    mid += Math.imul(al7, bh3);
    mid += Math.imul(ah7, bl3);
    hi += Math.imul(ah7, bh3);
    lo += Math.imul(al6, bl4);
    mid += Math.imul(al6, bh4);
    mid += Math.imul(ah6, bl4);
    hi += Math.imul(ah6, bh4);
    lo += Math.imul(al5, bl5);
    mid += Math.imul(al5, bh5);
    mid += Math.imul(ah5, bl5);
    hi += Math.imul(ah5, bh5);
    lo += Math.imul(al4, bl6);
    mid += Math.imul(al4, bh6);
    mid += Math.imul(ah4, bl6);
    hi += Math.imul(ah4, bh6);
    lo += Math.imul(al3, bl7);
    mid += Math.imul(al3, bh7);
    mid += Math.imul(ah3, bl7);
    hi += Math.imul(ah3, bh7);
    lo += Math.imul(al2, bl8);
    mid += Math.imul(al2, bh8);
    mid += Math.imul(ah2, bl8);
    hi += Math.imul(ah2, bh8);
    lo += Math.imul(al1, bl9);
    mid += Math.imul(al1, bh9);
    mid += Math.imul(ah1, bl9);
    hi += Math.imul(ah1, bh9);
    var w10 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w10 >>> 26);
    w10 &= 0x3ffffff;
    /* k = 11 */
    lo = Math.imul(al9, bl2);
    mid = Math.imul(al9, bh2);
    mid += Math.imul(ah9, bl2);
    hi = Math.imul(ah9, bh2);
    lo += Math.imul(al8, bl3);
    mid += Math.imul(al8, bh3);
    mid += Math.imul(ah8, bl3);
    hi += Math.imul(ah8, bh3);
    lo += Math.imul(al7, bl4);
    mid += Math.imul(al7, bh4);
    mid += Math.imul(ah7, bl4);
    hi += Math.imul(ah7, bh4);
    lo += Math.imul(al6, bl5);
    mid += Math.imul(al6, bh5);
    mid += Math.imul(ah6, bl5);
    hi += Math.imul(ah6, bh5);
    lo += Math.imul(al5, bl6);
    mid += Math.imul(al5, bh6);
    mid += Math.imul(ah5, bl6);
    hi += Math.imul(ah5, bh6);
    lo += Math.imul(al4, bl7);
    mid += Math.imul(al4, bh7);
    mid += Math.imul(ah4, bl7);
    hi += Math.imul(ah4, bh7);
    lo += Math.imul(al3, bl8);
    mid += Math.imul(al3, bh8);
    mid += Math.imul(ah3, bl8);
    hi += Math.imul(ah3, bh8);
    lo += Math.imul(al2, bl9);
    mid += Math.imul(al2, bh9);
    mid += Math.imul(ah2, bl9);
    hi += Math.imul(ah2, bh9);
    var w11 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w11 >>> 26);
    w11 &= 0x3ffffff;
    /* k = 12 */
    lo = Math.imul(al9, bl3);
    mid = Math.imul(al9, bh3);
    mid += Math.imul(ah9, bl3);
    hi = Math.imul(ah9, bh3);
    lo += Math.imul(al8, bl4);
    mid += Math.imul(al8, bh4);
    mid += Math.imul(ah8, bl4);
    hi += Math.imul(ah8, bh4);
    lo += Math.imul(al7, bl5);
    mid += Math.imul(al7, bh5);
    mid += Math.imul(ah7, bl5);
    hi += Math.imul(ah7, bh5);
    lo += Math.imul(al6, bl6);
    mid += Math.imul(al6, bh6);
    mid += Math.imul(ah6, bl6);
    hi += Math.imul(ah6, bh6);
    lo += Math.imul(al5, bl7);
    mid += Math.imul(al5, bh7);
    mid += Math.imul(ah5, bl7);
    hi += Math.imul(ah5, bh7);
    lo += Math.imul(al4, bl8);
    mid += Math.imul(al4, bh8);
    mid += Math.imul(ah4, bl8);
    hi += Math.imul(ah4, bh8);
    lo += Math.imul(al3, bl9);
    mid += Math.imul(al3, bh9);
    mid += Math.imul(ah3, bl9);
    hi += Math.imul(ah3, bh9);
    var w12 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w12 >>> 26);
    w12 &= 0x3ffffff;
    /* k = 13 */
    lo = Math.imul(al9, bl4);
    mid = Math.imul(al9, bh4);
    mid += Math.imul(ah9, bl4);
    hi = Math.imul(ah9, bh4);
    lo += Math.imul(al8, bl5);
    mid += Math.imul(al8, bh5);
    mid += Math.imul(ah8, bl5);
    hi += Math.imul(ah8, bh5);
    lo += Math.imul(al7, bl6);
    mid += Math.imul(al7, bh6);
    mid += Math.imul(ah7, bl6);
    hi += Math.imul(ah7, bh6);
    lo += Math.imul(al6, bl7);
    mid += Math.imul(al6, bh7);
    mid += Math.imul(ah6, bl7);
    hi += Math.imul(ah6, bh7);
    lo += Math.imul(al5, bl8);
    mid += Math.imul(al5, bh8);
    mid += Math.imul(ah5, bl8);
    hi += Math.imul(ah5, bh8);
    lo += Math.imul(al4, bl9);
    mid += Math.imul(al4, bh9);
    mid += Math.imul(ah4, bl9);
    hi += Math.imul(ah4, bh9);
    var w13 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w13 >>> 26);
    w13 &= 0x3ffffff;
    /* k = 14 */
    lo = Math.imul(al9, bl5);
    mid = Math.imul(al9, bh5);
    mid += Math.imul(ah9, bl5);
    hi = Math.imul(ah9, bh5);
    lo += Math.imul(al8, bl6);
    mid += Math.imul(al8, bh6);
    mid += Math.imul(ah8, bl6);
    hi += Math.imul(ah8, bh6);
    lo += Math.imul(al7, bl7);
    mid += Math.imul(al7, bh7);
    mid += Math.imul(ah7, bl7);
    hi += Math.imul(ah7, bh7);
    lo += Math.imul(al6, bl8);
    mid += Math.imul(al6, bh8);
    mid += Math.imul(ah6, bl8);
    hi += Math.imul(ah6, bh8);
    lo += Math.imul(al5, bl9);
    mid += Math.imul(al5, bh9);
    mid += Math.imul(ah5, bl9);
    hi += Math.imul(ah5, bh9);
    var w14 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w14 >>> 26);
    w14 &= 0x3ffffff;
    /* k = 15 */
    lo = Math.imul(al9, bl6);
    mid = Math.imul(al9, bh6);
    mid += Math.imul(ah9, bl6);
    hi = Math.imul(ah9, bh6);
    lo += Math.imul(al8, bl7);
    mid += Math.imul(al8, bh7);
    mid += Math.imul(ah8, bl7);
    hi += Math.imul(ah8, bh7);
    lo += Math.imul(al7, bl8);
    mid += Math.imul(al7, bh8);
    mid += Math.imul(ah7, bl8);
    hi += Math.imul(ah7, bh8);
    lo += Math.imul(al6, bl9);
    mid += Math.imul(al6, bh9);
    mid += Math.imul(ah6, bl9);
    hi += Math.imul(ah6, bh9);
    var w15 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w15 >>> 26);
    w15 &= 0x3ffffff;
    /* k = 16 */
    lo = Math.imul(al9, bl7);
    mid = Math.imul(al9, bh7);
    mid += Math.imul(ah9, bl7);
    hi = Math.imul(ah9, bh7);
    lo += Math.imul(al8, bl8);
    mid += Math.imul(al8, bh8);
    mid += Math.imul(ah8, bl8);
    hi += Math.imul(ah8, bh8);
    lo += Math.imul(al7, bl9);
    mid += Math.imul(al7, bh9);
    mid += Math.imul(ah7, bl9);
    hi += Math.imul(ah7, bh9);
    var w16 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w16 >>> 26);
    w16 &= 0x3ffffff;
    /* k = 17 */
    lo = Math.imul(al9, bl8);
    mid = Math.imul(al9, bh8);
    mid += Math.imul(ah9, bl8);
    hi = Math.imul(ah9, bh8);
    lo += Math.imul(al8, bl9);
    mid += Math.imul(al8, bh9);
    mid += Math.imul(ah8, bl9);
    hi += Math.imul(ah8, bh9);
    var w17 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w17 >>> 26);
    w17 &= 0x3ffffff;
    /* k = 18 */
    lo = Math.imul(al9, bl9);
    mid = Math.imul(al9, bh9);
    mid += Math.imul(ah9, bl9);
    hi = Math.imul(ah9, bh9);
    var w18 = c + lo + ((mid & 0x1fff) << 13);
    c = hi + (mid >>> 13) + (w18 >>> 26);
    w18 &= 0x3ffffff;
    o[0] = w0;
    o[1] = w1;
    o[2] = w2;
    o[3] = w3;
    o[4] = w4;
    o[5] = w5;
    o[6] = w6;
    o[7] = w7;
    o[8] = w8;
    o[9] = w9;
    o[10] = w10;
    o[11] = w11;
    o[12] = w12;
    o[13] = w13;
    o[14] = w14;
    o[15] = w15;
    o[16] = w16;
    o[17] = w17;
    o[18] = w18;
    if (c !== 0) {
      o[19] = c;
      out.length++;
    }
    return out;
  };

  // Polyfill comb
  if (!Math.imul) {
    comb10MulTo = smallMulTo;
  }

  function bigMulTo (self, num, out) {
    out.negative = num.negative ^ self.negative;
    out.length = self.length + num.length;

    var carry = 0;
    var hncarry = 0;
    for (var k = 0; k < out.length - 1; k++) {
      // Sum all words with the same `i + j = k` and accumulate `ncarry`,
      // note that ncarry could be >= 0x3ffffff
      var ncarry = hncarry;
      hncarry = 0;
      var rword = carry & 0x3ffffff;
      var maxJ = Math.min(k, num.length - 1);
      for (var j = Math.max(0, k - self.length + 1); j <= maxJ; j++) {
        var i = k - j;
        var a = self.words[i] | 0;
        var b = num.words[j] | 0;
        var r = a * b;

        var lo = r & 0x3ffffff;
        ncarry = (ncarry + ((r / 0x4000000) | 0)) | 0;
        lo = (lo + rword) | 0;
        rword = lo & 0x3ffffff;
        ncarry = (ncarry + (lo >>> 26)) | 0;

        hncarry += ncarry >>> 26;
        ncarry &= 0x3ffffff;
      }
      out.words[k] = rword;
      carry = ncarry;
      ncarry = hncarry;
    }
    if (carry !== 0) {
      out.words[k] = carry;
    } else {
      out.length--;
    }

    return out.strip();
  }

  function jumboMulTo (self, num, out) {
    var fftm = new FFTM();
    return fftm.mulp(self, num, out);
  }

  BN.prototype.mulTo = function mulTo (num, out) {
    var res;
    var len = this.length + num.length;
    if (this.length === 10 && num.length === 10) {
      res = comb10MulTo(this, num, out);
    } else if (len < 63) {
      res = smallMulTo(this, num, out);
    } else if (len < 1024) {
      res = bigMulTo(this, num, out);
    } else {
      res = jumboMulTo(this, num, out);
    }

    return res;
  };

  // Cooley-Tukey algorithm for FFT
  // slightly revisited to rely on looping instead of recursion

  function FFTM (x, y) {
    this.x = x;
    this.y = y;
  }

  FFTM.prototype.makeRBT = function makeRBT (N) {
    var t = new Array(N);
    var l = BN.prototype._countBits(N) - 1;
    for (var i = 0; i < N; i++) {
      t[i] = this.revBin(i, l, N);
    }

    return t;
  };

  // Returns binary-reversed representation of `x`
  FFTM.prototype.revBin = function revBin (x, l, N) {
    if (x === 0 || x === N - 1) return x;

    var rb = 0;
    for (var i = 0; i < l; i++) {
      rb |= (x & 1) << (l - i - 1);
      x >>= 1;
    }

    return rb;
  };

  // Performs "tweedling" phase, therefore 'emulating'
  // behaviour of the recursive algorithm
  FFTM.prototype.permute = function permute (rbt, rws, iws, rtws, itws, N) {
    for (var i = 0; i < N; i++) {
      rtws[i] = rws[rbt[i]];
      itws[i] = iws[rbt[i]];
    }
  };

  FFTM.prototype.transform = function transform (rws, iws, rtws, itws, N, rbt) {
    this.permute(rbt, rws, iws, rtws, itws, N);

    for (var s = 1; s < N; s <<= 1) {
      var l = s << 1;

      var rtwdf = Math.cos(2 * Math.PI / l);
      var itwdf = Math.sin(2 * Math.PI / l);

      for (var p = 0; p < N; p += l) {
        var rtwdf_ = rtwdf;
        var itwdf_ = itwdf;

        for (var j = 0; j < s; j++) {
          var re = rtws[p + j];
          var ie = itws[p + j];

          var ro = rtws[p + j + s];
          var io = itws[p + j + s];

          var rx = rtwdf_ * ro - itwdf_ * io;

          io = rtwdf_ * io + itwdf_ * ro;
          ro = rx;

          rtws[p + j] = re + ro;
          itws[p + j] = ie + io;

          rtws[p + j + s] = re - ro;
          itws[p + j + s] = ie - io;

          /* jshint maxdepth : false */
          if (j !== l) {
            rx = rtwdf * rtwdf_ - itwdf * itwdf_;

            itwdf_ = rtwdf * itwdf_ + itwdf * rtwdf_;
            rtwdf_ = rx;
          }
        }
      }
    }
  };

  FFTM.prototype.guessLen13b = function guessLen13b (n, m) {
    var N = Math.max(m, n) | 1;
    var odd = N & 1;
    var i = 0;
    for (N = N / 2 | 0; N; N = N >>> 1) {
      i++;
    }

    return 1 << i + 1 + odd;
  };

  FFTM.prototype.conjugate = function conjugate (rws, iws, N) {
    if (N <= 1) return;

    for (var i = 0; i < N / 2; i++) {
      var t = rws[i];

      rws[i] = rws[N - i - 1];
      rws[N - i - 1] = t;

      t = iws[i];

      iws[i] = -iws[N - i - 1];
      iws[N - i - 1] = -t;
    }
  };

  FFTM.prototype.normalize13b = function normalize13b (ws, N) {
    var carry = 0;
    for (var i = 0; i < N / 2; i++) {
      var w = Math.round(ws[2 * i + 1] / N) * 0x2000 +
        Math.round(ws[2 * i] / N) +
        carry;

      ws[i] = w & 0x3ffffff;

      if (w < 0x4000000) {
        carry = 0;
      } else {
        carry = w / 0x4000000 | 0;
      }
    }

    return ws;
  };

  FFTM.prototype.convert13b = function convert13b (ws, len, rws, N) {
    var carry = 0;
    for (var i = 0; i < len; i++) {
      carry = carry + (ws[i] | 0);

      rws[2 * i] = carry & 0x1fff; carry = carry >>> 13;
      rws[2 * i + 1] = carry & 0x1fff; carry = carry >>> 13;
    }

    // Pad with zeroes
    for (i = 2 * len; i < N; ++i) {
      rws[i] = 0;
    }

    assert(carry === 0);
    assert((carry & ~0x1fff) === 0);
  };

  FFTM.prototype.stub = function stub (N) {
    var ph = new Array(N);
    for (var i = 0; i < N; i++) {
      ph[i] = 0;
    }

    return ph;
  };

  FFTM.prototype.mulp = function mulp (x, y, out) {
    var N = 2 * this.guessLen13b(x.length, y.length);

    var rbt = this.makeRBT(N);

    var _ = this.stub(N);

    var rws = new Array(N);
    var rwst = new Array(N);
    var iwst = new Array(N);

    var nrws = new Array(N);
    var nrwst = new Array(N);
    var niwst = new Array(N);

    var rmws = out.words;
    rmws.length = N;

    this.convert13b(x.words, x.length, rws, N);
    this.convert13b(y.words, y.length, nrws, N);

    this.transform(rws, _, rwst, iwst, N, rbt);
    this.transform(nrws, _, nrwst, niwst, N, rbt);

    for (var i = 0; i < N; i++) {
      var rx = rwst[i] * nrwst[i] - iwst[i] * niwst[i];
      iwst[i] = rwst[i] * niwst[i] + iwst[i] * nrwst[i];
      rwst[i] = rx;
    }

    this.conjugate(rwst, iwst, N);
    this.transform(rwst, iwst, rmws, _, N, rbt);
    this.conjugate(rmws, _, N);
    this.normalize13b(rmws, N);

    out.negative = x.negative ^ y.negative;
    out.length = x.length + y.length;
    return out.strip();
  };

  // Multiply `this` by `num`
  BN.prototype.mul = function mul (num) {
    var out = new BN(null);
    out.words = new Array(this.length + num.length);
    return this.mulTo(num, out);
  };

  // Multiply employing FFT
  BN.prototype.mulf = function mulf (num) {
    var out = new BN(null);
    out.words = new Array(this.length + num.length);
    return jumboMulTo(this, num, out);
  };

  // In-place Multiplication
  BN.prototype.imul = function imul (num) {
    return this.clone().mulTo(num, this);
  };

  BN.prototype.imuln = function imuln (num) {
    assert(typeof num === 'number');
    assert(num < 0x4000000);

    // Carry
    var carry = 0;
    for (var i = 0; i < this.length; i++) {
      var w = (this.words[i] | 0) * num;
      var lo = (w & 0x3ffffff) + (carry & 0x3ffffff);
      carry >>= 26;
      carry += (w / 0x4000000) | 0;
      // NOTE: lo is 27bit maximum
      carry += lo >>> 26;
      this.words[i] = lo & 0x3ffffff;
    }

    if (carry !== 0) {
      this.words[i] = carry;
      this.length++;
    }

    return this;
  };

  BN.prototype.muln = function muln (num) {
    return this.clone().imuln(num);
  };

  // `this` * `this`
  BN.prototype.sqr = function sqr () {
    return this.mul(this);
  };

  // `this` * `this` in-place
  BN.prototype.isqr = function isqr () {
    return this.imul(this.clone());
  };

  // Math.pow(`this`, `num`)
  BN.prototype.pow = function pow (num) {
    var w = toBitArray(num);
    if (w.length === 0) return new BN(1);

    // Skip leading zeroes
    var res = this;
    for (var i = 0; i < w.length; i++, res = res.sqr()) {
      if (w[i] !== 0) break;
    }

    if (++i < w.length) {
      for (var q = res.sqr(); i < w.length; i++, q = q.sqr()) {
        if (w[i] === 0) continue;

        res = res.mul(q);
      }
    }

    return res;
  };

  // Shift-left in-place
  BN.prototype.iushln = function iushln (bits) {
    assert(typeof bits === 'number' && bits >= 0);
    var r = bits % 26;
    var s = (bits - r) / 26;
    var carryMask = (0x3ffffff >>> (26 - r)) << (26 - r);
    var i;

    if (r !== 0) {
      var carry = 0;

      for (i = 0; i < this.length; i++) {
        var newCarry = this.words[i] & carryMask;
        var c = ((this.words[i] | 0) - newCarry) << r;
        this.words[i] = c | carry;
        carry = newCarry >>> (26 - r);
      }

      if (carry) {
        this.words[i] = carry;
        this.length++;
      }
    }

    if (s !== 0) {
      for (i = this.length - 1; i >= 0; i--) {
        this.words[i + s] = this.words[i];
      }

      for (i = 0; i < s; i++) {
        this.words[i] = 0;
      }

      this.length += s;
    }

    return this.strip();
  };

  BN.prototype.ishln = function ishln (bits) {
    // TODO(indutny): implement me
    assert(this.negative === 0);
    return this.iushln(bits);
  };

  // Shift-right in-place
  // NOTE: `hint` is a lowest bit before trailing zeroes
  // NOTE: if `extended` is present - it will be filled with destroyed bits
  BN.prototype.iushrn = function iushrn (bits, hint, extended) {
    assert(typeof bits === 'number' && bits >= 0);
    var h;
    if (hint) {
      h = (hint - (hint % 26)) / 26;
    } else {
      h = 0;
    }

    var r = bits % 26;
    var s = Math.min((bits - r) / 26, this.length);
    var mask = 0x3ffffff ^ ((0x3ffffff >>> r) << r);
    var maskedWords = extended;

    h -= s;
    h = Math.max(0, h);

    // Extended mode, copy masked part
    if (maskedWords) {
      for (var i = 0; i < s; i++) {
        maskedWords.words[i] = this.words[i];
      }
      maskedWords.length = s;
    }

    if (s === 0) {
      // No-op, we should not move anything at all
    } else if (this.length > s) {
      this.length -= s;
      for (i = 0; i < this.length; i++) {
        this.words[i] = this.words[i + s];
      }
    } else {
      this.words[0] = 0;
      this.length = 1;
    }

    var carry = 0;
    for (i = this.length - 1; i >= 0 && (carry !== 0 || i >= h); i--) {
      var word = this.words[i] | 0;
      this.words[i] = (carry << (26 - r)) | (word >>> r);
      carry = word & mask;
    }

    // Push carried bits as a mask
    if (maskedWords && carry !== 0) {
      maskedWords.words[maskedWords.length++] = carry;
    }

    if (this.length === 0) {
      this.words[0] = 0;
      this.length = 1;
    }

    return this.strip();
  };

  BN.prototype.ishrn = function ishrn (bits, hint, extended) {
    // TODO(indutny): implement me
    assert(this.negative === 0);
    return this.iushrn(bits, hint, extended);
  };

  // Shift-left
  BN.prototype.shln = function shln (bits) {
    return this.clone().ishln(bits);
  };

  BN.prototype.ushln = function ushln (bits) {
    return this.clone().iushln(bits);
  };

  // Shift-right
  BN.prototype.shrn = function shrn (bits) {
    return this.clone().ishrn(bits);
  };

  BN.prototype.ushrn = function ushrn (bits) {
    return this.clone().iushrn(bits);
  };

  // Test if n bit is set
  BN.prototype.testn = function testn (bit) {
    assert(typeof bit === 'number' && bit >= 0);
    var r = bit % 26;
    var s = (bit - r) / 26;
    var q = 1 << r;

    // Fast case: bit is much higher than all existing words
    if (this.length <= s) return false;

    // Check bit and return
    var w = this.words[s];

    return !!(w & q);
  };

  // Return only lowers bits of number (in-place)
  BN.prototype.imaskn = function imaskn (bits) {
    assert(typeof bits === 'number' && bits >= 0);
    var r = bits % 26;
    var s = (bits - r) / 26;

    assert(this.negative === 0, 'imaskn works only with positive numbers');

    if (r !== 0) {
      s++;
    }
    this.length = Math.min(s, this.length);

    if (r !== 0) {
      var mask = 0x3ffffff ^ ((0x3ffffff >>> r) << r);
      this.words[this.length - 1] &= mask;
    }

    return this.strip();
  };

  // Return only lowers bits of number
  BN.prototype.maskn = function maskn (bits) {
    return this.clone().imaskn(bits);
  };

  // Add plain number `num` to `this`
  BN.prototype.iaddn = function iaddn (num) {
    assert(typeof num === 'number');
    assert(num < 0x4000000);
    if (num < 0) return this.isubn(-num);

    // Possible sign change
    if (this.negative !== 0) {
      if (this.length === 1 && (this.words[0] | 0) < num) {
        this.words[0] = num - (this.words[0] | 0);
        this.negative = 0;
        return this;
      }

      this.negative = 0;
      this.isubn(num);
      this.negative = 1;
      return this;
    }

    // Add without checks
    return this._iaddn(num);
  };

  BN.prototype._iaddn = function _iaddn (num) {
    this.words[0] += num;

    // Carry
    for (var i = 0; i < this.length && this.words[i] >= 0x4000000; i++) {
      this.words[i] -= 0x4000000;
      if (i === this.length - 1) {
        this.words[i + 1] = 1;
      } else {
        this.words[i + 1]++;
      }
    }
    this.length = Math.max(this.length, i + 1);

    return this;
  };

  // Subtract plain number `num` from `this`
  BN.prototype.isubn = function isubn (num) {
    assert(typeof num === 'number');
    assert(num < 0x4000000);
    if (num < 0) return this.iaddn(-num);

    if (this.negative !== 0) {
      this.negative = 0;
      this.iaddn(num);
      this.negative = 1;
      return this;
    }

    this.words[0] -= num;

    if (this.length === 1 && this.words[0] < 0) {
      this.words[0] = -this.words[0];
      this.negative = 1;
    } else {
      // Carry
      for (var i = 0; i < this.length && this.words[i] < 0; i++) {
        this.words[i] += 0x4000000;
        this.words[i + 1] -= 1;
      }
    }

    return this.strip();
  };

  BN.prototype.addn = function addn (num) {
    return this.clone().iaddn(num);
  };

  BN.prototype.subn = function subn (num) {
    return this.clone().isubn(num);
  };

  BN.prototype.iabs = function iabs () {
    this.negative = 0;

    return this;
  };

  BN.prototype.abs = function abs () {
    return this.clone().iabs();
  };

  BN.prototype._ishlnsubmul = function _ishlnsubmul (num, mul, shift) {
    // Bigger storage is needed
    var len = num.length + shift;
    var i;
    if (this.words.length < len) {
      var t = new Array(len);
      for (i = 0; i < this.length; i++) {
        t[i] = this.words[i];
      }
      this.words = t;
    } else {
      i = this.length;
    }

    // Zeroify rest
    this.length = Math.max(this.length, len);
    for (; i < this.length; i++) {
      this.words[i] = 0;
    }

    var w;
    var carry = 0;
    for (i = 0; i < num.length; i++) {
      w = (this.words[i + shift] | 0) + carry;
      var right = (num.words[i] | 0) * mul;
      w -= right & 0x3ffffff;
      carry = (w >> 26) - ((right / 0x4000000) | 0);
      this.words[i + shift] = w & 0x3ffffff;
    }
    for (; i < this.length - shift; i++) {
      w = (this.words[i + shift] | 0) + carry;
      carry = w >> 26;
      this.words[i + shift] = w & 0x3ffffff;
    }

    if (carry === 0) return this.strip();

    // Subtraction overflow
    assert(carry === -1);
    carry = 0;
    for (i = 0; i < this.length; i++) {
      w = -(this.words[i] | 0) + carry;
      carry = w >> 26;
      this.words[i] = w & 0x3ffffff;
    }
    this.negative = 1;

    return this.strip();
  };

  BN.prototype._wordDiv = function _wordDiv (num, mode) {
    var shift = this.length - num.length;

    var a = this.clone();
    var b = num;

    // Normalize
    var bhi = b.words[b.length - 1] | 0;
    var bhiBits = this._countBits(bhi);
    shift = 26 - bhiBits;
    if (shift !== 0) {
      b = b.ushln(shift);
      a.iushln(shift);
      bhi = b.words[b.length - 1] | 0;
    }

    // Initialize quotient
    var m = a.length - b.length;
    var q;

    if (mode !== 'mod') {
      q = new BN(null);
      q.length = m + 1;
      q.words = new Array(q.length);
      for (var i = 0; i < q.length; i++) {
        q.words[i] = 0;
      }
    }

    var diff = a.clone()._ishlnsubmul(b, 1, m);
    if (diff.negative === 0) {
      a = diff;
      if (q) {
        q.words[m] = 1;
      }
    }

    for (var j = m - 1; j >= 0; j--) {
      var qj = (a.words[b.length + j] | 0) * 0x4000000 +
        (a.words[b.length + j - 1] | 0);

      // NOTE: (qj / bhi) is (0x3ffffff * 0x4000000 + 0x3ffffff) / 0x2000000 max
      // (0x7ffffff)
      qj = Math.min((qj / bhi) | 0, 0x3ffffff);

      a._ishlnsubmul(b, qj, j);
      while (a.negative !== 0) {
        qj--;
        a.negative = 0;
        a._ishlnsubmul(b, 1, j);
        if (!a.isZero()) {
          a.negative ^= 1;
        }
      }
      if (q) {
        q.words[j] = qj;
      }
    }
    if (q) {
      q.strip();
    }
    a.strip();

    // Denormalize
    if (mode !== 'div' && shift !== 0) {
      a.iushrn(shift);
    }

    return {
      div: q || null,
      mod: a
    };
  };

  // NOTE: 1) `mode` can be set to `mod` to request mod only,
  //       to `div` to request div only, or be absent to
  //       request both div & mod
  //       2) `positive` is true if unsigned mod is requested
  BN.prototype.divmod = function divmod (num, mode, positive) {
    assert(!num.isZero());

    if (this.isZero()) {
      return {
        div: new BN(0),
        mod: new BN(0)
      };
    }

    var div, mod, res;
    if (this.negative !== 0 && num.negative === 0) {
      res = this.neg().divmod(num, mode);

      if (mode !== 'mod') {
        div = res.div.neg();
      }

      if (mode !== 'div') {
        mod = res.mod.neg();
        if (positive && mod.negative !== 0) {
          mod.iadd(num);
        }
      }

      return {
        div: div,
        mod: mod
      };
    }

    if (this.negative === 0 && num.negative !== 0) {
      res = this.divmod(num.neg(), mode);

      if (mode !== 'mod') {
        div = res.div.neg();
      }

      return {
        div: div,
        mod: res.mod
      };
    }

    if ((this.negative & num.negative) !== 0) {
      res = this.neg().divmod(num.neg(), mode);

      if (mode !== 'div') {
        mod = res.mod.neg();
        if (positive && mod.negative !== 0) {
          mod.isub(num);
        }
      }

      return {
        div: res.div,
        mod: mod
      };
    }

    // Both numbers are positive at this point

    // Strip both numbers to approximate shift value
    if (num.length > this.length || this.cmp(num) < 0) {
      return {
        div: new BN(0),
        mod: this
      };
    }

    // Very short reduction
    if (num.length === 1) {
      if (mode === 'div') {
        return {
          div: this.divn(num.words[0]),
          mod: null
        };
      }

      if (mode === 'mod') {
        return {
          div: null,
          mod: new BN(this.modn(num.words[0]))
        };
      }

      return {
        div: this.divn(num.words[0]),
        mod: new BN(this.modn(num.words[0]))
      };
    }

    return this._wordDiv(num, mode);
  };

  // Find `this` / `num`
  BN.prototype.div = function div (num) {
    return this.divmod(num, 'div', false).div;
  };

  // Find `this` % `num`
  BN.prototype.mod = function mod (num) {
    return this.divmod(num, 'mod', false).mod;
  };

  BN.prototype.umod = function umod (num) {
    return this.divmod(num, 'mod', true).mod;
  };

  // Find Round(`this` / `num`)
  BN.prototype.divRound = function divRound (num) {
    var dm = this.divmod(num);

    // Fast case - exact division
    if (dm.mod.isZero()) return dm.div;

    var mod = dm.div.negative !== 0 ? dm.mod.isub(num) : dm.mod;

    var half = num.ushrn(1);
    var r2 = num.andln(1);
    var cmp = mod.cmp(half);

    // Round down
    if (cmp < 0 || r2 === 1 && cmp === 0) return dm.div;

    // Round up
    return dm.div.negative !== 0 ? dm.div.isubn(1) : dm.div.iaddn(1);
  };

  BN.prototype.modn = function modn (num) {
    assert(num <= 0x3ffffff);
    var p = (1 << 26) % num;

    var acc = 0;
    for (var i = this.length - 1; i >= 0; i--) {
      acc = (p * acc + (this.words[i] | 0)) % num;
    }

    return acc;
  };

  // In-place division by number
  BN.prototype.idivn = function idivn (num) {
    assert(num <= 0x3ffffff);

    var carry = 0;
    for (var i = this.length - 1; i >= 0; i--) {
      var w = (this.words[i] | 0) + carry * 0x4000000;
      this.words[i] = (w / num) | 0;
      carry = w % num;
    }

    return this.strip();
  };

  BN.prototype.divn = function divn (num) {
    return this.clone().idivn(num);
  };

  BN.prototype.egcd = function egcd (p) {
    assert(p.negative === 0);
    assert(!p.isZero());

    var x = this;
    var y = p.clone();

    if (x.negative !== 0) {
      x = x.umod(p);
    } else {
      x = x.clone();
    }

    // A * x + B * y = x
    var A = new BN(1);
    var B = new BN(0);

    // C * x + D * y = y
    var C = new BN(0);
    var D = new BN(1);

    var g = 0;

    while (x.isEven() && y.isEven()) {
      x.iushrn(1);
      y.iushrn(1);
      ++g;
    }

    var yp = y.clone();
    var xp = x.clone();

    while (!x.isZero()) {
      for (var i = 0, im = 1; (x.words[0] & im) === 0 && i < 26; ++i, im <<= 1);
      if (i > 0) {
        x.iushrn(i);
        while (i-- > 0) {
          if (A.isOdd() || B.isOdd()) {
            A.iadd(yp);
            B.isub(xp);
          }

          A.iushrn(1);
          B.iushrn(1);
        }
      }

      for (var j = 0, jm = 1; (y.words[0] & jm) === 0 && j < 26; ++j, jm <<= 1);
      if (j > 0) {
        y.iushrn(j);
        while (j-- > 0) {
          if (C.isOdd() || D.isOdd()) {
            C.iadd(yp);
            D.isub(xp);
          }

          C.iushrn(1);
          D.iushrn(1);
        }
      }

      if (x.cmp(y) >= 0) {
        x.isub(y);
        A.isub(C);
        B.isub(D);
      } else {
        y.isub(x);
        C.isub(A);
        D.isub(B);
      }
    }

    return {
      a: C,
      b: D,
      gcd: y.iushln(g)
    };
  };

  // This is reduced incarnation of the binary EEA
  // above, designated to invert members of the
  // _prime_ fields F(p) at a maximal speed
  BN.prototype._invmp = function _invmp (p) {
    assert(p.negative === 0);
    assert(!p.isZero());

    var a = this;
    var b = p.clone();

    if (a.negative !== 0) {
      a = a.umod(p);
    } else {
      a = a.clone();
    }

    var x1 = new BN(1);
    var x2 = new BN(0);

    var delta = b.clone();

    while (a.cmpn(1) > 0 && b.cmpn(1) > 0) {
      for (var i = 0, im = 1; (a.words[0] & im) === 0 && i < 26; ++i, im <<= 1);
      if (i > 0) {
        a.iushrn(i);
        while (i-- > 0) {
          if (x1.isOdd()) {
            x1.iadd(delta);
          }

          x1.iushrn(1);
        }
      }

      for (var j = 0, jm = 1; (b.words[0] & jm) === 0 && j < 26; ++j, jm <<= 1);
      if (j > 0) {
        b.iushrn(j);
        while (j-- > 0) {
          if (x2.isOdd()) {
            x2.iadd(delta);
          }

          x2.iushrn(1);
        }
      }

      if (a.cmp(b) >= 0) {
        a.isub(b);
        x1.isub(x2);
      } else {
        b.isub(a);
        x2.isub(x1);
      }
    }

    var res;
    if (a.cmpn(1) === 0) {
      res = x1;
    } else {
      res = x2;
    }

    if (res.cmpn(0) < 0) {
      res.iadd(p);
    }

    return res;
  };

  BN.prototype.gcd = function gcd (num) {
    if (this.isZero()) return num.abs();
    if (num.isZero()) return this.abs();

    var a = this.clone();
    var b = num.clone();
    a.negative = 0;
    b.negative = 0;

    // Remove common factor of two
    for (var shift = 0; a.isEven() && b.isEven(); shift++) {
      a.iushrn(1);
      b.iushrn(1);
    }

    do {
      while (a.isEven()) {
        a.iushrn(1);
      }
      while (b.isEven()) {
        b.iushrn(1);
      }

      var r = a.cmp(b);
      if (r < 0) {
        // Swap `a` and `b` to make `a` always bigger than `b`
        var t = a;
        a = b;
        b = t;
      } else if (r === 0 || b.cmpn(1) === 0) {
        break;
      }

      a.isub(b);
    } while (true);

    return b.iushln(shift);
  };

  // Invert number in the field F(num)
  BN.prototype.invm = function invm (num) {
    return this.egcd(num).a.umod(num);
  };

  BN.prototype.isEven = function isEven () {
    return (this.words[0] & 1) === 0;
  };

  BN.prototype.isOdd = function isOdd () {
    return (this.words[0] & 1) === 1;
  };

  // And first word and num
  BN.prototype.andln = function andln (num) {
    return this.words[0] & num;
  };

  // Increment at the bit position in-line
  BN.prototype.bincn = function bincn (bit) {
    assert(typeof bit === 'number');
    var r = bit % 26;
    var s = (bit - r) / 26;
    var q = 1 << r;

    // Fast case: bit is much higher than all existing words
    if (this.length <= s) {
      for (var i = this.length; i < s + 1; i++) {
        this.words[i] = 0;
      }
      this.words[s] |= q;
      this.length = s + 1;
      return this;
    }

    // Add bit and propagate, if needed
    var carry = q;
    for (i = s; carry !== 0 && i < this.length; i++) {
      var w = this.words[i] | 0;
      w += carry;
      carry = w >>> 26;
      w &= 0x3ffffff;
      this.words[i] = w;
    }
    if (carry !== 0) {
      this.words[i] = carry;
      this.length++;
    }
    return this;
  };

  BN.prototype.isZero = function isZero () {
    return this.length === 1 && this.words[0] === 0;
  };

  BN.prototype.cmpn = function cmpn (num) {
    var negative = num < 0;

    if (this.negative !== 0 && !negative) return -1;
    if (this.negative === 0 && negative) return 1;

    this.strip();

    var res;
    if (this.length > 1) {
      res = 1;
    } else {
      if (negative) {
        num = -num;
      }

      assert(num <= 0x3ffffff, 'Number is too big');

      var w = this.words[0] | 0;
      res = w === num ? 0 : w < num ? -1 : 1;
    }
    if (this.negative !== 0) {
      res = -res;
    }
    return res;
  };

  // Compare two numbers and return:
  // 1 - if `this` > `num`
  // 0 - if `this` == `num`
  // -1 - if `this` < `num`
  BN.prototype.cmp = function cmp (num) {
    if (this.negative !== 0 && num.negative === 0) return -1;
    if (this.negative === 0 && num.negative !== 0) return 1;

    var res = this.ucmp(num);
    if (this.negative !== 0) return -res;

    return res;
  };

  // Unsigned comparison
  BN.prototype.ucmp = function ucmp (num) {
    // At this point both numbers have the same sign
    if (this.length > num.length) return 1;
    if (this.length < num.length) return -1;

    var res = 0;
    for (var i = this.length - 1; i >= 0; i--) {
      var a = this.words[i] | 0;
      var b = num.words[i] | 0;

      if (a === b) continue;
      if (a < b) {
        res = -1;
      } else if (a > b) {
        res = 1;
      }
      break;
    }
    return res;
  };

  BN.prototype.gtn = function gtn (num) {
    return this.cmpn(num) === 1;
  };

  BN.prototype.gt = function gt (num) {
    return this.cmp(num) === 1;
  };

  BN.prototype.gten = function gten (num) {
    return this.cmpn(num) >= 0;
  };

  BN.prototype.gte = function gte (num) {
    return this.cmp(num) >= 0;
  };

  BN.prototype.ltn = function ltn (num) {
    return this.cmpn(num) === -1;
  };

  BN.prototype.lt = function lt (num) {
    return this.cmp(num) === -1;
  };

  BN.prototype.lten = function lten (num) {
    return this.cmpn(num) <= 0;
  };

  BN.prototype.lte = function lte (num) {
    return this.cmp(num) <= 0;
  };

  BN.prototype.eqn = function eqn (num) {
    return this.cmpn(num) === 0;
  };

  BN.prototype.eq = function eq (num) {
    return this.cmp(num) === 0;
  };

  //
  // A reduce context, could be using montgomery or something better, depending
  // on the `m` itself.
  //
  BN.red = function red (num) {
    return new Red(num);
  };

  BN.prototype.toRed = function toRed (ctx) {
    assert(!this.red, 'Already a number in reduction context');
    assert(this.negative === 0, 'red works only with positives');
    return ctx.convertTo(this)._forceRed(ctx);
  };

  BN.prototype.fromRed = function fromRed () {
    assert(this.red, 'fromRed works only with numbers in reduction context');
    return this.red.convertFrom(this);
  };

  BN.prototype._forceRed = function _forceRed (ctx) {
    this.red = ctx;
    return this;
  };

  BN.prototype.forceRed = function forceRed (ctx) {
    assert(!this.red, 'Already a number in reduction context');
    return this._forceRed(ctx);
  };

  BN.prototype.redAdd = function redAdd (num) {
    assert(this.red, 'redAdd works only with red numbers');
    return this.red.add(this, num);
  };

  BN.prototype.redIAdd = function redIAdd (num) {
    assert(this.red, 'redIAdd works only with red numbers');
    return this.red.iadd(this, num);
  };

  BN.prototype.redSub = function redSub (num) {
    assert(this.red, 'redSub works only with red numbers');
    return this.red.sub(this, num);
  };

  BN.prototype.redISub = function redISub (num) {
    assert(this.red, 'redISub works only with red numbers');
    return this.red.isub(this, num);
  };

  BN.prototype.redShl = function redShl (num) {
    assert(this.red, 'redShl works only with red numbers');
    return this.red.ushl(this, num);
  };

  BN.prototype.redMul = function redMul (num) {
    assert(this.red, 'redMul works only with red numbers');
    this.red._verify2(this, num);
    return this.red.mul(this, num);
  };

  BN.prototype.redIMul = function redIMul (num) {
    assert(this.red, 'redMul works only with red numbers');
    this.red._verify2(this, num);
    return this.red.imul(this, num);
  };

  BN.prototype.redSqr = function redSqr () {
    assert(this.red, 'redSqr works only with red numbers');
    this.red._verify1(this);
    return this.red.sqr(this);
  };

  BN.prototype.redISqr = function redISqr () {
    assert(this.red, 'redISqr works only with red numbers');
    this.red._verify1(this);
    return this.red.isqr(this);
  };

  // Square root over p
  BN.prototype.redSqrt = function redSqrt () {
    assert(this.red, 'redSqrt works only with red numbers');
    this.red._verify1(this);
    return this.red.sqrt(this);
  };

  BN.prototype.redInvm = function redInvm () {
    assert(this.red, 'redInvm works only with red numbers');
    this.red._verify1(this);
    return this.red.invm(this);
  };

  // Return negative clone of `this` % `red modulo`
  BN.prototype.redNeg = function redNeg () {
    assert(this.red, 'redNeg works only with red numbers');
    this.red._verify1(this);
    return this.red.neg(this);
  };

  BN.prototype.redPow = function redPow (num) {
    assert(this.red && !num.red, 'redPow(normalNum)');
    this.red._verify1(this);
    return this.red.pow(this, num);
  };

  // Prime numbers with efficient reduction
  var primes = {
    k256: null,
    p224: null,
    p192: null,
    p25519: null
  };

  // Pseudo-Mersenne prime
  function MPrime (name, p) {
    // P = 2 ^ N - K
    this.name = name;
    this.p = new BN(p, 16);
    this.n = this.p.bitLength();
    this.k = new BN(1).iushln(this.n).isub(this.p);

    this.tmp = this._tmp();
  }

  MPrime.prototype._tmp = function _tmp () {
    var tmp = new BN(null);
    tmp.words = new Array(Math.ceil(this.n / 13));
    return tmp;
  };

  MPrime.prototype.ireduce = function ireduce (num) {
    // Assumes that `num` is less than `P^2`
    // num = HI * (2 ^ N - K) + HI * K + LO = HI * K + LO (mod P)
    var r = num;
    var rlen;

    do {
      this.split(r, this.tmp);
      r = this.imulK(r);
      r = r.iadd(this.tmp);
      rlen = r.bitLength();
    } while (rlen > this.n);

    var cmp = rlen < this.n ? -1 : r.ucmp(this.p);
    if (cmp === 0) {
      r.words[0] = 0;
      r.length = 1;
    } else if (cmp > 0) {
      r.isub(this.p);
    } else {
      r.strip();
    }

    return r;
  };

  MPrime.prototype.split = function split (input, out) {
    input.iushrn(this.n, 0, out);
  };

  MPrime.prototype.imulK = function imulK (num) {
    return num.imul(this.k);
  };

  function K256 () {
    MPrime.call(
      this,
      'k256',
      'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f');
  }
  inherits(K256, MPrime);

  K256.prototype.split = function split (input, output) {
    // 256 = 9 * 26 + 22
    var mask = 0x3fffff;

    var outLen = Math.min(input.length, 9);
    for (var i = 0; i < outLen; i++) {
      output.words[i] = input.words[i];
    }
    output.length = outLen;

    if (input.length <= 9) {
      input.words[0] = 0;
      input.length = 1;
      return;
    }

    // Shift by 9 limbs
    var prev = input.words[9];
    output.words[output.length++] = prev & mask;

    for (i = 10; i < input.length; i++) {
      var next = input.words[i] | 0;
      input.words[i - 10] = ((next & mask) << 4) | (prev >>> 22);
      prev = next;
    }
    prev >>>= 22;
    input.words[i - 10] = prev;
    if (prev === 0 && input.length > 10) {
      input.length -= 10;
    } else {
      input.length -= 9;
    }
  };

  K256.prototype.imulK = function imulK (num) {
    // K = 0x1000003d1 = [ 0x40, 0x3d1 ]
    num.words[num.length] = 0;
    num.words[num.length + 1] = 0;
    num.length += 2;

    // bounded at: 0x40 * 0x3ffffff + 0x3d0 = 0x100000390
    var lo = 0;
    for (var i = 0; i < num.length; i++) {
      var w = num.words[i] | 0;
      lo += w * 0x3d1;
      num.words[i] = lo & 0x3ffffff;
      lo = w * 0x40 + ((lo / 0x4000000) | 0);
    }

    // Fast length reduction
    if (num.words[num.length - 1] === 0) {
      num.length--;
      if (num.words[num.length - 1] === 0) {
        num.length--;
      }
    }
    return num;
  };

  function P224 () {
    MPrime.call(
      this,
      'p224',
      'ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001');
  }
  inherits(P224, MPrime);

  function P192 () {
    MPrime.call(
      this,
      'p192',
      'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff');
  }
  inherits(P192, MPrime);

  function P25519 () {
    // 2 ^ 255 - 19
    MPrime.call(
      this,
      '25519',
      '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed');
  }
  inherits(P25519, MPrime);

  P25519.prototype.imulK = function imulK (num) {
    // K = 0x13
    var carry = 0;
    for (var i = 0; i < num.length; i++) {
      var hi = (num.words[i] | 0) * 0x13 + carry;
      var lo = hi & 0x3ffffff;
      hi >>>= 26;

      num.words[i] = lo;
      carry = hi;
    }
    if (carry !== 0) {
      num.words[num.length++] = carry;
    }
    return num;
  };

  // Exported mostly for testing purposes, use plain name instead
  BN._prime = function prime (name) {
    // Cached version of prime
    if (primes[name]) return primes[name];

    var prime;
    if (name === 'k256') {
      prime = new K256();
    } else if (name === 'p224') {
      prime = new P224();
    } else if (name === 'p192') {
      prime = new P192();
    } else if (name === 'p25519') {
      prime = new P25519();
    } else {
      throw new Error('Unknown prime ' + name);
    }
    primes[name] = prime;

    return prime;
  };

  //
  // Base reduction engine
  //
  function Red (m) {
    if (typeof m === 'string') {
      var prime = BN._prime(m);
      this.m = prime.p;
      this.prime = prime;
    } else {
      this.m = m;
      this.prime = null;
    }
  }

  Red.prototype._verify1 = function _verify1 (a) {
    assert(a.negative === 0, 'red works only with positives');
    assert(a.red, 'red works only with red numbers');
  };

  Red.prototype._verify2 = function _verify2 (a, b) {
    assert((a.negative | b.negative) === 0, 'red works only with positives');
    assert(a.red && a.red === b.red,
      'red works only with red numbers');
  };

  Red.prototype.imod = function imod (a) {
    if (this.prime) return this.prime.ireduce(a)._forceRed(this);
    return a.umod(this.m)._forceRed(this);
  };

  Red.prototype.neg = function neg (a) {
    if (a.isZero()) {
      return a.clone();
    }

    return this.m.sub(a)._forceRed(this);
  };

  Red.prototype.add = function add (a, b) {
    this._verify2(a, b);

    var res = a.add(b);
    if (res.cmp(this.m) >= 0) {
      res.isub(this.m);
    }
    return res._forceRed(this);
  };

  Red.prototype.iadd = function iadd (a, b) {
    this._verify2(a, b);

    var res = a.iadd(b);
    if (res.cmp(this.m) >= 0) {
      res.isub(this.m);
    }
    return res;
  };

  Red.prototype.sub = function sub (a, b) {
    this._verify2(a, b);

    var res = a.sub(b);
    if (res.cmpn(0) < 0) {
      res.iadd(this.m);
    }
    return res._forceRed(this);
  };

  Red.prototype.isub = function isub (a, b) {
    this._verify2(a, b);

    var res = a.isub(b);
    if (res.cmpn(0) < 0) {
      res.iadd(this.m);
    }
    return res;
  };

  Red.prototype.shl = function shl (a, num) {
    this._verify1(a);
    return this.imod(a.ushln(num));
  };

  Red.prototype.imul = function imul (a, b) {
    this._verify2(a, b);
    return this.imod(a.imul(b));
  };

  Red.prototype.mul = function mul (a, b) {
    this._verify2(a, b);
    return this.imod(a.mul(b));
  };

  Red.prototype.isqr = function isqr (a) {
    return this.imul(a, a.clone());
  };

  Red.prototype.sqr = function sqr (a) {
    return this.mul(a, a);
  };

  Red.prototype.sqrt = function sqrt (a) {
    if (a.isZero()) return a.clone();

    var mod3 = this.m.andln(3);
    assert(mod3 % 2 === 1);

    // Fast case
    if (mod3 === 3) {
      var pow = this.m.add(new BN(1)).iushrn(2);
      return this.pow(a, pow);
    }

    // Tonelli-Shanks algorithm (Totally unoptimized and slow)
    //
    // Find Q and S, that Q * 2 ^ S = (P - 1)
    var q = this.m.subn(1);
    var s = 0;
    while (!q.isZero() && q.andln(1) === 0) {
      s++;
      q.iushrn(1);
    }
    assert(!q.isZero());

    var one = new BN(1).toRed(this);
    var nOne = one.redNeg();

    // Find quadratic non-residue
    // NOTE: Max is such because of generalized Riemann hypothesis.
    var lpow = this.m.subn(1).iushrn(1);
    var z = this.m.bitLength();
    z = new BN(2 * z * z).toRed(this);

    while (this.pow(z, lpow).cmp(nOne) !== 0) {
      z.redIAdd(nOne);
    }

    var c = this.pow(z, q);
    var r = this.pow(a, q.addn(1).iushrn(1));
    var t = this.pow(a, q);
    var m = s;
    while (t.cmp(one) !== 0) {
      var tmp = t;
      for (var i = 0; tmp.cmp(one) !== 0; i++) {
        tmp = tmp.redSqr();
      }
      assert(i < m);
      var b = this.pow(c, new BN(1).iushln(m - i - 1));

      r = r.redMul(b);
      c = b.redSqr();
      t = t.redMul(c);
      m = i;
    }

    return r;
  };

  Red.prototype.invm = function invm (a) {
    var inv = a._invmp(this.m);
    if (inv.negative !== 0) {
      inv.negative = 0;
      return this.imod(inv).redNeg();
    } else {
      return this.imod(inv);
    }
  };

  Red.prototype.pow = function pow (a, num) {
    if (num.isZero()) return new BN(1);
    if (num.cmpn(1) === 0) return a.clone();

    var windowSize = 4;
    var wnd = new Array(1 << windowSize);
    wnd[0] = new BN(1).toRed(this);
    wnd[1] = a;
    for (var i = 2; i < wnd.length; i++) {
      wnd[i] = this.mul(wnd[i - 1], a);
    }

    var res = wnd[0];
    var current = 0;
    var currentLen = 0;
    var start = num.bitLength() % 26;
    if (start === 0) {
      start = 26;
    }

    for (i = num.length - 1; i >= 0; i--) {
      var word = num.words[i];
      for (var j = start - 1; j >= 0; j--) {
        var bit = (word >> j) & 1;
        if (res !== wnd[0]) {
          res = this.sqr(res);
        }

        if (bit === 0 && current === 0) {
          currentLen = 0;
          continue;
        }

        current <<= 1;
        current |= bit;
        currentLen++;
        if (currentLen !== windowSize && (i !== 0 || j !== 0)) continue;

        res = this.mul(res, wnd[current]);
        currentLen = 0;
        current = 0;
      }
      start = 26;
    }

    return res;
  };

  Red.prototype.convertTo = function convertTo (num) {
    var r = num.umod(this.m);

    return r === num ? r.clone() : r;
  };

  Red.prototype.convertFrom = function convertFrom (num) {
    var res = num.clone();
    res.red = null;
    return res;
  };

  //
  // Montgomery method engine
  //

  BN.mont = function mont (num) {
    return new Mont(num);
  };

  function Mont (m) {
    Red.call(this, m);

    this.shift = this.m.bitLength();
    if (this.shift % 26 !== 0) {
      this.shift += 26 - (this.shift % 26);
    }

    this.r = new BN(1).iushln(this.shift);
    this.r2 = this.imod(this.r.sqr());
    this.rinv = this.r._invmp(this.m);

    this.minv = this.rinv.mul(this.r).isubn(1).div(this.m);
    this.minv = this.minv.umod(this.r);
    this.minv = this.r.sub(this.minv);
  }
  inherits(Mont, Red);

  Mont.prototype.convertTo = function convertTo (num) {
    return this.imod(num.ushln(this.shift));
  };

  Mont.prototype.convertFrom = function convertFrom (num) {
    var r = this.imod(num.mul(this.rinv));
    r.red = null;
    return r;
  };

  Mont.prototype.imul = function imul (a, b) {
    if (a.isZero() || b.isZero()) {
      a.words[0] = 0;
      a.length = 1;
      return a;
    }

    var t = a.imul(b);
    var c = t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);
    var u = t.isub(c).iushrn(this.shift);
    var res = u;

    if (u.cmp(this.m) >= 0) {
      res = u.isub(this.m);
    } else if (u.cmpn(0) < 0) {
      res = u.iadd(this.m);
    }

    return res._forceRed(this);
  };

  Mont.prototype.mul = function mul (a, b) {
    if (a.isZero() || b.isZero()) return new BN(0)._forceRed(this);

    var t = a.mul(b);
    var c = t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);
    var u = t.isub(c).iushrn(this.shift);
    var res = u;
    if (u.cmp(this.m) >= 0) {
      res = u.isub(this.m);
    } else if (u.cmpn(0) < 0) {
      res = u.iadd(this.m);
    }

    return res._forceRed(this);
  };

  Mont.prototype.invm = function invm (a) {
    // (AR)^-1 * R^2 = (A^-1 * R^-1) * R^2 = A^-1 * R
    var res = this.imod(a._invmp(this.m).mul(this.r2));
    return res._forceRed(this);
  };
})(typeof module === 'undefined' || module, this);

},{}],341:[function(require,module,exports){
(function (Buffer){
var bn = require('bn.js');
var randomBytes = require('randombytes');
module.exports = crt;
function blind(priv) {
  var r = getr(priv);
  var blinder = r.toRed(bn.mont(priv.modulus))
  .redPow(new bn(priv.publicExponent)).fromRed();
  return {
    blinder: blinder,
    unblinder:r.invm(priv.modulus)
  };
}
function crt(msg, priv) {
  var blinds = blind(priv);
  var len = priv.modulus.byteLength();
  var mod = bn.mont(priv.modulus);
  var blinded = new bn(msg).mul(blinds.blinder).umod(priv.modulus);
  var c1 = blinded.toRed(bn.mont(priv.prime1));
  var c2 = blinded.toRed(bn.mont(priv.prime2));
  var qinv = priv.coefficient;
  var p = priv.prime1;
  var q = priv.prime2;
  var m1 = c1.redPow(priv.exponent1);
  var m2 = c2.redPow(priv.exponent2);
  m1 = m1.fromRed();
  m2 = m2.fromRed();
  var h = m1.isub(m2).imul(qinv).umod(p);
  h.imul(q);
  m2.iadd(h);
  return new Buffer(m2.imul(blinds.unblinder).umod(priv.modulus).toArray(false, len));
}
crt.getr = getr;
function getr(priv) {
  var len = priv.modulus.byteLength();
  var r = new bn(randomBytes(len));
  while (r.cmp(priv.modulus) >=  0 || !r.umod(priv.prime1) || !r.umod(priv.prime2)) {
    r = new bn(randomBytes(len));
  }
  return r;
}

}).call(this,require("buffer").Buffer)
},{"bn.js":340,"buffer":303,"randombytes":498}],342:[function(require,module,exports){
'use strict';

var elliptic = exports;

elliptic.version = require('../package.json').version;
elliptic.utils = require('./elliptic/utils');
elliptic.rand = require('brorand');
elliptic.hmacDRBG = require('./elliptic/hmac-drbg');
elliptic.curve = require('./elliptic/curve');
elliptic.curves = require('./elliptic/curves');

// Protocols
elliptic.ec = require('./elliptic/ec');
elliptic.eddsa = require('./elliptic/eddsa');

},{"../package.json":365,"./elliptic/curve":345,"./elliptic/curves":348,"./elliptic/ec":349,"./elliptic/eddsa":352,"./elliptic/hmac-drbg":355,"./elliptic/utils":357,"brorand":358}],343:[function(require,module,exports){
'use strict';

var BN = require('bn.js');
var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var getNAF = utils.getNAF;
var getJSF = utils.getJSF;
var assert = utils.assert;

function BaseCurve(type, conf) {
  this.type = type;
  this.p = new BN(conf.p, 16);

  // Use Montgomery, when there is no fast reduction for the prime
  this.red = conf.prime ? BN.red(conf.prime) : BN.mont(this.p);

  // Useful for many curves
  this.zero = new BN(0).toRed(this.red);
  this.one = new BN(1).toRed(this.red);
  this.two = new BN(2).toRed(this.red);

  // Curve configuration, optional
  this.n = conf.n && new BN(conf.n, 16);
  this.g = conf.g && this.pointFromJSON(conf.g, conf.gRed);

  // Temporary arrays
  this._wnafT1 = new Array(4);
  this._wnafT2 = new Array(4);
  this._wnafT3 = new Array(4);
  this._wnafT4 = new Array(4);
}
module.exports = BaseCurve;

BaseCurve.prototype.point = function point() {
  throw new Error('Not implemented');
};

BaseCurve.prototype.validate = function validate() {
  throw new Error('Not implemented');
};

BaseCurve.prototype._fixedNafMul = function _fixedNafMul(p, k) {
  assert(p.precomputed);
  var doubles = p._getDoubles();

  var naf = getNAF(k, 1);
  var I = (1 << (doubles.step + 1)) - (doubles.step % 2 === 0 ? 2 : 1);
  I /= 3;

  // Translate into more windowed form
  var repr = [];
  for (var j = 0; j < naf.length; j += doubles.step) {
    var nafW = 0;
    for (var k = j + doubles.step - 1; k >= j; k--)
      nafW = (nafW << 1) + naf[k];
    repr.push(nafW);
  }

  var a = this.jpoint(null, null, null);
  var b = this.jpoint(null, null, null);
  for (var i = I; i > 0; i--) {
    for (var j = 0; j < repr.length; j++) {
      var nafW = repr[j];
      if (nafW === i)
        b = b.mixedAdd(doubles.points[j]);
      else if (nafW === -i)
        b = b.mixedAdd(doubles.points[j].neg());
    }
    a = a.add(b);
  }
  return a.toP();
};

BaseCurve.prototype._wnafMul = function _wnafMul(p, k) {
  var w = 4;

  // Precompute window
  var nafPoints = p._getNAFPoints(w);
  w = nafPoints.wnd;
  var wnd = nafPoints.points;

  // Get NAF form
  var naf = getNAF(k, w);

  // Add `this`*(N+1) for every w-NAF index
  var acc = this.jpoint(null, null, null);
  for (var i = naf.length - 1; i >= 0; i--) {
    // Count zeroes
    for (var k = 0; i >= 0 && naf[i] === 0; i--)
      k++;
    if (i >= 0)
      k++;
    acc = acc.dblp(k);

    if (i < 0)
      break;
    var z = naf[i];
    assert(z !== 0);
    if (p.type === 'affine') {
      // J +- P
      if (z > 0)
        acc = acc.mixedAdd(wnd[(z - 1) >> 1]);
      else
        acc = acc.mixedAdd(wnd[(-z - 1) >> 1].neg());
    } else {
      // J +- J
      if (z > 0)
        acc = acc.add(wnd[(z - 1) >> 1]);
      else
        acc = acc.add(wnd[(-z - 1) >> 1].neg());
    }
  }
  return p.type === 'affine' ? acc.toP() : acc;
};

BaseCurve.prototype._wnafMulAdd = function _wnafMulAdd(defW,
                                                       points,
                                                       coeffs,
                                                       len) {
  var wndWidth = this._wnafT1;
  var wnd = this._wnafT2;
  var naf = this._wnafT3;

  // Fill all arrays
  var max = 0;
  for (var i = 0; i < len; i++) {
    var p = points[i];
    var nafPoints = p._getNAFPoints(defW);
    wndWidth[i] = nafPoints.wnd;
    wnd[i] = nafPoints.points;
  }

  // Comb small window NAFs
  for (var i = len - 1; i >= 1; i -= 2) {
    var a = i - 1;
    var b = i;
    if (wndWidth[a] !== 1 || wndWidth[b] !== 1) {
      naf[a] = getNAF(coeffs[a], wndWidth[a]);
      naf[b] = getNAF(coeffs[b], wndWidth[b]);
      max = Math.max(naf[a].length, max);
      max = Math.max(naf[b].length, max);
      continue;
    }

    var comb = [
      points[a], /* 1 */
      null, /* 3 */
      null, /* 5 */
      points[b] /* 7 */
    ];

    // Try to avoid Projective points, if possible
    if (points[a].y.cmp(points[b].y) === 0) {
      comb[1] = points[a].add(points[b]);
      comb[2] = points[a].toJ().mixedAdd(points[b].neg());
    } else if (points[a].y.cmp(points[b].y.redNeg()) === 0) {
      comb[1] = points[a].toJ().mixedAdd(points[b]);
      comb[2] = points[a].add(points[b].neg());
    } else {
      comb[1] = points[a].toJ().mixedAdd(points[b]);
      comb[2] = points[a].toJ().mixedAdd(points[b].neg());
    }

    var index = [
      -3, /* -1 -1 */
      -1, /* -1 0 */
      -5, /* -1 1 */
      -7, /* 0 -1 */
      0, /* 0 0 */
      7, /* 0 1 */
      5, /* 1 -1 */
      1, /* 1 0 */
      3  /* 1 1 */
    ];

    var jsf = getJSF(coeffs[a], coeffs[b]);
    max = Math.max(jsf[0].length, max);
    naf[a] = new Array(max);
    naf[b] = new Array(max);
    for (var j = 0; j < max; j++) {
      var ja = jsf[0][j] | 0;
      var jb = jsf[1][j] | 0;

      naf[a][j] = index[(ja + 1) * 3 + (jb + 1)];
      naf[b][j] = 0;
      wnd[a] = comb;
    }
  }

  var acc = this.jpoint(null, null, null);
  var tmp = this._wnafT4;
  for (var i = max; i >= 0; i--) {
    var k = 0;

    while (i >= 0) {
      var zero = true;
      for (var j = 0; j < len; j++) {
        tmp[j] = naf[j][i] | 0;
        if (tmp[j] !== 0)
          zero = false;
      }
      if (!zero)
        break;
      k++;
      i--;
    }
    if (i >= 0)
      k++;
    acc = acc.dblp(k);
    if (i < 0)
      break;

    for (var j = 0; j < len; j++) {
      var z = tmp[j];
      var p;
      if (z === 0)
        continue;
      else if (z > 0)
        p = wnd[j][(z - 1) >> 1];
      else if (z < 0)
        p = wnd[j][(-z - 1) >> 1].neg();

      if (p.type === 'affine')
        acc = acc.mixedAdd(p);
      else
        acc = acc.add(p);
    }
  }
  // Zeroify references
  for (var i = 0; i < len; i++)
    wnd[i] = null;
  return acc.toP();
};

function BasePoint(curve, type) {
  this.curve = curve;
  this.type = type;
  this.precomputed = null;
}
BaseCurve.BasePoint = BasePoint;

BasePoint.prototype.eq = function eq(/*other*/) {
  throw new Error('Not implemented');
};

BasePoint.prototype.validate = function validate() {
  return this.curve.validate(this);
};

BaseCurve.prototype.decodePoint = function decodePoint(bytes, enc) {
  bytes = utils.toArray(bytes, enc);

  var len = this.p.byteLength();
  if (bytes[0] === 0x04 && bytes.length - 1 === 2 * len) {
    return this.point(bytes.slice(1, 1 + len),
                      bytes.slice(1 + len, 1 + 2 * len));
  } else if ((bytes[0] === 0x02 || bytes[0] === 0x03) &&
              bytes.length - 1 === len) {
    return this.pointFromX(bytes.slice(1, 1 + len), bytes[0] === 0x03);
  }
  throw new Error('Unknown point format');
};

BasePoint.prototype.encodeCompressed = function encodeCompressed(enc) {
  return this.encode(enc, true);
};

BasePoint.prototype._encode = function _encode(compact) {
  var len = this.curve.p.byteLength();
  var x = this.getX().toArray('be', len);

  if (compact)
    return [ this.getY().isEven() ? 0x02 : 0x03 ].concat(x);

  return [ 0x04 ].concat(x, this.getY().toArray('be', len)) ;
};

BasePoint.prototype.encode = function encode(enc, compact) {
  return utils.encode(this._encode(compact), enc);
};

BasePoint.prototype.precompute = function precompute(power) {
  if (this.precomputed)
    return this;

  var precomputed = {
    doubles: null,
    naf: null,
    beta: null
  };
  precomputed.naf = this._getNAFPoints(8);
  precomputed.doubles = this._getDoubles(4, power);
  precomputed.beta = this._getBeta();
  this.precomputed = precomputed;

  return this;
};

BasePoint.prototype._hasDoubles = function _hasDoubles(k) {
  if (!this.precomputed)
    return false;

  var doubles = this.precomputed.doubles;
  if (!doubles)
    return false;

  return doubles.points.length >= Math.ceil((k.bitLength() + 1) / doubles.step);
};

BasePoint.prototype._getDoubles = function _getDoubles(step, power) {
  if (this.precomputed && this.precomputed.doubles)
    return this.precomputed.doubles;

  var doubles = [ this ];
  var acc = this;
  for (var i = 0; i < power; i += step) {
    for (var j = 0; j < step; j++)
      acc = acc.dbl();
    doubles.push(acc);
  }
  return {
    step: step,
    points: doubles
  };
};

BasePoint.prototype._getNAFPoints = function _getNAFPoints(wnd) {
  if (this.precomputed && this.precomputed.naf)
    return this.precomputed.naf;

  var res = [ this ];
  var max = (1 << wnd) - 1;
  var dbl = max === 1 ? null : this.dbl();
  for (var i = 1; i < max; i++)
    res[i] = res[i - 1].add(dbl);
  return {
    wnd: wnd,
    points: res
  };
};

BasePoint.prototype._getBeta = function _getBeta() {
  return null;
};

BasePoint.prototype.dblp = function dblp(k) {
  var r = this;
  for (var i = 0; i < k; i++)
    r = r.dbl();
  return r;
};

},{"../../elliptic":342,"bn.js":340}],344:[function(require,module,exports){
'use strict';

var curve = require('../curve');
var elliptic = require('../../elliptic');
var BN = require('bn.js');
var inherits = require('inherits');
var Base = curve.base;

var assert = elliptic.utils.assert;

function EdwardsCurve(conf) {
  // NOTE: Important as we are creating point in Base.call()
  this.twisted = (conf.a | 0) !== 1;
  this.mOneA = this.twisted && (conf.a | 0) === -1;
  this.extended = this.mOneA;

  Base.call(this, 'edwards', conf);

  this.a = new BN(conf.a, 16).umod(this.red.m);
  this.a = this.a.toRed(this.red);
  this.c = new BN(conf.c, 16).toRed(this.red);
  this.c2 = this.c.redSqr();
  this.d = new BN(conf.d, 16).toRed(this.red);
  this.dd = this.d.redAdd(this.d);

  assert(!this.twisted || this.c.fromRed().cmpn(1) === 0);
  this.oneC = (conf.c | 0) === 1;
}
inherits(EdwardsCurve, Base);
module.exports = EdwardsCurve;

EdwardsCurve.prototype._mulA = function _mulA(num) {
  if (this.mOneA)
    return num.redNeg();
  else
    return this.a.redMul(num);
};

EdwardsCurve.prototype._mulC = function _mulC(num) {
  if (this.oneC)
    return num;
  else
    return this.c.redMul(num);
};

// Just for compatibility with Short curve
EdwardsCurve.prototype.jpoint = function jpoint(x, y, z, t) {
  return this.point(x, y, z, t);
};

EdwardsCurve.prototype.pointFromX = function pointFromX(x, odd) {
  x = new BN(x, 16);
  if (!x.red)
    x = x.toRed(this.red);

  var x2 = x.redSqr();
  var rhs = this.c2.redSub(this.a.redMul(x2));
  var lhs = this.one.redSub(this.c2.redMul(this.d).redMul(x2));

  var y2 = rhs.redMul(lhs.redInvm());
  var y = y2.redSqrt();
  if (y.redSqr().redSub(y2).cmp(this.zero) !== 0)
    throw new Error('invalid point');

  var isOdd = y.fromRed().isOdd();
  if (odd && !isOdd || !odd && isOdd)
    y = y.redNeg();

  return this.point(x, y);
};

EdwardsCurve.prototype.pointFromY = function pointFromY(y, odd) {
  y = new BN(y, 16);
  if (!y.red)
    y = y.toRed(this.red);

  // x^2 = (y^2 - 1) / (d y^2 + 1)
  var y2 = y.redSqr();
  var lhs = y2.redSub(this.one);
  var rhs = y2.redMul(this.d).redAdd(this.one);
  var x2 = lhs.redMul(rhs.redInvm());

  if (x2.cmp(this.zero) === 0) {
    if (odd)
      throw new Error('invalid point');
    else
      return this.point(this.zero, y);
  }

  var x = x2.redSqrt();
  if (x.redSqr().redSub(x2).cmp(this.zero) !== 0)
    throw new Error('invalid point');

  if (x.isOdd() !== odd)
    x = x.redNeg();

  return this.point(x, y);
};

EdwardsCurve.prototype.validate = function validate(point) {
  if (point.isInfinity())
    return true;

  // Curve: A * X^2 + Y^2 = C^2 * (1 + D * X^2 * Y^2)
  point.normalize();

  var x2 = point.x.redSqr();
  var y2 = point.y.redSqr();
  var lhs = x2.redMul(this.a).redAdd(y2);
  var rhs = this.c2.redMul(this.one.redAdd(this.d.redMul(x2).redMul(y2)));

  return lhs.cmp(rhs) === 0;
};

function Point(curve, x, y, z, t) {
  Base.BasePoint.call(this, curve, 'projective');
  if (x === null && y === null && z === null) {
    this.x = this.curve.zero;
    this.y = this.curve.one;
    this.z = this.curve.one;
    this.t = this.curve.zero;
    this.zOne = true;
  } else {
    this.x = new BN(x, 16);
    this.y = new BN(y, 16);
    this.z = z ? new BN(z, 16) : this.curve.one;
    this.t = t && new BN(t, 16);
    if (!this.x.red)
      this.x = this.x.toRed(this.curve.red);
    if (!this.y.red)
      this.y = this.y.toRed(this.curve.red);
    if (!this.z.red)
      this.z = this.z.toRed(this.curve.red);
    if (this.t && !this.t.red)
      this.t = this.t.toRed(this.curve.red);
    this.zOne = this.z === this.curve.one;

    // Use extended coordinates
    if (this.curve.extended && !this.t) {
      this.t = this.x.redMul(this.y);
      if (!this.zOne)
        this.t = this.t.redMul(this.z.redInvm());
    }
  }
}
inherits(Point, Base.BasePoint);

EdwardsCurve.prototype.pointFromJSON = function pointFromJSON(obj) {
  return Point.fromJSON(this, obj);
};

EdwardsCurve.prototype.point = function point(x, y, z, t) {
  return new Point(this, x, y, z, t);
};

Point.fromJSON = function fromJSON(curve, obj) {
  return new Point(curve, obj[0], obj[1], obj[2]);
};

Point.prototype.inspect = function inspect() {
  if (this.isInfinity())
    return '<EC Point Infinity>';
  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +
      ' y: ' + this.y.fromRed().toString(16, 2) +
      ' z: ' + this.z.fromRed().toString(16, 2) + '>';
};

Point.prototype.isInfinity = function isInfinity() {
  // XXX This code assumes that zero is always zero in red
  return this.x.cmpn(0) === 0 &&
         this.y.cmp(this.z) === 0;
};

Point.prototype._extDbl = function _extDbl() {
  // hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html
  //     #doubling-dbl-2008-hwcd
  // 4M + 4S

  // A = X1^2
  var a = this.x.redSqr();
  // B = Y1^2
  var b = this.y.redSqr();
  // C = 2 * Z1^2
  var c = this.z.redSqr();
  c = c.redIAdd(c);
  // D = a * A
  var d = this.curve._mulA(a);
  // E = (X1 + Y1)^2 - A - B
  var e = this.x.redAdd(this.y).redSqr().redISub(a).redISub(b);
  // G = D + B
  var g = d.redAdd(b);
  // F = G - C
  var f = g.redSub(c);
  // H = D - B
  var h = d.redSub(b);
  // X3 = E * F
  var nx = e.redMul(f);
  // Y3 = G * H
  var ny = g.redMul(h);
  // T3 = E * H
  var nt = e.redMul(h);
  // Z3 = F * G
  var nz = f.redMul(g);
  return this.curve.point(nx, ny, nz, nt);
};

Point.prototype._projDbl = function _projDbl() {
  // hyperelliptic.org/EFD/g1p/auto-twisted-projective.html
  //     #doubling-dbl-2008-bbjlp
  //     #doubling-dbl-2007-bl
  // and others
  // Generally 3M + 4S or 2M + 4S

  // B = (X1 + Y1)^2
  var b = this.x.redAdd(this.y).redSqr();
  // C = X1^2
  var c = this.x.redSqr();
  // D = Y1^2
  var d = this.y.redSqr();

  var nx;
  var ny;
  var nz;
  if (this.curve.twisted) {
    // E = a * C
    var e = this.curve._mulA(c);
    // F = E + D
    var f = e.redAdd(d);
    if (this.zOne) {
      // X3 = (B - C - D) * (F - 2)
      nx = b.redSub(c).redSub(d).redMul(f.redSub(this.curve.two));
      // Y3 = F * (E - D)
      ny = f.redMul(e.redSub(d));
      // Z3 = F^2 - 2 * F
      nz = f.redSqr().redSub(f).redSub(f);
    } else {
      // H = Z1^2
      var h = this.z.redSqr();
      // J = F - 2 * H
      var j = f.redSub(h).redISub(h);
      // X3 = (B-C-D)*J
      nx = b.redSub(c).redISub(d).redMul(j);
      // Y3 = F * (E - D)
      ny = f.redMul(e.redSub(d));
      // Z3 = F * J
      nz = f.redMul(j);
    }
  } else {
    // E = C + D
    var e = c.redAdd(d);
    // H = (c * Z1)^2
    var h = this.curve._mulC(this.c.redMul(this.z)).redSqr();
    // J = E - 2 * H
    var j = e.redSub(h).redSub(h);
    // X3 = c * (B - E) * J
    nx = this.curve._mulC(b.redISub(e)).redMul(j);
    // Y3 = c * E * (C - D)
    ny = this.curve._mulC(e).redMul(c.redISub(d));
    // Z3 = E * J
    nz = e.redMul(j);
  }
  return this.curve.point(nx, ny, nz);
};

Point.prototype.dbl = function dbl() {
  if (this.isInfinity())
    return this;

  // Double in extended coordinates
  if (this.curve.extended)
    return this._extDbl();
  else
    return this._projDbl();
};

Point.prototype._extAdd = function _extAdd(p) {
  // hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html
  //     #addition-add-2008-hwcd-3
  // 8M

  // A = (Y1 - X1) * (Y2 - X2)
  var a = this.y.redSub(this.x).redMul(p.y.redSub(p.x));
  // B = (Y1 + X1) * (Y2 + X2)
  var b = this.y.redAdd(this.x).redMul(p.y.redAdd(p.x));
  // C = T1 * k * T2
  var c = this.t.redMul(this.curve.dd).redMul(p.t);
  // D = Z1 * 2 * Z2
  var d = this.z.redMul(p.z.redAdd(p.z));
  // E = B - A
  var e = b.redSub(a);
  // F = D - C
  var f = d.redSub(c);
  // G = D + C
  var g = d.redAdd(c);
  // H = B + A
  var h = b.redAdd(a);
  // X3 = E * F
  var nx = e.redMul(f);
  // Y3 = G * H
  var ny = g.redMul(h);
  // T3 = E * H
  var nt = e.redMul(h);
  // Z3 = F * G
  var nz = f.redMul(g);
  return this.curve.point(nx, ny, nz, nt);
};

Point.prototype._projAdd = function _projAdd(p) {
  // hyperelliptic.org/EFD/g1p/auto-twisted-projective.html
  //     #addition-add-2008-bbjlp
  //     #addition-add-2007-bl
  // 10M + 1S

  // A = Z1 * Z2
  var a = this.z.redMul(p.z);
  // B = A^2
  var b = a.redSqr();
  // C = X1 * X2
  var c = this.x.redMul(p.x);
  // D = Y1 * Y2
  var d = this.y.redMul(p.y);
  // E = d * C * D
  var e = this.curve.d.redMul(c).redMul(d);
  // F = B - E
  var f = b.redSub(e);
  // G = B + E
  var g = b.redAdd(e);
  // X3 = A * F * ((X1 + Y1) * (X2 + Y2) - C - D)
  var tmp = this.x.redAdd(this.y).redMul(p.x.redAdd(p.y)).redISub(c).redISub(d);
  var nx = a.redMul(f).redMul(tmp);
  var ny;
  var nz;
  if (this.curve.twisted) {
    // Y3 = A * G * (D - a * C)
    ny = a.redMul(g).redMul(d.redSub(this.curve._mulA(c)));
    // Z3 = F * G
    nz = f.redMul(g);
  } else {
    // Y3 = A * G * (D - C)
    ny = a.redMul(g).redMul(d.redSub(c));
    // Z3 = c * F * G
    nz = this.curve._mulC(f).redMul(g);
  }
  return this.curve.point(nx, ny, nz);
};

Point.prototype.add = function add(p) {
  if (this.isInfinity())
    return p;
  if (p.isInfinity())
    return this;

  if (this.curve.extended)
    return this._extAdd(p);
  else
    return this._projAdd(p);
};

Point.prototype.mul = function mul(k) {
  if (this._hasDoubles(k))
    return this.curve._fixedNafMul(this, k);
  else
    return this.curve._wnafMul(this, k);
};

Point.prototype.mulAdd = function mulAdd(k1, p, k2) {
  return this.curve._wnafMulAdd(1, [ this, p ], [ k1, k2 ], 2);
};

Point.prototype.normalize = function normalize() {
  if (this.zOne)
    return this;

  // Normalize coordinates
  var zi = this.z.redInvm();
  this.x = this.x.redMul(zi);
  this.y = this.y.redMul(zi);
  if (this.t)
    this.t = this.t.redMul(zi);
  this.z = this.curve.one;
  this.zOne = true;
  return this;
};

Point.prototype.neg = function neg() {
  return this.curve.point(this.x.redNeg(),
                          this.y,
                          this.z,
                          this.t && this.t.redNeg());
};

Point.prototype.getX = function getX() {
  this.normalize();
  return this.x.fromRed();
};

Point.prototype.getY = function getY() {
  this.normalize();
  return this.y.fromRed();
};

Point.prototype.eq = function eq(other) {
  return this === other ||
         this.getX().cmp(other.getX()) === 0 &&
         this.getY().cmp(other.getY()) === 0;
};

// Compatibility with BaseCurve
Point.prototype.toP = Point.prototype.normalize;
Point.prototype.mixedAdd = Point.prototype.add;

},{"../../elliptic":342,"../curve":345,"bn.js":340,"inherits":500}],345:[function(require,module,exports){
'use strict';

var curve = exports;

curve.base = require('./base');
curve.short = require('./short');
curve.mont = require('./mont');
curve.edwards = require('./edwards');

},{"./base":343,"./edwards":344,"./mont":346,"./short":347}],346:[function(require,module,exports){
'use strict';

var curve = require('../curve');
var BN = require('bn.js');
var inherits = require('inherits');
var Base = curve.base;

var elliptic = require('../../elliptic');
var utils = elliptic.utils;

function MontCurve(conf) {
  Base.call(this, 'mont', conf);

  this.a = new BN(conf.a, 16).toRed(this.red);
  this.b = new BN(conf.b, 16).toRed(this.red);
  this.i4 = new BN(4).toRed(this.red).redInvm();
  this.two = new BN(2).toRed(this.red);
  this.a24 = this.i4.redMul(this.a.redAdd(this.two));
}
inherits(MontCurve, Base);
module.exports = MontCurve;

MontCurve.prototype.validate = function validate(point) {
  var x = point.normalize().x;
  var x2 = x.redSqr();
  var rhs = x2.redMul(x).redAdd(x2.redMul(this.a)).redAdd(x);
  var y = rhs.redSqrt();

  return y.redSqr().cmp(rhs) === 0;
};

function Point(curve, x, z) {
  Base.BasePoint.call(this, curve, 'projective');
  if (x === null && z === null) {
    this.x = this.curve.one;
    this.z = this.curve.zero;
  } else {
    this.x = new BN(x, 16);
    this.z = new BN(z, 16);
    if (!this.x.red)
      this.x = this.x.toRed(this.curve.red);
    if (!this.z.red)
      this.z = this.z.toRed(this.curve.red);
  }
}
inherits(Point, Base.BasePoint);

MontCurve.prototype.decodePoint = function decodePoint(bytes, enc) {
  return this.point(utils.toArray(bytes, enc), 1);
};

MontCurve.prototype.point = function point(x, z) {
  return new Point(this, x, z);
};

MontCurve.prototype.pointFromJSON = function pointFromJSON(obj) {
  return Point.fromJSON(this, obj);
};

Point.prototype.precompute = function precompute() {
  // No-op
};

Point.prototype._encode = function _encode() {
  return this.getX().toArray('be', this.curve.p.byteLength());
};

Point.fromJSON = function fromJSON(curve, obj) {
  return new Point(curve, obj[0], obj[1] || curve.one);
};

Point.prototype.inspect = function inspect() {
  if (this.isInfinity())
    return '<EC Point Infinity>';
  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +
      ' z: ' + this.z.fromRed().toString(16, 2) + '>';
};

Point.prototype.isInfinity = function isInfinity() {
  // XXX This code assumes that zero is always zero in red
  return this.z.cmpn(0) === 0;
};

Point.prototype.dbl = function dbl() {
  // http://hyperelliptic.org/EFD/g1p/auto-montgom-xz.html#doubling-dbl-1987-m-3
  // 2M + 2S + 4A

  // A = X1 + Z1
  var a = this.x.redAdd(this.z);
  // AA = A^2
  var aa = a.redSqr();
  // B = X1 - Z1
  var b = this.x.redSub(this.z);
  // BB = B^2
  var bb = b.redSqr();
  // C = AA - BB
  var c = aa.redSub(bb);
  // X3 = AA * BB
  var nx = aa.redMul(bb);
  // Z3 = C * (BB + A24 * C)
  var nz = c.redMul(bb.redAdd(this.curve.a24.redMul(c)));
  return this.curve.point(nx, nz);
};

Point.prototype.add = function add() {
  throw new Error('Not supported on Montgomery curve');
};

Point.prototype.diffAdd = function diffAdd(p, diff) {
  // http://hyperelliptic.org/EFD/g1p/auto-montgom-xz.html#diffadd-dadd-1987-m-3
  // 4M + 2S + 6A

  // A = X2 + Z2
  var a = this.x.redAdd(this.z);
  // B = X2 - Z2
  var b = this.x.redSub(this.z);
  // C = X3 + Z3
  var c = p.x.redAdd(p.z);
  // D = X3 - Z3
  var d = p.x.redSub(p.z);
  // DA = D * A
  var da = d.redMul(a);
  // CB = C * B
  var cb = c.redMul(b);
  // X5 = Z1 * (DA + CB)^2
  var nx = diff.z.redMul(da.redAdd(cb).redSqr());
  // Z5 = X1 * (DA - CB)^2
  var nz = diff.x.redMul(da.redISub(cb).redSqr());
  return this.curve.point(nx, nz);
};

Point.prototype.mul = function mul(k) {
  var t = k.clone();
  var a = this; // (N / 2) * Q + Q
  var b = this.curve.point(null, null); // (N / 2) * Q
  var c = this; // Q

  for (var bits = []; t.cmpn(0) !== 0; t.iushrn(1))
    bits.push(t.andln(1));

  for (var i = bits.length - 1; i >= 0; i--) {
    if (bits[i] === 0) {
      // N * Q + Q = ((N / 2) * Q + Q)) + (N / 2) * Q
      a = a.diffAdd(b, c);
      // N * Q = 2 * ((N / 2) * Q + Q))
      b = b.dbl();
    } else {
      // N * Q = ((N / 2) * Q + Q) + ((N / 2) * Q)
      b = a.diffAdd(b, c);
      // N * Q + Q = 2 * ((N / 2) * Q + Q)
      a = a.dbl();
    }
  }
  return b;
};

Point.prototype.mulAdd = function mulAdd() {
  throw new Error('Not supported on Montgomery curve');
};

Point.prototype.eq = function eq(other) {
  return this.getX().cmp(other.getX()) === 0;
};

Point.prototype.normalize = function normalize() {
  this.x = this.x.redMul(this.z.redInvm());
  this.z = this.curve.one;
  return this;
};

Point.prototype.getX = function getX() {
  // Normalize coordinates
  this.normalize();

  return this.x.fromRed();
};

},{"../../elliptic":342,"../curve":345,"bn.js":340,"inherits":500}],347:[function(require,module,exports){
'use strict';

var curve = require('../curve');
var elliptic = require('../../elliptic');
var BN = require('bn.js');
var inherits = require('inherits');
var Base = curve.base;

var assert = elliptic.utils.assert;

function ShortCurve(conf) {
  Base.call(this, 'short', conf);

  this.a = new BN(conf.a, 16).toRed(this.red);
  this.b = new BN(conf.b, 16).toRed(this.red);
  this.tinv = this.two.redInvm();

  this.zeroA = this.a.fromRed().cmpn(0) === 0;
  this.threeA = this.a.fromRed().sub(this.p).cmpn(-3) === 0;

  // If the curve is endomorphic, precalculate beta and lambda
  this.endo = this._getEndomorphism(conf);
  this._endoWnafT1 = new Array(4);
  this._endoWnafT2 = new Array(4);
}
inherits(ShortCurve, Base);
module.exports = ShortCurve;

ShortCurve.prototype._getEndomorphism = function _getEndomorphism(conf) {
  // No efficient endomorphism
  if (!this.zeroA || !this.g || !this.n || this.p.modn(3) !== 1)
    return;

  // Compute beta and lambda, that lambda * P = (beta * Px; Py)
  var beta;
  var lambda;
  if (conf.beta) {
    beta = new BN(conf.beta, 16).toRed(this.red);
  } else {
    var betas = this._getEndoRoots(this.p);
    // Choose the smallest beta
    beta = betas[0].cmp(betas[1]) < 0 ? betas[0] : betas[1];
    beta = beta.toRed(this.red);
  }
  if (conf.lambda) {
    lambda = new BN(conf.lambda, 16);
  } else {
    // Choose the lambda that is matching selected beta
    var lambdas = this._getEndoRoots(this.n);
    if (this.g.mul(lambdas[0]).x.cmp(this.g.x.redMul(beta)) === 0) {
      lambda = lambdas[0];
    } else {
      lambda = lambdas[1];
      assert(this.g.mul(lambda).x.cmp(this.g.x.redMul(beta)) === 0);
    }
  }

  // Get basis vectors, used for balanced length-two representation
  var basis;
  if (conf.basis) {
    basis = conf.basis.map(function(vec) {
      return {
        a: new BN(vec.a, 16),
        b: new BN(vec.b, 16)
      };
    });
  } else {
    basis = this._getEndoBasis(lambda);
  }

  return {
    beta: beta,
    lambda: lambda,
    basis: basis
  };
};

ShortCurve.prototype._getEndoRoots = function _getEndoRoots(num) {
  // Find roots of for x^2 + x + 1 in F
  // Root = (-1 +- Sqrt(-3)) / 2
  //
  var red = num === this.p ? this.red : BN.mont(num);
  var tinv = new BN(2).toRed(red).redInvm();
  var ntinv = tinv.redNeg();

  var s = new BN(3).toRed(red).redNeg().redSqrt().redMul(tinv);

  var l1 = ntinv.redAdd(s).fromRed();
  var l2 = ntinv.redSub(s).fromRed();
  return [ l1, l2 ];
};

ShortCurve.prototype._getEndoBasis = function _getEndoBasis(lambda) {
  // aprxSqrt >= sqrt(this.n)
  var aprxSqrt = this.n.ushrn(Math.floor(this.n.bitLength() / 2));

  // 3.74
  // Run EGCD, until r(L + 1) < aprxSqrt
  var u = lambda;
  var v = this.n.clone();
  var x1 = new BN(1);
  var y1 = new BN(0);
  var x2 = new BN(0);
  var y2 = new BN(1);

  // NOTE: all vectors are roots of: a + b * lambda = 0 (mod n)
  var a0;
  var b0;
  // First vector
  var a1;
  var b1;
  // Second vector
  var a2;
  var b2;

  var prevR;
  var i = 0;
  var r;
  var x;
  while (u.cmpn(0) !== 0) {
    var q = v.div(u);
    r = v.sub(q.mul(u));
    x = x2.sub(q.mul(x1));
    var y = y2.sub(q.mul(y1));

    if (!a1 && r.cmp(aprxSqrt) < 0) {
      a0 = prevR.neg();
      b0 = x1;
      a1 = r.neg();
      b1 = x;
    } else if (a1 && ++i === 2) {
      break;
    }
    prevR = r;

    v = u;
    u = r;
    x2 = x1;
    x1 = x;
    y2 = y1;
    y1 = y;
  }
  a2 = r.neg();
  b2 = x;

  var len1 = a1.sqr().add(b1.sqr());
  var len2 = a2.sqr().add(b2.sqr());
  if (len2.cmp(len1) >= 0) {
    a2 = a0;
    b2 = b0;
  }

  // Normalize signs
  if (a1.negative) {
    a1 = a1.neg();
    b1 = b1.neg();
  }
  if (a2.negative) {
    a2 = a2.neg();
    b2 = b2.neg();
  }

  return [
    { a: a1, b: b1 },
    { a: a2, b: b2 }
  ];
};

ShortCurve.prototype._endoSplit = function _endoSplit(k) {
  var basis = this.endo.basis;
  var v1 = basis[0];
  var v2 = basis[1];

  var c1 = v2.b.mul(k).divRound(this.n);
  var c2 = v1.b.neg().mul(k).divRound(this.n);

  var p1 = c1.mul(v1.a);
  var p2 = c2.mul(v2.a);
  var q1 = c1.mul(v1.b);
  var q2 = c2.mul(v2.b);

  // Calculate answer
  var k1 = k.sub(p1).sub(p2);
  var k2 = q1.add(q2).neg();
  return { k1: k1, k2: k2 };
};

ShortCurve.prototype.pointFromX = function pointFromX(x, odd) {
  x = new BN(x, 16);
  if (!x.red)
    x = x.toRed(this.red);

  var y2 = x.redSqr().redMul(x).redIAdd(x.redMul(this.a)).redIAdd(this.b);
  var y = y2.redSqrt();
  if (y.redSqr().redSub(y2).cmp(this.zero) !== 0)
    throw new Error('invalid point');

  // XXX Is there any way to tell if the number is odd without converting it
  // to non-red form?
  var isOdd = y.fromRed().isOdd();
  if (odd && !isOdd || !odd && isOdd)
    y = y.redNeg();

  return this.point(x, y);
};

ShortCurve.prototype.validate = function validate(point) {
  if (point.inf)
    return true;

  var x = point.x;
  var y = point.y;

  var ax = this.a.redMul(x);
  var rhs = x.redSqr().redMul(x).redIAdd(ax).redIAdd(this.b);
  return y.redSqr().redISub(rhs).cmpn(0) === 0;
};

ShortCurve.prototype._endoWnafMulAdd =
    function _endoWnafMulAdd(points, coeffs) {
  var npoints = this._endoWnafT1;
  var ncoeffs = this._endoWnafT2;
  for (var i = 0; i < points.length; i++) {
    var split = this._endoSplit(coeffs[i]);
    var p = points[i];
    var beta = p._getBeta();

    if (split.k1.negative) {
      split.k1.ineg();
      p = p.neg(true);
    }
    if (split.k2.negative) {
      split.k2.ineg();
      beta = beta.neg(true);
    }

    npoints[i * 2] = p;
    npoints[i * 2 + 1] = beta;
    ncoeffs[i * 2] = split.k1;
    ncoeffs[i * 2 + 1] = split.k2;
  }
  var res = this._wnafMulAdd(1, npoints, ncoeffs, i * 2);

  // Clean-up references to points and coefficients
  for (var j = 0; j < i * 2; j++) {
    npoints[j] = null;
    ncoeffs[j] = null;
  }
  return res;
};

function Point(curve, x, y, isRed) {
  Base.BasePoint.call(this, curve, 'affine');
  if (x === null && y === null) {
    this.x = null;
    this.y = null;
    this.inf = true;
  } else {
    this.x = new BN(x, 16);
    this.y = new BN(y, 16);
    // Force redgomery representation when loading from JSON
    if (isRed) {
      this.x.forceRed(this.curve.red);
      this.y.forceRed(this.curve.red);
    }
    if (!this.x.red)
      this.x = this.x.toRed(this.curve.red);
    if (!this.y.red)
      this.y = this.y.toRed(this.curve.red);
    this.inf = false;
  }
}
inherits(Point, Base.BasePoint);

ShortCurve.prototype.point = function point(x, y, isRed) {
  return new Point(this, x, y, isRed);
};

ShortCurve.prototype.pointFromJSON = function pointFromJSON(obj, red) {
  return Point.fromJSON(this, obj, red);
};

Point.prototype._getBeta = function _getBeta() {
  if (!this.curve.endo)
    return;

  var pre = this.precomputed;
  if (pre && pre.beta)
    return pre.beta;

  var beta = this.curve.point(this.x.redMul(this.curve.endo.beta), this.y);
  if (pre) {
    var curve = this.curve;
    var endoMul = function(p) {
      return curve.point(p.x.redMul(curve.endo.beta), p.y);
    };
    pre.beta = beta;
    beta.precomputed = {
      beta: null,
      naf: pre.naf && {
        wnd: pre.naf.wnd,
        points: pre.naf.points.map(endoMul)
      },
      doubles: pre.doubles && {
        step: pre.doubles.step,
        points: pre.doubles.points.map(endoMul)
      }
    };
  }
  return beta;
};

Point.prototype.toJSON = function toJSON() {
  if (!this.precomputed)
    return [ this.x, this.y ];

  return [ this.x, this.y, this.precomputed && {
    doubles: this.precomputed.doubles && {
      step: this.precomputed.doubles.step,
      points: this.precomputed.doubles.points.slice(1)
    },
    naf: this.precomputed.naf && {
      wnd: this.precomputed.naf.wnd,
      points: this.precomputed.naf.points.slice(1)
    }
  } ];
};

Point.fromJSON = function fromJSON(curve, obj, red) {
  if (typeof obj === 'string')
    obj = JSON.parse(obj);
  var res = curve.point(obj[0], obj[1], red);
  if (!obj[2])
    return res;

  function obj2point(obj) {
    return curve.point(obj[0], obj[1], red);
  }

  var pre = obj[2];
  res.precomputed = {
    beta: null,
    doubles: pre.doubles && {
      step: pre.doubles.step,
      points: [ res ].concat(pre.doubles.points.map(obj2point))
    },
    naf: pre.naf && {
      wnd: pre.naf.wnd,
      points: [ res ].concat(pre.naf.points.map(obj2point))
    }
  };
  return res;
};

Point.prototype.inspect = function inspect() {
  if (this.isInfinity())
    return '<EC Point Infinity>';
  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +
      ' y: ' + this.y.fromRed().toString(16, 2) + '>';
};

Point.prototype.isInfinity = function isInfinity() {
  return this.inf;
};

Point.prototype.add = function add(p) {
  // O + P = P
  if (this.inf)
    return p;

  // P + O = P
  if (p.inf)
    return this;

  // P + P = 2P
  if (this.eq(p))
    return this.dbl();

  // P + (-P) = O
  if (this.neg().eq(p))
    return this.curve.point(null, null);

  // P + Q = O
  if (this.x.cmp(p.x) === 0)
    return this.curve.point(null, null);

  var c = this.y.redSub(p.y);
  if (c.cmpn(0) !== 0)
    c = c.redMul(this.x.redSub(p.x).redInvm());
  var nx = c.redSqr().redISub(this.x).redISub(p.x);
  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);
  return this.curve.point(nx, ny);
};

Point.prototype.dbl = function dbl() {
  if (this.inf)
    return this;

  // 2P = O
  var ys1 = this.y.redAdd(this.y);
  if (ys1.cmpn(0) === 0)
    return this.curve.point(null, null);

  var a = this.curve.a;

  var x2 = this.x.redSqr();
  var dyinv = ys1.redInvm();
  var c = x2.redAdd(x2).redIAdd(x2).redIAdd(a).redMul(dyinv);

  var nx = c.redSqr().redISub(this.x.redAdd(this.x));
  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);
  return this.curve.point(nx, ny);
};

Point.prototype.getX = function getX() {
  return this.x.fromRed();
};

Point.prototype.getY = function getY() {
  return this.y.fromRed();
};

Point.prototype.mul = function mul(k) {
  k = new BN(k, 16);

  if (this._hasDoubles(k))
    return this.curve._fixedNafMul(this, k);
  else if (this.curve.endo)
    return this.curve._endoWnafMulAdd([ this ], [ k ]);
  else
    return this.curve._wnafMul(this, k);
};

Point.prototype.mulAdd = function mulAdd(k1, p2, k2) {
  var points = [ this, p2 ];
  var coeffs = [ k1, k2 ];
  if (this.curve.endo)
    return this.curve._endoWnafMulAdd(points, coeffs);
  else
    return this.curve._wnafMulAdd(1, points, coeffs, 2);
};

Point.prototype.eq = function eq(p) {
  return this === p ||
         this.inf === p.inf &&
             (this.inf || this.x.cmp(p.x) === 0 && this.y.cmp(p.y) === 0);
};

Point.prototype.neg = function neg(_precompute) {
  if (this.inf)
    return this;

  var res = this.curve.point(this.x, this.y.redNeg());
  if (_precompute && this.precomputed) {
    var pre = this.precomputed;
    var negate = function(p) {
      return p.neg();
    };
    res.precomputed = {
      naf: pre.naf && {
        wnd: pre.naf.wnd,
        points: pre.naf.points.map(negate)
      },
      doubles: pre.doubles && {
        step: pre.doubles.step,
        points: pre.doubles.points.map(negate)
      }
    };
  }
  return res;
};

Point.prototype.toJ = function toJ() {
  if (this.inf)
    return this.curve.jpoint(null, null, null);

  var res = this.curve.jpoint(this.x, this.y, this.curve.one);
  return res;
};

function JPoint(curve, x, y, z) {
  Base.BasePoint.call(this, curve, 'jacobian');
  if (x === null && y === null && z === null) {
    this.x = this.curve.one;
    this.y = this.curve.one;
    this.z = new BN(0);
  } else {
    this.x = new BN(x, 16);
    this.y = new BN(y, 16);
    this.z = new BN(z, 16);
  }
  if (!this.x.red)
    this.x = this.x.toRed(this.curve.red);
  if (!this.y.red)
    this.y = this.y.toRed(this.curve.red);
  if (!this.z.red)
    this.z = this.z.toRed(this.curve.red);

  this.zOne = this.z === this.curve.one;
}
inherits(JPoint, Base.BasePoint);

ShortCurve.prototype.jpoint = function jpoint(x, y, z) {
  return new JPoint(this, x, y, z);
};

JPoint.prototype.toP = function toP() {
  if (this.isInfinity())
    return this.curve.point(null, null);

  var zinv = this.z.redInvm();
  var zinv2 = zinv.redSqr();
  var ax = this.x.redMul(zinv2);
  var ay = this.y.redMul(zinv2).redMul(zinv);

  return this.curve.point(ax, ay);
};

JPoint.prototype.neg = function neg() {
  return this.curve.jpoint(this.x, this.y.redNeg(), this.z);
};

JPoint.prototype.add = function add(p) {
  // O + P = P
  if (this.isInfinity())
    return p;

  // P + O = P
  if (p.isInfinity())
    return this;

  // 12M + 4S + 7A
  var pz2 = p.z.redSqr();
  var z2 = this.z.redSqr();
  var u1 = this.x.redMul(pz2);
  var u2 = p.x.redMul(z2);
  var s1 = this.y.redMul(pz2.redMul(p.z));
  var s2 = p.y.redMul(z2.redMul(this.z));

  var h = u1.redSub(u2);
  var r = s1.redSub(s2);
  if (h.cmpn(0) === 0) {
    if (r.cmpn(0) !== 0)
      return this.curve.jpoint(null, null, null);
    else
      return this.dbl();
  }

  var h2 = h.redSqr();
  var h3 = h2.redMul(h);
  var v = u1.redMul(h2);

  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);
  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));
  var nz = this.z.redMul(p.z).redMul(h);

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype.mixedAdd = function mixedAdd(p) {
  // O + P = P
  if (this.isInfinity())
    return p.toJ();

  // P + O = P
  if (p.isInfinity())
    return this;

  // 8M + 3S + 7A
  var z2 = this.z.redSqr();
  var u1 = this.x;
  var u2 = p.x.redMul(z2);
  var s1 = this.y;
  var s2 = p.y.redMul(z2).redMul(this.z);

  var h = u1.redSub(u2);
  var r = s1.redSub(s2);
  if (h.cmpn(0) === 0) {
    if (r.cmpn(0) !== 0)
      return this.curve.jpoint(null, null, null);
    else
      return this.dbl();
  }

  var h2 = h.redSqr();
  var h3 = h2.redMul(h);
  var v = u1.redMul(h2);

  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);
  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));
  var nz = this.z.redMul(h);

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype.dblp = function dblp(pow) {
  if (pow === 0)
    return this;
  if (this.isInfinity())
    return this;
  if (!pow)
    return this.dbl();

  if (this.curve.zeroA || this.curve.threeA) {
    var r = this;
    for (var i = 0; i < pow; i++)
      r = r.dbl();
    return r;
  }

  // 1M + 2S + 1A + N * (4S + 5M + 8A)
  // N = 1 => 6M + 6S + 9A
  var a = this.curve.a;
  var tinv = this.curve.tinv;

  var jx = this.x;
  var jy = this.y;
  var jz = this.z;
  var jz4 = jz.redSqr().redSqr();

  // Reuse results
  var jyd = jy.redAdd(jy);
  for (var i = 0; i < pow; i++) {
    var jx2 = jx.redSqr();
    var jyd2 = jyd.redSqr();
    var jyd4 = jyd2.redSqr();
    var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));

    var t1 = jx.redMul(jyd2);
    var nx = c.redSqr().redISub(t1.redAdd(t1));
    var t2 = t1.redISub(nx);
    var dny = c.redMul(t2);
    dny = dny.redIAdd(dny).redISub(jyd4);
    var nz = jyd.redMul(jz);
    if (i + 1 < pow)
      jz4 = jz4.redMul(jyd4);

    jx = nx;
    jz = nz;
    jyd = dny;
  }

  return this.curve.jpoint(jx, jyd.redMul(tinv), jz);
};

JPoint.prototype.dbl = function dbl() {
  if (this.isInfinity())
    return this;

  if (this.curve.zeroA)
    return this._zeroDbl();
  else if (this.curve.threeA)
    return this._threeDbl();
  else
    return this._dbl();
};

JPoint.prototype._zeroDbl = function _zeroDbl() {
  var nx;
  var ny;
  var nz;
  // Z = 1
  if (this.zOne) {
    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html
    //     #doubling-mdbl-2007-bl
    // 1M + 5S + 14A

    // XX = X1^2
    var xx = this.x.redSqr();
    // YY = Y1^2
    var yy = this.y.redSqr();
    // YYYY = YY^2
    var yyyy = yy.redSqr();
    // S = 2 * ((X1 + YY)^2 - XX - YYYY)
    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);
    s = s.redIAdd(s);
    // M = 3 * XX + a; a = 0
    var m = xx.redAdd(xx).redIAdd(xx);
    // T = M ^ 2 - 2*S
    var t = m.redSqr().redISub(s).redISub(s);

    // 8 * YYYY
    var yyyy8 = yyyy.redIAdd(yyyy);
    yyyy8 = yyyy8.redIAdd(yyyy8);
    yyyy8 = yyyy8.redIAdd(yyyy8);

    // X3 = T
    nx = t;
    // Y3 = M * (S - T) - 8 * YYYY
    ny = m.redMul(s.redISub(t)).redISub(yyyy8);
    // Z3 = 2*Y1
    nz = this.y.redAdd(this.y);
  } else {
    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html
    //     #doubling-dbl-2009-l
    // 2M + 5S + 13A

    // A = X1^2
    var a = this.x.redSqr();
    // B = Y1^2
    var b = this.y.redSqr();
    // C = B^2
    var c = b.redSqr();
    // D = 2 * ((X1 + B)^2 - A - C)
    var d = this.x.redAdd(b).redSqr().redISub(a).redISub(c);
    d = d.redIAdd(d);
    // E = 3 * A
    var e = a.redAdd(a).redIAdd(a);
    // F = E^2
    var f = e.redSqr();

    // 8 * C
    var c8 = c.redIAdd(c);
    c8 = c8.redIAdd(c8);
    c8 = c8.redIAdd(c8);

    // X3 = F - 2 * D
    nx = f.redISub(d).redISub(d);
    // Y3 = E * (D - X3) - 8 * C
    ny = e.redMul(d.redISub(nx)).redISub(c8);
    // Z3 = 2 * Y1 * Z1
    nz = this.y.redMul(this.z);
    nz = nz.redIAdd(nz);
  }

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype._threeDbl = function _threeDbl() {
  var nx;
  var ny;
  var nz;
  // Z = 1
  if (this.zOne) {
    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html
    //     #doubling-mdbl-2007-bl
    // 1M + 5S + 15A

    // XX = X1^2
    var xx = this.x.redSqr();
    // YY = Y1^2
    var yy = this.y.redSqr();
    // YYYY = YY^2
    var yyyy = yy.redSqr();
    // S = 2 * ((X1 + YY)^2 - XX - YYYY)
    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);
    s = s.redIAdd(s);
    // M = 3 * XX + a
    var m = xx.redAdd(xx).redIAdd(xx).redIAdd(this.curve.a);
    // T = M^2 - 2 * S
    var t = m.redSqr().redISub(s).redISub(s);
    // X3 = T
    nx = t;
    // Y3 = M * (S - T) - 8 * YYYY
    var yyyy8 = yyyy.redIAdd(yyyy);
    yyyy8 = yyyy8.redIAdd(yyyy8);
    yyyy8 = yyyy8.redIAdd(yyyy8);
    ny = m.redMul(s.redISub(t)).redISub(yyyy8);
    // Z3 = 2 * Y1
    nz = this.y.redAdd(this.y);
  } else {
    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html#doubling-dbl-2001-b
    // 3M + 5S

    // delta = Z1^2
    var delta = this.z.redSqr();
    // gamma = Y1^2
    var gamma = this.y.redSqr();
    // beta = X1 * gamma
    var beta = this.x.redMul(gamma);
    // alpha = 3 * (X1 - delta) * (X1 + delta)
    var alpha = this.x.redSub(delta).redMul(this.x.redAdd(delta));
    alpha = alpha.redAdd(alpha).redIAdd(alpha);
    // X3 = alpha^2 - 8 * beta
    var beta4 = beta.redIAdd(beta);
    beta4 = beta4.redIAdd(beta4);
    var beta8 = beta4.redAdd(beta4);
    nx = alpha.redSqr().redISub(beta8);
    // Z3 = (Y1 + Z1)^2 - gamma - delta
    nz = this.y.redAdd(this.z).redSqr().redISub(gamma).redISub(delta);
    // Y3 = alpha * (4 * beta - X3) - 8 * gamma^2
    var ggamma8 = gamma.redSqr();
    ggamma8 = ggamma8.redIAdd(ggamma8);
    ggamma8 = ggamma8.redIAdd(ggamma8);
    ggamma8 = ggamma8.redIAdd(ggamma8);
    ny = alpha.redMul(beta4.redISub(nx)).redISub(ggamma8);
  }

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype._dbl = function _dbl() {
  var a = this.curve.a;

  // 4M + 6S + 10A
  var jx = this.x;
  var jy = this.y;
  var jz = this.z;
  var jz4 = jz.redSqr().redSqr();

  var jx2 = jx.redSqr();
  var jy2 = jy.redSqr();

  var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));

  var jxd4 = jx.redAdd(jx);
  jxd4 = jxd4.redIAdd(jxd4);
  var t1 = jxd4.redMul(jy2);
  var nx = c.redSqr().redISub(t1.redAdd(t1));
  var t2 = t1.redISub(nx);

  var jyd8 = jy2.redSqr();
  jyd8 = jyd8.redIAdd(jyd8);
  jyd8 = jyd8.redIAdd(jyd8);
  jyd8 = jyd8.redIAdd(jyd8);
  var ny = c.redMul(t2).redISub(jyd8);
  var nz = jy.redAdd(jy).redMul(jz);

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype.trpl = function trpl() {
  if (!this.curve.zeroA)
    return this.dbl().add(this);

  // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#tripling-tpl-2007-bl
  // 5M + 10S + ...

  // XX = X1^2
  var xx = this.x.redSqr();
  // YY = Y1^2
  var yy = this.y.redSqr();
  // ZZ = Z1^2
  var zz = this.z.redSqr();
  // YYYY = YY^2
  var yyyy = yy.redSqr();
  // M = 3 * XX + a * ZZ2; a = 0
  var m = xx.redAdd(xx).redIAdd(xx);
  // MM = M^2
  var mm = m.redSqr();
  // E = 6 * ((X1 + YY)^2 - XX - YYYY) - MM
  var e = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);
  e = e.redIAdd(e);
  e = e.redAdd(e).redIAdd(e);
  e = e.redISub(mm);
  // EE = E^2
  var ee = e.redSqr();
  // T = 16*YYYY
  var t = yyyy.redIAdd(yyyy);
  t = t.redIAdd(t);
  t = t.redIAdd(t);
  t = t.redIAdd(t);
  // U = (M + E)^2 - MM - EE - T
  var u = m.redIAdd(e).redSqr().redISub(mm).redISub(ee).redISub(t);
  // X3 = 4 * (X1 * EE - 4 * YY * U)
  var yyu4 = yy.redMul(u);
  yyu4 = yyu4.redIAdd(yyu4);
  yyu4 = yyu4.redIAdd(yyu4);
  var nx = this.x.redMul(ee).redISub(yyu4);
  nx = nx.redIAdd(nx);
  nx = nx.redIAdd(nx);
  // Y3 = 8 * Y1 * (U * (T - U) - E * EE)
  var ny = this.y.redMul(u.redMul(t.redISub(u)).redISub(e.redMul(ee)));
  ny = ny.redIAdd(ny);
  ny = ny.redIAdd(ny);
  ny = ny.redIAdd(ny);
  // Z3 = (Z1 + E)^2 - ZZ - EE
  var nz = this.z.redAdd(e).redSqr().redISub(zz).redISub(ee);

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype.mul = function mul(k, kbase) {
  k = new BN(k, kbase);

  return this.curve._wnafMul(this, k);
};

JPoint.prototype.eq = function eq(p) {
  if (p.type === 'affine')
    return this.eq(p.toJ());

  if (this === p)
    return true;

  // x1 * z2^2 == x2 * z1^2
  var z2 = this.z.redSqr();
  var pz2 = p.z.redSqr();
  if (this.x.redMul(pz2).redISub(p.x.redMul(z2)).cmpn(0) !== 0)
    return false;

  // y1 * z2^3 == y2 * z1^3
  var z3 = z2.redMul(this.z);
  var pz3 = pz2.redMul(p.z);
  return this.y.redMul(pz3).redISub(p.y.redMul(z3)).cmpn(0) === 0;
};

JPoint.prototype.inspect = function inspect() {
  if (this.isInfinity())
    return '<EC JPoint Infinity>';
  return '<EC JPoint x: ' + this.x.toString(16, 2) +
      ' y: ' + this.y.toString(16, 2) +
      ' z: ' + this.z.toString(16, 2) + '>';
};

JPoint.prototype.isInfinity = function isInfinity() {
  // XXX This code assumes that zero is always zero in red
  return this.z.cmpn(0) === 0;
};

},{"../../elliptic":342,"../curve":345,"bn.js":340,"inherits":500}],348:[function(require,module,exports){
'use strict';

var curves = exports;

var hash = require('hash.js');
var elliptic = require('../elliptic');

var assert = elliptic.utils.assert;

function PresetCurve(options) {
  if (options.type === 'short')
    this.curve = new elliptic.curve.short(options);
  else if (options.type === 'edwards')
    this.curve = new elliptic.curve.edwards(options);
  else
    this.curve = new elliptic.curve.mont(options);
  this.g = this.curve.g;
  this.n = this.curve.n;
  this.hash = options.hash;

  assert(this.g.validate(), 'Invalid curve');
  assert(this.g.mul(this.n).isInfinity(), 'Invalid curve, G*N != O');
}
curves.PresetCurve = PresetCurve;

function defineCurve(name, options) {
  Object.defineProperty(curves, name, {
    configurable: true,
    enumerable: true,
    get: function() {
      var curve = new PresetCurve(options);
      Object.defineProperty(curves, name, {
        configurable: true,
        enumerable: true,
        value: curve
      });
      return curve;
    }
  });
}

defineCurve('p192', {
  type: 'short',
  prime: 'p192',
  p: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff',
  a: 'ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc',
  b: '64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1',
  n: 'ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831',
  hash: hash.sha256,
  gRed: false,
  g: [
    '188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012',
    '07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811'
  ]
});

defineCurve('p224', {
  type: 'short',
  prime: 'p224',
  p: 'ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001',
  a: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe',
  b: 'b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4',
  n: 'ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d',
  hash: hash.sha256,
  gRed: false,
  g: [
    'b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21',
    'bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34'
  ]
});

defineCurve('p256', {
  type: 'short',
  prime: null,
  p: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff',
  a: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc',
  b: '5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b',
  n: 'ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551',
  hash: hash.sha256,
  gRed: false,
  g: [
    '6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296',
    '4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5'
  ]
});

defineCurve('p384', {
  type: 'short',
  prime: null,
  p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'fffffffe ffffffff 00000000 00000000 ffffffff',
  a: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'fffffffe ffffffff 00000000 00000000 fffffffc',
  b: 'b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f ' +
     '5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef',
  n: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 ' +
     'f4372ddf 581a0db2 48b0a77a ecec196a ccc52973',
  hash: hash.sha384,
  gRed: false,
  g: [
    'aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 ' +
    '5502f25d bf55296c 3a545e38 72760ab7',
    '3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 ' +
    '0a60b1ce 1d7e819d 7a431d7c 90ea0e5f'
  ]
});

defineCurve('p521', {
  type: 'short',
  prime: null,
  p: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff ffffffff ffffffff ffffffff',
  a: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff ffffffff ffffffff fffffffc',
  b: '00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b ' +
     '99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd ' +
     '3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00',
  n: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 ' +
     'f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409',
  hash: hash.sha512,
  gRed: false,
  g: [
    '000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 ' +
    '053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 ' +
    'a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66',
    '00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 ' +
    '579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 ' +
    '3fad0761 353c7086 a272c240 88be9476 9fd16650'
  ]
});

defineCurve('curve25519', {
  type: 'mont',
  prime: 'p25519',
  p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',
  a: '76d06',
  b: '0',
  n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',
  hash: hash.sha256,
  gRed: false,
  g: [
    '9'
  ]
});

defineCurve('ed25519', {
  type: 'edwards',
  prime: 'p25519',
  p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',
  a: '-1',
  c: '1',
  // -121665 * (121666^(-1)) (mod P)
  d: '52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3',
  n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',
  hash: hash.sha256,
  gRed: false,
  g: [
    '216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a',

    // 4/5
    '6666666666666666666666666666666666666666666666666666666666666658'
  ]
});

var pre;
try {
  pre = require('./precomputed/secp256k1');
} catch (e) {
  pre = undefined;
}

defineCurve('secp256k1', {
  type: 'short',
  prime: 'k256',
  p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f',
  a: '0',
  b: '7',
  n: 'ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141',
  h: '1',
  hash: hash.sha256,

  // Precomputed endomorphism
  beta: '7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee',
  lambda: '5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72',
  basis: [
    {
      a: '3086d221a7d46bcde86c90e49284eb15',
      b: '-e4437ed6010e88286f547fa90abfe4c3'
    },
    {
      a: '114ca50f7a8e2f3f657c1108d9d44cfd8',
      b: '3086d221a7d46bcde86c90e49284eb15'
    }
  ],

  gRed: false,
  g: [
    '79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798',
    '483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8',
    pre
  ]
});

},{"../elliptic":342,"./precomputed/secp256k1":356,"hash.js":359}],349:[function(require,module,exports){
'use strict';

var BN = require('bn.js');
var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;

var KeyPair = require('./key');
var Signature = require('./signature');

function EC(options) {
  if (!(this instanceof EC))
    return new EC(options);

  // Shortcut `elliptic.ec(curve-name)`
  if (typeof options === 'string') {
    assert(elliptic.curves.hasOwnProperty(options), 'Unknown curve ' + options);

    options = elliptic.curves[options];
  }

  // Shortcut for `elliptic.ec(elliptic.curves.curveName)`
  if (options instanceof elliptic.curves.PresetCurve)
    options = { curve: options };

  this.curve = options.curve.curve;
  this.n = this.curve.n;
  this.nh = this.n.ushrn(1);
  this.g = this.curve.g;

  // Point on curve
  this.g = options.curve.g;
  this.g.precompute(options.curve.n.bitLength() + 1);

  // Hash for function for DRBG
  this.hash = options.hash || options.curve.hash;
}
module.exports = EC;

EC.prototype.keyPair = function keyPair(options) {
  return new KeyPair(this, options);
};

EC.prototype.keyFromPrivate = function keyFromPrivate(priv, enc) {
  return KeyPair.fromPrivate(this, priv, enc);
};

EC.prototype.keyFromPublic = function keyFromPublic(pub, enc) {
  return KeyPair.fromPublic(this, pub, enc);
};

EC.prototype.genKeyPair = function genKeyPair(options) {
  if (!options)
    options = {};

  // Instantiate Hmac_DRBG
  var drbg = new elliptic.hmacDRBG({
    hash: this.hash,
    pers: options.pers,
    entropy: options.entropy || elliptic.rand(this.hash.hmacStrength),
    nonce: this.n.toArray()
  });

  var bytes = this.n.byteLength();
  var ns2 = this.n.sub(new BN(2));
  do {
    var priv = new BN(drbg.generate(bytes));
    if (priv.cmp(ns2) > 0)
      continue;

    priv.iaddn(1);
    return this.keyFromPrivate(priv);
  } while (true);
};

EC.prototype._truncateToN = function truncateToN(msg, truncOnly) {
  var delta = msg.byteLength() * 8 - this.n.bitLength();
  if (delta > 0)
    msg = msg.ushrn(delta);
  if (!truncOnly && msg.cmp(this.n) >= 0)
    return msg.sub(this.n);
  else
    return msg;
};

EC.prototype.sign = function sign(msg, key, enc, options) {
  if (typeof enc === 'object') {
    options = enc;
    enc = null;
  }
  if (!options)
    options = {};

  key = this.keyFromPrivate(key, enc);
  msg = this._truncateToN(new BN(msg, 16));

  // Zero-extend key to provide enough entropy
  var bytes = this.n.byteLength();
  var bkey = key.getPrivate().toArray('be', bytes);

  // Zero-extend nonce to have the same byte size as N
  var nonce = msg.toArray('be', bytes);

  // Instantiate Hmac_DRBG
  var drbg = new elliptic.hmacDRBG({
    hash: this.hash,
    entropy: bkey,
    nonce: nonce,
    pers: options.pers,
    persEnc: options.persEnc
  });

  // Number of bytes to generate
  var ns1 = this.n.sub(new BN(1));

  for (var iter = 0; true; iter++) {
    var k = options.k ?
        options.k(iter) :
        new BN(drbg.generate(this.n.byteLength()));
    k = this._truncateToN(k, true);
    if (k.cmpn(1) <= 0 || k.cmp(ns1) >= 0)
      continue;

    var kp = this.g.mul(k);
    if (kp.isInfinity())
      continue;

    var kpX = kp.getX();
    var r = kpX.umod(this.n);
    if (r.cmpn(0) === 0)
      continue;

    var s = k.invm(this.n).mul(r.mul(key.getPrivate()).iadd(msg));
    s = s.umod(this.n);
    if (s.cmpn(0) === 0)
      continue;

    var recoveryParam = (kp.getY().isOdd() ? 1 : 0) |
                        (kpX.cmp(r) !== 0 ? 2 : 0);

    // Use complement of `s`, if it is > `n / 2`
    if (options.canonical && s.cmp(this.nh) > 0) {
      s = this.n.sub(s);
      recoveryParam ^= 1;
    }

    return new Signature({ r: r, s: s, recoveryParam: recoveryParam });
  }
};

EC.prototype.verify = function verify(msg, signature, key, enc) {
  msg = this._truncateToN(new BN(msg, 16));
  key = this.keyFromPublic(key, enc);
  signature = new Signature(signature, 'hex');

  // Perform primitive values validation
  var r = signature.r;
  var s = signature.s;
  if (r.cmpn(1) < 0 || r.cmp(this.n) >= 0)
    return false;
  if (s.cmpn(1) < 0 || s.cmp(this.n) >= 0)
    return false;

  // Validate signature
  var sinv = s.invm(this.n);
  var u1 = sinv.mul(msg).umod(this.n);
  var u2 = sinv.mul(r).umod(this.n);

  var p = this.g.mulAdd(u1, key.getPublic(), u2);
  if (p.isInfinity())
    return false;

  return p.getX().umod(this.n).cmp(r) === 0;
};

EC.prototype.recoverPubKey = function(msg, signature, j, enc) {
  assert((3 & j) === j, 'The recovery param is more than two bits');
  signature = new Signature(signature, enc);

  var n = this.n;
  var e = new BN(msg);
  var r = signature.r;
  var s = signature.s;

  // A set LSB signifies that the y-coordinate is odd
  var isYOdd = j & 1;
  var isSecondKey = j >> 1;
  if (r.cmp(this.curve.p.umod(this.curve.n)) >= 0 && isSecondKey)
    throw new Error('Unable to find sencond key candinate');

  // 1.1. Let x = r + jn.
  if (isSecondKey)
    r = this.curve.pointFromX(r.add(this.curve.n), isYOdd);
  else
    r = this.curve.pointFromX(r, isYOdd);

  var eNeg = n.sub(e);

  // 1.6.1 Compute Q = r^-1 (sR -  eG)
  //               Q = r^-1 (sR + -eG)
  var rInv = signature.r.invm(n);
  return this.g.mulAdd(eNeg, r, s).mul(rInv);
};

EC.prototype.getKeyRecoveryParam = function(e, signature, Q, enc) {
  signature = new Signature(signature, enc);
  if (signature.recoveryParam !== null)
    return signature.recoveryParam;

  for (var i = 0; i < 4; i++) {
    var Qprime;
    try {
      Qprime = this.recoverPubKey(e, signature, i);
    } catch (e) {
      continue;
    }

    if (Qprime.eq(Q))
      return i;
  }
  throw new Error('Unable to find valid recovery factor');
};

},{"../../elliptic":342,"./key":350,"./signature":351,"bn.js":340}],350:[function(require,module,exports){
'use strict';

var BN = require('bn.js');

function KeyPair(ec, options) {
  this.ec = ec;
  this.priv = null;
  this.pub = null;

  // KeyPair(ec, { priv: ..., pub: ... })
  if (options.priv)
    this._importPrivate(options.priv, options.privEnc);
  if (options.pub)
    this._importPublic(options.pub, options.pubEnc);
}
module.exports = KeyPair;

KeyPair.fromPublic = function fromPublic(ec, pub, enc) {
  if (pub instanceof KeyPair)
    return pub;

  return new KeyPair(ec, {
    pub: pub,
    pubEnc: enc
  });
};

KeyPair.fromPrivate = function fromPrivate(ec, priv, enc) {
  if (priv instanceof KeyPair)
    return priv;

  return new KeyPair(ec, {
    priv: priv,
    privEnc: enc
  });
};

KeyPair.prototype.validate = function validate() {
  var pub = this.getPublic();

  if (pub.isInfinity())
    return { result: false, reason: 'Invalid public key' };
  if (!pub.validate())
    return { result: false, reason: 'Public key is not a point' };
  if (!pub.mul(this.ec.curve.n).isInfinity())
    return { result: false, reason: 'Public key * N != O' };

  return { result: true, reason: null };
};

KeyPair.prototype.getPublic = function getPublic(compact, enc) {
  // compact is optional argument
  if (typeof compact === 'string') {
    enc = compact;
    compact = null;
  }

  if (!this.pub)
    this.pub = this.ec.g.mul(this.priv);

  if (!enc)
    return this.pub;

  return this.pub.encode(enc, compact);
};

KeyPair.prototype.getPrivate = function getPrivate(enc) {
  if (enc === 'hex')
    return this.priv.toString(16, 2);
  else
    return this.priv;
};

KeyPair.prototype._importPrivate = function _importPrivate(key, enc) {
  this.priv = new BN(key, enc || 16);

  // Ensure that the priv won't be bigger than n, otherwise we may fail
  // in fixed multiplication method
  this.priv = this.priv.umod(this.ec.curve.n);
};

KeyPair.prototype._importPublic = function _importPublic(key, enc) {
  if (key.x || key.y) {
    this.pub = this.ec.curve.point(key.x, key.y);
    return;
  }
  this.pub = this.ec.curve.decodePoint(key, enc);
};

// ECDH
KeyPair.prototype.derive = function derive(pub) {
  return pub.mul(this.priv).getX();
};

// ECDSA
KeyPair.prototype.sign = function sign(msg, enc, options) {
  return this.ec.sign(msg, this, enc, options);
};

KeyPair.prototype.verify = function verify(msg, signature) {
  return this.ec.verify(msg, signature, this);
};

KeyPair.prototype.inspect = function inspect() {
  return '<Key priv: ' + (this.priv && this.priv.toString(16, 2)) +
         ' pub: ' + (this.pub && this.pub.inspect()) + ' >';
};

},{"bn.js":340}],351:[function(require,module,exports){
'use strict';

var BN = require('bn.js');

var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;

function Signature(options, enc) {
  if (options instanceof Signature)
    return options;

  if (this._importDER(options, enc))
    return;

  assert(options.r && options.s, 'Signature without r or s');
  this.r = new BN(options.r, 16);
  this.s = new BN(options.s, 16);
  if (options.recoveryParam === undefined)
    this.recoveryParam = null;
  else
    this.recoveryParam = options.recoveryParam;
}
module.exports = Signature;

function Position() {
  this.place = 0;
}

function getLength(buf, p) {
  var initial = buf[p.place++];
  if (!(initial & 0x80)) {
    return initial;
  }
  var octetLen = initial & 0xf;
  var val = 0;
  for (var i = 0, off = p.place; i < octetLen; i++, off++) {
    val <<= 8;
    val |= buf[off];
  }
  p.place = off;
  return val;
}

function rmPadding(buf) {
  var i = 0;
  var len = buf.length - 1;
  while (!buf[i] && !(buf[i + 1] & 0x80) && i < len) {
    i++;
  }
  if (i === 0) {
    return buf;
  }
  return buf.slice(i);
}

Signature.prototype._importDER = function _importDER(data, enc) {
  data = utils.toArray(data, enc);
  var p = new Position();
  if (data[p.place++] !== 0x30) {
    return false;
  }
  var len = getLength(data, p);
  if ((len + p.place) !== data.length) {
    return false;
  }
  if (data[p.place++] !== 0x02) {
    return false;
  }
  var rlen = getLength(data, p);
  var r = data.slice(p.place, rlen + p.place);
  p.place += rlen;
  if (data[p.place++] !== 0x02) {
    return false;
  }
  var slen = getLength(data, p);
  if (data.length !== slen + p.place) {
    return false;
  }
  var s = data.slice(p.place, slen + p.place);
  if (r[0] === 0 && (r[1] & 0x80)) {
    r = r.slice(1);
  }
  if (s[0] === 0 && (s[1] & 0x80)) {
    s = s.slice(1);
  }

  this.r = new BN(r);
  this.s = new BN(s);
  this.recoveryParam = null;

  return true;
};

function constructLength(arr, len) {
  if (len < 0x80) {
    arr.push(len);
    return;
  }
  var octets = 1 + (Math.log(len) / Math.LN2 >>> 3);
  arr.push(octets | 0x80);
  while (--octets) {
    arr.push((len >>> (octets << 3)) & 0xff);
  }
  arr.push(len);
}

Signature.prototype.toDER = function toDER(enc) {
  var r = this.r.toArray();
  var s = this.s.toArray();

  // Pad values
  if (r[0] & 0x80)
    r = [ 0 ].concat(r);
  // Pad values
  if (s[0] & 0x80)
    s = [ 0 ].concat(s);

  r = rmPadding(r);
  s = rmPadding(s);

  while (!s[0] && !(s[1] & 0x80)) {
    s = s.slice(1);
  }
  var arr = [ 0x02 ];
  constructLength(arr, r.length);
  arr = arr.concat(r);
  arr.push(0x02);
  constructLength(arr, s.length);
  var backHalf = arr.concat(s);
  var res = [ 0x30 ];
  constructLength(res, backHalf.length);
  res = res.concat(backHalf);
  return utils.encode(res, enc);
};

},{"../../elliptic":342,"bn.js":340}],352:[function(require,module,exports){
'use strict';

var hash = require('hash.js');
var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;
var parseBytes = utils.parseBytes;
var KeyPair = require('./key');
var Signature = require('./signature');

function EDDSA(curve) {
  assert(curve === 'ed25519', 'only tested with ed25519 so far');

  if (!(this instanceof EDDSA))
    return new EDDSA(curve);

  var curve = elliptic.curves[curve].curve;
  this.curve = curve;
  this.g = curve.g;
  this.g.precompute(curve.n.bitLength() + 1);

  this.pointClass = curve.point().constructor;
  this.encodingLength = Math.ceil(curve.n.bitLength() / 8);
  this.hash = hash.sha512;
}

module.exports = EDDSA;

/**
* @param {Array|String} message - message bytes
* @param {Array|String|KeyPair} secret - secret bytes or a keypair
* @returns {Signature} - signature
*/
EDDSA.prototype.sign = function sign(message, secret) {
  message = parseBytes(message);
  var key = this.keyFromSecret(secret);
  var r = this.hashInt(key.messagePrefix(), message);
  var R = this.g.mul(r);
  var Rencoded = this.encodePoint(R);
  var s_ = this.hashInt(Rencoded, key.pubBytes(), message)
               .mul(key.priv());
  var S = r.add(s_).umod(this.curve.n);
  return this.makeSignature({ R: R, S: S, Rencoded: Rencoded });
};

/**
* @param {Array} message - message bytes
* @param {Array|String|Signature} sig - sig bytes
* @param {Array|String|Point|KeyPair} pub - public key
* @returns {Boolean} - true if public key matches sig of message
*/
EDDSA.prototype.verify = function verify(message, sig, pub) {
  message = parseBytes(message);
  sig = this.makeSignature(sig);
  var key = this.keyFromPublic(pub);
  var h = this.hashInt(sig.Rencoded(), key.pubBytes(), message);
  var SG = this.g.mul(sig.S());
  var RplusAh = sig.R().add(key.pub().mul(h));
  return RplusAh.eq(SG);
};

EDDSA.prototype.hashInt = function hashInt() {
  var hash = this.hash();
  for (var i = 0; i < arguments.length; i++)
    hash.update(arguments[i]);
  return utils.intFromLE(hash.digest()).umod(this.curve.n);
};

EDDSA.prototype.keyFromPublic = function keyFromPublic(pub) {
  return KeyPair.fromPublic(this, pub);
};

EDDSA.prototype.keyFromSecret = function keyFromSecret(secret) {
  return KeyPair.fromSecret(this, secret);
};

EDDSA.prototype.makeSignature = function makeSignature(sig) {
  if (sig instanceof Signature)
    return sig;
  return new Signature(this, sig);
};

/**
* * https://tools.ietf.org/html/draft-josefsson-eddsa-ed25519-03#section-5.2
*
* EDDSA defines methods for encoding and decoding points and integers. These are
* helper convenience methods, that pass along to utility functions implied
* parameters.
*
*/
EDDSA.prototype.encodePoint = function encodePoint(point) {
  var enc = point.getY().toArray('le', this.encodingLength);
  enc[this.encodingLength - 1] |= point.getX().isOdd() ? 0x80 : 0;
  return enc;
};

EDDSA.prototype.decodePoint = function decodePoint(bytes) {
  bytes = utils.parseBytes(bytes);

  var lastIx = bytes.length - 1;
  var normed = bytes.slice(0, lastIx).concat(bytes[lastIx] & ~0x80);
  var xIsOdd = (bytes[lastIx] & 0x80) !== 0;

  var y = utils.intFromLE(normed);
  return this.curve.pointFromY(y, xIsOdd);
};

EDDSA.prototype.encodeInt = function encodeInt(num) {
  return num.toArray('le', this.encodingLength);
};

EDDSA.prototype.decodeInt = function decodeInt(bytes) {
  return utils.intFromLE(bytes);
};

EDDSA.prototype.isPoint = function isPoint(val) {
  return val instanceof this.pointClass;
};

},{"../../elliptic":342,"./key":353,"./signature":354,"hash.js":359}],353:[function(require,module,exports){
'use strict';

var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;
var parseBytes = utils.parseBytes;
var cachedProperty = utils.cachedProperty;

/**
* @param {EDDSA} eddsa - instance
* @param {Object} params - public/private key parameters
*
* @param {Array<Byte>} [params.secret] - secret seed bytes
* @param {Point} [params.pub] - public key point (aka `A` in eddsa terms)
* @param {Array<Byte>} [params.pub] - public key point encoded as bytes
*
*/
function KeyPair(eddsa, params) {
  this.eddsa = eddsa;
  this._secret = parseBytes(params.secret);
  if (eddsa.isPoint(params.pub))
    this._pub = params.pub;
  else
    this._pubBytes = parseBytes(params.pub);
}

KeyPair.fromPublic = function fromPublic(eddsa, pub) {
  if (pub instanceof KeyPair)
    return pub;
  return new KeyPair(eddsa, { pub: pub });
};

KeyPair.fromSecret = function fromSecret(eddsa, secret) {
  if (secret instanceof KeyPair)
    return secret;
  return new KeyPair(eddsa, { secret: secret });
};

KeyPair.prototype.secret = function secret() {
  return this._secret;
};

cachedProperty(KeyPair, function pubBytes() {
  return this.eddsa.encodePoint(this.pub());
});

cachedProperty(KeyPair, function pub() {
  if (this._pubBytes)
    return this.eddsa.decodePoint(this._pubBytes);
  return this.eddsa.g.mul(this.priv());
});

cachedProperty(KeyPair, function privBytes() {
  var eddsa = this.eddsa;
  var hash = this.hash();
  var lastIx = eddsa.encodingLength - 1;

  var a = hash.slice(0, eddsa.encodingLength);
  a[0] &= 248;
  a[lastIx] &= 127;
  a[lastIx] |= 64;

  return a;
});

cachedProperty(KeyPair, function priv() {
  return this.eddsa.decodeInt(this.privBytes());
});

cachedProperty(KeyPair, function hash() {
  return this.eddsa.hash().update(this.secret()).digest();
});

cachedProperty(KeyPair, function messagePrefix() {
  return this.hash().slice(this.eddsa.encodingLength);
});

KeyPair.prototype.sign = function sign(message) {
  assert(this._secret, 'KeyPair can only verify');
  return this.eddsa.sign(message, this);
};

KeyPair.prototype.verify = function verify(message, sig) {
  return this.eddsa.verify(message, sig, this);
};

KeyPair.prototype.getSecret = function getSecret(enc) {
  assert(this._secret, 'KeyPair is public only');
  return utils.encode(this.secret(), enc);
};

KeyPair.prototype.getPublic = function getPublic(enc) {
  return utils.encode(this.pubBytes(), enc);
};

module.exports = KeyPair;

},{"../../elliptic":342}],354:[function(require,module,exports){
'use strict';

var BN = require('bn.js');
var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;
var cachedProperty = utils.cachedProperty;
var parseBytes = utils.parseBytes;

/**
* @param {EDDSA} eddsa - eddsa instance
* @param {Array<Bytes>|Object} sig -
* @param {Array<Bytes>|Point} [sig.R] - R point as Point or bytes
* @param {Array<Bytes>|bn} [sig.S] - S scalar as bn or bytes
* @param {Array<Bytes>} [sig.Rencoded] - R point encoded
* @param {Array<Bytes>} [sig.Sencoded] - S scalar encoded
*/
function Signature(eddsa, sig) {
  this.eddsa = eddsa;

  if (typeof sig !== 'object')
    sig = parseBytes(sig);

  if (Array.isArray(sig)) {
    sig = {
      R: sig.slice(0, eddsa.encodingLength),
      S: sig.slice(eddsa.encodingLength)
    };
  }

  assert(sig.R && sig.S, 'Signature without R or S');

  if (eddsa.isPoint(sig.R))
    this._R = sig.R;
  if (sig.S instanceof BN)
    this._S = sig.S;

  this._Rencoded = Array.isArray(sig.R) ? sig.R : sig.Rencoded;
  this._Sencoded = Array.isArray(sig.S) ? sig.S : sig.Sencoded;
}

cachedProperty(Signature, function S() {
  return this.eddsa.decodeInt(this.Sencoded());
});

cachedProperty(Signature, function R() {
  return this.eddsa.decodePoint(this.Rencoded());
});

cachedProperty(Signature, function Rencoded() {
  return this.eddsa.encodePoint(this.R());
});

cachedProperty(Signature, function Sencoded() {
  return this.eddsa.encodeInt(this.S());
});

Signature.prototype.toBytes = function toBytes() {
  return this.Rencoded().concat(this.Sencoded());
};

Signature.prototype.toHex = function toHex() {
  return utils.encode(this.toBytes(), 'hex').toUpperCase();
};

module.exports = Signature;

},{"../../elliptic":342,"bn.js":340}],355:[function(require,module,exports){
'use strict';

var hash = require('hash.js');
var elliptic = require('../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;

function HmacDRBG(options) {
  if (!(this instanceof HmacDRBG))
    return new HmacDRBG(options);
  this.hash = options.hash;
  this.predResist = !!options.predResist;

  this.outLen = this.hash.outSize;
  this.minEntropy = options.minEntropy || this.hash.hmacStrength;

  this.reseed = null;
  this.reseedInterval = null;
  this.K = null;
  this.V = null;

  var entropy = utils.toArray(options.entropy, options.entropyEnc);
  var nonce = utils.toArray(options.nonce, options.nonceEnc);
  var pers = utils.toArray(options.pers, options.persEnc);
  assert(entropy.length >= (this.minEntropy / 8),
         'Not enough entropy. Minimum is: ' + this.minEntropy + ' bits');
  this._init(entropy, nonce, pers);
}
module.exports = HmacDRBG;

HmacDRBG.prototype._init = function init(entropy, nonce, pers) {
  var seed = entropy.concat(nonce).concat(pers);

  this.K = new Array(this.outLen / 8);
  this.V = new Array(this.outLen / 8);
  for (var i = 0; i < this.V.length; i++) {
    this.K[i] = 0x00;
    this.V[i] = 0x01;
  }

  this._update(seed);
  this.reseed = 1;
  this.reseedInterval = 0x1000000000000;  // 2^48
};

HmacDRBG.prototype._hmac = function hmac() {
  return new hash.hmac(this.hash, this.K);
};

HmacDRBG.prototype._update = function update(seed) {
  var kmac = this._hmac()
                 .update(this.V)
                 .update([ 0x00 ]);
  if (seed)
    kmac = kmac.update(seed);
  this.K = kmac.digest();
  this.V = this._hmac().update(this.V).digest();
  if (!seed)
    return;

  this.K = this._hmac()
               .update(this.V)
               .update([ 0x01 ])
               .update(seed)
               .digest();
  this.V = this._hmac().update(this.V).digest();
};

HmacDRBG.prototype.reseed = function reseed(entropy, entropyEnc, add, addEnc) {
  // Optional entropy enc
  if (typeof entropyEnc !== 'string') {
    addEnc = add;
    add = entropyEnc;
    entropyEnc = null;
  }

  entropy = utils.toBuffer(entropy, entropyEnc);
  add = utils.toBuffer(add, addEnc);

  assert(entropy.length >= (this.minEntropy / 8),
         'Not enough entropy. Minimum is: ' + this.minEntropy + ' bits');

  this._update(entropy.concat(add || []));
  this.reseed = 1;
};

HmacDRBG.prototype.generate = function generate(len, enc, add, addEnc) {
  if (this.reseed > this.reseedInterval)
    throw new Error('Reseed is required');

  // Optional encoding
  if (typeof enc !== 'string') {
    addEnc = add;
    add = enc;
    enc = null;
  }

  // Optional additional data
  if (add) {
    add = utils.toArray(add, addEnc);
    this._update(add);
  }

  var temp = [];
  while (temp.length < len) {
    this.V = this._hmac().update(this.V).digest();
    temp = temp.concat(this.V);
  }

  var res = temp.slice(0, len);
  this._update(add);
  this.reseed++;
  return utils.encode(res, enc);
};

},{"../elliptic":342,"hash.js":359}],356:[function(require,module,exports){
module.exports = {
  doubles: {
    step: 4,
    points: [
      [
        'e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a',
        'f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821'
      ],
      [
        '8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508',
        '11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf'
      ],
      [
        '175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739',
        'd3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695'
      ],
      [
        '363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640',
        '4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9'
      ],
      [
        '8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c',
        '4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36'
      ],
      [
        '723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda',
        '96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f'
      ],
      [
        'eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa',
        '5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999'
      ],
      [
        '100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0',
        'cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09'
      ],
      [
        'e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d',
        '9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d'
      ],
      [
        'feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d',
        'e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088'
      ],
      [
        'da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1',
        '9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d'
      ],
      [
        '53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0',
        '5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8'
      ],
      [
        '8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047',
        '10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a'
      ],
      [
        '385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862',
        '283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453'
      ],
      [
        '6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7',
        '7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160'
      ],
      [
        '3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd',
        '56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0'
      ],
      [
        '85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83',
        '7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6'
      ],
      [
        '948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a',
        '53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589'
      ],
      [
        '6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8',
        'bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17'
      ],
      [
        'e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d',
        '4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda'
      ],
      [
        'e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725',
        '7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd'
      ],
      [
        '213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754',
        '4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2'
      ],
      [
        '4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c',
        '17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6'
      ],
      [
        'fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6',
        '6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f'
      ],
      [
        '76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39',
        'c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01'
      ],
      [
        'c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891',
        '893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3'
      ],
      [
        'd895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b',
        'febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f'
      ],
      [
        'b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03',
        '2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7'
      ],
      [
        'e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d',
        'eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78'
      ],
      [
        'a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070',
        '7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1'
      ],
      [
        '90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4',
        'e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150'
      ],
      [
        '8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da',
        '662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82'
      ],
      [
        'e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11',
        '1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc'
      ],
      [
        '8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e',
        'efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b'
      ],
      [
        'e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41',
        '2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51'
      ],
      [
        'b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef',
        '67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45'
      ],
      [
        'd68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8',
        'db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120'
      ],
      [
        '324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d',
        '648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84'
      ],
      [
        '4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96',
        '35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d'
      ],
      [
        '9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd',
        'ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d'
      ],
      [
        '6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5',
        '9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8'
      ],
      [
        'a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266',
        '40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8'
      ],
      [
        '7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71',
        '34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac'
      ],
      [
        '928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac',
        'c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f'
      ],
      [
        '85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751',
        '1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962'
      ],
      [
        'ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e',
        '493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907'
      ],
      [
        '827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241',
        'c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec'
      ],
      [
        'eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3',
        'be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d'
      ],
      [
        'e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f',
        '4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414'
      ],
      [
        '1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19',
        'aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd'
      ],
      [
        '146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be',
        'b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0'
      ],
      [
        'fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9',
        '6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811'
      ],
      [
        'da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2',
        '8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1'
      ],
      [
        'a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13',
        '7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c'
      ],
      [
        '174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c',
        'ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73'
      ],
      [
        '959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba',
        '2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd'
      ],
      [
        'd2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151',
        'e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405'
      ],
      [
        '64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073',
        'd99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589'
      ],
      [
        '8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458',
        '38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e'
      ],
      [
        '13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b',
        '69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27'
      ],
      [
        'bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366',
        'd3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1'
      ],
      [
        '8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa',
        '40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482'
      ],
      [
        '8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0',
        '620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945'
      ],
      [
        'dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787',
        '7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573'
      ],
      [
        'f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e',
        'ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82'
      ]
    ]
  },
  naf: {
    wnd: 7,
    points: [
      [
        'f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9',
        '388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672'
      ],
      [
        '2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4',
        'd8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6'
      ],
      [
        '5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc',
        '6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da'
      ],
      [
        'acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe',
        'cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37'
      ],
      [
        '774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb',
        'd984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b'
      ],
      [
        'f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8',
        'ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81'
      ],
      [
        'd7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e',
        '581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58'
      ],
      [
        'defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34',
        '4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77'
      ],
      [
        '2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c',
        '85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a'
      ],
      [
        '352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5',
        '321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c'
      ],
      [
        '2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f',
        '2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67'
      ],
      [
        '9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714',
        '73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402'
      ],
      [
        'daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729',
        'a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55'
      ],
      [
        'c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db',
        '2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482'
      ],
      [
        '6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4',
        'e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82'
      ],
      [
        '1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5',
        'b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396'
      ],
      [
        '605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479',
        '2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49'
      ],
      [
        '62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d',
        '80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf'
      ],
      [
        '80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f',
        '1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a'
      ],
      [
        '7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb',
        'd0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7'
      ],
      [
        'd528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9',
        'eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933'
      ],
      [
        '49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963',
        '758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a'
      ],
      [
        '77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74',
        '958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6'
      ],
      [
        'f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530',
        'e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37'
      ],
      [
        '463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b',
        '5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e'
      ],
      [
        'f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247',
        'cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6'
      ],
      [
        'caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1',
        'cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476'
      ],
      [
        '2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120',
        '4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40'
      ],
      [
        '7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435',
        '91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61'
      ],
      [
        '754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18',
        '673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683'
      ],
      [
        'e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8',
        '59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5'
      ],
      [
        '186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb',
        '3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b'
      ],
      [
        'df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f',
        '55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417'
      ],
      [
        '5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143',
        'efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868'
      ],
      [
        '290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba',
        'e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a'
      ],
      [
        'af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45',
        'f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6'
      ],
      [
        '766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a',
        '744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996'
      ],
      [
        '59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e',
        'c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e'
      ],
      [
        'f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8',
        'e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d'
      ],
      [
        '7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c',
        '30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2'
      ],
      [
        '948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519',
        'e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e'
      ],
      [
        '7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab',
        '100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437'
      ],
      [
        '3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca',
        'ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311'
      ],
      [
        'd3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf',
        '8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4'
      ],
      [
        '1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610',
        '68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575'
      ],
      [
        '733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4',
        'f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d'
      ],
      [
        '15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c',
        'd56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d'
      ],
      [
        'a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940',
        'edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629'
      ],
      [
        'e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980',
        'a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06'
      ],
      [
        '311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3',
        '66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374'
      ],
      [
        '34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf',
        '9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee'
      ],
      [
        'f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63',
        '4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1'
      ],
      [
        'd7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448',
        'fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b'
      ],
      [
        '32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf',
        '5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661'
      ],
      [
        '7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5',
        '8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6'
      ],
      [
        'ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6',
        '8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e'
      ],
      [
        '16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5',
        '5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d'
      ],
      [
        'eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99',
        'f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc'
      ],
      [
        '78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51',
        'f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4'
      ],
      [
        '494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5',
        '42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c'
      ],
      [
        'a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5',
        '204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b'
      ],
      [
        'c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997',
        '4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913'
      ],
      [
        '841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881',
        '73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154'
      ],
      [
        '5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5',
        '39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865'
      ],
      [
        '36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66',
        'd2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc'
      ],
      [
        '336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726',
        'ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224'
      ],
      [
        '8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede',
        '6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e'
      ],
      [
        '1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94',
        '60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6'
      ],
      [
        '85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31',
        '3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511'
      ],
      [
        '29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51',
        'b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b'
      ],
      [
        'a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252',
        'ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2'
      ],
      [
        '4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5',
        'cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c'
      ],
      [
        'd24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b',
        '6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3'
      ],
      [
        'ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4',
        '322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d'
      ],
      [
        'af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f',
        '6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700'
      ],
      [
        'e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889',
        '2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4'
      ],
      [
        '591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246',
        'b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196'
      ],
      [
        '11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984',
        '998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4'
      ],
      [
        '3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a',
        'b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257'
      ],
      [
        'cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030',
        'bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13'
      ],
      [
        'c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197',
        '6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096'
      ],
      [
        'c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593',
        'c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38'
      ],
      [
        'a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef',
        '21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f'
      ],
      [
        '347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38',
        '60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448'
      ],
      [
        'da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a',
        '49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a'
      ],
      [
        'c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111',
        '5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4'
      ],
      [
        '4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502',
        '7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437'
      ],
      [
        '3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea',
        'be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7'
      ],
      [
        'cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26',
        '8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d'
      ],
      [
        'b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986',
        '39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a'
      ],
      [
        'd4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e',
        '62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54'
      ],
      [
        '48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4',
        '25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77'
      ],
      [
        'dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda',
        'ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517'
      ],
      [
        '6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859',
        'cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10'
      ],
      [
        'e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f',
        'f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125'
      ],
      [
        'eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c',
        '6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e'
      ],
      [
        '13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942',
        'fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1'
      ],
      [
        'ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a',
        '1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2'
      ],
      [
        'b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80',
        '5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423'
      ],
      [
        'ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d',
        '438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8'
      ],
      [
        '8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1',
        'cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758'
      ],
      [
        '52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63',
        'c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375'
      ],
      [
        'e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352',
        '6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d'
      ],
      [
        '7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193',
        'ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec'
      ],
      [
        '5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00',
        '9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0'
      ],
      [
        '32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58',
        'ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c'
      ],
      [
        'e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7',
        'd3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4'
      ],
      [
        '8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8',
        'c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f'
      ],
      [
        '4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e',
        '67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649'
      ],
      [
        '3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d',
        'cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826'
      ],
      [
        '674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b',
        '299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5'
      ],
      [
        'd32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f',
        'f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87'
      ],
      [
        '30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6',
        '462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b'
      ],
      [
        'be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297',
        '62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc'
      ],
      [
        '93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a',
        '7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c'
      ],
      [
        'b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c',
        'ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f'
      ],
      [
        'd5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52',
        '4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a'
      ],
      [
        'd3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb',
        'bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46'
      ],
      [
        '463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065',
        'bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f'
      ],
      [
        '7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917',
        '603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03'
      ],
      [
        '74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9',
        'cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08'
      ],
      [
        '30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3',
        '553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8'
      ],
      [
        '9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57',
        '712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373'
      ],
      [
        '176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66',
        'ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3'
      ],
      [
        '75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8',
        '9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8'
      ],
      [
        '809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721',
        '9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1'
      ],
      [
        '1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180',
        '4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9'
      ]
    ]
  }
};

},{}],357:[function(require,module,exports){
'use strict';

var utils = exports;
var BN = require('bn.js');

utils.assert = function assert(val, msg) {
  if (!val)
    throw new Error(msg || 'Assertion failed');
};

function toArray(msg, enc) {
  if (Array.isArray(msg))
    return msg.slice();
  if (!msg)
    return [];
  var res = [];
  if (typeof msg !== 'string') {
    for (var i = 0; i < msg.length; i++)
      res[i] = msg[i] | 0;
    return res;
  }
  if (!enc) {
    for (var i = 0; i < msg.length; i++) {
      var c = msg.charCodeAt(i);
      var hi = c >> 8;
      var lo = c & 0xff;
      if (hi)
        res.push(hi, lo);
      else
        res.push(lo);
    }
  } else if (enc === 'hex') {
    msg = msg.replace(/[^a-z0-9]+/ig, '');
    if (msg.length % 2 !== 0)
      msg = '0' + msg;
    for (var i = 0; i < msg.length; i += 2)
      res.push(parseInt(msg[i] + msg[i + 1], 16));
  }
  return res;
}
utils.toArray = toArray;

function zero2(word) {
  if (word.length === 1)
    return '0' + word;
  else
    return word;
}
utils.zero2 = zero2;

function toHex(msg) {
  var res = '';
  for (var i = 0; i < msg.length; i++)
    res += zero2(msg[i].toString(16));
  return res;
}
utils.toHex = toHex;

utils.encode = function encode(arr, enc) {
  if (enc === 'hex')
    return toHex(arr);
  else
    return arr;
};

// Represent num in a w-NAF form
function getNAF(num, w) {
  var naf = [];
  var ws = 1 << (w + 1);
  var k = num.clone();
  while (k.cmpn(1) >= 0) {
    var z;
    if (k.isOdd()) {
      var mod = k.andln(ws - 1);
      if (mod > (ws >> 1) - 1)
        z = (ws >> 1) - mod;
      else
        z = mod;
      k.isubn(z);
    } else {
      z = 0;
    }
    naf.push(z);

    // Optimization, shift by word if possible
    var shift = (k.cmpn(0) !== 0 && k.andln(ws - 1) === 0) ? (w + 1) : 1;
    for (var i = 1; i < shift; i++)
      naf.push(0);
    k.iushrn(shift);
  }

  return naf;
}
utils.getNAF = getNAF;

// Represent k1, k2 in a Joint Sparse Form
function getJSF(k1, k2) {
  var jsf = [
    [],
    []
  ];

  k1 = k1.clone();
  k2 = k2.clone();
  var d1 = 0;
  var d2 = 0;
  while (k1.cmpn(-d1) > 0 || k2.cmpn(-d2) > 0) {

    // First phase
    var m14 = (k1.andln(3) + d1) & 3;
    var m24 = (k2.andln(3) + d2) & 3;
    if (m14 === 3)
      m14 = -1;
    if (m24 === 3)
      m24 = -1;
    var u1;
    if ((m14 & 1) === 0) {
      u1 = 0;
    } else {
      var m8 = (k1.andln(7) + d1) & 7;
      if ((m8 === 3 || m8 === 5) && m24 === 2)
        u1 = -m14;
      else
        u1 = m14;
    }
    jsf[0].push(u1);

    var u2;
    if ((m24 & 1) === 0) {
      u2 = 0;
    } else {
      var m8 = (k2.andln(7) + d2) & 7;
      if ((m8 === 3 || m8 === 5) && m14 === 2)
        u2 = -m24;
      else
        u2 = m24;
    }
    jsf[1].push(u2);

    // Second phase
    if (2 * d1 === u1 + 1)
      d1 = 1 - d1;
    if (2 * d2 === u2 + 1)
      d2 = 1 - d2;
    k1.iushrn(1);
    k2.iushrn(1);
  }

  return jsf;
}
utils.getJSF = getJSF;

function cachedProperty(obj, computer) {
  var name = computer.name;
  var key = '_' + name;
  obj.prototype[name] = function cachedProperty() {
    return this[key] !== undefined ? this[key] :
           this[key] = computer.call(this);
  };
}
utils.cachedProperty = cachedProperty;

function parseBytes(bytes) {
  return typeof bytes === 'string' ? utils.toArray(bytes, 'hex') :
                                     bytes;
}
utils.parseBytes = parseBytes;

function intFromLE(bytes) {
  return new BN(bytes, 'hex', 'le');
}
utils.intFromLE = intFromLE;


},{"bn.js":340}],358:[function(require,module,exports){
var r;

module.exports = function rand(len) {
  if (!r)
    r = new Rand(null);

  return r.generate(len);
};

function Rand(rand) {
  this.rand = rand;
}
module.exports.Rand = Rand;

Rand.prototype.generate = function generate(len) {
  return this._rand(len);
};

if (typeof window === 'object') {
  if (window.crypto && window.crypto.getRandomValues) {
    // Modern browsers
    Rand.prototype._rand = function _rand(n) {
      var arr = new Uint8Array(n);
      window.crypto.getRandomValues(arr);
      return arr;
    };
  } else if (window.msCrypto && window.msCrypto.getRandomValues) {
    // IE
    Rand.prototype._rand = function _rand(n) {
      var arr = new Uint8Array(n);
      window.msCrypto.getRandomValues(arr);
      return arr;
    };
  } else {
    // Old junk
    Rand.prototype._rand = function() {
      throw new Error('Not implemented yet');
    };
  }
} else {
  // Node.js or Web worker
  try {
    var crypto = require('cry' + 'pto');

    Rand.prototype._rand = function _rand(n) {
      return crypto.randomBytes(n);
    };
  } catch (e) {
    // Emulate crypto API using randy
    Rand.prototype._rand = function _rand(n) {
      var res = new Uint8Array(n);
      for (var i = 0; i < res.length; i++)
        res[i] = this.rand.getByte();
      return res;
    };
  }
}

},{}],359:[function(require,module,exports){
var hash = exports;

hash.utils = require('./hash/utils');
hash.common = require('./hash/common');
hash.sha = require('./hash/sha');
hash.ripemd = require('./hash/ripemd');
hash.hmac = require('./hash/hmac');

// Proxy hash functions to the main object
hash.sha1 = hash.sha.sha1;
hash.sha256 = hash.sha.sha256;
hash.sha224 = hash.sha.sha224;
hash.sha384 = hash.sha.sha384;
hash.sha512 = hash.sha.sha512;
hash.ripemd160 = hash.ripemd.ripemd160;

},{"./hash/common":360,"./hash/hmac":361,"./hash/ripemd":362,"./hash/sha":363,"./hash/utils":364}],360:[function(require,module,exports){
var hash = require('../hash');
var utils = hash.utils;
var assert = utils.assert;

function BlockHash() {
  this.pending = null;
  this.pendingTotal = 0;
  this.blockSize = this.constructor.blockSize;
  this.outSize = this.constructor.outSize;
  this.hmacStrength = this.constructor.hmacStrength;
  this.padLength = this.constructor.padLength / 8;
  this.endian = 'big';

  this._delta8 = this.blockSize / 8;
  this._delta32 = this.blockSize / 32;
}
exports.BlockHash = BlockHash;

BlockHash.prototype.update = function update(msg, enc) {
  // Convert message to array, pad it, and join into 32bit blocks
  msg = utils.toArray(msg, enc);
  if (!this.pending)
    this.pending = msg;
  else
    this.pending = this.pending.concat(msg);
  this.pendingTotal += msg.length;

  // Enough data, try updating
  if (this.pending.length >= this._delta8) {
    msg = this.pending;

    // Process pending data in blocks
    var r = msg.length % this._delta8;
    this.pending = msg.slice(msg.length - r, msg.length);
    if (this.pending.length === 0)
      this.pending = null;

    msg = utils.join32(msg, 0, msg.length - r, this.endian);
    for (var i = 0; i < msg.length; i += this._delta32)
      this._update(msg, i, i + this._delta32);
  }

  return this;
};

BlockHash.prototype.digest = function digest(enc) {
  this.update(this._pad());
  assert(this.pending === null);

  return this._digest(enc);
};

BlockHash.prototype._pad = function pad() {
  var len = this.pendingTotal;
  var bytes = this._delta8;
  var k = bytes - ((len + this.padLength) % bytes);
  var res = new Array(k + this.padLength);
  res[0] = 0x80;
  for (var i = 1; i < k; i++)
    res[i] = 0;

  // Append length
  len <<= 3;
  if (this.endian === 'big') {
    for (var t = 8; t < this.padLength; t++)
      res[i++] = 0;

    res[i++] = 0;
    res[i++] = 0;
    res[i++] = 0;
    res[i++] = 0;
    res[i++] = (len >>> 24) & 0xff;
    res[i++] = (len >>> 16) & 0xff;
    res[i++] = (len >>> 8) & 0xff;
    res[i++] = len & 0xff;
  } else {
    res[i++] = len & 0xff;
    res[i++] = (len >>> 8) & 0xff;
    res[i++] = (len >>> 16) & 0xff;
    res[i++] = (len >>> 24) & 0xff;
    res[i++] = 0;
    res[i++] = 0;
    res[i++] = 0;
    res[i++] = 0;

    for (var t = 8; t < this.padLength; t++)
      res[i++] = 0;
  }

  return res;
};

},{"../hash":359}],361:[function(require,module,exports){
var hmac = exports;

var hash = require('../hash');
var utils = hash.utils;
var assert = utils.assert;

function Hmac(hash, key, enc) {
  if (!(this instanceof Hmac))
    return new Hmac(hash, key, enc);
  this.Hash = hash;
  this.blockSize = hash.blockSize / 8;
  this.outSize = hash.outSize / 8;
  this.inner = null;
  this.outer = null;

  this._init(utils.toArray(key, enc));
}
module.exports = Hmac;

Hmac.prototype._init = function init(key) {
  // Shorten key, if needed
  if (key.length > this.blockSize)
    key = new this.Hash().update(key).digest();
  assert(key.length <= this.blockSize);

  // Add padding to key
  for (var i = key.length; i < this.blockSize; i++)
    key.push(0);

  for (var i = 0; i < key.length; i++)
    key[i] ^= 0x36;
  this.inner = new this.Hash().update(key);

  // 0x36 ^ 0x5c = 0x6a
  for (var i = 0; i < key.length; i++)
    key[i] ^= 0x6a;
  this.outer = new this.Hash().update(key);
};

Hmac.prototype.update = function update(msg, enc) {
  this.inner.update(msg, enc);
  return this;
};

Hmac.prototype.digest = function digest(enc) {
  this.outer.update(this.inner.digest());
  return this.outer.digest(enc);
};

},{"../hash":359}],362:[function(require,module,exports){
var hash = require('../hash');
var utils = hash.utils;

var rotl32 = utils.rotl32;
var sum32 = utils.sum32;
var sum32_3 = utils.sum32_3;
var sum32_4 = utils.sum32_4;
var BlockHash = hash.common.BlockHash;

function RIPEMD160() {
  if (!(this instanceof RIPEMD160))
    return new RIPEMD160();

  BlockHash.call(this);

  this.h = [ 0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0 ];
  this.endian = 'little';
}
utils.inherits(RIPEMD160, BlockHash);
exports.ripemd160 = RIPEMD160;

RIPEMD160.blockSize = 512;
RIPEMD160.outSize = 160;
RIPEMD160.hmacStrength = 192;
RIPEMD160.padLength = 64;

RIPEMD160.prototype._update = function update(msg, start) {
  var A = this.h[0];
  var B = this.h[1];
  var C = this.h[2];
  var D = this.h[3];
  var E = this.h[4];
  var Ah = A;
  var Bh = B;
  var Ch = C;
  var Dh = D;
  var Eh = E;
  for (var j = 0; j < 80; j++) {
    var T = sum32(
      rotl32(
        sum32_4(A, f(j, B, C, D), msg[r[j] + start], K(j)),
        s[j]),
      E);
    A = E;
    E = D;
    D = rotl32(C, 10);
    C = B;
    B = T;
    T = sum32(
      rotl32(
        sum32_4(Ah, f(79 - j, Bh, Ch, Dh), msg[rh[j] + start], Kh(j)),
        sh[j]),
      Eh);
    Ah = Eh;
    Eh = Dh;
    Dh = rotl32(Ch, 10);
    Ch = Bh;
    Bh = T;
  }
  T = sum32_3(this.h[1], C, Dh);
  this.h[1] = sum32_3(this.h[2], D, Eh);
  this.h[2] = sum32_3(this.h[3], E, Ah);
  this.h[3] = sum32_3(this.h[4], A, Bh);
  this.h[4] = sum32_3(this.h[0], B, Ch);
  this.h[0] = T;
};

RIPEMD160.prototype._digest = function digest(enc) {
  if (enc === 'hex')
    return utils.toHex32(this.h, 'little');
  else
    return utils.split32(this.h, 'little');
};

function f(j, x, y, z) {
  if (j <= 15)
    return x ^ y ^ z;
  else if (j <= 31)
    return (x & y) | ((~x) & z);
  else if (j <= 47)
    return (x | (~y)) ^ z;
  else if (j <= 63)
    return (x & z) | (y & (~z));
  else
    return x ^ (y | (~z));
}

function K(j) {
  if (j <= 15)
    return 0x00000000;
  else if (j <= 31)
    return 0x5a827999;
  else if (j <= 47)
    return 0x6ed9eba1;
  else if (j <= 63)
    return 0x8f1bbcdc;
  else
    return 0xa953fd4e;
}

function Kh(j) {
  if (j <= 15)
    return 0x50a28be6;
  else if (j <= 31)
    return 0x5c4dd124;
  else if (j <= 47)
    return 0x6d703ef3;
  else if (j <= 63)
    return 0x7a6d76e9;
  else
    return 0x00000000;
}

var r = [
  0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
  7, 4, 13, 1, 10, 6, 15, 3, 12, 0, 9, 5, 2, 14, 11, 8,
  3, 10, 14, 4, 9, 15, 8, 1, 2, 7, 0, 6, 13, 11, 5, 12,
  1, 9, 11, 10, 0, 8, 12, 4, 13, 3, 7, 15, 14, 5, 6, 2,
  4, 0, 5, 9, 7, 12, 2, 10, 14, 1, 3, 8, 11, 6, 15, 13
];

var rh = [
  5, 14, 7, 0, 9, 2, 11, 4, 13, 6, 15, 8, 1, 10, 3, 12,
  6, 11, 3, 7, 0, 13, 5, 10, 14, 15, 8, 12, 4, 9, 1, 2,
  15, 5, 1, 3, 7, 14, 6, 9, 11, 8, 12, 2, 10, 0, 4, 13,
  8, 6, 4, 1, 3, 11, 15, 0, 5, 12, 2, 13, 9, 7, 10, 14,
  12, 15, 10, 4, 1, 5, 8, 7, 6, 2, 13, 14, 0, 3, 9, 11
];

var s = [
  11, 14, 15, 12, 5, 8, 7, 9, 11, 13, 14, 15, 6, 7, 9, 8,
  7, 6, 8, 13, 11, 9, 7, 15, 7, 12, 15, 9, 11, 7, 13, 12,
  11, 13, 6, 7, 14, 9, 13, 15, 14, 8, 13, 6, 5, 12, 7, 5,
  11, 12, 14, 15, 14, 15, 9, 8, 9, 14, 5, 6, 8, 6, 5, 12,
  9, 15, 5, 11, 6, 8, 13, 12, 5, 12, 13, 14, 11, 8, 5, 6
];

var sh = [
  8, 9, 9, 11, 13, 15, 15, 5, 7, 7, 8, 11, 14, 14, 12, 6,
  9, 13, 15, 7, 12, 8, 9, 11, 7, 7, 12, 7, 6, 15, 13, 11,
  9, 7, 15, 11, 8, 6, 6, 14, 12, 13, 5, 14, 13, 13, 7, 5,
  15, 5, 8, 11, 14, 14, 6, 14, 6, 9, 12, 9, 12, 5, 15, 8,
  8, 5, 12, 9, 12, 5, 14, 6, 8, 13, 6, 5, 15, 13, 11, 11
];

},{"../hash":359}],363:[function(require,module,exports){
var hash = require('../hash');
var utils = hash.utils;
var assert = utils.assert;

var rotr32 = utils.rotr32;
var rotl32 = utils.rotl32;
var sum32 = utils.sum32;
var sum32_4 = utils.sum32_4;
var sum32_5 = utils.sum32_5;
var rotr64_hi = utils.rotr64_hi;
var rotr64_lo = utils.rotr64_lo;
var shr64_hi = utils.shr64_hi;
var shr64_lo = utils.shr64_lo;
var sum64 = utils.sum64;
var sum64_hi = utils.sum64_hi;
var sum64_lo = utils.sum64_lo;
var sum64_4_hi = utils.sum64_4_hi;
var sum64_4_lo = utils.sum64_4_lo;
var sum64_5_hi = utils.sum64_5_hi;
var sum64_5_lo = utils.sum64_5_lo;
var BlockHash = hash.common.BlockHash;

var sha256_K = [
  0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5,
  0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,
  0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3,
  0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,
  0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc,
  0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,
  0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7,
  0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,
  0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13,
  0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,
  0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3,
  0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,
  0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5,
  0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,
  0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208,
  0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2
];

var sha512_K = [
  0x428a2f98, 0xd728ae22, 0x71374491, 0x23ef65cd,
  0xb5c0fbcf, 0xec4d3b2f, 0xe9b5dba5, 0x8189dbbc,
  0x3956c25b, 0xf348b538, 0x59f111f1, 0xb605d019,
  0x923f82a4, 0xaf194f9b, 0xab1c5ed5, 0xda6d8118,
  0xd807aa98, 0xa3030242, 0x12835b01, 0x45706fbe,
  0x243185be, 0x4ee4b28c, 0x550c7dc3, 0xd5ffb4e2,
  0x72be5d74, 0xf27b896f, 0x80deb1fe, 0x3b1696b1,
  0x9bdc06a7, 0x25c71235, 0xc19bf174, 0xcf692694,
  0xe49b69c1, 0x9ef14ad2, 0xefbe4786, 0x384f25e3,
  0x0fc19dc6, 0x8b8cd5b5, 0x240ca1cc, 0x77ac9c65,
  0x2de92c6f, 0x592b0275, 0x4a7484aa, 0x6ea6e483,
  0x5cb0a9dc, 0xbd41fbd4, 0x76f988da, 0x831153b5,
  0x983e5152, 0xee66dfab, 0xa831c66d, 0x2db43210,
  0xb00327c8, 0x98fb213f, 0xbf597fc7, 0xbeef0ee4,
  0xc6e00bf3, 0x3da88fc2, 0xd5a79147, 0x930aa725,
  0x06ca6351, 0xe003826f, 0x14292967, 0x0a0e6e70,
  0x27b70a85, 0x46d22ffc, 0x2e1b2138, 0x5c26c926,
  0x4d2c6dfc, 0x5ac42aed, 0x53380d13, 0x9d95b3df,
  0x650a7354, 0x8baf63de, 0x766a0abb, 0x3c77b2a8,
  0x81c2c92e, 0x47edaee6, 0x92722c85, 0x1482353b,
  0xa2bfe8a1, 0x4cf10364, 0xa81a664b, 0xbc423001,
  0xc24b8b70, 0xd0f89791, 0xc76c51a3, 0x0654be30,
  0xd192e819, 0xd6ef5218, 0xd6990624, 0x5565a910,
  0xf40e3585, 0x5771202a, 0x106aa070, 0x32bbd1b8,
  0x19a4c116, 0xb8d2d0c8, 0x1e376c08, 0x5141ab53,
  0x2748774c, 0xdf8eeb99, 0x34b0bcb5, 0xe19b48a8,
  0x391c0cb3, 0xc5c95a63, 0x4ed8aa4a, 0xe3418acb,
  0x5b9cca4f, 0x7763e373, 0x682e6ff3, 0xd6b2b8a3,
  0x748f82ee, 0x5defb2fc, 0x78a5636f, 0x43172f60,
  0x84c87814, 0xa1f0ab72, 0x8cc70208, 0x1a6439ec,
  0x90befffa, 0x23631e28, 0xa4506ceb, 0xde82bde9,
  0xbef9a3f7, 0xb2c67915, 0xc67178f2, 0xe372532b,
  0xca273ece, 0xea26619c, 0xd186b8c7, 0x21c0c207,
  0xeada7dd6, 0xcde0eb1e, 0xf57d4f7f, 0xee6ed178,
  0x06f067aa, 0x72176fba, 0x0a637dc5, 0xa2c898a6,
  0x113f9804, 0xbef90dae, 0x1b710b35, 0x131c471b,
  0x28db77f5, 0x23047d84, 0x32caab7b, 0x40c72493,
  0x3c9ebe0a, 0x15c9bebc, 0x431d67c4, 0x9c100d4c,
  0x4cc5d4be, 0xcb3e42b6, 0x597f299c, 0xfc657e2a,
  0x5fcb6fab, 0x3ad6faec, 0x6c44198c, 0x4a475817
];

var sha1_K = [
  0x5A827999, 0x6ED9EBA1,
  0x8F1BBCDC, 0xCA62C1D6
];

function SHA256() {
  if (!(this instanceof SHA256))
    return new SHA256();

  BlockHash.call(this);
  this.h = [ 0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a,
             0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19 ];
  this.k = sha256_K;
  this.W = new Array(64);
}
utils.inherits(SHA256, BlockHash);
exports.sha256 = SHA256;

SHA256.blockSize = 512;
SHA256.outSize = 256;
SHA256.hmacStrength = 192;
SHA256.padLength = 64;

SHA256.prototype._update = function _update(msg, start) {
  var W = this.W;

  for (var i = 0; i < 16; i++)
    W[i] = msg[start + i];
  for (; i < W.length; i++)
    W[i] = sum32_4(g1_256(W[i - 2]), W[i - 7], g0_256(W[i - 15]), W[i - 16]);

  var a = this.h[0];
  var b = this.h[1];
  var c = this.h[2];
  var d = this.h[3];
  var e = this.h[4];
  var f = this.h[5];
  var g = this.h[6];
  var h = this.h[7];

  assert(this.k.length === W.length);
  for (var i = 0; i < W.length; i++) {
    var T1 = sum32_5(h, s1_256(e), ch32(e, f, g), this.k[i], W[i]);
    var T2 = sum32(s0_256(a), maj32(a, b, c));
    h = g;
    g = f;
    f = e;
    e = sum32(d, T1);
    d = c;
    c = b;
    b = a;
    a = sum32(T1, T2);
  }

  this.h[0] = sum32(this.h[0], a);
  this.h[1] = sum32(this.h[1], b);
  this.h[2] = sum32(this.h[2], c);
  this.h[3] = sum32(this.h[3], d);
  this.h[4] = sum32(this.h[4], e);
  this.h[5] = sum32(this.h[5], f);
  this.h[6] = sum32(this.h[6], g);
  this.h[7] = sum32(this.h[7], h);
};

SHA256.prototype._digest = function digest(enc) {
  if (enc === 'hex')
    return utils.toHex32(this.h, 'big');
  else
    return utils.split32(this.h, 'big');
};

function SHA224() {
  if (!(this instanceof SHA224))
    return new SHA224();

  SHA256.call(this);
  this.h = [ 0xc1059ed8, 0x367cd507, 0x3070dd17, 0xf70e5939,
             0xffc00b31, 0x68581511, 0x64f98fa7, 0xbefa4fa4 ];
}
utils.inherits(SHA224, SHA256);
exports.sha224 = SHA224;

SHA224.blockSize = 512;
SHA224.outSize = 224;
SHA224.hmacStrength = 192;
SHA224.padLength = 64;

SHA224.prototype._digest = function digest(enc) {
  // Just truncate output
  if (enc === 'hex')
    return utils.toHex32(this.h.slice(0, 7), 'big');
  else
    return utils.split32(this.h.slice(0, 7), 'big');
};

function SHA512() {
  if (!(this instanceof SHA512))
    return new SHA512();

  BlockHash.call(this);
  this.h = [ 0x6a09e667, 0xf3bcc908,
             0xbb67ae85, 0x84caa73b,
             0x3c6ef372, 0xfe94f82b,
             0xa54ff53a, 0x5f1d36f1,
             0x510e527f, 0xade682d1,
             0x9b05688c, 0x2b3e6c1f,
             0x1f83d9ab, 0xfb41bd6b,
             0x5be0cd19, 0x137e2179 ];
  this.k = sha512_K;
  this.W = new Array(160);
}
utils.inherits(SHA512, BlockHash);
exports.sha512 = SHA512;

SHA512.blockSize = 1024;
SHA512.outSize = 512;
SHA512.hmacStrength = 192;
SHA512.padLength = 128;

SHA512.prototype._prepareBlock = function _prepareBlock(msg, start) {
  var W = this.W;

  // 32 x 32bit words
  for (var i = 0; i < 32; i++)
    W[i] = msg[start + i];
  for (; i < W.length; i += 2) {
    var c0_hi = g1_512_hi(W[i - 4], W[i - 3]);  // i - 2
    var c0_lo = g1_512_lo(W[i - 4], W[i - 3]);
    var c1_hi = W[i - 14];  // i - 7
    var c1_lo = W[i - 13];
    var c2_hi = g0_512_hi(W[i - 30], W[i - 29]);  // i - 15
    var c2_lo = g0_512_lo(W[i - 30], W[i - 29]);
    var c3_hi = W[i - 32];  // i - 16
    var c3_lo = W[i - 31];

    W[i] = sum64_4_hi(c0_hi, c0_lo,
                      c1_hi, c1_lo,
                      c2_hi, c2_lo,
                      c3_hi, c3_lo);
    W[i + 1] = sum64_4_lo(c0_hi, c0_lo,
                          c1_hi, c1_lo,
                          c2_hi, c2_lo,
                          c3_hi, c3_lo);
  }
};

SHA512.prototype._update = function _update(msg, start) {
  this._prepareBlock(msg, start);

  var W = this.W;

  var ah = this.h[0];
  var al = this.h[1];
  var bh = this.h[2];
  var bl = this.h[3];
  var ch = this.h[4];
  var cl = this.h[5];
  var dh = this.h[6];
  var dl = this.h[7];
  var eh = this.h[8];
  var el = this.h[9];
  var fh = this.h[10];
  var fl = this.h[11];
  var gh = this.h[12];
  var gl = this.h[13];
  var hh = this.h[14];
  var hl = this.h[15];

  assert(this.k.length === W.length);
  for (var i = 0; i < W.length; i += 2) {
    var c0_hi = hh;
    var c0_lo = hl;
    var c1_hi = s1_512_hi(eh, el);
    var c1_lo = s1_512_lo(eh, el);
    var c2_hi = ch64_hi(eh, el, fh, fl, gh, gl);
    var c2_lo = ch64_lo(eh, el, fh, fl, gh, gl);
    var c3_hi = this.k[i];
    var c3_lo = this.k[i + 1];
    var c4_hi = W[i];
    var c4_lo = W[i + 1];

    var T1_hi = sum64_5_hi(c0_hi, c0_lo,
                           c1_hi, c1_lo,
                           c2_hi, c2_lo,
                           c3_hi, c3_lo,
                           c4_hi, c4_lo);
    var T1_lo = sum64_5_lo(c0_hi, c0_lo,
                           c1_hi, c1_lo,
                           c2_hi, c2_lo,
                           c3_hi, c3_lo,
                           c4_hi, c4_lo);

    var c0_hi = s0_512_hi(ah, al);
    var c0_lo = s0_512_lo(ah, al);
    var c1_hi = maj64_hi(ah, al, bh, bl, ch, cl);
    var c1_lo = maj64_lo(ah, al, bh, bl, ch, cl);

    var T2_hi = sum64_hi(c0_hi, c0_lo, c1_hi, c1_lo);
    var T2_lo = sum64_lo(c0_hi, c0_lo, c1_hi, c1_lo);

    hh = gh;
    hl = gl;

    gh = fh;
    gl = fl;

    fh = eh;
    fl = el;

    eh = sum64_hi(dh, dl, T1_hi, T1_lo);
    el = sum64_lo(dl, dl, T1_hi, T1_lo);

    dh = ch;
    dl = cl;

    ch = bh;
    cl = bl;

    bh = ah;
    bl = al;

    ah = sum64_hi(T1_hi, T1_lo, T2_hi, T2_lo);
    al = sum64_lo(T1_hi, T1_lo, T2_hi, T2_lo);
  }

  sum64(this.h, 0, ah, al);
  sum64(this.h, 2, bh, bl);
  sum64(this.h, 4, ch, cl);
  sum64(this.h, 6, dh, dl);
  sum64(this.h, 8, eh, el);
  sum64(this.h, 10, fh, fl);
  sum64(this.h, 12, gh, gl);
  sum64(this.h, 14, hh, hl);
};

SHA512.prototype._digest = function digest(enc) {
  if (enc === 'hex')
    return utils.toHex32(this.h, 'big');
  else
    return utils.split32(this.h, 'big');
};

function SHA384() {
  if (!(this instanceof SHA384))
    return new SHA384();

  SHA512.call(this);
  this.h = [ 0xcbbb9d5d, 0xc1059ed8,
             0x629a292a, 0x367cd507,
             0x9159015a, 0x3070dd17,
             0x152fecd8, 0xf70e5939,
             0x67332667, 0xffc00b31,
             0x8eb44a87, 0x68581511,
             0xdb0c2e0d, 0x64f98fa7,
             0x47b5481d, 0xbefa4fa4 ];
}
utils.inherits(SHA384, SHA512);
exports.sha384 = SHA384;

SHA384.blockSize = 1024;
SHA384.outSize = 384;
SHA384.hmacStrength = 192;
SHA384.padLength = 128;

SHA384.prototype._digest = function digest(enc) {
  if (enc === 'hex')
    return utils.toHex32(this.h.slice(0, 12), 'big');
  else
    return utils.split32(this.h.slice(0, 12), 'big');
};

function SHA1() {
  if (!(this instanceof SHA1))
    return new SHA1();

  BlockHash.call(this);
  this.h = [ 0x67452301, 0xefcdab89, 0x98badcfe,
             0x10325476, 0xc3d2e1f0 ];
  this.W = new Array(80);
}

utils.inherits(SHA1, BlockHash);
exports.sha1 = SHA1;

SHA1.blockSize = 512;
SHA1.outSize = 160;
SHA1.hmacStrength = 80;
SHA1.padLength = 64;

SHA1.prototype._update = function _update(msg, start) {
  var W = this.W;

  for (var i = 0; i < 16; i++)
    W[i] = msg[start + i];

  for(; i < W.length; i++)
    W[i] = rotl32(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16], 1);

  var a = this.h[0];
  var b = this.h[1];
  var c = this.h[2];
  var d = this.h[3];
  var e = this.h[4];

  for (var i = 0; i < W.length; i++) {
    var s = ~~(i / 20);
    var t = sum32_5(rotl32(a, 5), ft_1(s, b, c, d), e, W[i], sha1_K[s]);
    e = d;
    d = c;
    c = rotl32(b, 30);
    b = a;
    a = t;
  }

  this.h[0] = sum32(this.h[0], a);
  this.h[1] = sum32(this.h[1], b);
  this.h[2] = sum32(this.h[2], c);
  this.h[3] = sum32(this.h[3], d);
  this.h[4] = sum32(this.h[4], e);
};

SHA1.prototype._digest = function digest(enc) {
  if (enc === 'hex')
    return utils.toHex32(this.h, 'big');
  else
    return utils.split32(this.h, 'big');
};

function ch32(x, y, z) {
  return (x & y) ^ ((~x) & z);
}

function maj32(x, y, z) {
  return (x & y) ^ (x & z) ^ (y & z);
}

function p32(x, y, z) {
  return x ^ y ^ z;
}

function s0_256(x) {
  return rotr32(x, 2) ^ rotr32(x, 13) ^ rotr32(x, 22);
}

function s1_256(x) {
  return rotr32(x, 6) ^ rotr32(x, 11) ^ rotr32(x, 25);
}

function g0_256(x) {
  return rotr32(x, 7) ^ rotr32(x, 18) ^ (x >>> 3);
}

function g1_256(x) {
  return rotr32(x, 17) ^ rotr32(x, 19) ^ (x >>> 10);
}

function ft_1(s, x, y, z) {
  if (s === 0)
    return ch32(x, y, z);
  if (s === 1 || s === 3)
    return p32(x, y, z);
  if (s === 2)
    return maj32(x, y, z);
}

function ch64_hi(xh, xl, yh, yl, zh, zl) {
  var r = (xh & yh) ^ ((~xh) & zh);
  if (r < 0)
    r += 0x100000000;
  return r;
}

function ch64_lo(xh, xl, yh, yl, zh, zl) {
  var r = (xl & yl) ^ ((~xl) & zl);
  if (r < 0)
    r += 0x100000000;
  return r;
}

function maj64_hi(xh, xl, yh, yl, zh, zl) {
  var r = (xh & yh) ^ (xh & zh) ^ (yh & zh);
  if (r < 0)
    r += 0x100000000;
  return r;
}

function maj64_lo(xh, xl, yh, yl, zh, zl) {
  var r = (xl & yl) ^ (xl & zl) ^ (yl & zl);
  if (r < 0)
    r += 0x100000000;
  return r;
}

function s0_512_hi(xh, xl) {
  var c0_hi = rotr64_hi(xh, xl, 28);
  var c1_hi = rotr64_hi(xl, xh, 2);  // 34
  var c2_hi = rotr64_hi(xl, xh, 7);  // 39

  var r = c0_hi ^ c1_hi ^ c2_hi;
  if (r < 0)
    r += 0x100000000;
  return r;
}

function s0_512_lo(xh, xl) {
  var c0_lo = rotr64_lo(xh, xl, 28);
  var c1_lo = rotr64_lo(xl, xh, 2);  // 34
  var c2_lo = rotr64_lo(xl, xh, 7);  // 39

  var r = c0_lo ^ c1_lo ^ c2_lo;
  if (r < 0)
    r += 0x100000000;
  return r;
}

function s1_512_hi(xh, xl) {
  var c0_hi = rotr64_hi(xh, xl, 14);
  var c1_hi = rotr64_hi(xh, xl, 18);
  var c2_hi = rotr64_hi(xl, xh, 9);  // 41

  var r = c0_hi ^ c1_hi ^ c2_hi;
  if (r < 0)
    r += 0x100000000;
  return r;
}

function s1_512_lo(xh, xl) {
  var c0_lo = rotr64_lo(xh, xl, 14);
  var c1_lo = rotr64_lo(xh, xl, 18);
  var c2_lo = rotr64_lo(xl, xh, 9);  // 41

  var r = c0_lo ^ c1_lo ^ c2_lo;
  if (r < 0)
    r += 0x100000000;
  return r;
}

function g0_512_hi(xh, xl) {
  var c0_hi = rotr64_hi(xh, xl, 1);
  var c1_hi = rotr64_hi(xh, xl, 8);
  var c2_hi = shr64_hi(xh, xl, 7);

  var r = c0_hi ^ c1_hi ^ c2_hi;
  if (r < 0)
    r += 0x100000000;
  return r;
}

function g0_512_lo(xh, xl) {
  var c0_lo = rotr64_lo(xh, xl, 1);
  var c1_lo = rotr64_lo(xh, xl, 8);
  var c2_lo = shr64_lo(xh, xl, 7);

  var r = c0_lo ^ c1_lo ^ c2_lo;
  if (r < 0)
    r += 0x100000000;
  return r;
}

function g1_512_hi(xh, xl) {
  var c0_hi = rotr64_hi(xh, xl, 19);
  var c1_hi = rotr64_hi(xl, xh, 29);  // 61
  var c2_hi = shr64_hi(xh, xl, 6);

  var r = c0_hi ^ c1_hi ^ c2_hi;
  if (r < 0)
    r += 0x100000000;
  return r;
}

function g1_512_lo(xh, xl) {
  var c0_lo = rotr64_lo(xh, xl, 19);
  var c1_lo = rotr64_lo(xl, xh, 29);  // 61
  var c2_lo = shr64_lo(xh, xl, 6);

  var r = c0_lo ^ c1_lo ^ c2_lo;
  if (r < 0)
    r += 0x100000000;
  return r;
}

},{"../hash":359}],364:[function(require,module,exports){
var utils = exports;
var inherits = require('inherits');

function toArray(msg, enc) {
  if (Array.isArray(msg))
    return msg.slice();
  if (!msg)
    return [];
  var res = [];
  if (typeof msg === 'string') {
    if (!enc) {
      for (var i = 0; i < msg.length; i++) {
        var c = msg.charCodeAt(i);
        var hi = c >> 8;
        var lo = c & 0xff;
        if (hi)
          res.push(hi, lo);
        else
          res.push(lo);
      }
    } else if (enc === 'hex') {
      msg = msg.replace(/[^a-z0-9]+/ig, '');
      if (msg.length % 2 !== 0)
        msg = '0' + msg;
      for (var i = 0; i < msg.length; i += 2)
        res.push(parseInt(msg[i] + msg[i + 1], 16));
    }
  } else {
    for (var i = 0; i < msg.length; i++)
      res[i] = msg[i] | 0;
  }
  return res;
}
utils.toArray = toArray;

function toHex(msg) {
  var res = '';
  for (var i = 0; i < msg.length; i++)
    res += zero2(msg[i].toString(16));
  return res;
}
utils.toHex = toHex;

function htonl(w) {
  var res = (w >>> 24) |
            ((w >>> 8) & 0xff00) |
            ((w << 8) & 0xff0000) |
            ((w & 0xff) << 24);
  return res >>> 0;
}
utils.htonl = htonl;

function toHex32(msg, endian) {
  var res = '';
  for (var i = 0; i < msg.length; i++) {
    var w = msg[i];
    if (endian === 'little')
      w = htonl(w);
    res += zero8(w.toString(16));
  }
  return res;
}
utils.toHex32 = toHex32;

function zero2(word) {
  if (word.length === 1)
    return '0' + word;
  else
    return word;
}
utils.zero2 = zero2;

function zero8(word) {
  if (word.length === 7)
    return '0' + word;
  else if (word.length === 6)
    return '00' + word;
  else if (word.length === 5)
    return '000' + word;
  else if (word.length === 4)
    return '0000' + word;
  else if (word.length === 3)
    return '00000' + word;
  else if (word.length === 2)
    return '000000' + word;
  else if (word.length === 1)
    return '0000000' + word;
  else
    return word;
}
utils.zero8 = zero8;

function join32(msg, start, end, endian) {
  var len = end - start;
  assert(len % 4 === 0);
  var res = new Array(len / 4);
  for (var i = 0, k = start; i < res.length; i++, k += 4) {
    var w;
    if (endian === 'big')
      w = (msg[k] << 24) | (msg[k + 1] << 16) | (msg[k + 2] << 8) | msg[k + 3];
    else
      w = (msg[k + 3] << 24) | (msg[k + 2] << 16) | (msg[k + 1] << 8) | msg[k];
    res[i] = w >>> 0;
  }
  return res;
}
utils.join32 = join32;

function split32(msg, endian) {
  var res = new Array(msg.length * 4);
  for (var i = 0, k = 0; i < msg.length; i++, k += 4) {
    var m = msg[i];
    if (endian === 'big') {
      res[k] = m >>> 24;
      res[k + 1] = (m >>> 16) & 0xff;
      res[k + 2] = (m >>> 8) & 0xff;
      res[k + 3] = m & 0xff;
    } else {
      res[k + 3] = m >>> 24;
      res[k + 2] = (m >>> 16) & 0xff;
      res[k + 1] = (m >>> 8) & 0xff;
      res[k] = m & 0xff;
    }
  }
  return res;
}
utils.split32 = split32;

function rotr32(w, b) {
  return (w >>> b) | (w << (32 - b));
}
utils.rotr32 = rotr32;

function rotl32(w, b) {
  return (w << b) | (w >>> (32 - b));
}
utils.rotl32 = rotl32;

function sum32(a, b) {
  return (a + b) >>> 0;
}
utils.sum32 = sum32;

function sum32_3(a, b, c) {
  return (a + b + c) >>> 0;
}
utils.sum32_3 = sum32_3;

function sum32_4(a, b, c, d) {
  return (a + b + c + d) >>> 0;
}
utils.sum32_4 = sum32_4;

function sum32_5(a, b, c, d, e) {
  return (a + b + c + d + e) >>> 0;
}
utils.sum32_5 = sum32_5;

function assert(cond, msg) {
  if (!cond)
    throw new Error(msg || 'Assertion failed');
}
utils.assert = assert;

utils.inherits = inherits;

function sum64(buf, pos, ah, al) {
  var bh = buf[pos];
  var bl = buf[pos + 1];

  var lo = (al + bl) >>> 0;
  var hi = (lo < al ? 1 : 0) + ah + bh;
  buf[pos] = hi >>> 0;
  buf[pos + 1] = lo;
}
exports.sum64 = sum64;

function sum64_hi(ah, al, bh, bl) {
  var lo = (al + bl) >>> 0;
  var hi = (lo < al ? 1 : 0) + ah + bh;
  return hi >>> 0;
};
exports.sum64_hi = sum64_hi;

function sum64_lo(ah, al, bh, bl) {
  var lo = al + bl;
  return lo >>> 0;
};
exports.sum64_lo = sum64_lo;

function sum64_4_hi(ah, al, bh, bl, ch, cl, dh, dl) {
  var carry = 0;
  var lo = al;
  lo = (lo + bl) >>> 0;
  carry += lo < al ? 1 : 0;
  lo = (lo + cl) >>> 0;
  carry += lo < cl ? 1 : 0;
  lo = (lo + dl) >>> 0;
  carry += lo < dl ? 1 : 0;

  var hi = ah + bh + ch + dh + carry;
  return hi >>> 0;
};
exports.sum64_4_hi = sum64_4_hi;

function sum64_4_lo(ah, al, bh, bl, ch, cl, dh, dl) {
  var lo = al + bl + cl + dl;
  return lo >>> 0;
};
exports.sum64_4_lo = sum64_4_lo;

function sum64_5_hi(ah, al, bh, bl, ch, cl, dh, dl, eh, el) {
  var carry = 0;
  var lo = al;
  lo = (lo + bl) >>> 0;
  carry += lo < al ? 1 : 0;
  lo = (lo + cl) >>> 0;
  carry += lo < cl ? 1 : 0;
  lo = (lo + dl) >>> 0;
  carry += lo < dl ? 1 : 0;
  lo = (lo + el) >>> 0;
  carry += lo < el ? 1 : 0;

  var hi = ah + bh + ch + dh + eh + carry;
  return hi >>> 0;
};
exports.sum64_5_hi = sum64_5_hi;

function sum64_5_lo(ah, al, bh, bl, ch, cl, dh, dl, eh, el) {
  var lo = al + bl + cl + dl + el;

  return lo >>> 0;
};
exports.sum64_5_lo = sum64_5_lo;

function rotr64_hi(ah, al, num) {
  var r = (al << (32 - num)) | (ah >>> num);
  return r >>> 0;
};
exports.rotr64_hi = rotr64_hi;

function rotr64_lo(ah, al, num) {
  var r = (ah << (32 - num)) | (al >>> num);
  return r >>> 0;
};
exports.rotr64_lo = rotr64_lo;

function shr64_hi(ah, al, num) {
  return ah >>> num;
};
exports.shr64_hi = shr64_hi;

function shr64_lo(ah, al, num) {
  var r = (ah << (32 - num)) | (al >>> num);
  return r >>> 0;
};
exports.shr64_lo = shr64_lo;

},{"inherits":500}],365:[function(require,module,exports){
module.exports={
  "name": "elliptic",
  "version": "6.2.3",
  "description": "EC cryptography",
  "main": "lib/elliptic.js",
  "files": [
    "lib"
  ],
  "scripts": {
    "coverage": "npm run unit --coverage",
    "coveralls": "npm run coverage && cat ./coverage/lcov.info | coveralls",
    "jscs": "jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/*.js",
    "jshint": "jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/*.js",
    "lint": "npm run jscs && npm run jshint",
    "test": "npm run lint && npm run unit",
    "unit": "istanbul test _mocha --reporter=spec test/*-test.js"
  },
  "repository": {
    "type": "git",
    "url": "git+ssh://git@github.com/indutny/elliptic.git"
  },
  "keywords": [
    "EC",
    "Elliptic",
    "curve",
    "Cryptography"
  ],
  "author": {
    "name": "Fedor Indutny",
    "email": "fedor@indutny.com"
  },
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/indutny/elliptic/issues"
  },
  "homepage": "https://github.com/indutny/elliptic",
  "devDependencies": {
    "coveralls": "^2.11.3",
    "istanbul": "^0.4.2",
    "jscs": "^2.9.0",
    "jshint": "^2.6.0",
    "mocha": "^2.1.0"
  },
  "dependencies": {
    "bn.js": "^4.0.0",
    "brorand": "^1.0.1",
    "hash.js": "^1.0.0",
    "inherits": "^2.0.1"
  },
  "gitHead": "c32f20b22b420eb6af3c6dda28963deb7facf823",
  "_id": "elliptic@6.2.3",
  "_shasum": "18e46d7306b0951275a2d42063270a14b74ebe99",
  "_from": "elliptic@>=6.0.0 <7.0.0",
  "_npmVersion": "3.3.12",
  "_nodeVersion": "5.4.1",
  "_npmUser": {
    "name": "indutny",
    "email": "fedor@indutny.com"
  },
  "dist": {
    "shasum": "18e46d7306b0951275a2d42063270a14b74ebe99",
    "tarball": "http://registry.npmjs.org/elliptic/-/elliptic-6.2.3.tgz"
  },
  "maintainers": [
    {
      "name": "indutny",
      "email": "fedor@indutny.com"
    }
  ],
  "directories": {},
  "_resolved": "https://registry.npmjs.org/elliptic/-/elliptic-6.2.3.tgz",
  "readme": "ERROR: No README data found!"
}

},{}],366:[function(require,module,exports){
module.exports={"2.16.840.1.101.3.4.1.1": "aes-128-ecb",
"2.16.840.1.101.3.4.1.2": "aes-128-cbc",
"2.16.840.1.101.3.4.1.3": "aes-128-ofb",
"2.16.840.1.101.3.4.1.4": "aes-128-cfb",
"2.16.840.1.101.3.4.1.21": "aes-192-ecb",
"2.16.840.1.101.3.4.1.22": "aes-192-cbc",
"2.16.840.1.101.3.4.1.23": "aes-192-ofb",
"2.16.840.1.101.3.4.1.24": "aes-192-cfb",
"2.16.840.1.101.3.4.1.41": "aes-256-ecb",
"2.16.840.1.101.3.4.1.42": "aes-256-cbc",
"2.16.840.1.101.3.4.1.43": "aes-256-ofb",
"2.16.840.1.101.3.4.1.44": "aes-256-cfb"
}
},{}],367:[function(require,module,exports){
// from https://github.com/indutny/self-signed/blob/gh-pages/lib/asn1.js
// Fedor, you are amazing.

var asn1 = require('asn1.js')

var RSAPrivateKey = asn1.define('RSAPrivateKey', function () {
  this.seq().obj(
    this.key('version').int(),
    this.key('modulus').int(),
    this.key('publicExponent').int(),
    this.key('privateExponent').int(),
    this.key('prime1').int(),
    this.key('prime2').int(),
    this.key('exponent1').int(),
    this.key('exponent2').int(),
    this.key('coefficient').int()
  )
})
exports.RSAPrivateKey = RSAPrivateKey

var RSAPublicKey = asn1.define('RSAPublicKey', function () {
  this.seq().obj(
    this.key('modulus').int(),
    this.key('publicExponent').int()
  )
})
exports.RSAPublicKey = RSAPublicKey

var PublicKey = asn1.define('SubjectPublicKeyInfo', function () {
  this.seq().obj(
    this.key('algorithm').use(AlgorithmIdentifier),
    this.key('subjectPublicKey').bitstr()
  )
})
exports.PublicKey = PublicKey

var AlgorithmIdentifier = asn1.define('AlgorithmIdentifier', function () {
  this.seq().obj(
    this.key('algorithm').objid(),
    this.key('none').null_().optional(),
    this.key('curve').objid().optional(),
    this.key('params').seq().obj(
      this.key('p').int(),
      this.key('q').int(),
      this.key('g').int()
    ).optional()
  )
})

var PrivateKeyInfo = asn1.define('PrivateKeyInfo', function () {
  this.seq().obj(
    this.key('version').int(),
    this.key('algorithm').use(AlgorithmIdentifier),
    this.key('subjectPrivateKey').octstr()
  )
})
exports.PrivateKey = PrivateKeyInfo
var EncryptedPrivateKeyInfo = asn1.define('EncryptedPrivateKeyInfo', function () {
  this.seq().obj(
    this.key('algorithm').seq().obj(
      this.key('id').objid(),
      this.key('decrypt').seq().obj(
        this.key('kde').seq().obj(
          this.key('id').objid(),
          this.key('kdeparams').seq().obj(
            this.key('salt').octstr(),
            this.key('iters').int()
          )
        ),
        this.key('cipher').seq().obj(
          this.key('algo').objid(),
          this.key('iv').octstr()
        )
      )
    ),
    this.key('subjectPrivateKey').octstr()
  )
})

exports.EncryptedPrivateKey = EncryptedPrivateKeyInfo

var DSAPrivateKey = asn1.define('DSAPrivateKey', function () {
  this.seq().obj(
    this.key('version').int(),
    this.key('p').int(),
    this.key('q').int(),
    this.key('g').int(),
    this.key('pub_key').int(),
    this.key('priv_key').int()
  )
})
exports.DSAPrivateKey = DSAPrivateKey

exports.DSAparam = asn1.define('DSAparam', function () {
  this.int()
})
var ECPrivateKey = asn1.define('ECPrivateKey', function () {
  this.seq().obj(
    this.key('version').int(),
    this.key('privateKey').octstr(),
    this.key('parameters').optional().explicit(0).use(ECParameters),
    this.key('publicKey').optional().explicit(1).bitstr()
  )
})
exports.ECPrivateKey = ECPrivateKey
var ECParameters = asn1.define('ECParameters', function () {
  this.choice({
    namedCurve: this.objid()
  })
})

exports.signature = asn1.define('signature', function () {
  this.seq().obj(
    this.key('r').int(),
    this.key('s').int()
  )
})

},{"asn1.js":370}],368:[function(require,module,exports){
(function (Buffer){
// adapted from https://github.com/apatil/pemstrip
var findProc = /Proc-Type: 4,ENCRYPTED\r?\nDEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)\r?\n\r?\n([0-9A-z\n\r\+\/\=]+)\r?\n/m
var startRegex = /^-----BEGIN (.*) KEY-----\r?\n/m
var fullRegex = /^-----BEGIN (.*) KEY-----\r?\n([0-9A-z\n\r\+\/\=]+)\r?\n-----END \1 KEY-----$/m
var evp = require('evp_bytestokey')
var ciphers = require('browserify-aes')
module.exports = function (okey, password) {
  var key = okey.toString()
  var match = key.match(findProc)
  var decrypted
  if (!match) {
    var match2 = key.match(fullRegex)
    decrypted = new Buffer(match2[2].replace(/\r?\n/g, ''), 'base64')
  } else {
    var suite = 'aes' + match[1]
    var iv = new Buffer(match[2], 'hex')
    var cipherText = new Buffer(match[3].replace(/\r?\n/g, ''), 'base64')
    var cipherKey = evp(password, iv.slice(0, 8), parseInt(match[1], 10)).key
    var out = []
    var cipher = ciphers.createDecipheriv(suite, cipherKey, iv)
    out.push(cipher.update(cipherText))
    out.push(cipher.final())
    decrypted = Buffer.concat(out)
  }
  var tag = key.match(startRegex)[1] + ' KEY'
  return {
    tag: tag,
    data: decrypted
  }
}

}).call(this,require("buffer").Buffer)
},{"browserify-aes":387,"buffer":303,"evp_bytestokey":402}],369:[function(require,module,exports){
(function (Buffer){
var asn1 = require('./asn1')
var aesid = require('./aesid.json')
var fixProc = require('./fixProc')
var ciphers = require('browserify-aes')
var compat = require('pbkdf2')
module.exports = parseKeys

function parseKeys (buffer) {
  var password
  if (typeof buffer === 'object' && !Buffer.isBuffer(buffer)) {
    password = buffer.passphrase
    buffer = buffer.key
  }
  if (typeof buffer === 'string') {
    buffer = new Buffer(buffer)
  }

  var stripped = fixProc(buffer, password)

  var type = stripped.tag
  var data = stripped.data
  var subtype, ndata
  switch (type) {
    case 'PUBLIC KEY':
      ndata = asn1.PublicKey.decode(data, 'der')
      subtype = ndata.algorithm.algorithm.join('.')
      switch (subtype) {
        case '1.2.840.113549.1.1.1':
          return asn1.RSAPublicKey.decode(ndata.subjectPublicKey.data, 'der')
        case '1.2.840.10045.2.1':
          ndata.subjectPrivateKey = ndata.subjectPublicKey
          return {
            type: 'ec',
            data: ndata
          }
        case '1.2.840.10040.4.1':
          ndata.algorithm.params.pub_key = asn1.DSAparam.decode(ndata.subjectPublicKey.data, 'der')
          return {
            type: 'dsa',
            data: ndata.algorithm.params
          }
        default: throw new Error('unknown key id ' + subtype)
      }
      throw new Error('unknown key type ' + type)
    case 'ENCRYPTED PRIVATE KEY':
      data = asn1.EncryptedPrivateKey.decode(data, 'der')
      data = decrypt(data, password)
      // falls through
    case 'PRIVATE KEY':
      ndata = asn1.PrivateKey.decode(data, 'der')
      subtype = ndata.algorithm.algorithm.join('.')
      switch (subtype) {
        case '1.2.840.113549.1.1.1':
          return asn1.RSAPrivateKey.decode(ndata.subjectPrivateKey, 'der')
        case '1.2.840.10045.2.1':
          return {
            curve: ndata.algorithm.curve,
            privateKey: asn1.ECPrivateKey.decode(ndata.subjectPrivateKey, 'der').privateKey
          }
        case '1.2.840.10040.4.1':
          ndata.algorithm.params.priv_key = asn1.DSAparam.decode(ndata.subjectPrivateKey, 'der')
          return {
            type: 'dsa',
            params: ndata.algorithm.params
          }
        default: throw new Error('unknown key id ' + subtype)
      }
      throw new Error('unknown key type ' + type)
    case 'RSA PUBLIC KEY':
      return asn1.RSAPublicKey.decode(data, 'der')
    case 'RSA PRIVATE KEY':
      return asn1.RSAPrivateKey.decode(data, 'der')
    case 'DSA PRIVATE KEY':
      return {
        type: 'dsa',
        params: asn1.DSAPrivateKey.decode(data, 'der')
      }
    case 'EC PRIVATE KEY':
      data = asn1.ECPrivateKey.decode(data, 'der')
      return {
        curve: data.parameters.value,
        privateKey: data.privateKey
      }
    default: throw new Error('unknown key type ' + type)
  }
}
parseKeys.signature = asn1.signature
function decrypt (data, password) {
  var salt = data.algorithm.decrypt.kde.kdeparams.salt
  var iters = parseInt(data.algorithm.decrypt.kde.kdeparams.iters.toString(), 10)
  var algo = aesid[data.algorithm.decrypt.cipher.algo.join('.')]
  var iv = data.algorithm.decrypt.cipher.iv
  var cipherText = data.subjectPrivateKey
  var keylen = parseInt(algo.split('-')[1], 10) / 8
  var key = compat.pbkdf2Sync(password, salt, iters, keylen)
  var cipher = ciphers.createDecipheriv(algo, key, iv)
  var out = []
  out.push(cipher.update(cipherText))
  out.push(cipher.final())
  return Buffer.concat(out)
}

}).call(this,require("buffer").Buffer)
},{"./aesid.json":366,"./asn1":367,"./fixProc":368,"browserify-aes":387,"buffer":303,"pbkdf2":452}],370:[function(require,module,exports){
var asn1 = exports;

asn1.bignum = require('bn.js');

asn1.define = require('./asn1/api').define;
asn1.base = require('./asn1/base');
asn1.constants = require('./asn1/constants');
asn1.decoders = require('./asn1/decoders');
asn1.encoders = require('./asn1/encoders');

},{"./asn1/api":371,"./asn1/base":373,"./asn1/constants":377,"./asn1/decoders":379,"./asn1/encoders":382,"bn.js":340}],371:[function(require,module,exports){
var asn1 = require('../asn1');
var inherits = require('inherits');

var api = exports;

api.define = function define(name, body) {
  return new Entity(name, body);
};

function Entity(name, body) {
  this.name = name;
  this.body = body;

  this.decoders = {};
  this.encoders = {};
};

Entity.prototype._createNamed = function createNamed(base) {
  var named;
  try {
    named = require('vm').runInThisContext(
      '(function ' + this.name + '(entity) {\n' +
      '  this._initNamed(entity);\n' +
      '})'
    );
  } catch (e) {
    named = function (entity) {
      this._initNamed(entity);
    };
  }
  inherits(named, base);
  named.prototype._initNamed = function initnamed(entity) {
    base.call(this, entity);
  };

  return new named(this);
};

Entity.prototype._getDecoder = function _getDecoder(enc) {
  // Lazily create decoder
  if (!this.decoders.hasOwnProperty(enc))
    this.decoders[enc] = this._createNamed(asn1.decoders[enc]);
  return this.decoders[enc];
};

Entity.prototype.decode = function decode(data, enc, options) {
  return this._getDecoder(enc).decode(data, options);
};

Entity.prototype._getEncoder = function _getEncoder(enc) {
  // Lazily create encoder
  if (!this.encoders.hasOwnProperty(enc))
    this.encoders[enc] = this._createNamed(asn1.encoders[enc]);
  return this.encoders[enc];
};

Entity.prototype.encode = function encode(data, enc, /* internal */ reporter) {
  return this._getEncoder(enc).encode(data, reporter);
};

},{"../asn1":370,"inherits":500,"vm":524}],372:[function(require,module,exports){
var inherits = require('inherits');
var Reporter = require('../base').Reporter;
var Buffer = require('buffer').Buffer;

function DecoderBuffer(base, options) {
  Reporter.call(this, options);
  if (!Buffer.isBuffer(base)) {
    this.error('Input not Buffer');
    return;
  }

  this.base = base;
  this.offset = 0;
  this.length = base.length;
}
inherits(DecoderBuffer, Reporter);
exports.DecoderBuffer = DecoderBuffer;

DecoderBuffer.prototype.save = function save() {
  return { offset: this.offset, reporter: Reporter.prototype.save.call(this) };
};

DecoderBuffer.prototype.restore = function restore(save) {
  // Return skipped data
  var res = new DecoderBuffer(this.base);
  res.offset = save.offset;
  res.length = this.offset;

  this.offset = save.offset;
  Reporter.prototype.restore.call(this, save.reporter);

  return res;
};

DecoderBuffer.prototype.isEmpty = function isEmpty() {
  return this.offset === this.length;
};

DecoderBuffer.prototype.readUInt8 = function readUInt8(fail) {
  if (this.offset + 1 <= this.length)
    return this.base.readUInt8(this.offset++, true);
  else
    return this.error(fail || 'DecoderBuffer overrun');
}

DecoderBuffer.prototype.skip = function skip(bytes, fail) {
  if (!(this.offset + bytes <= this.length))
    return this.error(fail || 'DecoderBuffer overrun');

  var res = new DecoderBuffer(this.base);

  // Share reporter state
  res._reporterState = this._reporterState;

  res.offset = this.offset;
  res.length = this.offset + bytes;
  this.offset += bytes;
  return res;
}

DecoderBuffer.prototype.raw = function raw(save) {
  return this.base.slice(save ? save.offset : this.offset, this.length);
}

function EncoderBuffer(value, reporter) {
  if (Array.isArray(value)) {
    this.length = 0;
    this.value = value.map(function(item) {
      if (!(item instanceof EncoderBuffer))
        item = new EncoderBuffer(item, reporter);
      this.length += item.length;
      return item;
    }, this);
  } else if (typeof value === 'number') {
    if (!(0 <= value && value <= 0xff))
      return reporter.error('non-byte EncoderBuffer value');
    this.value = value;
    this.length = 1;
  } else if (typeof value === 'string') {
    this.value = value;
    this.length = Buffer.byteLength(value);
  } else if (Buffer.isBuffer(value)) {
    this.value = value;
    this.length = value.length;
  } else {
    return reporter.error('Unsupported type: ' + typeof value);
  }
}
exports.EncoderBuffer = EncoderBuffer;

EncoderBuffer.prototype.join = function join(out, offset) {
  if (!out)
    out = new Buffer(this.length);
  if (!offset)
    offset = 0;

  if (this.length === 0)
    return out;

  if (Array.isArray(this.value)) {
    this.value.forEach(function(item) {
      item.join(out, offset);
      offset += item.length;
    });
  } else {
    if (typeof this.value === 'number')
      out[offset] = this.value;
    else if (typeof this.value === 'string')
      out.write(this.value, offset);
    else if (Buffer.isBuffer(this.value))
      this.value.copy(out, offset);
    offset += this.length;
  }

  return out;
};

},{"../base":373,"buffer":303,"inherits":500}],373:[function(require,module,exports){
var base = exports;

base.Reporter = require('./reporter').Reporter;
base.DecoderBuffer = require('./buffer').DecoderBuffer;
base.EncoderBuffer = require('./buffer').EncoderBuffer;
base.Node = require('./node');

},{"./buffer":372,"./node":374,"./reporter":375}],374:[function(require,module,exports){
var Reporter = require('../base').Reporter;
var EncoderBuffer = require('../base').EncoderBuffer;
var DecoderBuffer = require('../base').DecoderBuffer;
var assert = require('minimalistic-assert');

// Supported tags
var tags = [
  'seq', 'seqof', 'set', 'setof', 'octstr', 'bitstr', 'objid', 'bool',
  'gentime', 'utctime', 'null_', 'enum', 'int', 'ia5str', 'utf8str', 'bmpstr',
  'numstr', 'printstr'
];

// Public methods list
var methods = [
  'key', 'obj', 'use', 'optional', 'explicit', 'implicit', 'def', 'choice',
  'any', 'contains'
].concat(tags);

// Overrided methods list
var overrided = [
  '_peekTag', '_decodeTag', '_use',
  '_decodeStr', '_decodeObjid', '_decodeTime',
  '_decodeNull', '_decodeInt', '_decodeBool', '_decodeList',

  '_encodeComposite', '_encodeStr', '_encodeObjid', '_encodeTime',
  '_encodeNull', '_encodeInt', '_encodeBool'
];

function Node(enc, parent) {
  var state = {};
  this._baseState = state;

  state.enc = enc;

  state.parent = parent || null;
  state.children = null;

  // State
  state.tag = null;
  state.args = null;
  state.reverseArgs = null;
  state.choice = null;
  state.optional = false;
  state.any = false;
  state.obj = false;
  state.use = null;
  state.useDecoder = null;
  state.key = null;
  state['default'] = null;
  state.explicit = null;
  state.implicit = null;
  state.contains = null;

  // Should create new instance on each method
  if (!state.parent) {
    state.children = [];
    this._wrap();
  }
}
module.exports = Node;

var stateProps = [
  'enc', 'parent', 'children', 'tag', 'args', 'reverseArgs', 'choice',
  'optional', 'any', 'obj', 'use', 'alteredUse', 'key', 'default', 'explicit',
  'implicit'
];

Node.prototype.clone = function clone() {
  var state = this._baseState;
  var cstate = {};
  stateProps.forEach(function(prop) {
    cstate[prop] = state[prop];
  });
  var res = new this.constructor(cstate.parent);
  res._baseState = cstate;
  return res;
};

Node.prototype._wrap = function wrap() {
  var state = this._baseState;
  methods.forEach(function(method) {
    this[method] = function _wrappedMethod() {
      var clone = new this.constructor(this);
      state.children.push(clone);
      return clone[method].apply(clone, arguments);
    };
  }, this);
};

Node.prototype._init = function init(body) {
  var state = this._baseState;

  assert(state.parent === null);
  body.call(this);

  // Filter children
  state.children = state.children.filter(function(child) {
    return child._baseState.parent === this;
  }, this);
  assert.equal(state.children.length, 1, 'Root node can have only one child');
};

Node.prototype._useArgs = function useArgs(args) {
  var state = this._baseState;

  // Filter children and args
  var children = args.filter(function(arg) {
    return arg instanceof this.constructor;
  }, this);
  args = args.filter(function(arg) {
    return !(arg instanceof this.constructor);
  }, this);

  if (children.length !== 0) {
    assert(state.children === null);
    state.children = children;

    // Replace parent to maintain backward link
    children.forEach(function(child) {
      child._baseState.parent = this;
    }, this);
  }
  if (args.length !== 0) {
    assert(state.args === null);
    state.args = args;
    state.reverseArgs = args.map(function(arg) {
      if (typeof arg !== 'object' || arg.constructor !== Object)
        return arg;

      var res = {};
      Object.keys(arg).forEach(function(key) {
        if (key == (key | 0))
          key |= 0;
        var value = arg[key];
        res[value] = key;
      });
      return res;
    });
  }
};

//
// Overrided methods
//

overrided.forEach(function(method) {
  Node.prototype[method] = function _overrided() {
    var state = this._baseState;
    throw new Error(method + ' not implemented for encoding: ' + state.enc);
  };
});

//
// Public methods
//

tags.forEach(function(tag) {
  Node.prototype[tag] = function _tagMethod() {
    var state = this._baseState;
    var args = Array.prototype.slice.call(arguments);

    assert(state.tag === null);
    state.tag = tag;

    this._useArgs(args);

    return this;
  };
});

Node.prototype.use = function use(item) {
  var state = this._baseState;

  assert(state.use === null);
  state.use = item;

  return this;
};

Node.prototype.optional = function optional() {
  var state = this._baseState;

  state.optional = true;

  return this;
};

Node.prototype.def = function def(val) {
  var state = this._baseState;

  assert(state['default'] === null);
  state['default'] = val;
  state.optional = true;

  return this;
};

Node.prototype.explicit = function explicit(num) {
  var state = this._baseState;

  assert(state.explicit === null && state.implicit === null);
  state.explicit = num;

  return this;
};

Node.prototype.implicit = function implicit(num) {
  var state = this._baseState;

  assert(state.explicit === null && state.implicit === null);
  state.implicit = num;

  return this;
};

Node.prototype.obj = function obj() {
  var state = this._baseState;
  var args = Array.prototype.slice.call(arguments);

  state.obj = true;

  if (args.length !== 0)
    this._useArgs(args);

  return this;
};

Node.prototype.key = function key(newKey) {
  var state = this._baseState;

  assert(state.key === null);
  state.key = newKey;

  return this;
};

Node.prototype.any = function any() {
  var state = this._baseState;

  state.any = true;

  return this;
};

Node.prototype.choice = function choice(obj) {
  var state = this._baseState;

  assert(state.choice === null);
  state.choice = obj;
  this._useArgs(Object.keys(obj).map(function(key) {
    return obj[key];
  }));

  return this;
};

Node.prototype.contains = function contains(item) {
  var state = this._baseState;

  assert(state.use === null);
  state.contains = item;

  return this;
};

//
// Decoding
//

Node.prototype._decode = function decode(input) {
  var state = this._baseState;

  // Decode root node
  if (state.parent === null)
    return input.wrapResult(state.children[0]._decode(input));

  var result = state['default'];
  var present = true;

  var prevKey;
  if (state.key !== null)
    prevKey = input.enterKey(state.key);

  // Check if tag is there
  if (state.optional) {
    var tag = null;
    if (state.explicit !== null)
      tag = state.explicit;
    else if (state.implicit !== null)
      tag = state.implicit;
    else if (state.tag !== null)
      tag = state.tag;

    if (tag === null && !state.any) {
      // Trial and Error
      var save = input.save();
      try {
        if (state.choice === null)
          this._decodeGeneric(state.tag, input);
        else
          this._decodeChoice(input);
        present = true;
      } catch (e) {
        present = false;
      }
      input.restore(save);
    } else {
      present = this._peekTag(input, tag, state.any);

      if (input.isError(present))
        return present;
    }
  }

  // Push object on stack
  var prevObj;
  if (state.obj && present)
    prevObj = input.enterObject();

  if (present) {
    // Unwrap explicit values
    if (state.explicit !== null) {
      var explicit = this._decodeTag(input, state.explicit);
      if (input.isError(explicit))
        return explicit;
      input = explicit;
    }

    // Unwrap implicit and normal values
    if (state.use === null && state.choice === null) {
      if (state.any)
        var save = input.save();
      var body = this._decodeTag(
        input,
        state.implicit !== null ? state.implicit : state.tag,
        state.any
      );
      if (input.isError(body))
        return body;

      if (state.any)
        result = input.raw(save);
      else
        input = body;
    }

    // Select proper method for tag
    if (state.any)
      result = result;
    else if (state.choice === null)
      result = this._decodeGeneric(state.tag, input);
    else
      result = this._decodeChoice(input);

    if (input.isError(result))
      return result;

    // Decode children
    if (!state.any && state.choice === null && state.children !== null) {
      var fail = state.children.some(function decodeChildren(child) {
        // NOTE: We are ignoring errors here, to let parser continue with other
        // parts of encoded data
        child._decode(input);
      });
      if (fail)
        return err;
    }

    // Decode contained/encoded by schema, only in bit or octet strings
    if (state.contains && (state.tag === 'octstr' || state.tag === 'bitstr')) {
      var data = new DecoderBuffer(result);
      result = this._getUse(state.contains, input._reporterState.obj)._decode(data);
    }
  }

  // Pop object
  if (state.obj && present)
    result = input.leaveObject(prevObj);

  // Set key
  if (state.key !== null && (result !== null || present === true))
    input.leaveKey(prevKey, state.key, result);

  return result;
};

Node.prototype._decodeGeneric = function decodeGeneric(tag, input) {
  var state = this._baseState;

  if (tag === 'seq' || tag === 'set')
    return null;
  if (tag === 'seqof' || tag === 'setof')
    return this._decodeList(input, tag, state.args[0]);
  else if (tag === 'octstr' || tag === 'bitstr')
    return this._decodeStr(input, tag);
  else if (tag === 'ia5str' || tag === 'utf8str' || tag === 'bmpstr')
    return this._decodeStr(input, tag);
  else if (tag === 'numstr' || tag === 'printstr')
    return this._decodeStr(input, tag);
  else if (tag === 'objid' && state.args)
    return this._decodeObjid(input, state.args[0], state.args[1]);
  else if (tag === 'objid')
    return this._decodeObjid(input, null, null);
  else if (tag === 'gentime' || tag === 'utctime')
    return this._decodeTime(input, tag);
  else if (tag === 'null_')
    return this._decodeNull(input);
  else if (tag === 'bool')
    return this._decodeBool(input);
  else if (tag === 'int' || tag === 'enum')
    return this._decodeInt(input, state.args && state.args[0]);
  else if (state.use !== null)
    return this._getUse(state.use, input._reporterState.obj)._decode(input);
  else
    return input.error('unknown tag: ' + tag);

  return null;
};

Node.prototype._getUse = function _getUse(entity, obj) {

  var state = this._baseState;
  // Create altered use decoder if implicit is set
  state.useDecoder = this._use(entity, obj);
  assert(state.useDecoder._baseState.parent === null);
  state.useDecoder = state.useDecoder._baseState.children[0];
  if (state.implicit !== state.useDecoder._baseState.implicit) {
    state.useDecoder = state.useDecoder.clone();
    state.useDecoder._baseState.implicit = state.implicit;
  }
  return state.useDecoder;
};

Node.prototype._decodeChoice = function decodeChoice(input) {
  var state = this._baseState;
  var result = null;
  var match = false;

  Object.keys(state.choice).some(function(key) {
    var save = input.save();
    var node = state.choice[key];
    try {
      var value = node._decode(input);
      if (input.isError(value))
        return false;

      result = { type: key, value: value };
      match = true;
    } catch (e) {
      input.restore(save);
      return false;
    }
    return true;
  }, this);

  if (!match)
    return input.error('Choice not matched');

  return result;
};

//
// Encoding
//

Node.prototype._createEncoderBuffer = function createEncoderBuffer(data) {
  return new EncoderBuffer(data, this.reporter);
};

Node.prototype._encode = function encode(data, reporter, parent) {
  var state = this._baseState;
  if (state['default'] !== null && state['default'] === data)
    return;

  var result = this._encodeValue(data, reporter, parent);
  if (result === undefined)
    return;

  if (this._skipDefault(result, reporter, parent))
    return;

  return result;
};

Node.prototype._encodeValue = function encode(data, reporter, parent) {
  var state = this._baseState;

  // Decode root node
  if (state.parent === null)
    return state.children[0]._encode(data, reporter || new Reporter());

  var result = null;
  var present = true;

  // Set reporter to share it with a child class
  this.reporter = reporter;

  // Check if data is there
  if (state.optional && data === undefined) {
    if (state['default'] !== null)
      data = state['default']
    else
      return;
  }

  // For error reporting
  var prevKey;

  // Encode children first
  var content = null;
  var primitive = false;
  if (state.any) {
    // Anything that was given is translated to buffer
    result = this._createEncoderBuffer(data);
  } else if (state.choice) {
    result = this._encodeChoice(data, reporter);
  } else if (state.contains) {
    content = this._getUse(state.contains, parent)._encode(data, reporter);
    primitive = true;
  } else if (state.children) {
    content = state.children.map(function(child) {
      if (child._baseState.tag === 'null_')
        return child._encode(null, reporter, data);

      if (child._baseState.key === null)
        return reporter.error('Child should have a key');
      var prevKey = reporter.enterKey(child._baseState.key);

      if (typeof data !== 'object')
        return reporter.error('Child expected, but input is not object');

      var res = child._encode(data[child._baseState.key], reporter, data);
      reporter.leaveKey(prevKey);

      return res;
    }, this).filter(function(child) {
      return child;
    });
    content = this._createEncoderBuffer(content);
  } else {
    if (state.tag === 'seqof' || state.tag === 'setof') {
      // TODO(indutny): this should be thrown on DSL level
      if (!(state.args && state.args.length === 1))
        return reporter.error('Too many args for : ' + state.tag);

      if (!Array.isArray(data))
        return reporter.error('seqof/setof, but data is not Array');

      var child = this.clone();
      child._baseState.implicit = null;
      content = this._createEncoderBuffer(data.map(function(item) {
        var state = this._baseState;

        return this._getUse(state.args[0], data)._encode(item, reporter);
      }, child));
    } else if (state.use !== null) {
      result = this._getUse(state.use, parent)._encode(data, reporter);
    } else {
      content = this._encodePrimitive(state.tag, data);
      primitive = true;
    }
  }

  // Encode data itself
  var result;
  if (!state.any && state.choice === null) {
    var tag = state.implicit !== null ? state.implicit : state.tag;
    var cls = state.implicit === null ? 'universal' : 'context';

    if (tag === null) {
      if (state.use === null)
        reporter.error('Tag could be ommited only for .use()');
    } else {
      if (state.use === null)
        result = this._encodeComposite(tag, primitive, cls, content);
    }
  }

  // Wrap in explicit
  if (state.explicit !== null)
    result = this._encodeComposite(state.explicit, false, 'context', result);

  return result;
};

Node.prototype._encodeChoice = function encodeChoice(data, reporter) {
  var state = this._baseState;

  var node = state.choice[data.type];
  if (!node) {
    assert(
        false,
        data.type + ' not found in ' +
            JSON.stringify(Object.keys(state.choice)));
  }
  return node._encode(data.value, reporter);
};

Node.prototype._encodePrimitive = function encodePrimitive(tag, data) {
  var state = this._baseState;

  if (tag === 'octstr' || tag === 'bitstr' || tag === 'ia5str')
    return this._encodeStr(data, tag);
  else if (tag === 'utf8str' || tag === 'bmpstr')
    return this._encodeStr(data, tag);
  else if (tag === 'numstr' || tag === 'printstr')
    return this._encodeStr(data, tag);
  else if (tag === 'objid' && state.args)
    return this._encodeObjid(data, state.reverseArgs[0], state.args[1]);
  else if (tag === 'objid')
    return this._encodeObjid(data, null, null);
  else if (tag === 'gentime' || tag === 'utctime')
    return this._encodeTime(data, tag);
  else if (tag === 'null_')
    return this._encodeNull();
  else if (tag === 'int' || tag === 'enum')
    return this._encodeInt(data, state.args && state.reverseArgs[0]);
  else if (tag === 'bool')
    return this._encodeBool(data);
  else
    throw new Error('Unsupported tag: ' + tag);
};

Node.prototype._isNumstr = function isNumstr(str) {
  return /^[0-9 ]*$/.test(str);
};

Node.prototype._isPrintstr = function isPrintstr(str) {
  return /^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(str);
};

},{"../base":373,"minimalistic-assert":384}],375:[function(require,module,exports){
var inherits = require('inherits');

function Reporter(options) {
  this._reporterState = {
    obj: null,
    path: [],
    options: options || {},
    errors: []
  };
}
exports.Reporter = Reporter;

Reporter.prototype.isError = function isError(obj) {
  return obj instanceof ReporterError;
};

Reporter.prototype.save = function save() {
  var state = this._reporterState;

  return { obj: state.obj, pathLen: state.path.length };
};

Reporter.prototype.restore = function restore(data) {
  var state = this._reporterState;

  state.obj = data.obj;
  state.path = state.path.slice(0, data.pathLen);
};

Reporter.prototype.enterKey = function enterKey(key) {
  return this._reporterState.path.push(key);
};

Reporter.prototype.leaveKey = function leaveKey(index, key, value) {
  var state = this._reporterState;

  state.path = state.path.slice(0, index - 1);
  if (state.obj !== null)
    state.obj[key] = value;
};

Reporter.prototype.enterObject = function enterObject() {
  var state = this._reporterState;

  var prev = state.obj;
  state.obj = {};
  return prev;
};

Reporter.prototype.leaveObject = function leaveObject(prev) {
  var state = this._reporterState;

  var now = state.obj;
  state.obj = prev;
  return now;
};

Reporter.prototype.error = function error(msg) {
  var err;
  var state = this._reporterState;

  var inherited = msg instanceof ReporterError;
  if (inherited) {
    err = msg;
  } else {
    err = new ReporterError(state.path.map(function(elem) {
      return '[' + JSON.stringify(elem) + ']';
    }).join(''), msg.message || msg, msg.stack);
  }

  if (!state.options.partial)
    throw err;

  if (!inherited)
    state.errors.push(err);

  return err;
};

Reporter.prototype.wrapResult = function wrapResult(result) {
  var state = this._reporterState;
  if (!state.options.partial)
    return result;

  return {
    result: this.isError(result) ? null : result,
    errors: state.errors
  };
};

function ReporterError(path, msg) {
  this.path = path;
  this.rethrow(msg);
};
inherits(ReporterError, Error);

ReporterError.prototype.rethrow = function rethrow(msg) {
  this.message = msg + ' at: ' + (this.path || '(shallow)');
  Error.captureStackTrace(this, ReporterError);

  return this;
};

},{"inherits":500}],376:[function(require,module,exports){
var constants = require('../constants');

exports.tagClass = {
  0: 'universal',
  1: 'application',
  2: 'context',
  3: 'private'
};
exports.tagClassByName = constants._reverse(exports.tagClass);

exports.tag = {
  0x00: 'end',
  0x01: 'bool',
  0x02: 'int',
  0x03: 'bitstr',
  0x04: 'octstr',
  0x05: 'null_',
  0x06: 'objid',
  0x07: 'objDesc',
  0x08: 'external',
  0x09: 'real',
  0x0a: 'enum',
  0x0b: 'embed',
  0x0c: 'utf8str',
  0x0d: 'relativeOid',
  0x10: 'seq',
  0x11: 'set',
  0x12: 'numstr',
  0x13: 'printstr',
  0x14: 't61str',
  0x15: 'videostr',
  0x16: 'ia5str',
  0x17: 'utctime',
  0x18: 'gentime',
  0x19: 'graphstr',
  0x1a: 'iso646str',
  0x1b: 'genstr',
  0x1c: 'unistr',
  0x1d: 'charstr',
  0x1e: 'bmpstr'
};
exports.tagByName = constants._reverse(exports.tag);

},{"../constants":377}],377:[function(require,module,exports){
var constants = exports;

// Helper
constants._reverse = function reverse(map) {
  var res = {};

  Object.keys(map).forEach(function(key) {
    // Convert key to integer if it is stringified
    if ((key | 0) == key)
      key = key | 0;

    var value = map[key];
    res[value] = key;
  });

  return res;
};

constants.der = require('./der');

},{"./der":376}],378:[function(require,module,exports){
var inherits = require('inherits');

var asn1 = require('../../asn1');
var base = asn1.base;
var bignum = asn1.bignum;

// Import DER constants
var der = asn1.constants.der;

function DERDecoder(entity) {
  this.enc = 'der';
  this.name = entity.name;
  this.entity = entity;

  // Construct base tree
  this.tree = new DERNode();
  this.tree._init(entity.body);
};
module.exports = DERDecoder;

DERDecoder.prototype.decode = function decode(data, options) {
  if (!(data instanceof base.DecoderBuffer))
    data = new base.DecoderBuffer(data, options);

  return this.tree._decode(data, options);
};

// Tree methods

function DERNode(parent) {
  base.Node.call(this, 'der', parent);
}
inherits(DERNode, base.Node);

DERNode.prototype._peekTag = function peekTag(buffer, tag, any) {
  if (buffer.isEmpty())
    return false;

  var state = buffer.save();
  var decodedTag = derDecodeTag(buffer, 'Failed to peek tag: "' + tag + '"');
  if (buffer.isError(decodedTag))
    return decodedTag;

  buffer.restore(state);

  return decodedTag.tag === tag || decodedTag.tagStr === tag || any;
};

DERNode.prototype._decodeTag = function decodeTag(buffer, tag, any) {
  var decodedTag = derDecodeTag(buffer,
                                'Failed to decode tag of "' + tag + '"');
  if (buffer.isError(decodedTag))
    return decodedTag;

  var len = derDecodeLen(buffer,
                         decodedTag.primitive,
                         'Failed to get length of "' + tag + '"');

  // Failure
  if (buffer.isError(len))
    return len;

  if (!any &&
      decodedTag.tag !== tag &&
      decodedTag.tagStr !== tag &&
      decodedTag.tagStr + 'of' !== tag) {
    return buffer.error('Failed to match tag: "' + tag + '"');
  }

  if (decodedTag.primitive || len !== null)
    return buffer.skip(len, 'Failed to match body of: "' + tag + '"');

  // Indefinite length... find END tag
  var state = buffer.save();
  var res = this._skipUntilEnd(
      buffer,
      'Failed to skip indefinite length body: "' + this.tag + '"');
  if (buffer.isError(res))
    return res;

  len = buffer.offset - state.offset;
  buffer.restore(state);
  return buffer.skip(len, 'Failed to match body of: "' + tag + '"');
};

DERNode.prototype._skipUntilEnd = function skipUntilEnd(buffer, fail) {
  while (true) {
    var tag = derDecodeTag(buffer, fail);
    if (buffer.isError(tag))
      return tag;
    var len = derDecodeLen(buffer, tag.primitive, fail);
    if (buffer.isError(len))
      return len;

    var res;
    if (tag.primitive || len !== null)
      res = buffer.skip(len)
    else
      res = this._skipUntilEnd(buffer, fail);

    // Failure
    if (buffer.isError(res))
      return res;

    if (tag.tagStr === 'end')
      break;
  }
};

DERNode.prototype._decodeList = function decodeList(buffer, tag, decoder) {
  var result = [];
  while (!buffer.isEmpty()) {
    var possibleEnd = this._peekTag(buffer, 'end');
    if (buffer.isError(possibleEnd))
      return possibleEnd;

    var res = decoder.decode(buffer, 'der');
    if (buffer.isError(res) && possibleEnd)
      break;
    result.push(res);
  }
  return result;
};

DERNode.prototype._decodeStr = function decodeStr(buffer, tag) {
  if (tag === 'octstr') {
    return buffer.raw();
  } else if (tag === 'bitstr') {
    var unused = buffer.readUInt8();
    if (buffer.isError(unused))
      return unused;

    return { unused: unused, data: buffer.raw() };
  } else if (tag === 'ia5str' || tag === 'utf8str') {
    return buffer.raw().toString();
  } else if(tag === 'numstr') {
    var numstr = buffer.raw().toString('ascii');
    if (!this._isNumstr(numstr)) {
      return buffer.error('Decoding of string type: ' +
                          'numstr unsupported characters');
    }

    return numstr;
  } else if (tag === 'printstr') {
    var printstr = buffer.raw().toString('ascii');
    if (!this._isPrintstr(printstr)) {
      return buffer.error('Decoding of string type: ' +
                          'printstr unsupported characters');
    }

    return printstr;
  } else if(tag === 'bmpstr') {
    var raw = buffer.raw();
    if (raw.length % 2 === 1)
      return buffer.error('Decoding of string type: bmpstr length mismatch');

    var str = '';
    for (var i = 0; i < raw.length / 2; i++) {
      str += String.fromCharCode(raw.readUInt16BE(i * 2));
    }
    return str;
  } else {
    return buffer.error('Decoding of string type: ' + tag + ' unsupported');
  }
};

DERNode.prototype._decodeObjid = function decodeObjid(buffer, values, relative) {
  var result;
  var identifiers = [];
  var ident = 0;
  while (!buffer.isEmpty()) {
    var subident = buffer.readUInt8();
    ident <<= 7;
    ident |= subident & 0x7f;
    if ((subident & 0x80) === 0) {
      identifiers.push(ident);
      ident = 0;
    }
  }
  if (subident & 0x80)
    identifiers.push(ident);

  var first = (identifiers[0] / 40) | 0;
  var second = identifiers[0] % 40;

  if (relative)
    result = identifiers;
  else
    result = [first, second].concat(identifiers.slice(1));

  if (values) {
    var tmp = values[result.join(' ')];
    if (tmp === undefined)
      tmp = values[result.join('.')];
    if (tmp !== undefined)
      result = tmp;
  }

  return result;
};

DERNode.prototype._decodeTime = function decodeTime(buffer, tag) {
  var str = buffer.raw().toString();
  if (tag === 'gentime') {
    var year = str.slice(0, 4) | 0;
    var mon = str.slice(4, 6) | 0;
    var day = str.slice(6, 8) | 0;
    var hour = str.slice(8, 10) | 0;
    var min = str.slice(10, 12) | 0;
    var sec = str.slice(12, 14) | 0;
  } else if (tag === 'utctime') {
    var year = str.slice(0, 2) | 0;
    var mon = str.slice(2, 4) | 0;
    var day = str.slice(4, 6) | 0;
    var hour = str.slice(6, 8) | 0;
    var min = str.slice(8, 10) | 0;
    var sec = str.slice(10, 12) | 0;
    if (year < 70)
      year = 2000 + year;
    else
      year = 1900 + year;
  } else {
    return buffer.error('Decoding ' + tag + ' time is not supported yet');
  }

  return Date.UTC(year, mon - 1, day, hour, min, sec, 0);
};

DERNode.prototype._decodeNull = function decodeNull(buffer) {
  return null;
};

DERNode.prototype._decodeBool = function decodeBool(buffer) {
  var res = buffer.readUInt8();
  if (buffer.isError(res))
    return res;
  else
    return res !== 0;
};

DERNode.prototype._decodeInt = function decodeInt(buffer, values) {
  // Bigint, return as it is (assume big endian)
  var raw = buffer.raw();
  var res = new bignum(raw);

  if (values)
    res = values[res.toString(10)] || res;

  return res;
};

DERNode.prototype._use = function use(entity, obj) {
  if (typeof entity === 'function')
    entity = entity(obj);
  return entity._getDecoder('der').tree;
};

// Utility methods

function derDecodeTag(buf, fail) {
  var tag = buf.readUInt8(fail);
  if (buf.isError(tag))
    return tag;

  var cls = der.tagClass[tag >> 6];
  var primitive = (tag & 0x20) === 0;

  // Multi-octet tag - load
  if ((tag & 0x1f) === 0x1f) {
    var oct = tag;
    tag = 0;
    while ((oct & 0x80) === 0x80) {
      oct = buf.readUInt8(fail);
      if (buf.isError(oct))
        return oct;

      tag <<= 7;
      tag |= oct & 0x7f;
    }
  } else {
    tag &= 0x1f;
  }
  var tagStr = der.tag[tag];

  return {
    cls: cls,
    primitive: primitive,
    tag: tag,
    tagStr: tagStr
  };
}

function derDecodeLen(buf, primitive, fail) {
  var len = buf.readUInt8(fail);
  if (buf.isError(len))
    return len;

  // Indefinite form
  if (!primitive && len === 0x80)
    return null;

  // Definite form
  if ((len & 0x80) === 0) {
    // Short form
    return len;
  }

  // Long form
  var num = len & 0x7f;
  if (num >= 4)
    return buf.error('length octect is too long');

  len = 0;
  for (var i = 0; i < num; i++) {
    len <<= 8;
    var j = buf.readUInt8(fail);
    if (buf.isError(j))
      return j;
    len |= j;
  }

  return len;
}

},{"../../asn1":370,"inherits":500}],379:[function(require,module,exports){
var decoders = exports;

decoders.der = require('./der');
decoders.pem = require('./pem');

},{"./der":378,"./pem":380}],380:[function(require,module,exports){
var inherits = require('inherits');
var Buffer = require('buffer').Buffer;

var asn1 = require('../../asn1');
var DERDecoder = require('./der');

function PEMDecoder(entity) {
  DERDecoder.call(this, entity);
  this.enc = 'pem';
};
inherits(PEMDecoder, DERDecoder);
module.exports = PEMDecoder;

PEMDecoder.prototype.decode = function decode(data, options) {
  var lines = data.toString().split(/[\r\n]+/g);

  var label = options.label.toUpperCase();

  var re = /^-----(BEGIN|END) ([^-]+)-----$/;
  var start = -1;
  var end = -1;
  for (var i = 0; i < lines.length; i++) {
    var match = lines[i].match(re);
    if (match === null)
      continue;

    if (match[2] !== label)
      continue;

    if (start === -1) {
      if (match[1] !== 'BEGIN')
        break;
      start = i;
    } else {
      if (match[1] !== 'END')
        break;
      end = i;
      break;
    }
  }
  if (start === -1 || end === -1)
    throw new Error('PEM section not found for: ' + label);

  var base64 = lines.slice(start + 1, end).join('');
  // Remove excessive symbols
  base64.replace(/[^a-z0-9\+\/=]+/gi, '');

  var input = new Buffer(base64, 'base64');
  return DERDecoder.prototype.decode.call(this, input, options);
};

},{"../../asn1":370,"./der":378,"buffer":303,"inherits":500}],381:[function(require,module,exports){
var inherits = require('inherits');
var Buffer = require('buffer').Buffer;

var asn1 = require('../../asn1');
var base = asn1.base;
var bignum = asn1.bignum;

// Import DER constants
var der = asn1.constants.der;

function DEREncoder(entity) {
  this.enc = 'der';
  this.name = entity.name;
  this.entity = entity;

  // Construct base tree
  this.tree = new DERNode();
  this.tree._init(entity.body);
};
module.exports = DEREncoder;

DEREncoder.prototype.encode = function encode(data, reporter) {
  return this.tree._encode(data, reporter).join();
};

// Tree methods

function DERNode(parent) {
  base.Node.call(this, 'der', parent);
}
inherits(DERNode, base.Node);

DERNode.prototype._encodeComposite = function encodeComposite(tag,
                                                              primitive,
                                                              cls,
                                                              content) {
  var encodedTag = encodeTag(tag, primitive, cls, this.reporter);

  // Short form
  if (content.length < 0x80) {
    var header = new Buffer(2);
    header[0] = encodedTag;
    header[1] = content.length;
    return this._createEncoderBuffer([ header, content ]);
  }

  // Long form
  // Count octets required to store length
  var lenOctets = 1;
  for (var i = content.length; i >= 0x100; i >>= 8)
    lenOctets++;

  var header = new Buffer(1 + 1 + lenOctets);
  header[0] = encodedTag;
  header[1] = 0x80 | lenOctets;

  for (var i = 1 + lenOctets, j = content.length; j > 0; i--, j >>= 8)
    header[i] = j & 0xff;

  return this._createEncoderBuffer([ header, content ]);
};

DERNode.prototype._encodeStr = function encodeStr(str, tag) {
  if (tag === 'octstr') {
    return this._createEncoderBuffer(str);
  } else if (tag === 'bitstr') {
    return this._createEncoderBuffer([ str.unused | 0, str.data ]);
  } else if (tag === 'ia5str' || tag === 'utf8str') {
    return this._createEncoderBuffer(str);
  } else if (tag === 'bmpstr') {
    var buf = new Buffer(str.length * 2);
    for (var i = 0; i < str.length; i++) {
      buf.writeUInt16BE(str.charCodeAt(i), i * 2);
    }
    return this._createEncoderBuffer(buf);
  } else if (tag === 'numstr') {
    if (!this._isNumstr(str)) {
      return this.reporter.error('Encoding of string type: numstr supports ' +
                                 'only digits and space');
    }

    return this._createEncoderBuffer(str);
  } else if (tag === 'printstr') {
    if (!this._isPrintstr(str)) {
      return this.reporter.error('Encoding of string type: printstr supports ' +
                                 'only latin upper and lower case letters, ' +
                                 'digits, space, apostrophe, left and rigth ' +
                                 'parenthesis, plus sign, comma, hyphen, ' +
                                 'dot, slash, colon, equal sign, ' +
                                 'question mark');
    }

    return this._createEncoderBuffer(str);
  } else {
    return this.reporter.error('Encoding of string type: ' + tag +
                               ' unsupported');
  }
};

DERNode.prototype._encodeObjid = function encodeObjid(id, values, relative) {
  if (typeof id === 'string') {
    if (!values)
      return this.reporter.error('string objid given, but no values map found');
    if (!values.hasOwnProperty(id))
      return this.reporter.error('objid not found in values map');
    id = values[id].split(/[\s\.]+/g);
    for (var i = 0; i < id.length; i++)
      id[i] |= 0;
  } else if (Array.isArray(id)) {
    id = id.slice();
    for (var i = 0; i < id.length; i++)
      id[i] |= 0;
  }

  if (!Array.isArray(id)) {
    return this.reporter.error('objid() should be either array or string, ' +
                               'got: ' + JSON.stringify(id));
  }

  if (!relative) {
    if (id[1] >= 40)
      return this.reporter.error('Second objid identifier OOB');
    id.splice(0, 2, id[0] * 40 + id[1]);
  }

  // Count number of octets
  var size = 0;
  for (var i = 0; i < id.length; i++) {
    var ident = id[i];
    for (size++; ident >= 0x80; ident >>= 7)
      size++;
  }

  var objid = new Buffer(size);
  var offset = objid.length - 1;
  for (var i = id.length - 1; i >= 0; i--) {
    var ident = id[i];
    objid[offset--] = ident & 0x7f;
    while ((ident >>= 7) > 0)
      objid[offset--] = 0x80 | (ident & 0x7f);
  }

  return this._createEncoderBuffer(objid);
};

function two(num) {
  if (num < 10)
    return '0' + num;
  else
    return num;
}

DERNode.prototype._encodeTime = function encodeTime(time, tag) {
  var str;
  var date = new Date(time);

  if (tag === 'gentime') {
    str = [
      two(date.getFullYear()),
      two(date.getUTCMonth() + 1),
      two(date.getUTCDate()),
      two(date.getUTCHours()),
      two(date.getUTCMinutes()),
      two(date.getUTCSeconds()),
      'Z'
    ].join('');
  } else if (tag === 'utctime') {
    str = [
      two(date.getFullYear() % 100),
      two(date.getUTCMonth() + 1),
      two(date.getUTCDate()),
      two(date.getUTCHours()),
      two(date.getUTCMinutes()),
      two(date.getUTCSeconds()),
      'Z'
    ].join('');
  } else {
    this.reporter.error('Encoding ' + tag + ' time is not supported yet');
  }

  return this._encodeStr(str, 'octstr');
};

DERNode.prototype._encodeNull = function encodeNull() {
  return this._createEncoderBuffer('');
};

DERNode.prototype._encodeInt = function encodeInt(num, values) {
  if (typeof num === 'string') {
    if (!values)
      return this.reporter.error('String int or enum given, but no values map');
    if (!values.hasOwnProperty(num)) {
      return this.reporter.error('Values map doesn\'t contain: ' +
                                 JSON.stringify(num));
    }
    num = values[num];
  }

  // Bignum, assume big endian
  if (typeof num !== 'number' && !Buffer.isBuffer(num)) {
    var numArray = num.toArray();
    if (!num.sign && numArray[0] & 0x80) {
      numArray.unshift(0);
    }
    num = new Buffer(numArray);
  }

  if (Buffer.isBuffer(num)) {
    var size = num.length;
    if (num.length === 0)
      size++;

    var out = new Buffer(size);
    num.copy(out);
    if (num.length === 0)
      out[0] = 0
    return this._createEncoderBuffer(out);
  }

  if (num < 0x80)
    return this._createEncoderBuffer(num);

  if (num < 0x100)
    return this._createEncoderBuffer([0, num]);

  var size = 1;
  for (var i = num; i >= 0x100; i >>= 8)
    size++;

  var out = new Array(size);
  for (var i = out.length - 1; i >= 0; i--) {
    out[i] = num & 0xff;
    num >>= 8;
  }
  if(out[0] & 0x80) {
    out.unshift(0);
  }

  return this._createEncoderBuffer(new Buffer(out));
};

DERNode.prototype._encodeBool = function encodeBool(value) {
  return this._createEncoderBuffer(value ? 0xff : 0);
};

DERNode.prototype._use = function use(entity, obj) {
  if (typeof entity === 'function')
    entity = entity(obj);
  return entity._getEncoder('der').tree;
};

DERNode.prototype._skipDefault = function skipDefault(dataBuffer, reporter, parent) {
  var state = this._baseState;
  var i;
  if (state['default'] === null)
    return false;

  var data = dataBuffer.join();
  if (state.defaultBuffer === undefined)
    state.defaultBuffer = this._encodeValue(state['default'], reporter, parent).join();

  if (data.length !== state.defaultBuffer.length)
    return false;

  for (i=0; i < data.length; i++)
    if (data[i] !== state.defaultBuffer[i])
      return false;

  return true;
};

// Utility methods

function encodeTag(tag, primitive, cls, reporter) {
  var res;

  if (tag === 'seqof')
    tag = 'seq';
  else if (tag === 'setof')
    tag = 'set';

  if (der.tagByName.hasOwnProperty(tag))
    res = der.tagByName[tag];
  else if (typeof tag === 'number' && (tag | 0) === tag)
    res = tag;
  else
    return reporter.error('Unknown tag: ' + tag);

  if (res >= 0x1f)
    return reporter.error('Multi-octet tag encoding unsupported');

  if (!primitive)
    res |= 0x20;

  res |= (der.tagClassByName[cls || 'universal'] << 6);

  return res;
}

},{"../../asn1":370,"buffer":303,"inherits":500}],382:[function(require,module,exports){
var encoders = exports;

encoders.der = require('./der');
encoders.pem = require('./pem');

},{"./der":381,"./pem":383}],383:[function(require,module,exports){
var inherits = require('inherits');
var Buffer = require('buffer').Buffer;

var asn1 = require('../../asn1');
var DEREncoder = require('./der');

function PEMEncoder(entity) {
  DEREncoder.call(this, entity);
  this.enc = 'pem';
};
inherits(PEMEncoder, DEREncoder);
module.exports = PEMEncoder;

PEMEncoder.prototype.encode = function encode(data, options) {
  var buf = DEREncoder.prototype.encode.call(this, data);

  var p = buf.toString('base64');
  var out = [ '-----BEGIN ' + options.label + '-----' ];
  for (var i = 0; i < p.length; i += 64)
    out.push(p.slice(i, i + 64));
  out.push('-----END ' + options.label + '-----');
  return out.join('\n');
};

},{"../../asn1":370,"./der":381,"buffer":303,"inherits":500}],384:[function(require,module,exports){
arguments[4][335][0].apply(exports,arguments)
},{"dup":335}],385:[function(require,module,exports){
arguments[4][309][0].apply(exports,arguments)
},{"buffer":303,"dup":309}],386:[function(require,module,exports){
arguments[4][310][0].apply(exports,arguments)
},{"./aes":385,"./ghash":390,"buffer":303,"buffer-xor":399,"cipher-base":400,"dup":310,"inherits":500}],387:[function(require,module,exports){
arguments[4][311][0].apply(exports,arguments)
},{"./decrypter":388,"./encrypter":389,"./modes":391,"dup":311}],388:[function(require,module,exports){
arguments[4][312][0].apply(exports,arguments)
},{"./aes":385,"./authCipher":386,"./modes":391,"./modes/cbc":392,"./modes/cfb":393,"./modes/cfb1":394,"./modes/cfb8":395,"./modes/ctr":396,"./modes/ecb":397,"./modes/ofb":398,"./streamCipher":401,"buffer":303,"cipher-base":400,"dup":312,"evp_bytestokey":402,"inherits":500}],389:[function(require,module,exports){
arguments[4][313][0].apply(exports,arguments)
},{"./aes":385,"./authCipher":386,"./modes":391,"./modes/cbc":392,"./modes/cfb":393,"./modes/cfb1":394,"./modes/cfb8":395,"./modes/ctr":396,"./modes/ecb":397,"./modes/ofb":398,"./streamCipher":401,"buffer":303,"cipher-base":400,"dup":313,"evp_bytestokey":402,"inherits":500}],390:[function(require,module,exports){
arguments[4][314][0].apply(exports,arguments)
},{"buffer":303,"dup":314}],391:[function(require,module,exports){
arguments[4][315][0].apply(exports,arguments)
},{"dup":315}],392:[function(require,module,exports){
arguments[4][316][0].apply(exports,arguments)
},{"buffer-xor":399,"dup":316}],393:[function(require,module,exports){
arguments[4][317][0].apply(exports,arguments)
},{"buffer":303,"buffer-xor":399,"dup":317}],394:[function(require,module,exports){
arguments[4][318][0].apply(exports,arguments)
},{"buffer":303,"dup":318}],395:[function(require,module,exports){
arguments[4][319][0].apply(exports,arguments)
},{"buffer":303,"dup":319}],396:[function(require,module,exports){
arguments[4][320][0].apply(exports,arguments)
},{"buffer":303,"buffer-xor":399,"dup":320}],397:[function(require,module,exports){
arguments[4][321][0].apply(exports,arguments)
},{"dup":321}],398:[function(require,module,exports){
arguments[4][322][0].apply(exports,arguments)
},{"buffer":303,"buffer-xor":399,"dup":322}],399:[function(require,module,exports){
arguments[4][323][0].apply(exports,arguments)
},{"buffer":303,"dup":323}],400:[function(require,module,exports){
arguments[4][324][0].apply(exports,arguments)
},{"buffer":303,"dup":324,"inherits":500,"stream":521,"string_decoder":522}],401:[function(require,module,exports){
arguments[4][325][0].apply(exports,arguments)
},{"./aes":385,"buffer":303,"cipher-base":400,"dup":325,"inherits":500}],402:[function(require,module,exports){
arguments[4][336][0].apply(exports,arguments)
},{"buffer":303,"create-hash/md5":433,"dup":336}],403:[function(require,module,exports){
(function (Buffer){
// much of this based on https://github.com/indutny/self-signed/blob/gh-pages/lib/rsa.js
var createHmac = require('create-hmac')
var crt = require('browserify-rsa')
var curves = require('./curves')
var elliptic = require('elliptic')
var parseKeys = require('parse-asn1')

var BN = require('bn.js')
var EC = elliptic.ec

function sign (hash, key, hashType, signType) {
  var priv = parseKeys(key)
  if (priv.curve) {
    if (signType !== 'ecdsa') throw new Error('wrong private key type')

    return ecSign(hash, priv)
  } else if (priv.type === 'dsa') {
    if (signType !== 'dsa') {
      throw new Error('wrong private key type')
    }
    return dsaSign(hash, priv, hashType)
  } else {
    if (signType !== 'rsa') throw new Error('wrong private key type')
  }

  var len = priv.modulus.byteLength()
  var pad = [ 0, 1 ]
  while (hash.length + pad.length + 1 < len) {
    pad.push(0xff)
  }
  pad.push(0x00)
  var i = -1
  while (++i < hash.length) {
    pad.push(hash[i])
  }

  var out = crt(pad, priv)
  return out
}

function ecSign (hash, priv) {
  var curveId = curves[priv.curve.join('.')]
  if (!curveId) throw new Error('unknown curve ' + priv.curve.join('.'))

  var curve = new EC(curveId)
  var key = curve.genKeyPair()

  key._importPrivate(priv.privateKey)
  var out = key.sign(hash)

  return new Buffer(out.toDER())
}

function dsaSign (hash, priv, algo) {
  var x = priv.params.priv_key
  var p = priv.params.p
  var q = priv.params.q
  var g = priv.params.g
  var r = new BN(0)
  var k
  var H = bits2int(hash, q).mod(q)
  var s = false
  var kv = getKey(x, q, hash, algo)
  while (s === false) {
    k = makeKey(q, kv, algo)
    r = makeR(g, k, p, q)
    s = k.invm(q).imul(H.add(x.mul(r))).mod(q)
    if (!s.cmpn(0)) {
      s = false
      r = new BN(0)
    }
  }
  return toDER(r, s)
}

function toDER (r, s) {
  r = r.toArray()
  s = s.toArray()

  // Pad values
  if (r[0] & 0x80) {
    r = [ 0 ].concat(r)
  }
  // Pad values
  if (s[0] & 0x80) {
    s = [0].concat(s)
  }

  var total = r.length + s.length + 4
  var res = [ 0x30, total, 0x02, r.length ]
  res = res.concat(r, [ 0x02, s.length ], s)
  return new Buffer(res)
}

function getKey (x, q, hash, algo) {
  x = new Buffer(x.toArray())
  if (x.length < q.byteLength()) {
    var zeros = new Buffer(q.byteLength() - x.length)
    zeros.fill(0)
    x = Buffer.concat([zeros, x])
  }
  var hlen = hash.length
  var hbits = bits2octets(hash, q)
  var v = new Buffer(hlen)
  v.fill(1)
  var k = new Buffer(hlen)
  k.fill(0)
  k = createHmac(algo, k)
    .update(v)
    .update(new Buffer([0]))
    .update(x)
    .update(hbits)
    .digest()
  v = createHmac(algo, k)
    .update(v)
    .digest()
  k = createHmac(algo, k)
    .update(v)
    .update(new Buffer([1]))
    .update(x)
    .update(hbits)
    .digest()
  v = createHmac(algo, k)
    .update(v)
    .digest()
  return {
    k: k,
    v: v
  }
}

function bits2int (obits, q) {
  var bits = new BN(obits)
  var shift = (obits.length << 3) - q.bitLength()
  if (shift > 0) {
    bits.ishrn(shift)
  }
  return bits
}

function bits2octets (bits, q) {
  bits = bits2int(bits, q)
  bits = bits.mod(q)
  var out = new Buffer(bits.toArray())
  if (out.length < q.byteLength()) {
    var zeros = new Buffer(q.byteLength() - out.length)
    zeros.fill(0)
    out = Buffer.concat([zeros, out])
  }
  return out
}

function makeKey (q, kv, algo) {
  var t, k

  do {
    t = new Buffer('')

    while (t.length * 8 < q.bitLength()) {
      kv.v = createHmac(algo, kv.k)
        .update(kv.v)
        .digest()
      t = Buffer.concat([t, kv.v])
    }

    k = bits2int(t, q)
    kv.k = createHmac(algo, kv.k)
      .update(kv.v)
      .update(new Buffer([0]))
      .digest()
    kv.v = createHmac(algo, kv.k)
      .update(kv.v)
      .digest()
  } while (k.cmp(q) !== -1)

  return k
}

function makeR (g, k, p, q) {
  return g.toRed(BN.mont(p)).redPow(k).fromRed().mod(q)
}

module.exports = sign
module.exports.getKey = getKey
module.exports.makeKey = makeKey

}).call(this,require("buffer").Buffer)
},{"./curves":339,"bn.js":340,"browserify-rsa":341,"buffer":303,"create-hmac":444,"elliptic":342,"parse-asn1":369}],404:[function(require,module,exports){
(function (Buffer){
// much of this based on https://github.com/indutny/self-signed/blob/gh-pages/lib/rsa.js
var curves = require('./curves')
var elliptic = require('elliptic')
var parseKeys = require('parse-asn1')

var BN = require('bn.js')
var EC = elliptic.ec

function verify (sig, hash, key, signType) {
  var pub = parseKeys(key)
  if (pub.type === 'ec') {
    if (signType !== 'ecdsa') {
      throw new Error('wrong public key type')
    }
    return ecVerify(sig, hash, pub)
  } else if (pub.type === 'dsa') {
    if (signType !== 'dsa') {
      throw new Error('wrong public key type')
    }
    return dsaVerify(sig, hash, pub)
  } else {
    if (signType !== 'rsa') {
      throw new Error('wrong public key type')
    }
  }
  var len = pub.modulus.byteLength()
  var pad = [ 1 ]
  var padNum = 0
  while (hash.length + pad.length + 2 < len) {
    pad.push(0xff)
    padNum++
  }
  pad.push(0x00)
  var i = -1
  while (++i < hash.length) {
    pad.push(hash[i])
  }
  pad = new Buffer(pad)
  var red = BN.mont(pub.modulus)
  sig = new BN(sig).toRed(red)

  sig = sig.redPow(new BN(pub.publicExponent))

  sig = new Buffer(sig.fromRed().toArray())
  var out = 0
  if (padNum < 8) {
    out = 1
  }
  len = Math.min(sig.length, pad.length)
  if (sig.length !== pad.length) {
    out = 1
  }

  i = -1
  while (++i < len) {
    out |= (sig[i] ^ pad[i])
  }
  return out === 0
}

function ecVerify (sig, hash, pub) {
  var curveId = curves[pub.data.algorithm.curve.join('.')]
  if (!curveId) throw new Error('unknown curve ' + pub.data.algorithm.curve.join('.'))

  var curve = new EC(curveId)
  var pubkey = pub.data.subjectPrivateKey.data

  return curve.verify(hash, sig, pubkey)
}

function dsaVerify (sig, hash, pub) {
  var p = pub.data.p
  var q = pub.data.q
  var g = pub.data.g
  var y = pub.data.pub_key
  var unpacked = parseKeys.signature.decode(sig, 'der')
  var s = unpacked.s
  var r = unpacked.r
  checkValue(s, q)
  checkValue(r, q)
  var montp = BN.mont(p)
  var w = s.invm(q)
  var v = g.toRed(montp)
    .redPow(new BN(hash).mul(w).mod(q))
    .fromRed()
    .mul(
      y.toRed(montp)
        .redPow(r.mul(w).mod(q))
        .fromRed()
  ).mod(p).mod(q)
  return !v.cmp(r)
}

function checkValue (b, q) {
  if (b.cmpn(0) <= 0) {
    throw new Error('invalid sig')
  }
  if (b.cmp(q) >= q) {
    throw new Error('invalid sig')
  }
}

module.exports = verify

}).call(this,require("buffer").Buffer)
},{"./curves":339,"bn.js":340,"buffer":303,"elliptic":342,"parse-asn1":369}],405:[function(require,module,exports){
(function (Buffer){
var elliptic = require('elliptic');
var BN = require('bn.js');

module.exports = function createECDH(curve) {
	return new ECDH(curve);
};

var aliases = {
	secp256k1: {
		name: 'secp256k1',
		byteLength: 32
	},
	secp224r1: {
		name: 'p224',
		byteLength: 28
	},
	prime256v1: {
		name: 'p256',
		byteLength: 32
	},
	prime192v1: {
		name: 'p192',
		byteLength: 24
	},
	ed25519: {
		name: 'ed25519',
		byteLength: 32
	},
	secp384r1: {
		name: 'p384',
		byteLength: 48
	},
	secp521r1: {
		name: 'p521',
		byteLength: 66
	}
};

aliases.p224 = aliases.secp224r1;
aliases.p256 = aliases.secp256r1 = aliases.prime256v1;
aliases.p192 = aliases.secp192r1 = aliases.prime192v1;
aliases.p384 = aliases.secp384r1;
aliases.p521 = aliases.secp521r1;

function ECDH(curve) {
	this.curveType = aliases[curve];
	if (!this.curveType ) {
		this.curveType = {
			name: curve
		};
	}
	this.curve = new elliptic.ec(this.curveType.name);
	this.keys = void 0;
}

ECDH.prototype.generateKeys = function (enc, format) {
	this.keys = this.curve.genKeyPair();
	return this.getPublicKey(enc, format);
};

ECDH.prototype.computeSecret = function (other, inenc, enc) {
	inenc = inenc || 'utf8';
	if (!Buffer.isBuffer(other)) {
		other = new Buffer(other, inenc);
	}
	var otherPub = this.curve.keyFromPublic(other).getPublic();
	var out = otherPub.mul(this.keys.getPrivate()).getX();
	return formatReturnValue(out, enc, this.curveType.byteLength);
};

ECDH.prototype.getPublicKey = function (enc, format) {
	var key = this.keys.getPublic(format === 'compressed', true);
	if (format === 'hybrid') {
		if (key[key.length - 1] % 2) {
			key[0] = 7;
		} else {
			key [0] = 6;
		}
	}
	return formatReturnValue(key, enc);
};

ECDH.prototype.getPrivateKey = function (enc) {
	return formatReturnValue(this.keys.getPrivate(), enc);
};

ECDH.prototype.setPublicKey = function (pub, enc) {
	enc = enc || 'utf8';
	if (!Buffer.isBuffer(pub)) {
		pub = new Buffer(pub, enc);
	}
	this.keys._importPublic(pub);
	return this;
};

ECDH.prototype.setPrivateKey = function (priv, enc) {
	enc = enc || 'utf8';
	if (!Buffer.isBuffer(priv)) {
		priv = new Buffer(priv, enc);
	}
	var _priv = new BN(priv);
	_priv = _priv.toString(16);
	this.keys._importPrivate(_priv);
	return this;
};

function formatReturnValue(bn, enc, len) {
	if (!Array.isArray(bn)) {
		bn = bn.toArray();
	}
	var buf = new Buffer(bn);
	if (len && buf.length < len) {
		var zeros = new Buffer(len - buf.length);
		zeros.fill(0);
		buf = Buffer.concat([zeros, buf]);
	}
	if (!enc) {
		return buf;
	} else {
		return buf.toString(enc);
	}
}

}).call(this,require("buffer").Buffer)
},{"bn.js":406,"buffer":303,"elliptic":407}],406:[function(require,module,exports){
arguments[4][340][0].apply(exports,arguments)
},{"dup":340}],407:[function(require,module,exports){
arguments[4][342][0].apply(exports,arguments)
},{"../package.json":430,"./elliptic/curve":410,"./elliptic/curves":413,"./elliptic/ec":414,"./elliptic/eddsa":417,"./elliptic/hmac-drbg":420,"./elliptic/utils":422,"brorand":423,"dup":342}],408:[function(require,module,exports){
arguments[4][343][0].apply(exports,arguments)
},{"../../elliptic":407,"bn.js":406,"dup":343}],409:[function(require,module,exports){
arguments[4][344][0].apply(exports,arguments)
},{"../../elliptic":407,"../curve":410,"bn.js":406,"dup":344,"inherits":500}],410:[function(require,module,exports){
arguments[4][345][0].apply(exports,arguments)
},{"./base":408,"./edwards":409,"./mont":411,"./short":412,"dup":345}],411:[function(require,module,exports){
arguments[4][346][0].apply(exports,arguments)
},{"../../elliptic":407,"../curve":410,"bn.js":406,"dup":346,"inherits":500}],412:[function(require,module,exports){
arguments[4][347][0].apply(exports,arguments)
},{"../../elliptic":407,"../curve":410,"bn.js":406,"dup":347,"inherits":500}],413:[function(require,module,exports){
arguments[4][348][0].apply(exports,arguments)
},{"../elliptic":407,"./precomputed/secp256k1":421,"dup":348,"hash.js":424}],414:[function(require,module,exports){
arguments[4][349][0].apply(exports,arguments)
},{"../../elliptic":407,"./key":415,"./signature":416,"bn.js":406,"dup":349}],415:[function(require,module,exports){
arguments[4][350][0].apply(exports,arguments)
},{"bn.js":406,"dup":350}],416:[function(require,module,exports){
arguments[4][351][0].apply(exports,arguments)
},{"../../elliptic":407,"bn.js":406,"dup":351}],417:[function(require,module,exports){
arguments[4][352][0].apply(exports,arguments)
},{"../../elliptic":407,"./key":418,"./signature":419,"dup":352,"hash.js":424}],418:[function(require,module,exports){
arguments[4][353][0].apply(exports,arguments)
},{"../../elliptic":407,"dup":353}],419:[function(require,module,exports){
arguments[4][354][0].apply(exports,arguments)
},{"../../elliptic":407,"bn.js":406,"dup":354}],420:[function(require,module,exports){
arguments[4][355][0].apply(exports,arguments)
},{"../elliptic":407,"dup":355,"hash.js":424}],421:[function(require,module,exports){
arguments[4][356][0].apply(exports,arguments)
},{"dup":356}],422:[function(require,module,exports){
arguments[4][357][0].apply(exports,arguments)
},{"bn.js":406,"dup":357}],423:[function(require,module,exports){
arguments[4][358][0].apply(exports,arguments)
},{"dup":358}],424:[function(require,module,exports){
arguments[4][359][0].apply(exports,arguments)
},{"./hash/common":425,"./hash/hmac":426,"./hash/ripemd":427,"./hash/sha":428,"./hash/utils":429,"dup":359}],425:[function(require,module,exports){
arguments[4][360][0].apply(exports,arguments)
},{"../hash":424,"dup":360}],426:[function(require,module,exports){
arguments[4][361][0].apply(exports,arguments)
},{"../hash":424,"dup":361}],427:[function(require,module,exports){
arguments[4][362][0].apply(exports,arguments)
},{"../hash":424,"dup":362}],428:[function(require,module,exports){
arguments[4][363][0].apply(exports,arguments)
},{"../hash":424,"dup":363}],429:[function(require,module,exports){
arguments[4][364][0].apply(exports,arguments)
},{"dup":364,"inherits":500}],430:[function(require,module,exports){
arguments[4][365][0].apply(exports,arguments)
},{"dup":365}],431:[function(require,module,exports){
(function (Buffer){
'use strict';
var inherits = require('inherits')
var md5 = require('./md5')
var rmd160 = require('ripemd160')
var sha = require('sha.js')

var Base = require('cipher-base')

function HashNoConstructor(hash) {
  Base.call(this, 'digest')

  this._hash = hash
  this.buffers = []
}

inherits(HashNoConstructor, Base)

HashNoConstructor.prototype._update = function (data) {
  this.buffers.push(data)
}

HashNoConstructor.prototype._final = function () {
  var buf = Buffer.concat(this.buffers)
  var r = this._hash(buf)
  this.buffers = null

  return r
}

function Hash(hash) {
  Base.call(this, 'digest')

  this._hash = hash
}

inherits(Hash, Base)

Hash.prototype._update = function (data) {
  this._hash.update(data)
}

Hash.prototype._final = function () {
  return this._hash.digest()
}

module.exports = function createHash (alg) {
  alg = alg.toLowerCase()
  if ('md5' === alg) return new HashNoConstructor(md5)
  if ('rmd160' === alg || 'ripemd160' === alg) return new HashNoConstructor(rmd160)

  return new Hash(sha(alg))
}

}).call(this,require("buffer").Buffer)
},{"./md5":433,"buffer":303,"cipher-base":434,"inherits":500,"ripemd160":435,"sha.js":437}],432:[function(require,module,exports){
(function (Buffer){
'use strict';
var intSize = 4;
var zeroBuffer = new Buffer(intSize); zeroBuffer.fill(0);
var chrsz = 8;

function toArray(buf, bigEndian) {
  if ((buf.length % intSize) !== 0) {
    var len = buf.length + (intSize - (buf.length % intSize));
    buf = Buffer.concat([buf, zeroBuffer], len);
  }

  var arr = [];
  var fn = bigEndian ? buf.readInt32BE : buf.readInt32LE;
  for (var i = 0; i < buf.length; i += intSize) {
    arr.push(fn.call(buf, i));
  }
  return arr;
}

function toBuffer(arr, size, bigEndian) {
  var buf = new Buffer(size);
  var fn = bigEndian ? buf.writeInt32BE : buf.writeInt32LE;
  for (var i = 0; i < arr.length; i++) {
    fn.call(buf, arr[i], i * 4, true);
  }
  return buf;
}

function hash(buf, fn, hashSize, bigEndian) {
  if (!Buffer.isBuffer(buf)) buf = new Buffer(buf);
  var arr = fn(toArray(buf, bigEndian), buf.length * chrsz);
  return toBuffer(arr, hashSize, bigEndian);
}
exports.hash = hash;
}).call(this,require("buffer").Buffer)
},{"buffer":303}],433:[function(require,module,exports){
'use strict';
/*
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.1 Copyright (C) Paul Johnston 1999 - 2002.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */

var helpers = require('./helpers');

/*
 * Calculate the MD5 of an array of little-endian words, and a bit length
 */
function core_md5(x, len)
{
  /* append padding */
  x[len >> 5] |= 0x80 << ((len) % 32);
  x[(((len + 64) >>> 9) << 4) + 14] = len;

  var a =  1732584193;
  var b = -271733879;
  var c = -1732584194;
  var d =  271733878;

  for(var i = 0; i < x.length; i += 16)
  {
    var olda = a;
    var oldb = b;
    var oldc = c;
    var oldd = d;

    a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);
    d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);
    c = md5_ff(c, d, a, b, x[i+ 2], 17,  606105819);
    b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);
    a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);
    d = md5_ff(d, a, b, c, x[i+ 5], 12,  1200080426);
    c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);
    b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);
    a = md5_ff(a, b, c, d, x[i+ 8], 7 ,  1770035416);
    d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);
    c = md5_ff(c, d, a, b, x[i+10], 17, -42063);
    b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);
    a = md5_ff(a, b, c, d, x[i+12], 7 ,  1804603682);
    d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);
    c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);
    b = md5_ff(b, c, d, a, x[i+15], 22,  1236535329);

    a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);
    d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);
    c = md5_gg(c, d, a, b, x[i+11], 14,  643717713);
    b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);
    a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);
    d = md5_gg(d, a, b, c, x[i+10], 9 ,  38016083);
    c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);
    b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);
    a = md5_gg(a, b, c, d, x[i+ 9], 5 ,  568446438);
    d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);
    c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);
    b = md5_gg(b, c, d, a, x[i+ 8], 20,  1163531501);
    a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);
    d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);
    c = md5_gg(c, d, a, b, x[i+ 7], 14,  1735328473);
    b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);

    a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);
    d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);
    c = md5_hh(c, d, a, b, x[i+11], 16,  1839030562);
    b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);
    a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);
    d = md5_hh(d, a, b, c, x[i+ 4], 11,  1272893353);
    c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);
    b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);
    a = md5_hh(a, b, c, d, x[i+13], 4 ,  681279174);
    d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);
    c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);
    b = md5_hh(b, c, d, a, x[i+ 6], 23,  76029189);
    a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);
    d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);
    c = md5_hh(c, d, a, b, x[i+15], 16,  530742520);
    b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);

    a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);
    d = md5_ii(d, a, b, c, x[i+ 7], 10,  1126891415);
    c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);
    b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);
    a = md5_ii(a, b, c, d, x[i+12], 6 ,  1700485571);
    d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);
    c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);
    b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);
    a = md5_ii(a, b, c, d, x[i+ 8], 6 ,  1873313359);
    d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);
    c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);
    b = md5_ii(b, c, d, a, x[i+13], 21,  1309151649);
    a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);
    d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);
    c = md5_ii(c, d, a, b, x[i+ 2], 15,  718787259);
    b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);

    a = safe_add(a, olda);
    b = safe_add(b, oldb);
    c = safe_add(c, oldc);
    d = safe_add(d, oldd);
  }
  return Array(a, b, c, d);

}

/*
 * These functions implement the four basic operations the algorithm uses.
 */
function md5_cmn(q, a, b, x, s, t)
{
  return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);
}
function md5_ff(a, b, c, d, x, s, t)
{
  return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);
}
function md5_gg(a, b, c, d, x, s, t)
{
  return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);
}
function md5_hh(a, b, c, d, x, s, t)
{
  return md5_cmn(b ^ c ^ d, a, b, x, s, t);
}
function md5_ii(a, b, c, d, x, s, t)
{
  return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);
}

/*
 * Add integers, wrapping at 2^32. This uses 16-bit operations internally
 * to work around bugs in some JS interpreters.
 */
function safe_add(x, y)
{
  var lsw = (x & 0xFFFF) + (y & 0xFFFF);
  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
  return (msw << 16) | (lsw & 0xFFFF);
}

/*
 * Bitwise rotate a 32-bit number to the left.
 */
function bit_rol(num, cnt)
{
  return (num << cnt) | (num >>> (32 - cnt));
}

module.exports = function md5(buf) {
  return helpers.hash(buf, core_md5, 16);
};
},{"./helpers":432}],434:[function(require,module,exports){
arguments[4][324][0].apply(exports,arguments)
},{"buffer":303,"dup":324,"inherits":500,"stream":521,"string_decoder":522}],435:[function(require,module,exports){
(function (Buffer){
/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
/** @preserve
(c) 2012 by Cdric Mesnil. All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

// constants table
var zl = [
  0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
  7, 4, 13, 1, 10, 6, 15, 3, 12, 0, 9, 5, 2, 14, 11, 8,
  3, 10, 14, 4, 9, 15, 8, 1, 2, 7, 0, 6, 13, 11, 5, 12,
  1, 9, 11, 10, 0, 8, 12, 4, 13, 3, 7, 15, 14, 5, 6, 2,
  4, 0, 5, 9, 7, 12, 2, 10, 14, 1, 3, 8, 11, 6, 15, 13
]

var zr = [
  5, 14, 7, 0, 9, 2, 11, 4, 13, 6, 15, 8, 1, 10, 3, 12,
  6, 11, 3, 7, 0, 13, 5, 10, 14, 15, 8, 12, 4, 9, 1, 2,
  15, 5, 1, 3, 7, 14, 6, 9, 11, 8, 12, 2, 10, 0, 4, 13,
  8, 6, 4, 1, 3, 11, 15, 0, 5, 12, 2, 13, 9, 7, 10, 14,
  12, 15, 10, 4, 1, 5, 8, 7, 6, 2, 13, 14, 0, 3, 9, 11
]

var sl = [
  11, 14, 15, 12, 5, 8, 7, 9, 11, 13, 14, 15, 6, 7, 9, 8,
  7, 6, 8, 13, 11, 9, 7, 15, 7, 12, 15, 9, 11, 7, 13, 12,
  11, 13, 6, 7, 14, 9, 13, 15, 14, 8, 13, 6, 5, 12, 7, 5,
  11, 12, 14, 15, 14, 15, 9, 8, 9, 14, 5, 6, 8, 6, 5, 12,
  9, 15, 5, 11, 6, 8, 13, 12, 5, 12, 13, 14, 11, 8, 5, 6
]

var sr = [
  8, 9, 9, 11, 13, 15, 15, 5, 7, 7, 8, 11, 14, 14, 12, 6,
  9, 13, 15, 7, 12, 8, 9, 11, 7, 7, 12, 7, 6, 15, 13, 11,
  9, 7, 15, 11, 8, 6, 6, 14, 12, 13, 5, 14, 13, 13, 7, 5,
  15, 5, 8, 11, 14, 14, 6, 14, 6, 9, 12, 9, 12, 5, 15, 8,
  8, 5, 12, 9, 12, 5, 14, 6, 8, 13, 6, 5, 15, 13, 11, 11
]

var hl = [0x00000000, 0x5A827999, 0x6ED9EBA1, 0x8F1BBCDC, 0xA953FD4E]
var hr = [0x50A28BE6, 0x5C4DD124, 0x6D703EF3, 0x7A6D76E9, 0x00000000]

function bytesToWords (bytes) {
  var words = []
  for (var i = 0, b = 0; i < bytes.length; i++, b += 8) {
    words[b >>> 5] |= bytes[i] << (24 - b % 32)
  }
  return words
}

function wordsToBytes (words) {
  var bytes = []
  for (var b = 0; b < words.length * 32; b += 8) {
    bytes.push((words[b >>> 5] >>> (24 - b % 32)) & 0xFF)
  }
  return bytes
}

function processBlock (H, M, offset) {
  // swap endian
  for (var i = 0; i < 16; i++) {
    var offset_i = offset + i
    var M_offset_i = M[offset_i]

    // Swap
    M[offset_i] = (
      (((M_offset_i << 8) | (M_offset_i >>> 24)) & 0x00ff00ff) |
      (((M_offset_i << 24) | (M_offset_i >>> 8)) & 0xff00ff00)
    )
  }

  // Working variables
  var al, bl, cl, dl, el
  var ar, br, cr, dr, er

  ar = al = H[0]
  br = bl = H[1]
  cr = cl = H[2]
  dr = dl = H[3]
  er = el = H[4]

  // computation
  var t
  for (i = 0; i < 80; i += 1) {
    t = (al + M[offset + zl[i]]) | 0
    if (i < 16) {
      t += f1(bl, cl, dl) + hl[0]
    } else if (i < 32) {
      t += f2(bl, cl, dl) + hl[1]
    } else if (i < 48) {
      t += f3(bl, cl, dl) + hl[2]
    } else if (i < 64) {
      t += f4(bl, cl, dl) + hl[3]
    } else {// if (i<80) {
      t += f5(bl, cl, dl) + hl[4]
    }
    t = t | 0
    t = rotl(t, sl[i])
    t = (t + el) | 0
    al = el
    el = dl
    dl = rotl(cl, 10)
    cl = bl
    bl = t

    t = (ar + M[offset + zr[i]]) | 0
    if (i < 16) {
      t += f5(br, cr, dr) + hr[0]
    } else if (i < 32) {
      t += f4(br, cr, dr) + hr[1]
    } else if (i < 48) {
      t += f3(br, cr, dr) + hr[2]
    } else if (i < 64) {
      t += f2(br, cr, dr) + hr[3]
    } else {// if (i<80) {
      t += f1(br, cr, dr) + hr[4]
    }

    t = t | 0
    t = rotl(t, sr[i])
    t = (t + er) | 0
    ar = er
    er = dr
    dr = rotl(cr, 10)
    cr = br
    br = t
  }

  // intermediate hash value
  t = (H[1] + cl + dr) | 0
  H[1] = (H[2] + dl + er) | 0
  H[2] = (H[3] + el + ar) | 0
  H[3] = (H[4] + al + br) | 0
  H[4] = (H[0] + bl + cr) | 0
  H[0] = t
}

function f1 (x, y, z) {
  return ((x) ^ (y) ^ (z))
}

function f2 (x, y, z) {
  return (((x) & (y)) | ((~x) & (z)))
}

function f3 (x, y, z) {
  return (((x) | (~(y))) ^ (z))
}

function f4 (x, y, z) {
  return (((x) & (z)) | ((y) & (~(z))))
}

function f5 (x, y, z) {
  return ((x) ^ ((y) | (~(z))))
}

function rotl (x, n) {
  return (x << n) | (x >>> (32 - n))
}

function ripemd160 (message) {
  var H = [0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0]

  if (typeof message === 'string') {
    message = new Buffer(message, 'utf8')
  }

  var m = bytesToWords(message)

  var nBitsLeft = message.length * 8
  var nBitsTotal = message.length * 8

  // Add padding
  m[nBitsLeft >>> 5] |= 0x80 << (24 - nBitsLeft % 32)
  m[(((nBitsLeft + 64) >>> 9) << 4) + 14] = (
    (((nBitsTotal << 8) | (nBitsTotal >>> 24)) & 0x00ff00ff) |
    (((nBitsTotal << 24) | (nBitsTotal >>> 8)) & 0xff00ff00)
  )

  for (var i = 0; i < m.length; i += 16) {
    processBlock(H, m, i)
  }

  // swap endian
  for (i = 0; i < 5; i++) {
    // shortcut
    var H_i = H[i]

    // Swap
    H[i] = (((H_i << 8) | (H_i >>> 24)) & 0x00ff00ff) |
      (((H_i << 24) | (H_i >>> 8)) & 0xff00ff00)
  }

  var digestbytes = wordsToBytes(H)
  return new Buffer(digestbytes)
}

module.exports = ripemd160

}).call(this,require("buffer").Buffer)
},{"buffer":303}],436:[function(require,module,exports){
(function (Buffer){
// prototype class for hash functions
function Hash (blockSize, finalSize) {
  this._block = new Buffer(blockSize)
  this._finalSize = finalSize
  this._blockSize = blockSize
  this._len = 0
  this._s = 0
}

Hash.prototype.update = function (data, enc) {
  if (typeof data === 'string') {
    enc = enc || 'utf8'
    data = new Buffer(data, enc)
  }

  var l = this._len += data.length
  var s = this._s || 0
  var f = 0
  var buffer = this._block

  while (s < l) {
    var t = Math.min(data.length, f + this._blockSize - (s % this._blockSize))
    var ch = (t - f)

    for (var i = 0; i < ch; i++) {
      buffer[(s % this._blockSize) + i] = data[i + f]
    }

    s += ch
    f += ch

    if ((s % this._blockSize) === 0) {
      this._update(buffer)
    }
  }
  this._s = s

  return this
}

Hash.prototype.digest = function (enc) {
  // Suppose the length of the message M, in bits, is l
  var l = this._len * 8

  // Append the bit 1 to the end of the message
  this._block[this._len % this._blockSize] = 0x80

  // and then k zero bits, where k is the smallest non-negative solution to the equation (l + 1 + k) === finalSize mod blockSize
  this._block.fill(0, this._len % this._blockSize + 1)

  if (l % (this._blockSize * 8) >= this._finalSize * 8) {
    this._update(this._block)
    this._block.fill(0)
  }

  // to this append the block which is equal to the number l written in binary
  // TODO: handle case where l is > Math.pow(2, 29)
  this._block.writeInt32BE(l, this._blockSize - 4)

  var hash = this._update(this._block) || this._hash()

  return enc ? hash.toString(enc) : hash
}

Hash.prototype._update = function () {
  throw new Error('_update must be implemented by subclass')
}

module.exports = Hash

}).call(this,require("buffer").Buffer)
},{"buffer":303}],437:[function(require,module,exports){
var exports = module.exports = function SHA (algorithm) {
  algorithm = algorithm.toLowerCase()

  var Algorithm = exports[algorithm]
  if (!Algorithm) throw new Error(algorithm + ' is not supported (we accept pull requests)')

  return new Algorithm()
}

exports.sha = require('./sha')
exports.sha1 = require('./sha1')
exports.sha224 = require('./sha224')
exports.sha256 = require('./sha256')
exports.sha384 = require('./sha384')
exports.sha512 = require('./sha512')

},{"./sha":438,"./sha1":439,"./sha224":440,"./sha256":441,"./sha384":442,"./sha512":443}],438:[function(require,module,exports){
(function (Buffer){
/*
 * A JavaScript implementation of the Secure Hash Algorithm, SHA-0, as defined
 * in FIPS PUB 180-1
 * This source code is derived from sha1.js of the same repository.
 * The difference between SHA-0 and SHA-1 is just a bitwise rotate left
 * operation was added.
 */

var inherits = require('inherits')
var Hash = require('./hash')

var W = new Array(80)

function Sha () {
  this.init()
  this._w = W

  Hash.call(this, 64, 56)
}

inherits(Sha, Hash)

Sha.prototype.init = function () {
  this._a = 0x67452301 | 0
  this._b = 0xefcdab89 | 0
  this._c = 0x98badcfe | 0
  this._d = 0x10325476 | 0
  this._e = 0xc3d2e1f0 | 0

  return this
}

/*
 * Bitwise rotate a 32-bit number to the left.
 */
function rol (num, cnt) {
  return (num << cnt) | (num >>> (32 - cnt))
}

Sha.prototype._update = function (M) {
  var W = this._w

  var a = this._a
  var b = this._b
  var c = this._c
  var d = this._d
  var e = this._e

  var j = 0
  var k

  /*
   * SHA-1 has a bitwise rotate left operation. But, SHA is not
   * function calcW() { return rol(W[j - 3] ^ W[j -  8] ^ W[j - 14] ^ W[j - 16], 1) }
   */
  function calcW () { return W[j - 3] ^ W[j - 8] ^ W[j - 14] ^ W[j - 16] }
  function loop (w, f) {
    W[j] = w

    var t = rol(a, 5) + f + e + w + k

    e = d
    d = c
    c = rol(b, 30)
    b = a
    a = t
    j++
  }

  k = 1518500249
  while (j < 16) loop(M.readInt32BE(j * 4), (b & c) | ((~b) & d))
  while (j < 20) loop(calcW(), (b & c) | ((~b) & d))
  k = 1859775393
  while (j < 40) loop(calcW(), b ^ c ^ d)
  k = -1894007588
  while (j < 60) loop(calcW(), (b & c) | (b & d) | (c & d))
  k = -899497514
  while (j < 80) loop(calcW(), b ^ c ^ d)

  this._a = (a + this._a) | 0
  this._b = (b + this._b) | 0
  this._c = (c + this._c) | 0
  this._d = (d + this._d) | 0
  this._e = (e + this._e) | 0
}

Sha.prototype._hash = function () {
  var H = new Buffer(20)

  H.writeInt32BE(this._a | 0, 0)
  H.writeInt32BE(this._b | 0, 4)
  H.writeInt32BE(this._c | 0, 8)
  H.writeInt32BE(this._d | 0, 12)
  H.writeInt32BE(this._e | 0, 16)

  return H
}

module.exports = Sha


}).call(this,require("buffer").Buffer)
},{"./hash":436,"buffer":303,"inherits":500}],439:[function(require,module,exports){
(function (Buffer){
/*
 * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined
 * in FIPS PUB 180-1
 * Version 2.1a Copyright Paul Johnston 2000 - 2002.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for details.
 */

var inherits = require('inherits')
var Hash = require('./hash')

var W = new Array(80)

function Sha1 () {
  this.init()
  this._w = W

  Hash.call(this, 64, 56)
}

inherits(Sha1, Hash)

Sha1.prototype.init = function () {
  this._a = 0x67452301 | 0
  this._b = 0xefcdab89 | 0
  this._c = 0x98badcfe | 0
  this._d = 0x10325476 | 0
  this._e = 0xc3d2e1f0 | 0

  return this
}

/*
 * Bitwise rotate a 32-bit number to the left.
 */
function rol (num, cnt) {
  return (num << cnt) | (num >>> (32 - cnt))
}

Sha1.prototype._update = function (M) {
  var W = this._w

  var a = this._a
  var b = this._b
  var c = this._c
  var d = this._d
  var e = this._e

  var j = 0
  var k

  function calcW () { return rol(W[j - 3] ^ W[j - 8] ^ W[j - 14] ^ W[j - 16], 1) }
  function loop (w, f) {
    W[j] = w

    var t = rol(a, 5) + f + e + w + k

    e = d
    d = c
    c = rol(b, 30)
    b = a
    a = t
    j++
  }

  k = 1518500249
  while (j < 16) loop(M.readInt32BE(j * 4), (b & c) | ((~b) & d))
  while (j < 20) loop(calcW(), (b & c) | ((~b) & d))
  k = 1859775393
  while (j < 40) loop(calcW(), b ^ c ^ d)
  k = -1894007588
  while (j < 60) loop(calcW(), (b & c) | (b & d) | (c & d))
  k = -899497514
  while (j < 80) loop(calcW(), b ^ c ^ d)

  this._a = (a + this._a) | 0
  this._b = (b + this._b) | 0
  this._c = (c + this._c) | 0
  this._d = (d + this._d) | 0
  this._e = (e + this._e) | 0
}

Sha1.prototype._hash = function () {
  var H = new Buffer(20)

  H.writeInt32BE(this._a | 0, 0)
  H.writeInt32BE(this._b | 0, 4)
  H.writeInt32BE(this._c | 0, 8)
  H.writeInt32BE(this._d | 0, 12)
  H.writeInt32BE(this._e | 0, 16)

  return H
}

module.exports = Sha1

}).call(this,require("buffer").Buffer)
},{"./hash":436,"buffer":303,"inherits":500}],440:[function(require,module,exports){
(function (Buffer){
/**
 * A JavaScript implementation of the Secure Hash Algorithm, SHA-256, as defined
 * in FIPS 180-2
 * Version 2.2-beta Copyright Angel Marin, Paul Johnston 2000 - 2009.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 *
 */

var inherits = require('inherits')
var Sha256 = require('./sha256')
var Hash = require('./hash')

var W = new Array(64)

function Sha224 () {
  this.init()

  this._w = W // new Array(64)

  Hash.call(this, 64, 56)
}

inherits(Sha224, Sha256)

Sha224.prototype.init = function () {
  this._a = 0xc1059ed8 | 0
  this._b = 0x367cd507 | 0
  this._c = 0x3070dd17 | 0
  this._d = 0xf70e5939 | 0
  this._e = 0xffc00b31 | 0
  this._f = 0x68581511 | 0
  this._g = 0x64f98fa7 | 0
  this._h = 0xbefa4fa4 | 0

  return this
}

Sha224.prototype._hash = function () {
  var H = new Buffer(28)

  H.writeInt32BE(this._a, 0)
  H.writeInt32BE(this._b, 4)
  H.writeInt32BE(this._c, 8)
  H.writeInt32BE(this._d, 12)
  H.writeInt32BE(this._e, 16)
  H.writeInt32BE(this._f, 20)
  H.writeInt32BE(this._g, 24)

  return H
}

module.exports = Sha224

}).call(this,require("buffer").Buffer)
},{"./hash":436,"./sha256":441,"buffer":303,"inherits":500}],441:[function(require,module,exports){
(function (Buffer){
/**
 * A JavaScript implementation of the Secure Hash Algorithm, SHA-256, as defined
 * in FIPS 180-2
 * Version 2.2-beta Copyright Angel Marin, Paul Johnston 2000 - 2009.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 *
 */

var inherits = require('inherits')
var Hash = require('./hash')

var K = [
  0x428A2F98, 0x71374491, 0xB5C0FBCF, 0xE9B5DBA5,
  0x3956C25B, 0x59F111F1, 0x923F82A4, 0xAB1C5ED5,
  0xD807AA98, 0x12835B01, 0x243185BE, 0x550C7DC3,
  0x72BE5D74, 0x80DEB1FE, 0x9BDC06A7, 0xC19BF174,
  0xE49B69C1, 0xEFBE4786, 0x0FC19DC6, 0x240CA1CC,
  0x2DE92C6F, 0x4A7484AA, 0x5CB0A9DC, 0x76F988DA,
  0x983E5152, 0xA831C66D, 0xB00327C8, 0xBF597FC7,
  0xC6E00BF3, 0xD5A79147, 0x06CA6351, 0x14292967,
  0x27B70A85, 0x2E1B2138, 0x4D2C6DFC, 0x53380D13,
  0x650A7354, 0x766A0ABB, 0x81C2C92E, 0x92722C85,
  0xA2BFE8A1, 0xA81A664B, 0xC24B8B70, 0xC76C51A3,
  0xD192E819, 0xD6990624, 0xF40E3585, 0x106AA070,
  0x19A4C116, 0x1E376C08, 0x2748774C, 0x34B0BCB5,
  0x391C0CB3, 0x4ED8AA4A, 0x5B9CCA4F, 0x682E6FF3,
  0x748F82EE, 0x78A5636F, 0x84C87814, 0x8CC70208,
  0x90BEFFFA, 0xA4506CEB, 0xBEF9A3F7, 0xC67178F2
]

var W = new Array(64)

function Sha256 () {
  this.init()

  this._w = W // new Array(64)

  Hash.call(this, 64, 56)
}

inherits(Sha256, Hash)

Sha256.prototype.init = function () {
  this._a = 0x6a09e667 | 0
  this._b = 0xbb67ae85 | 0
  this._c = 0x3c6ef372 | 0
  this._d = 0xa54ff53a | 0
  this._e = 0x510e527f | 0
  this._f = 0x9b05688c | 0
  this._g = 0x1f83d9ab | 0
  this._h = 0x5be0cd19 | 0

  return this
}

function Ch (x, y, z) {
  return z ^ (x & (y ^ z))
}

function Maj (x, y, z) {
  return (x & y) | (z & (x | y))
}

function Sigma0 (x) {
  return (x >>> 2 | x << 30) ^ (x >>> 13 | x << 19) ^ (x >>> 22 | x << 10)
}

function Sigma1 (x) {
  return (x >>> 6 | x << 26) ^ (x >>> 11 | x << 21) ^ (x >>> 25 | x << 7)
}

function Gamma0 (x) {
  return (x >>> 7 | x << 25) ^ (x >>> 18 | x << 14) ^ (x >>> 3)
}

function Gamma1 (x) {
  return (x >>> 17 | x << 15) ^ (x >>> 19 | x << 13) ^ (x >>> 10)
}

Sha256.prototype._update = function (M) {
  var W = this._w

  var a = this._a | 0
  var b = this._b | 0
  var c = this._c | 0
  var d = this._d | 0
  var e = this._e | 0
  var f = this._f | 0
  var g = this._g | 0
  var h = this._h | 0

  var j = 0

  function calcW () { return Gamma1(W[j - 2]) + W[j - 7] + Gamma0(W[j - 15]) + W[j - 16] }
  function loop (w) {
    W[j] = w

    var T1 = h + Sigma1(e) + Ch(e, f, g) + K[j] + w
    var T2 = Sigma0(a) + Maj(a, b, c)

    h = g
    g = f
    f = e
    e = d + T1
    d = c
    c = b
    b = a
    a = T1 + T2

    j++
  }

  while (j < 16) loop(M.readInt32BE(j * 4))
  while (j < 64) loop(calcW())

  this._a = (a + this._a) | 0
  this._b = (b + this._b) | 0
  this._c = (c + this._c) | 0
  this._d = (d + this._d) | 0
  this._e = (e + this._e) | 0
  this._f = (f + this._f) | 0
  this._g = (g + this._g) | 0
  this._h = (h + this._h) | 0
}

Sha256.prototype._hash = function () {
  var H = new Buffer(32)

  H.writeInt32BE(this._a, 0)
  H.writeInt32BE(this._b, 4)
  H.writeInt32BE(this._c, 8)
  H.writeInt32BE(this._d, 12)
  H.writeInt32BE(this._e, 16)
  H.writeInt32BE(this._f, 20)
  H.writeInt32BE(this._g, 24)
  H.writeInt32BE(this._h, 28)

  return H
}

module.exports = Sha256

}).call(this,require("buffer").Buffer)
},{"./hash":436,"buffer":303,"inherits":500}],442:[function(require,module,exports){
(function (Buffer){
var inherits = require('inherits')
var SHA512 = require('./sha512')
var Hash = require('./hash')

var W = new Array(160)

function Sha384 () {
  this.init()
  this._w = W

  Hash.call(this, 128, 112)
}

inherits(Sha384, SHA512)

Sha384.prototype.init = function () {
  this._a = 0xcbbb9d5d | 0
  this._b = 0x629a292a | 0
  this._c = 0x9159015a | 0
  this._d = 0x152fecd8 | 0
  this._e = 0x67332667 | 0
  this._f = 0x8eb44a87 | 0
  this._g = 0xdb0c2e0d | 0
  this._h = 0x47b5481d | 0

  this._al = 0xc1059ed8 | 0
  this._bl = 0x367cd507 | 0
  this._cl = 0x3070dd17 | 0
  this._dl = 0xf70e5939 | 0
  this._el = 0xffc00b31 | 0
  this._fl = 0x68581511 | 0
  this._gl = 0x64f98fa7 | 0
  this._hl = 0xbefa4fa4 | 0

  return this
}

Sha384.prototype._hash = function () {
  var H = new Buffer(48)

  function writeInt64BE (h, l, offset) {
    H.writeInt32BE(h, offset)
    H.writeInt32BE(l, offset + 4)
  }

  writeInt64BE(this._a, this._al, 0)
  writeInt64BE(this._b, this._bl, 8)
  writeInt64BE(this._c, this._cl, 16)
  writeInt64BE(this._d, this._dl, 24)
  writeInt64BE(this._e, this._el, 32)
  writeInt64BE(this._f, this._fl, 40)

  return H
}

module.exports = Sha384

}).call(this,require("buffer").Buffer)
},{"./hash":436,"./sha512":443,"buffer":303,"inherits":500}],443:[function(require,module,exports){
(function (Buffer){
var inherits = require('inherits')
var Hash = require('./hash')

var K = [
  0x428a2f98, 0xd728ae22, 0x71374491, 0x23ef65cd,
  0xb5c0fbcf, 0xec4d3b2f, 0xe9b5dba5, 0x8189dbbc,
  0x3956c25b, 0xf348b538, 0x59f111f1, 0xb605d019,
  0x923f82a4, 0xaf194f9b, 0xab1c5ed5, 0xda6d8118,
  0xd807aa98, 0xa3030242, 0x12835b01, 0x45706fbe,
  0x243185be, 0x4ee4b28c, 0x550c7dc3, 0xd5ffb4e2,
  0x72be5d74, 0xf27b896f, 0x80deb1fe, 0x3b1696b1,
  0x9bdc06a7, 0x25c71235, 0xc19bf174, 0xcf692694,
  0xe49b69c1, 0x9ef14ad2, 0xefbe4786, 0x384f25e3,
  0x0fc19dc6, 0x8b8cd5b5, 0x240ca1cc, 0x77ac9c65,
  0x2de92c6f, 0x592b0275, 0x4a7484aa, 0x6ea6e483,
  0x5cb0a9dc, 0xbd41fbd4, 0x76f988da, 0x831153b5,
  0x983e5152, 0xee66dfab, 0xa831c66d, 0x2db43210,
  0xb00327c8, 0x98fb213f, 0xbf597fc7, 0xbeef0ee4,
  0xc6e00bf3, 0x3da88fc2, 0xd5a79147, 0x930aa725,
  0x06ca6351, 0xe003826f, 0x14292967, 0x0a0e6e70,
  0x27b70a85, 0x46d22ffc, 0x2e1b2138, 0x5c26c926,
  0x4d2c6dfc, 0x5ac42aed, 0x53380d13, 0x9d95b3df,
  0x650a7354, 0x8baf63de, 0x766a0abb, 0x3c77b2a8,
  0x81c2c92e, 0x47edaee6, 0x92722c85, 0x1482353b,
  0xa2bfe8a1, 0x4cf10364, 0xa81a664b, 0xbc423001,
  0xc24b8b70, 0xd0f89791, 0xc76c51a3, 0x0654be30,
  0xd192e819, 0xd6ef5218, 0xd6990624, 0x5565a910,
  0xf40e3585, 0x5771202a, 0x106aa070, 0x32bbd1b8,
  0x19a4c116, 0xb8d2d0c8, 0x1e376c08, 0x5141ab53,
  0x2748774c, 0xdf8eeb99, 0x34b0bcb5, 0xe19b48a8,
  0x391c0cb3, 0xc5c95a63, 0x4ed8aa4a, 0xe3418acb,
  0x5b9cca4f, 0x7763e373, 0x682e6ff3, 0xd6b2b8a3,
  0x748f82ee, 0x5defb2fc, 0x78a5636f, 0x43172f60,
  0x84c87814, 0xa1f0ab72, 0x8cc70208, 0x1a6439ec,
  0x90befffa, 0x23631e28, 0xa4506ceb, 0xde82bde9,
  0xbef9a3f7, 0xb2c67915, 0xc67178f2, 0xe372532b,
  0xca273ece, 0xea26619c, 0xd186b8c7, 0x21c0c207,
  0xeada7dd6, 0xcde0eb1e, 0xf57d4f7f, 0xee6ed178,
  0x06f067aa, 0x72176fba, 0x0a637dc5, 0xa2c898a6,
  0x113f9804, 0xbef90dae, 0x1b710b35, 0x131c471b,
  0x28db77f5, 0x23047d84, 0x32caab7b, 0x40c72493,
  0x3c9ebe0a, 0x15c9bebc, 0x431d67c4, 0x9c100d4c,
  0x4cc5d4be, 0xcb3e42b6, 0x597f299c, 0xfc657e2a,
  0x5fcb6fab, 0x3ad6faec, 0x6c44198c, 0x4a475817
]

var W = new Array(160)

function Sha512 () {
  this.init()
  this._w = W

  Hash.call(this, 128, 112)
}

inherits(Sha512, Hash)

Sha512.prototype.init = function () {
  this._a = 0x6a09e667 | 0
  this._b = 0xbb67ae85 | 0
  this._c = 0x3c6ef372 | 0
  this._d = 0xa54ff53a | 0
  this._e = 0x510e527f | 0
  this._f = 0x9b05688c | 0
  this._g = 0x1f83d9ab | 0
  this._h = 0x5be0cd19 | 0

  this._al = 0xf3bcc908 | 0
  this._bl = 0x84caa73b | 0
  this._cl = 0xfe94f82b | 0
  this._dl = 0x5f1d36f1 | 0
  this._el = 0xade682d1 | 0
  this._fl = 0x2b3e6c1f | 0
  this._gl = 0xfb41bd6b | 0
  this._hl = 0x137e2179 | 0

  return this
}

function Ch (x, y, z) {
  return z ^ (x & (y ^ z))
}

function Maj (x, y, z) {
  return (x & y) | (z & (x | y))
}

function Sigma0 (x, xl) {
  return (x >>> 28 | xl << 4) ^ (xl >>> 2 | x << 30) ^ (xl >>> 7 | x << 25)
}

function Sigma1 (x, xl) {
  return (x >>> 14 | xl << 18) ^ (x >>> 18 | xl << 14) ^ (xl >>> 9 | x << 23)
}

function Gamma0 (x, xl) {
  return (x >>> 1 | xl << 31) ^ (x >>> 8 | xl << 24) ^ (x >>> 7)
}

function Gamma0l (x, xl) {
  return (x >>> 1 | xl << 31) ^ (x >>> 8 | xl << 24) ^ (x >>> 7 | xl << 25)
}

function Gamma1 (x, xl) {
  return (x >>> 19 | xl << 13) ^ (xl >>> 29 | x << 3) ^ (x >>> 6)
}

function Gamma1l (x, xl) {
  return (x >>> 19 | xl << 13) ^ (xl >>> 29 | x << 3) ^ (x >>> 6 | xl << 26)
}

Sha512.prototype._update = function (M) {
  var W = this._w

  var a = this._a | 0
  var b = this._b | 0
  var c = this._c | 0
  var d = this._d | 0
  var e = this._e | 0
  var f = this._f | 0
  var g = this._g | 0
  var h = this._h | 0

  var al = this._al | 0
  var bl = this._bl | 0
  var cl = this._cl | 0
  var dl = this._dl | 0
  var el = this._el | 0
  var fl = this._fl | 0
  var gl = this._gl | 0
  var hl = this._hl | 0

  var i = 0
  var j = 0
  var Wi, Wil
  function calcW () {
    var x = W[j - 15 * 2]
    var xl = W[j - 15 * 2 + 1]
    var gamma0 = Gamma0(x, xl)
    var gamma0l = Gamma0l(xl, x)

    x = W[j - 2 * 2]
    xl = W[j - 2 * 2 + 1]
    var gamma1 = Gamma1(x, xl)
    var gamma1l = Gamma1l(xl, x)

    // W[i] = gamma0 + W[i - 7] + gamma1 + W[i - 16]
    var Wi7 = W[j - 7 * 2]
    var Wi7l = W[j - 7 * 2 + 1]

    var Wi16 = W[j - 16 * 2]
    var Wi16l = W[j - 16 * 2 + 1]

    Wil = gamma0l + Wi7l
    Wi = gamma0 + Wi7 + ((Wil >>> 0) < (gamma0l >>> 0) ? 1 : 0)
    Wil = Wil + gamma1l
    Wi = Wi + gamma1 + ((Wil >>> 0) < (gamma1l >>> 0) ? 1 : 0)
    Wil = Wil + Wi16l
    Wi = Wi + Wi16 + ((Wil >>> 0) < (Wi16l >>> 0) ? 1 : 0)
  }

  function loop () {
    W[j] = Wi
    W[j + 1] = Wil

    var maj = Maj(a, b, c)
    var majl = Maj(al, bl, cl)

    var sigma0h = Sigma0(a, al)
    var sigma0l = Sigma0(al, a)
    var sigma1h = Sigma1(e, el)
    var sigma1l = Sigma1(el, e)

    // t1 = h + sigma1 + ch + K[i] + W[i]
    var Ki = K[j]
    var Kil = K[j + 1]

    var ch = Ch(e, f, g)
    var chl = Ch(el, fl, gl)

    var t1l = hl + sigma1l
    var t1 = h + sigma1h + ((t1l >>> 0) < (hl >>> 0) ? 1 : 0)
    t1l = t1l + chl
    t1 = t1 + ch + ((t1l >>> 0) < (chl >>> 0) ? 1 : 0)
    t1l = t1l + Kil
    t1 = t1 + Ki + ((t1l >>> 0) < (Kil >>> 0) ? 1 : 0)
    t1l = t1l + Wil
    t1 = t1 + Wi + ((t1l >>> 0) < (Wil >>> 0) ? 1 : 0)

    // t2 = sigma0 + maj
    var t2l = sigma0l + majl
    var t2 = sigma0h + maj + ((t2l >>> 0) < (sigma0l >>> 0) ? 1 : 0)

    h = g
    hl = gl
    g = f
    gl = fl
    f = e
    fl = el
    el = (dl + t1l) | 0
    e = (d + t1 + ((el >>> 0) < (dl >>> 0) ? 1 : 0)) | 0
    d = c
    dl = cl
    c = b
    cl = bl
    b = a
    bl = al
    al = (t1l + t2l) | 0
    a = (t1 + t2 + ((al >>> 0) < (t1l >>> 0) ? 1 : 0)) | 0

    i++
    j += 2
  }

  while (i < 16) {
    Wi = M.readInt32BE(j * 4)
    Wil = M.readInt32BE(j * 4 + 4)

    loop()
  }

  while (i < 80) {
    calcW()
    loop()
  }

  this._al = (this._al + al) | 0
  this._bl = (this._bl + bl) | 0
  this._cl = (this._cl + cl) | 0
  this._dl = (this._dl + dl) | 0
  this._el = (this._el + el) | 0
  this._fl = (this._fl + fl) | 0
  this._gl = (this._gl + gl) | 0
  this._hl = (this._hl + hl) | 0

  this._a = (this._a + a + ((this._al >>> 0) < (al >>> 0) ? 1 : 0)) | 0
  this._b = (this._b + b + ((this._bl >>> 0) < (bl >>> 0) ? 1 : 0)) | 0
  this._c = (this._c + c + ((this._cl >>> 0) < (cl >>> 0) ? 1 : 0)) | 0
  this._d = (this._d + d + ((this._dl >>> 0) < (dl >>> 0) ? 1 : 0)) | 0
  this._e = (this._e + e + ((this._el >>> 0) < (el >>> 0) ? 1 : 0)) | 0
  this._f = (this._f + f + ((this._fl >>> 0) < (fl >>> 0) ? 1 : 0)) | 0
  this._g = (this._g + g + ((this._gl >>> 0) < (gl >>> 0) ? 1 : 0)) | 0
  this._h = (this._h + h + ((this._hl >>> 0) < (hl >>> 0) ? 1 : 0)) | 0
}

Sha512.prototype._hash = function () {
  var H = new Buffer(64)

  function writeInt64BE (h, l, offset) {
    H.writeInt32BE(h, offset)
    H.writeInt32BE(l, offset + 4)
  }

  writeInt64BE(this._a, this._al, 0)
  writeInt64BE(this._b, this._bl, 8)
  writeInt64BE(this._c, this._cl, 16)
  writeInt64BE(this._d, this._dl, 24)
  writeInt64BE(this._e, this._el, 32)
  writeInt64BE(this._f, this._fl, 40)
  writeInt64BE(this._g, this._gl, 48)
  writeInt64BE(this._h, this._hl, 56)

  return H
}

module.exports = Sha512

}).call(this,require("buffer").Buffer)
},{"./hash":436,"buffer":303,"inherits":500}],444:[function(require,module,exports){
(function (Buffer){
'use strict';
var createHash = require('create-hash/browser');
var inherits = require('inherits')

var Transform = require('stream').Transform

var ZEROS = new Buffer(128)
ZEROS.fill(0)

function Hmac(alg, key) {
  Transform.call(this)
  alg = alg.toLowerCase()
  if (typeof key === 'string') {
    key = new Buffer(key)
  }

  var blocksize = (alg === 'sha512' || alg === 'sha384') ? 128 : 64

  this._alg = alg
  this._key = key

  if (key.length > blocksize) {
    key = createHash(alg).update(key).digest()

  } else if (key.length < blocksize) {
    key = Buffer.concat([key, ZEROS], blocksize)
  }

  var ipad = this._ipad = new Buffer(blocksize)
  var opad = this._opad = new Buffer(blocksize)

  for (var i = 0; i < blocksize; i++) {
    ipad[i] = key[i] ^ 0x36
    opad[i] = key[i] ^ 0x5C
  }

  this._hash = createHash(alg).update(ipad)
}

inherits(Hmac, Transform)

Hmac.prototype.update = function (data, enc) {
  this._hash.update(data, enc)

  return this
}

Hmac.prototype._transform = function (data, _, next) {
  this._hash.update(data)

  next()
}

Hmac.prototype._flush = function (next) {
  this.push(this.digest())

  next()
}

Hmac.prototype.digest = function (enc) {
  var h = this._hash.digest()

  return createHash(this._alg).update(this._opad).update(h).digest(enc)
}

module.exports = function createHmac(alg, key) {
  return new Hmac(alg, key)
}

}).call(this,require("buffer").Buffer)
},{"buffer":303,"create-hash/browser":431,"inherits":500,"stream":521}],445:[function(require,module,exports){
(function (Buffer){
var generatePrime = require('./lib/generatePrime')
var primes = require('./lib/primes.json')

var DH = require('./lib/dh')

function getDiffieHellman (mod) {
  var prime = new Buffer(primes[mod].prime, 'hex')
  var gen = new Buffer(primes[mod].gen, 'hex')

  return new DH(prime, gen)
}

var ENCODINGS = {
  'binary': true, 'hex': true, 'base64': true
}

function createDiffieHellman (prime, enc, generator, genc) {
  if (Buffer.isBuffer(enc) || ENCODINGS[enc] === undefined) {
    return createDiffieHellman(prime, 'binary', enc, generator)
  }

  enc = enc || 'binary'
  genc = genc || 'binary'
  generator = generator || new Buffer([2])

  if (!Buffer.isBuffer(generator)) {
    generator = new Buffer(generator, genc)
  }

  if (typeof prime === 'number') {
    return new DH(generatePrime(prime, generator), generator, true)
  }

  if (!Buffer.isBuffer(prime)) {
    prime = new Buffer(prime, enc)
  }

  return new DH(prime, generator, true)
}

exports.DiffieHellmanGroup = exports.createDiffieHellmanGroup = exports.getDiffieHellman = getDiffieHellman
exports.createDiffieHellman = exports.DiffieHellman = createDiffieHellman

}).call(this,require("buffer").Buffer)
},{"./lib/dh":446,"./lib/generatePrime":447,"./lib/primes.json":448,"buffer":303}],446:[function(require,module,exports){
(function (Buffer){
var BN = require('bn.js');
var MillerRabin = require('miller-rabin');
var millerRabin = new MillerRabin();
var TWENTYFOUR = new BN(24);
var ELEVEN = new BN(11);
var TEN = new BN(10);
var THREE = new BN(3);
var SEVEN = new BN(7);
var primes = require('./generatePrime');
var randomBytes = require('randombytes');
module.exports = DH;

function setPublicKey(pub, enc) {
  enc = enc || 'utf8';
  if (!Buffer.isBuffer(pub)) {
    pub = new Buffer(pub, enc);
  }
  this._pub = new BN(pub);
  return this;
}

function setPrivateKey(priv, enc) {
  enc = enc || 'utf8';
  if (!Buffer.isBuffer(priv)) {
    priv = new Buffer(priv, enc);
  }
  this._priv = new BN(priv);
  return this;
}

var primeCache = {};
function checkPrime(prime, generator) {
  var gen = generator.toString('hex');
  var hex = [gen, prime.toString(16)].join('_');
  if (hex in primeCache) {
    return primeCache[hex];
  }
  var error = 0;

  if (prime.isEven() ||
    !primes.simpleSieve ||
    !primes.fermatTest(prime) ||
    !millerRabin.test(prime)) {
    //not a prime so +1
    error += 1;

    if (gen === '02' || gen === '05') {
      // we'd be able to check the generator
      // it would fail so +8
      error += 8;
    } else {
      //we wouldn't be able to test the generator
      // so +4
      error += 4;
    }
    primeCache[hex] = error;
    return error;
  }
  if (!millerRabin.test(prime.shrn(1))) {
    //not a safe prime
    error += 2;
  }
  var rem;
  switch (gen) {
    case '02':
      if (prime.mod(TWENTYFOUR).cmp(ELEVEN)) {
        // unsuidable generator
        error += 8;
      }
      break;
    case '05':
      rem = prime.mod(TEN);
      if (rem.cmp(THREE) && rem.cmp(SEVEN)) {
        // prime mod 10 needs to equal 3 or 7
        error += 8;
      }
      break;
    default:
      error += 4;
  }
  primeCache[hex] = error;
  return error;
}

function DH(prime, generator, malleable) {
  this.setGenerator(generator);
  this.__prime = new BN(prime);
  this._prime = BN.mont(this.__prime);
  this._primeLen = prime.length;
  this._pub = undefined;
  this._priv = undefined;
  this._primeCode = undefined;
  if (malleable) {
    this.setPublicKey = setPublicKey;
    this.setPrivateKey = setPrivateKey;
  } else {
    this._primeCode = 8;
  }
}
Object.defineProperty(DH.prototype, 'verifyError', {
  enumerable: true,
  get: function () {
    if (typeof this._primeCode !== 'number') {
      this._primeCode = checkPrime(this.__prime, this.__gen);
    }
    return this._primeCode;
  }
});
DH.prototype.generateKeys = function () {
  if (!this._priv) {
    this._priv = new BN(randomBytes(this._primeLen));
  }
  this._pub = this._gen.toRed(this._prime).redPow(this._priv).fromRed();
  return this.getPublicKey();
};

DH.prototype.computeSecret = function (other) {
  other = new BN(other);
  other = other.toRed(this._prime);
  var secret = other.redPow(this._priv).fromRed();
  var out = new Buffer(secret.toArray());
  var prime = this.getPrime();
  if (out.length < prime.length) {
    var front = new Buffer(prime.length - out.length);
    front.fill(0);
    out = Buffer.concat([front, out]);
  }
  return out;
};

DH.prototype.getPublicKey = function getPublicKey(enc) {
  return formatReturnValue(this._pub, enc);
};

DH.prototype.getPrivateKey = function getPrivateKey(enc) {
  return formatReturnValue(this._priv, enc);
};

DH.prototype.getPrime = function (enc) {
  return formatReturnValue(this.__prime, enc);
};

DH.prototype.getGenerator = function (enc) {
  return formatReturnValue(this._gen, enc);
};

DH.prototype.setGenerator = function (gen, enc) {
  enc = enc || 'utf8';
  if (!Buffer.isBuffer(gen)) {
    gen = new Buffer(gen, enc);
  }
  this.__gen = gen;
  this._gen = new BN(gen);
  return this;
};

function formatReturnValue(bn, enc) {
  var buf = new Buffer(bn.toArray());
  if (!enc) {
    return buf;
  } else {
    return buf.toString(enc);
  }
}

}).call(this,require("buffer").Buffer)
},{"./generatePrime":447,"bn.js":449,"buffer":303,"miller-rabin":450,"randombytes":498}],447:[function(require,module,exports){
var randomBytes = require('randombytes');
module.exports = findPrime;
findPrime.simpleSieve = simpleSieve;
findPrime.fermatTest = fermatTest;
var BN = require('bn.js');
var TWENTYFOUR = new BN(24);
var MillerRabin = require('miller-rabin');
var millerRabin = new MillerRabin();
var ONE = new BN(1);
var TWO = new BN(2);
var FIVE = new BN(5);
var SIXTEEN = new BN(16);
var EIGHT = new BN(8);
var TEN = new BN(10);
var THREE = new BN(3);
var SEVEN = new BN(7);
var ELEVEN = new BN(11);
var FOUR = new BN(4);
var TWELVE = new BN(12);
var primes = null;

function _getPrimes() {
  if (primes !== null)
    return primes;

  var limit = 0x100000;
  var res = [];
  res[0] = 2;
  for (var i = 1, k = 3; k < limit; k += 2) {
    var sqrt = Math.ceil(Math.sqrt(k));
    for (var j = 0; j < i && res[j] <= sqrt; j++)
      if (k % res[j] === 0)
        break;

    if (i !== j && res[j] <= sqrt)
      continue;

    res[i++] = k;
  }
  primes = res;
  return res;
}

function simpleSieve(p) {
  var primes = _getPrimes();

  for (var i = 0; i < primes.length; i++)
    if (p.modn(primes[i]) === 0) {
      if (p.cmpn(primes[i]) === 0) {
        return true;
      } else {
        return false;
      }
    }

  return true;
}

function fermatTest(p) {
  var red = BN.mont(p);
  return TWO.toRed(red).redPow(p.subn(1)).fromRed().cmpn(1) === 0;
}

function findPrime(bits, gen) {
  if (bits < 16) {
    // this is what openssl does
    if (gen === 2 || gen === 5) {
      return new BN([0x8c, 0x7b]);
    } else {
      return new BN([0x8c, 0x27]);
    }
  }
  gen = new BN(gen);

  var num, n2;

  while (true) {
    num = new BN(randomBytes(Math.ceil(bits / 8)));
    while (num.bitLength() > bits) {
      num.ishrn(1);
    }
    if (num.isEven()) {
      num.iadd(ONE);
    }
    if (!num.testn(1)) {
      num.iadd(TWO);
    }
    if (!gen.cmp(TWO)) {
      while (num.mod(TWENTYFOUR).cmp(ELEVEN)) {
        num.iadd(FOUR);
      }
    } else if (!gen.cmp(FIVE)) {
      while (num.mod(TEN).cmp(THREE)) {
        num.iadd(FOUR);
      }
    }
    n2 = num.shrn(1);
    if (simpleSieve(n2) && simpleSieve(num) &&
      fermatTest(n2) && fermatTest(num) &&
      millerRabin.test(n2) && millerRabin.test(num)) {
      return num;
    }
  }

}

},{"bn.js":449,"miller-rabin":450,"randombytes":498}],448:[function(require,module,exports){
module.exports={
    "modp1": {
        "gen": "02",
        "prime": "ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"
    },
    "modp2": {
        "gen": "02",
        "prime": "ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"
    },
    "modp5": {
        "gen": "02",
        "prime": "ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"
    },
    "modp14": {
        "gen": "02",
        "prime": "ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"
    },
    "modp15": {
        "gen": "02",
        "prime": "ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"
    },
    "modp16": {
        "gen": "02",
        "prime": "ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"
    },
    "modp17": {
        "gen": "02",
        "prime": "ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"
    },
    "modp18": {
        "gen": "02",
        "prime": "ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"
    }
}
},{}],449:[function(require,module,exports){
arguments[4][340][0].apply(exports,arguments)
},{"dup":340}],450:[function(require,module,exports){
var bn = require('bn.js');
var brorand = require('brorand');

function MillerRabin(rand) {
  this.rand = rand || new brorand.Rand();
}
module.exports = MillerRabin;

MillerRabin.create = function create(rand) {
  return new MillerRabin(rand);
};

MillerRabin.prototype._rand = function _rand(n) {
  var len = n.bitLength();
  var buf = this.rand.generate(Math.ceil(len / 8));

  // Set low bits
  buf[0] |= 3;

  // Mask high bits
  var mask = len & 0x7;
  if (mask !== 0)
    buf[buf.length - 1] >>= 7 - mask;

  return new bn(buf);
}

MillerRabin.prototype.test = function test(n, k, cb) {
  var len = n.bitLength();
  var red = bn.mont(n);
  var rone = new bn(1).toRed(red);

  if (!k)
    k = Math.max(1, (len / 48) | 0);

  // Find d and s, (n - 1) = (2 ^ s) * d;
  var n1 = n.subn(1);
  var n2 = n1.subn(1);
  for (var s = 0; !n1.testn(s); s++) {}
  var d = n.shrn(s);

  var rn1 = n1.toRed(red);

  var prime = true;
  for (; k > 0; k--) {
    var a = this._rand(n2);
    if (cb)
      cb(a);

    var x = a.toRed(red).redPow(d);
    if (x.cmp(rone) === 0 || x.cmp(rn1) === 0)
      continue;

    for (var i = 1; i < s; i++) {
      x = x.redSqr();

      if (x.cmp(rone) === 0)
        return false;
      if (x.cmp(rn1) === 0)
        break;
    }

    if (i === s)
      return false;
  }

  return prime;
};

MillerRabin.prototype.getDivisor = function getDivisor(n, k) {
  var len = n.bitLength();
  var red = bn.mont(n);
  var rone = new bn(1).toRed(red);

  if (!k)
    k = Math.max(1, (len / 48) | 0);

  // Find d and s, (n - 1) = (2 ^ s) * d;
  var n1 = n.subn(1);
  var n2 = n1.subn(1);
  for (var s = 0; !n1.testn(s); s++) {}
  var d = n.shrn(s);

  var rn1 = n1.toRed(red);

  for (; k > 0; k--) {
    var a = this._rand(n2);

    var g = n.gcd(a);
    if (g.cmpn(1) !== 0)
      return g;

    var x = a.toRed(red).redPow(d);
    if (x.cmp(rone) === 0 || x.cmp(rn1) === 0)
      continue;

    for (var i = 1; i < s; i++) {
      x = x.redSqr();

      if (x.cmp(rone) === 0)
        return x.fromRed().subn(1).gcd(n);
      if (x.cmp(rn1) === 0)
        break;
    }

    if (i === s) {
      x = x.redSqr();
      return x.fromRed().subn(1).gcd(n);
    }
  }

  return false;
};

},{"bn.js":449,"brorand":451}],451:[function(require,module,exports){
arguments[4][358][0].apply(exports,arguments)
},{"dup":358}],452:[function(require,module,exports){
(function (Buffer){
var createHmac = require('create-hmac')
var MAX_ALLOC = Math.pow(2, 30) - 1 // default in iojs

exports.pbkdf2 = pbkdf2
function pbkdf2 (password, salt, iterations, keylen, digest, callback) {
  if (typeof digest === 'function') {
    callback = digest
    digest = undefined
  }

  if (typeof callback !== 'function') {
    throw new Error('No callback provided to pbkdf2')
  }

  var result = pbkdf2Sync(password, salt, iterations, keylen, digest)
  setTimeout(function () {
    callback(undefined, result)
  })
}

exports.pbkdf2Sync = pbkdf2Sync
function pbkdf2Sync (password, salt, iterations, keylen, digest) {
  if (typeof iterations !== 'number') {
    throw new TypeError('Iterations not a number')
  }

  if (iterations < 0) {
    throw new TypeError('Bad iterations')
  }

  if (typeof keylen !== 'number') {
    throw new TypeError('Key length not a number')
  }

  if (keylen < 0 || keylen > MAX_ALLOC) {
    throw new TypeError('Bad key length')
  }

  digest = digest || 'sha1'

  if (!Buffer.isBuffer(password)) password = new Buffer(password, 'binary')
  if (!Buffer.isBuffer(salt)) salt = new Buffer(salt, 'binary')

  var hLen
  var l = 1
  var DK = new Buffer(keylen)
  var block1 = new Buffer(salt.length + 4)
  salt.copy(block1, 0, 0, salt.length)

  var r
  var T

  for (var i = 1; i <= l; i++) {
    block1.writeUInt32BE(i, salt.length)
    var U = createHmac(digest, password).update(block1).digest()

    if (!hLen) {
      hLen = U.length
      T = new Buffer(hLen)
      l = Math.ceil(keylen / hLen)
      r = keylen - (l - 1) * hLen
    }

    U.copy(T, 0, 0, hLen)

    for (var j = 1; j < iterations; j++) {
      U = createHmac(digest, password).update(U).digest()

      for (var k = 0; k < hLen; k++) {
        T[k] ^= U[k]
      }
    }

    var destPos = (i - 1) * hLen
    var len = (i === l ? r : hLen)
    T.copy(DK, destPos, 0, len)
  }

  return DK
}

}).call(this,require("buffer").Buffer)
},{"buffer":303,"create-hmac":444}],453:[function(require,module,exports){
exports.publicEncrypt = require('./publicEncrypt');
exports.privateDecrypt = require('./privateDecrypt');

exports.privateEncrypt = function privateEncrypt(key, buf) {
  return exports.publicEncrypt(key, buf, true);
};

exports.publicDecrypt = function publicDecrypt(key, buf) {
  return exports.privateDecrypt(key, buf, true);
};
},{"./privateDecrypt":494,"./publicEncrypt":495}],454:[function(require,module,exports){
(function (Buffer){
var createHash = require('create-hash');
module.exports = function (seed, len) {
  var t = new Buffer('');
  var  i = 0, c;
  while (t.length < len) {
    c = i2ops(i++);
    t = Buffer.concat([t, createHash('sha1').update(seed).update(c).digest()]);
  }
  return t.slice(0, len);
};

function i2ops(c) {
  var out = new Buffer(4);
  out.writeUInt32BE(c,0);
  return out;
}
}).call(this,require("buffer").Buffer)
},{"buffer":303,"create-hash":431}],455:[function(require,module,exports){
arguments[4][340][0].apply(exports,arguments)
},{"dup":340}],456:[function(require,module,exports){
arguments[4][341][0].apply(exports,arguments)
},{"bn.js":455,"buffer":303,"dup":341,"randombytes":498}],457:[function(require,module,exports){
arguments[4][366][0].apply(exports,arguments)
},{"dup":366}],458:[function(require,module,exports){
arguments[4][367][0].apply(exports,arguments)
},{"asn1.js":461,"dup":367}],459:[function(require,module,exports){
arguments[4][368][0].apply(exports,arguments)
},{"browserify-aes":478,"buffer":303,"dup":368,"evp_bytestokey":493}],460:[function(require,module,exports){
arguments[4][369][0].apply(exports,arguments)
},{"./aesid.json":457,"./asn1":458,"./fixProc":459,"browserify-aes":478,"buffer":303,"dup":369,"pbkdf2":452}],461:[function(require,module,exports){
arguments[4][370][0].apply(exports,arguments)
},{"./asn1/api":462,"./asn1/base":464,"./asn1/constants":468,"./asn1/decoders":470,"./asn1/encoders":473,"bn.js":455,"dup":370}],462:[function(require,module,exports){
arguments[4][371][0].apply(exports,arguments)
},{"../asn1":461,"dup":371,"inherits":500,"vm":524}],463:[function(require,module,exports){
arguments[4][372][0].apply(exports,arguments)
},{"../base":464,"buffer":303,"dup":372,"inherits":500}],464:[function(require,module,exports){
arguments[4][373][0].apply(exports,arguments)
},{"./buffer":463,"./node":465,"./reporter":466,"dup":373}],465:[function(require,module,exports){
arguments[4][374][0].apply(exports,arguments)
},{"../base":464,"dup":374,"minimalistic-assert":475}],466:[function(require,module,exports){
arguments[4][375][0].apply(exports,arguments)
},{"dup":375,"inherits":500}],467:[function(require,module,exports){
arguments[4][376][0].apply(exports,arguments)
},{"../constants":468,"dup":376}],468:[function(require,module,exports){
arguments[4][377][0].apply(exports,arguments)
},{"./der":467,"dup":377}],469:[function(require,module,exports){
arguments[4][378][0].apply(exports,arguments)
},{"../../asn1":461,"dup":378,"inherits":500}],470:[function(require,module,exports){
arguments[4][379][0].apply(exports,arguments)
},{"./der":469,"./pem":471,"dup":379}],471:[function(require,module,exports){
arguments[4][380][0].apply(exports,arguments)
},{"../../asn1":461,"./der":469,"buffer":303,"dup":380,"inherits":500}],472:[function(require,module,exports){
arguments[4][381][0].apply(exports,arguments)
},{"../../asn1":461,"buffer":303,"dup":381,"inherits":500}],473:[function(require,module,exports){
arguments[4][382][0].apply(exports,arguments)
},{"./der":472,"./pem":474,"dup":382}],474:[function(require,module,exports){
arguments[4][383][0].apply(exports,arguments)
},{"../../asn1":461,"./der":472,"buffer":303,"dup":383,"inherits":500}],475:[function(require,module,exports){
arguments[4][335][0].apply(exports,arguments)
},{"dup":335}],476:[function(require,module,exports){
arguments[4][309][0].apply(exports,arguments)
},{"buffer":303,"dup":309}],477:[function(require,module,exports){
arguments[4][310][0].apply(exports,arguments)
},{"./aes":476,"./ghash":481,"buffer":303,"buffer-xor":490,"cipher-base":491,"dup":310,"inherits":500}],478:[function(require,module,exports){
arguments[4][311][0].apply(exports,arguments)
},{"./decrypter":479,"./encrypter":480,"./modes":482,"dup":311}],479:[function(require,module,exports){
arguments[4][312][0].apply(exports,arguments)
},{"./aes":476,"./authCipher":477,"./modes":482,"./modes/cbc":483,"./modes/cfb":484,"./modes/cfb1":485,"./modes/cfb8":486,"./modes/ctr":487,"./modes/ecb":488,"./modes/ofb":489,"./streamCipher":492,"buffer":303,"cipher-base":491,"dup":312,"evp_bytestokey":493,"inherits":500}],480:[function(require,module,exports){
arguments[4][313][0].apply(exports,arguments)
},{"./aes":476,"./authCipher":477,"./modes":482,"./modes/cbc":483,"./modes/cfb":484,"./modes/cfb1":485,"./modes/cfb8":486,"./modes/ctr":487,"./modes/ecb":488,"./modes/ofb":489,"./streamCipher":492,"buffer":303,"cipher-base":491,"dup":313,"evp_bytestokey":493,"inherits":500}],481:[function(require,module,exports){
arguments[4][314][0].apply(exports,arguments)
},{"buffer":303,"dup":314}],482:[function(require,module,exports){
arguments[4][315][0].apply(exports,arguments)
},{"dup":315}],483:[function(require,module,exports){
arguments[4][316][0].apply(exports,arguments)
},{"buffer-xor":490,"dup":316}],484:[function(require,module,exports){
arguments[4][317][0].apply(exports,arguments)
},{"buffer":303,"buffer-xor":490,"dup":317}],485:[function(require,module,exports){
arguments[4][318][0].apply(exports,arguments)
},{"buffer":303,"dup":318}],486:[function(require,module,exports){
arguments[4][319][0].apply(exports,arguments)
},{"buffer":303,"dup":319}],487:[function(require,module,exports){
arguments[4][320][0].apply(exports,arguments)
},{"buffer":303,"buffer-xor":490,"dup":320}],488:[function(require,module,exports){
arguments[4][321][0].apply(exports,arguments)
},{"dup":321}],489:[function(require,module,exports){
arguments[4][322][0].apply(exports,arguments)
},{"buffer":303,"buffer-xor":490,"dup":322}],490:[function(require,module,exports){
arguments[4][323][0].apply(exports,arguments)
},{"buffer":303,"dup":323}],491:[function(require,module,exports){
arguments[4][324][0].apply(exports,arguments)
},{"buffer":303,"dup":324,"inherits":500,"stream":521,"string_decoder":522}],492:[function(require,module,exports){
arguments[4][325][0].apply(exports,arguments)
},{"./aes":476,"buffer":303,"cipher-base":491,"dup":325,"inherits":500}],493:[function(require,module,exports){
arguments[4][336][0].apply(exports,arguments)
},{"buffer":303,"create-hash/md5":433,"dup":336}],494:[function(require,module,exports){
(function (Buffer){
var parseKeys = require('parse-asn1');
var mgf = require('./mgf');
var xor = require('./xor');
var bn = require('bn.js');
var crt = require('browserify-rsa');
var createHash = require('create-hash');
var withPublic = require('./withPublic');
module.exports = function privateDecrypt(private_key, enc, reverse) {
  var padding;
  if (private_key.padding) {
    padding = private_key.padding;
  } else if (reverse) {
    padding = 1;
  } else {
    padding = 4;
  }
  
  var key = parseKeys(private_key);
  var k = key.modulus.byteLength();
  if (enc.length > k || new bn(enc).cmp(key.modulus) >= 0) {
    throw new Error('decryption error');
  }
  var msg;
  if (reverse) {
    msg = withPublic(new bn(enc), key);
  } else {
    msg = crt(enc, key);
  }
  var zBuffer = new Buffer(k - msg.length);
  zBuffer.fill(0);
  msg = Buffer.concat([zBuffer, msg], k);
  if (padding === 4) {
    return oaep(key, msg);
  } else if (padding === 1) {
    return pkcs1(key, msg, reverse);
  } else if (padding === 3) {
    return msg;
  } else {
    throw new Error('unknown padding');
  }
};

function oaep(key, msg){
  var n = key.modulus;
  var k = key.modulus.byteLength();
  var mLen = msg.length;
  var iHash = createHash('sha1').update(new Buffer('')).digest();
  var hLen = iHash.length;
  var hLen2 = 2 * hLen;
  if (msg[0] !== 0) {
    throw new Error('decryption error');
  }
  var maskedSeed = msg.slice(1, hLen + 1);
  var maskedDb =  msg.slice(hLen + 1);
  var seed = xor(maskedSeed, mgf(maskedDb, hLen));
  var db = xor(maskedDb, mgf(seed, k - hLen - 1));
  if (compare(iHash, db.slice(0, hLen))) {
    throw new Error('decryption error');
  }
  var i = hLen;
  while (db[i] === 0) {
    i++;
  }
  if (db[i++] !== 1) {
    throw new Error('decryption error');
  }
  return db.slice(i);
}

function pkcs1(key, msg, reverse){
  var p1 = msg.slice(0, 2);
  var i = 2;
  var status = 0;
  while (msg[i++] !== 0) {
    if (i >= msg.length) {
      status++;
      break;
    }
  }
  var ps = msg.slice(2, i - 1);
  var p2 = msg.slice(i - 1, i);

  if ((p1.toString('hex') !== '0002' && !reverse) || (p1.toString('hex') !== '0001' && reverse)){
    status++;
  }
  if (ps.length < 8) {
    status++;
  }
  if (status) {
    throw new Error('decryption error');
  }
  return  msg.slice(i);
}
function compare(a, b){
  a = new Buffer(a);
  b = new Buffer(b);
  var dif = 0;
  var len = a.length;
  if (a.length !== b.length) {
    dif++;
    len = Math.min(a.length, b.length);
  }
  var i = -1;
  while (++i < len) {
    dif += (a[i] ^ b[i]);
  }
  return dif;
}
}).call(this,require("buffer").Buffer)
},{"./mgf":454,"./withPublic":496,"./xor":497,"bn.js":455,"browserify-rsa":456,"buffer":303,"create-hash":431,"parse-asn1":460}],495:[function(require,module,exports){
(function (Buffer){
var parseKeys = require('parse-asn1');
var randomBytes = require('randombytes');
var createHash = require('create-hash');
var mgf = require('./mgf');
var xor = require('./xor');
var bn = require('bn.js');
var withPublic = require('./withPublic');
var crt = require('browserify-rsa');

var constants = {
  RSA_PKCS1_OAEP_PADDING: 4,
  RSA_PKCS1_PADDIN: 1,
  RSA_NO_PADDING: 3
};

module.exports = function publicEncrypt(public_key, msg, reverse) {
  var padding;
  if (public_key.padding) {
    padding = public_key.padding;
  } else if (reverse) {
    padding = 1;
  } else {
    padding = 4;
  }
  var key = parseKeys(public_key);
  var paddedMsg;
  if (padding === 4) {
    paddedMsg = oaep(key, msg);
  } else if (padding === 1) {
    paddedMsg = pkcs1(key, msg, reverse);
  } else if (padding === 3) {
    paddedMsg = new bn(msg);
    if (paddedMsg.cmp(key.modulus) >= 0) {
      throw new Error('data too long for modulus');
    }
  } else {
    throw new Error('unknown padding');
  }
  if (reverse) {
    return crt(paddedMsg, key);
  } else {
    return withPublic(paddedMsg, key);
  }
};

function oaep(key, msg){
  var k = key.modulus.byteLength();
  var mLen = msg.length;
  var iHash = createHash('sha1').update(new Buffer('')).digest();
  var hLen = iHash.length;
  var hLen2 = 2 * hLen;
  if (mLen > k - hLen2 - 2) {
    throw new Error('message too long');
  }
  var ps = new Buffer(k - mLen - hLen2 - 2);
  ps.fill(0);
  var dblen = k - hLen - 1;
  var seed = randomBytes(hLen);
  var maskedDb = xor(Buffer.concat([iHash, ps, new Buffer([1]), msg], dblen), mgf(seed, dblen));
  var maskedSeed = xor(seed, mgf(maskedDb, hLen));
  return new bn(Buffer.concat([new Buffer([0]), maskedSeed, maskedDb], k));
}
function pkcs1(key, msg, reverse){
  var mLen = msg.length;
  var k = key.modulus.byteLength();
  if (mLen > k - 11) {
    throw new Error('message too long');
  }
  var ps;
  if (reverse) {
    ps = new Buffer(k - mLen - 3);
    ps.fill(0xff);
  } else {
    ps = nonZero(k - mLen - 3);
  }
  return new bn(Buffer.concat([new Buffer([0, reverse?1:2]), ps, new Buffer([0]), msg], k));
}
function nonZero(len, crypto) {
  var out = new Buffer(len);
  var i = 0;
  var cache = randomBytes(len*2);
  var cur = 0;
  var num;
  while (i < len) {
    if (cur === cache.length) {
      cache = randomBytes(len*2);
      cur = 0;
    }
    num = cache[cur++];
    if (num) {
      out[i++] = num;
    }
  }
  return out;
}
}).call(this,require("buffer").Buffer)
},{"./mgf":454,"./withPublic":496,"./xor":497,"bn.js":455,"browserify-rsa":456,"buffer":303,"create-hash":431,"parse-asn1":460,"randombytes":498}],496:[function(require,module,exports){
(function (Buffer){
var bn = require('bn.js');
function withPublic(paddedMsg, key) {
  return new Buffer(paddedMsg
    .toRed(bn.mont(key.modulus))
    .redPow(new bn(key.publicExponent))
    .fromRed()
    .toArray());
}

module.exports = withPublic;
}).call(this,require("buffer").Buffer)
},{"bn.js":455,"buffer":303}],497:[function(require,module,exports){
module.exports = function xor(a, b) {
  var len = a.length;
  var i = -1;
  while (++i < len) {
    a[i] ^= b[i];
  }
  return a
};
},{}],498:[function(require,module,exports){
(function (process,global,Buffer){
'use strict'

function oldBrowser () {
  throw new Error('secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11')
}

var crypto = global.crypto || global.msCrypto

if (crypto && crypto.getRandomValues) {
  module.exports = randomBytes
} else {
  module.exports = oldBrowser
}

function randomBytes (size, cb) {
  // phantomjs needs to throw
  if (size > 65536) throw new Error('requested too many random bytes')
  // in case browserify  isn't using the Uint8Array version
  var rawBytes = new global.Uint8Array(size)

  // This will not work in older browsers.
  // See https://developer.mozilla.org/en-US/docs/Web/API/window.crypto.getRandomValues
  crypto.getRandomValues(rawBytes)

  // phantomjs doesn't like a buffer being passed here
  var bytes = new Buffer(rawBytes.buffer)

  if (typeof cb === 'function') {
    return process.nextTick(function () {
      cb(null, bytes)
    })
  }

  return bytes
}

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"_process":503,"buffer":303}],499:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

function EventEmitter() {
  this._events = this._events || {};
  this._maxListeners = this._maxListeners || undefined;
}
module.exports = EventEmitter;

// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter = EventEmitter;

EventEmitter.prototype._events = undefined;
EventEmitter.prototype._maxListeners = undefined;

// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
EventEmitter.defaultMaxListeners = 10;

// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners = function(n) {
  if (!isNumber(n) || n < 0 || isNaN(n))
    throw TypeError('n must be a positive number');
  this._maxListeners = n;
  return this;
};

EventEmitter.prototype.emit = function(type) {
  var er, handler, len, args, i, listeners;

  if (!this._events)
    this._events = {};

  // If there is no 'error' event listener then throw.
  if (type === 'error') {
    if (!this._events.error ||
        (isObject(this._events.error) && !this._events.error.length)) {
      er = arguments[1];
      if (er instanceof Error) {
        throw er; // Unhandled 'error' event
      }
      throw TypeError('Uncaught, unspecified "error" event.');
    }
  }

  handler = this._events[type];

  if (isUndefined(handler))
    return false;

  if (isFunction(handler)) {
    switch (arguments.length) {
      // fast cases
      case 1:
        handler.call(this);
        break;
      case 2:
        handler.call(this, arguments[1]);
        break;
      case 3:
        handler.call(this, arguments[1], arguments[2]);
        break;
      // slower
      default:
        len = arguments.length;
        args = new Array(len - 1);
        for (i = 1; i < len; i++)
          args[i - 1] = arguments[i];
        handler.apply(this, args);
    }
  } else if (isObject(handler)) {
    len = arguments.length;
    args = new Array(len - 1);
    for (i = 1; i < len; i++)
      args[i - 1] = arguments[i];

    listeners = handler.slice();
    len = listeners.length;
    for (i = 0; i < len; i++)
      listeners[i].apply(this, args);
  }

  return true;
};

EventEmitter.prototype.addListener = function(type, listener) {
  var m;

  if (!isFunction(listener))
    throw TypeError('listener must be a function');

  if (!this._events)
    this._events = {};

  // To avoid recursion in the case that type === "newListener"! Before
  // adding it to the listeners, first emit "newListener".
  if (this._events.newListener)
    this.emit('newListener', type,
              isFunction(listener.listener) ?
              listener.listener : listener);

  if (!this._events[type])
    // Optimize the case of one listener. Don't need the extra array object.
    this._events[type] = listener;
  else if (isObject(this._events[type]))
    // If we've already got an array, just append.
    this._events[type].push(listener);
  else
    // Adding the second element, need to change to array.
    this._events[type] = [this._events[type], listener];

  // Check for listener leak
  if (isObject(this._events[type]) && !this._events[type].warned) {
    var m;
    if (!isUndefined(this._maxListeners)) {
      m = this._maxListeners;
    } else {
      m = EventEmitter.defaultMaxListeners;
    }

    if (m && m > 0 && this._events[type].length > m) {
      this._events[type].warned = true;
      console.error('(node) warning: possible EventEmitter memory ' +
                    'leak detected. %d listeners added. ' +
                    'Use emitter.setMaxListeners() to increase limit.',
                    this._events[type].length);
      if (typeof console.trace === 'function') {
        // not supported in IE 10
        console.trace();
      }
    }
  }

  return this;
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.once = function(type, listener) {
  if (!isFunction(listener))
    throw TypeError('listener must be a function');

  var fired = false;

  function g() {
    this.removeListener(type, g);

    if (!fired) {
      fired = true;
      listener.apply(this, arguments);
    }
  }

  g.listener = listener;
  this.on(type, g);

  return this;
};

// emits a 'removeListener' event iff the listener was removed
EventEmitter.prototype.removeListener = function(type, listener) {
  var list, position, length, i;

  if (!isFunction(listener))
    throw TypeError('listener must be a function');

  if (!this._events || !this._events[type])
    return this;

  list = this._events[type];
  length = list.length;
  position = -1;

  if (list === listener ||
      (isFunction(list.listener) && list.listener === listener)) {
    delete this._events[type];
    if (this._events.removeListener)
      this.emit('removeListener', type, listener);

  } else if (isObject(list)) {
    for (i = length; i-- > 0;) {
      if (list[i] === listener ||
          (list[i].listener && list[i].listener === listener)) {
        position = i;
        break;
      }
    }

    if (position < 0)
      return this;

    if (list.length === 1) {
      list.length = 0;
      delete this._events[type];
    } else {
      list.splice(position, 1);
    }

    if (this._events.removeListener)
      this.emit('removeListener', type, listener);
  }

  return this;
};

EventEmitter.prototype.removeAllListeners = function(type) {
  var key, listeners;

  if (!this._events)
    return this;

  // not listening for removeListener, no need to emit
  if (!this._events.removeListener) {
    if (arguments.length === 0)
      this._events = {};
    else if (this._events[type])
      delete this._events[type];
    return this;
  }

  // emit removeListener for all listeners on all events
  if (arguments.length === 0) {
    for (key in this._events) {
      if (key === 'removeListener') continue;
      this.removeAllListeners(key);
    }
    this.removeAllListeners('removeListener');
    this._events = {};
    return this;
  }

  listeners = this._events[type];

  if (isFunction(listeners)) {
    this.removeListener(type, listeners);
  } else {
    // LIFO order
    while (listeners.length)
      this.removeListener(type, listeners[listeners.length - 1]);
  }
  delete this._events[type];

  return this;
};

EventEmitter.prototype.listeners = function(type) {
  var ret;
  if (!this._events || !this._events[type])
    ret = [];
  else if (isFunction(this._events[type]))
    ret = [this._events[type]];
  else
    ret = this._events[type].slice();
  return ret;
};

EventEmitter.listenerCount = function(emitter, type) {
  var ret;
  if (!emitter._events || !emitter._events[type])
    ret = 0;
  else if (isFunction(emitter._events[type]))
    ret = 1;
  else
    ret = emitter._events[type].length;
  return ret;
};

function isFunction(arg) {
  return typeof arg === 'function';
}

function isNumber(arg) {
  return typeof arg === 'number';
}

function isObject(arg) {
  return typeof arg === 'object' && arg !== null;
}

function isUndefined(arg) {
  return arg === void 0;
}

},{}],500:[function(require,module,exports){
if (typeof Object.create === 'function') {
  // implementation from standard node.js 'util' module
  module.exports = function inherits(ctor, superCtor) {
    ctor.super_ = superCtor
    ctor.prototype = Object.create(superCtor.prototype, {
      constructor: {
        value: ctor,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
  };
} else {
  // old school shim for old browsers
  module.exports = function inherits(ctor, superCtor) {
    ctor.super_ = superCtor
    var TempCtor = function () {}
    TempCtor.prototype = superCtor.prototype
    ctor.prototype = new TempCtor()
    ctor.prototype.constructor = ctor
  }
}

},{}],501:[function(require,module,exports){
/**
 * Determine if an object is Buffer
 *
 * Author:   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * License:  MIT
 *
 * `npm install is-buffer`
 */

module.exports = function (obj) {
  return !!(obj != null &&
    (obj._isBuffer || // For Safari 5-7 (missing Object.prototype.constructor)
      (obj.constructor &&
      typeof obj.constructor.isBuffer === 'function' &&
      obj.constructor.isBuffer(obj))
    ))
}

},{}],502:[function(require,module,exports){
module.exports = Array.isArray || function (arr) {
  return Object.prototype.toString.call(arr) == '[object Array]';
};

},{}],503:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = setTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    clearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        setTimeout(drainQueue, 0);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],504:[function(require,module,exports){
(function (global){
/*! https://mths.be/punycode v1.4.0 by @mathias */
;(function(root) {

	/** Detect free variables */
	var freeExports = typeof exports == 'object' && exports &&
		!exports.nodeType && exports;
	var freeModule = typeof module == 'object' && module &&
		!module.nodeType && module;
	var freeGlobal = typeof global == 'object' && global;
	if (
		freeGlobal.global === freeGlobal ||
		freeGlobal.window === freeGlobal ||
		freeGlobal.self === freeGlobal
	) {
		root = freeGlobal;
	}

	/**
	 * The `punycode` object.
	 * @name punycode
	 * @type Object
	 */
	var punycode,

	/** Highest positive signed 32-bit float value */
	maxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1

	/** Bootstring parameters */
	base = 36,
	tMin = 1,
	tMax = 26,
	skew = 38,
	damp = 700,
	initialBias = 72,
	initialN = 128, // 0x80
	delimiter = '-', // '\x2D'

	/** Regular expressions */
	regexPunycode = /^xn--/,
	regexNonASCII = /[^\x20-\x7E]/, // unprintable ASCII chars + non-ASCII chars
	regexSeparators = /[\x2E\u3002\uFF0E\uFF61]/g, // RFC 3490 separators

	/** Error messages */
	errors = {
		'overflow': 'Overflow: input needs wider integers to process',
		'not-basic': 'Illegal input >= 0x80 (not a basic code point)',
		'invalid-input': 'Invalid input'
	},

	/** Convenience shortcuts */
	baseMinusTMin = base - tMin,
	floor = Math.floor,
	stringFromCharCode = String.fromCharCode,

	/** Temporary variable */
	key;

	/*--------------------------------------------------------------------------*/

	/**
	 * A generic error utility function.
	 * @private
	 * @param {String} type The error type.
	 * @returns {Error} Throws a `RangeError` with the applicable error message.
	 */
	function error(type) {
		throw new RangeError(errors[type]);
	}

	/**
	 * A generic `Array#map` utility function.
	 * @private
	 * @param {Array} array The array to iterate over.
	 * @param {Function} callback The function that gets called for every array
	 * item.
	 * @returns {Array} A new array of values returned by the callback function.
	 */
	function map(array, fn) {
		var length = array.length;
		var result = [];
		while (length--) {
			result[length] = fn(array[length]);
		}
		return result;
	}

	/**
	 * A simple `Array#map`-like wrapper to work with domain name strings or email
	 * addresses.
	 * @private
	 * @param {String} domain The domain name or email address.
	 * @param {Function} callback The function that gets called for every
	 * character.
	 * @returns {Array} A new string of characters returned by the callback
	 * function.
	 */
	function mapDomain(string, fn) {
		var parts = string.split('@');
		var result = '';
		if (parts.length > 1) {
			// In email addresses, only the domain name should be punycoded. Leave
			// the local part (i.e. everything up to `@`) intact.
			result = parts[0] + '@';
			string = parts[1];
		}
		// Avoid `split(regex)` for IE8 compatibility. See #17.
		string = string.replace(regexSeparators, '\x2E');
		var labels = string.split('.');
		var encoded = map(labels, fn).join('.');
		return result + encoded;
	}

	/**
	 * Creates an array containing the numeric code points of each Unicode
	 * character in the string. While JavaScript uses UCS-2 internally,
	 * this function will convert a pair of surrogate halves (each of which
	 * UCS-2 exposes as separate characters) into a single code point,
	 * matching UTF-16.
	 * @see `punycode.ucs2.encode`
	 * @see <https://mathiasbynens.be/notes/javascript-encoding>
	 * @memberOf punycode.ucs2
	 * @name decode
	 * @param {String} string The Unicode input string (UCS-2).
	 * @returns {Array} The new array of code points.
	 */
	function ucs2decode(string) {
		var output = [],
		    counter = 0,
		    length = string.length,
		    value,
		    extra;
		while (counter < length) {
			value = string.charCodeAt(counter++);
			if (value >= 0xD800 && value <= 0xDBFF && counter < length) {
				// high surrogate, and there is a next character
				extra = string.charCodeAt(counter++);
				if ((extra & 0xFC00) == 0xDC00) { // low surrogate
					output.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);
				} else {
					// unmatched surrogate; only append this code unit, in case the next
					// code unit is the high surrogate of a surrogate pair
					output.push(value);
					counter--;
				}
			} else {
				output.push(value);
			}
		}
		return output;
	}

	/**
	 * Creates a string based on an array of numeric code points.
	 * @see `punycode.ucs2.decode`
	 * @memberOf punycode.ucs2
	 * @name encode
	 * @param {Array} codePoints The array of numeric code points.
	 * @returns {String} The new Unicode string (UCS-2).
	 */
	function ucs2encode(array) {
		return map(array, function(value) {
			var output = '';
			if (value > 0xFFFF) {
				value -= 0x10000;
				output += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);
				value = 0xDC00 | value & 0x3FF;
			}
			output += stringFromCharCode(value);
			return output;
		}).join('');
	}

	/**
	 * Converts a basic code point into a digit/integer.
	 * @see `digitToBasic()`
	 * @private
	 * @param {Number} codePoint The basic numeric code point value.
	 * @returns {Number} The numeric value of a basic code point (for use in
	 * representing integers) in the range `0` to `base - 1`, or `base` if
	 * the code point does not represent a value.
	 */
	function basicToDigit(codePoint) {
		if (codePoint - 48 < 10) {
			return codePoint - 22;
		}
		if (codePoint - 65 < 26) {
			return codePoint - 65;
		}
		if (codePoint - 97 < 26) {
			return codePoint - 97;
		}
		return base;
	}

	/**
	 * Converts a digit/integer into a basic code point.
	 * @see `basicToDigit()`
	 * @private
	 * @param {Number} digit The numeric value of a basic code point.
	 * @returns {Number} The basic code point whose value (when used for
	 * representing integers) is `digit`, which needs to be in the range
	 * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is
	 * used; else, the lowercase form is used. The behavior is undefined
	 * if `flag` is non-zero and `digit` has no uppercase form.
	 */
	function digitToBasic(digit, flag) {
		//  0..25 map to ASCII a..z or A..Z
		// 26..35 map to ASCII 0..9
		return digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);
	}

	/**
	 * Bias adaptation function as per section 3.4 of RFC 3492.
	 * https://tools.ietf.org/html/rfc3492#section-3.4
	 * @private
	 */
	function adapt(delta, numPoints, firstTime) {
		var k = 0;
		delta = firstTime ? floor(delta / damp) : delta >> 1;
		delta += floor(delta / numPoints);
		for (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {
			delta = floor(delta / baseMinusTMin);
		}
		return floor(k + (baseMinusTMin + 1) * delta / (delta + skew));
	}

	/**
	 * Converts a Punycode string of ASCII-only symbols to a string of Unicode
	 * symbols.
	 * @memberOf punycode
	 * @param {String} input The Punycode string of ASCII-only symbols.
	 * @returns {String} The resulting string of Unicode symbols.
	 */
	function decode(input) {
		// Don't use UCS-2
		var output = [],
		    inputLength = input.length,
		    out,
		    i = 0,
		    n = initialN,
		    bias = initialBias,
		    basic,
		    j,
		    index,
		    oldi,
		    w,
		    k,
		    digit,
		    t,
		    /** Cached calculation results */
		    baseMinusT;

		// Handle the basic code points: let `basic` be the number of input code
		// points before the last delimiter, or `0` if there is none, then copy
		// the first basic code points to the output.

		basic = input.lastIndexOf(delimiter);
		if (basic < 0) {
			basic = 0;
		}

		for (j = 0; j < basic; ++j) {
			// if it's not a basic code point
			if (input.charCodeAt(j) >= 0x80) {
				error('not-basic');
			}
			output.push(input.charCodeAt(j));
		}

		// Main decoding loop: start just after the last delimiter if any basic code
		// points were copied; start at the beginning otherwise.

		for (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {

			// `index` is the index of the next character to be consumed.
			// Decode a generalized variable-length integer into `delta`,
			// which gets added to `i`. The overflow checking is easier
			// if we increase `i` as we go, then subtract off its starting
			// value at the end to obtain `delta`.
			for (oldi = i, w = 1, k = base; /* no condition */; k += base) {

				if (index >= inputLength) {
					error('invalid-input');
				}

				digit = basicToDigit(input.charCodeAt(index++));

				if (digit >= base || digit > floor((maxInt - i) / w)) {
					error('overflow');
				}

				i += digit * w;
				t = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);

				if (digit < t) {
					break;
				}

				baseMinusT = base - t;
				if (w > floor(maxInt / baseMinusT)) {
					error('overflow');
				}

				w *= baseMinusT;

			}

			out = output.length + 1;
			bias = adapt(i - oldi, out, oldi == 0);

			// `i` was supposed to wrap around from `out` to `0`,
			// incrementing `n` each time, so we'll fix that now:
			if (floor(i / out) > maxInt - n) {
				error('overflow');
			}

			n += floor(i / out);
			i %= out;

			// Insert `n` at position `i` of the output
			output.splice(i++, 0, n);

		}

		return ucs2encode(output);
	}

	/**
	 * Converts a string of Unicode symbols (e.g. a domain name label) to a
	 * Punycode string of ASCII-only symbols.
	 * @memberOf punycode
	 * @param {String} input The string of Unicode symbols.
	 * @returns {String} The resulting Punycode string of ASCII-only symbols.
	 */
	function encode(input) {
		var n,
		    delta,
		    handledCPCount,
		    basicLength,
		    bias,
		    j,
		    m,
		    q,
		    k,
		    t,
		    currentValue,
		    output = [],
		    /** `inputLength` will hold the number of code points in `input`. */
		    inputLength,
		    /** Cached calculation results */
		    handledCPCountPlusOne,
		    baseMinusT,
		    qMinusT;

		// Convert the input in UCS-2 to Unicode
		input = ucs2decode(input);

		// Cache the length
		inputLength = input.length;

		// Initialize the state
		n = initialN;
		delta = 0;
		bias = initialBias;

		// Handle the basic code points
		for (j = 0; j < inputLength; ++j) {
			currentValue = input[j];
			if (currentValue < 0x80) {
				output.push(stringFromCharCode(currentValue));
			}
		}

		handledCPCount = basicLength = output.length;

		// `handledCPCount` is the number of code points that have been handled;
		// `basicLength` is the number of basic code points.

		// Finish the basic string - if it is not empty - with a delimiter
		if (basicLength) {
			output.push(delimiter);
		}

		// Main encoding loop:
		while (handledCPCount < inputLength) {

			// All non-basic code points < n have been handled already. Find the next
			// larger one:
			for (m = maxInt, j = 0; j < inputLength; ++j) {
				currentValue = input[j];
				if (currentValue >= n && currentValue < m) {
					m = currentValue;
				}
			}

			// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,
			// but guard against overflow
			handledCPCountPlusOne = handledCPCount + 1;
			if (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {
				error('overflow');
			}

			delta += (m - n) * handledCPCountPlusOne;
			n = m;

			for (j = 0; j < inputLength; ++j) {
				currentValue = input[j];

				if (currentValue < n && ++delta > maxInt) {
					error('overflow');
				}

				if (currentValue == n) {
					// Represent delta as a generalized variable-length integer
					for (q = delta, k = base; /* no condition */; k += base) {
						t = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);
						if (q < t) {
							break;
						}
						qMinusT = q - t;
						baseMinusT = base - t;
						output.push(
							stringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))
						);
						q = floor(qMinusT / baseMinusT);
					}

					output.push(stringFromCharCode(digitToBasic(q, 0)));
					bias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);
					delta = 0;
					++handledCPCount;
				}
			}

			++delta;
			++n;

		}
		return output.join('');
	}

	/**
	 * Converts a Punycode string representing a domain name or an email address
	 * to Unicode. Only the Punycoded parts of the input will be converted, i.e.
	 * it doesn't matter if you call it on a string that has already been
	 * converted to Unicode.
	 * @memberOf punycode
	 * @param {String} input The Punycoded domain name or email address to
	 * convert to Unicode.
	 * @returns {String} The Unicode representation of the given Punycode
	 * string.
	 */
	function toUnicode(input) {
		return mapDomain(input, function(string) {
			return regexPunycode.test(string)
				? decode(string.slice(4).toLowerCase())
				: string;
		});
	}

	/**
	 * Converts a Unicode string representing a domain name or an email address to
	 * Punycode. Only the non-ASCII parts of the domain name will be converted,
	 * i.e. it doesn't matter if you call it with a domain that's already in
	 * ASCII.
	 * @memberOf punycode
	 * @param {String} input The domain name or email address to convert, as a
	 * Unicode string.
	 * @returns {String} The Punycode representation of the given domain name or
	 * email address.
	 */
	function toASCII(input) {
		return mapDomain(input, function(string) {
			return regexNonASCII.test(string)
				? 'xn--' + encode(string)
				: string;
		});
	}

	/*--------------------------------------------------------------------------*/

	/** Define the public API */
	punycode = {
		/**
		 * A string representing the current Punycode.js version number.
		 * @memberOf punycode
		 * @type String
		 */
		'version': '1.3.2',
		/**
		 * An object of methods to convert from JavaScript's internal character
		 * representation (UCS-2) to Unicode code points, and back.
		 * @see <https://mathiasbynens.be/notes/javascript-encoding>
		 * @memberOf punycode
		 * @type Object
		 */
		'ucs2': {
			'decode': ucs2decode,
			'encode': ucs2encode
		},
		'decode': decode,
		'encode': encode,
		'toASCII': toASCII,
		'toUnicode': toUnicode
	};

	/** Expose `punycode` */
	// Some AMD build optimizers, like r.js, check for specific condition patterns
	// like the following:
	if (
		typeof define == 'function' &&
		typeof define.amd == 'object' &&
		define.amd
	) {
		define('punycode', function() {
			return punycode;
		});
	} else if (freeExports && freeModule) {
		if (module.exports == freeExports) {
			// in Node.js, io.js, or RingoJS v0.8.0+
			freeModule.exports = punycode;
		} else {
			// in Narwhal or RingoJS v0.7.0-
			for (key in punycode) {
				punycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);
			}
		}
	} else {
		// in Rhino or a web browser
		root.punycode = punycode;
	}

}(this));

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],505:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

'use strict';

// If obj.hasOwnProperty has been overridden, then calling
// obj.hasOwnProperty(prop) will break.
// See: https://github.com/joyent/node/issues/1707
function hasOwnProperty(obj, prop) {
  return Object.prototype.hasOwnProperty.call(obj, prop);
}

module.exports = function(qs, sep, eq, options) {
  sep = sep || '&';
  eq = eq || '=';
  var obj = {};

  if (typeof qs !== 'string' || qs.length === 0) {
    return obj;
  }

  var regexp = /\+/g;
  qs = qs.split(sep);

  var maxKeys = 1000;
  if (options && typeof options.maxKeys === 'number') {
    maxKeys = options.maxKeys;
  }

  var len = qs.length;
  // maxKeys <= 0 means that we should not limit keys count
  if (maxKeys > 0 && len > maxKeys) {
    len = maxKeys;
  }

  for (var i = 0; i < len; ++i) {
    var x = qs[i].replace(regexp, '%20'),
        idx = x.indexOf(eq),
        kstr, vstr, k, v;

    if (idx >= 0) {
      kstr = x.substr(0, idx);
      vstr = x.substr(idx + 1);
    } else {
      kstr = x;
      vstr = '';
    }

    k = decodeURIComponent(kstr);
    v = decodeURIComponent(vstr);

    if (!hasOwnProperty(obj, k)) {
      obj[k] = v;
    } else if (isArray(obj[k])) {
      obj[k].push(v);
    } else {
      obj[k] = [obj[k], v];
    }
  }

  return obj;
};

var isArray = Array.isArray || function (xs) {
  return Object.prototype.toString.call(xs) === '[object Array]';
};

},{}],506:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

'use strict';

var stringifyPrimitive = function(v) {
  switch (typeof v) {
    case 'string':
      return v;

    case 'boolean':
      return v ? 'true' : 'false';

    case 'number':
      return isFinite(v) ? v : '';

    default:
      return '';
  }
};

module.exports = function(obj, sep, eq, name) {
  sep = sep || '&';
  eq = eq || '=';
  if (obj === null) {
    obj = undefined;
  }

  if (typeof obj === 'object') {
    return map(objectKeys(obj), function(k) {
      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;
      if (isArray(obj[k])) {
        return map(obj[k], function(v) {
          return ks + encodeURIComponent(stringifyPrimitive(v));
        }).join(sep);
      } else {
        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));
      }
    }).join(sep);

  }

  if (!name) return '';
  return encodeURIComponent(stringifyPrimitive(name)) + eq +
         encodeURIComponent(stringifyPrimitive(obj));
};

var isArray = Array.isArray || function (xs) {
  return Object.prototype.toString.call(xs) === '[object Array]';
};

function map (xs, f) {
  if (xs.map) return xs.map(f);
  var res = [];
  for (var i = 0; i < xs.length; i++) {
    res.push(f(xs[i], i));
  }
  return res;
}

var objectKeys = Object.keys || function (obj) {
  var res = [];
  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);
  }
  return res;
};

},{}],507:[function(require,module,exports){
'use strict';

exports.decode = exports.parse = require('./decode');
exports.encode = exports.stringify = require('./encode');

},{"./decode":505,"./encode":506}],508:[function(require,module,exports){
module.exports = require("./lib/_stream_duplex.js")

},{"./lib/_stream_duplex.js":509}],509:[function(require,module,exports){
// a duplex stream is just a stream that is both readable and writable.
// Since JS doesn't have multiple prototypal inheritance, this class
// prototypally inherits from Readable, and then parasitically from
// Writable.

'use strict';

/*<replacement>*/
var objectKeys = Object.keys || function (obj) {
  var keys = [];
  for (var key in obj) keys.push(key);
  return keys;
}
/*</replacement>*/


module.exports = Duplex;

/*<replacement>*/
var processNextTick = require('process-nextick-args');
/*</replacement>*/



/*<replacement>*/
var util = require('core-util-is');
util.inherits = require('inherits');
/*</replacement>*/

var Readable = require('./_stream_readable');
var Writable = require('./_stream_writable');

util.inherits(Duplex, Readable);

var keys = objectKeys(Writable.prototype);
for (var v = 0; v < keys.length; v++) {
  var method = keys[v];
  if (!Duplex.prototype[method])
    Duplex.prototype[method] = Writable.prototype[method];
}

function Duplex(options) {
  if (!(this instanceof Duplex))
    return new Duplex(options);

  Readable.call(this, options);
  Writable.call(this, options);

  if (options && options.readable === false)
    this.readable = false;

  if (options && options.writable === false)
    this.writable = false;

  this.allowHalfOpen = true;
  if (options && options.allowHalfOpen === false)
    this.allowHalfOpen = false;

  this.once('end', onend);
}

// the no-half-open enforcer
function onend() {
  // if we allow half-open state, or if the writable side ended,
  // then we're ok.
  if (this.allowHalfOpen || this._writableState.ended)
    return;

  // no more data can be written.
  // But allow more writes to happen in this tick.
  processNextTick(onEndNT, this);
}

function onEndNT(self) {
  self.end();
}

function forEach (xs, f) {
  for (var i = 0, l = xs.length; i < l; i++) {
    f(xs[i], i);
  }
}

},{"./_stream_readable":511,"./_stream_writable":513,"core-util-is":514,"inherits":500,"process-nextick-args":515}],510:[function(require,module,exports){
// a passthrough stream.
// basically just the most minimal sort of Transform stream.
// Every written chunk gets output as-is.

'use strict';

module.exports = PassThrough;

var Transform = require('./_stream_transform');

/*<replacement>*/
var util = require('core-util-is');
util.inherits = require('inherits');
/*</replacement>*/

util.inherits(PassThrough, Transform);

function PassThrough(options) {
  if (!(this instanceof PassThrough))
    return new PassThrough(options);

  Transform.call(this, options);
}

PassThrough.prototype._transform = function(chunk, encoding, cb) {
  cb(null, chunk);
};

},{"./_stream_transform":512,"core-util-is":514,"inherits":500}],511:[function(require,module,exports){
(function (process){
'use strict';

module.exports = Readable;

/*<replacement>*/
var processNextTick = require('process-nextick-args');
/*</replacement>*/


/*<replacement>*/
var isArray = require('isarray');
/*</replacement>*/


/*<replacement>*/
var Buffer = require('buffer').Buffer;
/*</replacement>*/

Readable.ReadableState = ReadableState;

var EE = require('events');

/*<replacement>*/
var EElistenerCount = function(emitter, type) {
  return emitter.listeners(type).length;
};
/*</replacement>*/



/*<replacement>*/
var Stream;
(function (){try{
  Stream = require('st' + 'ream');
}catch(_){}finally{
  if (!Stream)
    Stream = require('events').EventEmitter;
}}())
/*</replacement>*/

var Buffer = require('buffer').Buffer;

/*<replacement>*/
var util = require('core-util-is');
util.inherits = require('inherits');
/*</replacement>*/



/*<replacement>*/
var debugUtil = require('util');
var debug;
if (debugUtil && debugUtil.debuglog) {
  debug = debugUtil.debuglog('stream');
} else {
  debug = function () {};
}
/*</replacement>*/

var StringDecoder;

util.inherits(Readable, Stream);

var Duplex;
function ReadableState(options, stream) {
  Duplex = Duplex || require('./_stream_duplex');

  options = options || {};

  // object stream flag. Used to make read(n) ignore n and to
  // make all the buffer merging and length checks go away
  this.objectMode = !!options.objectMode;

  if (stream instanceof Duplex)
    this.objectMode = this.objectMode || !!options.readableObjectMode;

  // the point at which it stops calling _read() to fill the buffer
  // Note: 0 is a valid value, means "don't call _read preemptively ever"
  var hwm = options.highWaterMark;
  var defaultHwm = this.objectMode ? 16 : 16 * 1024;
  this.highWaterMark = (hwm || hwm === 0) ? hwm : defaultHwm;

  // cast to ints.
  this.highWaterMark = ~~this.highWaterMark;

  this.buffer = [];
  this.length = 0;
  this.pipes = null;
  this.pipesCount = 0;
  this.flowing = null;
  this.ended = false;
  this.endEmitted = false;
  this.reading = false;

  // a flag to be able to tell if the onwrite cb is called immediately,
  // or on a later tick.  We set this to true at first, because any
  // actions that shouldn't happen until "later" should generally also
  // not happen before the first write call.
  this.sync = true;

  // whenever we return null, then we set a flag to say
  // that we're awaiting a 'readable' event emission.
  this.needReadable = false;
  this.emittedReadable = false;
  this.readableListening = false;

  // Crypto is kind of old and crusty.  Historically, its default string
  // encoding is 'binary' so we have to make this configurable.
  // Everything else in the universe uses 'utf8', though.
  this.defaultEncoding = options.defaultEncoding || 'utf8';

  // when piping, we only care about 'readable' events that happen
  // after read()ing all the bytes and not getting any pushback.
  this.ranOut = false;

  // the number of writers that are awaiting a drain event in .pipe()s
  this.awaitDrain = 0;

  // if true, a maybeReadMore has been scheduled
  this.readingMore = false;

  this.decoder = null;
  this.encoding = null;
  if (options.encoding) {
    if (!StringDecoder)
      StringDecoder = require('string_decoder/').StringDecoder;
    this.decoder = new StringDecoder(options.encoding);
    this.encoding = options.encoding;
  }
}

var Duplex;
function Readable(options) {
  Duplex = Duplex || require('./_stream_duplex');

  if (!(this instanceof Readable))
    return new Readable(options);

  this._readableState = new ReadableState(options, this);

  // legacy
  this.readable = true;

  if (options && typeof options.read === 'function')
    this._read = options.read;

  Stream.call(this);
}

// Manually shove something into the read() buffer.
// This returns true if the highWaterMark has not been hit yet,
// similar to how Writable.write() returns true if you should
// write() some more.
Readable.prototype.push = function(chunk, encoding) {
  var state = this._readableState;

  if (!state.objectMode && typeof chunk === 'string') {
    encoding = encoding || state.defaultEncoding;
    if (encoding !== state.encoding) {
      chunk = new Buffer(chunk, encoding);
      encoding = '';
    }
  }

  return readableAddChunk(this, state, chunk, encoding, false);
};

// Unshift should *always* be something directly out of read()
Readable.prototype.unshift = function(chunk) {
  var state = this._readableState;
  return readableAddChunk(this, state, chunk, '', true);
};

Readable.prototype.isPaused = function() {
  return this._readableState.flowing === false;
};

function readableAddChunk(stream, state, chunk, encoding, addToFront) {
  var er = chunkInvalid(state, chunk);
  if (er) {
    stream.emit('error', er);
  } else if (chunk === null) {
    state.reading = false;
    onEofChunk(stream, state);
  } else if (state.objectMode || chunk && chunk.length > 0) {
    if (state.ended && !addToFront) {
      var e = new Error('stream.push() after EOF');
      stream.emit('error', e);
    } else if (state.endEmitted && addToFront) {
      var e = new Error('stream.unshift() after end event');
      stream.emit('error', e);
    } else {
      if (state.decoder && !addToFront && !encoding)
        chunk = state.decoder.write(chunk);

      if (!addToFront)
        state.reading = false;

      // if we want the data now, just emit it.
      if (state.flowing && state.length === 0 && !state.sync) {
        stream.emit('data', chunk);
        stream.read(0);
      } else {
        // update the buffer info.
        state.length += state.objectMode ? 1 : chunk.length;
        if (addToFront)
          state.buffer.unshift(chunk);
        else
          state.buffer.push(chunk);

        if (state.needReadable)
          emitReadable(stream);
      }

      maybeReadMore(stream, state);
    }
  } else if (!addToFront) {
    state.reading = false;
  }

  return needMoreData(state);
}


// if it's past the high water mark, we can push in some more.
// Also, if we have no data yet, we can stand some
// more bytes.  This is to work around cases where hwm=0,
// such as the repl.  Also, if the push() triggered a
// readable event, and the user called read(largeNumber) such that
// needReadable was set, then we ought to push more, so that another
// 'readable' event will be triggered.
function needMoreData(state) {
  return !state.ended &&
         (state.needReadable ||
          state.length < state.highWaterMark ||
          state.length === 0);
}

// backwards compatibility.
Readable.prototype.setEncoding = function(enc) {
  if (!StringDecoder)
    StringDecoder = require('string_decoder/').StringDecoder;
  this._readableState.decoder = new StringDecoder(enc);
  this._readableState.encoding = enc;
  return this;
};

// Don't raise the hwm > 8MB
var MAX_HWM = 0x800000;
function computeNewHighWaterMark(n) {
  if (n >= MAX_HWM) {
    n = MAX_HWM;
  } else {
    // Get the next highest power of 2
    n--;
    n |= n >>> 1;
    n |= n >>> 2;
    n |= n >>> 4;
    n |= n >>> 8;
    n |= n >>> 16;
    n++;
  }
  return n;
}

function howMuchToRead(n, state) {
  if (state.length === 0 && state.ended)
    return 0;

  if (state.objectMode)
    return n === 0 ? 0 : 1;

  if (n === null || isNaN(n)) {
    // only flow one buffer at a time
    if (state.flowing && state.buffer.length)
      return state.buffer[0].length;
    else
      return state.length;
  }

  if (n <= 0)
    return 0;

  // If we're asking for more than the target buffer level,
  // then raise the water mark.  Bump up to the next highest
  // power of 2, to prevent increasing it excessively in tiny
  // amounts.
  if (n > state.highWaterMark)
    state.highWaterMark = computeNewHighWaterMark(n);

  // don't have that much.  return null, unless we've ended.
  if (n > state.length) {
    if (!state.ended) {
      state.needReadable = true;
      return 0;
    } else {
      return state.length;
    }
  }

  return n;
}

// you can override either this method, or the async _read(n) below.
Readable.prototype.read = function(n) {
  debug('read', n);
  var state = this._readableState;
  var nOrig = n;

  if (typeof n !== 'number' || n > 0)
    state.emittedReadable = false;

  // if we're doing read(0) to trigger a readable event, but we
  // already have a bunch of data in the buffer, then just trigger
  // the 'readable' event and move on.
  if (n === 0 &&
      state.needReadable &&
      (state.length >= state.highWaterMark || state.ended)) {
    debug('read: emitReadable', state.length, state.ended);
    if (state.length === 0 && state.ended)
      endReadable(this);
    else
      emitReadable(this);
    return null;
  }

  n = howMuchToRead(n, state);

  // if we've ended, and we're now clear, then finish it up.
  if (n === 0 && state.ended) {
    if (state.length === 0)
      endReadable(this);
    return null;
  }

  // All the actual chunk generation logic needs to be
  // *below* the call to _read.  The reason is that in certain
  // synthetic stream cases, such as passthrough streams, _read
  // may be a completely synchronous operation which may change
  // the state of the read buffer, providing enough data when
  // before there was *not* enough.
  //
  // So, the steps are:
  // 1. Figure out what the state of things will be after we do
  // a read from the buffer.
  //
  // 2. If that resulting state will trigger a _read, then call _read.
  // Note that this may be asynchronous, or synchronous.  Yes, it is
  // deeply ugly to write APIs this way, but that still doesn't mean
  // that the Readable class should behave improperly, as streams are
  // designed to be sync/async agnostic.
  // Take note if the _read call is sync or async (ie, if the read call
  // has returned yet), so that we know whether or not it's safe to emit
  // 'readable' etc.
  //
  // 3. Actually pull the requested chunks out of the buffer and return.

  // if we need a readable event, then we need to do some reading.
  var doRead = state.needReadable;
  debug('need readable', doRead);

  // if we currently have less than the highWaterMark, then also read some
  if (state.length === 0 || state.length - n < state.highWaterMark) {
    doRead = true;
    debug('length less than watermark', doRead);
  }

  // however, if we've ended, then there's no point, and if we're already
  // reading, then it's unnecessary.
  if (state.ended || state.reading) {
    doRead = false;
    debug('reading or ended', doRead);
  }

  if (doRead) {
    debug('do read');
    state.reading = true;
    state.sync = true;
    // if the length is currently zero, then we *need* a readable event.
    if (state.length === 0)
      state.needReadable = true;
    // call internal read method
    this._read(state.highWaterMark);
    state.sync = false;
  }

  // If _read pushed data synchronously, then `reading` will be false,
  // and we need to re-evaluate how much data we can return to the user.
  if (doRead && !state.reading)
    n = howMuchToRead(nOrig, state);

  var ret;
  if (n > 0)
    ret = fromList(n, state);
  else
    ret = null;

  if (ret === null) {
    state.needReadable = true;
    n = 0;
  }

  state.length -= n;

  // If we have nothing in the buffer, then we want to know
  // as soon as we *do* get something into the buffer.
  if (state.length === 0 && !state.ended)
    state.needReadable = true;

  // If we tried to read() past the EOF, then emit end on the next tick.
  if (nOrig !== n && state.ended && state.length === 0)
    endReadable(this);

  if (ret !== null)
    this.emit('data', ret);

  return ret;
};

function chunkInvalid(state, chunk) {
  var er = null;
  if (!(Buffer.isBuffer(chunk)) &&
      typeof chunk !== 'string' &&
      chunk !== null &&
      chunk !== undefined &&
      !state.objectMode) {
    er = new TypeError('Invalid non-string/buffer chunk');
  }
  return er;
}


function onEofChunk(stream, state) {
  if (state.ended) return;
  if (state.decoder) {
    var chunk = state.decoder.end();
    if (chunk && chunk.length) {
      state.buffer.push(chunk);
      state.length += state.objectMode ? 1 : chunk.length;
    }
  }
  state.ended = true;

  // emit 'readable' now to make sure it gets picked up.
  emitReadable(stream);
}

// Don't emit readable right away in sync mode, because this can trigger
// another read() call => stack overflow.  This way, it might trigger
// a nextTick recursion warning, but that's not so bad.
function emitReadable(stream) {
  var state = stream._readableState;
  state.needReadable = false;
  if (!state.emittedReadable) {
    debug('emitReadable', state.flowing);
    state.emittedReadable = true;
    if (state.sync)
      processNextTick(emitReadable_, stream);
    else
      emitReadable_(stream);
  }
}

function emitReadable_(stream) {
  debug('emit readable');
  stream.emit('readable');
  flow(stream);
}


// at this point, the user has presumably seen the 'readable' event,
// and called read() to consume some data.  that may have triggered
// in turn another _read(n) call, in which case reading = true if
// it's in progress.
// However, if we're not ended, or reading, and the length < hwm,
// then go ahead and try to read some more preemptively.
function maybeReadMore(stream, state) {
  if (!state.readingMore) {
    state.readingMore = true;
    processNextTick(maybeReadMore_, stream, state);
  }
}

function maybeReadMore_(stream, state) {
  var len = state.length;
  while (!state.reading && !state.flowing && !state.ended &&
         state.length < state.highWaterMark) {
    debug('maybeReadMore read 0');
    stream.read(0);
    if (len === state.length)
      // didn't get any data, stop spinning.
      break;
    else
      len = state.length;
  }
  state.readingMore = false;
}

// abstract method.  to be overridden in specific implementation classes.
// call cb(er, data) where data is <= n in length.
// for virtual (non-string, non-buffer) streams, "length" is somewhat
// arbitrary, and perhaps not very meaningful.
Readable.prototype._read = function(n) {
  this.emit('error', new Error('not implemented'));
};

Readable.prototype.pipe = function(dest, pipeOpts) {
  var src = this;
  var state = this._readableState;

  switch (state.pipesCount) {
    case 0:
      state.pipes = dest;
      break;
    case 1:
      state.pipes = [state.pipes, dest];
      break;
    default:
      state.pipes.push(dest);
      break;
  }
  state.pipesCount += 1;
  debug('pipe count=%d opts=%j', state.pipesCount, pipeOpts);

  var doEnd = (!pipeOpts || pipeOpts.end !== false) &&
              dest !== process.stdout &&
              dest !== process.stderr;

  var endFn = doEnd ? onend : cleanup;
  if (state.endEmitted)
    processNextTick(endFn);
  else
    src.once('end', endFn);

  dest.on('unpipe', onunpipe);
  function onunpipe(readable) {
    debug('onunpipe');
    if (readable === src) {
      cleanup();
    }
  }

  function onend() {
    debug('onend');
    dest.end();
  }

  // when the dest drains, it reduces the awaitDrain counter
  // on the source.  This would be more elegant with a .once()
  // handler in flow(), but adding and removing repeatedly is
  // too slow.
  var ondrain = pipeOnDrain(src);
  dest.on('drain', ondrain);

  var cleanedUp = false;
  function cleanup() {
    debug('cleanup');
    // cleanup event handlers once the pipe is broken
    dest.removeListener('close', onclose);
    dest.removeListener('finish', onfinish);
    dest.removeListener('drain', ondrain);
    dest.removeListener('error', onerror);
    dest.removeListener('unpipe', onunpipe);
    src.removeListener('end', onend);
    src.removeListener('end', cleanup);
    src.removeListener('data', ondata);

    cleanedUp = true;

    // if the reader is waiting for a drain event from this
    // specific writer, then it would cause it to never start
    // flowing again.
    // So, if this is awaiting a drain, then we just call it now.
    // If we don't know, then assume that we are waiting for one.
    if (state.awaitDrain &&
        (!dest._writableState || dest._writableState.needDrain))
      ondrain();
  }

  src.on('data', ondata);
  function ondata(chunk) {
    debug('ondata');
    var ret = dest.write(chunk);
    if (false === ret) {
      // If the user unpiped during `dest.write()`, it is possible
      // to get stuck in a permanently paused state if that write
      // also returned false.
      if (state.pipesCount === 1 &&
          state.pipes[0] === dest &&
          src.listenerCount('data') === 1 &&
          !cleanedUp) {
        debug('false write response, pause', src._readableState.awaitDrain);
        src._readableState.awaitDrain++;
      }
      src.pause();
    }
  }

  // if the dest has an error, then stop piping into it.
  // however, don't suppress the throwing behavior for this.
  function onerror(er) {
    debug('onerror', er);
    unpipe();
    dest.removeListener('error', onerror);
    if (EElistenerCount(dest, 'error') === 0)
      dest.emit('error', er);
  }
  // This is a brutally ugly hack to make sure that our error handler
  // is attached before any userland ones.  NEVER DO THIS.
  if (!dest._events || !dest._events.error)
    dest.on('error', onerror);
  else if (isArray(dest._events.error))
    dest._events.error.unshift(onerror);
  else
    dest._events.error = [onerror, dest._events.error];


  // Both close and finish should trigger unpipe, but only once.
  function onclose() {
    dest.removeListener('finish', onfinish);
    unpipe();
  }
  dest.once('close', onclose);
  function onfinish() {
    debug('onfinish');
    dest.removeListener('close', onclose);
    unpipe();
  }
  dest.once('finish', onfinish);

  function unpipe() {
    debug('unpipe');
    src.unpipe(dest);
  }

  // tell the dest that it's being piped to
  dest.emit('pipe', src);

  // start the flow if it hasn't been started already.
  if (!state.flowing) {
    debug('pipe resume');
    src.resume();
  }

  return dest;
};

function pipeOnDrain(src) {
  return function() {
    var state = src._readableState;
    debug('pipeOnDrain', state.awaitDrain);
    if (state.awaitDrain)
      state.awaitDrain--;
    if (state.awaitDrain === 0 && EElistenerCount(src, 'data')) {
      state.flowing = true;
      flow(src);
    }
  };
}


Readable.prototype.unpipe = function(dest) {
  var state = this._readableState;

  // if we're not piping anywhere, then do nothing.
  if (state.pipesCount === 0)
    return this;

  // just one destination.  most common case.
  if (state.pipesCount === 1) {
    // passed in one, but it's not the right one.
    if (dest && dest !== state.pipes)
      return this;

    if (!dest)
      dest = state.pipes;

    // got a match.
    state.pipes = null;
    state.pipesCount = 0;
    state.flowing = false;
    if (dest)
      dest.emit('unpipe', this);
    return this;
  }

  // slow case. multiple pipe destinations.

  if (!dest) {
    // remove all.
    var dests = state.pipes;
    var len = state.pipesCount;
    state.pipes = null;
    state.pipesCount = 0;
    state.flowing = false;

    for (var i = 0; i < len; i++)
      dests[i].emit('unpipe', this);
    return this;
  }

  // try to find the right one.
  var i = indexOf(state.pipes, dest);
  if (i === -1)
    return this;

  state.pipes.splice(i, 1);
  state.pipesCount -= 1;
  if (state.pipesCount === 1)
    state.pipes = state.pipes[0];

  dest.emit('unpipe', this);

  return this;
};

// set up data events if they are asked for
// Ensure readable listeners eventually get something
Readable.prototype.on = function(ev, fn) {
  var res = Stream.prototype.on.call(this, ev, fn);

  // If listening to data, and it has not explicitly been paused,
  // then call resume to start the flow of data on the next tick.
  if (ev === 'data' && false !== this._readableState.flowing) {
    this.resume();
  }

  if (ev === 'readable' && this.readable) {
    var state = this._readableState;
    if (!state.readableListening) {
      state.readableListening = true;
      state.emittedReadable = false;
      state.needReadable = true;
      if (!state.reading) {
        processNextTick(nReadingNextTick, this);
      } else if (state.length) {
        emitReadable(this, state);
      }
    }
  }

  return res;
};
Readable.prototype.addListener = Readable.prototype.on;

function nReadingNextTick(self) {
  debug('readable nexttick read 0');
  self.read(0);
}

// pause() and resume() are remnants of the legacy readable stream API
// If the user uses them, then switch into old mode.
Readable.prototype.resume = function() {
  var state = this._readableState;
  if (!state.flowing) {
    debug('resume');
    state.flowing = true;
    resume(this, state);
  }
  return this;
};

function resume(stream, state) {
  if (!state.resumeScheduled) {
    state.resumeScheduled = true;
    processNextTick(resume_, stream, state);
  }
}

function resume_(stream, state) {
  if (!state.reading) {
    debug('resume read 0');
    stream.read(0);
  }

  state.resumeScheduled = false;
  stream.emit('resume');
  flow(stream);
  if (state.flowing && !state.reading)
    stream.read(0);
}

Readable.prototype.pause = function() {
  debug('call pause flowing=%j', this._readableState.flowing);
  if (false !== this._readableState.flowing) {
    debug('pause');
    this._readableState.flowing = false;
    this.emit('pause');
  }
  return this;
};

function flow(stream) {
  var state = stream._readableState;
  debug('flow', state.flowing);
  if (state.flowing) {
    do {
      var chunk = stream.read();
    } while (null !== chunk && state.flowing);
  }
}

// wrap an old-style stream as the async data source.
// This is *not* part of the readable stream interface.
// It is an ugly unfortunate mess of history.
Readable.prototype.wrap = function(stream) {
  var state = this._readableState;
  var paused = false;

  var self = this;
  stream.on('end', function() {
    debug('wrapped end');
    if (state.decoder && !state.ended) {
      var chunk = state.decoder.end();
      if (chunk && chunk.length)
        self.push(chunk);
    }

    self.push(null);
  });

  stream.on('data', function(chunk) {
    debug('wrapped data');
    if (state.decoder)
      chunk = state.decoder.write(chunk);

    // don't skip over falsy values in objectMode
    if (state.objectMode && (chunk === null || chunk === undefined))
      return;
    else if (!state.objectMode && (!chunk || !chunk.length))
      return;

    var ret = self.push(chunk);
    if (!ret) {
      paused = true;
      stream.pause();
    }
  });

  // proxy all the other methods.
  // important when wrapping filters and duplexes.
  for (var i in stream) {
    if (this[i] === undefined && typeof stream[i] === 'function') {
      this[i] = function(method) { return function() {
        return stream[method].apply(stream, arguments);
      }; }(i);
    }
  }

  // proxy certain important events.
  var events = ['error', 'close', 'destroy', 'pause', 'resume'];
  forEach(events, function(ev) {
    stream.on(ev, self.emit.bind(self, ev));
  });

  // when we try to consume some more bytes, simply unpause the
  // underlying stream.
  self._read = function(n) {
    debug('wrapped _read', n);
    if (paused) {
      paused = false;
      stream.resume();
    }
  };

  return self;
};


// exposed for testing purposes only.
Readable._fromList = fromList;

// Pluck off n bytes from an array of buffers.
// Length is the combined lengths of all the buffers in the list.
function fromList(n, state) {
  var list = state.buffer;
  var length = state.length;
  var stringMode = !!state.decoder;
  var objectMode = !!state.objectMode;
  var ret;

  // nothing in the list, definitely empty.
  if (list.length === 0)
    return null;

  if (length === 0)
    ret = null;
  else if (objectMode)
    ret = list.shift();
  else if (!n || n >= length) {
    // read it all, truncate the array.
    if (stringMode)
      ret = list.join('');
    else if (list.length === 1)
      ret = list[0];
    else
      ret = Buffer.concat(list, length);
    list.length = 0;
  } else {
    // read just some of it.
    if (n < list[0].length) {
      // just take a part of the first list item.
      // slice is the same for buffers and strings.
      var buf = list[0];
      ret = buf.slice(0, n);
      list[0] = buf.slice(n);
    } else if (n === list[0].length) {
      // first list is a perfect match
      ret = list.shift();
    } else {
      // complex case.
      // we have enough to cover it, but it spans past the first buffer.
      if (stringMode)
        ret = '';
      else
        ret = new Buffer(n);

      var c = 0;
      for (var i = 0, l = list.length; i < l && c < n; i++) {
        var buf = list[0];
        var cpy = Math.min(n - c, buf.length);

        if (stringMode)
          ret += buf.slice(0, cpy);
        else
          buf.copy(ret, c, 0, cpy);

        if (cpy < buf.length)
          list[0] = buf.slice(cpy);
        else
          list.shift();

        c += cpy;
      }
    }
  }

  return ret;
}

function endReadable(stream) {
  var state = stream._readableState;

  // If we get here before consuming all the bytes, then that is a
  // bug in node.  Should never happen.
  if (state.length > 0)
    throw new Error('endReadable called on non-empty stream');

  if (!state.endEmitted) {
    state.ended = true;
    processNextTick(endReadableNT, state, stream);
  }
}

function endReadableNT(state, stream) {
  // Check that we didn't get one last unshift.
  if (!state.endEmitted && state.length === 0) {
    state.endEmitted = true;
    stream.readable = false;
    stream.emit('end');
  }
}

function forEach (xs, f) {
  for (var i = 0, l = xs.length; i < l; i++) {
    f(xs[i], i);
  }
}

function indexOf (xs, x) {
  for (var i = 0, l = xs.length; i < l; i++) {
    if (xs[i] === x) return i;
  }
  return -1;
}

}).call(this,require('_process'))
},{"./_stream_duplex":509,"_process":503,"buffer":303,"core-util-is":514,"events":499,"inherits":500,"isarray":502,"process-nextick-args":515,"string_decoder/":522,"util":302}],512:[function(require,module,exports){
// a transform stream is a readable/writable stream where you do
// something with the data.  Sometimes it's called a "filter",
// but that's not a great name for it, since that implies a thing where
// some bits pass through, and others are simply ignored.  (That would
// be a valid example of a transform, of course.)
//
// While the output is causally related to the input, it's not a
// necessarily symmetric or synchronous transformation.  For example,
// a zlib stream might take multiple plain-text writes(), and then
// emit a single compressed chunk some time in the future.
//
// Here's how this works:
//
// The Transform stream has all the aspects of the readable and writable
// stream classes.  When you write(chunk), that calls _write(chunk,cb)
// internally, and returns false if there's a lot of pending writes
// buffered up.  When you call read(), that calls _read(n) until
// there's enough pending readable data buffered up.
//
// In a transform stream, the written data is placed in a buffer.  When
// _read(n) is called, it transforms the queued up data, calling the
// buffered _write cb's as it consumes chunks.  If consuming a single
// written chunk would result in multiple output chunks, then the first
// outputted bit calls the readcb, and subsequent chunks just go into
// the read buffer, and will cause it to emit 'readable' if necessary.
//
// This way, back-pressure is actually determined by the reading side,
// since _read has to be called to start processing a new chunk.  However,
// a pathological inflate type of transform can cause excessive buffering
// here.  For example, imagine a stream where every byte of input is
// interpreted as an integer from 0-255, and then results in that many
// bytes of output.  Writing the 4 bytes {ff,ff,ff,ff} would result in
// 1kb of data being output.  In this case, you could write a very small
// amount of input, and end up with a very large amount of output.  In
// such a pathological inflating mechanism, there'd be no way to tell
// the system to stop doing the transform.  A single 4MB write could
// cause the system to run out of memory.
//
// However, even in such a pathological case, only a single written chunk
// would be consumed, and then the rest would wait (un-transformed) until
// the results of the previous transformed chunk were consumed.

'use strict';

module.exports = Transform;

var Duplex = require('./_stream_duplex');

/*<replacement>*/
var util = require('core-util-is');
util.inherits = require('inherits');
/*</replacement>*/

util.inherits(Transform, Duplex);


function TransformState(stream) {
  this.afterTransform = function(er, data) {
    return afterTransform(stream, er, data);
  };

  this.needTransform = false;
  this.transforming = false;
  this.writecb = null;
  this.writechunk = null;
}

function afterTransform(stream, er, data) {
  var ts = stream._transformState;
  ts.transforming = false;

  var cb = ts.writecb;

  if (!cb)
    return stream.emit('error', new Error('no writecb in Transform class'));

  ts.writechunk = null;
  ts.writecb = null;

  if (data !== null && data !== undefined)
    stream.push(data);

  if (cb)
    cb(er);

  var rs = stream._readableState;
  rs.reading = false;
  if (rs.needReadable || rs.length < rs.highWaterMark) {
    stream._read(rs.highWaterMark);
  }
}


function Transform(options) {
  if (!(this instanceof Transform))
    return new Transform(options);

  Duplex.call(this, options);

  this._transformState = new TransformState(this);

  // when the writable side finishes, then flush out anything remaining.
  var stream = this;

  // start out asking for a readable event once data is transformed.
  this._readableState.needReadable = true;

  // we have implemented the _read method, and done the other things
  // that Readable wants before the first _read call, so unset the
  // sync guard flag.
  this._readableState.sync = false;

  if (options) {
    if (typeof options.transform === 'function')
      this._transform = options.transform;

    if (typeof options.flush === 'function')
      this._flush = options.flush;
  }

  this.once('prefinish', function() {
    if (typeof this._flush === 'function')
      this._flush(function(er) {
        done(stream, er);
      });
    else
      done(stream);
  });
}

Transform.prototype.push = function(chunk, encoding) {
  this._transformState.needTransform = false;
  return Duplex.prototype.push.call(this, chunk, encoding);
};

// This is the part where you do stuff!
// override this function in implementation classes.
// 'chunk' is an input chunk.
//
// Call `push(newChunk)` to pass along transformed output
// to the readable side.  You may call 'push' zero or more times.
//
// Call `cb(err)` when you are done with this chunk.  If you pass
// an error, then that'll put the hurt on the whole operation.  If you
// never call cb(), then you'll never get another chunk.
Transform.prototype._transform = function(chunk, encoding, cb) {
  throw new Error('not implemented');
};

Transform.prototype._write = function(chunk, encoding, cb) {
  var ts = this._transformState;
  ts.writecb = cb;
  ts.writechunk = chunk;
  ts.writeencoding = encoding;
  if (!ts.transforming) {
    var rs = this._readableState;
    if (ts.needTransform ||
        rs.needReadable ||
        rs.length < rs.highWaterMark)
      this._read(rs.highWaterMark);
  }
};

// Doesn't matter what the args are here.
// _transform does all the work.
// That we got here means that the readable side wants more data.
Transform.prototype._read = function(n) {
  var ts = this._transformState;

  if (ts.writechunk !== null && ts.writecb && !ts.transforming) {
    ts.transforming = true;
    this._transform(ts.writechunk, ts.writeencoding, ts.afterTransform);
  } else {
    // mark that we need a transform, so that any data that comes in
    // will get processed, now that we've asked for it.
    ts.needTransform = true;
  }
};


function done(stream, er) {
  if (er)
    return stream.emit('error', er);

  // if there's nothing in the write buffer, then that means
  // that nothing more will ever be provided
  var ws = stream._writableState;
  var ts = stream._transformState;

  if (ws.length)
    throw new Error('calling transform done when ws.length != 0');

  if (ts.transforming)
    throw new Error('calling transform done when still transforming');

  return stream.push(null);
}

},{"./_stream_duplex":509,"core-util-is":514,"inherits":500}],513:[function(require,module,exports){
// A bit simpler than readable streams.
// Implement an async ._write(chunk, encoding, cb), and it'll handle all
// the drain event emission and buffering.

'use strict';

module.exports = Writable;

/*<replacement>*/
var processNextTick = require('process-nextick-args');
/*</replacement>*/


/*<replacement>*/
var Buffer = require('buffer').Buffer;
/*</replacement>*/

Writable.WritableState = WritableState;


/*<replacement>*/
var util = require('core-util-is');
util.inherits = require('inherits');
/*</replacement>*/


/*<replacement>*/
var internalUtil = {
  deprecate: require('util-deprecate')
};
/*</replacement>*/



/*<replacement>*/
var Stream;
(function (){try{
  Stream = require('st' + 'ream');
}catch(_){}finally{
  if (!Stream)
    Stream = require('events').EventEmitter;
}}())
/*</replacement>*/

var Buffer = require('buffer').Buffer;

util.inherits(Writable, Stream);

function nop() {}

function WriteReq(chunk, encoding, cb) {
  this.chunk = chunk;
  this.encoding = encoding;
  this.callback = cb;
  this.next = null;
}

var Duplex;
function WritableState(options, stream) {
  Duplex = Duplex || require('./_stream_duplex');

  options = options || {};

  // object stream flag to indicate whether or not this stream
  // contains buffers or objects.
  this.objectMode = !!options.objectMode;

  if (stream instanceof Duplex)
    this.objectMode = this.objectMode || !!options.writableObjectMode;

  // the point at which write() starts returning false
  // Note: 0 is a valid value, means that we always return false if
  // the entire buffer is not flushed immediately on write()
  var hwm = options.highWaterMark;
  var defaultHwm = this.objectMode ? 16 : 16 * 1024;
  this.highWaterMark = (hwm || hwm === 0) ? hwm : defaultHwm;

  // cast to ints.
  this.highWaterMark = ~~this.highWaterMark;

  this.needDrain = false;
  // at the start of calling end()
  this.ending = false;
  // when end() has been called, and returned
  this.ended = false;
  // when 'finish' is emitted
  this.finished = false;

  // should we decode strings into buffers before passing to _write?
  // this is here so that some node-core streams can optimize string
  // handling at a lower level.
  var noDecode = options.decodeStrings === false;
  this.decodeStrings = !noDecode;

  // Crypto is kind of old and crusty.  Historically, its default string
  // encoding is 'binary' so we have to make this configurable.
  // Everything else in the universe uses 'utf8', though.
  this.defaultEncoding = options.defaultEncoding || 'utf8';

  // not an actual buffer we keep track of, but a measurement
  // of how much we're waiting to get pushed to some underlying
  // socket or file.
  this.length = 0;

  // a flag to see when we're in the middle of a write.
  this.writing = false;

  // when true all writes will be buffered until .uncork() call
  this.corked = 0;

  // a flag to be able to tell if the onwrite cb is called immediately,
  // or on a later tick.  We set this to true at first, because any
  // actions that shouldn't happen until "later" should generally also
  // not happen before the first write call.
  this.sync = true;

  // a flag to know if we're processing previously buffered items, which
  // may call the _write() callback in the same tick, so that we don't
  // end up in an overlapped onwrite situation.
  this.bufferProcessing = false;

  // the callback that's passed to _write(chunk,cb)
  this.onwrite = function(er) {
    onwrite(stream, er);
  };

  // the callback that the user supplies to write(chunk,encoding,cb)
  this.writecb = null;

  // the amount that is being written when _write is called.
  this.writelen = 0;

  this.bufferedRequest = null;
  this.lastBufferedRequest = null;

  // number of pending user-supplied write callbacks
  // this must be 0 before 'finish' can be emitted
  this.pendingcb = 0;

  // emit prefinish if the only thing we're waiting for is _write cbs
  // This is relevant for synchronous Transform streams
  this.prefinished = false;

  // True if the error was already emitted and should not be thrown again
  this.errorEmitted = false;
}

WritableState.prototype.getBuffer = function writableStateGetBuffer() {
  var current = this.bufferedRequest;
  var out = [];
  while (current) {
    out.push(current);
    current = current.next;
  }
  return out;
};

(function (){try {
Object.defineProperty(WritableState.prototype, 'buffer', {
  get: internalUtil.deprecate(function() {
    return this.getBuffer();
  }, '_writableState.buffer is deprecated. Use _writableState.getBuffer ' +
     'instead.')
});
}catch(_){}}());


var Duplex;
function Writable(options) {
  Duplex = Duplex || require('./_stream_duplex');

  // Writable ctor is applied to Duplexes, though they're not
  // instanceof Writable, they're instanceof Readable.
  if (!(this instanceof Writable) && !(this instanceof Duplex))
    return new Writable(options);

  this._writableState = new WritableState(options, this);

  // legacy.
  this.writable = true;

  if (options) {
    if (typeof options.write === 'function')
      this._write = options.write;

    if (typeof options.writev === 'function')
      this._writev = options.writev;
  }

  Stream.call(this);
}

// Otherwise people can pipe Writable streams, which is just wrong.
Writable.prototype.pipe = function() {
  this.emit('error', new Error('Cannot pipe. Not readable.'));
};


function writeAfterEnd(stream, cb) {
  var er = new Error('write after end');
  // TODO: defer error events consistently everywhere, not just the cb
  stream.emit('error', er);
  processNextTick(cb, er);
}

// If we get something that is not a buffer, string, null, or undefined,
// and we're not in objectMode, then that's an error.
// Otherwise stream chunks are all considered to be of length=1, and the
// watermarks determine how many objects to keep in the buffer, rather than
// how many bytes or characters.
function validChunk(stream, state, chunk, cb) {
  var valid = true;

  if (!(Buffer.isBuffer(chunk)) &&
      typeof chunk !== 'string' &&
      chunk !== null &&
      chunk !== undefined &&
      !state.objectMode) {
    var er = new TypeError('Invalid non-string/buffer chunk');
    stream.emit('error', er);
    processNextTick(cb, er);
    valid = false;
  }
  return valid;
}

Writable.prototype.write = function(chunk, encoding, cb) {
  var state = this._writableState;
  var ret = false;

  if (typeof encoding === 'function') {
    cb = encoding;
    encoding = null;
  }

  if (Buffer.isBuffer(chunk))
    encoding = 'buffer';
  else if (!encoding)
    encoding = state.defaultEncoding;

  if (typeof cb !== 'function')
    cb = nop;

  if (state.ended)
    writeAfterEnd(this, cb);
  else if (validChunk(this, state, chunk, cb)) {
    state.pendingcb++;
    ret = writeOrBuffer(this, state, chunk, encoding, cb);
  }

  return ret;
};

Writable.prototype.cork = function() {
  var state = this._writableState;

  state.corked++;
};

Writable.prototype.uncork = function() {
  var state = this._writableState;

  if (state.corked) {
    state.corked--;

    if (!state.writing &&
        !state.corked &&
        !state.finished &&
        !state.bufferProcessing &&
        state.bufferedRequest)
      clearBuffer(this, state);
  }
};

Writable.prototype.setDefaultEncoding = function setDefaultEncoding(encoding) {
  // node::ParseEncoding() requires lower case.
  if (typeof encoding === 'string')
    encoding = encoding.toLowerCase();
  if (!(['hex', 'utf8', 'utf-8', 'ascii', 'binary', 'base64',
'ucs2', 'ucs-2','utf16le', 'utf-16le', 'raw']
.indexOf((encoding + '').toLowerCase()) > -1))
    throw new TypeError('Unknown encoding: ' + encoding);
  this._writableState.defaultEncoding = encoding;
};

function decodeChunk(state, chunk, encoding) {
  if (!state.objectMode &&
      state.decodeStrings !== false &&
      typeof chunk === 'string') {
    chunk = new Buffer(chunk, encoding);
  }
  return chunk;
}

// if we're already writing something, then just put this
// in the queue, and wait our turn.  Otherwise, call _write
// If we return false, then we need a drain event, so set that flag.
function writeOrBuffer(stream, state, chunk, encoding, cb) {
  chunk = decodeChunk(state, chunk, encoding);

  if (Buffer.isBuffer(chunk))
    encoding = 'buffer';
  var len = state.objectMode ? 1 : chunk.length;

  state.length += len;

  var ret = state.length < state.highWaterMark;
  // we must ensure that previous needDrain will not be reset to false.
  if (!ret)
    state.needDrain = true;

  if (state.writing || state.corked) {
    var last = state.lastBufferedRequest;
    state.lastBufferedRequest = new WriteReq(chunk, encoding, cb);
    if (last) {
      last.next = state.lastBufferedRequest;
    } else {
      state.bufferedRequest = state.lastBufferedRequest;
    }
  } else {
    doWrite(stream, state, false, len, chunk, encoding, cb);
  }

  return ret;
}

function doWrite(stream, state, writev, len, chunk, encoding, cb) {
  state.writelen = len;
  state.writecb = cb;
  state.writing = true;
  state.sync = true;
  if (writev)
    stream._writev(chunk, state.onwrite);
  else
    stream._write(chunk, encoding, state.onwrite);
  state.sync = false;
}

function onwriteError(stream, state, sync, er, cb) {
  --state.pendingcb;
  if (sync)
    processNextTick(cb, er);
  else
    cb(er);

  stream._writableState.errorEmitted = true;
  stream.emit('error', er);
}

function onwriteStateUpdate(state) {
  state.writing = false;
  state.writecb = null;
  state.length -= state.writelen;
  state.writelen = 0;
}

function onwrite(stream, er) {
  var state = stream._writableState;
  var sync = state.sync;
  var cb = state.writecb;

  onwriteStateUpdate(state);

  if (er)
    onwriteError(stream, state, sync, er, cb);
  else {
    // Check if we're actually ready to finish, but don't emit yet
    var finished = needFinish(state);

    if (!finished &&
        !state.corked &&
        !state.bufferProcessing &&
        state.bufferedRequest) {
      clearBuffer(stream, state);
    }

    if (sync) {
      processNextTick(afterWrite, stream, state, finished, cb);
    } else {
      afterWrite(stream, state, finished, cb);
    }
  }
}

function afterWrite(stream, state, finished, cb) {
  if (!finished)
    onwriteDrain(stream, state);
  state.pendingcb--;
  cb();
  finishMaybe(stream, state);
}

// Must force callback to be called on nextTick, so that we don't
// emit 'drain' before the write() consumer gets the 'false' return
// value, and has a chance to attach a 'drain' listener.
function onwriteDrain(stream, state) {
  if (state.length === 0 && state.needDrain) {
    state.needDrain = false;
    stream.emit('drain');
  }
}


// if there's something in the buffer waiting, then process it
function clearBuffer(stream, state) {
  state.bufferProcessing = true;
  var entry = state.bufferedRequest;

  if (stream._writev && entry && entry.next) {
    // Fast case, write everything using _writev()
    var buffer = [];
    var cbs = [];
    while (entry) {
      cbs.push(entry.callback);
      buffer.push(entry);
      entry = entry.next;
    }

    // count the one we are adding, as well.
    // TODO(isaacs) clean this up
    state.pendingcb++;
    state.lastBufferedRequest = null;
    doWrite(stream, state, true, state.length, buffer, '', function(err) {
      for (var i = 0; i < cbs.length; i++) {
        state.pendingcb--;
        cbs[i](err);
      }
    });

    // Clear buffer
  } else {
    // Slow case, write chunks one-by-one
    while (entry) {
      var chunk = entry.chunk;
      var encoding = entry.encoding;
      var cb = entry.callback;
      var len = state.objectMode ? 1 : chunk.length;

      doWrite(stream, state, false, len, chunk, encoding, cb);
      entry = entry.next;
      // if we didn't call the onwrite immediately, then
      // it means that we need to wait until it does.
      // also, that means that the chunk and cb are currently
      // being processed, so move the buffer counter past them.
      if (state.writing) {
        break;
      }
    }

    if (entry === null)
      state.lastBufferedRequest = null;
  }
  state.bufferedRequest = entry;
  state.bufferProcessing = false;
}

Writable.prototype._write = function(chunk, encoding, cb) {
  cb(new Error('not implemented'));
};

Writable.prototype._writev = null;

Writable.prototype.end = function(chunk, encoding, cb) {
  var state = this._writableState;

  if (typeof chunk === 'function') {
    cb = chunk;
    chunk = null;
    encoding = null;
  } else if (typeof encoding === 'function') {
    cb = encoding;
    encoding = null;
  }

  if (chunk !== null && chunk !== undefined)
    this.write(chunk, encoding);

  // .end() fully uncorks
  if (state.corked) {
    state.corked = 1;
    this.uncork();
  }

  // ignore unnecessary end() calls.
  if (!state.ending && !state.finished)
    endWritable(this, state, cb);
};


function needFinish(state) {
  return (state.ending &&
          state.length === 0 &&
          state.bufferedRequest === null &&
          !state.finished &&
          !state.writing);
}

function prefinish(stream, state) {
  if (!state.prefinished) {
    state.prefinished = true;
    stream.emit('prefinish');
  }
}

function finishMaybe(stream, state) {
  var need = needFinish(state);
  if (need) {
    if (state.pendingcb === 0) {
      prefinish(stream, state);
      state.finished = true;
      stream.emit('finish');
    } else {
      prefinish(stream, state);
    }
  }
  return need;
}

function endWritable(stream, state, cb) {
  state.ending = true;
  finishMaybe(stream, state);
  if (cb) {
    if (state.finished)
      processNextTick(cb);
    else
      stream.once('finish', cb);
  }
  state.ended = true;
}

},{"./_stream_duplex":509,"buffer":303,"core-util-is":514,"events":499,"inherits":500,"process-nextick-args":515,"util-deprecate":516}],514:[function(require,module,exports){
(function (Buffer){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

// NOTE: These type checking functions intentionally don't use `instanceof`
// because it is fragile and can be easily faked with `Object.create()`.

function isArray(arg) {
  if (Array.isArray) {
    return Array.isArray(arg);
  }
  return objectToString(arg) === '[object Array]';
}
exports.isArray = isArray;

function isBoolean(arg) {
  return typeof arg === 'boolean';
}
exports.isBoolean = isBoolean;

function isNull(arg) {
  return arg === null;
}
exports.isNull = isNull;

function isNullOrUndefined(arg) {
  return arg == null;
}
exports.isNullOrUndefined = isNullOrUndefined;

function isNumber(arg) {
  return typeof arg === 'number';
}
exports.isNumber = isNumber;

function isString(arg) {
  return typeof arg === 'string';
}
exports.isString = isString;

function isSymbol(arg) {
  return typeof arg === 'symbol';
}
exports.isSymbol = isSymbol;

function isUndefined(arg) {
  return arg === void 0;
}
exports.isUndefined = isUndefined;

function isRegExp(re) {
  return objectToString(re) === '[object RegExp]';
}
exports.isRegExp = isRegExp;

function isObject(arg) {
  return typeof arg === 'object' && arg !== null;
}
exports.isObject = isObject;

function isDate(d) {
  return objectToString(d) === '[object Date]';
}
exports.isDate = isDate;

function isError(e) {
  return (objectToString(e) === '[object Error]' || e instanceof Error);
}
exports.isError = isError;

function isFunction(arg) {
  return typeof arg === 'function';
}
exports.isFunction = isFunction;

function isPrimitive(arg) {
  return arg === null ||
         typeof arg === 'boolean' ||
         typeof arg === 'number' ||
         typeof arg === 'string' ||
         typeof arg === 'symbol' ||  // ES6 symbol
         typeof arg === 'undefined';
}
exports.isPrimitive = isPrimitive;

exports.isBuffer = Buffer.isBuffer;

function objectToString(o) {
  return Object.prototype.toString.call(o);
}

}).call(this,{"isBuffer":require("../../../../insert-module-globals/node_modules/is-buffer/index.js")})
},{"../../../../insert-module-globals/node_modules/is-buffer/index.js":501}],515:[function(require,module,exports){
(function (process){
'use strict';

if (!process.version ||
    process.version.indexOf('v0.') === 0 ||
    process.version.indexOf('v1.') === 0 && process.version.indexOf('v1.8.') !== 0) {
  module.exports = nextTick;
} else {
  module.exports = process.nextTick;
}

function nextTick(fn) {
  var args = new Array(arguments.length - 1);
  var i = 0;
  while (i < args.length) {
    args[i++] = arguments[i];
  }
  process.nextTick(function afterTick() {
    fn.apply(null, args);
  });
}

}).call(this,require('_process'))
},{"_process":503}],516:[function(require,module,exports){
(function (global){

/**
 * Module exports.
 */

module.exports = deprecate;

/**
 * Mark that a method should not be used.
 * Returns a modified function which warns once by default.
 *
 * If `localStorage.noDeprecation = true` is set, then it is a no-op.
 *
 * If `localStorage.throwDeprecation = true` is set, then deprecated functions
 * will throw an Error when invoked.
 *
 * If `localStorage.traceDeprecation = true` is set, then deprecated functions
 * will invoke `console.trace()` instead of `console.error()`.
 *
 * @param {Function} fn - the function to deprecate
 * @param {String} msg - the string to print to the console when `fn` is invoked
 * @returns {Function} a new "deprecated" version of `fn`
 * @api public
 */

function deprecate (fn, msg) {
  if (config('noDeprecation')) {
    return fn;
  }

  var warned = false;
  function deprecated() {
    if (!warned) {
      if (config('throwDeprecation')) {
        throw new Error(msg);
      } else if (config('traceDeprecation')) {
        console.trace(msg);
      } else {
        console.warn(msg);
      }
      warned = true;
    }
    return fn.apply(this, arguments);
  }

  return deprecated;
}

/**
 * Checks `localStorage` for boolean values for the given `name`.
 *
 * @param {String} name
 * @returns {Boolean}
 * @api private
 */

function config (name) {
  // accessing global.localStorage can trigger a DOMException in sandboxed iframes
  try {
    if (!global.localStorage) return false;
  } catch (_) {
    return false;
  }
  var val = global.localStorage[name];
  if (null == val) return false;
  return String(val).toLowerCase() === 'true';
}

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],517:[function(require,module,exports){
module.exports = require("./lib/_stream_passthrough.js")

},{"./lib/_stream_passthrough.js":510}],518:[function(require,module,exports){
var Stream = (function (){
  try {
    return require('st' + 'ream'); // hack to fix a circular dependency issue when used with browserify
  } catch(_){}
}());
exports = module.exports = require('./lib/_stream_readable.js');
exports.Stream = Stream || exports;
exports.Readable = exports;
exports.Writable = require('./lib/_stream_writable.js');
exports.Duplex = require('./lib/_stream_duplex.js');
exports.Transform = require('./lib/_stream_transform.js');
exports.PassThrough = require('./lib/_stream_passthrough.js');

},{"./lib/_stream_duplex.js":509,"./lib/_stream_passthrough.js":510,"./lib/_stream_readable.js":511,"./lib/_stream_transform.js":512,"./lib/_stream_writable.js":513}],519:[function(require,module,exports){
module.exports = require("./lib/_stream_transform.js")

},{"./lib/_stream_transform.js":512}],520:[function(require,module,exports){
module.exports = require("./lib/_stream_writable.js")

},{"./lib/_stream_writable.js":513}],521:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

module.exports = Stream;

var EE = require('events').EventEmitter;
var inherits = require('inherits');

inherits(Stream, EE);
Stream.Readable = require('readable-stream/readable.js');
Stream.Writable = require('readable-stream/writable.js');
Stream.Duplex = require('readable-stream/duplex.js');
Stream.Transform = require('readable-stream/transform.js');
Stream.PassThrough = require('readable-stream/passthrough.js');

// Backwards-compat with node 0.4.x
Stream.Stream = Stream;



// old-style streams.  Note that the pipe method (the only relevant
// part of this class) is overridden in the Readable class.

function Stream() {
  EE.call(this);
}

Stream.prototype.pipe = function(dest, options) {
  var source = this;

  function ondata(chunk) {
    if (dest.writable) {
      if (false === dest.write(chunk) && source.pause) {
        source.pause();
      }
    }
  }

  source.on('data', ondata);

  function ondrain() {
    if (source.readable && source.resume) {
      source.resume();
    }
  }

  dest.on('drain', ondrain);

  // If the 'end' option is not supplied, dest.end() will be called when
  // source gets the 'end' or 'close' events.  Only dest.end() once.
  if (!dest._isStdio && (!options || options.end !== false)) {
    source.on('end', onend);
    source.on('close', onclose);
  }

  var didOnEnd = false;
  function onend() {
    if (didOnEnd) return;
    didOnEnd = true;

    dest.end();
  }


  function onclose() {
    if (didOnEnd) return;
    didOnEnd = true;

    if (typeof dest.destroy === 'function') dest.destroy();
  }

  // don't leave dangling pipes when there are errors.
  function onerror(er) {
    cleanup();
    if (EE.listenerCount(this, 'error') === 0) {
      throw er; // Unhandled stream error in pipe.
    }
  }

  source.on('error', onerror);
  dest.on('error', onerror);

  // remove all the event listeners that were added.
  function cleanup() {
    source.removeListener('data', ondata);
    dest.removeListener('drain', ondrain);

    source.removeListener('end', onend);
    source.removeListener('close', onclose);

    source.removeListener('error', onerror);
    dest.removeListener('error', onerror);

    source.removeListener('end', cleanup);
    source.removeListener('close', cleanup);

    dest.removeListener('close', cleanup);
  }

  source.on('end', cleanup);
  source.on('close', cleanup);

  dest.on('close', cleanup);

  dest.emit('pipe', source);

  // Allow for unix-like usage: A.pipe(B).pipe(C)
  return dest;
};

},{"events":499,"inherits":500,"readable-stream/duplex.js":508,"readable-stream/passthrough.js":517,"readable-stream/readable.js":518,"readable-stream/transform.js":519,"readable-stream/writable.js":520}],522:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var Buffer = require('buffer').Buffer;

var isBufferEncoding = Buffer.isEncoding
  || function(encoding) {
       switch (encoding && encoding.toLowerCase()) {
         case 'hex': case 'utf8': case 'utf-8': case 'ascii': case 'binary': case 'base64': case 'ucs2': case 'ucs-2': case 'utf16le': case 'utf-16le': case 'raw': return true;
         default: return false;
       }
     }


function assertEncoding(encoding) {
  if (encoding && !isBufferEncoding(encoding)) {
    throw new Error('Unknown encoding: ' + encoding);
  }
}

// StringDecoder provides an interface for efficiently splitting a series of
// buffers into a series of JS strings without breaking apart multi-byte
// characters. CESU-8 is handled as part of the UTF-8 encoding.
//
// @TODO Handling all encodings inside a single object makes it very difficult
// to reason about this code, so it should be split up in the future.
// @TODO There should be a utf8-strict encoding that rejects invalid UTF-8 code
// points as used by CESU-8.
var StringDecoder = exports.StringDecoder = function(encoding) {
  this.encoding = (encoding || 'utf8').toLowerCase().replace(/[-_]/, '');
  assertEncoding(encoding);
  switch (this.encoding) {
    case 'utf8':
      // CESU-8 represents each of Surrogate Pair by 3-bytes
      this.surrogateSize = 3;
      break;
    case 'ucs2':
    case 'utf16le':
      // UTF-16 represents each of Surrogate Pair by 2-bytes
      this.surrogateSize = 2;
      this.detectIncompleteChar = utf16DetectIncompleteChar;
      break;
    case 'base64':
      // Base-64 stores 3 bytes in 4 chars, and pads the remainder.
      this.surrogateSize = 3;
      this.detectIncompleteChar = base64DetectIncompleteChar;
      break;
    default:
      this.write = passThroughWrite;
      return;
  }

  // Enough space to store all bytes of a single character. UTF-8 needs 4
  // bytes, but CESU-8 may require up to 6 (3 bytes per surrogate).
  this.charBuffer = new Buffer(6);
  // Number of bytes received for the current incomplete multi-byte character.
  this.charReceived = 0;
  // Number of bytes expected for the current incomplete multi-byte character.
  this.charLength = 0;
};


// write decodes the given buffer and returns it as JS string that is
// guaranteed to not contain any partial multi-byte characters. Any partial
// character found at the end of the buffer is buffered up, and will be
// returned when calling write again with the remaining bytes.
//
// Note: Converting a Buffer containing an orphan surrogate to a String
// currently works, but converting a String to a Buffer (via `new Buffer`, or
// Buffer#write) will replace incomplete surrogates with the unicode
// replacement character. See https://codereview.chromium.org/121173009/ .
StringDecoder.prototype.write = function(buffer) {
  var charStr = '';
  // if our last write ended with an incomplete multibyte character
  while (this.charLength) {
    // determine how many remaining bytes this buffer has to offer for this char
    var available = (buffer.length >= this.charLength - this.charReceived) ?
        this.charLength - this.charReceived :
        buffer.length;

    // add the new bytes to the char buffer
    buffer.copy(this.charBuffer, this.charReceived, 0, available);
    this.charReceived += available;

    if (this.charReceived < this.charLength) {
      // still not enough chars in this buffer? wait for more ...
      return '';
    }

    // remove bytes belonging to the current character from the buffer
    buffer = buffer.slice(available, buffer.length);

    // get the character that was split
    charStr = this.charBuffer.slice(0, this.charLength).toString(this.encoding);

    // CESU-8: lead surrogate (D800-DBFF) is also the incomplete character
    var charCode = charStr.charCodeAt(charStr.length - 1);
    if (charCode >= 0xD800 && charCode <= 0xDBFF) {
      this.charLength += this.surrogateSize;
      charStr = '';
      continue;
    }
    this.charReceived = this.charLength = 0;

    // if there are no more bytes in this buffer, just emit our char
    if (buffer.length === 0) {
      return charStr;
    }
    break;
  }

  // determine and set charLength / charReceived
  this.detectIncompleteChar(buffer);

  var end = buffer.length;
  if (this.charLength) {
    // buffer the incomplete character bytes we got
    buffer.copy(this.charBuffer, 0, buffer.length - this.charReceived, end);
    end -= this.charReceived;
  }

  charStr += buffer.toString(this.encoding, 0, end);

  var end = charStr.length - 1;
  var charCode = charStr.charCodeAt(end);
  // CESU-8: lead surrogate (D800-DBFF) is also the incomplete character
  if (charCode >= 0xD800 && charCode <= 0xDBFF) {
    var size = this.surrogateSize;
    this.charLength += size;
    this.charReceived += size;
    this.charBuffer.copy(this.charBuffer, size, 0, size);
    buffer.copy(this.charBuffer, 0, 0, size);
    return charStr.substring(0, end);
  }

  // or just emit the charStr
  return charStr;
};

// detectIncompleteChar determines if there is an incomplete UTF-8 character at
// the end of the given buffer. If so, it sets this.charLength to the byte
// length that character, and sets this.charReceived to the number of bytes
// that are available for this character.
StringDecoder.prototype.detectIncompleteChar = function(buffer) {
  // determine how many bytes we have to check at the end of this buffer
  var i = (buffer.length >= 3) ? 3 : buffer.length;

  // Figure out if one of the last i bytes of our buffer announces an
  // incomplete char.
  for (; i > 0; i--) {
    var c = buffer[buffer.length - i];

    // See http://en.wikipedia.org/wiki/UTF-8#Description

    // 110XXXXX
    if (i == 1 && c >> 5 == 0x06) {
      this.charLength = 2;
      break;
    }

    // 1110XXXX
    if (i <= 2 && c >> 4 == 0x0E) {
      this.charLength = 3;
      break;
    }

    // 11110XXX
    if (i <= 3 && c >> 3 == 0x1E) {
      this.charLength = 4;
      break;
    }
  }
  this.charReceived = i;
};

StringDecoder.prototype.end = function(buffer) {
  var res = '';
  if (buffer && buffer.length)
    res = this.write(buffer);

  if (this.charReceived) {
    var cr = this.charReceived;
    var buf = this.charBuffer;
    var enc = this.encoding;
    res += buf.slice(0, cr).toString(enc);
  }

  return res;
};

function passThroughWrite(buffer) {
  return buffer.toString(this.encoding);
}

function utf16DetectIncompleteChar(buffer) {
  this.charReceived = buffer.length % 2;
  this.charLength = this.charReceived ? 2 : 0;
}

function base64DetectIncompleteChar(buffer) {
  this.charReceived = buffer.length % 3;
  this.charLength = this.charReceived ? 3 : 0;
}

},{"buffer":303}],523:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var punycode = require('punycode');

exports.parse = urlParse;
exports.resolve = urlResolve;
exports.resolveObject = urlResolveObject;
exports.format = urlFormat;

exports.Url = Url;

function Url() {
  this.protocol = null;
  this.slashes = null;
  this.auth = null;
  this.host = null;
  this.port = null;
  this.hostname = null;
  this.hash = null;
  this.search = null;
  this.query = null;
  this.pathname = null;
  this.path = null;
  this.href = null;
}

// Reference: RFC 3986, RFC 1808, RFC 2396

// define these here so at least they only have to be
// compiled once on the first module load.
var protocolPattern = /^([a-z0-9.+-]+:)/i,
    portPattern = /:[0-9]*$/,

    // RFC 2396: characters reserved for delimiting URLs.
    // We actually just auto-escape these.
    delims = ['<', '>', '"', '`', ' ', '\r', '\n', '\t'],

    // RFC 2396: characters not allowed for various reasons.
    unwise = ['{', '}', '|', '\\', '^', '`'].concat(delims),

    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.
    autoEscape = ['\''].concat(unwise),
    // Characters that are never ever allowed in a hostname.
    // Note that any invalid chars are also handled, but these
    // are the ones that are *expected* to be seen, so we fast-path
    // them.
    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),
    hostEndingChars = ['/', '?', '#'],
    hostnameMaxLen = 255,
    hostnamePartPattern = /^[a-z0-9A-Z_-]{0,63}$/,
    hostnamePartStart = /^([a-z0-9A-Z_-]{0,63})(.*)$/,
    // protocols that can allow "unsafe" and "unwise" chars.
    unsafeProtocol = {
      'javascript': true,
      'javascript:': true
    },
    // protocols that never have a hostname.
    hostlessProtocol = {
      'javascript': true,
      'javascript:': true
    },
    // protocols that always contain a // bit.
    slashedProtocol = {
      'http': true,
      'https': true,
      'ftp': true,
      'gopher': true,
      'file': true,
      'http:': true,
      'https:': true,
      'ftp:': true,
      'gopher:': true,
      'file:': true
    },
    querystring = require('querystring');

function urlParse(url, parseQueryString, slashesDenoteHost) {
  if (url && isObject(url) && url instanceof Url) return url;

  var u = new Url;
  u.parse(url, parseQueryString, slashesDenoteHost);
  return u;
}

Url.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {
  if (!isString(url)) {
    throw new TypeError("Parameter 'url' must be a string, not " + typeof url);
  }

  var rest = url;

  // trim before proceeding.
  // This is to support parse stuff like "  http://foo.com  \n"
  rest = rest.trim();

  var proto = protocolPattern.exec(rest);
  if (proto) {
    proto = proto[0];
    var lowerProto = proto.toLowerCase();
    this.protocol = lowerProto;
    rest = rest.substr(proto.length);
  }

  // figure out if it's got a host
  // user@server is *always* interpreted as a hostname, and url
  // resolution will treat //foo/bar as host=foo,path=bar because that's
  // how the browser resolves relative URLs.
  if (slashesDenoteHost || proto || rest.match(/^\/\/[^@\/]+@[^@\/]+/)) {
    var slashes = rest.substr(0, 2) === '//';
    if (slashes && !(proto && hostlessProtocol[proto])) {
      rest = rest.substr(2);
      this.slashes = true;
    }
  }

  if (!hostlessProtocol[proto] &&
      (slashes || (proto && !slashedProtocol[proto]))) {

    // there's a hostname.
    // the first instance of /, ?, ;, or # ends the host.
    //
    // If there is an @ in the hostname, then non-host chars *are* allowed
    // to the left of the last @ sign, unless some host-ending character
    // comes *before* the @-sign.
    // URLs are obnoxious.
    //
    // ex:
    // http://a@b@c/ => user:a@b host:c
    // http://a@b?@c => user:a host:c path:/?@c

    // v0.12 TODO(isaacs): This is not quite how Chrome does things.
    // Review our test case against browsers more comprehensively.

    // find the first instance of any hostEndingChars
    var hostEnd = -1;
    for (var i = 0; i < hostEndingChars.length; i++) {
      var hec = rest.indexOf(hostEndingChars[i]);
      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))
        hostEnd = hec;
    }

    // at this point, either we have an explicit point where the
    // auth portion cannot go past, or the last @ char is the decider.
    var auth, atSign;
    if (hostEnd === -1) {
      // atSign can be anywhere.
      atSign = rest.lastIndexOf('@');
    } else {
      // atSign must be in auth portion.
      // http://a@b/c@d => host:b auth:a path:/c@d
      atSign = rest.lastIndexOf('@', hostEnd);
    }

    // Now we have a portion which is definitely the auth.
    // Pull that off.
    if (atSign !== -1) {
      auth = rest.slice(0, atSign);
      rest = rest.slice(atSign + 1);
      this.auth = decodeURIComponent(auth);
    }

    // the host is the remaining to the left of the first non-host char
    hostEnd = -1;
    for (var i = 0; i < nonHostChars.length; i++) {
      var hec = rest.indexOf(nonHostChars[i]);
      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))
        hostEnd = hec;
    }
    // if we still have not hit it, then the entire thing is a host.
    if (hostEnd === -1)
      hostEnd = rest.length;

    this.host = rest.slice(0, hostEnd);
    rest = rest.slice(hostEnd);

    // pull out port.
    this.parseHost();

    // we've indicated that there is a hostname,
    // so even if it's empty, it has to be present.
    this.hostname = this.hostname || '';

    // if hostname begins with [ and ends with ]
    // assume that it's an IPv6 address.
    var ipv6Hostname = this.hostname[0] === '[' &&
        this.hostname[this.hostname.length - 1] === ']';

    // validate a little.
    if (!ipv6Hostname) {
      var hostparts = this.hostname.split(/\./);
      for (var i = 0, l = hostparts.length; i < l; i++) {
        var part = hostparts[i];
        if (!part) continue;
        if (!part.match(hostnamePartPattern)) {
          var newpart = '';
          for (var j = 0, k = part.length; j < k; j++) {
            if (part.charCodeAt(j) > 127) {
              // we replace non-ASCII char with a temporary placeholder
              // we need this to make sure size of hostname is not
              // broken by replacing non-ASCII by nothing
              newpart += 'x';
            } else {
              newpart += part[j];
            }
          }
          // we test again with ASCII char only
          if (!newpart.match(hostnamePartPattern)) {
            var validParts = hostparts.slice(0, i);
            var notHost = hostparts.slice(i + 1);
            var bit = part.match(hostnamePartStart);
            if (bit) {
              validParts.push(bit[1]);
              notHost.unshift(bit[2]);
            }
            if (notHost.length) {
              rest = '/' + notHost.join('.') + rest;
            }
            this.hostname = validParts.join('.');
            break;
          }
        }
      }
    }

    if (this.hostname.length > hostnameMaxLen) {
      this.hostname = '';
    } else {
      // hostnames are always lower case.
      this.hostname = this.hostname.toLowerCase();
    }

    if (!ipv6Hostname) {
      // IDNA Support: Returns a puny coded representation of "domain".
      // It only converts the part of the domain name that
      // has non ASCII characters. I.e. it dosent matter if
      // you call it with a domain that already is in ASCII.
      var domainArray = this.hostname.split('.');
      var newOut = [];
      for (var i = 0; i < domainArray.length; ++i) {
        var s = domainArray[i];
        newOut.push(s.match(/[^A-Za-z0-9_-]/) ?
            'xn--' + punycode.encode(s) : s);
      }
      this.hostname = newOut.join('.');
    }

    var p = this.port ? ':' + this.port : '';
    var h = this.hostname || '';
    this.host = h + p;
    this.href += this.host;

    // strip [ and ] from the hostname
    // the host field still retains them, though
    if (ipv6Hostname) {
      this.hostname = this.hostname.substr(1, this.hostname.length - 2);
      if (rest[0] !== '/') {
        rest = '/' + rest;
      }
    }
  }

  // now rest is set to the post-host stuff.
  // chop off any delim chars.
  if (!unsafeProtocol[lowerProto]) {

    // First, make 100% sure that any "autoEscape" chars get
    // escaped, even if encodeURIComponent doesn't think they
    // need to be.
    for (var i = 0, l = autoEscape.length; i < l; i++) {
      var ae = autoEscape[i];
      var esc = encodeURIComponent(ae);
      if (esc === ae) {
        esc = escape(ae);
      }
      rest = rest.split(ae).join(esc);
    }
  }


  // chop off from the tail first.
  var hash = rest.indexOf('#');
  if (hash !== -1) {
    // got a fragment string.
    this.hash = rest.substr(hash);
    rest = rest.slice(0, hash);
  }
  var qm = rest.indexOf('?');
  if (qm !== -1) {
    this.search = rest.substr(qm);
    this.query = rest.substr(qm + 1);
    if (parseQueryString) {
      this.query = querystring.parse(this.query);
    }
    rest = rest.slice(0, qm);
  } else if (parseQueryString) {
    // no query string, but parseQueryString still requested
    this.search = '';
    this.query = {};
  }
  if (rest) this.pathname = rest;
  if (slashedProtocol[lowerProto] &&
      this.hostname && !this.pathname) {
    this.pathname = '/';
  }

  //to support http.request
  if (this.pathname || this.search) {
    var p = this.pathname || '';
    var s = this.search || '';
    this.path = p + s;
  }

  // finally, reconstruct the href based on what has been validated.
  this.href = this.format();
  return this;
};

// format a parsed object into a url string
function urlFormat(obj) {
  // ensure it's an object, and not a string url.
  // If it's an obj, this is a no-op.
  // this way, you can call url_format() on strings
  // to clean up potentially wonky urls.
  if (isString(obj)) obj = urlParse(obj);
  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);
  return obj.format();
}

Url.prototype.format = function() {
  var auth = this.auth || '';
  if (auth) {
    auth = encodeURIComponent(auth);
    auth = auth.replace(/%3A/i, ':');
    auth += '@';
  }

  var protocol = this.protocol || '',
      pathname = this.pathname || '',
      hash = this.hash || '',
      host = false,
      query = '';

  if (this.host) {
    host = auth + this.host;
  } else if (this.hostname) {
    host = auth + (this.hostname.indexOf(':') === -1 ?
        this.hostname :
        '[' + this.hostname + ']');
    if (this.port) {
      host += ':' + this.port;
    }
  }

  if (this.query &&
      isObject(this.query) &&
      Object.keys(this.query).length) {
    query = querystring.stringify(this.query);
  }

  var search = this.search || (query && ('?' + query)) || '';

  if (protocol && protocol.substr(-1) !== ':') protocol += ':';

  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.
  // unless they had them to begin with.
  if (this.slashes ||
      (!protocol || slashedProtocol[protocol]) && host !== false) {
    host = '//' + (host || '');
    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;
  } else if (!host) {
    host = '';
  }

  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;
  if (search && search.charAt(0) !== '?') search = '?' + search;

  pathname = pathname.replace(/[?#]/g, function(match) {
    return encodeURIComponent(match);
  });
  search = search.replace('#', '%23');

  return protocol + host + pathname + search + hash;
};

function urlResolve(source, relative) {
  return urlParse(source, false, true).resolve(relative);
}

Url.prototype.resolve = function(relative) {
  return this.resolveObject(urlParse(relative, false, true)).format();
};

function urlResolveObject(source, relative) {
  if (!source) return relative;
  return urlParse(source, false, true).resolveObject(relative);
}

Url.prototype.resolveObject = function(relative) {
  if (isString(relative)) {
    var rel = new Url();
    rel.parse(relative, false, true);
    relative = rel;
  }

  var result = new Url();
  Object.keys(this).forEach(function(k) {
    result[k] = this[k];
  }, this);

  // hash is always overridden, no matter what.
  // even href="" will remove it.
  result.hash = relative.hash;

  // if the relative url is empty, then there's nothing left to do here.
  if (relative.href === '') {
    result.href = result.format();
    return result;
  }

  // hrefs like //foo/bar always cut to the protocol.
  if (relative.slashes && !relative.protocol) {
    // take everything except the protocol from relative
    Object.keys(relative).forEach(function(k) {
      if (k !== 'protocol')
        result[k] = relative[k];
    });

    //urlParse appends trailing / to urls like http://www.example.com
    if (slashedProtocol[result.protocol] &&
        result.hostname && !result.pathname) {
      result.path = result.pathname = '/';
    }

    result.href = result.format();
    return result;
  }

  if (relative.protocol && relative.protocol !== result.protocol) {
    // if it's a known url protocol, then changing
    // the protocol does weird things
    // first, if it's not file:, then we MUST have a host,
    // and if there was a path
    // to begin with, then we MUST have a path.
    // if it is file:, then the host is dropped,
    // because that's known to be hostless.
    // anything else is assumed to be absolute.
    if (!slashedProtocol[relative.protocol]) {
      Object.keys(relative).forEach(function(k) {
        result[k] = relative[k];
      });
      result.href = result.format();
      return result;
    }

    result.protocol = relative.protocol;
    if (!relative.host && !hostlessProtocol[relative.protocol]) {
      var relPath = (relative.pathname || '').split('/');
      while (relPath.length && !(relative.host = relPath.shift()));
      if (!relative.host) relative.host = '';
      if (!relative.hostname) relative.hostname = '';
      if (relPath[0] !== '') relPath.unshift('');
      if (relPath.length < 2) relPath.unshift('');
      result.pathname = relPath.join('/');
    } else {
      result.pathname = relative.pathname;
    }
    result.search = relative.search;
    result.query = relative.query;
    result.host = relative.host || '';
    result.auth = relative.auth;
    result.hostname = relative.hostname || relative.host;
    result.port = relative.port;
    // to support http.request
    if (result.pathname || result.search) {
      var p = result.pathname || '';
      var s = result.search || '';
      result.path = p + s;
    }
    result.slashes = result.slashes || relative.slashes;
    result.href = result.format();
    return result;
  }

  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),
      isRelAbs = (
          relative.host ||
          relative.pathname && relative.pathname.charAt(0) === '/'
      ),
      mustEndAbs = (isRelAbs || isSourceAbs ||
                    (result.host && relative.pathname)),
      removeAllDots = mustEndAbs,
      srcPath = result.pathname && result.pathname.split('/') || [],
      relPath = relative.pathname && relative.pathname.split('/') || [],
      psychotic = result.protocol && !slashedProtocol[result.protocol];

  // if the url is a non-slashed url, then relative
  // links like ../.. should be able
  // to crawl up to the hostname, as well.  This is strange.
  // result.protocol has already been set by now.
  // Later on, put the first path part into the host field.
  if (psychotic) {
    result.hostname = '';
    result.port = null;
    if (result.host) {
      if (srcPath[0] === '') srcPath[0] = result.host;
      else srcPath.unshift(result.host);
    }
    result.host = '';
    if (relative.protocol) {
      relative.hostname = null;
      relative.port = null;
      if (relative.host) {
        if (relPath[0] === '') relPath[0] = relative.host;
        else relPath.unshift(relative.host);
      }
      relative.host = null;
    }
    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');
  }

  if (isRelAbs) {
    // it's absolute.
    result.host = (relative.host || relative.host === '') ?
                  relative.host : result.host;
    result.hostname = (relative.hostname || relative.hostname === '') ?
                      relative.hostname : result.hostname;
    result.search = relative.search;
    result.query = relative.query;
    srcPath = relPath;
    // fall through to the dot-handling below.
  } else if (relPath.length) {
    // it's relative
    // throw away the existing file, and take the new path instead.
    if (!srcPath) srcPath = [];
    srcPath.pop();
    srcPath = srcPath.concat(relPath);
    result.search = relative.search;
    result.query = relative.query;
  } else if (!isNullOrUndefined(relative.search)) {
    // just pull out the search.
    // like href='?foo'.
    // Put this after the other two cases because it simplifies the booleans
    if (psychotic) {
      result.hostname = result.host = srcPath.shift();
      //occationaly the auth can get stuck only in host
      //this especialy happens in cases like
      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')
      var authInHost = result.host && result.host.indexOf('@') > 0 ?
                       result.host.split('@') : false;
      if (authInHost) {
        result.auth = authInHost.shift();
        result.host = result.hostname = authInHost.shift();
      }
    }
    result.search = relative.search;
    result.query = relative.query;
    //to support http.request
    if (!isNull(result.pathname) || !isNull(result.search)) {
      result.path = (result.pathname ? result.pathname : '') +
                    (result.search ? result.search : '');
    }
    result.href = result.format();
    return result;
  }

  if (!srcPath.length) {
    // no path at all.  easy.
    // we've already handled the other stuff above.
    result.pathname = null;
    //to support http.request
    if (result.search) {
      result.path = '/' + result.search;
    } else {
      result.path = null;
    }
    result.href = result.format();
    return result;
  }

  // if a url ENDs in . or .., then it must get a trailing slash.
  // however, if it ends in anything else non-slashy,
  // then it must NOT get a trailing slash.
  var last = srcPath.slice(-1)[0];
  var hasTrailingSlash = (
      (result.host || relative.host) && (last === '.' || last === '..') ||
      last === '');

  // strip single dots, resolve double dots to parent dir
  // if the path tries to go above the root, `up` ends up > 0
  var up = 0;
  for (var i = srcPath.length; i >= 0; i--) {
    last = srcPath[i];
    if (last == '.') {
      srcPath.splice(i, 1);
    } else if (last === '..') {
      srcPath.splice(i, 1);
      up++;
    } else if (up) {
      srcPath.splice(i, 1);
      up--;
    }
  }

  // if the path is allowed to go above the root, restore leading ..s
  if (!mustEndAbs && !removeAllDots) {
    for (; up--; up) {
      srcPath.unshift('..');
    }
  }

  if (mustEndAbs && srcPath[0] !== '' &&
      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {
    srcPath.unshift('');
  }

  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {
    srcPath.push('');
  }

  var isAbsolute = srcPath[0] === '' ||
      (srcPath[0] && srcPath[0].charAt(0) === '/');

  // put the host back
  if (psychotic) {
    result.hostname = result.host = isAbsolute ? '' :
                                    srcPath.length ? srcPath.shift() : '';
    //occationaly the auth can get stuck only in host
    //this especialy happens in cases like
    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')
    var authInHost = result.host && result.host.indexOf('@') > 0 ?
                     result.host.split('@') : false;
    if (authInHost) {
      result.auth = authInHost.shift();
      result.host = result.hostname = authInHost.shift();
    }
  }

  mustEndAbs = mustEndAbs || (result.host && srcPath.length);

  if (mustEndAbs && !isAbsolute) {
    srcPath.unshift('');
  }

  if (!srcPath.length) {
    result.pathname = null;
    result.path = null;
  } else {
    result.pathname = srcPath.join('/');
  }

  //to support request.http
  if (!isNull(result.pathname) || !isNull(result.search)) {
    result.path = (result.pathname ? result.pathname : '') +
                  (result.search ? result.search : '');
  }
  result.auth = relative.auth || result.auth;
  result.slashes = result.slashes || relative.slashes;
  result.href = result.format();
  return result;
};

Url.prototype.parseHost = function() {
  var host = this.host;
  var port = portPattern.exec(host);
  if (port) {
    port = port[0];
    if (port !== ':') {
      this.port = port.substr(1);
    }
    host = host.substr(0, host.length - port.length);
  }
  if (host) this.hostname = host;
};

function isString(arg) {
  return typeof arg === "string";
}

function isObject(arg) {
  return typeof arg === 'object' && arg !== null;
}

function isNull(arg) {
  return arg === null;
}
function isNullOrUndefined(arg) {
  return  arg == null;
}

},{"punycode":504,"querystring":507}],524:[function(require,module,exports){
var indexOf = require('indexof');

var Object_keys = function (obj) {
    if (Object.keys) return Object.keys(obj)
    else {
        var res = [];
        for (var key in obj) res.push(key)
        return res;
    }
};

var forEach = function (xs, fn) {
    if (xs.forEach) return xs.forEach(fn)
    else for (var i = 0; i < xs.length; i++) {
        fn(xs[i], i, xs);
    }
};

var defineProp = (function() {
    try {
        Object.defineProperty({}, '_', {});
        return function(obj, name, value) {
            Object.defineProperty(obj, name, {
                writable: true,
                enumerable: false,
                configurable: true,
                value: value
            })
        };
    } catch(e) {
        return function(obj, name, value) {
            obj[name] = value;
        };
    }
}());

var globals = ['Array', 'Boolean', 'Date', 'Error', 'EvalError', 'Function',
'Infinity', 'JSON', 'Math', 'NaN', 'Number', 'Object', 'RangeError',
'ReferenceError', 'RegExp', 'String', 'SyntaxError', 'TypeError', 'URIError',
'decodeURI', 'decodeURIComponent', 'encodeURI', 'encodeURIComponent', 'escape',
'eval', 'isFinite', 'isNaN', 'parseFloat', 'parseInt', 'undefined', 'unescape'];

function Context() {}
Context.prototype = {};

var Script = exports.Script = function NodeScript (code) {
    if (!(this instanceof Script)) return new Script(code);
    this.code = code;
};

Script.prototype.runInContext = function (context) {
    if (!(context instanceof Context)) {
        throw new TypeError("needs a 'context' argument.");
    }
    
    var iframe = document.createElement('iframe');
    if (!iframe.style) iframe.style = {};
    iframe.style.display = 'none';
    
    document.body.appendChild(iframe);
    
    var win = iframe.contentWindow;
    var wEval = win.eval, wExecScript = win.execScript;

    if (!wEval && wExecScript) {
        // win.eval() magically appears when this is called in IE:
        wExecScript.call(win, 'null');
        wEval = win.eval;
    }
    
    forEach(Object_keys(context), function (key) {
        win[key] = context[key];
    });
    forEach(globals, function (key) {
        if (context[key]) {
            win[key] = context[key];
        }
    });
    
    var winKeys = Object_keys(win);

    var res = wEval.call(win, this.code);
    
    forEach(Object_keys(win), function (key) {
        // Avoid copying circular objects like `top` and `window` by only
        // updating existing context properties or new properties in the `win`
        // that was only introduced after the eval.
        if (key in context || indexOf(winKeys, key) === -1) {
            context[key] = win[key];
        }
    });

    forEach(globals, function (key) {
        if (!(key in context)) {
            defineProp(context, key, win[key]);
        }
    });
    
    document.body.removeChild(iframe);
    
    return res;
};

Script.prototype.runInThisContext = function () {
    return eval(this.code); // maybe...
};

Script.prototype.runInNewContext = function (context) {
    var ctx = Script.createContext(context);
    var res = this.runInContext(ctx);

    forEach(Object_keys(ctx), function (key) {
        context[key] = ctx[key];
    });

    return res;
};

forEach(Object_keys(Script.prototype), function (name) {
    exports[name] = Script[name] = function (code) {
        var s = Script(code);
        return s[name].apply(s, [].slice.call(arguments, 1));
    };
});

exports.createScript = function (code) {
    return exports.Script(code);
};

exports.createContext = Script.createContext = function (context) {
    var copy = new Context();
    if(typeof context === 'object') {
        forEach(Object_keys(context), function (key) {
            copy[key] = context[key];
        });
    }
    return copy;
};

},{"indexof":525}],525:[function(require,module,exports){

var indexOf = [].indexOf;

module.exports = function(arr, obj){
  if (indexOf) return arr.indexOf(obj);
  for (var i = 0; i < arr.length; ++i) {
    if (arr[i] === obj) return i;
  }
  return -1;
};
},{}],526:[function(require,module,exports){
/**
 * Indicates that navigation was caused by a call to history.push.
 */
'use strict';

exports.__esModule = true;
var PUSH = 'PUSH';

exports.PUSH = PUSH;
/**
 * Indicates that navigation was caused by a call to history.replace.
 */
var REPLACE = 'REPLACE';

exports.REPLACE = REPLACE;
/**
 * Indicates that navigation was caused by some other action such
 * as using a browser's back/forward buttons and/or manually manipulating
 * the URL in a browser's location bar. This is the default.
 *
 * See https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onpopstate
 * for more information.
 */
var POP = 'POP';

exports.POP = POP;
exports['default'] = {
  PUSH: PUSH,
  REPLACE: REPLACE,
  POP: POP
};
},{}],527:[function(require,module,exports){
"use strict";

exports.__esModule = true;
exports.loopAsync = loopAsync;

function loopAsync(turns, work, callback) {
  var currentTurn = 0;
  var isDone = false;

  function done() {
    isDone = true;
    callback.apply(this, arguments);
  }

  function next() {
    if (isDone) return;

    if (currentTurn < turns) {
      work.call(this, currentTurn++, next, done);
    } else {
      done.apply(this, arguments);
    }
  }

  next();
}
},{}],528:[function(require,module,exports){
(function (process){
/*eslint-disable no-empty */
'use strict';

exports.__esModule = true;
exports.saveState = saveState;
exports.readState = readState;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _warning = require('warning');

var _warning2 = _interopRequireDefault(_warning);

var KeyPrefix = '@@History/';
var QuotaExceededError = 'QuotaExceededError';
var SecurityError = 'SecurityError';

function createKey(key) {
  return KeyPrefix + key;
}

function saveState(key, state) {
  try {
    window.sessionStorage.setItem(createKey(key), JSON.stringify(state));
  } catch (error) {
    if (error.name === SecurityError) {
      // Blocking cookies in Chrome/Firefox/Safari throws SecurityError on any
      // attempt to access window.sessionStorage.
      process.env.NODE_ENV !== 'production' ? _warning2['default'](false, '[history] Unable to save state; sessionStorage is not available due to security settings') : undefined;

      return;
    }

    if (error.name === QuotaExceededError && window.sessionStorage.length === 0) {
      // Safari "private mode" throws QuotaExceededError.
      process.env.NODE_ENV !== 'production' ? _warning2['default'](false, '[history] Unable to save state; sessionStorage is not available in Safari private mode') : undefined;

      return;
    }

    throw error;
  }
}

function readState(key) {
  var json = undefined;
  try {
    json = window.sessionStorage.getItem(createKey(key));
  } catch (error) {
    if (error.name === SecurityError) {
      // Blocking cookies in Chrome/Firefox/Safari throws SecurityError on any
      // attempt to access window.sessionStorage.
      process.env.NODE_ENV !== 'production' ? _warning2['default'](false, '[history] Unable to read state; sessionStorage is not available due to security settings') : undefined;

      return null;
    }
  }

  if (json) {
    try {
      return JSON.parse(json);
    } catch (error) {
      // Ignore invalid JSON.
    }
  }

  return null;
}
}).call(this,require('_process'))
},{"_process":503,"warning":543}],529:[function(require,module,exports){
'use strict';

exports.__esModule = true;
exports.addEventListener = addEventListener;
exports.removeEventListener = removeEventListener;
exports.getHashPath = getHashPath;
exports.replaceHashPath = replaceHashPath;
exports.getWindowPath = getWindowPath;
exports.go = go;
exports.getUserConfirmation = getUserConfirmation;
exports.supportsHistory = supportsHistory;
exports.supportsGoWithoutReloadUsingHash = supportsGoWithoutReloadUsingHash;

function addEventListener(node, event, listener) {
  if (node.addEventListener) {
    node.addEventListener(event, listener, false);
  } else {
    node.attachEvent('on' + event, listener);
  }
}

function removeEventListener(node, event, listener) {
  if (node.removeEventListener) {
    node.removeEventListener(event, listener, false);
  } else {
    node.detachEvent('on' + event, listener);
  }
}

function getHashPath() {
  // We can't use window.location.hash here because it's not
  // consistent across browsers - Firefox will pre-decode it!
  return window.location.href.split('#')[1] || '';
}

function replaceHashPath(path) {
  window.location.replace(window.location.pathname + window.location.search + '#' + path);
}

function getWindowPath() {
  return window.location.pathname + window.location.search + window.location.hash;
}

function go(n) {
  if (n) window.history.go(n);
}

function getUserConfirmation(message, callback) {
  callback(window.confirm(message));
}

/**
 * Returns true if the HTML5 history API is supported. Taken from Modernizr.
 *
 * https://github.com/Modernizr/Modernizr/blob/master/LICENSE
 * https://github.com/Modernizr/Modernizr/blob/master/feature-detects/history.js
 * changed to avoid false negatives for Windows Phones: https://github.com/rackt/react-router/issues/586
 */

function supportsHistory() {
  var ua = navigator.userAgent;
  if ((ua.indexOf('Android 2.') !== -1 || ua.indexOf('Android 4.0') !== -1) && ua.indexOf('Mobile Safari') !== -1 && ua.indexOf('Chrome') === -1 && ua.indexOf('Windows Phone') === -1) {
    return false;
  }
  // FIXME: Work around our browser history not working correctly on Chrome
  // iOS: https://github.com/rackt/react-router/issues/2565
  if (ua.indexOf('CriOS') !== -1) {
    return false;
  }
  return window.history && 'pushState' in window.history;
}

/**
 * Returns false if using go(n) with hash history causes a full page reload.
 */

function supportsGoWithoutReloadUsingHash() {
  var ua = navigator.userAgent;
  return ua.indexOf('Firefox') === -1;
}
},{}],530:[function(require,module,exports){
'use strict';

exports.__esModule = true;
var canUseDOM = !!(typeof window !== 'undefined' && window.document && window.document.createElement);
exports.canUseDOM = canUseDOM;
},{}],531:[function(require,module,exports){
(function (process){
'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _invariant = require('invariant');

var _invariant2 = _interopRequireDefault(_invariant);

var _Actions = require('./Actions');

var _ExecutionEnvironment = require('./ExecutionEnvironment');

var _DOMUtils = require('./DOMUtils');

var _DOMStateStorage = require('./DOMStateStorage');

var _createDOMHistory = require('./createDOMHistory');

var _createDOMHistory2 = _interopRequireDefault(_createDOMHistory);

var _parsePath = require('./parsePath');

var _parsePath2 = _interopRequireDefault(_parsePath);

/**
 * Creates and returns a history object that uses HTML5's history API
 * (pushState, replaceState, and the popstate event) to manage history.
 * This is the recommended method of managing history in browsers because
 * it provides the cleanest URLs.
 *
 * Note: In browsers that do not support the HTML5 history API full
 * page reloads will be used to preserve URLs.
 */
function createBrowserHistory() {
  var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

  !_ExecutionEnvironment.canUseDOM ? process.env.NODE_ENV !== 'production' ? _invariant2['default'](false, 'Browser history needs a DOM') : _invariant2['default'](false) : undefined;

  var forceRefresh = options.forceRefresh;

  var isSupported = _DOMUtils.supportsHistory();
  var useRefresh = !isSupported || forceRefresh;

  function getCurrentLocation(historyState) {
    historyState = historyState || window.history.state || {};

    var path = _DOMUtils.getWindowPath();
    var _historyState = historyState;
    var key = _historyState.key;

    var state = undefined;
    if (key) {
      state = _DOMStateStorage.readState(key);
    } else {
      state = null;
      key = history.createKey();

      if (isSupported) window.history.replaceState(_extends({}, historyState, { key: key }), null, path);
    }

    var location = _parsePath2['default'](path);

    return history.createLocation(_extends({}, location, { state: state }), undefined, key);
  }

  function startPopStateListener(_ref) {
    var transitionTo = _ref.transitionTo;

    function popStateListener(event) {
      if (event.state === undefined) return; // Ignore extraneous popstate events in WebKit.

      transitionTo(getCurrentLocation(event.state));
    }

    _DOMUtils.addEventListener(window, 'popstate', popStateListener);

    return function () {
      _DOMUtils.removeEventListener(window, 'popstate', popStateListener);
    };
  }

  function finishTransition(location) {
    var basename = location.basename;
    var pathname = location.pathname;
    var search = location.search;
    var hash = location.hash;
    var state = location.state;
    var action = location.action;
    var key = location.key;

    if (action === _Actions.POP) return; // Nothing to do.

    _DOMStateStorage.saveState(key, state);

    var path = (basename || '') + pathname + search + hash;
    var historyState = {
      key: key
    };

    if (action === _Actions.PUSH) {
      if (useRefresh) {
        window.location.href = path;
        return false; // Prevent location update.
      } else {
          window.history.pushState(historyState, null, path);
        }
    } else {
      // REPLACE
      if (useRefresh) {
        window.location.replace(path);
        return false; // Prevent location update.
      } else {
          window.history.replaceState(historyState, null, path);
        }
    }
  }

  var history = _createDOMHistory2['default'](_extends({}, options, {
    getCurrentLocation: getCurrentLocation,
    finishTransition: finishTransition,
    saveState: _DOMStateStorage.saveState
  }));

  var listenerCount = 0,
      stopPopStateListener = undefined;

  function listenBefore(listener) {
    if (++listenerCount === 1) stopPopStateListener = startPopStateListener(history);

    var unlisten = history.listenBefore(listener);

    return function () {
      unlisten();

      if (--listenerCount === 0) stopPopStateListener();
    };
  }

  function listen(listener) {
    if (++listenerCount === 1) stopPopStateListener = startPopStateListener(history);

    var unlisten = history.listen(listener);

    return function () {
      unlisten();

      if (--listenerCount === 0) stopPopStateListener();
    };
  }

  // deprecated
  function registerTransitionHook(hook) {
    if (++listenerCount === 1) stopPopStateListener = startPopStateListener(history);

    history.registerTransitionHook(hook);
  }

  // deprecated
  function unregisterTransitionHook(hook) {
    history.unregisterTransitionHook(hook);

    if (--listenerCount === 0) stopPopStateListener();
  }

  return _extends({}, history, {
    listenBefore: listenBefore,
    listen: listen,
    registerTransitionHook: registerTransitionHook,
    unregisterTransitionHook: unregisterTransitionHook
  });
}

exports['default'] = createBrowserHistory;
module.exports = exports['default'];
}).call(this,require('_process'))
},{"./Actions":526,"./DOMStateStorage":528,"./DOMUtils":529,"./ExecutionEnvironment":530,"./createDOMHistory":532,"./parsePath":537,"_process":503,"invariant":542}],532:[function(require,module,exports){
(function (process){
'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _invariant = require('invariant');

var _invariant2 = _interopRequireDefault(_invariant);

var _ExecutionEnvironment = require('./ExecutionEnvironment');

var _DOMUtils = require('./DOMUtils');

var _createHistory = require('./createHistory');

var _createHistory2 = _interopRequireDefault(_createHistory);

function createDOMHistory(options) {
  var history = _createHistory2['default'](_extends({
    getUserConfirmation: _DOMUtils.getUserConfirmation
  }, options, {
    go: _DOMUtils.go
  }));

  function listen(listener) {
    !_ExecutionEnvironment.canUseDOM ? process.env.NODE_ENV !== 'production' ? _invariant2['default'](false, 'DOM history needs a DOM') : _invariant2['default'](false) : undefined;

    return history.listen(listener);
  }

  return _extends({}, history, {
    listen: listen
  });
}

exports['default'] = createDOMHistory;
module.exports = exports['default'];
}).call(this,require('_process'))
},{"./DOMUtils":529,"./ExecutionEnvironment":530,"./createHistory":533,"_process":503,"invariant":542}],533:[function(require,module,exports){
//import warning from 'warning'
'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _deepEqual = require('deep-equal');

var _deepEqual2 = _interopRequireDefault(_deepEqual);

var _AsyncUtils = require('./AsyncUtils');

var _Actions = require('./Actions');

var _createLocation2 = require('./createLocation');

var _createLocation3 = _interopRequireDefault(_createLocation2);

var _runTransitionHook = require('./runTransitionHook');

var _runTransitionHook2 = _interopRequireDefault(_runTransitionHook);

var _parsePath = require('./parsePath');

var _parsePath2 = _interopRequireDefault(_parsePath);

var _deprecate = require('./deprecate');

var _deprecate2 = _interopRequireDefault(_deprecate);

function createRandomKey(length) {
  return Math.random().toString(36).substr(2, length);
}

function locationsAreEqual(a, b) {
  return a.pathname === b.pathname && a.search === b.search &&
  //a.action === b.action && // Different action !== location change.
  a.key === b.key && _deepEqual2['default'](a.state, b.state);
}

var DefaultKeyLength = 6;

function createHistory() {
  var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];
  var getCurrentLocation = options.getCurrentLocation;
  var finishTransition = options.finishTransition;
  var saveState = options.saveState;
  var go = options.go;
  var keyLength = options.keyLength;
  var getUserConfirmation = options.getUserConfirmation;

  if (typeof keyLength !== 'number') keyLength = DefaultKeyLength;

  var transitionHooks = [];

  function listenBefore(hook) {
    transitionHooks.push(hook);

    return function () {
      transitionHooks = transitionHooks.filter(function (item) {
        return item !== hook;
      });
    };
  }

  var allKeys = [];
  var changeListeners = [];
  var location = undefined;

  function getCurrent() {
    if (pendingLocation && pendingLocation.action === _Actions.POP) {
      return allKeys.indexOf(pendingLocation.key);
    } else if (location) {
      return allKeys.indexOf(location.key);
    } else {
      return -1;
    }
  }

  function updateLocation(newLocation) {
    var current = getCurrent();

    location = newLocation;

    if (location.action === _Actions.PUSH) {
      allKeys = [].concat(allKeys.slice(0, current + 1), [location.key]);
    } else if (location.action === _Actions.REPLACE) {
      allKeys[current] = location.key;
    }

    changeListeners.forEach(function (listener) {
      listener(location);
    });
  }

  function listen(listener) {
    changeListeners.push(listener);

    if (location) {
      listener(location);
    } else {
      var _location = getCurrentLocation();
      allKeys = [_location.key];
      updateLocation(_location);
    }

    return function () {
      changeListeners = changeListeners.filter(function (item) {
        return item !== listener;
      });
    };
  }

  function confirmTransitionTo(location, callback) {
    _AsyncUtils.loopAsync(transitionHooks.length, function (index, next, done) {
      _runTransitionHook2['default'](transitionHooks[index], location, function (result) {
        if (result != null) {
          done(result);
        } else {
          next();
        }
      });
    }, function (message) {
      if (getUserConfirmation && typeof message === 'string') {
        getUserConfirmation(message, function (ok) {
          callback(ok !== false);
        });
      } else {
        callback(message !== false);
      }
    });
  }

  var pendingLocation = undefined;

  function transitionTo(nextLocation) {
    if (location && locationsAreEqual(location, nextLocation)) return; // Nothing to do.

    pendingLocation = nextLocation;

    confirmTransitionTo(nextLocation, function (ok) {
      if (pendingLocation !== nextLocation) return; // Transition was interrupted.

      if (ok) {
        // treat PUSH to current path like REPLACE to be consistent with browsers
        if (nextLocation.action === _Actions.PUSH) {
          var prevPath = createPath(location);
          var nextPath = createPath(nextLocation);

          if (nextPath === prevPath) nextLocation.action = _Actions.REPLACE;
        }

        if (finishTransition(nextLocation) !== false) updateLocation(nextLocation);
      } else if (location && nextLocation.action === _Actions.POP) {
        var prevIndex = allKeys.indexOf(location.key);
        var nextIndex = allKeys.indexOf(nextLocation.key);

        if (prevIndex !== -1 && nextIndex !== -1) go(prevIndex - nextIndex); // Restore the URL.
      }
    });
  }

  function push(location) {
    transitionTo(createLocation(location, _Actions.PUSH, createKey()));
  }

  function replace(location) {
    transitionTo(createLocation(location, _Actions.REPLACE, createKey()));
  }

  function goBack() {
    go(-1);
  }

  function goForward() {
    go(1);
  }

  function createKey() {
    return createRandomKey(keyLength);
  }

  function createPath(location) {
    if (location == null || typeof location === 'string') return location;

    var pathname = location.pathname;
    var search = location.search;
    var hash = location.hash;

    var result = pathname;

    if (search) result += search;

    if (hash) result += hash;

    return result;
  }

  function createHref(location) {
    return createPath(location);
  }

  function createLocation(location, action) {
    var key = arguments.length <= 2 || arguments[2] === undefined ? createKey() : arguments[2];

    if (typeof action === 'object') {
      //warning(
      //  false,
      //  'The state (2nd) argument to history.createLocation is deprecated; use a ' +
      //  'location descriptor instead'
      //)

      if (typeof location === 'string') location = _parsePath2['default'](location);

      location = _extends({}, location, { state: action });

      action = key;
      key = arguments[3] || createKey();
    }

    return _createLocation3['default'](location, action, key);
  }

  // deprecated
  function setState(state) {
    if (location) {
      updateLocationState(location, state);
      updateLocation(location);
    } else {
      updateLocationState(getCurrentLocation(), state);
    }
  }

  function updateLocationState(location, state) {
    location.state = _extends({}, location.state, state);
    saveState(location.key, location.state);
  }

  // deprecated
  function registerTransitionHook(hook) {
    if (transitionHooks.indexOf(hook) === -1) transitionHooks.push(hook);
  }

  // deprecated
  function unregisterTransitionHook(hook) {
    transitionHooks = transitionHooks.filter(function (item) {
      return item !== hook;
    });
  }

  // deprecated
  function pushState(state, path) {
    if (typeof path === 'string') path = _parsePath2['default'](path);

    push(_extends({ state: state }, path));
  }

  // deprecated
  function replaceState(state, path) {
    if (typeof path === 'string') path = _parsePath2['default'](path);

    replace(_extends({ state: state }, path));
  }

  return {
    listenBefore: listenBefore,
    listen: listen,
    transitionTo: transitionTo,
    push: push,
    replace: replace,
    go: go,
    goBack: goBack,
    goForward: goForward,
    createKey: createKey,
    createPath: createPath,
    createHref: createHref,
    createLocation: createLocation,

    setState: _deprecate2['default'](setState, 'setState is deprecated; use location.key to save state instead'),
    registerTransitionHook: _deprecate2['default'](registerTransitionHook, 'registerTransitionHook is deprecated; use listenBefore instead'),
    unregisterTransitionHook: _deprecate2['default'](unregisterTransitionHook, 'unregisterTransitionHook is deprecated; use the callback returned from listenBefore instead'),
    pushState: _deprecate2['default'](pushState, 'pushState is deprecated; use push instead'),
    replaceState: _deprecate2['default'](replaceState, 'replaceState is deprecated; use replace instead')
  };
}

exports['default'] = createHistory;
module.exports = exports['default'];
},{"./Actions":526,"./AsyncUtils":527,"./createLocation":534,"./deprecate":535,"./parsePath":537,"./runTransitionHook":538,"deep-equal":539}],534:[function(require,module,exports){
//import warning from 'warning'
'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _Actions = require('./Actions');

var _parsePath = require('./parsePath');

var _parsePath2 = _interopRequireDefault(_parsePath);

function createLocation() {
  var location = arguments.length <= 0 || arguments[0] === undefined ? '/' : arguments[0];
  var action = arguments.length <= 1 || arguments[1] === undefined ? _Actions.POP : arguments[1];
  var key = arguments.length <= 2 || arguments[2] === undefined ? null : arguments[2];

  var _fourthArg = arguments.length <= 3 || arguments[3] === undefined ? null : arguments[3];

  if (typeof location === 'string') location = _parsePath2['default'](location);

  if (typeof action === 'object') {
    //warning(
    //  false,
    //  'The state (2nd) argument to createLocation is deprecated; use a ' +
    //  'location descriptor instead'
    //)

    location = _extends({}, location, { state: action });

    action = key || _Actions.POP;
    key = _fourthArg;
  }

  var pathname = location.pathname || '/';
  var search = location.search || '';
  var hash = location.hash || '';
  var state = location.state || null;

  return {
    pathname: pathname,
    search: search,
    hash: hash,
    state: state,
    action: action,
    key: key
  };
}

exports['default'] = createLocation;
module.exports = exports['default'];
},{"./Actions":526,"./parsePath":537}],535:[function(require,module,exports){
//import warning from 'warning'

"use strict";

exports.__esModule = true;
function deprecate(fn) {
  return fn;
  //return function () {
  //  warning(false, '[history] ' + message)
  //  return fn.apply(this, arguments)
  //}
}

exports["default"] = deprecate;
module.exports = exports["default"];
},{}],536:[function(require,module,exports){
"use strict";

exports.__esModule = true;
function extractPath(string) {
  var match = string.match(/^https?:\/\/[^\/]*/);

  if (match == null) return string;

  return string.substring(match[0].length);
}

exports["default"] = extractPath;
module.exports = exports["default"];
},{}],537:[function(require,module,exports){
(function (process){
'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _warning = require('warning');

var _warning2 = _interopRequireDefault(_warning);

var _extractPath = require('./extractPath');

var _extractPath2 = _interopRequireDefault(_extractPath);

function parsePath(path) {
  var pathname = _extractPath2['default'](path);
  var search = '';
  var hash = '';

  process.env.NODE_ENV !== 'production' ? _warning2['default'](path === pathname, 'A path must be pathname + search + hash only, not a fully qualified URL like "%s"', path) : undefined;

  var hashIndex = pathname.indexOf('#');
  if (hashIndex !== -1) {
    hash = pathname.substring(hashIndex);
    pathname = pathname.substring(0, hashIndex);
  }

  var searchIndex = pathname.indexOf('?');
  if (searchIndex !== -1) {
    search = pathname.substring(searchIndex);
    pathname = pathname.substring(0, searchIndex);
  }

  if (pathname === '') pathname = '/';

  return {
    pathname: pathname,
    search: search,
    hash: hash
  };
}

exports['default'] = parsePath;
module.exports = exports['default'];
}).call(this,require('_process'))
},{"./extractPath":536,"_process":503,"warning":543}],538:[function(require,module,exports){
(function (process){
'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _warning = require('warning');

var _warning2 = _interopRequireDefault(_warning);

function runTransitionHook(hook, location, callback) {
  var result = hook(location, callback);

  if (hook.length < 2) {
    // Assume the hook runs synchronously and automatically
    // call the callback with the return value.
    callback(result);
  } else {
    process.env.NODE_ENV !== 'production' ? _warning2['default'](result === undefined, 'You should not "return" in a transition hook with a callback argument; call the callback instead') : undefined;
  }
}

exports['default'] = runTransitionHook;
module.exports = exports['default'];
}).call(this,require('_process'))
},{"_process":503,"warning":543}],539:[function(require,module,exports){
var pSlice = Array.prototype.slice;
var objectKeys = require('./lib/keys.js');
var isArguments = require('./lib/is_arguments.js');

var deepEqual = module.exports = function (actual, expected, opts) {
  if (!opts) opts = {};
  // 7.1. All identical values are equivalent, as determined by ===.
  if (actual === expected) {
    return true;

  } else if (actual instanceof Date && expected instanceof Date) {
    return actual.getTime() === expected.getTime();

  // 7.3. Other pairs that do not both pass typeof value == 'object',
  // equivalence is determined by ==.
  } else if (!actual || !expected || typeof actual != 'object' && typeof expected != 'object') {
    return opts.strict ? actual === expected : actual == expected;

  // 7.4. For all other Object pairs, including Array objects, equivalence is
  // determined by having the same number of owned properties (as verified
  // with Object.prototype.hasOwnProperty.call), the same set of keys
  // (although not necessarily the same order), equivalent values for every
  // corresponding key, and an identical 'prototype' property. Note: this
  // accounts for both named and indexed properties on Arrays.
  } else {
    return objEquiv(actual, expected, opts);
  }
}

function isUndefinedOrNull(value) {
  return value === null || value === undefined;
}

function isBuffer (x) {
  if (!x || typeof x !== 'object' || typeof x.length !== 'number') return false;
  if (typeof x.copy !== 'function' || typeof x.slice !== 'function') {
    return false;
  }
  if (x.length > 0 && typeof x[0] !== 'number') return false;
  return true;
}

function objEquiv(a, b, opts) {
  var i, key;
  if (isUndefinedOrNull(a) || isUndefinedOrNull(b))
    return false;
  // an identical 'prototype' property.
  if (a.prototype !== b.prototype) return false;
  //~~~I've managed to break Object.keys through screwy arguments passing.
  //   Converting to array solves the problem.
  if (isArguments(a)) {
    if (!isArguments(b)) {
      return false;
    }
    a = pSlice.call(a);
    b = pSlice.call(b);
    return deepEqual(a, b, opts);
  }
  if (isBuffer(a)) {
    if (!isBuffer(b)) {
      return false;
    }
    if (a.length !== b.length) return false;
    for (i = 0; i < a.length; i++) {
      if (a[i] !== b[i]) return false;
    }
    return true;
  }
  try {
    var ka = objectKeys(a),
        kb = objectKeys(b);
  } catch (e) {//happens when one is a string literal and the other isn't
    return false;
  }
  // having the same number of owned properties (keys incorporates
  // hasOwnProperty)
  if (ka.length != kb.length)
    return false;
  //the same set of keys (although not necessarily the same order),
  ka.sort();
  kb.sort();
  //~~~cheap key test
  for (i = ka.length - 1; i >= 0; i--) {
    if (ka[i] != kb[i])
      return false;
  }
  //equivalent values for every corresponding key, and
  //~~~possibly expensive deep test
  for (i = ka.length - 1; i >= 0; i--) {
    key = ka[i];
    if (!deepEqual(a[key], b[key], opts)) return false;
  }
  return typeof a === typeof b;
}

},{"./lib/is_arguments.js":540,"./lib/keys.js":541}],540:[function(require,module,exports){
var supportsArgumentsClass = (function(){
  return Object.prototype.toString.call(arguments)
})() == '[object Arguments]';

exports = module.exports = supportsArgumentsClass ? supported : unsupported;

exports.supported = supported;
function supported(object) {
  return Object.prototype.toString.call(object) == '[object Arguments]';
};

exports.unsupported = unsupported;
function unsupported(object){
  return object &&
    typeof object == 'object' &&
    typeof object.length == 'number' &&
    Object.prototype.hasOwnProperty.call(object, 'callee') &&
    !Object.prototype.propertyIsEnumerable.call(object, 'callee') ||
    false;
};

},{}],541:[function(require,module,exports){
exports = module.exports = typeof Object.keys === 'function'
  ? Object.keys : shim;

exports.shim = shim;
function shim (obj) {
  var keys = [];
  for (var key in obj) keys.push(key);
  return keys;
}

},{}],542:[function(require,module,exports){
(function (process){
/**
 * Copyright 2013-2015, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 */

'use strict';

/**
 * Use invariant() to assert state which your program assumes to be true.
 *
 * Provide sprintf-style format (only %s is supported) and arguments
 * to provide information about what broke and what you were
 * expecting.
 *
 * The invariant message will be stripped in production, but the invariant
 * will remain to ensure logic does not differ in production.
 */

var invariant = function(condition, format, a, b, c, d, e, f) {
  if (process.env.NODE_ENV !== 'production') {
    if (format === undefined) {
      throw new Error('invariant requires an error message argument');
    }
  }

  if (!condition) {
    var error;
    if (format === undefined) {
      error = new Error(
        'Minified exception occurred; use the non-minified dev environment ' +
        'for the full error message and additional helpful warnings.'
      );
    } else {
      var args = [a, b, c, d, e, f];
      var argIndex = 0;
      error = new Error(
        format.replace(/%s/g, function() { return args[argIndex++]; })
      );
      error.name = 'Invariant Violation';
    }

    error.framesToPop = 1; // we don't care about invariant's own frame
    throw error;
  }
};

module.exports = invariant;

}).call(this,require('_process'))
},{"_process":503}],543:[function(require,module,exports){
(function (process){
/**
 * Copyright 2014-2015, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 */

'use strict';

/**
 * Similar to invariant but only logs a warning if the condition is not met.
 * This can be used to log issues in development environments in critical
 * paths. Removing the logging code for production environments will keep the
 * same logic and follow the same code paths.
 */

var warning = function() {};

if (process.env.NODE_ENV !== 'production') {
  warning = function(condition, format, args) {
    var len = arguments.length;
    args = new Array(len > 2 ? len - 2 : 0);
    for (var key = 2; key < len; key++) {
      args[key - 2] = arguments[key];
    }
    if (format === undefined) {
      throw new Error(
        '`warning(condition, format, ...args)` requires a warning ' +
        'message argument'
      );
    }

    if (format.length < 10 || (/^[s\W]*$/).test(format)) {
      throw new Error(
        'The warning format should be able to uniquely identify this ' +
        'warning. Please, use a more descriptive format than: ' + format
      );
    }

    if (!condition) {
      var argIndex = 0;
      var message = 'Warning: ' +
        format.replace(/%s/g, function() {
          return args[argIndex++];
        });
      if (typeof console !== 'undefined') {
        console.error(message);
      }
      try {
        // This error was thrown as a convenience so that you can use this stack
        // to find the callsite that caused this warning to fire.
        throw new Error(message);
      } catch(x) {}
    }
  };
}

module.exports = warning;

}).call(this,require('_process'))
},{"_process":503}],544:[function(require,module,exports){
;(function() {
  'use strict';

  var React;
  var ReactDOM;
  if (typeof require !== 'undefined') {
    React = require('react');
    ReactDOM = require('react-dom');
  } else if (typeof window !== 'undefined') {
    React = window.React;
    ReactDOM = window.ReactDOM;
  }

  function ModalFormAnchor() {
    React.Component.apply(this, arguments);
  }

  ModalFormAnchor.prototype = Object.assign(Object.create(React.Component.prototype), {
    componentDidMount: function() {
      this.root = document.createElement('div');
      this.root.classList.add('modal-form-anchor-root');
      document.body.appendChild(this.root);
      this.renderInstance()
    },

    componentWillUnmount: function() {
      ReactDOM.unmountComponentAtNode(this.root);
      this.root.parentNode.removeChild(this.root);
      this.root = null;
      this.instance = null;
    },

    componentDidUpdate: function() {
      this.renderInstance();
    },

    renderInstance: function() {
      var children = this.props.children || React.createElement('noscript');
      this.instance = ReactDOM.render(children, this.root);
    },

    render: function() {
      return React.createElement('noscript', {
        className: 'modal-form-anchor'
      });
    }
  });

  if (typeof module !== 'undefined') {
    module.exports = ModalFormAnchor;
  } else if (typeof window !== 'undefined') {
    window.ZUIModalFormAnchor = ModalFormAnchor;
  }
}());

},{"react":"react","react-dom":"react-dom"}],545:[function(require,module,exports){
;(function() {
  'use strict';

  var React;
  var ModalFormAnchor;
  if (typeof require !== 'undefined') {
    React = require('react');
    ModalFormAnchor = require('./anchor');
  } else if (typeof window !== 'undefined') {
    React = window.React;
    ModalFormAnchor = window.ZUIModalFormAnchor;
  }

  var ESC_KEY = 27;

  var UNDERLAY_STYLE = {
    left: 0,
    position: 'absolute',
    top: 0
  };

  var FORM_STYLE = {
    position: 'absolute'
  };

  function ModalFormBase() {
    React.Component.apply(this, arguments);
    this.reposition = this.reposition.bind(this);
    this.handleGlobalKeyDown = this.handleGlobalKeyDown.bind(this);
    this.handleGlobalNavigation = this.handleGlobalNavigation.bind(this);
    this.state = {
      underlayWidth: 0,
      underlayHeight: 0
    };
  }

  ModalFormBase.locationChangeEvent = 'locationchange';

  ModalFormBase.propTypes = {
    tag: React.PropTypes.node,
    required: React.PropTypes.bool,
    underlayStyle: React.PropTypes.object,
    persistAcrossLocations: React.PropTypes.bool,
    loose: React.PropTypes.bool,
    onReposition: React.PropTypes.func,
    onSubmit: React.PropTypes.func,
    onCancel: React.PropTypes.func
  };

  ModalFormBase.defaultProps = {
    tag: 'form',
    required: false,
    underlayStyle: {},
    persistAcrossLocations: false,
    loose: false,
    onReposition: Function.prototype,
    onSubmit: Function.prototype,
    onCancel: Function.prototype
  };

  ModalFormBase.prototype = Object.assign(Object.create(React.Component.prototype), {
    _originalScrollPosition: null,

    componentWillMount: function() {
      if (typeof pageXOffset !== 'undefined') {
        // Mounting a modal with `autoFocus` content scrolls to the top before it repositions.
        this._originalScrollPosition = [pageXOffset, pageYOffset];
      }
    },

    componentDidMount: function() {
      addEventListener('scroll', this.reposition);
      addEventListener('resize', this.reposition);
      addEventListener('keydown', this.handleGlobalKeyDown);
      addEventListener('hashchange', this.handleGlobalNavigation);
      addEventListener(ModalFormBase.locationChangeEvent, this.handleGlobalNavigation);
      this.reposition();
      if (this._originalScrollPosition !== null) {
        scrollTo.apply(null, this._originalScrollPosition);
      }
    },

    componentWillUnmount: function() {
      removeEventListener('scroll', this.reposition);
      removeEventListener('resize', this.reposition);
      removeEventListener('keydown', this.handleGlobalKeyDown);
      removeEventListener('hashchange', this.handleGlobalNavigation);
      removeEventListener(ModalFormBase.locationChangeEvent, this.handleGlobalNavigation);
    },

    handleGlobalKeyDown: function (event) {
      if (event.which === ESC_KEY && !this.props.required) {
        this.props.onCancel.apply(null, arguments);
      }
    },

    handleGlobalNavigation: function() {
      if (!this.props.required && !this.props.persistAcrossLocations) {
        this.props.onCancel.apply(null, arguments);
      }
    },

    getUnderlayChildren: function() {
      var action;
      var onSubmit;
      if (this.props.tag === 'form') {
        action = 'POST';
        onSubmit = this.handleFormSubmit.bind(this)
      }

      return React.createElement(this.props.tag, {
        ref: 'form',
        className: ('modal-form ' + (this.props.className || '')).trim(),
        action: action,
        style: Object.assign({}, FORM_STYLE, this.props.style),
        onSubmit: onSubmit
      }, this.props.children);
    },

    render: function() {
      if (this.props.loose) {
        return this.renderLoose();
      } else {
        return this.renderWithAnchor();
      }
    },

    renderLoose: function() {
      var underlaySize = {
        width: this.state.underlayWidth + 'px',
        height: this.state.underlayHeight + 'px'
      };
      return React.createElement.apply(React, ['div', {
        ref: 'underlay',
        className: ('modal-form-underlay ' + (this.props.className || '')).trim(),
        style: Object.assign({}, UNDERLAY_STYLE, underlaySize, this.props.underlayStyle),
        onClick: this.handleUnderlayClick.bind(this)
      }].concat(this.getUnderlayChildren()));
    },

    renderWithAnchor: function() {
      var looseRenderResult = this.renderLoose.apply(this, arguments);
      return React.createElement(ModalFormAnchor, null, looseRenderResult);
    },

    componentDidUpdate: function() {
      this.reposition();
    },

    reposition: function() {
      var formRect = this.refs.form.getBoundingClientRect();
      var formStyle = getComputedStyle(this.refs.form);
      var formRight = pageXOffset + formRect.right + parseFloat(formStyle.marginRight);
      var formBottom = pageYOffset + formRect.bottom + parseFloat(formStyle.marginBottom);
      var totalWidth = Math.max(document.documentElement.offsetWidth, innerWidth, formRight);
      var totalHeight = Math.max(document.documentElement.offsetHeight, innerHeight, formBottom);
      if (totalWidth !== this.state.underlayWidth || totalHeight !== this.state.underlayHeight) {
        this.setState({
          underlayWidth: totalWidth,
          underlayHeight: totalHeight
        });
      }
      this.props.onReposition();
    },

    handleFormSubmit: function(event) {
      event.preventDefault();
      this.props.onSubmit.apply(null, arguments);
    },

    handleUnderlayClick: function(event) {
      if (!this.props.required && event.target === this.refs.underlay) {
        this.props.onCancel.apply(null, arguments);
      }
    }
  });

  if (typeof module !== 'undefined') {
    module.exports = ModalFormBase;
  } else if (typeof window !== 'undefined') {
    window.ZUIModalFormBase = ModalFormBase;
  }
}());

},{"./anchor":544,"react":"react"}],546:[function(require,module,exports){
;(function() {
  'use strict';

  var React;
  var ReactDOM;
  var ModalFormBase;
  if (typeof require !== 'undefined') {
    React = require('react');
    ReactDOM = require('react-dom');
    ModalFormBase = require('./base');
  } else if (typeof window !== 'undefined') {
    React = window.React;
    ReactDOM = window.ReactDOM;
    ModalFormBase = window.ZUIModalFormBase;
  }

  var ModalDialog = React.createClass({
    statics: {
      alert: function(message, props) {
        var container = document.createElement('div');
        document.body.appendChild(container);

        var promise = new Promise(function(resolve, reject) {
          function handleSubmit() {
            resolve.apply(null, arguments);
            if (props && props.onSubmit !== undefined) {
              props.onSubmit.apply(null, arguments);
            }
          }

          function handleCancel() {
            reject.apply(null, arguments);
            if (props && props.onCancel !== undefined) {
              props.onCancel.apply(null, arguments);
            }
          }

          ReactDOM.render(React.createElement(ModalDialog, Object.assign({}, props, {
            onSubmit: handleSubmit,
            onCancel: handleCancel
          }), message), container);
        });

        promise.catch(Function.prototype).then(function() {
          ReactDOM.unmountComponentAtNode(container);
          container.parentNode.removeChild(container);
        });

        return promise;
      }
    },

    propTypes: Object.assign({}, ModalFormBase.propTypes, {
      closeButton: React.PropTypes.bool,
      left: React.PropTypes.number,
      top: React.PropTypes.number
    }),

    getDefaultProps: function() {
      return Object.assign({}, ModalFormBase.defaultProps, {
        closeButton: false,
        left: 0.5,
        top: 0.4
      });
    },

    getInitialState: function() {
      return {
        scrollX: pageXOffset,
        scrollY: pageYOffset,
        dialogLeft: 0,
        dialogTop: 0
      };
    },

    render: function() {
      var positionStyle = {
        left: this.state.dialogLeft,
        top: this.state.dialogTop
      };

      var modalProps = Object.assign({
        ref: 'modal',
        role: 'dialog'
      }, this.props, {
        className: ('modal-dialog ' + (this.props.className || '')).trim(),
        style: Object.assign({}, positionStyle, this.props.style),
        onReposition: this.reposition
      });

      var closeButton;
      if (this.props.closeButton) {
        closeButton = React.createElement('button', {
          type: 'button',
          className: 'modal-dialog-toolbar-button modal-dialog-close-button',
          title: 'Close',
          onClick: this.props.onCancel
        }, '');
      }

      var toolbar = React.createElement('div', {
        className: 'modal-dialog-toolbar'
      }, closeButton);

      return React.createElement(ModalFormBase, modalProps, toolbar, this.props.children);
    },

    reposition: function() {
      var form = this.refs.modal && this.refs.modal.refs.form;
      if (form !== undefined) {
        var horizontal = this.props.left * innerWidth;
        var vertical = this.props.top * innerHeight;
        var left = this.state.scrollX + Math.max(0, horizontal - (this.props.left * form.offsetWidth));
        var top = this.state.scrollY + Math.max(0, vertical - (this.props.top * form.offsetHeight));
        if (left !== this.state.dialogLeft || top !== this.state.dialogTop) {
          this.setState({
            dialogLeft: left,
            dialogTop: top
          });
        }
      }
    }
  });

  if (typeof module !== 'undefined') {
    module.exports = ModalDialog;
  } else if (typeof window !== 'undefined') {
    window.ZUIModalDialog = ModalDialog;
  }
}());

},{"./base":545,"react":"react","react-dom":"react-dom"}],547:[function(require,module,exports){
;(function() {
  'use strict';

  var React;
  var ReactDOM;
  var ModalFormBase;
  if (typeof require !== 'undefined') {
    React = require('react');
    ReactDOM = require('react-dom');
    ModalFormBase = require('./base');
  } else if (typeof window !== 'undefined') {
    React = window.React;
    ReactDOM = window.ReactDOM;
    ModalFormBase = window.ZUIModalFormBase;
  }

  var MEDIA_SELECTOR = 'img, video';

  var POINTER_STYLE = {
    position: 'absolute'
  };

  function StickyModalForm() {
    ModalFormBase.apply(this, arguments);
  }

  StickyModalForm.propTypes = Object.assign({}, ModalFormBase.propTypes, {
    side: React.PropTypes.oneOf([
      'left',
      'right',
      'top',
      'bottom'
    ]),
    pointerStyle: React.PropTypes.object
  });

  StickyModalForm.defaultProps = Object.assign({}, ModalFormBase.defaultProps, {
    side: 'bottom',
    pointerStyle: {}
  });

  StickyModalForm.prototype = Object.assign(Object.create(ModalFormBase.prototype), {
    componentDidMount: function() {
      ModalFormBase.prototype.componentDidMount.apply(this, arguments);
      // TODO: Figure out a way to add a global load event listener.
      Array.prototype.forEach.call(document.querySelectorAll(MEDIA_SELECTOR), function(media) {
        media.addEventListener('load', this.reposition)
      }, this);
    },

    componentWillUnmount: function() {
      ModalFormBase.prototype.componentWillUnmount.apply(this, arguments);
      Array.prototype.forEach.call(document.querySelectorAll(MEDIA_SELECTOR), function(media) {
        media.removeEventListener('load', this.reposition)
      }, this);
    },

    reposition: function(props) {
      ModalFormBase.prototype.reposition.apply(this, arguments);

      if (props === undefined || props instanceof Event) {
        props = this.props;
      }

      var viewport = {
        width: innerWidth,
        height: innerHeight
      };

      var anchor = ReactDOM.findDOMNode(this).parentNode;
      var anchorRect = this.getRectWithMargin(anchor);

      var form = this.refs.form;
      form.style.left = '';
      form.style.top = '';
      var formRect = this.getRectWithMargin(form);
      var formPosition = this.getPosition[props.side].call(this, formRect, anchorRect, viewport);
      form.style.left = pageXOffset + formPosition.left + 'px';
      form.style.top = pageYOffset + formPosition.top + 'px';

      var pointer = this.refs.pointer;
      pointer.style.left = '';
      pointer.style.top = '';
      var pointerRect = this.getRectWithMargin(pointer);
      var pointerPosition = this.getPosition[props.side].call(this, pointerRect, anchorRect, viewport);
      pointer.style.left = pageXOffset + pointerPosition.left + 'px';
      pointer.style.top = pageYOffset + pointerPosition.top + 'px';
    },

    getRectWithMargin: function(domNode) {
      var rect = domNode.getBoundingClientRect();
      var style = getComputedStyle(domNode);
      var result = {
        top: rect.top - (parseFloat(style.marginTop) || 0),
        right: rect.right + (parseFloat(style.marginRight) || 0),
        bottom: rect.bottom + (parseFloat(style.marginBottom) || 0),
        left: rect.left - (parseFloat(style.marginLeft) || 0)
      };
      result.width = result.right - result.left,
      result.height = result.bottom - result.top
      return result;
    },

    getHorizontallyCenteredLeft: function(movableRect, anchorRect, viewport) {
      var left = anchorRect.left - ((movableRect.width - anchorRect.width) / 2);
      left = Math.max(left, -1 * pageXOffset);
      return left;
    },

    getVerticalCenteredTop: function(movableRect, anchorRect, viewport) {
      var top = anchorRect.top - ((movableRect.height - anchorRect.height) / 2);
      top = Math.max(top, -1 * pageYOffset);
      return top;
    },

    getPosition: {
      left: function(movableRect, anchorRect, viewport) {
        return {
          left: anchorRect.left - movableRect.width,
          top: this.getVerticalCenteredTop.apply(this, arguments)
        }
      },

      right: function(movableRect, anchorRect, viewport) {
        return {
          left: anchorRect.right,
          top: this.getVerticalCenteredTop.apply(this, arguments)
        }
      },

      top: function(movableRect, anchorRect, viewport) {
        return {
          left: this.getHorizontallyCenteredLeft.apply(this, arguments),
          top: anchorRect.top - movableRect.height,
        };
      },

      bottom: function(movableRect, anchorRect, viewport) {
        return {
          left: this.getHorizontallyCenteredLeft.apply(this, arguments),
          top: anchorRect.bottom,
        };
      }
    },

    getUnderlayChildren: function() {
      var pointer = React.createElement('div', {
        ref: 'pointer',
        className: ('modal-form-pointer ' + (this.props.className || '')).trim(),
        style: Object.assign({}, POINTER_STYLE, this.props.pointerStyle)
      });
      var originalChildren = ModalFormBase.prototype.getUnderlayChildren.apply(this, arguments);
      return [].concat(originalChildren, pointer);
    }
  });

  if (typeof module !== 'undefined') {
    module.exports = StickyModalForm;
  } else if (typeof window !== 'undefined') {
    window.ZUIStickyModalForm = StickyModalForm;
  }
}());

},{"./base":545,"react":"react","react-dom":"react-dom"}],548:[function(require,module,exports){
;(function() {
  'use strict';

  var React;
  var ReactDOM;
  var StickyModalForm;
  if (typeof require !== 'undefined') {
    React = require('react');
    ReactDOM = require('react-dom');
    StickyModalForm = require('./sticky');
  } else if (typeof window !== 'undefined') {
    React = window.React;
    ReactDOM = window.ReactDOM;
    StickyModalForm = window.ZUIStickyModalForm;
  }

  var TriggeredModalForm = React.createClass({
    propTypes: Object.assign({}, StickyModalForm.propTypes, {
      triggerTag: React.PropTypes.string,
      trigger: React.PropTypes.oneOfType([
        React.PropTypes.element,
        React.PropTypes.string
      ]),
      triggerProps: React.PropTypes.object,
      defaultOpen: React.PropTypes.bool
    }),

    getDefaultProps: function() {
      return Object.assign({}, StickyModalForm.defaultProps, {
        triggerTag: 'button',
        trigger: '',
        triggerProps: {},
        defaultOpen: false
      });
    },

    getInitialState: function() {
      return {
        open: this.props.defaultOpen
      };
    },

    open: function() {
      this.setState({
        open: true
      });
    },

    close: function() {
      this.setState({
        open: false
      }, function() {
        var trigger = ReactDOM.findDOMNode(this);
        if (trigger.focus) {
          trigger.focus();
        }
      });
    },

    render: function() {
      var modal = null;
      if (this.state.open) {
        var modalProps = Object.assign({}, this.props, {
          ref: 'modal',
          onSubmit: this.handleSubmit,
          onCancel: this.handleCancel
        });
        modal = React.createElement(StickyModalForm, modalProps, this.props.children);
      }

      var triggerProps = Object.assign({
        ref: 'trigger',
        type: this.props.triggerTag === 'button' ? 'button' : null,
        'aria-haspopup': true,
        'aria-expanded': this.state.open
      }, this.props.triggerProps, {
        className: [
          'modal-form-trigger',
          this.props.className || '',
          this.props.triggerProps && this.props.triggerProps.className || ''
        ].join(' ').trim(),
        onClick: this.handleClick
      });

      return React.createElement(this.props.triggerTag, triggerProps, this.props.trigger, modal);
    },

    handleClick: function() {
      this.open();
      if (this.props.triggerProps && this.props.triggerProps.onClick) {
        this.props.triggerProps.onClick.apply(null, arguments);
      }
    },

    handleSubmit: function() {
      this.close();
      if (this.props.onSubmit) {
        this.props.onSubmit.apply(null, arguments);
      }
    },

    handleCancel: function() {
      this.close();
      if (this.props.onCancel) {
        this.props.onCancel.apply(null, arguments);
      }
    },
  });

  if (typeof module !== 'undefined') {
    module.exports = TriggeredModalForm;
  } else if (typeof window !== 'undefined') {
    window.ZUITriggeredModalForm = TriggeredModalForm;
  }
}());

},{"./sticky":547,"react":"react","react-dom":"react-dom"}],549:[function(require,module,exports){
var JSONAPIClient = require('json-api-client');
var config = require('./config');

var apiClient = new JSONAPIClient(config.host + '/api', {
  'Content-Type': 'application/json',
  'Accept': 'application/vnd.api+json; version=1',
});

apiClient.handleError = function(response) {
  var errorMessage;
  if (response instanceof Error) {
    throw response;
  } else if (typeof response.body === 'object') {
    if (response.body.error) {
      errorMessage = response.body.error;
      if (response.body.error_description) {
        errorMessage += ' ' + response.error_description;
      }
    } else if (Array.isArray(response.body.errors)) {
      errorMessage = response.body.errors.map(function(error) {
        if (typeof error.message === 'string') {
          return error.message;
        } else if (typeof error.message === 'object') {
          return Object.keys(error.message).map(function(key) {
            return key + ' ' + error.message[key];
          }).join('\n');
        }
      }).join('\n');
    } else {
      errorMessage = 'Unknown error (bad response body)';
    }
  } else if (response.text.indexOf('<!DOCTYPE') !== -1) {
    // Manually set a reasonable error when we get HTML back (currently 500s will do this).
    errorMessage = [
      'There was a problem on the server.',
      reponse.req.url,
      response.status,
      response.statusText,
    ].join(' ');
  } else {
    errorMessage = 'Unknown error (bad response)';
  }

  throw new Error(errorMessage);
};

module.exports = apiClient;

},{"./config":551,"json-api-client":556}],550:[function(require,module,exports){
var JSONAPIClient = require('json-api-client');
var Model = JSONAPIClient.Model;
var makeHTTPRequest = JSONAPIClient.makeHTTPRequest;
var config = require('./config');
var apiClient = require('./api-client');

// Use this to override the default API-specific headers.
var JSON_HEADERS = {
  'Content-Type': 'application/json',
  'Accept': 'application/json',
};

// We don't want to wait until the token is already expired before refreshing it.
var TOKEN_EXPIRATION_ALLOWANCE = 10 * 1000;

module.exports = new Model({
  _currentUserPromise: null,
  _bearerToken: '',
  _bearerRefreshTimeout: NaN,

  _getAuthToken: function() {
    console.log('Getting auth token');
    var url = config.host + '/users/sign_in/?now=' + Date.now();
    return makeHTTPRequest('GET', url, null, JSON_HEADERS)
      .then(function(response) {
        var authToken = response.header['x-csrf-token'];
        console.info('Got auth token', authToken.slice(-6));
        return authToken;
      })
      .catch(function(response) {
        console.error('Failed to get auth token');
        apiClient.handleError(response);
      });
  },

  _getBearerToken: function() {
    console.log('Getting bearer token');
    if (this._bearerToken) {
      console.info('Already had a bearer token', this._bearerToken);
      return Promise.resolve(this._bearerToken);
    } else {
      var url = config.host + '/oauth/token';

      var data = {
        'grant_type': 'password',
        'client_id': config.clientAppID,
      };

      return makeHTTPRequest('POST', url, data, JSON_HEADERS)
        .then(function(request) {
          var token = this._handleNewBearerToken(request);
          console.info('Got bearer token', token.slice(-6));
          return token;
        }.bind(this))
        .catch(function(request) {
          // You're probably not signed in.
          console.error('Failed to get bearer token');
          return apiClient.handleError(request);
        });
    }
  },

  _handleNewBearerToken: function(request) {
    var response = JSON.parse(request.text);

    this._bearerToken = response.access_token;
    apiClient.headers.Authorization = 'Bearer ' + this._bearerToken;

    var refresh = this._refreshBearerToken.bind(this, response.refresh_token);
    var timeToRefresh = (response.expires_in * 1000) - TOKEN_EXPIRATION_ALLOWANCE;
    this._bearerRefreshTimeout = setTimeout(refresh, timeToRefresh);

    return this._bearerToken;
  },

  _refreshBearerToken: function(refreshToken) {
    var url = config.host + '/oauth/token';

    var data = {
      grant_type: 'refresh_token',
      refresh_token: refreshToken,
      client_id: config.clientAppID,
    };

    return makeHTTPRequest('POST', url, data, JSON_HEADERS)
      .then(function(request) {
        var token = this._handleNewBearerToken(request);
        console.info('Refreshed bearer token', token.slice(-6));
      }.bind(this))
      .catch(function(request) {
        console.error('Failed to refresh bearer token');
        apiClient.handleError(request);
      });
  },

  _deleteBearerToken: function() {
    this._bearerToken = '';
    delete apiClient.headers.Authorization;
    clearTimeout(this._bearerRefreshTimeout);
    console.log('Deleted bearer token');
  },

  _getSession: function() {
    console.log('Getting session');
    return apiClient.get('/me')
      .then(function(users) {
        var user = users[0];
        console.info('Got session', user.login, user.id);
        return user;
      })
      .catch(function(error) {
        console.error('Failed to get session');
        throw error;
      });
  },

  register: function(given) {
    var originalArguments = arguments;
    return this.checkCurrent().then(function(user) {
      if (user) {
        return this.signOut().then(function() {
          return this.register.apply(this, originalArguments);
        }.bind(this));
      } else {
        console.log('Registering new account', given.login);
        var registrationRequest = this._getAuthToken().then(function(token) {
          var data = {
            authenticity_token: token,
            user: {
              login: given.login,
              email: given.email,
              password: given.password,
              credited_name: given.credited_name,
              global_email_communication: given.global_email_communication,
              project_id: given.project_id,
              beta_email_communication: given.beta_email_communication,
              project_email_communication: given.project_email_communication,
            },
          };

          // This URL is outside the API, but it actually returns a JSON-API response, so handle it with the client.
          return apiClient.post('/../users', data, JSON_HEADERS)
            .then(function() {
              return this._getBearerToken().then(function() {
                return this._getSession().then(function(user) {
                  console.info('Registered account', user.login, user.id);
                  return user;
                });
              }.bind(this));
            }.bind(this))
            .catch(function(error) {
              console.error('Failed to register');
              throw error;
            });
        }.bind(this));

        this.update({
          _currentUserPromise: registrationRequest.catch(function() {
            return null;
          }),
        });

        return registrationRequest;
      }
    }.bind(this));
  },

  checkCurrent: function() {
    if (!this._currentUserPromise) {
      console.log('Checking current user');
      this.update({
        _currentUserPromise: this._getBearerToken()
          .then(function() {
            return this._getSession();
          }.bind(this))
          .catch(function() {
            // Nobody's signed in. This isn't an error.
            console.info('No current user');
            return null;
          }),
      });
    }

    return this._currentUserPromise;
  },

  signIn: function(credentials) {
    var originalArguments = arguments;
    return this.checkCurrent().then(function(user) {
      if (user) {
        return this.signOut().then(function() {
          return this.signIn.apply(this, originalArguments);
        }.bind(this));
      } else {
        console.log('Signing in', credentials.login);
        var signInRequest = this._getAuthToken().then(function(token) {
          var url = config.host + '/users/sign_in';

          var data = {
            authenticity_token: token,
            user: {
              login: credentials.login,
              password: credentials.password,
              remember_me: true,
            },
          };

          return makeHTTPRequest('POST', url, data, JSON_HEADERS)
            .then(function() {
              return this._getBearerToken().then(function() {
                return this._getSession().then(function(user) {
                  console.info('Signed in', user.login, user.id);
                  return user;
                }.bind(this));
              }.bind(this));
            }.bind(this))
            .catch(function(request) {
              console.error('Failed to sign in');
              apiClient.handleError(request);
            });
        }.bind(this));

        this.update({
          _currentUserPromise: signInRequest.catch(function() {
            return null;
          }),
        });

        return signInRequest;
      }
    }.bind(this));
  },

  changePassword: function(given) {
    return this.checkCurrent().then(function(user) {
      if (user) {
        return this._getAuthToken().then(function(token) {
          var data = {
            authenticity_token: token,
            user: {
              current_password: given.current,
              password: given.replacement,
              password_confirmation: given.replacement,
            },
          };

          return apiClient.put('/../users', data, JSON_HEADERS)
            .then(function() {
              // Rough, but it'll do for now. Without signing out and back in, the session is lost.
              return this.signOut();
            }.bind(this))
            .then(function() {
              return this.signIn({
                login: user.login,
                password: given.replacement,
              });
            }.bind(this));
        }.bind(this));
      } else {
        throw new Error('No signed-in user to change the password for');
      }
    }.bind(this));
  },

  requestPasswordReset: function(given) {
    return this._getAuthToken().then(function(token) {
      var data = {
        authenticity_token: token,
        user: {
          email: given.email,
        },
      };

      return apiClient.post('/../users/password', data, JSON_HEADERS);
    }.bind(this));
  },

  resetPassword: function(given) {
    return this._getAuthToken().then(function(authToken) {
      var data = {
        authenticity_token: authToken,
        user: {
          password: given.password,
          password_confirmation: given.confirmation,
          reset_password_token: given.token,
        },
      };

      return apiClient.put('/../users/password', data, JSON_HEADERS);
    }.bind(this));
  },

  disableAccount: function() {
    console.log('Disabling account');
    return this.checkCurrent().then(function(user) {
      if (user) {
        return user.delete().then(function() {
          this._deleteBearerToken();
          this.update({
            _currentUserPromise: Promise.resolve(null),
          });
          console.info('Disabled account');
          return null;
        }.bind(this));
      } else {
        throw new Error('Failed to disable account; not signed in');
      }
    }.bind(this));
  },

  signOut: function() {
    console.log('Signing out');
    return this.checkCurrent().then(function(user) {
      if (user) {
        return this._getAuthToken().then(function(token) {
          var url = config.host + '/users/sign_out';

          var deleteHeaders = Object.create(JSON_HEADERS);
          deleteHeaders['X-CSRF-Token'] = token;

          return makeHTTPRequest('DELETE', url, null, deleteHeaders)
            .then(function() {
              this._deleteBearerToken();
              this.update({
                _currentUserPromise: Promise.resolve(null),
              });
              console.info('Signed out');
              return null;
            }.bind(this))
            .catch(function(request) {
              console.error('Failed to sign out');
              return apiClient.handleError(request);
            }.bind(this));
        }.bind(this));
      } else {
        throw new Error('Failed to sign out; not signed in');
      }
    }.bind(this));
  },

  unsubscribeEmail: function(given) {
    return this._getAuthToken().then(function(token) {
      var url = config.host + '/unsubscribe';

      var data = {
        authenticity_token: token,
        email: given.email,
      };

      return makeHTTPRequest('POST', url, data, JSON_HEADERS);
    }.bind(this));
  },
});

},{"./api-client":549,"./config":551,"json-api-client":556}],551:[function(require,module,exports){
(function (process){
var DEFAULT_ENV = 'production';

var API_HOSTS = {
  production: 'https://www.zooniverse.org',
  staging: 'http://192.168.99.100:3000',
  cam: 'http://172.17.2.87:3000',
};

var API_APPLICATION_IDS = {
  production: 'f79cf5ea821bb161d8cbb52d061ab9a2321d7cb169007003af66b43f7b79ce2a',
  staging: 'e92433a5b36e5120109305dc6c9953a11d2865ab5abd5d7f113aae768b44f080',
  cam: '535759b966935c297be11913acee7a9ca17c025f9f15520e7504728e71110a27',
};

var TALK_HOSTS = {
  production: 'https://talk.zooniverse.org',
  staging: 'https://talk-staging.zooniverse.org',
};

var SUGAR_HOSTS = {
  production: 'https://notifications.zooniverse.org',
  staging: 'https://notifications-staging.zooniverse.org',
};

var hostFromBrowser = locationMatch(/\W?panoptes-api-host=([^&]+)/);
var appFromBrowser = locationMatch(/\W?panoptes-api-application=([^&]+)/);
var talkFromBrowser = locationMatch(/\W?talk-host=([^&]+)/);
var sugarFromBrowser = locationMatch(/\W?sugar-host=([^&]+)/);

var hostFromShell = process.env.PANOPTES_API_HOST;
var appFromShell = process.env.PANOPTES_API_APPLICATION;
var talkFromShell = process.env.TALK_HOST;
var sugarFromShell = process.env.SUGAR_HOST;

var envFromBrowser = locationMatch(/\W?env=(\w+)/);
var envFromShell = process.env.NODE_ENV;

var env = envFromBrowser || envFromShell || DEFAULT_ENV;

if (!env.match(/^(production|staging|cam)$/)) {
  throw new Error('Panoptes Javascript Client Error: Invalid Environment; ' +
    'try setting NODE_ENV to "staging" instead of "'+envFromShell+'".');
}

module.exports = {
  host: hostFromBrowser || hostFromShell || API_HOSTS[env],
  clientAppID: appFromBrowser || appFromShell || API_APPLICATION_IDS[env],
  talkHost: talkFromBrowser || talkFromShell || TALK_HOSTS[env],
  sugarHost: sugarFromBrowser || sugarFromShell || SUGAR_HOSTS[env],
};

// Try and match the location.search property against a regex. Basically mimics
// the CoffeeScript existential operator, in case we're not in a browser.
function locationMatch(regex) {
  var match;
  if (typeof location !== 'undefined' && location !== null) {
    match = location.search.match(regex);
  }

  return (match && match[1]) ? match[1] : undefined;
}

}).call(this,require('_process'))
},{"_process":503}],552:[function(require,module,exports){
(function (process){
var SugarClient = require('sugar-client');
var JSONAPIClient = require('json-api-client');
var auth = require('./auth');
var config = require('./config');

if (typeof navigator !== 'undefined') {
  SugarClient.Primus = require('sugar-client/primus');
  SugarClient.host = config.sugarHost;

  var sugarApiClient = new JSONAPIClient(config.sugarHost, {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  });

  var sugarClient = new SugarClient();

  auth.listen('change', function() {
    auth.checkCurrent()
      .then(function(user) {
        if (user && auth._bearerToken) {
          sugarClient.userId = user.id;
          sugarClient.authToken = auth._bearerToken;

          if (process.env.NODE_ENV !== 'production') {
            sugarClient.on('response', function() {
              var args = Array.prototype.slice.call(arguments);
              console.log.apply(console, ['[SUGAR RESPONSE]'].concat(args));
            });
          }

          sugarClient.connect();
        } else {
          sugarClient.disconnect();
        }
      })
      .catch(function(e) {
        throw new Error('Failed to checkCurrent auth from sugar client');
      });
  });

  module.exports = {
    sugarClient: sugarClient,
    sugarApiClient: sugarApiClient,
  };
}

}).call(this,require('_process'))
},{"./auth":550,"./config":551,"_process":503,"json-api-client":556,"sugar-client":"sugar-client","sugar-client/primus":566}],553:[function(require,module,exports){
var JSONAPIClient = require('json-api-client');
var config = require('./config');
var apiClient = require('./api-client');

var talkClient = new JSONAPIClient(config.talkHost, {
  'Content-Type': 'application/json',
  'Accept': 'application/json',
});

talkClient.headers = apiClient.headers;
talkClient.handleError = apiClient.handleError;

module.exports = talkClient;

},{"./api-client":549,"./config":551,"json-api-client":556}],554:[function(require,module,exports){
// Generated by CoffeeScript 1.10.0
(function() {
  module.exports = {
    'Content-Type': 'application/vnd.api+json',
    'Accept': 'application/vnd.api+json'
  };

}).call(this);

},{}],555:[function(require,module,exports){
// Generated by CoffeeScript 1.10.0
(function() {
  var DEFAULT_SIGNAL, Emitter, arraysMatch, callHandler,
    slice = [].slice;

  DEFAULT_SIGNAL = 'change';

  arraysMatch = function(array1, array2) {
    var i, item, matches, ref;
    matches = (function() {
      var j, len, results;
      results = [];
      for (i = j = 0, len = array1.length; j < len; i = ++j) {
        item = array1[i];
        if (array2[i] === item) {
          results.push(i);
        }
      }
      return results;
    })();
    return (array1.length === (ref = array2.length) && ref === matches.length);
  };

  callHandler = function(handler, payload) {
    var boundArgs, context, ref;
    if (Array.isArray(handler)) {
      ref = handler, context = ref[0], handler = ref[1], boundArgs = 3 <= ref.length ? slice.call(ref, 2) : [];
      if (typeof handler === 'string') {
        handler = context[handler];
      }
    } else {
      boundArgs = [];
    }
    handler.apply(context, boundArgs.concat(payload));
  };

  module.exports = Emitter = (function() {
    Emitter.prototype._callbacks = null;

    function Emitter() {
      this._callbacks = {};
    }

    Emitter.prototype.listen = function() {
      var arg, base, callback, j, signal;
      arg = 2 <= arguments.length ? slice.call(arguments, 0, j = arguments.length - 1) : (j = 0, []), callback = arguments[j++];
      signal = arg[0];
      if (signal == null) {
        signal = DEFAULT_SIGNAL;
      }
      if ((base = this._callbacks)[signal] == null) {
        base[signal] = [];
      }
      this._callbacks[signal].push(callback);
      return this;
    };

    Emitter.prototype.stopListening = function() {
      var arg, callback, handler, i, index, j, k, ref, signal;
      arg = 2 <= arguments.length ? slice.call(arguments, 0, j = arguments.length - 1) : (j = 0, []), callback = arguments[j++];
      signal = arg[0];
      if (signal == null) {
        signal = DEFAULT_SIGNAL;
      }
      if (this._callbacks[signal] != null) {
        if (callback != null) {
          if (Array.isArray(callback)) {
            index = -1;
            ref = this._callbacks[signal];
            for (i = k = ref.length - 1; k >= 0; i = k += -1) {
              handler = ref[i];
              if (Array.isArray(handler)) {
                if (arraysMatch(callback, handler)) {
                  index = i;
                  break;
                }
              }
            }
          } else {
            index = this._callbacks[signal].lastIndexOf(callback);
          }
          if (index !== -1) {
            this._callbacks[signal].splice(index, 1);
          }
        } else {
          this._callbacks[signal].splice(0);
        }
      }
      return this;
    };

    Emitter.prototype.emit = function() {
      var callback, j, len, payload, ref, signal;
      signal = arguments[0], payload = 2 <= arguments.length ? slice.call(arguments, 1) : [];
      if (signal == null) {
        signal = DEFAULT_SIGNAL;
      }
      if (signal in this._callbacks) {
        ref = this._callbacks[signal];
        for (j = 0, len = ref.length; j < len; j++) {
          callback = ref[j];
          callHandler(callback, payload);
        }
      }
      return this;
    };

    Emitter.prototype.destroy = function() {
      var callback, j, len, ref, signal;
      this.emit('destroy');
      for (signal in this._callbacks) {
        ref = this._callbacks[signal];
        for (j = 0, len = ref.length; j < len; j++) {
          callback = ref[j];
          this.stopListening(signal, callback);
        }
      }
    };

    return Emitter;

  })();

}).call(this);

},{}],556:[function(require,module,exports){
// Generated by CoffeeScript 1.10.0
(function() {
  var DEFAULT_HEADERS, Emitter, JSONAPIClient, Model, READ_OPS, RESERVED_TOP_LEVEL_KEYS, Resource, Type, WRITE_OPS, makeHTTPRequest, mergeInto,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
    slice = [].slice;

  makeHTTPRequest = require('./make-http-request');

  mergeInto = require('./merge-into');

  Emitter = require('./emitter');

  Type = require('./type');

  Model = require('./model');

  Resource = require('./resource');

  DEFAULT_HEADERS = require('./default-headers');

  RESERVED_TOP_LEVEL_KEYS = ['meta', 'links', 'linked', 'data'];

  READ_OPS = ['HEAD', 'GET'];

  WRITE_OPS = ['POST', 'PUT', 'DELETE'];

  JSONAPIClient = (function(superClass) {
    var fn, i, len, method, ref;

    extend(JSONAPIClient, superClass);

    JSONAPIClient.prototype.root = '/';

    JSONAPIClient.prototype.headers = null;

    JSONAPIClient.prototype.params = null;

    JSONAPIClient.prototype.reads = 0;

    JSONAPIClient.prototype.writes = 0;

    JSONAPIClient.prototype._typesCache = null;

    function JSONAPIClient(root, headers1) {
      this.root = root;
      this.headers = headers1 != null ? headers1 : {};
      this.params = {};
      JSONAPIClient.__super__.constructor.call(this, null);
      this._typesCache = {};
    }

    JSONAPIClient.prototype.request = function(method, url, payload, headers) {
      var allHeaders, fullPayload, fullURL, request;
      method = method.toUpperCase();
      fullURL = this.root + url;
      fullPayload = mergeInto({}, this.params, payload);
      allHeaders = mergeInto({}, DEFAULT_HEADERS, this.headers, headers);
      if (indexOf.call(READ_OPS, method) >= 0) {
        this.update({
          reads: this.reads + 1
        });
      } else if (indexOf.call(WRITE_OPS, method) >= 0) {
        this.update({
          writes: this.writes + 1
        });
      }
      request = makeHTTPRequest(method, fullURL, fullPayload, allHeaders);
      request["catch"]((function(_this) {
        return function() {
          return null;
        };
      })(this)).then((function(_this) {
        return function() {
          if (indexOf.call(READ_OPS, method) >= 0) {
            return _this.update({
              reads: _this.reads - 1
            });
          } else if (indexOf.call(WRITE_OPS, method) >= 0) {
            return _this.update({
              writes: _this.writes - 1
            });
          }
        };
      })(this));
      return request.then(this.processResponse.bind(this))["catch"](this.handleError.bind(this));
    };

    ref = ['get', 'post', 'put', 'delete'];
    fn = function(method) {
      return JSONAPIClient.prototype[method] = function() {
        return this.request.apply(this, [method].concat(slice.call(arguments)));
      };
    };
    for (i = 0, len = ref.length; i < len; i++) {
      method = ref[i];
      fn(method);
    }

    JSONAPIClient.prototype.processResponse = function(res) {
      var headers, j, k, l, len1, len2, len3, linkedResources, ref1, ref2, ref3, ref4, resourceData, resources, response, results, typeName;
      response = (function() {
        var error;
        try {
          return JSON.parse(res.text);
        } catch (error) {
          return {};
        }
      })();
      headers = res.headers;
      if ('links' in response) {
        this._handleLinks(response.links);
      }
      if ('linked' in response) {
        ref1 = response.linked;
        for (typeName in ref1) {
          linkedResources = ref1[typeName];
          ref2 = [].concat(linkedResources);
          for (j = 0, len1 = ref2.length; j < len1; j++) {
            resourceData = ref2[j];
            this.type(typeName).create(resourceData, headers, response.meta);
          }
        }
      }
      results = [];
      if ('data' in response) {
        ref3 = [].concat(response.data);
        for (k = 0, len2 = ref3.length; k < len2; k++) {
          resourceData = ref3[k];
          results.push(this.type(resourceData.type).create(resourceData, headers, response.meta));
        }
      } else {
        for (typeName in response) {
          resources = response[typeName];
          if (indexOf.call(RESERVED_TOP_LEVEL_KEYS, typeName) < 0) {
            ref4 = [].concat(resources);
            for (l = 0, len3 = ref4.length; l < len3; l++) {
              resourceData = ref4[l];
              results.push(this.type(typeName).create(resourceData, headers, response.meta));
            }
          }
        }
      }
      return results;
    };

    JSONAPIClient.prototype._handleLinks = function(links) {
      var attributeName, href, link, ref1, results1, type, typeAndAttribute, typeName;
      results1 = [];
      for (typeAndAttribute in links) {
        link = links[typeAndAttribute];
        ref1 = typeAndAttribute.split('.'), typeName = ref1[0], attributeName = ref1[1];
        if (typeof link === 'string') {
          href = link;
        } else {
          href = link.href, type = link.type;
        }
        results1.push(this._handleLink(typeName, attributeName, href, type));
      }
      return results1;
    };

    JSONAPIClient.prototype._handleLink = function(typeName, attributeName, hrefTemplate, attributeTypeName) {
      var base, type;
      type = this.type(typeName);
      if ((base = type._links)[attributeName] == null) {
        base[attributeName] = {};
      }
      if (hrefTemplate != null) {
        type._links[attributeName].href = hrefTemplate;
      }
      if (attributeTypeName != null) {
        return type._links[attributeName].type = attributeTypeName;
      }
    };

    JSONAPIClient.prototype.handleError = function() {
      return Promise.reject.apply(Promise, arguments);
    };

    JSONAPIClient.prototype.type = function(name) {
      var base;
      if ((base = this._typesCache)[name] == null) {
        base[name] = new Type(name, this);
      }
      return this._typesCache[name];
    };

    JSONAPIClient.prototype.createType = function() {
      if (typeof console !== "undefined" && console !== null) {
        console.warn.apply(console, ['Use JSONAPIClient::type, not ::createType'].concat(slice.call(arguments)));
      }
      return this.type.apply(this, arguments);
    };

    return JSONAPIClient;

  })(Model);

  module.exports = JSONAPIClient;

  module.exports.makeHTTPRequest = makeHTTPRequest;

  module.exports.Emitter = Emitter;

  module.exports.Type = Type;

  module.exports.Model = Model;

  module.exports.Resource = Resource;

  Object.defineProperty(module.exports, 'util', {
    get: function() {
      if (typeof console !== "undefined" && console !== null) {
        console.warn('makeHTTPRequest is available directly from the JSONAPIClient object, no need for `util`');
      }
      return {
        makeHTTPRequest: makeHTTPRequest
      };
    }
  });

}).call(this);

},{"./default-headers":554,"./emitter":555,"./make-http-request":557,"./merge-into":558,"./model":559,"./resource":560,"./type":561}],557:[function(require,module,exports){
// Generated by CoffeeScript 1.10.0
(function() {
  var DEFAULT_HEADERS, makeHTTPRequest, normalizeUrl, request;

  request = require('superagent');

  DEFAULT_HEADERS = require('./default-headers');

  normalizeUrl = require('normalizeurl');

  if (request.agent != null) {
    request = request.agent();
  }

  if (request.parse == null) {
    request.parse = {};
  }

  request.parse[DEFAULT_HEADERS['Accept']] = JSON.parse.bind(JSON);

  makeHTTPRequest = function(method, url, data, headers, modify) {
    var key, originalArguments, value;
    if (headers == null) {
      headers = {};
    }
    originalArguments = Array.prototype.slice.call(arguments);
    method = method.toLowerCase();
    url = normalizeUrl(url);
    if (method === 'get') {
      for (key in data) {
        value = data[key];
        if (Array.isArray(value)) {
          data[key] = value.join(',');
        }
      }
    }
    return new Promise(function(resolve, reject) {
      var req;
      req = (function() {
        switch (method) {
          case 'get':
            return request.get(url).query(data);
          case 'head':
            return request.head(url).query(data);
          case 'put':
            return request.put(url).send(data);
          case 'post':
            return request.post(url).send(data);
          case 'delete':
            return request.del(url);
        }
      })();
      req = req.set(headers);
      if (req.withCredentials != null) {
        req = req.withCredentials();
      }
      if (modify != null) {
        console.warn('Request modification is a sloppy idea; is anything actually doing this? Figure out something else.');
        req = modify(req);
      }
      return req.end(function(error, response) {
        if ((error != null ? error.status : void 0) === 408) {
          return resolve(makeHTTPRequest.apply(null, originalArguments));
        } else if (error != null) {
          return reject(response);
        } else {
          return resolve(response);
        }
      });
    });
  };

  module.exports = makeHTTPRequest;

}).call(this);

},{"./default-headers":554,"normalizeurl":562,"superagent":563}],558:[function(require,module,exports){
// Generated by CoffeeScript 1.10.0
(function() {
  var hasProp = {}.hasOwnProperty;

  module.exports = function() {
    var argument, i, key, len, ref, value;
    ref = Array.prototype.slice.call(arguments, 1);
    for (i = 0, len = ref.length; i < len; i++) {
      argument = ref[i];
      if (argument != null) {
        for (key in argument) {
          if (!hasProp.call(argument, key)) continue;
          value = argument[key];
          arguments[0][key] = value;
        }
      }
    }
    return arguments[0];
  };

}).call(this);

},{}],559:[function(require,module,exports){
// Generated by CoffeeScript 1.10.0
(function() {
  var Emitter, Model, isIndex, mergeInto, removeUnderscoredKeys,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    slice = [].slice,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  Emitter = require('./emitter');

  mergeInto = require('./merge-into');

  isIndex = function(string) {
    var integer;
    integer = parseInt(string, 10);
    return integer.toString(10) === string && !isNaN(integer);
  };

  removeUnderscoredKeys = function(target) {
    var i, key, len, results, results1, value;
    if (Array.isArray(target)) {
      results1 = [];
      for (i = 0, len = target.length; i < len; i++) {
        value = target[i];
        results1.push(removeUnderscoredKeys(value));
      }
      return results1;
    } else if ((target != null) && typeof target === 'object') {
      results = {};
      for (key in target) {
        value = target[key];
        if (key.charAt(0) !== '_') {
          results[key] = removeUnderscoredKeys(value);
        }
      }
      return results;
    } else {
      return target;
    }
  };

  module.exports = Model = (function(superClass) {
    extend(Model, superClass);

    Model.prototype._changedKeys = null;

    function Model() {
      var configs;
      configs = 1 <= arguments.length ? slice.call(arguments, 0) : [];
      Model.__super__.constructor.apply(this, arguments);
      this._changedKeys = [];
      mergeInto.apply(null, [this].concat(slice.call(configs)));
      this.emit('create');
    }

    Model.prototype.update = function(changeSet) {
      var base, i, key, lastKey, len, name, path, ref, rootKey, value;
      if (changeSet == null) {
        changeSet = {};
      }
      if (typeof changeSet === 'string') {
        for (i = 0, len = arguments.length; i < len; i++) {
          key = arguments[i];
          if (indexOf.call(this._changedKeys, key) < 0) {
            (ref = this._changedKeys).push.apply(ref, arguments);
          }
        }
      } else {
        for (key in changeSet) {
          if (!hasProp.call(changeSet, key)) continue;
          value = changeSet[key];
          path = key.split('.');
          rootKey = path[0];
          base = this;
          while (path.length !== 1) {
            if (base[name = path[0]] == null) {
              base[name] = isIndex(path[1]) ? [] : {};
            }
            base = base[path.shift()];
          }
          lastKey = path.shift();
          if (value === void 0) {
            if (Array.isArray(base)) {
              base.splice(lastKey, 1);
            } else {
              delete base[lastKey];
            }
          } else {
            base[lastKey] = value;
          }
          if (indexOf.call(this._changedKeys, rootKey) < 0) {
            this._changedKeys.push(rootKey);
          }
        }
      }
      this.emit('change');
      return this;
    };

    Model.prototype.hasUnsavedChanges = function() {
      return this._changedKeys.length !== 0;
    };

    Model.prototype.toJSON = function() {
      return removeUnderscoredKeys(this);
    };

    Model.prototype.destroy = function() {
      this._changedKeys.splice(0);
      return Model.__super__.destroy.apply(this, arguments);
    };

    return Model;

  })(Emitter);

}).call(this);

},{"./emitter":555,"./merge-into":558}],560:[function(require,module,exports){
// Generated by CoffeeScript 1.10.0
(function() {
  var Model, PLACEHOLDERS_PATTERN, Resource, ResourcePromise,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    slice = [].slice,
    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };

  Model = require('./model');

  PLACEHOLDERS_PATTERN = /{(.+?)}/g;

  Resource = (function(superClass) {
    extend(Resource, superClass);

    Resource.prototype._type = null;

    Resource.prototype._headers = null;

    Resource.prototype._meta = null;

    Resource.prototype._linksCache = null;

    Resource.prototype._savingKeys = null;

    Resource.prototype._write = Promise.resolve();

    function Resource(_type) {
      this._type = _type;
      if (this._type == null) {
        throw new Error('Don\'t call the Resource constructor directly, use `client.type("things").create({});`');
      }
      this._headers = {};
      this._meta = {};
      this._linksCache = {};
      this._savingKeys = {};
      Resource.__super__.constructor.call(this, null);
      this._type.emit('change');
      this.emit('create');
    }

    Resource.prototype.getMeta = function(key) {
      if (key == null) {
        key = this._type._name;
      }
      return this._meta[key];
    };

    Resource.prototype.update = function() {
      var value;
      value = Resource.__super__.update.apply(this, arguments);
      if (this.id && this._type._resourcesCache[this.id] !== this) {
        this._type._resourcesCache[this.id] = this;
        if (this.href != null) {
          this._type._resourcesCache[this.href] = this;
        }
        this._type.emit('change');
      }
      return value;
    };

    Resource.prototype.save = function() {
      var base, changes, key, payload;
      payload = {};
      changes = this.toJSON.call(this.getChangesSinceSave());
      payload[this._type._name] = changes;
      this._changedKeys.splice(0);
      for (key in changes) {
        if ((base = this._savingKeys)[key] == null) {
          base[key] = 0;
        }
        this._savingKeys[key] += 1;
      }
      this._write = this._write["catch"]((function(_this) {
        return function() {
          return null;
        };
      })(this)).then((function(_this) {
        return function() {
          var save;
          save = _this.id ? _this.refresh(true).then(function() {
            return _this._type._client.put(_this._getURL(), payload, _this._getHeadersForModification());
          }) : _this._type._client.post(_this._type._getURL(), payload);
          return new ResourcePromise(save.then(function(arg) {
            var result;
            result = arg[0];
            for (key in changes) {
              _this._savingKeys[key] -= 1;
              if (_this._savingKeys[key] === 0) {
                delete _this._savingKeys[key];
              }
            }
            if (result !== _this) {
              _this.update(result);
              result.destroy();
            }
            _this.emit('save');
            return _this;
          }));
        };
      })(this));
      return this._write;
    };

    Resource.prototype.getChangesSinceSave = function() {
      var changes, i, key, len, ref;
      changes = {};
      ref = this._changedKeys;
      for (i = 0, len = ref.length; i < len; i++) {
        key = ref[i];
        changes[key] = this[key];
      }
      return changes;
    };

    Resource.prototype.refresh = function(saveChanges) {
      var changes;
      if (saveChanges) {
        changes = this.getChangesSinceSave();
        return this.refresh().then((function(_this) {
          return function() {
            return _this.update(changes);
          };
        })(this));
      } else if (this.id) {
        return this._type._client.get(this._getURL());
      } else {
        throw new Error('Can\'t refresh a resource with no ID');
      }
    };

    Resource.prototype.uncache = function() {
      if (this.id) {
        this.emit('uncache');
        delete this._type._resourcesCache[this.id];
        return delete this._type._resourcesCache[this.href];
      } else {
        throw new Error('Can\'t uncache a resource with no ID');
      }
    };

    Resource.prototype["delete"] = function() {
      this._write = this._write["catch"]((function(_this) {
        return function() {
          return null;
        };
      })(this)).then((function(_this) {
        return function() {
          var deletion;
          deletion = _this.id ? _this.refresh(true).then(function() {
            return _this._type._client["delete"](_this._getURL(), null, _this._getHeadersForModification());
          }) : Promise.resolve();
          return new ResourcePromise(deletion.then(function() {
            _this.emit('delete');
            _this._type.emit('change');
            _this.destroy();
            return null;
          }));
        };
      })(this));
      return this._write;
    };

    Resource.prototype.get = function(name, query) {
      var cachedByHREF, fullHREF, href, id, ids, ref, ref1, ref2, ref3, ref4, resourceLink, result, type, typeLink;
      if ((this._linksCache[name] != null) && (query == null)) {
        return this._linksCache[name];
      } else {
        resourceLink = (ref = this.links) != null ? ref[name] : void 0;
        typeLink = this._type._links[name];
        result = (resourceLink != null) || (typeLink != null) ? (href = (ref1 = resourceLink != null ? resourceLink.href : void 0) != null ? ref1 : typeLink != null ? typeLink.href : void 0, type = (ref2 = resourceLink != null ? resourceLink.type : void 0) != null ? ref2 : typeLink != null ? typeLink.type : void 0, id = (ref3 = resourceLink != null ? resourceLink.id : void 0) != null ? ref3 : typeLink != null ? typeLink.id : void 0, id != null ? id : id = typeof resourceLink === 'string' ? resourceLink : void 0, ids = (ref4 = resourceLink != null ? resourceLink.ids : void 0) != null ? ref4 : typeLink != null ? typeLink.ids : void 0, ids != null ? ids : ids = Array.isArray(resourceLink) ? resourceLink : void 0, href != null ? (fullHREF = this._applyHREF(href), cachedByHREF = this._type._client.type(type)._resourcesCache[fullHREF], (cachedByHREF != null) && (query == null) ? Promise.resolve(cachedByHREF) : this._type._client.get(fullHREF, query).then(function(links) {
          if (id != null) {
            return links[0];
          } else {
            return links;
          }
        })) : type != null ? this._type._client.type(type).get(id != null ? id : ids, query).then(function(links) {
          if (id != null) {
            return links[0];
          } else {
            return links;
          }
        }) : void 0) : name in this ? Promise.resolve(this[name]) : this._type._client.get(this._getURL(name));
        result.then((function(_this) {
          return function() {
            if (query == null) {
              return _this._linksCache[name] = result;
            }
          };
        })(this));
        return new ResourcePromise(result);
      }
    };

    Resource.prototype._applyHREF = function(href) {
      var context;
      context = {};
      context[this._type._name] = this;
      return href.replace(PLACEHOLDERS_PATTERN, function(_, path) {
        var ref, ref1, segment, segments, value;
        segments = path.split('.');
        value = context;
        while (segments.length !== 0) {
          segment = segments.shift();
          value = (ref = value[segment]) != null ? ref : (ref1 = value.links) != null ? ref1[segment] : void 0;
        }
        if (Array.isArray(value)) {
          value = value.join(',');
        }
        if (typeof value !== 'string') {
          throw new Error("Value for '" + path + "' in '" + href + "' should be a string.");
        }
        return value;
      });
    };

    Resource.prototype.addLink = function(name, value) {
      var data, url;
      url = this._getURL('links', name);
      data = {};
      data[name] = value;
      return this._type._client.post(url, data).then((function(_this) {
        return function() {
          _this.uncacheLink(name);
          return _this.refresh();
        };
      })(this));
    };

    Resource.prototype.removeLink = function(name, value) {
      var url;
      url = this._getURL('links', name, [].concat(value).join(','));
      return this._type._client["delete"](url).then((function(_this) {
        return function() {
          _this.uncacheLink(name);
          return _this.refresh();
        };
      })(this));
    };

    Resource.prototype.uncacheLink = function(name) {
      return delete this._linksCache[name];
    };

    Resource.prototype._getHeadersForModification = function() {
      return {
        'If-Unmodified-Since': this._getHeader('Last-Modified'),
        'If-Match': this._getHeader('ETag')
      };
    };

    Resource.prototype._getHeader = function(header) {
      var name, value;
      header = header.toLowerCase();
      return ((function() {
        var ref, results1;
        ref = this._headers;
        results1 = [];
        for (name in ref) {
          value = ref[name];
          if (name.toLowerCase() === header) {
            results1.push(value);
          }
        }
        return results1;
      }).call(this))[0];
    };

    Resource.prototype._getURL = function() {
      var ref;
      if (this.href) {
        return [this.href].concat(slice.call(arguments)).join('/');
      } else {
        return (ref = this._type)._getURL.apply(ref, [this.id].concat(slice.call(arguments)));
      }
    };

    Resource.prototype.link = function() {
      if (typeof console !== "undefined" && console !== null) {
        console.warn.apply(console, ['Use Resource::get, not ::link'].concat(slice.call(arguments)));
      }
      return this.get.apply(this, arguments);
    };

    Resource.prototype.getRequestMeta = function() {
      if (typeof console !== "undefined" && console !== null) {
        console.warn.apply(console, ['Use Resource::getMeta, not ::getRequestMeta'].concat(slice.call(arguments)));
      }
      return this.getMeta.apply(this, arguments);
    };

    return Resource;

  })(Model);

  ResourcePromise = (function() {
    var method, methodName, ref;

    ResourcePromise.prototype._promise = null;

    function ResourcePromise(_promise) {
      this._promise = _promise;
      if (!(this._promise instanceof Promise)) {
        throw new Error('ResourcePromise requires a real promise instance');
      }
    }

    ResourcePromise.prototype.then = function() {
      var ref;
      return (ref = this._promise).then.apply(ref, arguments);
    };

    ResourcePromise.prototype["catch"] = function() {
      var ref;
      return (ref = this._promise)["catch"].apply(ref, arguments);
    };

    ResourcePromise.prototype.index = function(index) {
      this._promise = this._promise.then(function(value) {
        index = modulo(index, value.length);
        return value[index];
      });
      return this;
    };

    ref = Resource.prototype;
    for (methodName in ref) {
      method = ref[methodName];
      if (typeof method === 'function' && !(methodName in ResourcePromise.prototype)) {
        (function(methodName) {
          return ResourcePromise.prototype[methodName] = function() {
            var args;
            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
            this._promise = this._promise.then((function(_this) {
              return function(promisedValue) {
                var resource, result, results;
                results = (function() {
                  var i, len, ref1, results1;
                  ref1 = [].concat(promisedValue);
                  results1 = [];
                  for (i = 0, len = ref1.length; i < len; i++) {
                    resource = ref1[i];
                    result = resource[methodName].apply(resource, args);
                    if (result instanceof this.constructor) {
                      result = result._promise;
                    }
                    results1.push(result);
                  }
                  return results1;
                }).call(_this);
                if (Array.isArray(promisedValue)) {
                  return Promise.all(results);
                } else {
                  return results[0];
                }
              };
            })(this));
            return this;
          };
        })(methodName);
      }
    }

    return ResourcePromise;

  })();

  module.exports = Resource;

  module.exports.Promise = ResourcePromise;

}).call(this);

},{"./model":559}],561:[function(require,module,exports){
// Generated by CoffeeScript 1.10.0
(function() {
  var Emitter, Resource, Type, mergeInto,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
    slice = [].slice;

  Emitter = require('./emitter');

  Resource = require('./resource');

  mergeInto = require('./merge-into');

  module.exports = Type = (function(superClass) {
    extend(Type, superClass);

    Type.prototype.Resource = Resource;

    Type.prototype._name = '';

    Type.prototype._client = null;

    Type.prototype._links = null;

    Type.prototype._resourcesCache = null;

    function Type(_name, _client) {
      this._name = _name;
      this._client = _client;
      Type.__super__.constructor.apply(this, arguments);
      this._links = {};
      this._resourcesCache = {};
      if (!(this._name && (this._client != null))) {
        throw new Error('Don\'t call the Type constructor directly, use `client.type("things");`');
      }
    }

    Type.prototype.create = function(data, headers, meta) {
      var key, ref, ref1, resource, value;
      if (data == null) {
        data = {};
      }
      if (headers == null) {
        headers = {};
      }
      if (meta == null) {
        meta = {};
      }
      if (data.type && data.type !== this._name) {
        return (ref = this._client.type(data.type)).create.apply(ref, arguments);
      } else {
        resource = (ref1 = this._resourcesCache[data.id]) != null ? ref1 : new this.Resource(this);
        mergeInto(resource._headers, headers);
        mergeInto(resource._meta, meta);
        if (data.id != null) {
          for (key in data) {
            value = data[key];
            if ((indexOf.call(resource._changedKeys, key) < 0) && (!(key in resource._savingKeys))) {
              resource[key] = value;
            }
          }
          this._resourcesCache[resource.id] = resource;
          resource.emit('change');
        } else {
          resource.update(data);
        }
        return resource;
      }
    };

    Type.prototype.get = function() {
      return new Resource.Promise(typeof arguments[0] === 'string' ? this._getByID.apply(this, arguments) : Array.isArray(arguments[0]) ? this._getByIDs.apply(this, arguments) : this._getByQuery.apply(this, arguments));
    };

    Type.prototype._getByID = function() {
      var id, otherArgs;
      id = arguments[0], otherArgs = 2 <= arguments.length ? slice.call(arguments, 1) : [];
      return this._getByIDs.apply(this, [[id]].concat(slice.call(otherArgs))).then(function(arg) {
        var resource;
        resource = arg[0];
        return resource;
      });
    };

    Type.prototype._getByIDs = function() {
      var id, ids, otherArgs, requests;
      ids = arguments[0], otherArgs = 2 <= arguments.length ? slice.call(arguments, 1) : [];
      requests = (function() {
        var i, len, ref, results;
        results = [];
        for (i = 0, len = ids.length; i < len; i++) {
          id = ids[i];
          if (id in this._resourcesCache && (otherArgs.length === 0 || (otherArgs[0] == null))) {
            results.push(Promise.resolve(this._resourcesCache[id]));
          } else {
            results.push((ref = this._client).get.apply(ref, [this._getURL(id)].concat(slice.call(otherArgs))).then(function(arg) {
              var resource;
              resource = arg[0];
              return resource;
            }));
          }
        }
        return results;
      }).call(this);
      return Promise.all(requests);
    };

    Type.prototype._getByQuery = function() {
      var otherArgs, query, ref;
      query = arguments[0], otherArgs = 2 <= arguments.length ? slice.call(arguments, 1) : [];
      return (ref = this._client).get.apply(ref, [this._getURL(), query].concat(slice.call(otherArgs)));
    };

    Type.prototype._getURL = function() {
      return ['', this._name].concat(slice.call(arguments)).join('/');
    };

    Type.prototype.createResource = function() {
      if (typeof console !== "undefined" && console !== null) {
        console.warn.apply(console, ['Use Type::create, not ::createResource'].concat(slice.call(arguments)));
      }
      return this.create.apply(this, arguments);
    };

    return Type;

  })(Emitter);

}).call(this);

},{"./emitter":555,"./merge-into":558,"./resource":560}],562:[function(require,module,exports){
(function (root, factory) {
    if (typeof exports === 'object') {
        module.exports = factory(require('url'));
    } else if (typeof define === 'function' && define.amd) {
        define(factory);
    } else {
        root.normalizeUrl = factory();
    }
}(this, function (nodeJsUrlModule) {
    function extend(targetObj) { // ...
        for (var i = 1 ; i < arguments.length ; i += 1) {
            var source = arguments[i];
            if (source) {
                for (var prop in source) {
                    targetObj[prop] = source[prop];
                }
            }
        }
        return targetObj;
    }

    // Figure out which ASCII chars are percent-encoded by encodeURIComponent:

    var asciiCharCodesToPercentEncode = [],
        doPercentEncodeByUpperCaseHex = {},
        charByUpperCaseHex = {};

    for (var charCode = 0 ; charCode < 256 ; charCode += 1) {
        var ch = String.fromCharCode(charCode),
            upperCaseHex = charCode.toString(16).toUpperCase();
        while (upperCaseHex.length < 2) {
            upperCaseHex = '0' + upperCaseHex;
        }
        charByUpperCaseHex[upperCaseHex] = ch;
        if (ch !== encodeURIComponent(ch)) {
            doPercentEncodeByUpperCaseHex[upperCaseHex] = true;
            if (charCode < 128 && ch !== '/' && ch !== '%' && ch !== '=') {
                asciiCharCodesToPercentEncode.push(charCode);
            }
        }
    }

    var asciiCharsToPercentEncodeRegExp = new RegExp('[' + asciiCharCodesToPercentEncode.map(function (charCode) {
        var hex = charCode.toString('16');
        return '\\x' + (hex.length < 2 ? '0' : '') + hex;
    }).join('') + ']', 'g');

    // allowPassThroughByChar is optional
    function normalizePercentEncodedChars(urlFragment, allowPassThroughByChar) {
        // Normalize already percent-encoded bytes to upper case (Apache's mod_dav lowercases them):
        return urlFragment.replace(/%([0-9a-f]{2})/gi, function ($0, hex) {
            var upperCaseHex = hex.toUpperCase();
            if (doPercentEncodeByUpperCaseHex[upperCaseHex]) {
                return '%' + upperCaseHex;
            } else {
                return charByUpperCaseHex[upperCaseHex];
            }
        }).replace(asciiCharsToPercentEncodeRegExp, !allowPassThroughByChar ? encodeURIComponent : function ($0) {
            return allowPassThroughByChar[$0] ? $0 : encodeURIComponent($0);
        });
    }

    function normalizeUrlFragment(urlFragment, urlFragmentName) {
        urlFragment = urlFragment || '';
        if (urlFragmentName === 'protocol') {
            urlFragment = urlFragment.toLowerCase();
        } else if (typeof urlFragment === 'string') {
            if (!urlFragmentName || urlFragmentName === 'path' || urlFragmentName === 'pathname') {
                // nodeJsUrlModule.parse('//doma.in/foo/bar') includes the protocol-relative host name in the 'path' and 'pathname' fragments.
                // Detect that and strip it off before normalizing the path so that it doesn't get removed along with a /../ -- and put it back afterwards.
                var matchProtocolRelativeHost = urlFragment.match(/^(\/\/[^\/]+)(\/.*)?$/);
                if (matchProtocolRelativeHost) {
                    urlFragment = matchProtocolRelativeHost[2] || '';
                }

                urlFragment = normalizePercentEncodedChars(urlFragment);

                urlFragment = urlFragment.replace(/\/\.(\/|$)/g, '$1');
                var numReplacements;
                do {
                    numReplacements = 0;
                    urlFragment = urlFragment.replace(/\/[^\/]+\/\.\.(\/|$)/g, function ($0, $1) {
                        numReplacements += 1;
                        return $1;
                    });
                } while (numReplacements > 0);

                if (matchProtocolRelativeHost) {
                    urlFragment = matchProtocolRelativeHost[1] + urlFragment;
                }

                urlFragment = urlFragment || '/';
            } else if (urlFragmentName === 'hash' || urlFragmentName === 'search') {
                // Exclude the leading ? or # from the percent encoding:
                if (urlFragment.length > 0) {
                    urlFragment = urlFragment[0] + normalizePercentEncodedChars(urlFragment.substr(1), {'?': true, '#': urlFragmentName === 'hash'});
                }
            } else if (urlFragmentName === 'host') {
                urlFragment = normalizePercentEncodedChars(urlFragment, {':': true});
            } else if (urlFragmentName === 'auth') {
                urlFragment = normalizePercentEncodedChars(urlFragment, {':': true, '@': true});
            } else {
                urlFragment = normalizePercentEncodedChars(urlFragment);
            }
        }

        return urlFragment;
    }

    return function normalizeUrl(urlOrUrlObj) {
        var inputIsUrlObj = urlOrUrlObj && typeof urlOrUrlObj === 'object',
            urlObj;
        if (inputIsUrlObj) {
            urlObj = extend({}, urlOrUrlObj);
        } else {
            if (nodeJsUrlModule && nodeJsUrlModule.parse) {
                urlObj = nodeJsUrlModule.parse(urlOrUrlObj);
            } else {
                if (/^[\w\+]+:|^\/\//.test(urlOrUrlObj)) {
                    throw new Error('Cannot normalize absolute and protocol-relative urls passed as a string without the node.js url module');
                }
                // Do a poor man's split into 'pathname', 'search', and 'hash' fragments. This regexp should match all strings:
                var matchQueryStringAndFragmentIdentifier = urlOrUrlObj.match(/^([^?#]*)(\?[^#]*)?(#(.*))?$/);

                return normalizeUrlFragment(matchQueryStringAndFragmentIdentifier[1], 'pathname') +
                    normalizeUrlFragment(matchQueryStringAndFragmentIdentifier[2], 'search') +
                    normalizeUrlFragment(matchQueryStringAndFragmentIdentifier[3], 'hash');
            }
        }

        // Remove the aggregated parts of the url object so we don't need to keep them in sync:
        delete urlObj.href;
        delete urlObj.path;

        Object.keys(urlObj).forEach(function (propertyName) {
            urlObj[propertyName] = normalizeUrlFragment(urlObj[propertyName], propertyName);
        });

        if (inputIsUrlObj) {
            // Regenerate the aggregate parts of the url object if we have the node.js URL module:
            if (nodeJsUrlModule) {
                urlObj.href = nodeJsUrlModule.format(urlObj);
                if (urlObj.pathname || urlObj.search) {
                    urlObj.path = (urlObj.pathname || '') + (urlObj.search || '');
                }
            }
            return urlObj;
        } else {
            return nodeJsUrlModule.format(urlObj);
        }
    };
}));

},{"url":523}],563:[function(require,module,exports){
/**
 * Module dependencies.
 */

var Emitter = require('emitter');
var reduce = require('reduce');

/**
 * Root reference for iframes.
 */

var root;
if (typeof window !== 'undefined') { // Browser window
  root = window;
} else if (typeof self !== 'undefined') { // Web Worker
  root = self;
} else { // Other environments
  root = this;
}

/**
 * Noop.
 */

function noop(){};

/**
 * Check if `obj` is a host object,
 * we don't want to serialize these :)
 *
 * TODO: future proof, move to compoent land
 *
 * @param {Object} obj
 * @return {Boolean}
 * @api private
 */

function isHost(obj) {
  var str = {}.toString.call(obj);

  switch (str) {
    case '[object File]':
    case '[object Blob]':
    case '[object FormData]':
      return true;
    default:
      return false;
  }
}

/**
 * Determine XHR.
 */

request.getXHR = function () {
  if (root.XMLHttpRequest
      && (!root.location || 'file:' != root.location.protocol
          || !root.ActiveXObject)) {
    return new XMLHttpRequest;
  } else {
    try { return new ActiveXObject('Microsoft.XMLHTTP'); } catch(e) {}
    try { return new ActiveXObject('Msxml2.XMLHTTP.6.0'); } catch(e) {}
    try { return new ActiveXObject('Msxml2.XMLHTTP.3.0'); } catch(e) {}
    try { return new ActiveXObject('Msxml2.XMLHTTP'); } catch(e) {}
  }
  return false;
};

/**
 * Removes leading and trailing whitespace, added to support IE.
 *
 * @param {String} s
 * @return {String}
 * @api private
 */

var trim = ''.trim
  ? function(s) { return s.trim(); }
  : function(s) { return s.replace(/(^\s*|\s*$)/g, ''); };

/**
 * Check if `obj` is an object.
 *
 * @param {Object} obj
 * @return {Boolean}
 * @api private
 */

function isObject(obj) {
  return obj === Object(obj);
}

/**
 * Serialize the given `obj`.
 *
 * @param {Object} obj
 * @return {String}
 * @api private
 */

function serialize(obj) {
  if (!isObject(obj)) return obj;
  var pairs = [];
  for (var key in obj) {
    if (null != obj[key]) {
      pushEncodedKeyValuePair(pairs, key, obj[key]);
        }
      }
  return pairs.join('&');
}

/**
 * Helps 'serialize' with serializing arrays.
 * Mutates the pairs array.
 *
 * @param {Array} pairs
 * @param {String} key
 * @param {Mixed} val
 */

function pushEncodedKeyValuePair(pairs, key, val) {
  if (Array.isArray(val)) {
    return val.forEach(function(v) {
      pushEncodedKeyValuePair(pairs, key, v);
    });
  }
  pairs.push(encodeURIComponent(key)
    + '=' + encodeURIComponent(val));
}

/**
 * Expose serialization method.
 */

 request.serializeObject = serialize;

 /**
  * Parse the given x-www-form-urlencoded `str`.
  *
  * @param {String} str
  * @return {Object}
  * @api private
  */

function parseString(str) {
  var obj = {};
  var pairs = str.split('&');
  var parts;
  var pair;

  for (var i = 0, len = pairs.length; i < len; ++i) {
    pair = pairs[i];
    parts = pair.split('=');
    obj[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1]);
  }

  return obj;
}

/**
 * Expose parser.
 */

request.parseString = parseString;

/**
 * Default MIME type map.
 *
 *     superagent.types.xml = 'application/xml';
 *
 */

request.types = {
  html: 'text/html',
  json: 'application/json',
  xml: 'application/xml',
  urlencoded: 'application/x-www-form-urlencoded',
  'form': 'application/x-www-form-urlencoded',
  'form-data': 'application/x-www-form-urlencoded'
};

/**
 * Default serialization map.
 *
 *     superagent.serialize['application/xml'] = function(obj){
 *       return 'generated xml here';
 *     };
 *
 */

 request.serialize = {
   'application/x-www-form-urlencoded': serialize,
   'application/json': JSON.stringify
 };

 /**
  * Default parsers.
  *
  *     superagent.parse['application/xml'] = function(str){
  *       return { object parsed from str };
  *     };
  *
  */

request.parse = {
  'application/x-www-form-urlencoded': parseString,
  'application/json': JSON.parse
};

/**
 * Parse the given header `str` into
 * an object containing the mapped fields.
 *
 * @param {String} str
 * @return {Object}
 * @api private
 */

function parseHeader(str) {
  var lines = str.split(/\r?\n/);
  var fields = {};
  var index;
  var line;
  var field;
  var val;

  lines.pop(); // trailing CRLF

  for (var i = 0, len = lines.length; i < len; ++i) {
    line = lines[i];
    index = line.indexOf(':');
    field = line.slice(0, index).toLowerCase();
    val = trim(line.slice(index + 1));
    fields[field] = val;
  }

  return fields;
}

/**
 * Check if `mime` is json or has +json structured syntax suffix.
 *
 * @param {String} mime
 * @return {Boolean}
 * @api private
 */

function isJSON(mime) {
  return /[\/+]json\b/.test(mime);
}

/**
 * Return the mime type for the given `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */

function type(str){
  return str.split(/ *; */).shift();
};

/**
 * Return header field parameters.
 *
 * @param {String} str
 * @return {Object}
 * @api private
 */

function params(str){
  return reduce(str.split(/ *; */), function(obj, str){
    var parts = str.split(/ *= */)
      , key = parts.shift()
      , val = parts.shift();

    if (key && val) obj[key] = val;
    return obj;
  }, {});
};

/**
 * Initialize a new `Response` with the given `xhr`.
 *
 *  - set flags (.ok, .error, etc)
 *  - parse header
 *
 * Examples:
 *
 *  Aliasing `superagent` as `request` is nice:
 *
 *      request = superagent;
 *
 *  We can use the promise-like API, or pass callbacks:
 *
 *      request.get('/').end(function(res){});
 *      request.get('/', function(res){});
 *
 *  Sending data can be chained:
 *
 *      request
 *        .post('/user')
 *        .send({ name: 'tj' })
 *        .end(function(res){});
 *
 *  Or passed to `.send()`:
 *
 *      request
 *        .post('/user')
 *        .send({ name: 'tj' }, function(res){});
 *
 *  Or passed to `.post()`:
 *
 *      request
 *        .post('/user', { name: 'tj' })
 *        .end(function(res){});
 *
 * Or further reduced to a single call for simple cases:
 *
 *      request
 *        .post('/user', { name: 'tj' }, function(res){});
 *
 * @param {XMLHTTPRequest} xhr
 * @param {Object} options
 * @api private
 */

function Response(req, options) {
  options = options || {};
  this.req = req;
  this.xhr = this.req.xhr;
  // responseText is accessible only if responseType is '' or 'text' and on older browsers
  this.text = ((this.req.method !='HEAD' && (this.xhr.responseType === '' || this.xhr.responseType === 'text')) || typeof this.xhr.responseType === 'undefined')
     ? this.xhr.responseText
     : null;
  this.statusText = this.req.xhr.statusText;
  this.setStatusProperties(this.xhr.status);
  this.header = this.headers = parseHeader(this.xhr.getAllResponseHeaders());
  // getAllResponseHeaders sometimes falsely returns "" for CORS requests, but
  // getResponseHeader still works. so we get content-type even if getting
  // other headers fails.
  this.header['content-type'] = this.xhr.getResponseHeader('content-type');
  this.setHeaderProperties(this.header);
  this.body = this.req.method != 'HEAD'
    ? this.parseBody(this.text ? this.text : this.xhr.response)
    : null;
}

/**
 * Get case-insensitive `field` value.
 *
 * @param {String} field
 * @return {String}
 * @api public
 */

Response.prototype.get = function(field){
  return this.header[field.toLowerCase()];
};

/**
 * Set header related properties:
 *
 *   - `.type` the content type without params
 *
 * A response of "Content-Type: text/plain; charset=utf-8"
 * will provide you with a `.type` of "text/plain".
 *
 * @param {Object} header
 * @api private
 */

Response.prototype.setHeaderProperties = function(header){
  // content-type
  var ct = this.header['content-type'] || '';
  this.type = type(ct);

  // params
  var obj = params(ct);
  for (var key in obj) this[key] = obj[key];
};

/**
 * Parse the given body `str`.
 *
 * Used for auto-parsing of bodies. Parsers
 * are defined on the `superagent.parse` object.
 *
 * @param {String} str
 * @return {Mixed}
 * @api private
 */

Response.prototype.parseBody = function(str){
  var parse = request.parse[this.type];
  return parse && str && (str.length || str instanceof Object)
    ? parse(str)
    : null;
};

/**
 * Set flags such as `.ok` based on `status`.
 *
 * For example a 2xx response will give you a `.ok` of __true__
 * whereas 5xx will be __false__ and `.error` will be __true__. The
 * `.clientError` and `.serverError` are also available to be more
 * specific, and `.statusType` is the class of error ranging from 1..5
 * sometimes useful for mapping respond colors etc.
 *
 * "sugar" properties are also defined for common cases. Currently providing:
 *
 *   - .noContent
 *   - .badRequest
 *   - .unauthorized
 *   - .notAcceptable
 *   - .notFound
 *
 * @param {Number} status
 * @api private
 */

Response.prototype.setStatusProperties = function(status){
  // handle IE9 bug: http://stackoverflow.com/questions/10046972/msie-returns-status-code-of-1223-for-ajax-request
  if (status === 1223) {
    status = 204;
  }

  var type = status / 100 | 0;

  // status / class
  this.status = this.statusCode = status;
  this.statusType = type;

  // basics
  this.info = 1 == type;
  this.ok = 2 == type;
  this.clientError = 4 == type;
  this.serverError = 5 == type;
  this.error = (4 == type || 5 == type)
    ? this.toError()
    : false;

  // sugar
  this.accepted = 202 == status;
  this.noContent = 204 == status;
  this.badRequest = 400 == status;
  this.unauthorized = 401 == status;
  this.notAcceptable = 406 == status;
  this.notFound = 404 == status;
  this.forbidden = 403 == status;
};

/**
 * Return an `Error` representative of this response.
 *
 * @return {Error}
 * @api public
 */

Response.prototype.toError = function(){
  var req = this.req;
  var method = req.method;
  var url = req.url;

  var msg = 'cannot ' + method + ' ' + url + ' (' + this.status + ')';
  var err = new Error(msg);
  err.status = this.status;
  err.method = method;
  err.url = url;

  return err;
};

/**
 * Expose `Response`.
 */

request.Response = Response;

/**
 * Initialize a new `Request` with the given `method` and `url`.
 *
 * @param {String} method
 * @param {String} url
 * @api public
 */

function Request(method, url) {
  var self = this;
  Emitter.call(this);
  this._query = this._query || [];
  this.method = method;
  this.url = url;
  this.header = {};
  this._header = {};
  this.on('end', function(){
    var err = null;
    var res = null;

    try {
      res = new Response(self);
    } catch(e) {
      err = new Error('Parser is unable to parse the response');
      err.parse = true;
      err.original = e;
      // issue #675: return the raw response if the response parsing fails
      err.rawResponse = self.xhr && self.xhr.responseText ? self.xhr.responseText : null;
      return self.callback(err);
    }

    self.emit('response', res);

    if (err) {
      return self.callback(err, res);
    }

    if (res.status >= 200 && res.status < 300) {
      return self.callback(err, res);
    }

    var new_err = new Error(res.statusText || 'Unsuccessful HTTP response');
    new_err.original = err;
    new_err.response = res;
    new_err.status = res.status;

    self.callback(new_err, res);
  });
}

/**
 * Mixin `Emitter`.
 */

Emitter(Request.prototype);

/**
 * Allow for extension
 */

Request.prototype.use = function(fn) {
  fn(this);
  return this;
}

/**
 * Set timeout to `ms`.
 *
 * @param {Number} ms
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.timeout = function(ms){
  this._timeout = ms;
  return this;
};

/**
 * Clear previous timeout.
 *
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.clearTimeout = function(){
  this._timeout = 0;
  clearTimeout(this._timer);
  return this;
};

/**
 * Abort the request, and clear potential timeout.
 *
 * @return {Request}
 * @api public
 */

Request.prototype.abort = function(){
  if (this.aborted) return;
  this.aborted = true;
  this.xhr.abort();
  this.clearTimeout();
  this.emit('abort');
  return this;
};

/**
 * Set header `field` to `val`, or multiple fields with one object.
 *
 * Examples:
 *
 *      req.get('/')
 *        .set('Accept', 'application/json')
 *        .set('X-API-Key', 'foobar')
 *        .end(callback);
 *
 *      req.get('/')
 *        .set({ Accept: 'application/json', 'X-API-Key': 'foobar' })
 *        .end(callback);
 *
 * @param {String|Object} field
 * @param {String} val
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.set = function(field, val){
  if (isObject(field)) {
    for (var key in field) {
      this.set(key, field[key]);
    }
    return this;
  }
  this._header[field.toLowerCase()] = val;
  this.header[field] = val;
  return this;
};

/**
 * Remove header `field`.
 *
 * Example:
 *
 *      req.get('/')
 *        .unset('User-Agent')
 *        .end(callback);
 *
 * @param {String} field
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.unset = function(field){
  delete this._header[field.toLowerCase()];
  delete this.header[field];
  return this;
};

/**
 * Get case-insensitive header `field` value.
 *
 * @param {String} field
 * @return {String}
 * @api private
 */

Request.prototype.getHeader = function(field){
  return this._header[field.toLowerCase()];
};

/**
 * Set Content-Type to `type`, mapping values from `request.types`.
 *
 * Examples:
 *
 *      superagent.types.xml = 'application/xml';
 *
 *      request.post('/')
 *        .type('xml')
 *        .send(xmlstring)
 *        .end(callback);
 *
 *      request.post('/')
 *        .type('application/xml')
 *        .send(xmlstring)
 *        .end(callback);
 *
 * @param {String} type
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.type = function(type){
  this.set('Content-Type', request.types[type] || type);
  return this;
};

/**
 * Force given parser
 *
 * Sets the body parser no matter type.
 *
 * @param {Function}
 * @api public
 */

Request.prototype.parse = function(fn){
  this._parser = fn;
  return this;
};

/**
 * Set Accept to `type`, mapping values from `request.types`.
 *
 * Examples:
 *
 *      superagent.types.json = 'application/json';
 *
 *      request.get('/agent')
 *        .accept('json')
 *        .end(callback);
 *
 *      request.get('/agent')
 *        .accept('application/json')
 *        .end(callback);
 *
 * @param {String} accept
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.accept = function(type){
  this.set('Accept', request.types[type] || type);
  return this;
};

/**
 * Set Authorization field value with `user` and `pass`.
 *
 * @param {String} user
 * @param {String} pass
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.auth = function(user, pass){
  var str = btoa(user + ':' + pass);
  this.set('Authorization', 'Basic ' + str);
  return this;
};

/**
* Add query-string `val`.
*
* Examples:
*
*   request.get('/shoes')
*     .query('size=10')
*     .query({ color: 'blue' })
*
* @param {Object|String} val
* @return {Request} for chaining
* @api public
*/

Request.prototype.query = function(val){
  if ('string' != typeof val) val = serialize(val);
  if (val) this._query.push(val);
  return this;
};

/**
 * Write the field `name` and `val` for "multipart/form-data"
 * request bodies.
 *
 * ``` js
 * request.post('/upload')
 *   .field('foo', 'bar')
 *   .end(callback);
 * ```
 *
 * @param {String} name
 * @param {String|Blob|File} val
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.field = function(name, val){
  if (!this._formData) this._formData = new root.FormData();
  this._formData.append(name, val);
  return this;
};

/**
 * Queue the given `file` as an attachment to the specified `field`,
 * with optional `filename`.
 *
 * ``` js
 * request.post('/upload')
 *   .attach(new Blob(['<a id="a"><b id="b">hey!</b></a>'], { type: "text/html"}))
 *   .end(callback);
 * ```
 *
 * @param {String} field
 * @param {Blob|File} file
 * @param {String} filename
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.attach = function(field, file, filename){
  if (!this._formData) this._formData = new root.FormData();
  this._formData.append(field, file, filename || file.name);
  return this;
};

/**
 * Send `data` as the request body, defaulting the `.type()` to "json" when
 * an object is given.
 *
 * Examples:
 *
 *       // manual json
 *       request.post('/user')
 *         .type('json')
 *         .send('{"name":"tj"}')
 *         .end(callback)
 *
 *       // auto json
 *       request.post('/user')
 *         .send({ name: 'tj' })
 *         .end(callback)
 *
 *       // manual x-www-form-urlencoded
 *       request.post('/user')
 *         .type('form')
 *         .send('name=tj')
 *         .end(callback)
 *
 *       // auto x-www-form-urlencoded
 *       request.post('/user')
 *         .type('form')
 *         .send({ name: 'tj' })
 *         .end(callback)
 *
 *       // defaults to x-www-form-urlencoded
  *      request.post('/user')
  *        .send('name=tobi')
  *        .send('species=ferret')
  *        .end(callback)
 *
 * @param {String|Object} data
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.send = function(data){
  var obj = isObject(data);
  var type = this.getHeader('Content-Type');

  // merge
  if (obj && isObject(this._data)) {
    for (var key in data) {
      this._data[key] = data[key];
    }
  } else if ('string' == typeof data) {
    if (!type) this.type('form');
    type = this.getHeader('Content-Type');
    if ('application/x-www-form-urlencoded' == type) {
      this._data = this._data
        ? this._data + '&' + data
        : data;
    } else {
      this._data = (this._data || '') + data;
    }
  } else {
    this._data = data;
  }

  if (!obj || isHost(data)) return this;
  if (!type) this.type('json');
  return this;
};

/**
 * Invoke the callback with `err` and `res`
 * and handle arity check.
 *
 * @param {Error} err
 * @param {Response} res
 * @api private
 */

Request.prototype.callback = function(err, res){
  var fn = this._callback;
  this.clearTimeout();
  fn(err, res);
};

/**
 * Invoke callback with x-domain error.
 *
 * @api private
 */

Request.prototype.crossDomainError = function(){
  var err = new Error('Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.');
  err.crossDomain = true;

  err.status = this.status;
  err.method = this.method;
  err.url = this.url;

  this.callback(err);
};

/**
 * Invoke callback with timeout error.
 *
 * @api private
 */

Request.prototype.timeoutError = function(){
  var timeout = this._timeout;
  var err = new Error('timeout of ' + timeout + 'ms exceeded');
  err.timeout = timeout;
  this.callback(err);
};

/**
 * Enable transmission of cookies with x-domain requests.
 *
 * Note that for this to work the origin must not be
 * using "Access-Control-Allow-Origin" with a wildcard,
 * and also must set "Access-Control-Allow-Credentials"
 * to "true".
 *
 * @api public
 */

Request.prototype.withCredentials = function(){
  this._withCredentials = true;
  return this;
};

/**
 * Initiate request, invoking callback `fn(res)`
 * with an instanceof `Response`.
 *
 * @param {Function} fn
 * @return {Request} for chaining
 * @api public
 */

Request.prototype.end = function(fn){
  var self = this;
  var xhr = this.xhr = request.getXHR();
  var query = this._query.join('&');
  var timeout = this._timeout;
  var data = this._formData || this._data;

  // store callback
  this._callback = fn || noop;

  // state change
  xhr.onreadystatechange = function(){
    if (4 != xhr.readyState) return;

    // In IE9, reads to any property (e.g. status) off of an aborted XHR will
    // result in the error "Could not complete the operation due to error c00c023f"
    var status;
    try { status = xhr.status } catch(e) { status = 0; }

    if (0 == status) {
      if (self.timedout) return self.timeoutError();
      if (self.aborted) return;
      return self.crossDomainError();
    }
    self.emit('end');
  };

  // progress
  var handleProgress = function(e){
    if (e.total > 0) {
      e.percent = e.loaded / e.total * 100;
    }
    e.direction = 'download';
    self.emit('progress', e);
  };
  if (this.hasListeners('progress')) {
    xhr.onprogress = handleProgress;
  }
  try {
    if (xhr.upload && this.hasListeners('progress')) {
      xhr.upload.onprogress = handleProgress;
    }
  } catch(e) {
    // Accessing xhr.upload fails in IE from a web worker, so just pretend it doesn't exist.
    // Reported here:
    // https://connect.microsoft.com/IE/feedback/details/837245/xmlhttprequest-upload-throws-invalid-argument-when-used-from-web-worker-context
  }

  // timeout
  if (timeout && !this._timer) {
    this._timer = setTimeout(function(){
      self.timedout = true;
      self.abort();
    }, timeout);
  }

  // querystring
  if (query) {
    query = request.serializeObject(query);
    this.url += ~this.url.indexOf('?')
      ? '&' + query
      : '?' + query;
  }

  // initiate request
  xhr.open(this.method, this.url, true);

  // CORS
  if (this._withCredentials) xhr.withCredentials = true;

  // body
  if ('GET' != this.method && 'HEAD' != this.method && 'string' != typeof data && !isHost(data)) {
    // serialize stuff
    var contentType = this.getHeader('Content-Type');
    var serialize = this._parser || request.serialize[contentType ? contentType.split(';')[0] : ''];
    if (!serialize && isJSON(contentType)) serialize = request.serialize['application/json'];
    if (serialize) data = serialize(data);
  }

  // set header fields
  for (var field in this.header) {
    if (null == this.header[field]) continue;
    xhr.setRequestHeader(field, this.header[field]);
  }

  // send stuff
  this.emit('request', this);

  // IE11 xhr.send(undefined) sends 'undefined' string as POST payload (instead of nothing)
  // We need null here if data is undefined
  xhr.send(typeof data !== 'undefined' ? data : null);
  return this;
};

/**
 * Faux promise support
 *
 * @param {Function} fulfill
 * @param {Function} reject
 * @return {Request}
 */

Request.prototype.then = function (fulfill, reject) {
  return this.end(function(err, res) {
    err ? reject(err) : fulfill(res);
  });
}

/**
 * Expose `Request`.
 */

request.Request = Request;

/**
 * Issue a request:
 *
 * Examples:
 *
 *    request('GET', '/users').end(callback)
 *    request('/users').end(callback)
 *    request('/users', callback)
 *
 * @param {String} method
 * @param {String|Function} url or callback
 * @return {Request}
 * @api public
 */

function request(method, url) {
  // callback
  if ('function' == typeof url) {
    return new Request('GET', method).end(url);
  }

  // url first
  if (1 == arguments.length) {
    return new Request('GET', method);
  }

  return new Request(method, url);
}

/**
 * GET `url` with optional callback `fn(res)`.
 *
 * @param {String} url
 * @param {Mixed|Function} data or fn
 * @param {Function} fn
 * @return {Request}
 * @api public
 */

request.get = function(url, data, fn){
  var req = request('GET', url);
  if ('function' == typeof data) fn = data, data = null;
  if (data) req.query(data);
  if (fn) req.end(fn);
  return req;
};

/**
 * HEAD `url` with optional callback `fn(res)`.
 *
 * @param {String} url
 * @param {Mixed|Function} data or fn
 * @param {Function} fn
 * @return {Request}
 * @api public
 */

request.head = function(url, data, fn){
  var req = request('HEAD', url);
  if ('function' == typeof data) fn = data, data = null;
  if (data) req.send(data);
  if (fn) req.end(fn);
  return req;
};

/**
 * DELETE `url` with optional callback `fn(res)`.
 *
 * @param {String} url
 * @param {Function} fn
 * @return {Request}
 * @api public
 */

function del(url, fn){
  var req = request('DELETE', url);
  if (fn) req.end(fn);
  return req;
};

request['del'] = del;
request['delete'] = del;

/**
 * PATCH `url` with optional `data` and callback `fn(res)`.
 *
 * @param {String} url
 * @param {Mixed} data
 * @param {Function} fn
 * @return {Request}
 * @api public
 */

request.patch = function(url, data, fn){
  var req = request('PATCH', url);
  if ('function' == typeof data) fn = data, data = null;
  if (data) req.send(data);
  if (fn) req.end(fn);
  return req;
};

/**
 * POST `url` with optional `data` and callback `fn(res)`.
 *
 * @param {String} url
 * @param {Mixed} data
 * @param {Function} fn
 * @return {Request}
 * @api public
 */

request.post = function(url, data, fn){
  var req = request('POST', url);
  if ('function' == typeof data) fn = data, data = null;
  if (data) req.send(data);
  if (fn) req.end(fn);
  return req;
};

/**
 * PUT `url` with optional `data` and callback `fn(res)`.
 *
 * @param {String} url
 * @param {Mixed|Function} data or fn
 * @param {Function} fn
 * @return {Request}
 * @api public
 */

request.put = function(url, data, fn){
  var req = request('PUT', url);
  if ('function' == typeof data) fn = data, data = null;
  if (data) req.send(data);
  if (fn) req.end(fn);
  return req;
};

/**
 * Expose `request`.
 */

module.exports = request;

},{"emitter":564,"reduce":565}],564:[function(require,module,exports){

/**
 * Expose `Emitter`.
 */

module.exports = Emitter;

/**
 * Initialize a new `Emitter`.
 *
 * @api public
 */

function Emitter(obj) {
  if (obj) return mixin(obj);
};

/**
 * Mixin the emitter properties.
 *
 * @param {Object} obj
 * @return {Object}
 * @api private
 */

function mixin(obj) {
  for (var key in Emitter.prototype) {
    obj[key] = Emitter.prototype[key];
  }
  return obj;
}

/**
 * Listen on the given `event` with `fn`.
 *
 * @param {String} event
 * @param {Function} fn
 * @return {Emitter}
 * @api public
 */

Emitter.prototype.on =
Emitter.prototype.addEventListener = function(event, fn){
  this._callbacks = this._callbacks || {};
  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])
    .push(fn);
  return this;
};

/**
 * Adds an `event` listener that will be invoked a single
 * time then automatically removed.
 *
 * @param {String} event
 * @param {Function} fn
 * @return {Emitter}
 * @api public
 */

Emitter.prototype.once = function(event, fn){
  function on() {
    this.off(event, on);
    fn.apply(this, arguments);
  }

  on.fn = fn;
  this.on(event, on);
  return this;
};

/**
 * Remove the given callback for `event` or all
 * registered callbacks.
 *
 * @param {String} event
 * @param {Function} fn
 * @return {Emitter}
 * @api public
 */

Emitter.prototype.off =
Emitter.prototype.removeListener =
Emitter.prototype.removeAllListeners =
Emitter.prototype.removeEventListener = function(event, fn){
  this._callbacks = this._callbacks || {};

  // all
  if (0 == arguments.length) {
    this._callbacks = {};
    return this;
  }

  // specific event
  var callbacks = this._callbacks['$' + event];
  if (!callbacks) return this;

  // remove all handlers
  if (1 == arguments.length) {
    delete this._callbacks['$' + event];
    return this;
  }

  // remove specific handler
  var cb;
  for (var i = 0; i < callbacks.length; i++) {
    cb = callbacks[i];
    if (cb === fn || cb.fn === fn) {
      callbacks.splice(i, 1);
      break;
    }
  }
  return this;
};

/**
 * Emit `event` with the given args.
 *
 * @param {String} event
 * @param {Mixed} ...
 * @return {Emitter}
 */

Emitter.prototype.emit = function(event){
  this._callbacks = this._callbacks || {};
  var args = [].slice.call(arguments, 1)
    , callbacks = this._callbacks['$' + event];

  if (callbacks) {
    callbacks = callbacks.slice(0);
    for (var i = 0, len = callbacks.length; i < len; ++i) {
      callbacks[i].apply(this, args);
    }
  }

  return this;
};

/**
 * Return array of callbacks for `event`.
 *
 * @param {String} event
 * @return {Array}
 * @api public
 */

Emitter.prototype.listeners = function(event){
  this._callbacks = this._callbacks || {};
  return this._callbacks['$' + event] || [];
};

/**
 * Check if this emitter has `event` handlers.
 *
 * @param {String} event
 * @return {Boolean}
 * @api public
 */

Emitter.prototype.hasListeners = function(event){
  return !! this.listeners(event).length;
};

},{}],565:[function(require,module,exports){

/**
 * Reduce `arr` with `fn`.
 *
 * @param {Array} arr
 * @param {Function} fn
 * @param {Mixed} initial
 *
 * TODO: combatible error handling?
 */

module.exports = function(arr, fn, initial){  
  var idx = 0;
  var len = arr.length;
  var curr = arguments.length == 3
    ? initial
    : arr[idx++];

  while (idx < len) {
    curr = fn.call(null, curr, arr[idx], ++idx, arr);
  }
  
  return curr;
};
},{}],566:[function(require,module,exports){
(function UMDish(name, context, definition) {
  context[name] = definition.call(context);
  if (typeof module !== "undefined" && module.exports) {
    module.exports = context[name];
  } else if (typeof define === "function" && define.amd) {
    define(function reference() { return context[name]; });
  }
})("Primus", this, function wrapper() {
  var define, module, exports
    , Primus = (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
'use strict';

/**
 * Create a function that will cleanup the instance.
 *
 * @param {Array|String} keys Properties on the instance that needs to be cleared.
 * @param {Object} options Additional configuration.
 * @returns {Function} Destroy function
 * @api public
 */
module.exports = function demolish(keys, options) {
  var split = /[, ]+/;

  options = options ||  {};
  keys = keys || [];

  if ('string' === typeof keys) keys = keys.split(split);

  /**
   * Run addition cleanup hooks.
   *
   * @param {String} key Name of the clean up hook to run.
   * @param {Mixed} selfie Reference to the instance we're cleaning up.
   * @api private
   */
  function run(key, selfie) {
    if (!options[key]) return;
    if ('string' === typeof options[key]) options[key] = options[key].split(split);
    if ('function' === typeof options[key]) return options[key].call(selfie);

    for (var i = 0, type, what; i < options[key].length; i++) {
      what = options[key][i];
      type = typeof what;

      if ('function' === type) {
        what.call(selfie);
      } else if ('string' === type && 'function' === typeof selfie[what]) {
        selfie[what]();
      }
    }
  }

  /**
   * Destroy the instance completely and clean up all the existing references.
   *
   * @returns {Boolean}
   * @api public
   */
  return function destroy() {
    var selfie = this
      , i = 0
      , prop;

    if (selfie[keys[0]] === null) return false;
    run('before', selfie);

    for (; i < keys.length; i++) {
      prop = keys[i];

      if (selfie[prop]) {
        if ('function' === typeof selfie[prop].destroy) selfie[prop].destroy();
        selfie[prop] = null;
      }
    }

    if (selfie.emit) selfie.emit('destroy');
    run('after', selfie);

    return true;
  };
};

},{}],2:[function(_dereq_,module,exports){
'use strict';

/**
 * Returns a function that when invoked executes all the listeners of the
 * given event with the given arguments.
 *
 * @returns {Function} The function that emits all the things.
 * @api public
 */
module.exports = function emits() {
  var self = this
    , parser;

  for (var i = 0, l = arguments.length, args = new Array(l); i < l; i++) {
    args[i] = arguments[i];
  }

  //
  // If the last argument is a function, assume that it's a parser.
  //
  if ('function' !== typeof args[args.length - 1]) return function emitter() {
    for (var i = 0, l = arguments.length, arg = new Array(l); i < l; i++) {
      arg[i] = arguments[i];
    }

    return self.emit.apply(self, args.concat(arg));
  };

  parser = args.pop();

  /**
   * The actual function that emits the given event. It returns a boolean
   * indicating if the event was emitted.
   *
   * @returns {Boolean}
   * @api public
   */
  return function emitter() {
    for (var i = 0, l = arguments.length, arg = new Array(l + 1); i < l; i++) {
      arg[i + 1] = arguments[i];
    }

    /**
     * Async completion method for the parser.
     *
     * @param {Error} err Optional error when parsing failed.
     * @param {Mixed} returned Emit instructions.
     * @api private
     */
    arg[0] = function next(err, returned) {
      if (err) return self.emit('error', err);

      arg = returned === undefined
        ? arg.slice(1) : returned === null
          ? [] : returned;

      self.emit.apply(self, args.concat(arg));
    };

    parser.apply(self, arg);
    return true;
  };
};

},{}],3:[function(_dereq_,module,exports){
'use strict';

/**
 * Representation of a single EventEmitter function.
 *
 * @param {Function} fn Event handler to be called.
 * @param {Mixed} context Context for function execution.
 * @param {Boolean} once Only emit once
 * @api private
 */
function EE(fn, context, once) {
  this.fn = fn;
  this.context = context;
  this.once = once || false;
}

/**
 * Minimal EventEmitter interface that is molded against the Node.js
 * EventEmitter interface.
 *
 * @constructor
 * @api public
 */
function EventEmitter() { /* Nothing to set */ }

/**
 * Holds the assigned EventEmitters by name.
 *
 * @type {Object}
 * @private
 */
EventEmitter.prototype._events = undefined;

/**
 * Return a list of assigned event listeners.
 *
 * @param {String} event The events that should be listed.
 * @returns {Array}
 * @api public
 */
EventEmitter.prototype.listeners = function listeners(event) {
  if (!this._events || !this._events[event]) return [];
  if (this._events[event].fn) return [this._events[event].fn];

  for (var i = 0, l = this._events[event].length, ee = new Array(l); i < l; i++) {
    ee[i] = this._events[event][i].fn;
  }

  return ee;
};

/**
 * Emit an event to all registered event listeners.
 *
 * @param {String} event The name of the event.
 * @returns {Boolean} Indication if we've emitted an event.
 * @api public
 */
EventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {
  if (!this._events || !this._events[event]) return false;

  var listeners = this._events[event]
    , len = arguments.length
    , args
    , i;

  if ('function' === typeof listeners.fn) {
    if (listeners.once) this.removeListener(event, listeners.fn, true);

    switch (len) {
      case 1: return listeners.fn.call(listeners.context), true;
      case 2: return listeners.fn.call(listeners.context, a1), true;
      case 3: return listeners.fn.call(listeners.context, a1, a2), true;
      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;
      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;
      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;
    }

    for (i = 1, args = new Array(len -1); i < len; i++) {
      args[i - 1] = arguments[i];
    }

    listeners.fn.apply(listeners.context, args);
  } else {
    var length = listeners.length
      , j;

    for (i = 0; i < length; i++) {
      if (listeners[i].once) this.removeListener(event, listeners[i].fn, true);

      switch (len) {
        case 1: listeners[i].fn.call(listeners[i].context); break;
        case 2: listeners[i].fn.call(listeners[i].context, a1); break;
        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;
        default:
          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {
            args[j - 1] = arguments[j];
          }

          listeners[i].fn.apply(listeners[i].context, args);
      }
    }
  }

  return true;
};

/**
 * Register a new EventListener for the given event.
 *
 * @param {String} event Name of the event.
 * @param {Functon} fn Callback function.
 * @param {Mixed} context The context of the function.
 * @api public
 */
EventEmitter.prototype.on = function on(event, fn, context) {
  var listener = new EE(fn, context || this);

  if (!this._events) this._events = {};
  if (!this._events[event]) this._events[event] = listener;
  else {
    if (!this._events[event].fn) this._events[event].push(listener);
    else this._events[event] = [
      this._events[event], listener
    ];
  }

  return this;
};

/**
 * Add an EventListener that's only called once.
 *
 * @param {String} event Name of the event.
 * @param {Function} fn Callback function.
 * @param {Mixed} context The context of the function.
 * @api public
 */
EventEmitter.prototype.once = function once(event, fn, context) {
  var listener = new EE(fn, context || this, true);

  if (!this._events) this._events = {};
  if (!this._events[event]) this._events[event] = listener;
  else {
    if (!this._events[event].fn) this._events[event].push(listener);
    else this._events[event] = [
      this._events[event], listener
    ];
  }

  return this;
};

/**
 * Remove event listeners.
 *
 * @param {String} event The event we want to remove.
 * @param {Function} fn The listener that we need to find.
 * @param {Boolean} once Only remove once listeners.
 * @api public
 */
EventEmitter.prototype.removeListener = function removeListener(event, fn, once) {
  if (!this._events || !this._events[event]) return this;

  var listeners = this._events[event]
    , events = [];

  if (fn) {
    if (listeners.fn && (listeners.fn !== fn || (once && !listeners.once))) {
      events.push(listeners);
    }
    if (!listeners.fn) for (var i = 0, length = listeners.length; i < length; i++) {
      if (listeners[i].fn !== fn || (once && !listeners[i].once)) {
        events.push(listeners[i]);
      }
    }
  }

  //
  // Reset the array, or remove it completely if we have no more listeners.
  //
  if (events.length) {
    this._events[event] = events.length === 1 ? events[0] : events;
  } else {
    delete this._events[event];
  }

  return this;
};

/**
 * Remove all listeners or only the listeners for the specified event.
 *
 * @param {String} event The event want to remove all listeners for.
 * @api public
 */
EventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {
  if (!this._events) return this;

  if (event) delete this._events[event];
  else this._events = {};

  return this;
};

//
// Alias methods names because people roll like that.
//
EventEmitter.prototype.off = EventEmitter.prototype.removeListener;
EventEmitter.prototype.addListener = EventEmitter.prototype.on;

//
// This function doesn't apply anymore.
//
EventEmitter.prototype.setMaxListeners = function setMaxListeners() {
  return this;
};

//
// Expose the module.
//
EventEmitter.EventEmitter = EventEmitter;
EventEmitter.EventEmitter2 = EventEmitter;
EventEmitter.EventEmitter3 = EventEmitter;

//
// Expose the module.
//
module.exports = EventEmitter;

},{}],4:[function(_dereq_,module,exports){
'use strict';

var has = Object.prototype.hasOwnProperty;

/**
 * Simple query string parser.
 *
 * @param {String} query The query string that needs to be parsed.
 * @returns {Object}
 * @api public
 */
function querystring(query) {
  var parser = /([^=?&]+)=([^&]*)/g
    , result = {}
    , part;

  //
  // Little nifty parsing hack, leverage the fact that RegExp.exec increments
  // the lastIndex property so we can continue executing this loop until we've
  // parsed all results.
  //
  for (;
    part = parser.exec(query);
    result[decodeURIComponent(part[1])] = decodeURIComponent(part[2])
  );

  return result;
}

/**
 * Transform a query string to an object.
 *
 * @param {Object} obj Object that should be transformed.
 * @param {String} prefix Optional prefix.
 * @returns {String}
 * @api public
 */
function querystringify(obj, prefix) {
  prefix = prefix || '';

  var pairs = [];

  //
  // Optionally prefix with a '?' if needed
  //
  if ('string' !== typeof prefix) prefix = '?';

  for (var key in obj) {
    if (has.call(obj, key)) {
      pairs.push(encodeURIComponent(key) +'='+ encodeURIComponent(obj[key]));
    }
  }

  return prefix + pairs.join('&');
}

//
// Expose the module.
//
exports.stringify = querystringify;
exports.parse = querystring;

},{}],5:[function(_dereq_,module,exports){
'use strict';

var EventEmitter = _dereq_('eventemitter3')
  , millisecond = _dereq_('millisecond')
  , destroy = _dereq_('demolish')
  , Tick = _dereq_('tick-tock')
  , one = _dereq_('one-time');

/**
 * Returns sane defaults about a given value.
 *
 * @param {String} name Name of property we want.
 * @param {Recovery} selfie Recovery instance that got created.
 * @param {Object} opts User supplied options we want to check.
 * @returns {Number} Some default value.
 * @api private
 */
function defaults(name, selfie, opts) {
  return millisecond(
    name in opts ? opts[name] : (name in selfie ? selfie[name] : Recovery[name])
  );
}

/**
 * Attempt to recover your connection with reconnection attempt.
 *
 * @constructor
 * @param {Object} options Configuration
 * @api public
 */
function Recovery(options) {
  var recovery = this;

  if (!(recovery instanceof Recovery)) return new Recovery(options);

  options = options || {};

  recovery.attempt = null;        // Stores the current reconnect attempt.
  recovery._fn = null;            // Stores the callback.

  recovery['reconnect timeout'] = defaults('reconnect timeout', recovery, options);
  recovery.retries = defaults('retries', recovery, options);
  recovery.factor = defaults('factor', recovery, options);
  recovery.max = defaults('max', recovery, options);
  recovery.min = defaults('min', recovery, options);
  recovery.timers = new Tick(recovery);
}

Recovery.prototype = new EventEmitter();
Recovery.prototype.constructor = Recovery;

Recovery['reconnect timeout'] = '30 seconds';  // Maximum time to wait for an answer.
Recovery.max = Infinity;                       // Maximum delay.
Recovery.min = '500 ms';                       // Minimum delay.
Recovery.retries = 10;                         // Maximum amount of retries.
Recovery.factor = 2;                           // Exponential back off factor.

/**
 * Start a new reconnect procedure.
 *
 * @returns {Recovery}
 * @api public
 */
Recovery.prototype.reconnect = function reconnect() {
  var recovery = this;

  return recovery.backoff(function backedoff(err, opts) {
    opts.duration = (+new Date()) - opts.start;

    if (err) return recovery.emit('reconnect failed', err, opts);

    recovery.emit('reconnected', opts);
  }, recovery.attempt);
};

/**
 * Exponential back off algorithm for retry operations. It uses a randomized
 * retry so we don't DDOS our server when it goes down under pressure.
 *
 * @param {Function} fn Callback to be called after the timeout.
 * @param {Object} opts Options for configuring the timeout.
 * @returns {Recovery}
 * @api private
 */
Recovery.prototype.backoff = function backoff(fn, opts) {
  var recovery = this;

  opts = opts || recovery.attempt || {};

  //
  // Bailout when we already have a back off process running. We shouldn't call
  // the callback then.
  //
  if (opts.backoff) return recovery;

  opts['reconnect timeout'] = defaults('reconnect timeout', recovery, opts);
  opts.retries = defaults('retries', recovery, opts);
  opts.factor = defaults('factor', recovery, opts);
  opts.max = defaults('max', recovery, opts);
  opts.min = defaults('min', recovery, opts);

  opts.start = +opts.start || +new Date();
  opts.duration = +opts.duration || 0;
  opts.attempt = +opts.attempt || 0;

  //
  // Bailout if we are about to make too much attempts.
  //
  if (opts.attempt === opts.retries) {
    fn.call(recovery, new Error('Unable to recover'), opts);
    return recovery;
  }

  //
  // Prevent duplicate back off attempts using the same options object and
  // increment our attempt as we're about to have another go at this thing.
  //
  opts.backoff = true;
  opts.attempt++;

  recovery.attempt = opts;

  //
  // Calculate the timeout, but make it randomly so we don't retry connections
  // at the same interval and defeat the purpose. This exponential back off is
  // based on the work of:
  //
  // http://dthain.blogspot.nl/2009/02/exponential-backoff-in-distributed.html
  //
  opts.scheduled = opts.attempt !== 1
    ? Math.min(Math.round(
        (Math.random() + 1) * opts.min * Math.pow(opts.factor, opts.attempt - 1)
      ), opts.max)
    : opts.min;

  recovery.timers.setTimeout('reconnect', function delay() {
    opts.duration = (+new Date()) - opts.start;
    opts.backoff = false;
    recovery.timers.clear('reconnect, timeout');

    //
    // Create a `one` function which can only be called once. So we can use the
    // same function for different types of invocations to create a much better
    // and usable API.
    //
    var connect = recovery._fn = one(function connect(err) {
      recovery.reset();

      if (err) return recovery.backoff(fn, opts);

      fn.call(recovery, undefined, opts);
    });

    recovery.emit('reconnect', opts, connect);
    recovery.timers.setTimeout('timeout', function timeout() {
      var err = new Error('Failed to reconnect in a timely manner');
      opts.duration = (+new Date()) - opts.start;

      recovery.emit('reconnect timeout', err, opts);
      connect(err);
    }, opts['reconnect timeout']);
  }, opts.scheduled);

  //
  // Emit a `reconnecting` event with current reconnect options. This allows
  // them to update the UI and provide their users with feedback.
  //
  recovery.emit('reconnect scheduled', opts);

  return recovery;
};

/**
 * Check if the reconnection process is currently reconnecting.
 *
 * @returns {Boolean}
 * @api public
 */
Recovery.prototype.reconnecting = function reconnecting() {
  return !!this.attempt;
};

/**
 * Tell our reconnection procedure that we're passed.
 *
 * @param {Error} err Reconnection failed.
 * @returns {Recovery}
 * @api public
 */
Recovery.prototype.reconnected = function reconnected(err) {
  if (this._fn) this._fn(err);
  return this;
};

/**
 * Reset the reconnection attempt so it can be re-used again.
 *
 * @returns {Recovery}
 * @api public
 */
Recovery.prototype.reset = function reset() {
  this._fn = this.attempt = null;
  this.timers.clear('reconnect, timeout');

  return this;
};

/**
 * Clean up the instance.
 *
 * @type {Function}
 * @returns {Boolean}
 * @api public
 */
Recovery.prototype.destroy = destroy('timers attempt _fn');

//
// Expose the module.
//
module.exports = Recovery;

},{"demolish":1,"eventemitter3":3,"millisecond":6,"one-time":7,"tick-tock":8}],6:[function(_dereq_,module,exports){
/**
 * Parse a time string and return the number value of it.
 *
 * @param {String} ms Time string.
 * @returns {Number}
 * @api private
 */
module.exports = function millisecond(ms) {
  'use strict';

  if ('string' !== typeof ms || '0' === ms || +ms) return +ms;

  var match = /^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(ms)
    , second = 1000
    , minute = second * 60
    , hour = minute * 60
    , day = hour * 24
    , amount;

  if (!match) return 0;

  amount = parseFloat(match[1]);

  switch (match[2].toLowerCase()) {
    case 'days':
    case 'day':
    case 'd':
      return amount * day;

    case 'hours':
    case 'hour':
    case 'hrs':
    case 'hr':
    case 'h':
      return amount * hour;

    case 'minutes':
    case 'minute':
    case 'mins':
    case 'min':
    case 'm':
      return amount * minute;

    case 'seconds':
    case 'second':
    case 'secs':
    case 'sec':
    case 's':
      return amount * second;

    default:
      return amount;
  }
};

},{}],7:[function(_dereq_,module,exports){
'use strict';

/**
 * Wrap callbacks to prevent double execution.
 *
 * @param {Function} fn Function that should only be called once.
 * @returns {Function} A wrapped callback which prevents execution.
 * @api public
 */
module.exports = function one(fn) {
  var called = false
    , value;

  return function time() {
    if (called) return value;

    called = true;
    value = fn.apply(this, arguments);
    fn = null;

    return value;
  };
};

},{}],8:[function(_dereq_,module,exports){
'use strict';

var has = Object.prototype.hasOwnProperty
  , ms = _dereq_('millisecond');

/**
 * Simple timer management.
 *
 * @constructor
 * @param {Mixed} context Context of the callbacks that we execute.
 * @api public
 */
function Tick(context) {
  if (!(this instanceof Tick)) return new Tick(context);

  this.timers = {};
  this.context = context || this;
}

/**
 * Return a function which will just iterate over all assigned callbacks and
 * optionally clear the timers from memory if needed.
 *
 * @param {String} name Name of the timer we need to execute.
 * @param {Boolean} clear Also clear from memory.
 * @returns {Function}
 * @api private
 */
Tick.prototype.tock = function ticktock(name, clear) {
  var tock = this;

  return function tickedtock() {
    if (!(name in tock.timers)) return;

    var timer = tock.timers[name]
      , fns = timer.fns.slice()
      , l = fns.length
      , i = 0;

    if (clear) tock.clear(name);

    for (; i < l; i++) {
      fns[i].call(tock.context);
    }
  };
};

/**
 * Add a new timeout.
 *
 * @param {String} name Name of the timer.
 * @param {Function} fn Completion callback.
 * @param {Mixed} time Duration of the timer.
 * @returns {Tick}
 * @api public
 */
Tick.prototype.setTimeout = function timeout(name, fn, time) {
  var tick = this;

  if (tick.timers[name]) {
    tick.timers[name].fns.push(fn);
    return tick;
  }

  tick.timers[name] = {
    timer: setTimeout(tick.tock(name, true), ms(time)),
    clear: function clear(id) { clearTimeout(id); },
    fns: [fn]
  };

  return tick;
};

/**
 * Add a new interval.
 *
 * @param {String} name Name of the timer.
 * @param {Function} fn Completion callback.
 * @param {Mixed} time Interval of the timer.
 * @returns {Tick}
 * @api public
 */
Tick.prototype.setInterval = function interval(name, fn, time) {
  var tick = this;

  if (tick.timers[name]) {
    tick.timers[name].fns.push(fn);
    return tick;
  }

  tick.timers[name] = {
    timer: setInterval(tick.tock(name), ms(time)),
    clear: function clear(id) { clearInterval(id); },
    fns: [fn]
  };

  return tick;
};

/**
 * Add a new setImmediate.
 *
 * @param {String} name Name of the timer.
 * @param {Function} fn Completion callback.
 * @returns {Tick}
 * @api public
 */
Tick.prototype.setImmediate = function immediate(name, fn) {
  var tick = this;

  if ('function' !== typeof setImmediate) return tick.setTimeout(name, fn, 0);

  if (tick.timers[name]) {
    tick.timers[name].fns.push(fn);
    return tick;
  }

  tick.timers[name] = {
    timer: setImmediate(tick.tock(name, true)),
    clear: function clear(id) { clearImmediate(id); },
    fns: [fn]
  };

  return tick;
};

/**
 * Check if we have a timer set.
 *
 * @param {String} name
 * @returns {Boolean}
 * @api public
 */
Tick.prototype.active = function active(name) {
  return name in this.timers;
};

/**
 * Properly clean up all timeout references. If no arguments are supplied we
 * will attempt to clear every single timer that is present.
 *
 * @param {Arguments} ..args.. The names of the timeouts we need to clear
 * @returns {Tick}
 * @api public
 */
Tick.prototype.clear = function clear() {
  var args = arguments.length ? arguments : []
    , tick = this
    , timer, i, l;

  if (args.length === 1 && 'string' === typeof args[0]) {
    args = args[0].split(/[, ]+/);
  }

  if (!args.length) {
    for (timer in tick.timers) {
      if (has.call(tick.timers, timer)) args.push(timer);
    }
  }

  for (i = 0, l = args.length; i < l; i++) {
    timer = tick.timers[args[i]];

    if (!timer) continue;
    timer.clear(timer.timer);

    timer.fns = timer.timer = timer.clear = null;
    delete tick.timers[args[i]];
  }

  return tick;
};

/**
 * We will no longer use this module, prepare your self for global cleanups.
 *
 * @returns {Boolean}
 * @api public
 */
Tick.prototype.end = Tick.prototype.destroy = function end() {
  if (!this.context) return false;

  this.clear();
  this.context = this.timers = null;

  return true;
};

/**
 * Adjust a timeout or interval to a new duration.
 *
 * @returns {Tick}
 * @api public
 */
Tick.prototype.adjust = function adjust(name, time) {
  var interval
    , tick = this
    , timer = tick.timers[name];

  if (!timer) return tick;

  interval = timer.clear === clearInterval;
  timer.clear(timer.timer);
  timer.timer = (interval ? setInterval : setTimeout)(tick.tock(name, !interval), ms(time));

  return tick;
};

//
// Expose the timer factory.
//
module.exports = Tick;

},{"millisecond":9}],9:[function(_dereq_,module,exports){
arguments[4][6][0].apply(exports,arguments)
},{"dup":6}],10:[function(_dereq_,module,exports){
/*globals require, define */
'use strict';

var EventEmitter = _dereq_('eventemitter3')
  , TickTock = _dereq_('tick-tock')
  , Recovery = _dereq_('recovery')
  , qs = _dereq_('querystringify')
  , destroy = _dereq_('demolish');

/**
 * Context assertion, ensure that some of our public Primus methods are called
 * with the correct context to ensure that
 *
 * @param {Primus} self The context of the function.
 * @param {String} method The method name.
 * @api private
 */
function context(self, method) {
  if (self instanceof Primus) return;

  var failure = new Error('Primus#'+ method + '\'s context should called with a Primus instance');

  if ('function' !== typeof self.listeners || !self.listeners('error').length) {
    throw failure;
  }

  self.emit('error', failure);
}

//
// Sets the default connection URL, it uses the default origin of the browser
// when supported but degrades for older browsers. In Node.js, we cannot guess
// where the user wants to connect to, so we just default to localhost.
//
var defaultUrl;

try {
  if (location.origin) {
    defaultUrl = location.origin;
  } else {
    defaultUrl = location.protocol +'//'+ location.hostname + (location.port ? ':'+ location.port : '');
  }
} catch (e) {
  defaultUrl = 'http://127.0.0.1';
}

/**
 * Primus in a real-time library agnostic framework for establishing real-time
 * connections with servers.
 *
 * Options:
 * - reconnect, configuration for the reconnect process.
 * - manual, don't automatically call `.open` to start the connection.
 * - websockets, force the use of WebSockets, even when you should avoid them.
 * - timeout, connect timeout, server didn't respond in a timely manner.
 * - ping, The heartbeat interval for sending a ping packet to the server.
 * - pong, The heartbeat timeout for receiving a response to the ping.
 * - network, Use network events as leading method for network connection drops.
 * - strategy, Reconnection strategies.
 * - transport, Transport options.
 * - url, uri, The URL to use connect with the server.
 *
 * @constructor
 * @param {String} url The URL of your server.
 * @param {Object} options The configuration.
 * @api public
 */
function Primus(url, options) {
  if (!(this instanceof Primus)) return new Primus(url, options);
  if ('function' !== typeof this.client) {
    var message = 'The client library has not been compiled correctly, ' +
      'see https://github.com/primus/primus#client-library for more details';
    return this.critical(new Error(message));
  }

  if ('object' === typeof url) {
    options = url;
    url = options.url || options.uri || defaultUrl;
  } else {
    options = options || {};
  }

  var primus = this;

  // The maximum number of messages that can be placed in queue.
  options.queueSize = 'queueSize' in options ? options.queueSize : Infinity;

  // Connection timeout duration.
  options.timeout = 'timeout' in options ? options.timeout : 10e3;

  // Stores the back off configuration.
  options.reconnect = 'reconnect' in options ? options.reconnect : {};

  // Heartbeat ping interval.
  options.ping = 'ping' in options ? options.ping : 25000;

  // Heartbeat pong response timeout.
  options.pong = 'pong' in options ? options.pong : 10e3;

  // Reconnect strategies.
  options.strategy = 'strategy' in options ? options.strategy : [];

  // Custom transport options.
  options.transport = 'transport' in options ? options.transport : {};

  primus.buffer = [];                           // Stores premature send data.
  primus.writable = true;                       // Silly stream compatibility.
  primus.readable = true;                       // Silly stream compatibility.
  primus.url = primus.parse(url || defaultUrl); // Parse the URL to a readable format.
  primus.readyState = Primus.CLOSED;            // The readyState of the connection.
  primus.options = options;                     // Reference to the supplied options.
  primus.timers = new TickTock(this);           // Contains all our timers.
  primus.socket = null;                         // Reference to the internal connection.
  primus.latency = 0;                           // Latency between messages.
  primus.stamps = 0;                            // Counter to make timestamps unique.
  primus.disconnect = false;                    // Did we receive a disconnect packet?
  primus.transport = options.transport;         // Transport options.
  primus.transformers = {                       // Message transformers.
    outgoing: [],
    incoming: []
  };

  //
  // Create our reconnection instance.
  //
  primus.recovery = new Recovery(options.reconnect);

  //
  // Parse the reconnection strategy. It can have the following strategies:
  //
  // - timeout: Reconnect when we have a network timeout.
  // - disconnect: Reconnect when we have an unexpected disconnect.
  // - online: Reconnect when we're back online.
  //
  if ('string' === typeof options.strategy) {
    options.strategy = options.strategy.split(/\s?\,\s?/g);
  }

  if (false === options.strategy) {
    //
    // Strategies are disabled, but we still need an empty array to join it in
    // to nothing.
    //
    options.strategy = [];
  } else if (!options.strategy.length) {
    options.strategy.push('disconnect', 'online');

    //
    // Timeout based reconnection should only be enabled conditionally. When
    // authorization is enabled it could trigger.
    //
    if (!this.authorization) options.strategy.push('timeout');
  }

  options.strategy = options.strategy.join(',').toLowerCase();

  //
  // Force the use of WebSockets, even when we've detected some potential
  // broken WebSocket implementation.
  //
  if ('websockets' in options) {
    primus.AVOID_WEBSOCKETS = !options.websockets;
  }

  //
  // Force or disable the use of NETWORK events as leading client side
  // disconnection detection.
  //
  if ('network' in options) {
    primus.NETWORK_EVENTS = options.network;
  }

  //
  // Check if the user wants to manually initialise a connection. If they don't,
  // we want to do it after a really small timeout so we give the users enough
  // time to listen for `error` events etc.
  //
  if (!options.manual) primus.timers.setTimeout('open', function open() {
    primus.timers.clear('open');
    primus.open();
  }, 0);

  primus.initialise(options);
}

/**
 * Simple require wrapper to make browserify, node and require.js play nice.
 *
 * @param {String} name The module to require.
 * @returns {Object|Undefined} The module that we required.
 * @api private
 */
Primus.require = function requires(name) {
  if ('function' !== typeof _dereq_) return undefined;

  return !('function' === typeof define && define.amd)
    ? _dereq_(name)
    : undefined;
};

//
// It's possible that we're running in Node.js or in a Node.js compatible
// environment such as browserify. In these cases we want to use some build in
// libraries to minimize our dependence on the DOM.
//
var Stream, parse;

try {
  Primus.Stream = Stream = Primus.require('stream');
  parse = Primus.require('url').parse;

  //
  // Normally inheritance is done in the same way as we do in our catch
  // statement. But due to changes to the EventEmitter interface in Node 0.10
  // this will trigger annoying memory leak warnings and other potential issues
  // outlined in the issue linked below.
  //
  // @see https://github.com/joyent/node/issues/4971
  //
  Primus.require('util').inherits(Primus, Stream);
} catch (e) {
  Primus.Stream = EventEmitter;
  Primus.prototype = new EventEmitter();

  //
  // In the browsers we can leverage the DOM to parse the URL for us. It will
  // automatically default to host of the current server when we supply it path
  // etc.
  //
  parse = function parse(url) {
    var a = document.createElement('a')
      , data = {}
      , key;

    a.href = url;

    //
    // Transform it from a readOnly object to a read/writable object so we can
    // change some parsed values. This is required if we ever want to override
    // a port number etc. (as browsers remove port 443 and 80 from the URL's).
    //
    for (key in a) {
      if ('string' === typeof a[key] || 'number' === typeof a[key]) {
        data[key] = a[key];
      }
    }

    //
    // We need to make sure that the URL is properly encoded because IE doesn't
    // do this automatically.
    //
    data.href = encodeURI(decodeURI(data.href));

    //
    // If we don't obtain a port number (e.g. when using zombie) then try
    // and guess at a value from the 'href' value.
    //
    if (!data.port) {
      var splits = (data.href || '').split('/');
      if (splits.length > 2) {
        var host = splits[2]
          , atSignIndex = host.lastIndexOf('@');

        if (~atSignIndex) host = host.slice(atSignIndex + 1);

        splits = host.split(':');
        if (splits.length === 2) data.port = splits[1];
      }
    }

    //
    // IE quirk: The `protocol` is parsed as ":" or "" when a protocol agnostic
    // URL is used. In this case we extract the value from the `href` value.
    //
    if (!data.protocol || ':' === data.protocol) {
      data.protocol = data.href.substr(0, data.href.indexOf(':') + 1);
    }

    //
    // Safari 5.1.7 (windows) quirk: When parsing a URL without a port number
    // the `port` in the data object will default to "0" instead of the expected
    // "". We're going to do an explicit check on "0" and force it to "".
    //
    if ('0' === data.port) data.port = '';

    //
    // Browsers do not parse authorization information, so we need to extract
    // that from the URL.
    //
    if (~data.href.indexOf('@') && !data.auth) {
      var start = data.protocol.length + 2;
      data.auth = data.href.slice(start, data.href.indexOf(data.pathname, start)).split('@')[0];
    }

    return data;
  };
}

/**
 * Primus readyStates, used internally to set the correct ready state.
 *
 * @type {Number}
 * @private
 */
Primus.OPENING = 1;   // We're opening the connection.
Primus.CLOSED  = 2;   // No active connection.
Primus.OPEN    = 3;   // The connection is open.

/**
 * Are we working with a potentially broken WebSockets implementation? This
 * boolean can be used by transformers to remove `WebSockets` from their
 * supported transports.
 *
 * @type {Boolean}
 * @private
 */
Primus.prototype.AVOID_WEBSOCKETS = false;

/**
 * Some browsers support registering emitting `online` and `offline` events when
 * the connection has been dropped on the client. We're going to detect it in
 * a simple `try {} catch (e) {}` statement so we don't have to do complicated
 * feature detection.
 *
 * @type {Boolean}
 * @private
 */
Primus.prototype.NETWORK_EVENTS = false;
Primus.prototype.online = true;

try {
  if (
       Primus.prototype.NETWORK_EVENTS = 'onLine' in navigator
    && (window.addEventListener || document.body.attachEvent)
  ) {
    if (!navigator.onLine) {
      Primus.prototype.online = false;
    }
  }
} catch (e) { }

/**
 * The Ark contains all our plugins definitions. It's namespaced by
 * name => plugin.
 *
 * @type {Object}
 * @private
 */
Primus.prototype.ark = {};

/**
 * Simple emit wrapper that returns a function that emits an event once it's
 * called. This makes it easier for transports to emit specific events.
 *
 * @returns {Function} A function that will emit the event when called.
 * @api public
 */
Primus.prototype.emits = _dereq_('emits');

/**
 * A small wrapper around `emits` to add a default parser when one is not
 * supplied. The default parser will defer the emission of the event to make
 * sure that the event is emitted at the correct time.
 *
 * @returns {Function} A function that will emit the event when called.
 * @api private
 */
Primus.prototype.trigger = function trigger() {
  for (var i = 0, l = arguments.length, args = new Array(l); i < l; i++) {
    args[i] = arguments[i];
  }

  if ('function' !== typeof args[l - 1]) args.push(function defer(next) {
    setTimeout(next, 0);
  });

  return this.emits.apply(this, args);
};

/**
 * Return the given plugin.
 *
 * @param {String} name The name of the plugin.
 * @returns {Object|undefined} The plugin or undefined.
 * @api public
 */
Primus.prototype.plugin = function plugin(name) {
  context(this, 'plugin');

  if (name) return this.ark[name];

  var plugins = {};

  for (name in this.ark) {
    plugins[name] = this.ark[name];
  }

  return plugins;
};

/**
 * Checks if the given event is an emitted event by Primus.
 *
 * @param {String} evt The event name.
 * @returns {Boolean} Indication of the event is reserved for internal use.
 * @api public
 */
Primus.prototype.reserved = function reserved(evt) {
  return (/^(incoming|outgoing)::/).test(evt)
  || evt in this.reserved.events;
};

/**
 * The actual events that are used by the client.
 *
 * @type {Object}
 * @public
 */
Primus.prototype.reserved.events = {
  'reconnect scheduled': 1,
  'reconnect timeout': 1,
  'readyStateChange': 1,
  'reconnect failed': 1,
  'reconnected': 1,
  'reconnect': 1,
  'offline': 1,
  'timeout': 1,
  'online': 1,
  'error': 1,
  'close': 1,
  'open': 1,
  'data': 1,
  'end': 1
};

/**
 * Initialise the Primus and setup all parsers and internal listeners.
 *
 * @param {Object} options The original options object.
 * @returns {Primus}
 * @api private
 */
Primus.prototype.initialise = function initialise(options) {
  var primus = this
    , start;

  primus.recovery
  .on('reconnected', primus.emits('reconnected'))
  .on('reconnect failed', primus.emits('reconnect failed', function failed(data) {
    primus.emit('end');
    return data;
  }))
  .on('reconnect timeout', primus.emits('reconnect timeout'))
  .on('reconnect scheduled', primus.emits('reconnect scheduled'))
  .on('reconnect', primus.emits('reconnect', function reconnect(next) {
    primus.emit('outgoing::reconnect');
    next();
  }));

  primus.on('outgoing::open', function opening() {
    var readyState = primus.readyState;

    primus.readyState = Primus.OPENING;
    if (readyState !== primus.readyState) {
      primus.emit('readyStateChange', 'opening');
    }

    start = +new Date();
  });

  primus.on('incoming::open', function opened() {
    var readyState = primus.readyState;

    if (primus.recovery.reconnecting()) {
      primus.recovery.reconnected();
    }

    //
    // The connection has been opened so we should set our state to
    // (writ|read)able so our stream compatibility works as intended.
    //
    primus.writable = true;
    primus.readable = true;

    //
    // Make sure we are flagged as `online` as we've successfully opened the
    // connection.
    //
    if (!primus.online) {
      primus.online = true;
      primus.emit('online');
    }

    primus.readyState = Primus.OPEN;
    if (readyState !== primus.readyState) {
      primus.emit('readyStateChange', 'open');
    }

    primus.latency = +new Date() - start;
    primus.timers.clear('ping', 'pong');
    primus.heartbeat();

    if (primus.buffer.length) {
      var data = primus.buffer.slice()
        , length = data.length
        , i = 0;

      primus.buffer.length = 0;

      for (; i < length; i++) {
        primus._write(data[i]);
      }
    }

    primus.emit('open');
  });

  primus.on('incoming::pong', function pong(time) {
    primus.online = true;
    primus.timers.clear('pong');
    primus.heartbeat();

    primus.latency = (+new Date()) - time;
  });

  primus.on('incoming::error', function error(e) {
    var connect = primus.timers.active('connect')
      , err = e;

    //
    // When the error is not an Error instance we try to normalize it.
    //
    if ('string' === typeof e) {
      err = new Error(e);
    } else if (!(e instanceof Error) && 'object' === typeof e) {
      //
      // BrowserChannel and SockJS returns an object which contains some
      // details of the error. In order to have a proper error we "copy" the
      // details in an Error instance.
      //
      err = new Error(e.message || e.reason);
      for (var key in e) {
        if (Object.prototype.hasOwnProperty.call(e, key))
          err[key] = e[key];
      }
    }
    //
    // We're still doing a reconnect attempt, it could be that we failed to
    // connect because the server was down. Failing connect attempts should
    // always emit an `error` event instead of a `open` event.
    //
    //
    if (primus.recovery.reconnecting()) return primus.recovery.reconnected(err);
    if (primus.listeners('error').length) primus.emit('error', err);

    //
    // We received an error while connecting, this most likely the result of an
    // unauthorized access to the server.
    //
    if (connect) {
      if (~primus.options.strategy.indexOf('timeout')) {
        primus.recovery.reconnect();
      } else {
        primus.end();
      }
    }
  });

  primus.on('incoming::data', function message(raw) {
    primus.decoder(raw, function decoding(err, data) {
      //
      // Do a "save" emit('error') when we fail to parse a message. We don't
      // want to throw here as listening to errors should be optional.
      //
      if (err) return primus.listeners('error').length && primus.emit('error', err);

      //
      // Handle all "primus::" prefixed protocol messages.
      //
      if (primus.protocol(data)) return;
      primus.transforms(primus, primus, 'incoming', data, raw);
    });
  });

  primus.on('incoming::end', function end() {
    var readyState = primus.readyState;

    //
    // This `end` started with the receiving of a primus::server::close packet
    // which indicated that the user/developer on the server closed the
    // connection and it was not a result of a network disruption. So we should
    // kill the connection without doing a reconnect.
    //
    if (primus.disconnect) {
      primus.disconnect = false;

      return primus.end();
    }

    //
    // Always set the readyState to closed, and if we're still connecting, close
    // the connection so we're sure that everything after this if statement block
    // is only executed because our readyState is set to `open`.
    //
    primus.readyState = Primus.CLOSED;
    if (readyState !== primus.readyState) {
      primus.emit('readyStateChange', 'end');
    }

    if (primus.timers.active('connect')) primus.end();
    if (readyState !== Primus.OPEN) {
      return primus.recovery.reconnecting()
        ? primus.recovery.reconnect()
        : false;
    }

    this.writable = false;
    this.readable = false;

    //
    // Clear all timers in case we're not going to reconnect.
    //
    this.timers.clear();

    //
    // Fire the `close` event as an indication of connection disruption.
    // This is also fired by `primus#end` so it is emitted in all cases.
    //
    primus.emit('close');

    //
    // The disconnect was unintentional, probably because the server has
    // shutdown, so if the reconnection is enabled start a reconnect procedure.
    //
    if (~primus.options.strategy.indexOf('disconnect')) {
      return primus.recovery.reconnect();
    }

    primus.emit('outgoing::end');
    primus.emit('end');
  });

  //
  // Setup the real-time client.
  //
  primus.client();

  //
  // Process the potential plugins.
  //
  for (var plugin in primus.ark) {
    primus.ark[plugin].call(primus, primus, options);
  }

  //
  // NOTE: The following code is only required if we're supporting network
  // events as it requires access to browser globals.
  //
  if (!primus.NETWORK_EVENTS) return primus;

  /**
   * Handler for offline notifications.
   *
   * @api private
   */
  function offline() {
    if (!primus.online) return; // Already or still offline, bailout.

    primus.online = false;
    primus.emit('offline');
    primus.end();

    //
    // It is certainly possible that we're in a reconnection loop and that the
    // user goes offline. In this case we want to kill the existing attempt so
    // when the user goes online, it will attempt to reconnect freshly again.
    //
    primus.recovery.reset();
  }

  /**
   * Handler for online notifications.
   *
   * @api private
   */
  function online() {
    if (primus.online) return; // Already or still online, bailout.

    primus.online = true;
    primus.emit('online');

    if (~primus.options.strategy.indexOf('online')) {
      primus.recovery.reconnect();
    }
  }

  if (window.addEventListener) {
    window.addEventListener('offline', offline, false);
    window.addEventListener('online', online, false);
  } else if (document.body.attachEvent){
    document.body.attachEvent('onoffline', offline);
    document.body.attachEvent('ononline', online);
  }

  return primus;
};

/**
 * Really dead simple protocol parser. We simply assume that every message that
 * is prefixed with `primus::` could be used as some sort of protocol definition
 * for Primus.
 *
 * @param {String} msg The data.
 * @returns {Boolean} Is a protocol message.
 * @api private
 */
Primus.prototype.protocol = function protocol(msg) {
  if (
       'string' !== typeof msg
    || msg.indexOf('primus::') !== 0
  ) return false;

  var last = msg.indexOf(':', 8)
    , value = msg.slice(last + 2);

  switch (msg.slice(8,  last)) {
    case 'pong':
      this.emit('incoming::pong', value);
    break;

    case 'server':
      //
      // The server is closing the connection, forcefully disconnect so we don't
      // reconnect again.
      //
      if ('close' === value) {
        this.disconnect = true;
      }
    break;

    case 'id':
      this.emit('incoming::id', value);
    break;

    //
    // Unknown protocol, somebody is probably sending `primus::` prefixed
    // messages.
    //
    default:
      return false;
  }

  return true;
};

/**
 * Execute the set of message transformers from Primus on the incoming or
 * outgoing message.
 * This function and it's content should be in sync with Spark#transforms in
 * spark.js.
 *
 * @param {Primus} primus Reference to the Primus instance with message transformers.
 * @param {Spark|Primus} connection Connection that receives or sends data.
 * @param {String} type The type of message, 'incoming' or 'outgoing'.
 * @param {Mixed} data The data to send or that has been received.
 * @param {String} raw The raw encoded data.
 * @returns {Primus}
 * @api public
 */
Primus.prototype.transforms = function transforms(primus, connection, type, data, raw) {
  var packet = { data: data }
    , fns = primus.transformers[type];

  //
  // Iterate in series over the message transformers so we can allow optional
  // asynchronous execution of message transformers which could for example
  // retrieve additional data from the server, do extra decoding or even
  // message validation.
  //
  (function transform(index, done) {
    var transformer = fns[index++];

    if (!transformer) return done();

    if (1 === transformer.length) {
      if (false === transformer.call(connection, packet)) {
        //
        // When false is returned by an incoming transformer it means that's
        // being handled by the transformer and we should not emit the `data`
        // event.
        //
        return;
      }

      return transform(index, done);
    }

    transformer.call(connection, packet, function finished(err, arg) {
      if (err) return connection.emit('error', err);
      if (false === arg) return;

      transform(index, done);
    });
  }(0, function done() {
    //
    // We always emit 2 arguments for the data event, the first argument is the
    // parsed data and the second argument is the raw string that we received.
    // This allows you, for example, to do some validation on the parsed data
    // and then save the raw string in your database without the stringify
    // overhead.
    //
    if ('incoming' === type) return connection.emit('data', packet.data, raw);

    connection._write(packet.data);
  }));

  return this;
};

/**
 * Retrieve the current id from the server.
 *
 * @param {Function} fn Callback function.
 * @returns {Primus}
 * @api public
 */
Primus.prototype.id = function id(fn) {
  if (this.socket && this.socket.id) return fn(this.socket.id);

  this._write('primus::id::');
  return this.once('incoming::id', fn);
};

/**
 * Establish a connection with the server. When this function is called we
 * assume that we don't have any open connections. If you do call it when you
 * have a connection open, it could cause duplicate connections.
 *
 * @returns {Primus}
 * @api public
 */
Primus.prototype.open = function open() {
  context(this, 'open');

  //
  // Only start a `connection timeout` procedure if we're not reconnecting as
  // that shouldn't count as an initial connection. This should be started
  // before the connection is opened to capture failing connections and kill the
  // timeout.
  //
  if (!this.recovery.reconnecting() && this.options.timeout) this.timeout();

  this.emit('outgoing::open');
  return this;
};

/**
 * Send a new message.
 *
 * @param {Mixed} data The data that needs to be written.
 * @returns {Boolean} Always returns true as we don't support back pressure.
 * @api public
 */
Primus.prototype.write = function write(data) {
  context(this, 'write');
  this.transforms(this, this, 'outgoing', data);

  return true;
};

/**
 * The actual message writer.
 *
 * @param {Mixed} data The message that needs to be written.
 * @returns {Boolean} Successful write to the underlaying transport.
 * @api private
 */
Primus.prototype._write = function write(data) {
  var primus = this;

  //
  // The connection is closed, normally this would already be done in the
  // `spark.write` method, but as `_write` is used internally, we should also
  // add the same check here to prevent potential crashes by writing to a dead
  // socket.
  //
  if (Primus.OPEN !== primus.readyState) {
    //
    // If the buffer is at capacity, remove the first item.
    //
    if (this.buffer.length === this.options.queueSize) {
      this.buffer.splice(0, 1);
    }

    this.buffer.push(data);
    return false;
  }

  primus.encoder(data, function encoded(err, packet) {
    //
    // Do a "save" emit('error') when we fail to parse a message. We don't
    // want to throw here as listening to errors should be optional.
    //
    if (err) return primus.listeners('error').length && primus.emit('error', err);
    primus.emit('outgoing::data', packet);
  });

  return true;
};

/**
 * Send a new heartbeat over the connection to ensure that we're still
 * connected and our internet connection didn't drop. We cannot use server side
 * heartbeats for this unfortunately.
 *
 * @returns {Primus}
 * @api private
 */
Primus.prototype.heartbeat = function heartbeat() {
  var primus = this;

  if (!primus.options.ping) return primus;

  /**
   * Exterminate the connection as we've timed out.
   *
   * @api private
   */
  function pong() {
    primus.timers.clear('pong');

    //
    // The network events already captured the offline event.
    //
    if (!primus.online) return;

    primus.online = false;
    primus.emit('offline');
    primus.emit('incoming::end');
  }

  /**
   * We should send a ping message to the server.
   *
   * @api private
   */
  function ping() {
    var value = +new Date();

    primus.timers.clear('ping');
    primus._write('primus::ping::'+ value);
    primus.emit('outgoing::ping', value);
    primus.timers.setTimeout('pong', pong, primus.options.pong);
  }

  primus.timers.setTimeout('ping', ping, primus.options.ping);
  return this;
};

/**
 * Start a connection timeout.
 *
 * @returns {Primus}
 * @api private
 */
Primus.prototype.timeout = function timeout() {
  var primus = this;

  /**
   * Remove all references to the timeout listener as we've received an event
   * that can be used to determine state.
   *
   * @api private
   */
  function remove() {
    primus.removeListener('error', remove)
          .removeListener('open', remove)
          .removeListener('end', remove)
          .timers.clear('connect');
  }

  primus.timers.setTimeout('connect', function expired() {
    remove(); // Clean up old references.

    if (primus.readyState === Primus.OPEN || primus.recovery.reconnecting()) {
      return;
    }

    primus.emit('timeout');

    //
    // We failed to connect to the server.
    //
    if (~primus.options.strategy.indexOf('timeout')) {
      primus.recovery.reconnect();
    } else {
      primus.end();
    }
  }, primus.options.timeout);

  return primus.on('error', remove)
    .on('open', remove)
    .on('end', remove);
};

/**
 * Close the connection completely.
 *
 * @param {Mixed} data last packet of data.
 * @returns {Primus}
 * @api public
 */
Primus.prototype.end = function end(data) {
  context(this, 'end');

  if (this.readyState === Primus.CLOSED && !this.timers.active('connect')) {
    //
    // If we are reconnecting stop the reconnection procedure.
    //
    if (this.recovery.reconnecting()) {
      this.recovery.reset();
      this.emit('end');
    }

    return this;
  }

  if (data !== undefined) this.write(data);

  this.writable = false;
  this.readable = false;

  var readyState = this.readyState;
  this.readyState = Primus.CLOSED;

  if (readyState !== this.readyState) {
    this.emit('readyStateChange', 'end');
  }

  this.timers.clear();
  this.emit('outgoing::end');
  this.emit('close');
  this.emit('end');

  return this;
};

/**
 * Completely demolish the Primus instance and forcefully nuke all references.
 *
 * @returns {Boolean}
 * @api public
 */
Primus.prototype.destroy = destroy('url timers options recovery socket transport transformers', {
  before: 'end',
  after: 'removeAllListeners'
});

/**
 * Create a shallow clone of a given object.
 *
 * @param {Object} obj The object that needs to be cloned.
 * @returns {Object} Copy.
 * @api private
 */
Primus.prototype.clone = function clone(obj) {
  return this.merge({}, obj);
};

/**
 * Merge different objects in to one target object.
 *
 * @param {Object} target The object where everything should be merged in.
 * @returns {Object} Original target with all merged objects.
 * @api private
 */
Primus.prototype.merge = function merge(target) {
  var args = Array.prototype.slice.call(arguments, 1);

  for (var i = 0, l = args.length, key, obj; i < l; i++) {
    obj = args[i];

    for (key in obj) {
      if (obj.hasOwnProperty(key)) target[key] = obj[key];
    }
  }

  return target;
};

/**
 * Parse the connection string.
 *
 * @type {Function}
 * @param {String} url Connection URL.
 * @returns {Object} Parsed connection.
 * @api private
 */
Primus.prototype.parse = parse;

/**
 * Parse a query string.
 *
 * @param {String} query The query string that needs to be parsed.
 * @returns {Object} Parsed query string.
 * @api private
 */
Primus.prototype.querystring = qs.parse;
/**
 * Transform a query string object back into string equiv.
 *
 * @param {Object} obj The query string object.
 * @returns {String}
 * @api private
 */
Primus.prototype.querystringify = qs.stringify;

/**
 * Generates a connection URI.
 *
 * @param {String} protocol The protocol that should used to crate the URI.
 * @returns {String|options} The URL.
 * @api private
 */
Primus.prototype.uri = function uri(options) {
  var url = this.url
    , server = []
    , qsa = false;

  //
  // Query strings are only allowed when we've received clearance for it.
  //
  if (options.query) qsa = true;

  options = options || {};
  options.protocol = 'protocol' in options ? options.protocol : 'http';
  options.query = url.search && 'query' in options ? (url.search.charAt(0) === '?' ? url.search.slice(1) : url.search) : false;
  options.secure = 'secure' in options ? options.secure : (url.protocol === 'https:' || url.protocol === 'wss:');
  options.auth = 'auth' in options ? options.auth : url.auth;
  options.pathname = 'pathname' in options ? options.pathname : this.pathname.slice(1);
  options.port = 'port' in options ? +options.port : +url.port || (options.secure ? 443 : 80);
  options.host = 'host' in options ? options.host : url.hostname || url.host.replace(':'+ url.port, '');

  //
  // Allow transformation of the options before we construct a full URL from it.
  //
  this.emit('outgoing::url', options);

  //
  // `url.host` might be undefined (e.g. when using zombie) so we use the
  // hostname and port defined above.
  //
  var host = (443 !== options.port && 80 !== options.port)
    ? options.host +':'+ options.port
    : options.host;

  //
  // We need to make sure that we create a unique connection URL every time to
  // prevent back forward cache from becoming an issue. We're doing this by
  // forcing an cache busting query string in to the URL.
  //
  var querystring = this.querystring(options.query || '');
  querystring._primuscb = +new Date() +'-'+ this.stamps++;
  options.query = this.querystringify(querystring);

  //
  // Automatically suffix the protocol so we can supply `ws` and `http` and it gets
  // transformed correctly.
  //
  server.push(options.secure ? options.protocol +'s:' : options.protocol +':', '');

  if (options.auth) server.push(options.auth +'@'+ host);
  else server.push(host);

  //
  // Pathnames are optional as some Transformers would just use the pathname
  // directly.
  //
  if (options.pathname) server.push(options.pathname);

  //
  // Optionally add a search query.
  //
  if (qsa) server.push('?'+ options.query);
  else delete options.query;

  if (options.object) return options;
  return server.join('/');
};

/**
 * Register a new message transformer. This allows you to easily manipulate incoming
 * and outgoing data which is particularity handy for plugins that want to send
 * meta data together with the messages.
 *
 * @param {String} type Incoming or outgoing
 * @param {Function} fn A new message transformer.
 * @returns {Primus}
 * @api public
 */
Primus.prototype.transform = function transform(type, fn) {
  context(this, 'transform');

  if (!(type in this.transformers)) {
    return this.critical(new Error('Invalid transformer type'));
  }

  this.transformers[type].push(fn);
  return this;
};

/**
 * A critical error has occurred, if we have an `error` listener, emit it there.
 * If not, throw it, so we get a stack trace + proper error message.
 *
 * @param {Error} err The critical error.
 * @returns {Primus}
 * @api private
 */
Primus.prototype.critical = function critical(err) {
  if (this.listeners('error').length) {
    this.emit('error', err);
    return this;
  }

  throw err;
};

/**
 * Syntax sugar, adopt a Socket.IO like API.
 *
 * @param {String} url The URL we want to connect to.
 * @param {Object} options Connection options.
 * @returns {Primus}
 * @api public
 */
Primus.connect = function connect(url, options) {
  return new Primus(url, options);
};

//
// Expose the EventEmitter so it can be re-used by wrapping libraries we're also
// exposing the Stream interface.
//
Primus.EventEmitter = EventEmitter;

//
// These libraries are automatically are automatically inserted at the
// server-side using the Primus#library method.
//
Primus.prototype.client = function client() {
  var onmessage = this.trigger('incoming::data')
    , onerror = this.trigger('incoming::error')
    , onopen = this.trigger('incoming::open')
    , onclose = this.trigger('incoming::end')
    , primus = this
    , socket;

  //
  // Select an available Engine.IO factory.
  //
  var factory = (function factory() {
    if ('undefined' !== typeof eio) return eio;

    try { return Primus.require('engine.io-client'); }
    catch (e) {}

    return undefined;
  })();

  if (!factory) return primus.critical(new Error(
    'Missing required `engine.io-client` module. ' +
    'Please run `npm install --save engine.io-client`'
  ));

  //
  // Connect to the given URL.
  //
  primus.on('outgoing::open', function opening() {
    primus.emit('outgoing::end');

    primus.socket = socket = factory(primus.merge(primus.transport,
      primus.url,
      primus.uri({ protocol: 'http', query: true, object: true }), {
      //
      // Never remember upgrades as switching from a WIFI to a 3G connection
      // could still get your connection blocked as 3G connections are usually
      // behind a reverse proxy so ISP's can optimize mobile traffic by
      // caching requests.
      //
      rememberUpgrade: false,

      //
      // Binary support in Engine.IO breaks a shit things. Turn it off for now.
      //
      forceBase64: true,

      //
      // XDR has been the source of pain for most real-time users. It doesn't
      // support the full CORS spec and is infested with bugs. It cannot connect
      // cross-scheme, does not send ANY authorization information like Cookies,
      // Basic Authorization headers etc. Force this off by default to ensure a
      // stable connection.
      //
      enablesXDR: false,

      //
      // Force timestamps on every single connection. Engine.IO only does this
      // for polling by default, but WebSockets require an explicit `true`
      // boolean.
      //
      timestampRequests: true,
      path: this.pathname,
      transports: !primus.AVOID_WEBSOCKETS
        ? ['polling', 'websocket']
        : ['polling']
    }));

    //
    // Nuke a growing memory leak as Engine.IO pushes instances in to an exposed
    // `sockets` array.
    //
    if (factory.sockets && factory.sockets.length) {
      factory.sockets.length = 0;
    }

    //
    // Setup the Event handlers.
    //
    socket.on('message', onmessage);
    socket.on('error', onerror);
    socket.on('close', onclose);
    socket.on('open', onopen);
  });

  //
  // We need to write a new message to the socket.
  //
  primus.on('outgoing::data', function write(message) {
    if (socket) socket.send(message);
  });

  //
  // Attempt to reconnect the socket.
  //
  primus.on('outgoing::reconnect', function reconnect() {
    primus.emit('outgoing::open');
  });

  //
  // We need to close the socket.
  //
  primus.on('outgoing::end', function close() {
    if (!socket) return;

    socket.removeListener('message', onmessage);
    socket.removeListener('error', onerror);
    socket.removeListener('close', onclose);
    socket.removeListener('open', onopen);
    socket.close();
    socket = null;
  });
};
Primus.prototype.authorization = false;
Primus.prototype.pathname = "/sugar";
Primus.prototype.encoder = function encoder(data, fn) {
  var err;

  try { data = JSON.stringify(data); }
  catch (e) { err = e; }

  fn(err, data);
};
Primus.prototype.decoder = function decoder(data, fn) {
  var err;

  if ('string' !== typeof data) return fn(err, data);

  try { data = JSON.parse(data); }
  catch (e) { err = e; }

  fn(err, data);
};
Primus.prototype.version = "3.0.2";

//
// Hack 1: \u2028 and \u2029 are allowed inside string in JSON. But JavaScript
// defines them as newline separators. Because no literal newlines are allowed
// in a string this causes a ParseError. We work around this issue by replacing
// these characters with a properly escaped version for those chars. This can
// cause errors with JSONP requests or if the string is just evaluated.
//
// This could have been solved by replacing the data during the "outgoing::data"
// event. But as it affects the JSON encoding in general I've opted for a global
// patch instead so all JSON.stringify operations are save.
//
if (
    'object' === typeof JSON
 && 'function' === typeof JSON.stringify
 && JSON.stringify(['\u2028\u2029']) === '["\u2028\u2029"]'
) {
  JSON.stringify = function replace(stringify) {
    var u2028 = /\u2028/g
      , u2029 = /\u2029/g;

    return function patched(value, replacer, spaces) {
      var result = stringify.call(this, value, replacer, spaces);

      //
      // Replace the bad chars.
      //
      if (result) {
        if (~result.indexOf('\u2028')) result = result.replace(u2028, '\\u2028');
        if (~result.indexOf('\u2029')) result = result.replace(u2029, '\\u2029');
      }

      return result;
    };
  }(JSON.stringify);
}

if (
     'undefined' !== typeof document
  && 'undefined' !== typeof navigator
) {
  //
  // Hack 2: If you press ESC in FireFox it will close all active connections.
  // Normally this makes sense, when your page is still loading. But versions
  // before FireFox 22 will close all connections including WebSocket connections
  // after page load. One way to prevent this is to do a `preventDefault()` and
  // cancel the operation before it bubbles up to the browsers default handler.
  // It needs to be added as `keydown` event, if it's added keyup it will not be
  // able to prevent the connection from being closed.
  //
  if (document.addEventListener) {
    document.addEventListener('keydown', function keydown(e) {
      if (e.keyCode !== 27 || !e.preventDefault) return;

      e.preventDefault();
    }, false);
  }

  //
  // Hack 3: This is a Mac/Apple bug only, when you're behind a reverse proxy or
  // have you network settings set to `automatic proxy discovery` the safari
  // browser will crash when the WebSocket constructor is initialised. There is
  // no way to detect the usage of these proxies available in JavaScript so we
  // need to do some nasty browser sniffing. This only affects Safari versions
  // lower then 5.1.4
  //
  var ua = (navigator.userAgent || '').toLowerCase()
    , parsed = ua.match(/.+(?:rv|it|ra|ie)[\/: ](\d+)\.(\d+)(?:\.(\d+))?/) || []
    , version = +[parsed[1], parsed[2]].join('.');

  if (
       !~ua.indexOf('chrome')
    && ~ua.indexOf('safari')
    && version < 534.54
  ) {
    Primus.prototype.AVOID_WEBSOCKETS = true;
  }
}

//
// Expose the library.
//
module.exports = Primus;

},{"demolish":1,"emits":2,"eventemitter3":3,"querystringify":4,"recovery":5,"tick-tock":8}]},{},[10])(10);
  return Primus;
});

(function libraryWrap(Primus) {
!function(e){var f;'undefined'!=typeof window?f=window:'undefined'!=typeof self&&(f=self),f.eio=e()}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){

module.exports =  _dereq_('./lib/');

},{"./lib/":2}],2:[function(_dereq_,module,exports){

module.exports = _dereq_('./socket');

/**
 * Exports parser
 *
 * @api public
 *
 */
module.exports.parser = _dereq_('engine.io-parser');

},{"./socket":3,"engine.io-parser":16}],3:[function(_dereq_,module,exports){
(function (global){
/**
 * Module dependencies.
 */

var transports = _dereq_('./transports');
var Emitter = _dereq_('component-emitter');
var debug = _dereq_('debug')('engine.io-client:socket');
var index = _dereq_('indexof');
var parser = _dereq_('engine.io-parser');
var parseuri = _dereq_('parseuri');
var parsejson = _dereq_('parsejson');
var parseqs = _dereq_('parseqs');

/**
 * Module exports.
 */

module.exports = Socket;

/**
 * Noop function.
 *
 * @api private
 */

function noop(){}

/**
 * Socket constructor.
 *
 * @param {String|Object} uri or options
 * @param {Object} options
 * @api public
 */

function Socket(uri, opts){
  if (!(this instanceof Socket)) return new Socket(uri, opts);

  opts = opts || {};

  if (uri && 'object' == typeof uri) {
    opts = uri;
    uri = null;
  }

  if (uri) {
    uri = parseuri(uri);
    opts.host = uri.host;
    opts.secure = uri.protocol == 'https' || uri.protocol == 'wss';
    opts.port = uri.port;
    if (uri.query) opts.query = uri.query;
  }

  this.secure = null != opts.secure ? opts.secure :
    (global.location && 'https:' == location.protocol);

  if (opts.host) {
    var pieces = opts.host.split(':');
    opts.hostname = pieces.shift();
    if (pieces.length) {
      opts.port = pieces.pop();
    } else if (!opts.port) {
      // if no port is specified manually, use the protocol default
      opts.port = this.secure ? '443' : '80';
    }
  }

  this.agent = opts.agent || false;
  this.hostname = opts.hostname ||
    (global.location ? location.hostname : 'localhost');
  this.port = opts.port || (global.location && location.port ?
       location.port :
       (this.secure ? 443 : 80));
  this.query = opts.query || {};
  if ('string' == typeof this.query) this.query = parseqs.decode(this.query);
  this.upgrade = false !== opts.upgrade;
  this.path = (opts.path || '/engine.io').replace(/\/$/, '') + '/';
  this.forceJSONP = !!opts.forceJSONP;
  this.jsonp = false !== opts.jsonp;
  this.forceBase64 = !!opts.forceBase64;
  this.enablesXDR = !!opts.enablesXDR;
  this.timestampParam = opts.timestampParam || 't';
  this.timestampRequests = opts.timestampRequests;
  this.transports = opts.transports || ['polling', 'websocket'];
  this.readyState = '';
  this.writeBuffer = [];
  this.callbackBuffer = [];
  this.policyPort = opts.policyPort || 843;
  this.rememberUpgrade = opts.rememberUpgrade || false;
  this.binaryType = null;
  this.onlyBinaryUpgrades = opts.onlyBinaryUpgrades;

  // SSL options for Node.js client
  this.pfx = opts.pfx || null;
  this.key = opts.key || null;
  this.passphrase = opts.passphrase || null;
  this.cert = opts.cert || null;
  this.ca = opts.ca || null;
  this.ciphers = opts.ciphers || null;
  this.rejectUnauthorized = opts.rejectUnauthorized || null;

  this.open();
}

Socket.priorWebsocketSuccess = false;

/**
 * Mix in `Emitter`.
 */

Emitter(Socket.prototype);

/**
 * Protocol version.
 *
 * @api public
 */

Socket.protocol = parser.protocol; // this is an int

/**
 * Expose deps for legacy compatibility
 * and standalone browser access.
 */

Socket.Socket = Socket;
Socket.Transport = _dereq_('./transport');
Socket.transports = _dereq_('./transports');
Socket.parser = _dereq_('engine.io-parser');

/**
 * Creates transport of the given type.
 *
 * @param {String} transport name
 * @return {Transport}
 * @api private
 */

Socket.prototype.createTransport = function (name) {
  debug('creating transport "%s"', name);
  var query = clone(this.query);

  // append engine.io protocol identifier
  query.EIO = parser.protocol;

  // transport name
  query.transport = name;

  // session id if we already have one
  if (this.id) query.sid = this.id;

  var transport = new transports[name]({
    agent: this.agent,
    hostname: this.hostname,
    port: this.port,
    secure: this.secure,
    path: this.path,
    query: query,
    forceJSONP: this.forceJSONP,
    jsonp: this.jsonp,
    forceBase64: this.forceBase64,
    enablesXDR: this.enablesXDR,
    timestampRequests: this.timestampRequests,
    timestampParam: this.timestampParam,
    policyPort: this.policyPort,
    socket: this,
    pfx: this.pfx,
    key: this.key,
    passphrase: this.passphrase,
    cert: this.cert,
    ca: this.ca,
    ciphers: this.ciphers,
    rejectUnauthorized: this.rejectUnauthorized
  });

  return transport;
};

function clone (obj) {
  var o = {};
  for (var i in obj) {
    if (obj.hasOwnProperty(i)) {
      o[i] = obj[i];
    }
  }
  return o;
}

/**
 * Initializes transport to use and starts probe.
 *
 * @api private
 */
Socket.prototype.open = function () {
  var transport;
  if (this.rememberUpgrade && Socket.priorWebsocketSuccess && this.transports.indexOf('websocket') != -1) {
    transport = 'websocket';
  } else if (0 == this.transports.length) {
    // Emit error on next tick so it can be listened to
    var self = this;
    setTimeout(function() {
      self.emit('error', 'No transports available');
    }, 0);
    return;
  } else {
    transport = this.transports[0];
  }
  this.readyState = 'opening';

  // Retry with the next transport if the transport is disabled (jsonp: false)
  var transport;
  try {
    transport = this.createTransport(transport);
  } catch (e) {
    this.transports.shift();
    this.open();
    return;
  }

  transport.open();
  this.setTransport(transport);
};

/**
 * Sets the current transport. Disables the existing one (if any).
 *
 * @api private
 */

Socket.prototype.setTransport = function(transport){
  debug('setting transport %s', transport.name);
  var self = this;

  if (this.transport) {
    debug('clearing existing transport %s', this.transport.name);
    this.transport.removeAllListeners();
  }

  // set up transport
  this.transport = transport;

  // set up transport listeners
  transport
  .on('drain', function(){
    self.onDrain();
  })
  .on('packet', function(packet){
    self.onPacket(packet);
  })
  .on('error', function(e){
    self.onError(e);
  })
  .on('close', function(){
    self.onClose('transport close');
  });
};

/**
 * Probes a transport.
 *
 * @param {String} transport name
 * @api private
 */

Socket.prototype.probe = function (name) {
  debug('probing transport "%s"', name);
  var transport = this.createTransport(name, { probe: 1 })
    , failed = false
    , self = this;

  Socket.priorWebsocketSuccess = false;

  function onTransportOpen(){
    if (self.onlyBinaryUpgrades) {
      var upgradeLosesBinary = !this.supportsBinary && self.transport.supportsBinary;
      failed = failed || upgradeLosesBinary;
    }
    if (failed) return;

    debug('probe transport "%s" opened', name);
    transport.send([{ type: 'ping', data: 'probe' }]);
    transport.once('packet', function (msg) {
      if (failed) return;
      if ('pong' == msg.type && 'probe' == msg.data) {
        debug('probe transport "%s" pong', name);
        self.upgrading = true;
        self.emit('upgrading', transport);
        if (!transport) return;
        Socket.priorWebsocketSuccess = 'websocket' == transport.name;

        debug('pausing current transport "%s"', self.transport.name);
        self.transport.pause(function () {
          if (failed) return;
          if ('closed' == self.readyState) return;
          debug('changing transport and sending upgrade packet');

          cleanup();

          self.setTransport(transport);
          transport.send([{ type: 'upgrade' }]);
          self.emit('upgrade', transport);
          transport = null;
          self.upgrading = false;
          self.flush();
        });
      } else {
        debug('probe transport "%s" failed', name);
        var err = new Error('probe error');
        err.transport = transport.name;
        self.emit('upgradeError', err);
      }
    });
  }

  function freezeTransport() {
    if (failed) return;

    // Any callback called by transport should be ignored since now
    failed = true;

    cleanup();

    transport.close();
    transport = null;
  }

  //Handle any error that happens while probing
  function onerror(err) {
    var error = new Error('probe error: ' + err);
    error.transport = transport.name;

    freezeTransport();

    debug('probe transport "%s" failed because of error: %s', name, err);

    self.emit('upgradeError', error);
  }

  function onTransportClose(){
    onerror("transport closed");
  }

  //When the socket is closed while we're probing
  function onclose(){
    onerror("socket closed");
  }

  //When the socket is upgraded while we're probing
  function onupgrade(to){
    if (transport && to.name != transport.name) {
      debug('"%s" works - aborting "%s"', to.name, transport.name);
      freezeTransport();
    }
  }

  //Remove all listeners on the transport and on self
  function cleanup(){
    transport.removeListener('open', onTransportOpen);
    transport.removeListener('error', onerror);
    transport.removeListener('close', onTransportClose);
    self.removeListener('close', onclose);
    self.removeListener('upgrading', onupgrade);
  }

  transport.once('open', onTransportOpen);
  transport.once('error', onerror);
  transport.once('close', onTransportClose);

  this.once('close', onclose);
  this.once('upgrading', onupgrade);

  transport.open();

};

/**
 * Called when connection is deemed open.
 *
 * @api public
 */

Socket.prototype.onOpen = function () {
  debug('socket open');
  this.readyState = 'open';
  Socket.priorWebsocketSuccess = 'websocket' == this.transport.name;
  this.emit('open');
  this.flush();

  // we check for `readyState` in case an `open`
  // listener already closed the socket
  if ('open' == this.readyState && this.upgrade && this.transport.pause) {
    debug('starting upgrade probes');
    for (var i = 0, l = this.upgrades.length; i < l; i++) {
      this.probe(this.upgrades[i]);
    }
  }
};

/**
 * Handles a packet.
 *
 * @api private
 */

Socket.prototype.onPacket = function (packet) {
  if ('opening' == this.readyState || 'open' == this.readyState) {
    debug('socket receive: type "%s", data "%s"', packet.type, packet.data);

    this.emit('packet', packet);

    // Socket is live - any packet counts
    this.emit('heartbeat');

    switch (packet.type) {
      case 'open':
        this.onHandshake(parsejson(packet.data));
        break;

      case 'pong':
        this.setPing();
        break;

      case 'error':
        var err = new Error('server error');
        err.code = packet.data;
        this.emit('error', err);
        break;

      case 'message':
        this.emit('data', packet.data);
        this.emit('message', packet.data);
        break;
    }
  } else {
    debug('packet received with socket readyState "%s"', this.readyState);
  }
};

/**
 * Called upon handshake completion.
 *
 * @param {Object} handshake obj
 * @api private
 */

Socket.prototype.onHandshake = function (data) {
  this.emit('handshake', data);
  this.id = data.sid;
  this.transport.query.sid = data.sid;
  this.upgrades = this.filterUpgrades(data.upgrades);
  this.pingInterval = data.pingInterval;
  this.pingTimeout = data.pingTimeout;
  this.onOpen();
  // In case open handler closes socket
  if  ('closed' == this.readyState) return;
  this.setPing();

  // Prolong liveness of socket on heartbeat
  this.removeListener('heartbeat', this.onHeartbeat);
  this.on('heartbeat', this.onHeartbeat);
};

/**
 * Resets ping timeout.
 *
 * @api private
 */

Socket.prototype.onHeartbeat = function (timeout) {
  clearTimeout(this.pingTimeoutTimer);
  var self = this;
  self.pingTimeoutTimer = setTimeout(function () {
    if ('closed' == self.readyState) return;
    self.onClose('ping timeout');
  }, timeout || (self.pingInterval + self.pingTimeout));
};

/**
 * Pings server every `this.pingInterval` and expects response
 * within `this.pingTimeout` or closes connection.
 *
 * @api private
 */

Socket.prototype.setPing = function () {
  var self = this;
  clearTimeout(self.pingIntervalTimer);
  self.pingIntervalTimer = setTimeout(function () {
    debug('writing ping packet - expecting pong within %sms', self.pingTimeout);
    self.ping();
    self.onHeartbeat(self.pingTimeout);
  }, self.pingInterval);
};

/**
* Sends a ping packet.
*
* @api public
*/

Socket.prototype.ping = function () {
  this.sendPacket('ping');
};

/**
 * Called on `drain` event
 *
 * @api private
 */

Socket.prototype.onDrain = function() {
  for (var i = 0; i < this.prevBufferLen; i++) {
    if (this.callbackBuffer[i]) {
      this.callbackBuffer[i]();
    }
  }

  this.writeBuffer.splice(0, this.prevBufferLen);
  this.callbackBuffer.splice(0, this.prevBufferLen);

  // setting prevBufferLen = 0 is very important
  // for example, when upgrading, upgrade packet is sent over,
  // and a nonzero prevBufferLen could cause problems on `drain`
  this.prevBufferLen = 0;

  if (this.writeBuffer.length == 0) {
    this.emit('drain');
  } else {
    this.flush();
  }
};

/**
 * Flush write buffers.
 *
 * @api private
 */

Socket.prototype.flush = function () {
  if ('closed' != this.readyState && this.transport.writable &&
    !this.upgrading && this.writeBuffer.length) {
    debug('flushing %d packets in socket', this.writeBuffer.length);
    this.transport.send(this.writeBuffer);
    // keep track of current length of writeBuffer
    // splice writeBuffer and callbackBuffer on `drain`
    this.prevBufferLen = this.writeBuffer.length;
    this.emit('flush');
  }
};

/**
 * Sends a message.
 *
 * @param {String} message.
 * @param {Function} callback function.
 * @return {Socket} for chaining.
 * @api public
 */

Socket.prototype.write =
Socket.prototype.send = function (msg, fn) {
  this.sendPacket('message', msg, fn);
  return this;
};

/**
 * Sends a packet.
 *
 * @param {String} packet type.
 * @param {String} data.
 * @param {Function} callback function.
 * @api private
 */

Socket.prototype.sendPacket = function (type, data, fn) {
  if ('closing' == this.readyState || 'closed' == this.readyState) {
    return;
  }

  var packet = { type: type, data: data };
  this.emit('packetCreate', packet);
  this.writeBuffer.push(packet);
  this.callbackBuffer.push(fn);
  this.flush();
};

/**
 * Closes the connection.
 *
 * @api private
 */

Socket.prototype.close = function () {
  if ('opening' == this.readyState || 'open' == this.readyState) {
    this.readyState = 'closing';

    var self = this;

    function close() {
      self.onClose('forced close');
      debug('socket closing - telling transport to close');
      self.transport.close();
    }

    function cleanupAndClose() {
      self.removeListener('upgrade', cleanupAndClose);
      self.removeListener('upgradeError', cleanupAndClose);
      close();
    }

    function waitForUpgrade() {
      // wait for upgrade to finish since we can't send packets while pausing a transport
      self.once('upgrade', cleanupAndClose);
      self.once('upgradeError', cleanupAndClose);
    }

    if (this.writeBuffer.length) {
      this.once('drain', function() {
        if (this.upgrading) {
          waitForUpgrade();
        } else {
          close();
        }
      });
    } else if (this.upgrading) {
      waitForUpgrade();
    } else {
      close();
    }
  }

  return this;
};

/**
 * Called upon transport error
 *
 * @api private
 */

Socket.prototype.onError = function (err) {
  debug('socket error %j', err);
  Socket.priorWebsocketSuccess = false;
  this.emit('error', err);
  this.onClose('transport error', err);
};

/**
 * Called upon transport close.
 *
 * @api private
 */

Socket.prototype.onClose = function (reason, desc) {
  if ('opening' == this.readyState || 'open' == this.readyState || 'closing' == this.readyState) {
    debug('socket close with reason: "%s"', reason);
    var self = this;

    // clear timers
    clearTimeout(this.pingIntervalTimer);
    clearTimeout(this.pingTimeoutTimer);

    // clean buffers in next tick, so developers can still
    // grab the buffers on `close` event
    setTimeout(function() {
      self.writeBuffer = [];
      self.callbackBuffer = [];
      self.prevBufferLen = 0;
    }, 0);

    // stop event from firing again for transport
    this.transport.removeAllListeners('close');

    // ensure transport won't stay open
    this.transport.close();

    // ignore further transport communication
    this.transport.removeAllListeners();

    // set ready state
    this.readyState = 'closed';

    // clear session id
    this.id = null;

    // emit close event
    this.emit('close', reason, desc);
  }
};

/**
 * Filters upgrades, returning only those matching client transports.
 *
 * @param {Array} server upgrades
 * @api private
 *
 */

Socket.prototype.filterUpgrades = function (upgrades) {
  var filteredUpgrades = [];
  for (var i = 0, j = upgrades.length; i<j; i++) {
    if (~index(this.transports, upgrades[i])) filteredUpgrades.push(upgrades[i]);
  }
  return filteredUpgrades;
};

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./transport":4,"./transports":5,"component-emitter":11,"debug":13,"engine.io-parser":16,"indexof":27,"parsejson":28,"parseqs":29,"parseuri":30}],4:[function(_dereq_,module,exports){
/**
 * Module dependencies.
 */

var parser = _dereq_('engine.io-parser');
var Emitter = _dereq_('component-emitter');

/**
 * Module exports.
 */

module.exports = Transport;

/**
 * Transport abstract constructor.
 *
 * @param {Object} options.
 * @api private
 */

function Transport (opts) {
  this.path = opts.path;
  this.hostname = opts.hostname;
  this.port = opts.port;
  this.secure = opts.secure;
  this.query = opts.query;
  this.timestampParam = opts.timestampParam;
  this.timestampRequests = opts.timestampRequests;
  this.readyState = '';
  this.agent = opts.agent || false;
  this.socket = opts.socket;
  this.enablesXDR = opts.enablesXDR;

  // SSL options for Node.js client
  this.pfx = opts.pfx;
  this.key = opts.key;
  this.passphrase = opts.passphrase;
  this.cert = opts.cert;
  this.ca = opts.ca;
  this.ciphers = opts.ciphers;
  this.rejectUnauthorized = opts.rejectUnauthorized;
}

/**
 * Mix in `Emitter`.
 */

Emitter(Transport.prototype);

/**
 * A counter used to prevent collisions in the timestamps used
 * for cache busting.
 */

Transport.timestamps = 0;

/**
 * Emits an error.
 *
 * @param {String} str
 * @return {Transport} for chaining
 * @api public
 */

Transport.prototype.onError = function (msg, desc) {
  var err = new Error(msg);
  err.type = 'TransportError';
  err.description = desc;
  this.emit('error', err);
  return this;
};

/**
 * Opens the transport.
 *
 * @api public
 */

Transport.prototype.open = function () {
  if ('closed' == this.readyState || '' == this.readyState) {
    this.readyState = 'opening';
    this.doOpen();
  }

  return this;
};

/**
 * Closes the transport.
 *
 * @api private
 */

Transport.prototype.close = function () {
  if ('opening' == this.readyState || 'open' == this.readyState) {
    this.doClose();
    this.onClose();
  }

  return this;
};

/**
 * Sends multiple packets.
 *
 * @param {Array} packets
 * @api private
 */

Transport.prototype.send = function(packets){
  if ('open' == this.readyState) {
    this.write(packets);
  } else {
    throw new Error('Transport not open');
  }
};

/**
 * Called upon open
 *
 * @api private
 */

Transport.prototype.onOpen = function () {
  this.readyState = 'open';
  this.writable = true;
  this.emit('open');
};

/**
 * Called with data.
 *
 * @param {String} data
 * @api private
 */

Transport.prototype.onData = function(data){
  var packet = parser.decodePacket(data, this.socket.binaryType);
  this.onPacket(packet);
};

/**
 * Called with a decoded packet.
 */

Transport.prototype.onPacket = function (packet) {
  this.emit('packet', packet);
};

/**
 * Called upon close.
 *
 * @api private
 */

Transport.prototype.onClose = function () {
  this.readyState = 'closed';
  this.emit('close');
};

},{"component-emitter":11,"engine.io-parser":16}],5:[function(_dereq_,module,exports){
(function (global){
/**
 * Module dependencies
 */

var XMLHttpRequest = _dereq_('xmlhttprequest');
var XHR = _dereq_('./polling-xhr');
var JSONP = _dereq_('./polling-jsonp');
var websocket = _dereq_('./websocket');

/**
 * Export transports.
 */

exports.polling = polling;
exports.websocket = websocket;

/**
 * Polling transport polymorphic constructor.
 * Decides on xhr vs jsonp based on feature detection.
 *
 * @api private
 */

function polling(opts){
  var xhr;
  var xd = false;
  var xs = false;
  var jsonp = false !== opts.jsonp;

  if (global.location) {
    var isSSL = 'https:' == location.protocol;
    var port = location.port;

    // some user agents have empty `location.port`
    if (!port) {
      port = isSSL ? 443 : 80;
    }

    xd = opts.hostname != location.hostname || port != opts.port;
    xs = opts.secure != isSSL;
  }

  opts.xdomain = xd;
  opts.xscheme = xs;
  xhr = new XMLHttpRequest(opts);

  if ('open' in xhr && !opts.forceJSONP) {
    return new XHR(opts);
  } else {
    if (!jsonp) throw new Error('JSONP disabled');
    return new JSONP(opts);
  }
}

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest":10}],6:[function(_dereq_,module,exports){
(function (global){

/**
 * Module requirements.
 */

var Polling = _dereq_('./polling');
var inherit = _dereq_('component-inherit');

/**
 * Module exports.
 */

module.exports = JSONPPolling;

/**
 * Cached regular expressions.
 */

var rNewline = /\n/g;
var rEscapedNewline = /\\n/g;

/**
 * Global JSONP callbacks.
 */

var callbacks;

/**
 * Callbacks count.
 */

var index = 0;

/**
 * Noop.
 */

function empty () { }

/**
 * JSONP Polling constructor.
 *
 * @param {Object} opts.
 * @api public
 */

function JSONPPolling (opts) {
  Polling.call(this, opts);

  this.query = this.query || {};

  // define global callbacks array if not present
  // we do this here (lazily) to avoid unneeded global pollution
  if (!callbacks) {
    // we need to consider multiple engines in the same page
    if (!global.___eio) global.___eio = [];
    callbacks = global.___eio;
  }

  // callback identifier
  this.index = callbacks.length;

  // add callback to jsonp global
  var self = this;
  callbacks.push(function (msg) {
    self.onData(msg);
  });

  // append to query string
  this.query.j = this.index;

  // prevent spurious errors from being emitted when the window is unloaded
  if (global.document && global.addEventListener) {
    global.addEventListener('beforeunload', function () {
      if (self.script) self.script.onerror = empty;
    }, false);
  }
}

/**
 * Inherits from Polling.
 */

inherit(JSONPPolling, Polling);

/*
 * JSONP only supports binary as base64 encoded strings
 */

JSONPPolling.prototype.supportsBinary = false;

/**
 * Closes the socket.
 *
 * @api private
 */

JSONPPolling.prototype.doClose = function () {
  if (this.script) {
    this.script.parentNode.removeChild(this.script);
    this.script = null;
  }

  if (this.form) {
    this.form.parentNode.removeChild(this.form);
    this.form = null;
    this.iframe = null;
  }

  Polling.prototype.doClose.call(this);
};

/**
 * Starts a poll cycle.
 *
 * @api private
 */

JSONPPolling.prototype.doPoll = function () {
  var self = this;
  var script = document.createElement('script');

  if (this.script) {
    this.script.parentNode.removeChild(this.script);
    this.script = null;
  }

  script.async = true;
  script.src = this.uri();
  script.onerror = function(e){
    self.onError('jsonp poll error',e);
  };

  var insertAt = document.getElementsByTagName('script')[0];
  insertAt.parentNode.insertBefore(script, insertAt);
  this.script = script;

  var isUAgecko = 'undefined' != typeof navigator && /gecko/i.test(navigator.userAgent);

  if (isUAgecko) {
    setTimeout(function () {
      var iframe = document.createElement('iframe');
      document.body.appendChild(iframe);
      document.body.removeChild(iframe);
    }, 100);
  }
};

/**
 * Writes with a hidden iframe.
 *
 * @param {String} data to send
 * @param {Function} called upon flush.
 * @api private
 */

JSONPPolling.prototype.doWrite = function (data, fn) {
  var self = this;

  if (!this.form) {
    var form = document.createElement('form');
    var area = document.createElement('textarea');
    var id = this.iframeId = 'eio_iframe_' + this.index;
    var iframe;

    form.className = 'socketio';
    form.style.position = 'absolute';
    form.style.top = '-1000px';
    form.style.left = '-1000px';
    form.target = id;
    form.method = 'POST';
    form.setAttribute('accept-charset', 'utf-8');
    area.name = 'd';
    form.appendChild(area);
    document.body.appendChild(form);

    this.form = form;
    this.area = area;
  }

  this.form.action = this.uri();

  function complete () {
    initIframe();
    fn();
  }

  function initIframe () {
    if (self.iframe) {
      try {
        self.form.removeChild(self.iframe);
      } catch (e) {
        self.onError('jsonp polling iframe removal error', e);
      }
    }

    try {
      // ie6 dynamic iframes with target="" support (thanks Chris Lambacher)
      var html = '<iframe src="javascript:0" name="'+ self.iframeId +'">';
      iframe = document.createElement(html);
    } catch (e) {
      iframe = document.createElement('iframe');
      iframe.name = self.iframeId;
      iframe.src = 'javascript:0';
    }

    iframe.id = self.iframeId;

    self.form.appendChild(iframe);
    self.iframe = iframe;
  }

  initIframe();

  // escape \n to prevent it from being converted into \r\n by some UAs
  // double escaping is required for escaped new lines because unescaping of new lines can be done safely on server-side
  data = data.replace(rEscapedNewline, '\\\n');
  this.area.value = data.replace(rNewline, '\\n');

  try {
    this.form.submit();
  } catch(e) {}

  if (this.iframe.attachEvent) {
    this.iframe.onreadystatechange = function(){
      if (self.iframe.readyState == 'complete') {
        complete();
      }
    };
  } else {
    this.iframe.onload = complete;
  }
};

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./polling":8,"component-inherit":12}],7:[function(_dereq_,module,exports){
(function (global){
/**
 * Module requirements.
 */

var XMLHttpRequest = _dereq_('xmlhttprequest');
var Polling = _dereq_('./polling');
var Emitter = _dereq_('component-emitter');
var inherit = _dereq_('component-inherit');
var debug = _dereq_('debug')('engine.io-client:polling-xhr');

/**
 * Module exports.
 */

module.exports = XHR;
module.exports.Request = Request;

/**
 * Empty function
 */

function empty(){}

/**
 * XHR Polling constructor.
 *
 * @param {Object} opts
 * @api public
 */

function XHR(opts){
  Polling.call(this, opts);

  if (global.location) {
    var isSSL = 'https:' == location.protocol;
    var port = location.port;

    // some user agents have empty `location.port`
    if (!port) {
      port = isSSL ? 443 : 80;
    }

    this.xd = opts.hostname != global.location.hostname ||
      port != opts.port;
    this.xs = opts.secure != isSSL;
  }
}

/**
 * Inherits from Polling.
 */

inherit(XHR, Polling);

/**
 * XHR supports binary
 */

XHR.prototype.supportsBinary = true;

/**
 * Creates a request.
 *
 * @param {String} method
 * @api private
 */

XHR.prototype.request = function(opts){
  opts = opts || {};
  opts.uri = this.uri();
  opts.xd = this.xd;
  opts.xs = this.xs;
  opts.agent = this.agent || false;
  opts.supportsBinary = this.supportsBinary;
  opts.enablesXDR = this.enablesXDR;

  // SSL options for Node.js client
  opts.pfx = this.pfx;
  opts.key = this.key;
  opts.passphrase = this.passphrase;
  opts.cert = this.cert;
  opts.ca = this.ca;
  opts.ciphers = this.ciphers;
  opts.rejectUnauthorized = this.rejectUnauthorized;

  return new Request(opts);
};

/**
 * Sends data.
 *
 * @param {String} data to send.
 * @param {Function} called upon flush.
 * @api private
 */

XHR.prototype.doWrite = function(data, fn){
  var isBinary = typeof data !== 'string' && data !== undefined;
  var req = this.request({ method: 'POST', data: data, isBinary: isBinary });
  var self = this;
  req.on('success', fn);
  req.on('error', function(err){
    self.onError('xhr post error', err);
  });
  this.sendXhr = req;
};

/**
 * Starts a poll cycle.
 *
 * @api private
 */

XHR.prototype.doPoll = function(){
  debug('xhr poll');
  var req = this.request();
  var self = this;
  req.on('data', function(data){
    self.onData(data);
  });
  req.on('error', function(err){
    self.onError('xhr poll error', err);
  });
  this.pollXhr = req;
};

/**
 * Request constructor
 *
 * @param {Object} options
 * @api public
 */

function Request(opts){
  this.method = opts.method || 'GET';
  this.uri = opts.uri;
  this.xd = !!opts.xd;
  this.xs = !!opts.xs;
  this.async = false !== opts.async;
  this.data = undefined != opts.data ? opts.data : null;
  this.agent = opts.agent;
  this.isBinary = opts.isBinary;
  this.supportsBinary = opts.supportsBinary;
  this.enablesXDR = opts.enablesXDR;

  // SSL options for Node.js client
  this.pfx = opts.pfx;
  this.key = opts.key;
  this.passphrase = opts.passphrase;
  this.cert = opts.cert;
  this.ca = opts.ca;
  this.ciphers = opts.ciphers;
  this.rejectUnauthorized = opts.rejectUnauthorized;

  this.create();
}

/**
 * Mix in `Emitter`.
 */

Emitter(Request.prototype);

/**
 * Creates the XHR object and sends the request.
 *
 * @api private
 */

Request.prototype.create = function(){
  var opts = { agent: this.agent, xdomain: this.xd, xscheme: this.xs, enablesXDR: this.enablesXDR };

  // SSL options for Node.js client
  opts.pfx = this.pfx;
  opts.key = this.key;
  opts.passphrase = this.passphrase;
  opts.cert = this.cert;
  opts.ca = this.ca;
  opts.ciphers = this.ciphers;
  opts.rejectUnauthorized = this.rejectUnauthorized;

  var xhr = this.xhr = new XMLHttpRequest(opts);
  var self = this;

  try {
    debug('xhr open %s: %s', this.method, this.uri);
    xhr.open(this.method, this.uri, this.async);
    if (this.supportsBinary) {
      // This has to be done after open because Firefox is stupid
      // http://stackoverflow.com/questions/13216903/get-binary-data-with-xmlhttprequest-in-a-firefox-extension
      xhr.responseType = 'arraybuffer';
    }

    if ('POST' == this.method) {
      try {
        if (this.isBinary) {
          xhr.setRequestHeader('Content-type', 'application/octet-stream');
        } else {
          xhr.setRequestHeader('Content-type', 'text/plain;charset=UTF-8');
        }
      } catch (e) {}
    }

    // ie6 check
    if ('withCredentials' in xhr) {
      xhr.withCredentials = true;
    }

    if (this.hasXDR()) {
      xhr.onload = function(){
        self.onLoad();
      };
      xhr.onerror = function(){
        self.onError(xhr.responseText);
      };
    } else {
      xhr.onreadystatechange = function(){
        if (4 != xhr.readyState) return;
        if (200 == xhr.status || 1223 == xhr.status) {
          self.onLoad();
        } else {
          // make sure the `error` event handler that's user-set
          // does not throw in the same tick and gets caught here
          setTimeout(function(){
            self.onError(xhr.status);
          }, 0);
        }
      };
    }

    debug('xhr data %s', this.data);
    xhr.send(this.data);
  } catch (e) {
    // Need to defer since .create() is called directly fhrom the constructor
    // and thus the 'error' event can only be only bound *after* this exception
    // occurs.  Therefore, also, we cannot throw here at all.
    setTimeout(function() {
      self.onError(e);
    }, 0);
    return;
  }

  if (global.document) {
    this.index = Request.requestsCount++;
    Request.requests[this.index] = this;
  }
};

/**
 * Called upon successful response.
 *
 * @api private
 */

Request.prototype.onSuccess = function(){
  this.emit('success');
  this.cleanup();
};

/**
 * Called if we have data.
 *
 * @api private
 */

Request.prototype.onData = function(data){
  this.emit('data', data);
  this.onSuccess();
};

/**
 * Called upon error.
 *
 * @api private
 */

Request.prototype.onError = function(err){
  this.emit('error', err);
  this.cleanup(true);
};

/**
 * Cleans up house.
 *
 * @api private
 */

Request.prototype.cleanup = function(fromError){
  if ('undefined' == typeof this.xhr || null === this.xhr) {
    return;
  }
  // xmlhttprequest
  if (this.hasXDR()) {
    this.xhr.onload = this.xhr.onerror = empty;
  } else {
    this.xhr.onreadystatechange = empty;
  }

  if (fromError) {
    try {
      this.xhr.abort();
    } catch(e) {}
  }

  if (global.document) {
    delete Request.requests[this.index];
  }

  this.xhr = null;
};

/**
 * Called upon load.
 *
 * @api private
 */

Request.prototype.onLoad = function(){
  var data;
  try {
    var contentType;
    try {
      contentType = this.xhr.getResponseHeader('Content-Type').split(';')[0];
    } catch (e) {}
    if (contentType === 'application/octet-stream') {
      data = this.xhr.response;
    } else {
      if (!this.supportsBinary) {
        data = this.xhr.responseText;
      } else {
        data = 'ok';
      }
    }
  } catch (e) {
    this.onError(e);
  }
  if (null != data) {
    this.onData(data);
  }
};

/**
 * Check if it has XDomainRequest.
 *
 * @api private
 */

Request.prototype.hasXDR = function(){
  return 'undefined' !== typeof global.XDomainRequest && !this.xs && this.enablesXDR;
};

/**
 * Aborts the request.
 *
 * @api public
 */

Request.prototype.abort = function(){
  this.cleanup();
};

/**
 * Aborts pending requests when unloading the window. This is needed to prevent
 * memory leaks (e.g. when using IE) and to ensure that no spurious error is
 * emitted.
 */

if (global.document) {
  Request.requestsCount = 0;
  Request.requests = {};
  if (global.attachEvent) {
    global.attachEvent('onunload', unloadHandler);
  } else if (global.addEventListener) {
    global.addEventListener('beforeunload', unloadHandler, false);
  }
}

function unloadHandler() {
  for (var i in Request.requests) {
    if (Request.requests.hasOwnProperty(i)) {
      Request.requests[i].abort();
    }
  }
}

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./polling":8,"component-emitter":11,"component-inherit":12,"debug":13,"xmlhttprequest":10}],8:[function(_dereq_,module,exports){
/**
 * Module dependencies.
 */

var Transport = _dereq_('../transport');
var parseqs = _dereq_('parseqs');
var parser = _dereq_('engine.io-parser');
var inherit = _dereq_('component-inherit');
var debug = _dereq_('debug')('engine.io-client:polling');

/**
 * Module exports.
 */

module.exports = Polling;

/**
 * Is XHR2 supported?
 */

var hasXHR2 = (function() {
  var XMLHttpRequest = _dereq_('xmlhttprequest');
  var xhr = new XMLHttpRequest({ xdomain: false });
  return null != xhr.responseType;
})();

/**
 * Polling interface.
 *
 * @param {Object} opts
 * @api private
 */

function Polling(opts){
  var forceBase64 = (opts && opts.forceBase64);
  if (!hasXHR2 || forceBase64) {
    this.supportsBinary = false;
  }
  Transport.call(this, opts);
}

/**
 * Inherits from Transport.
 */

inherit(Polling, Transport);

/**
 * Transport name.
 */

Polling.prototype.name = 'polling';

/**
 * Opens the socket (triggers polling). We write a PING message to determine
 * when the transport is open.
 *
 * @api private
 */

Polling.prototype.doOpen = function(){
  this.poll();
};

/**
 * Pauses polling.
 *
 * @param {Function} callback upon buffers are flushed and transport is paused
 * @api private
 */

Polling.prototype.pause = function(onPause){
  var pending = 0;
  var self = this;

  this.readyState = 'pausing';

  function pause(){
    debug('paused');
    self.readyState = 'paused';
    onPause();
  }

  if (this.polling || !this.writable) {
    var total = 0;

    if (this.polling) {
      debug('we are currently polling - waiting to pause');
      total++;
      this.once('pollComplete', function(){
        debug('pre-pause polling complete');
        --total || pause();
      });
    }

    if (!this.writable) {
      debug('we are currently writing - waiting to pause');
      total++;
      this.once('drain', function(){
        debug('pre-pause writing complete');
        --total || pause();
      });
    }
  } else {
    pause();
  }
};

/**
 * Starts polling cycle.
 *
 * @api public
 */

Polling.prototype.poll = function(){
  debug('polling');
  this.polling = true;
  this.doPoll();
  this.emit('poll');
};

/**
 * Overloads onData to detect payloads.
 *
 * @api private
 */

Polling.prototype.onData = function(data){
  var self = this;
  debug('polling got data %s', data);
  var callback = function(packet, index, total) {
    // if its the first message we consider the transport open
    if ('opening' == self.readyState) {
      self.onOpen();
    }

    // if its a close packet, we close the ongoing requests
    if ('close' == packet.type) {
      self.onClose();
      return false;
    }

    // otherwise bypass onData and handle the message
    self.onPacket(packet);
  };

  // decode payload
  parser.decodePayload(data, this.socket.binaryType, callback);

  // if an event did not trigger closing
  if ('closed' != this.readyState) {
    // if we got data we're not polling
    this.polling = false;
    this.emit('pollComplete');

    if ('open' == this.readyState) {
      this.poll();
    } else {
      debug('ignoring poll - transport state "%s"', this.readyState);
    }
  }
};

/**
 * For polling, send a close packet.
 *
 * @api private
 */

Polling.prototype.doClose = function(){
  var self = this;

  function close(){
    debug('writing close packet');
    self.write([{ type: 'close' }]);
  }

  if ('open' == this.readyState) {
    debug('transport open - closing');
    close();
  } else {
    // in case we're trying to close while
    // handshaking is in progress (GH-164)
    debug('transport not open - deferring close');
    this.once('open', close);
  }
};

/**
 * Writes a packets payload.
 *
 * @param {Array} data packets
 * @param {Function} drain callback
 * @api private
 */

Polling.prototype.write = function(packets){
  var self = this;
  this.writable = false;
  var callbackfn = function() {
    self.writable = true;
    self.emit('drain');
  };

  var self = this;
  parser.encodePayload(packets, this.supportsBinary, function(data) {
    self.doWrite(data, callbackfn);
  });
};

/**
 * Generates uri for connection.
 *
 * @api private
 */

Polling.prototype.uri = function(){
  var query = this.query || {};
  var schema = this.secure ? 'https' : 'http';
  var port = '';

  // cache busting is forced
  if (false !== this.timestampRequests) {
    query[this.timestampParam] = +new Date + '-' + Transport.timestamps++;
  }

  if (!this.supportsBinary && !query.sid) {
    query.b64 = 1;
  }

  query = parseqs.encode(query);

  // avoid port if default for schema
  if (this.port && (('https' == schema && this.port != 443) ||
     ('http' == schema && this.port != 80))) {
    port = ':' + this.port;
  }

  // prepend ? to query
  if (query.length) {
    query = '?' + query;
  }

  return schema + '://' + this.hostname + port + this.path + query;
};

},{"../transport":4,"component-inherit":12,"debug":13,"engine.io-parser":16,"parseqs":29,"xmlhttprequest":10}],9:[function(_dereq_,module,exports){
/**
 * Module dependencies.
 */

var Transport = _dereq_('../transport');
var parser = _dereq_('engine.io-parser');
var parseqs = _dereq_('parseqs');
var inherit = _dereq_('component-inherit');
var debug = _dereq_('debug')('engine.io-client:websocket');

/**
 * `ws` exposes a WebSocket-compatible interface in
 * Node, or the `WebSocket` or `MozWebSocket` globals
 * in the browser.
 */

var WebSocket = _dereq_('ws');

/**
 * Module exports.
 */

module.exports = WS;

/**
 * WebSocket transport constructor.
 *
 * @api {Object} connection options
 * @api public
 */

function WS(opts){
  var forceBase64 = (opts && opts.forceBase64);
  if (forceBase64) {
    this.supportsBinary = false;
  }
  Transport.call(this, opts);
}

/**
 * Inherits from Transport.
 */

inherit(WS, Transport);

/**
 * Transport name.
 *
 * @api public
 */

WS.prototype.name = 'websocket';

/*
 * WebSockets support binary
 */

WS.prototype.supportsBinary = true;

/**
 * Opens socket.
 *
 * @api private
 */

WS.prototype.doOpen = function(){
  if (!this.check()) {
    // let probe timeout
    return;
  }

  var self = this;
  var uri = this.uri();
  var protocols = void(0);
  var opts = { agent: this.agent };

  // SSL options for Node.js client
  opts.pfx = this.pfx;
  opts.key = this.key;
  opts.passphrase = this.passphrase;
  opts.cert = this.cert;
  opts.ca = this.ca;
  opts.ciphers = this.ciphers;
  opts.rejectUnauthorized = this.rejectUnauthorized;

  this.ws = new WebSocket(uri, protocols, opts);

  if (this.ws.binaryType === undefined) {
    this.supportsBinary = false;
  }

  this.ws.binaryType = 'arraybuffer';
  this.addEventListeners();
};

/**
 * Adds event listeners to the socket
 *
 * @api private
 */

WS.prototype.addEventListeners = function(){
  var self = this;

  this.ws.onopen = function(){
    self.onOpen();
  };
  this.ws.onclose = function(){
    self.onClose();
  };
  this.ws.onmessage = function(ev){
    self.onData(ev.data);
  };
  this.ws.onerror = function(e){
    self.onError('websocket error', e);
  };
};

/**
 * Override `onData` to use a timer on iOS.
 * See: https://gist.github.com/mloughran/2052006
 *
 * @api private
 */

if ('undefined' != typeof navigator
  && /iPad|iPhone|iPod/i.test(navigator.userAgent)) {
  WS.prototype.onData = function(data){
    var self = this;
    setTimeout(function(){
      Transport.prototype.onData.call(self, data);
    }, 0);
  };
}

/**
 * Writes data to socket.
 *
 * @param {Array} array of packets.
 * @api private
 */

WS.prototype.write = function(packets){
  var self = this;
  this.writable = false;
  // encodePacket efficient as it uses WS framing
  // no need for encodePayload
  for (var i = 0, l = packets.length; i < l; i++) {
    parser.encodePacket(packets[i], this.supportsBinary, function(data) {
      //Sometimes the websocket has already been closed but the browser didn't
      //have a chance of informing us about it yet, in that case send will
      //throw an error
      try {
        self.ws.send(data);
      } catch (e){
        debug('websocket closed before onclose event');
      }
    });
  }

  function ondrain() {
    self.writable = true;
    self.emit('drain');
  }
  // fake drain
  // defer to next tick to allow Socket to clear writeBuffer
  setTimeout(ondrain, 0);
};

/**
 * Called upon close
 *
 * @api private
 */

WS.prototype.onClose = function(){
  Transport.prototype.onClose.call(this);
};

/**
 * Closes socket.
 *
 * @api private
 */

WS.prototype.doClose = function(){
  if (typeof this.ws !== 'undefined') {
    this.ws.close();
  }
};

/**
 * Generates uri for connection.
 *
 * @api private
 */

WS.prototype.uri = function(){
  var query = this.query || {};
  var schema = this.secure ? 'wss' : 'ws';
  var port = '';

  // avoid port if default for schema
  if (this.port && (('wss' == schema && this.port != 443)
    || ('ws' == schema && this.port != 80))) {
    port = ':' + this.port;
  }

  // append timestamp to URI
  if (this.timestampRequests) {
    query[this.timestampParam] = +new Date;
  }

  // communicate binary support capabilities
  if (!this.supportsBinary) {
    query.b64 = 1;
  }

  query = parseqs.encode(query);

  // prepend ? to query
  if (query.length) {
    query = '?' + query;
  }

  return schema + '://' + this.hostname + port + this.path + query;
};

/**
 * Feature detection for WebSocket.
 *
 * @return {Boolean} whether this transport is available.
 * @api public
 */

WS.prototype.check = function(){
  return !!WebSocket && !('__initialize' in WebSocket && this.name === WS.prototype.name);
};

},{"../transport":4,"component-inherit":12,"debug":13,"engine.io-parser":16,"parseqs":29,"ws":31}],10:[function(_dereq_,module,exports){
// browser shim for xmlhttprequest module
var hasCORS = _dereq_('has-cors');

module.exports = function(opts) {
  var xdomain = opts.xdomain;

  // scheme must be same when usign XDomainRequest
  // http://blogs.msdn.com/b/ieinternals/archive/2010/05/13/xdomainrequest-restrictions-limitations-and-workarounds.aspx
  var xscheme = opts.xscheme;

  // XDomainRequest has a flow of not sending cookie, therefore it should be disabled as a default.
  // https://github.com/Automattic/engine.io-client/pull/217
  var enablesXDR = opts.enablesXDR;

  // XMLHttpRequest can be disabled on IE
  try {
    if ('undefined' != typeof XMLHttpRequest && (!xdomain || hasCORS)) {
      return new XMLHttpRequest();
    }
  } catch (e) { }

  // Use XDomainRequest for IE8 if enablesXDR is true
  // because loading bar keeps flashing when using jsonp-polling
  // https://github.com/yujiosaka/socke.io-ie8-loading-example
  try {
    if ('undefined' != typeof XDomainRequest && !xscheme && enablesXDR) {
      return new XDomainRequest();
    }
  } catch (e) { }

  if (!xdomain) {
    try {
      return new window[(['Active'].concat('Object').join('X'))]('Microsoft.XMLHTTP');
    } catch(e) { }
  }
}

},{"has-cors":25}],11:[function(_dereq_,module,exports){

/**
 * Expose `Emitter`.
 */

module.exports = Emitter;

/**
 * Initialize a new `Emitter`.
 *
 * @api public
 */

function Emitter(obj) {
  if (obj) return mixin(obj);
};

/**
 * Mixin the emitter properties.
 *
 * @param {Object} obj
 * @return {Object}
 * @api private
 */

function mixin(obj) {
  for (var key in Emitter.prototype) {
    obj[key] = Emitter.prototype[key];
  }
  return obj;
}

/**
 * Listen on the given `event` with `fn`.
 *
 * @param {String} event
 * @param {Function} fn
 * @return {Emitter}
 * @api public
 */

Emitter.prototype.on =
Emitter.prototype.addEventListener = function(event, fn){
  this._callbacks = this._callbacks || {};
  (this._callbacks[event] = this._callbacks[event] || [])
    .push(fn);
  return this;
};

/**
 * Adds an `event` listener that will be invoked a single
 * time then automatically removed.
 *
 * @param {String} event
 * @param {Function} fn
 * @return {Emitter}
 * @api public
 */

Emitter.prototype.once = function(event, fn){
  var self = this;
  this._callbacks = this._callbacks || {};

  function on() {
    self.off(event, on);
    fn.apply(this, arguments);
  }

  on.fn = fn;
  this.on(event, on);
  return this;
};

/**
 * Remove the given callback for `event` or all
 * registered callbacks.
 *
 * @param {String} event
 * @param {Function} fn
 * @return {Emitter}
 * @api public
 */

Emitter.prototype.off =
Emitter.prototype.removeListener =
Emitter.prototype.removeAllListeners =
Emitter.prototype.removeEventListener = function(event, fn){
  this._callbacks = this._callbacks || {};

  // all
  if (0 == arguments.length) {
    this._callbacks = {};
    return this;
  }

  // specific event
  var callbacks = this._callbacks[event];
  if (!callbacks) return this;

  // remove all handlers
  if (1 == arguments.length) {
    delete this._callbacks[event];
    return this;
  }

  // remove specific handler
  var cb;
  for (var i = 0; i < callbacks.length; i++) {
    cb = callbacks[i];
    if (cb === fn || cb.fn === fn) {
      callbacks.splice(i, 1);
      break;
    }
  }
  return this;
};

/**
 * Emit `event` with the given args.
 *
 * @param {String} event
 * @param {Mixed} ...
 * @return {Emitter}
 */

Emitter.prototype.emit = function(event){
  this._callbacks = this._callbacks || {};
  var args = [].slice.call(arguments, 1)
    , callbacks = this._callbacks[event];

  if (callbacks) {
    callbacks = callbacks.slice(0);
    for (var i = 0, len = callbacks.length; i < len; ++i) {
      callbacks[i].apply(this, args);
    }
  }

  return this;
};

/**
 * Return array of callbacks for `event`.
 *
 * @param {String} event
 * @return {Array}
 * @api public
 */

Emitter.prototype.listeners = function(event){
  this._callbacks = this._callbacks || {};
  return this._callbacks[event] || [];
};

/**
 * Check if this emitter has `event` handlers.
 *
 * @param {String} event
 * @return {Boolean}
 * @api public
 */

Emitter.prototype.hasListeners = function(event){
  return !! this.listeners(event).length;
};

},{}],12:[function(_dereq_,module,exports){

module.exports = function(a, b){
  var fn = function(){};
  fn.prototype = b.prototype;
  a.prototype = new fn;
  a.prototype.constructor = a;
};
},{}],13:[function(_dereq_,module,exports){

/**
 * This is the web browser implementation of `debug()`.
 *
 * Expose `debug()` as the module.
 */

exports = module.exports = _dereq_('./debug');
exports.log = log;
exports.formatArgs = formatArgs;
exports.save = save;
exports.load = load;
exports.useColors = useColors;

/**
 * Colors.
 */

exports.colors = [
  'lightseagreen',
  'forestgreen',
  'goldenrod',
  'dodgerblue',
  'darkorchid',
  'crimson'
];

/**
 * Currently only WebKit-based Web Inspectors, Firefox >= v31,
 * and the Firebug extension (any Firefox version) are known
 * to support "%c" CSS customizations.
 *
 * TODO: add a `localStorage` variable to explicitly enable/disable colors
 */

function useColors() {
  // is webkit? http://stackoverflow.com/a/16459606/376773
  return ('WebkitAppearance' in document.documentElement.style) ||
    // is firebug? http://stackoverflow.com/a/398120/376773
    (window.console && (console.firebug || (console.exception && console.table))) ||
    // is firefox >= v31?
    // https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages
    (navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) && parseInt(RegExp.$1, 10) >= 31);
}

/**
 * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.
 */

exports.formatters.j = function(v) {
  return JSON.stringify(v);
};


/**
 * Colorize log arguments if enabled.
 *
 * @api public
 */

function formatArgs() {
  var args = arguments;
  var useColors = this.useColors;

  args[0] = (useColors ? '%c' : '')
    + this.namespace
    + (useColors ? ' %c' : ' ')
    + args[0]
    + (useColors ? '%c ' : ' ')
    + '+' + exports.humanize(this.diff);

  if (!useColors) return args;

  var c = 'color: ' + this.color;
  args = [args[0], c, 'color: inherit'].concat(Array.prototype.slice.call(args, 1));

  // the final "%c" is somewhat tricky, because there could be other
  // arguments passed either before or after the %c, so we need to
  // figure out the correct index to insert the CSS into
  var index = 0;
  var lastC = 0;
  args[0].replace(/%[a-z%]/g, function(match) {
    if ('%%' === match) return;
    index++;
    if ('%c' === match) {
      // we only are interested in the *last* %c
      // (the user may have provided their own)
      lastC = index;
    }
  });

  args.splice(lastC, 0, c);
  return args;
}

/**
 * Invokes `console.log()` when available.
 * No-op when `console.log` is not a "function".
 *
 * @api public
 */

function log() {
  // This hackery is required for IE8,
  // where the `console.log` function doesn't have 'apply'
  return 'object' == typeof console
    && 'function' == typeof console.log
    && Function.prototype.apply.call(console.log, console, arguments);
}

/**
 * Save `namespaces`.
 *
 * @param {String} namespaces
 * @api private
 */

function save(namespaces) {
  try {
    if (null == namespaces) {
      localStorage.removeItem('debug');
    } else {
      localStorage.debug = namespaces;
    }
  } catch(e) {}
}

/**
 * Load `namespaces`.
 *
 * @return {String} returns the previously persisted debug modes
 * @api private
 */

function load() {
  var r;
  try {
    r = localStorage.debug;
  } catch(e) {}
  return r;
}

/**
 * Enable namespaces listed in `localStorage.debug` initially.
 */

exports.enable(load());

},{"./debug":14}],14:[function(_dereq_,module,exports){

/**
 * This is the common logic for both the Node.js and web browser
 * implementations of `debug()`.
 *
 * Expose `debug()` as the module.
 */

exports = module.exports = debug;
exports.coerce = coerce;
exports.disable = disable;
exports.enable = enable;
exports.enabled = enabled;
exports.humanize = _dereq_('ms');

/**
 * The currently active debug mode names, and names to skip.
 */

exports.names = [];
exports.skips = [];

/**
 * Map of special "%n" handling functions, for the debug "format" argument.
 *
 * Valid key names are a single, lowercased letter, i.e. "n".
 */

exports.formatters = {};

/**
 * Previously assigned color.
 */

var prevColor = 0;

/**
 * Previous log timestamp.
 */

var prevTime;

/**
 * Select a color.
 *
 * @return {Number}
 * @api private
 */

function selectColor() {
  return exports.colors[prevColor++ % exports.colors.length];
}

/**
 * Create a debugger with the given `namespace`.
 *
 * @param {String} namespace
 * @return {Function}
 * @api public
 */

function debug(namespace) {

  // define the `disabled` version
  function disabled() {
  }
  disabled.enabled = false;

  // define the `enabled` version
  function enabled() {

    var self = enabled;

    // set `diff` timestamp
    var curr = +new Date();
    var ms = curr - (prevTime || curr);
    self.diff = ms;
    self.prev = prevTime;
    self.curr = curr;
    prevTime = curr;

    // add the `color` if not set
    if (null == self.useColors) self.useColors = exports.useColors();
    if (null == self.color && self.useColors) self.color = selectColor();

    var args = Array.prototype.slice.call(arguments);

    args[0] = exports.coerce(args[0]);

    if ('string' !== typeof args[0]) {
      // anything else let's inspect with %o
      args = ['%o'].concat(args);
    }

    // apply any `formatters` transformations
    var index = 0;
    args[0] = args[0].replace(/%([a-z%])/g, function(match, format) {
      // if we encounter an escaped % then don't increase the array index
      if (match === '%%') return match;
      index++;
      var formatter = exports.formatters[format];
      if ('function' === typeof formatter) {
        var val = args[index];
        match = formatter.call(self, val);

        // now we need to remove `args[index]` since it's inlined in the `format`
        args.splice(index, 1);
        index--;
      }
      return match;
    });

    if ('function' === typeof exports.formatArgs) {
      args = exports.formatArgs.apply(self, args);
    }
    var logFn = enabled.log || exports.log || console.log.bind(console);
    logFn.apply(self, args);
  }
  enabled.enabled = true;

  var fn = exports.enabled(namespace) ? enabled : disabled;

  fn.namespace = namespace;

  return fn;
}

/**
 * Enables a debug mode by namespaces. This can include modes
 * separated by a colon and wildcards.
 *
 * @param {String} namespaces
 * @api public
 */

function enable(namespaces) {
  exports.save(namespaces);

  var split = (namespaces || '').split(/[\s,]+/);
  var len = split.length;

  for (var i = 0; i < len; i++) {
    if (!split[i]) continue; // ignore empty strings
    namespaces = split[i].replace(/\*/g, '.*?');
    if (namespaces[0] === '-') {
      exports.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));
    } else {
      exports.names.push(new RegExp('^' + namespaces + '$'));
    }
  }
}

/**
 * Disable debug output.
 *
 * @api public
 */

function disable() {
  exports.enable('');
}

/**
 * Returns true if the given mode name is enabled, false otherwise.
 *
 * @param {String} name
 * @return {Boolean}
 * @api public
 */

function enabled(name) {
  var i, len;
  for (i = 0, len = exports.skips.length; i < len; i++) {
    if (exports.skips[i].test(name)) {
      return false;
    }
  }
  for (i = 0, len = exports.names.length; i < len; i++) {
    if (exports.names[i].test(name)) {
      return true;
    }
  }
  return false;
}

/**
 * Coerce `val`.
 *
 * @param {Mixed} val
 * @return {Mixed}
 * @api private
 */

function coerce(val) {
  if (val instanceof Error) return val.stack || val.message;
  return val;
}

},{"ms":15}],15:[function(_dereq_,module,exports){
/**
 * Helpers.
 */

var s = 1000;
var m = s * 60;
var h = m * 60;
var d = h * 24;
var y = d * 365.25;

/**
 * Parse or format the given `val`.
 *
 * Options:
 *
 *  - `long` verbose formatting [false]
 *
 * @param {String|Number} val
 * @param {Object} options
 * @return {String|Number}
 * @api public
 */

module.exports = function(val, options){
  options = options || {};
  if ('string' == typeof val) return parse(val);
  return options.long
    ? long(val)
    : short(val);
};

/**
 * Parse the given `str` and return milliseconds.
 *
 * @param {String} str
 * @return {Number}
 * @api private
 */

function parse(str) {
  var match = /^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);
  if (!match) return;
  var n = parseFloat(match[1]);
  var type = (match[2] || 'ms').toLowerCase();
  switch (type) {
    case 'years':
    case 'year':
    case 'y':
      return n * y;
    case 'days':
    case 'day':
    case 'd':
      return n * d;
    case 'hours':
    case 'hour':
    case 'h':
      return n * h;
    case 'minutes':
    case 'minute':
    case 'm':
      return n * m;
    case 'seconds':
    case 'second':
    case 's':
      return n * s;
    case 'ms':
      return n;
  }
}

/**
 * Short format for `ms`.
 *
 * @param {Number} ms
 * @return {String}
 * @api private
 */

function short(ms) {
  if (ms >= d) return Math.round(ms / d) + 'd';
  if (ms >= h) return Math.round(ms / h) + 'h';
  if (ms >= m) return Math.round(ms / m) + 'm';
  if (ms >= s) return Math.round(ms / s) + 's';
  return ms + 'ms';
}

/**
 * Long format for `ms`.
 *
 * @param {Number} ms
 * @return {String}
 * @api private
 */

function long(ms) {
  return plural(ms, d, 'day')
    || plural(ms, h, 'hour')
    || plural(ms, m, 'minute')
    || plural(ms, s, 'second')
    || ms + ' ms';
}

/**
 * Pluralization helper.
 */

function plural(ms, n, name) {
  if (ms < n) return;
  if (ms < n * 1.5) return Math.floor(ms / n) + ' ' + name;
  return Math.ceil(ms / n) + ' ' + name + 's';
}

},{}],16:[function(_dereq_,module,exports){
(function (global){
/**
 * Module dependencies.
 */

var keys = _dereq_('./keys');
var hasBinary = _dereq_('has-binary');
var sliceBuffer = _dereq_('arraybuffer.slice');
var base64encoder = _dereq_('base64-arraybuffer');
var after = _dereq_('after');
var utf8 = _dereq_('utf8');

/**
 * Check if we are running an android browser. That requires us to use
 * ArrayBuffer with polling transports...
 *
 * http://ghinda.net/jpeg-blob-ajax-android/
 */

var isAndroid = navigator.userAgent.match(/Android/i);

/**
 * Check if we are running in PhantomJS.
 * Uploading a Blob with PhantomJS does not work correctly, as reported here:
 * https://github.com/ariya/phantomjs/issues/11395
 * @type boolean
 */
var isPhantomJS = /PhantomJS/i.test(navigator.userAgent);

/**
 * When true, avoids using Blobs to encode payloads.
 * @type boolean
 */
var dontSendBlobs = isAndroid || isPhantomJS;

/**
 * Current protocol version.
 */

exports.protocol = 3;

/**
 * Packet types.
 */

var packets = exports.packets = {
    open:     0    // non-ws
  , close:    1    // non-ws
  , ping:     2
  , pong:     3
  , message:  4
  , upgrade:  5
  , noop:     6
};

var packetslist = keys(packets);

/**
 * Premade error packet.
 */

var err = { type: 'error', data: 'parser error' };

/**
 * Create a blob api even for blob builder when vendor prefixes exist
 */

var Blob = _dereq_('blob');

/**
 * Encodes a packet.
 *
 *     <packet type id> [ <data> ]
 *
 * Example:
 *
 *     5hello world
 *     3
 *     4
 *
 * Binary is encoded in an identical principle
 *
 * @api private
 */

exports.encodePacket = function (packet, supportsBinary, utf8encode, callback) {
  if ('function' == typeof supportsBinary) {
    callback = supportsBinary;
    supportsBinary = false;
  }

  if ('function' == typeof utf8encode) {
    callback = utf8encode;
    utf8encode = null;
  }

  var data = (packet.data === undefined)
    ? undefined
    : packet.data.buffer || packet.data;

  if (global.ArrayBuffer && data instanceof ArrayBuffer) {
    return encodeArrayBuffer(packet, supportsBinary, callback);
  } else if (Blob && data instanceof global.Blob) {
    return encodeBlob(packet, supportsBinary, callback);
  }

  // might be an object with { base64: true, data: dataAsBase64String }
  if (data && data.base64) {
    return encodeBase64Object(packet, callback);
  }

  // Sending data as a utf-8 string
  var encoded = packets[packet.type];

  // data fragment is optional
  if (undefined !== packet.data) {
    encoded += utf8encode ? utf8.encode(String(packet.data)) : String(packet.data);
  }

  return callback('' + encoded);

};

function encodeBase64Object(packet, callback) {
  // packet data is an object { base64: true, data: dataAsBase64String }
  var message = 'b' + exports.packets[packet.type] + packet.data.data;
  return callback(message);
}

/**
 * Encode packet helpers for binary types
 */

function encodeArrayBuffer(packet, supportsBinary, callback) {
  if (!supportsBinary) {
    return exports.encodeBase64Packet(packet, callback);
  }

  var data = packet.data;
  var contentArray = new Uint8Array(data);
  var resultBuffer = new Uint8Array(1 + data.byteLength);

  resultBuffer[0] = packets[packet.type];
  for (var i = 0; i < contentArray.length; i++) {
    resultBuffer[i+1] = contentArray[i];
  }

  return callback(resultBuffer.buffer);
}

function encodeBlobAsArrayBuffer(packet, supportsBinary, callback) {
  if (!supportsBinary) {
    return exports.encodeBase64Packet(packet, callback);
  }

  var fr = new FileReader();
  fr.onload = function() {
    packet.data = fr.result;
    exports.encodePacket(packet, supportsBinary, true, callback);
  };
  return fr.readAsArrayBuffer(packet.data);
}

function encodeBlob(packet, supportsBinary, callback) {
  if (!supportsBinary) {
    return exports.encodeBase64Packet(packet, callback);
  }

  if (dontSendBlobs) {
    return encodeBlobAsArrayBuffer(packet, supportsBinary, callback);
  }

  var length = new Uint8Array(1);
  length[0] = packets[packet.type];
  var blob = new Blob([length.buffer, packet.data]);

  return callback(blob);
}

/**
 * Encodes a packet with binary data in a base64 string
 *
 * @param {Object} packet, has `type` and `data`
 * @return {String} base64 encoded message
 */

exports.encodeBase64Packet = function(packet, callback) {
  var message = 'b' + exports.packets[packet.type];
  if (Blob && packet.data instanceof Blob) {
    var fr = new FileReader();
    fr.onload = function() {
      var b64 = fr.result.split(',')[1];
      callback(message + b64);
    };
    return fr.readAsDataURL(packet.data);
  }

  var b64data;
  try {
    b64data = String.fromCharCode.apply(null, new Uint8Array(packet.data));
  } catch (e) {
    // iPhone Safari doesn't let you apply with typed arrays
    var typed = new Uint8Array(packet.data);
    var basic = new Array(typed.length);
    for (var i = 0; i < typed.length; i++) {
      basic[i] = typed[i];
    }
    b64data = String.fromCharCode.apply(null, basic);
  }
  message += global.btoa(b64data);
  return callback(message);
};

/**
 * Decodes a packet. Changes format to Blob if requested.
 *
 * @return {Object} with `type` and `data` (if any)
 * @api private
 */

exports.decodePacket = function (data, binaryType, utf8decode) {
  // String data
  if (typeof data == 'string' || data === undefined) {
    if (data.charAt(0) == 'b') {
      return exports.decodeBase64Packet(data.substr(1), binaryType);
    }

    if (utf8decode) {
      try {
        data = utf8.decode(data);
      } catch (e) {
        return err;
      }
    }
    var type = data.charAt(0);

    if (Number(type) != type || !packetslist[type]) {
      return err;
    }

    if (data.length > 1) {
      return { type: packetslist[type], data: data.substring(1) };
    } else {
      return { type: packetslist[type] };
    }
  }

  var asArray = new Uint8Array(data);
  var type = asArray[0];
  var rest = sliceBuffer(data, 1);
  if (Blob && binaryType === 'blob') {
    rest = new Blob([rest]);
  }
  return { type: packetslist[type], data: rest };
};

/**
 * Decodes a packet encoded in a base64 string
 *
 * @param {String} base64 encoded message
 * @return {Object} with `type` and `data` (if any)
 */

exports.decodeBase64Packet = function(msg, binaryType) {
  var type = packetslist[msg.charAt(0)];
  if (!global.ArrayBuffer) {
    return { type: type, data: { base64: true, data: msg.substr(1) } };
  }

  var data = base64encoder.decode(msg.substr(1));

  if (binaryType === 'blob' && Blob) {
    data = new Blob([data]);
  }

  return { type: type, data: data };
};

/**
 * Encodes multiple messages (payload).
 *
 *     <length>:data
 *
 * Example:
 *
 *     11:hello world2:hi
 *
 * If any contents are binary, they will be encoded as base64 strings. Base64
 * encoded strings are marked with a b before the length specifier
 *
 * @param {Array} packets
 * @api private
 */

exports.encodePayload = function (packets, supportsBinary, callback) {
  if (typeof supportsBinary == 'function') {
    callback = supportsBinary;
    supportsBinary = null;
  }

  var isBinary = hasBinary(packets);

  if (supportsBinary && isBinary) {
    if (Blob && !dontSendBlobs) {
      return exports.encodePayloadAsBlob(packets, callback);
    }

    return exports.encodePayloadAsArrayBuffer(packets, callback);
  }

  if (!packets.length) {
    return callback('0:');
  }

  function setLengthHeader(message) {
    return message.length + ':' + message;
  }

  function encodeOne(packet, doneCallback) {
    exports.encodePacket(packet, !isBinary ? false : supportsBinary, true, function(message) {
      doneCallback(null, setLengthHeader(message));
    });
  }

  map(packets, encodeOne, function(err, results) {
    return callback(results.join(''));
  });
};

/**
 * Async array map using after
 */

function map(ary, each, done) {
  var result = new Array(ary.length);
  var next = after(ary.length, done);

  var eachWithIndex = function(i, el, cb) {
    each(el, function(error, msg) {
      result[i] = msg;
      cb(error, result);
    });
  };

  for (var i = 0; i < ary.length; i++) {
    eachWithIndex(i, ary[i], next);
  }
}

/*
 * Decodes data when a payload is maybe expected. Possible binary contents are
 * decoded from their base64 representation
 *
 * @param {String} data, callback method
 * @api public
 */

exports.decodePayload = function (data, binaryType, callback) {
  if (typeof data != 'string') {
    return exports.decodePayloadAsBinary(data, binaryType, callback);
  }

  if (typeof binaryType === 'function') {
    callback = binaryType;
    binaryType = null;
  }

  var packet;
  if (data == '') {
    // parser error - ignoring payload
    return callback(err, 0, 1);
  }

  var length = ''
    , n, msg;

  for (var i = 0, l = data.length; i < l; i++) {
    var chr = data.charAt(i);

    if (':' != chr) {
      length += chr;
    } else {
      if ('' == length || (length != (n = Number(length)))) {
        // parser error - ignoring payload
        return callback(err, 0, 1);
      }

      msg = data.substr(i + 1, n);

      if (length != msg.length) {
        // parser error - ignoring payload
        return callback(err, 0, 1);
      }

      if (msg.length) {
        packet = exports.decodePacket(msg, binaryType, true);

        if (err.type == packet.type && err.data == packet.data) {
          // parser error in individual packet - ignoring payload
          return callback(err, 0, 1);
        }

        var ret = callback(packet, i + n, l);
        if (false === ret) return;
      }

      // advance cursor
      i += n;
      length = '';
    }
  }

  if (length != '') {
    // parser error - ignoring payload
    return callback(err, 0, 1);
  }

};

/**
 * Encodes multiple messages (payload) as binary.
 *
 * <1 = binary, 0 = string><number from 0-9><number from 0-9>[...]<number
 * 255><data>
 *
 * Example:
 * 1 3 255 1 2 3, if the binary contents are interpreted as 8 bit integers
 *
 * @param {Array} packets
 * @return {ArrayBuffer} encoded payload
 * @api private
 */

exports.encodePayloadAsArrayBuffer = function(packets, callback) {
  if (!packets.length) {
    return callback(new ArrayBuffer(0));
  }

  function encodeOne(packet, doneCallback) {
    exports.encodePacket(packet, true, true, function(data) {
      return doneCallback(null, data);
    });
  }

  map(packets, encodeOne, function(err, encodedPackets) {
    var totalLength = encodedPackets.reduce(function(acc, p) {
      var len;
      if (typeof p === 'string'){
        len = p.length;
      } else {
        len = p.byteLength;
      }
      return acc + len.toString().length + len + 2; // string/binary identifier + separator = 2
    }, 0);

    var resultArray = new Uint8Array(totalLength);

    var bufferIndex = 0;
    encodedPackets.forEach(function(p) {
      var isString = typeof p === 'string';
      var ab = p;
      if (isString) {
        var view = new Uint8Array(p.length);
        for (var i = 0; i < p.length; i++) {
          view[i] = p.charCodeAt(i);
        }
        ab = view.buffer;
      }

      if (isString) { // not true binary
        resultArray[bufferIndex++] = 0;
      } else { // true binary
        resultArray[bufferIndex++] = 1;
      }

      var lenStr = ab.byteLength.toString();
      for (var i = 0; i < lenStr.length; i++) {
        resultArray[bufferIndex++] = parseInt(lenStr[i]);
      }
      resultArray[bufferIndex++] = 255;

      var view = new Uint8Array(ab);
      for (var i = 0; i < view.length; i++) {
        resultArray[bufferIndex++] = view[i];
      }
    });

    return callback(resultArray.buffer);
  });
};

/**
 * Encode as Blob
 */

exports.encodePayloadAsBlob = function(packets, callback) {
  function encodeOne(packet, doneCallback) {
    exports.encodePacket(packet, true, true, function(encoded) {
      var binaryIdentifier = new Uint8Array(1);
      binaryIdentifier[0] = 1;
      if (typeof encoded === 'string') {
        var view = new Uint8Array(encoded.length);
        for (var i = 0; i < encoded.length; i++) {
          view[i] = encoded.charCodeAt(i);
        }
        encoded = view.buffer;
        binaryIdentifier[0] = 0;
      }

      var len = (encoded instanceof ArrayBuffer)
        ? encoded.byteLength
        : encoded.size;

      var lenStr = len.toString();
      var lengthAry = new Uint8Array(lenStr.length + 1);
      for (var i = 0; i < lenStr.length; i++) {
        lengthAry[i] = parseInt(lenStr[i]);
      }
      lengthAry[lenStr.length] = 255;

      if (Blob) {
        var blob = new Blob([binaryIdentifier.buffer, lengthAry.buffer, encoded]);
        doneCallback(null, blob);
      }
    });
  }

  map(packets, encodeOne, function(err, results) {
    return callback(new Blob(results));
  });
};

/*
 * Decodes data when a payload is maybe expected. Strings are decoded by
 * interpreting each byte as a key code for entries marked to start with 0. See
 * description of encodePayloadAsBinary
 *
 * @param {ArrayBuffer} data, callback method
 * @api public
 */

exports.decodePayloadAsBinary = function (data, binaryType, callback) {
  if (typeof binaryType === 'function') {
    callback = binaryType;
    binaryType = null;
  }

  var bufferTail = data;
  var buffers = [];

  var numberTooLong = false;
  while (bufferTail.byteLength > 0) {
    var tailArray = new Uint8Array(bufferTail);
    var isString = tailArray[0] === 0;
    var msgLength = '';

    for (var i = 1; ; i++) {
      if (tailArray[i] == 255) break;

      if (msgLength.length > 310) {
        numberTooLong = true;
        break;
      }

      msgLength += tailArray[i];
    }

    if(numberTooLong) return callback(err, 0, 1);

    bufferTail = sliceBuffer(bufferTail, 2 + msgLength.length);
    msgLength = parseInt(msgLength);

    var msg = sliceBuffer(bufferTail, 0, msgLength);
    if (isString) {
      try {
        msg = String.fromCharCode.apply(null, new Uint8Array(msg));
      } catch (e) {
        // iPhone Safari doesn't let you apply to typed arrays
        var typed = new Uint8Array(msg);
        msg = '';
        for (var i = 0; i < typed.length; i++) {
          msg += String.fromCharCode(typed[i]);
        }
      }
    }

    buffers.push(msg);
    bufferTail = sliceBuffer(bufferTail, msgLength);
  }

  var total = buffers.length;
  buffers.forEach(function(buffer, i) {
    callback(exports.decodePacket(buffer, binaryType, true), i, total);
  });
};

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./keys":17,"after":18,"arraybuffer.slice":19,"base64-arraybuffer":20,"blob":21,"has-binary":22,"utf8":24}],17:[function(_dereq_,module,exports){

/**
 * Gets the keys for an object.
 *
 * @return {Array} keys
 * @api private
 */

module.exports = Object.keys || function keys (obj){
  var arr = [];
  var has = Object.prototype.hasOwnProperty;

  for (var i in obj) {
    if (has.call(obj, i)) {
      arr.push(i);
    }
  }
  return arr;
};

},{}],18:[function(_dereq_,module,exports){
module.exports = after

function after(count, callback, err_cb) {
    var bail = false
    err_cb = err_cb || noop
    proxy.count = count

    return (count === 0) ? callback() : proxy

    function proxy(err, result) {
        if (proxy.count <= 0) {
            throw new Error('after called too many times')
        }
        --proxy.count

        // after first error, rest are passed to err_cb
        if (err) {
            bail = true
            callback(err)
            // future error callbacks will go to error handler
            callback = err_cb
        } else if (proxy.count === 0 && !bail) {
            callback(null, result)
        }
    }
}

function noop() {}

},{}],19:[function(_dereq_,module,exports){
/**
 * An abstraction for slicing an arraybuffer even when
 * ArrayBuffer.prototype.slice is not supported
 *
 * @api public
 */

module.exports = function(arraybuffer, start, end) {
  var bytes = arraybuffer.byteLength;
  start = start || 0;
  end = end || bytes;

  if (arraybuffer.slice) { return arraybuffer.slice(start, end); }

  if (start < 0) { start += bytes; }
  if (end < 0) { end += bytes; }
  if (end > bytes) { end = bytes; }

  if (start >= bytes || start >= end || bytes === 0) {
    return new ArrayBuffer(0);
  }

  var abv = new Uint8Array(arraybuffer);
  var result = new Uint8Array(end - start);
  for (var i = start, ii = 0; i < end; i++, ii++) {
    result[ii] = abv[i];
  }
  return result.buffer;
};

},{}],20:[function(_dereq_,module,exports){
/*
 * base64-arraybuffer
 * https://github.com/niklasvh/base64-arraybuffer
 *
 * Copyright (c) 2012 Niklas von Hertzen
 * Licensed under the MIT license.
 */
(function(chars){
  "use strict";

  exports.encode = function(arraybuffer) {
    var bytes = new Uint8Array(arraybuffer),
    i, len = bytes.length, base64 = "";

    for (i = 0; i < len; i+=3) {
      base64 += chars[bytes[i] >> 2];
      base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];
      base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];
      base64 += chars[bytes[i + 2] & 63];
    }

    if ((len % 3) === 2) {
      base64 = base64.substring(0, base64.length - 1) + "=";
    } else if (len % 3 === 1) {
      base64 = base64.substring(0, base64.length - 2) + "==";
    }

    return base64;
  };

  exports.decode =  function(base64) {
    var bufferLength = base64.length * 0.75,
    len = base64.length, i, p = 0,
    encoded1, encoded2, encoded3, encoded4;

    if (base64[base64.length - 1] === "=") {
      bufferLength--;
      if (base64[base64.length - 2] === "=") {
        bufferLength--;
      }
    }

    var arraybuffer = new ArrayBuffer(bufferLength),
    bytes = new Uint8Array(arraybuffer);

    for (i = 0; i < len; i+=4) {
      encoded1 = chars.indexOf(base64[i]);
      encoded2 = chars.indexOf(base64[i+1]);
      encoded3 = chars.indexOf(base64[i+2]);
      encoded4 = chars.indexOf(base64[i+3]);

      bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);
      bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);
      bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);
    }

    return arraybuffer;
  };
})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");

},{}],21:[function(_dereq_,module,exports){
(function (global){
/**
 * Create a blob builder even when vendor prefixes exist
 */

var BlobBuilder = global.BlobBuilder
  || global.WebKitBlobBuilder
  || global.MSBlobBuilder
  || global.MozBlobBuilder;

/**
 * Check if Blob constructor is supported
 */

var blobSupported = (function() {
  try {
    var b = new Blob(['hi']);
    return b.size == 2;
  } catch(e) {
    return false;
  }
})();

/**
 * Check if BlobBuilder is supported
 */

var blobBuilderSupported = BlobBuilder
  && BlobBuilder.prototype.append
  && BlobBuilder.prototype.getBlob;

function BlobBuilderConstructor(ary, options) {
  options = options || {};

  var bb = new BlobBuilder();
  for (var i = 0; i < ary.length; i++) {
    bb.append(ary[i]);
  }
  return (options.type) ? bb.getBlob(options.type) : bb.getBlob();
};

module.exports = (function() {
  if (blobSupported) {
    return global.Blob;
  } else if (blobBuilderSupported) {
    return BlobBuilderConstructor;
  } else {
    return undefined;
  }
})();

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],22:[function(_dereq_,module,exports){
(function (global){

/*
 * Module requirements.
 */

var isArray = _dereq_('isarray');

/**
 * Module exports.
 */

module.exports = hasBinary;

/**
 * Checks for binary data.
 *
 * Right now only Buffer and ArrayBuffer are supported..
 *
 * @param {Object} anything
 * @api public
 */

function hasBinary(data) {

  function _hasBinary(obj) {
    if (!obj) return false;

    if ( (global.Buffer && global.Buffer.isBuffer(obj)) ||
         (global.ArrayBuffer && obj instanceof ArrayBuffer) ||
         (global.Blob && obj instanceof Blob) ||
         (global.File && obj instanceof File)
        ) {
      return true;
    }

    if (isArray(obj)) {
      for (var i = 0; i < obj.length; i++) {
          if (_hasBinary(obj[i])) {
              return true;
          }
      }
    } else if (obj && 'object' == typeof obj) {
      if (obj.toJSON) {
        obj = obj.toJSON();
      }

      for (var key in obj) {
        if (obj.hasOwnProperty(key) && _hasBinary(obj[key])) {
          return true;
        }
      }
    }

    return false;
  }

  return _hasBinary(data);
}

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"isarray":23}],23:[function(_dereq_,module,exports){
module.exports = Array.isArray || function (arr) {
  return Object.prototype.toString.call(arr) == '[object Array]';
};

},{}],24:[function(_dereq_,module,exports){
(function (global){
/*! http://mths.be/utf8js v2.0.0 by @mathias */
;(function(root) {

	// Detect free variables `exports`
	var freeExports = typeof exports == 'object' && exports;

	// Detect free variable `module`
	var freeModule = typeof module == 'object' && module &&
		module.exports == freeExports && module;

	// Detect free variable `global`, from Node.js or Browserified code,
	// and use it as `root`
	var freeGlobal = typeof global == 'object' && global;
	if (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {
		root = freeGlobal;
	}

	/*--------------------------------------------------------------------------*/

	var stringFromCharCode = String.fromCharCode;

	// Taken from http://mths.be/punycode
	function ucs2decode(string) {
		var output = [];
		var counter = 0;
		var length = string.length;
		var value;
		var extra;
		while (counter < length) {
			value = string.charCodeAt(counter++);
			if (value >= 0xD800 && value <= 0xDBFF && counter < length) {
				// high surrogate, and there is a next character
				extra = string.charCodeAt(counter++);
				if ((extra & 0xFC00) == 0xDC00) { // low surrogate
					output.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);
				} else {
					// unmatched surrogate; only append this code unit, in case the next
					// code unit is the high surrogate of a surrogate pair
					output.push(value);
					counter--;
				}
			} else {
				output.push(value);
			}
		}
		return output;
	}

	// Taken from http://mths.be/punycode
	function ucs2encode(array) {
		var length = array.length;
		var index = -1;
		var value;
		var output = '';
		while (++index < length) {
			value = array[index];
			if (value > 0xFFFF) {
				value -= 0x10000;
				output += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);
				value = 0xDC00 | value & 0x3FF;
			}
			output += stringFromCharCode(value);
		}
		return output;
	}

	/*--------------------------------------------------------------------------*/

	function createByte(codePoint, shift) {
		return stringFromCharCode(((codePoint >> shift) & 0x3F) | 0x80);
	}

	function encodeCodePoint(codePoint) {
		if ((codePoint & 0xFFFFFF80) == 0) { // 1-byte sequence
			return stringFromCharCode(codePoint);
		}
		var symbol = '';
		if ((codePoint & 0xFFFFF800) == 0) { // 2-byte sequence
			symbol = stringFromCharCode(((codePoint >> 6) & 0x1F) | 0xC0);
		}
		else if ((codePoint & 0xFFFF0000) == 0) { // 3-byte sequence
			symbol = stringFromCharCode(((codePoint >> 12) & 0x0F) | 0xE0);
			symbol += createByte(codePoint, 6);
		}
		else if ((codePoint & 0xFFE00000) == 0) { // 4-byte sequence
			symbol = stringFromCharCode(((codePoint >> 18) & 0x07) | 0xF0);
			symbol += createByte(codePoint, 12);
			symbol += createByte(codePoint, 6);
		}
		symbol += stringFromCharCode((codePoint & 0x3F) | 0x80);
		return symbol;
	}

	function utf8encode(string) {
		var codePoints = ucs2decode(string);

		// console.log(JSON.stringify(codePoints.map(function(x) {
		// 	return 'U+' + x.toString(16).toUpperCase();
		// })));

		var length = codePoints.length;
		var index = -1;
		var codePoint;
		var byteString = '';
		while (++index < length) {
			codePoint = codePoints[index];
			byteString += encodeCodePoint(codePoint);
		}
		return byteString;
	}

	/*--------------------------------------------------------------------------*/

	function readContinuationByte() {
		if (byteIndex >= byteCount) {
			throw Error('Invalid byte index');
		}

		var continuationByte = byteArray[byteIndex] & 0xFF;
		byteIndex++;

		if ((continuationByte & 0xC0) == 0x80) {
			return continuationByte & 0x3F;
		}

		// If we end up here, its not a continuation byte
		throw Error('Invalid continuation byte');
	}

	function decodeSymbol() {
		var byte1;
		var byte2;
		var byte3;
		var byte4;
		var codePoint;

		if (byteIndex > byteCount) {
			throw Error('Invalid byte index');
		}

		if (byteIndex == byteCount) {
			return false;
		}

		// Read first byte
		byte1 = byteArray[byteIndex] & 0xFF;
		byteIndex++;

		// 1-byte sequence (no continuation bytes)
		if ((byte1 & 0x80) == 0) {
			return byte1;
		}

		// 2-byte sequence
		if ((byte1 & 0xE0) == 0xC0) {
			var byte2 = readContinuationByte();
			codePoint = ((byte1 & 0x1F) << 6) | byte2;
			if (codePoint >= 0x80) {
				return codePoint;
			} else {
				throw Error('Invalid continuation byte');
			}
		}

		// 3-byte sequence (may include unpaired surrogates)
		if ((byte1 & 0xF0) == 0xE0) {
			byte2 = readContinuationByte();
			byte3 = readContinuationByte();
			codePoint = ((byte1 & 0x0F) << 12) | (byte2 << 6) | byte3;
			if (codePoint >= 0x0800) {
				return codePoint;
			} else {
				throw Error('Invalid continuation byte');
			}
		}

		// 4-byte sequence
		if ((byte1 & 0xF8) == 0xF0) {
			byte2 = readContinuationByte();
			byte3 = readContinuationByte();
			byte4 = readContinuationByte();
			codePoint = ((byte1 & 0x0F) << 0x12) | (byte2 << 0x0C) |
				(byte3 << 0x06) | byte4;
			if (codePoint >= 0x010000 && codePoint <= 0x10FFFF) {
				return codePoint;
			}
		}

		throw Error('Invalid UTF-8 detected');
	}

	var byteArray;
	var byteCount;
	var byteIndex;
	function utf8decode(byteString) {
		byteArray = ucs2decode(byteString);
		byteCount = byteArray.length;
		byteIndex = 0;
		var codePoints = [];
		var tmp;
		while ((tmp = decodeSymbol()) !== false) {
			codePoints.push(tmp);
		}
		return ucs2encode(codePoints);
	}

	/*--------------------------------------------------------------------------*/

	var utf8 = {
		'version': '2.0.0',
		'encode': utf8encode,
		'decode': utf8decode
	};

	if (freeExports && !freeExports.nodeType) {
		if (freeModule) { // in Node.js or RingoJS v0.8.0+
			freeModule.exports = utf8;
		} else { // in Narwhal or RingoJS v0.7.0-
			var object = {};
			var hasOwnProperty = object.hasOwnProperty;
			for (var key in utf8) {
				hasOwnProperty.call(utf8, key) && (freeExports[key] = utf8[key]);
			}
		}
	} else { // in Rhino or a web browser
		root.utf8 = utf8;
	}

}(this));

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],25:[function(_dereq_,module,exports){

/**
 * Module dependencies.
 */

var global = _dereq_('global');

/**
 * Module exports.
 *
 * Logic borrowed from Modernizr:
 *
 *   - https://github.com/Modernizr/Modernizr/blob/master/feature-detects/cors.js
 */

try {
  module.exports = 'XMLHttpRequest' in global &&
    'withCredentials' in new global.XMLHttpRequest();
} catch (err) {
  // if XMLHttp support is disabled in IE then it will throw
  // when trying to create
  module.exports = false;
}

},{"global":26}],26:[function(_dereq_,module,exports){

/**
 * Returns `this`. Execute this without a "context" (i.e. without it being
 * attached to an object of the left-hand side), and `this` points to the
 * "global" scope of the current JS execution.
 */

module.exports = (function () { return this; })();

},{}],27:[function(_dereq_,module,exports){

var indexOf = [].indexOf;

module.exports = function(arr, obj){
  if (indexOf) return arr.indexOf(obj);
  for (var i = 0; i < arr.length; ++i) {
    if (arr[i] === obj) return i;
  }
  return -1;
};
},{}],28:[function(_dereq_,module,exports){
(function (global){
/**
 * JSON parse.
 *
 * @see Based on jQuery#parseJSON (MIT) and JSON2
 * @api private
 */

var rvalidchars = /^[\],:{}\s]*$/;
var rvalidescape = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;
var rvalidtokens = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;
var rvalidbraces = /(?:^|:|,)(?:\s*\[)+/g;
var rtrimLeft = /^\s+/;
var rtrimRight = /\s+$/;

module.exports = function parsejson(data) {
  if ('string' != typeof data || !data) {
    return null;
  }

  data = data.replace(rtrimLeft, '').replace(rtrimRight, '');

  // Attempt to parse using the native JSON parser first
  if (global.JSON && JSON.parse) {
    return JSON.parse(data);
  }

  if (rvalidchars.test(data.replace(rvalidescape, '@')
      .replace(rvalidtokens, ']')
      .replace(rvalidbraces, ''))) {
    return (new Function('return ' + data))();
  }
};
}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],29:[function(_dereq_,module,exports){
/**
 * Compiles a querystring
 * Returns string representation of the object
 *
 * @param {Object}
 * @api private
 */

exports.encode = function (obj) {
  var str = '';

  for (var i in obj) {
    if (obj.hasOwnProperty(i)) {
      if (str.length) str += '&';
      str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);
    }
  }

  return str;
};

/**
 * Parses a simple querystring into an object
 *
 * @param {String} qs
 * @api private
 */

exports.decode = function(qs){
  var qry = {};
  var pairs = qs.split('&');
  for (var i = 0, l = pairs.length; i < l; i++) {
    var pair = pairs[i].split('=');
    qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
  }
  return qry;
};

},{}],30:[function(_dereq_,module,exports){
/**
 * Parses an URI
 *
 * @author Steven Levithan <stevenlevithan.com> (MIT license)
 * @api private
 */

var re = /^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;

var parts = [
    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'
];

module.exports = function parseuri(str) {
    var src = str,
        b = str.indexOf('['),
        e = str.indexOf(']');

    if (b != -1 && e != -1) {
        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);
    }

    var m = re.exec(str || ''),
        uri = {},
        i = 14;

    while (i--) {
        uri[parts[i]] = m[i] || '';
    }

    if (b != -1 && e != -1) {
        uri.source = src;
        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');
        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');
        uri.ipv6uri = true;
    }

    return uri;
};

},{}],31:[function(_dereq_,module,exports){

/**
 * Module dependencies.
 */

var global = (function() { return this; })();

/**
 * WebSocket constructor.
 */

var WebSocket = global.WebSocket || global.MozWebSocket;

/**
 * Module exports.
 */

module.exports = WebSocket ? ws : null;

/**
 * WebSocket constructor.
 *
 * The third `opts` options object gets ignored in web browsers, since it's
 * non-standard, and throws a TypeError if passed to the constructor.
 * See: https://github.com/einaros/ws/issues/227
 *
 * @param {String} uri
 * @param {Array} protocols (optional)
 * @param {Object) opts (optional)
 * @api public
 */

function ws(uri, protocols, opts) {
  var instance;
  if (protocols) {
    instance = new WebSocket(uri, protocols);
  } else {
    instance = new WebSocket(uri);
  }
  return instance;
}

if (WebSocket) ws.prototype = WebSocket.prototype;

},{}]},{},[1])(1)
});
})(this["Primus"]);

},{}]},{},[121]);
